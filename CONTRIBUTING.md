# Contributing to OrchestKit Plugin

Welcome to the OrchestKit plugin for Claude Code! We're excited that you're interested in contributing. This plugin extends Claude Code with specialized skills, agents, and hooks for AI-native development workflows.

## How to Contribute

### Getting Started

1. **Fork the repository** on GitHub
2. **Clone your fork** locally:
   ```bash
   git clone https://github.com/YOUR_USERNAME/orchestkit.git
   cd orchestkit
   ```
3. **Create a feature branch**:
   ```bash
   git checkout -b feature/your-feature-name
   # or for issues:
   git checkout -b issue/123-description
   ```
4. **Make your changes** following the guidelines below
5. **Test your changes** thoroughly
6. **Submit a Pull Request** to the `main` branch

### Branch Naming Convention

- `feature/` - New features or enhancements
- `fix/` - Bug fixes
- `docs/` - Documentation updates

## Project Structure

OrchestKit uses a **build system** to assemble modular plugins from source files.

### Source Files (Edit These)

```
src/
├── skills/               # 179 skills in flat CC 2.1.7 structure
│   └── <skill-name>/
│       ├── SKILL.md           # Required: Patterns and best practices
│       ├── references/        # Optional: Specific implementations
│       ├── scripts/           # Optional: Executable code and generators
│       ├── assets/            # Optional: Templates and copyable files
│       └── checklists/        # Optional: Implementation checklists
├── agents/               # 34 specialized AI personas
└── hooks/                # 149 TypeScript hooks in 11 split bundles

manifests/                # Plugin definitions (34 JSON files)
├── ork.json              # Core plugin manifest
├── ork-rag.json          # RAG plugin manifest
└── ...                   # 32 more domain-specific manifests
```

### Generated Files (Do Not Edit)

```
plugins/                  # Generated by build script
├── ork/                  # Assembled from manifest + src/
├── ork-rag/
└── ...

.claude-plugin/
└── marketplace.json      # Generated marketplace manifest
```

### Build System

When you modify source files in `src/` or `manifests/`, **you MUST run the build script** to regenerate `plugins/`:

```bash
npm run build
# OR
bash scripts/build-plugins.sh
```

**What the build script does:**
1. Reads plugin definitions from `manifests/*.json`
2. Copies skills, agents, hooks from `src/` to `plugins/<plugin-name>/`
3. Creates `.claude-plugin/plugin.json` for each plugin
4. Generates `.claude-plugin/marketplace.json` with all plugins

**Critical Rules:**
- **ALWAYS edit files in `src/` or `manifests/`**, NEVER in `plugins/`
- **ALWAYS run `bash scripts/build-plugins.sh`** after making changes
- The `plugins/` directory is **generated** and **not tracked in git**
- CI automatically runs the build script on merge to main

**Development Workflow:**
1. Edit source: `src/skills/`, `src/agents/`, or `manifests/`
2. Build: `npm run build`
3. Test: `/plugin marketplace add file://$(pwd)` then `/plugin install ork-rag`
4. Verify: `/ork:doctor`
5. Commit: Only commit changes to `src/` and `manifests/` (not `plugins/`)

## Adding New Skills (CC 2.1.7)

Skills use the CC 2.1.7 native flat structure with SKILL.md as the only required file.

**Important:** Create skills in `src/skills/`, not `skills/` (which is a symlink).

### 1. Create Skill Directory

```bash
mkdir -p src/skills/your-skill-name/references
```

### 2. Create SKILL.md (Required)

Create `src/skills/your-skill-name/SKILL.md`:

```markdown
---
name: your-skill-name
description: Brief description for skill discovery
tags: [keyword1, keyword2, keyword3]
---

# Your Skill Name

Brief description of what this skill provides.

## When to Use

- Use case 1
- Use case 2

## Key Patterns

### Pattern 1
Explanation and code example.

### Pattern 2
Explanation and code example.

## Best Practices

- Practice 1
- Practice 2

## Anti-Patterns

- What NOT to do
```

### 3. Add References (Optional)

Create specific implementation guides in `references/`:
- `src/skills/your-skill-name/references/implementation-guide.md`
- `src/skills/your-skill-name/references/advanced-patterns.md`

### 4. Add Templates (Optional)

Create code templates in `assets/`:
- `src/skills/your-skill-name/assets/component-template.py`
- `src/skills/your-skill-name/assets/test-template.py`

### 5. Add to Plugin Manifest

Edit the appropriate manifest file in `manifests/` to include your skill:

```bash
# For example, if adding a RAG skill:
vim manifests/ork-rag.json

# Add to the "skills" array:
{
  "skills": [
    "existing-skill",
    "your-skill-name"  # Add this line
  ]
}
```

### 6. Build and Validate

```bash
# Build plugins to include your new skill
npm run build

# Validate structure
npm run test:skills

# Test locally
/plugin marketplace add file://$(pwd)
/plugin install ork-rag  # or whichever plugin contains your skill
/ork:doctor
```

## Adding New Agents

Agents are specialized AI personas defined in markdown.

**Important:** Create agents in `src/agents/`, not `agents/` (which is a symlink).

### 1. Create Agent File

Create `src/agents/your-agent.md`:

```markdown
# Your Agent Name

## Role
Brief description of the agent's specialized role.

## Capabilities
- Capability 1
- Capability 2

## Tools Available
- Tool 1
- Tool 2

## Workflow
How the agent approaches tasks.

## Success Criteria
What constitutes successful completion.

## Model Preference
haiku | sonnet | opus
```

### 2. Add to Plugin Manifest

Edit the appropriate manifest file in `manifests/` to include your agent:

```bash
# For example, if adding a backend agent:
vim manifests/ork-backend.json

# Add to the "agents" array:
{
  "agents": [
    "existing-agent",
    "your-agent"  # Add this line
  ]
}
```

### 3. Build and Test

```bash
# Build plugins to include your new agent
npm run build

# Validate agents
npm run test:agents

# Test locally
/plugin marketplace add file://$(pwd)
/plugin install ork-backend  # or whichever plugin contains your agent

# Test agent spawning (in Claude Code)
# Use Task tool with subagent_type: "your-agent"
```

## Adding New Hooks

Hooks provide lifecycle automation for Claude Code.

### Hook Requirements

1. **Shebang and strict mode**:
   ```bash
   #!/usr/bin/env bash
   set -euo pipefail
   ```

2. **CC 2.1.6 JSON output** (for pretool hooks):
   ```bash
   echo '{"continue": true, "suppressOutput": true}'
   exit 0
   ```

3. **Source common utilities** (if needed):
   ```bash
   source "$(dirname "$0")/../_lib/common.sh"
   ```

### Hook Categories

| Directory | Purpose |
|-----------|---------|
| `pretool/` | Validate before tool execution |
| `posttool/` | Act after tool execution |
| `permission/` | Auto-approve safe operations |
| `lifecycle/` | Session start/end |
| `stop/` | Conversation end handlers |

### Register Hook

Add to `.claude/settings.json` under appropriate matcher.

### Test Hook

```bash
# Syntax check
bash -n hooks/your-hook.sh

# Full test suite
./tests/unit/test-shell-syntax.sh
```

## Security Guidelines

### Required Practices

- Always use `set -euo pipefail`
- Quote all variables: `"${var}"`
- Validate file paths before operations
- Use `jq --arg` for JSON variable interpolation

### Prohibited Patterns

- **No `eval`** - Never use dynamic execution
- **No network calls** in hooks
- **No secrets** in skill files
- **No `--no-verify`** on git commands

## Testing

### Run All Tests

```bash
npm test
# OR
./tests/run-all-tests.sh
```

### Individual Test Suites

```bash
# Security tests (MUST pass)
npm run test:security
# OR
./tests/security/run-security-tests.sh

# Skill structure validation
npm run test:skills
# OR
./tests/skills/structure/test-skill-md.sh

# Agent validation
npm run test:agents
# OR
./tests/agents/test-agent-frontmatter.sh

# Other tests
./tests/unit/test-shell-syntax.sh       # Shell syntax
./tests/schemas/validate-all.sh         # Schema validation
./bin/validate-counts.sh                # Component counts
```

### Before Submitting

- [ ] New skills have `SKILL.md` with valid frontmatter
- [ ] All tests pass locally
- [ ] Hook scripts output valid JSON
- [ ] No security violations
- [ ] CHANGELOG.md updated

## Questions?

1. Check existing issues and discussions
2. Open a new discussion for general questions
3. Open an issue for bug reports or feature requests

Thank you for contributing to OrchestKit!