{
  "version": 3,
  "sources": ["../src/types.ts", "../src/lib/common.ts", "../src/lib/git.ts", "../src/lib/guards.ts", "../src/lib/orchestration-types.ts", "../src/lib/intent-classifier.ts", "../src/lib/orchestration-state.ts", "../src/lib/task-integration.ts", "../src/lib/retry-manager.ts", "../src/lib/calibration-engine.ts", "../src/lib/multi-agent-coordinator.ts", "../src/lib/decision-history.ts", "../src/permission/auto-approve-safe-bash.ts", "../src/permission/auto-approve-project-writes.ts", "../src/permission/learning-tracker.ts", "../src/pretool/bash/dangerous-command-blocker.ts", "../src/pretool/bash/git-validator.ts", "../src/pretool/bash/compound-command-validator.ts", "../src/pretool/bash/default-timeout-setter.ts", "../src/pretool/bash/error-pattern-warner.ts", "../src/pretool/bash/conflict-predictor.ts", "../src/pretool/bash/affected-tests-finder.ts", "../src/pretool/bash/ci-simulation.ts", "../src/pretool/bash/pre-commit-simulation.ts", "../src/pretool/bash/pr-merge-gate.ts", "../src/pretool/bash/changelog-generator.ts", "../src/pretool/bash/version-sync.ts", "../src/pretool/bash/license-compliance.ts", "../src/pretool/bash/gh-issue-creation-guide.ts", "../src/pretool/bash/issue-docs-requirement.ts", "../src/pretool/bash/multi-instance-quality-gate.ts", "../src/pretool/bash/agent-browser-safety.ts", "../src/pretool/write-edit/file-guard.ts", "../src/pretool/write-edit/file-lock-check.ts", "../src/pretool/write-edit/multi-instance-lock.ts", "../src/pretool/Write/architecture-change-detector.ts", "../src/pretool/Write/code-quality-gate.ts", "../src/pretool/Write/docstring-enforcer.ts", "../src/pretool/Write/security-pattern-validator.ts", "../src/pretool/mcp/context7-tracker.ts", "../src/pretool/mcp/memory-fabric-init.ts", "../src/pretool/mcp/memory-validator.ts", "../src/pretool/mcp/sequential-thinking-auto.ts", "../src/pretool/input-mod/write-headers.ts", "../src/pretool/skill/skill-tracker.ts", "../src/skill/backend-file-naming.ts", "../src/skill/decision-processor.ts", "../src/skill/backend-layer-validator.ts", "../src/skill/coverage-check.ts", "../src/skill/coverage-threshold-gate.ts", "../src/skill/cross-instance-test-validator.ts", "../src/skill/di-pattern-enforcer.ts", "../src/skill/duplicate-code-detector.ts", "../src/skill/eval-metrics-collector.ts", "../src/skill/evidence-collector.ts", "../src/skill/import-direction-enforcer.ts", "../src/skill/merge-conflict-predictor.ts", "../src/skill/merge-readiness-checker.ts", "../src/skill/migration-validator.ts", "../src/skill/pattern-consistency-enforcer.ts", "../src/skill/redact-secrets.ts", "../src/skill/review-summary-generator.ts", "../src/skill/security-summary.ts", "../src/skill/structure-location-validator.ts", "../src/skill/test-location-validator.ts", "../src/skill/test-pattern-validator.ts", "../src/skill/test-runner.ts", "../src/prompt/antipattern-detector.ts", "../src/prompt/antipattern-warning.ts", "../src/prompt/context-injector.ts", "../src/prompt/context-pruning-advisor.ts", "../src/prompt/memory-context.ts", "../src/prompt/satisfaction-detector.ts", "../src/prompt/skill-auto-suggest.ts", "../src/prompt/todo-enforcer.ts", "../src/prompt/agent-auto-suggest.ts", "../src/prompt/agent-orchestrator.ts", "../src/prompt/skill-injector.ts", "../src/prompt/pipeline-detector.ts", "../src/subagent-start/graph-memory-inject.ts", "../src/subagent-start/mem0-memory-inject.ts", "../src/subagent-start/context-gate.ts", "../src/subagent-start/subagent-context-stager.ts", "../src/subagent-start/subagent-validator.ts", "../src/subagent-start/task-linker.ts", "../src/subagent-stop/agent-memory-store.ts", "../src/subagent-stop/auto-spawn-quality.ts", "../src/subagent-stop/context-publisher.ts", "../src/subagent-stop/feedback-loop.ts", "../src/subagent-stop/handoff-preparer.ts", "../src/subagent-stop/multi-claude-verifier.ts", "../src/subagent-stop/output-validator.ts", "../src/subagent-stop/subagent-quality-gate.ts", "../src/subagent-stop/task-completer.ts", "../src/subagent-stop/retry-handler.ts", "../src/notification/desktop.ts", "../src/notification/sound.ts", "../src/stop/auto-remember-continuity.ts", "../src/stop/auto-save-context.ts", "../src/stop/cleanup-instance.ts", "../src/stop/context-compressor.ts", "../src/stop/full-test-suite.ts", "../src/stop/issue-work-summary.ts", "../src/stop/mem0-pre-compaction-sync.ts", "../src/stop/multi-instance-cleanup.ts", "../src/stop/security-scan-aggregator.ts", "../src/stop/session-patterns.ts", "../src/stop/task-completion-check.ts", "../src/stop/calibration-persist.ts", "../src/setup/first-run-setup.ts", "../src/setup/mem0-analytics-dashboard.ts", "../src/setup/mem0-backup-setup.ts", "../src/setup/mem0-cleanup.ts", "../src/setup/setup-check.ts", "../src/setup/setup-maintenance.ts", "../src/setup/setup-repair.ts", "../src/agent/block-writes.ts", "../src/agent/ci-safety-check.ts", "../src/agent/deployment-safety-check.ts", "../src/agent/migration-safety-check.ts", "../src/agent/security-command-audit.ts", "../src/posttool/audit-logger.ts", "../src/posttool/unified-error-handler.ts", "../src/posttool/auto-lint.ts", "../src/posttool/context-budget-monitor.ts", "../src/posttool/coordination-heartbeat.ts", "../src/posttool/mem0-webhook-handler.ts", "../src/posttool/memory-bridge.ts", "../src/posttool/realtime-sync.ts", "../src/posttool/session-metrics.ts", "../src/posttool/skill-edit-tracker.ts", "../src/posttool/calibration-tracker.ts", "../src/posttool/write/code-style-learner.ts", "../src/posttool/write/coverage-predictor.ts", "../src/posttool/write/naming-convention-learner.ts", "../src/posttool/write/readme-sync.ts", "../src/posttool/write/release-lock-on-commit.ts", "../src/posttool/bash/issue-progress-commenter.ts", "../src/posttool/bash/issue-subtask-updater.ts", "../src/posttool/bash/pattern-extractor.ts", "../src/posttool/skill/skill-usage-optimizer.ts", "../src/posttool/write-edit/file-lock-release.ts", "../src/lifecycle/analytics-consent-check.ts", "../src/lifecycle/coordination-cleanup.ts", "../src/lifecycle/coordination-init.ts", "../src/lifecycle/instance-heartbeat.ts", "../src/lifecycle/mem0-analytics-tracker.ts", "../src/lifecycle/mem0-context-retrieval.ts", "../src/lifecycle/mem0-webhook-setup.ts", "../src/lifecycle/multi-instance-init.ts", "../src/lifecycle/pattern-sync-pull.ts", "../src/lifecycle/pattern-sync-push.ts", "../src/lifecycle/session-cleanup.ts", "../src/lifecycle/session-context-loader.ts", "../src/lifecycle/session-env-setup.ts", "../src/lifecycle/session-metrics-summary.ts", "../src/lifecycle/dependency-version-check.ts", "../src/index.ts"],
  "sourcesContent": ["/**\n * TypeScript type definitions for Claude Code hooks\n * CC 2.1.9 compliant with additionalContext support\n */\n\n/**\n * Hook events supported by Claude Code\n */\nexport type HookEvent =\n  | 'PreToolUse'\n  | 'PostToolUse'\n  | 'PermissionRequest'\n  | 'UserPromptSubmit'\n  | 'SessionStart'\n  | 'SessionEnd'\n  | 'Stop'\n  | 'SubagentStart'\n  | 'SubagentStop'\n  | 'Setup'\n  | 'Notification';\n\n/**\n * Hook input envelope from Claude Code (sent via stdin as JSON)\n */\nexport interface HookInput {\n  /** The hook event type */\n  hook_event?: HookEvent;\n  /** The tool being invoked */\n  tool_name: string;\n  /** Session ID (CC 2.1.9 guarantees availability) */\n  session_id: string;\n  /** Tool-specific input parameters */\n  tool_input: ToolInput;\n  /** Tool output (PostToolUse only) */\n  tool_output?: unknown;\n  /** Tool error message if any */\n  tool_error?: string;\n  /** Tool exit code */\n  exit_code?: number;\n  /** User prompt (UserPromptSubmit only) */\n  prompt?: string;\n  /** Project directory */\n  project_dir?: string;\n\n  // SubagentStart/SubagentStop specific fields\n  /** Agent type for subagent hooks */\n  subagent_type?: string;\n  /** Agent type (alternative field name) */\n  agent_type?: string;\n  /** Agent ID */\n  agent_id?: string;\n  /** Agent output (SubagentStop) */\n  agent_output?: string;\n  /** Output (alternative field name) */\n  output?: string;\n  /** Error from subagent */\n  error?: string;\n  /** Duration in milliseconds */\n  duration_ms?: number;\n  /** Tool result \u2014 string from most hooks, object from Skill PostToolUse */\n  tool_result?: string | { is_error?: boolean; content?: string };\n\n  // Notification specific fields\n  /** Notification message */\n  message?: string;\n  /** Notification type */\n  notification_type?: string;\n}\n\n/**\n * Tool input types - union of all tool inputs\n */\nexport interface ToolInput {\n  /** Bash command (Bash tool) */\n  command?: string;\n  /** Timeout in ms (Bash tool) */\n  timeout?: number;\n  /** File path (Write/Edit/Read tools) */\n  file_path?: string;\n  /** File content (Write tool) */\n  content?: string;\n  /** Old text to replace (Edit tool) */\n  old_string?: string;\n  /** New text (Edit tool) */\n  new_string?: string;\n  /** Pattern (Glob/Grep tools) */\n  pattern?: string;\n  /** Allow additional properties */\n  [key: string]: unknown;\n}\n\n/**\n * Hook-specific output for CC 2.1.9\n */\nexport interface HookSpecificOutput {\n  /** Hook event name for context */\n  hookEventName?: 'PreToolUse' | 'PostToolUse' | 'PermissionRequest' | 'UserPromptSubmit';\n  /** Permission decision (PermissionRequest hooks) */\n  permissionDecision?: 'allow' | 'deny';\n  /** Reason for permission decision */\n  permissionDecisionReason?: string;\n  /** Additional context injected before tool execution (CC 2.1.9) */\n  additionalContext?: string;\n}\n\n/**\n * Hook result - output JSON to stdout\n * CC 2.1.7+ compliant\n */\nexport interface HookResult {\n  /** Whether to continue execution */\n  continue: boolean;\n  /** Suppress hook output from user */\n  suppressOutput?: boolean;\n  /** System message shown to user */\n  systemMessage?: string;\n  /** Reason for stopping (when continue is false) */\n  stopReason?: string;\n  /** Hook-specific output fields */\n  hookSpecificOutput?: HookSpecificOutput;\n}\n\n/**\n * Hook function signature\n */\nexport type HookFn = (input: HookInput) => Promise<HookResult> | HookResult;\n\n/**\n * Hook metadata for auto-discovery and governance\n * Co-export alongside hook functions for single-source-of-truth registration\n */\nexport interface HookMeta {\n  /** Full hook name path (e.g., 'pretool/bash/dangerous-command-blocker') */\n  name: string;\n  /** Human-readable description */\n  description: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher patterns for hooks.json (e.g., 'Bash', 'Write|Edit') */\n  matchers?: string[];\n  /** Run asynchronously (non-blocking) */\n  async?: boolean;\n  /** Only run once per session */\n  once?: boolean;\n  /** Timeout in seconds (async hooks only) */\n  timeout?: number;\n  /** Risk category for prioritization */\n  tier?: 'security-critical' | 'data-loss' | 'quality-gate' | 'standard';\n}\n\n/**\n * Hook overrides configuration for per-project toggle/customization\n * Stored at .claude/hook-overrides.json (gitignored)\n */\nexport interface HookOverrides {\n  /** Hook names to disable entirely */\n  disabled?: string[];\n  /** Per-hook timeout overrides (seconds) */\n  timeouts?: Record<string, number>;\n}\n\n/**\n * Hook registration entry\n */\nexport interface HookRegistration {\n  /** Hook name (e.g., 'permission/auto-approve-readonly') */\n  name: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher (string pattern or regex) */\n  matcher?: string | RegExp;\n  /** Hook implementation function */\n  fn: HookFn;\n}\n\n/**\n * Bash tool input (type guard helper)\n */\nexport interface BashToolInput extends ToolInput {\n  command: string;\n  timeout?: number;\n}\n\n/**\n * Write tool input (type guard helper)\n */\nexport interface WriteToolInput extends ToolInput {\n  file_path: string;\n  content: string;\n}\n\n/**\n * Edit tool input (type guard helper)\n */\nexport interface EditToolInput extends ToolInput {\n  file_path: string;\n  old_string: string;\n  new_string: string;\n}\n\n/**\n * Read tool input (type guard helper)\n */\nexport interface ReadToolInput extends ToolInput {\n  file_path: string;\n  offset?: number;\n  limit?: number;\n}\n\n/**\n * Type guards for tool inputs\n */\nexport function isBashInput(input: ToolInput): input is BashToolInput {\n  return typeof input.command === 'string';\n}\n\nexport function isWriteInput(input: ToolInput): input is WriteToolInput {\n  return typeof input.file_path === 'string' && typeof input.content === 'string';\n}\n\nexport function isEditInput(input: ToolInput): input is EditToolInput {\n  return (\n    typeof input.file_path === 'string' &&\n    typeof input.old_string === 'string' &&\n    typeof input.new_string === 'string'\n  );\n}\n\nexport function isReadInput(input: ToolInput): input is ReadToolInput {\n  return typeof input.file_path === 'string' && input.content === undefined;\n}\n", "/**\n * Common utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh\n */\n\nimport { appendFileSync, existsSync, statSync, renameSync, mkdirSync, readSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookResult, HookInput } from '../types.js';\n\n// -----------------------------------------------------------------------------\n// Environment and Paths\n// All functions read env vars dynamically to support testing\n// -----------------------------------------------------------------------------\n\n/**\n * Get the log directory path\n */\nexport function getLogDir(): string {\n  if (process.env.CLAUDE_PLUGIN_ROOT) {\n    return `${process.env.HOME || '/tmp'}/.claude/logs/ork`;\n  }\n  return `${getProjectDir()}/.claude/logs`;\n}\n\n/**\n * Get the project directory\n * Read dynamically to support testing\n */\nexport function getProjectDir(): string {\n  return process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the plugin root directory\n * Read dynamically to support testing\n */\nexport function getPluginRoot(): string {\n  return process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the session ID\n * CC 2.1.9+ should guarantee CLAUDE_SESSION_ID availability, but we add\n * a defensive fallback to prevent hook crashes during edge cases.\n * Read dynamically to support testing.\n */\nexport function getSessionId(): string {\n  return process.env.CLAUDE_SESSION_ID || `fallback-${process.pid}-${Date.now()}`;\n}\n\n/**\n * Get cached git branch (set at session start or first call)\n * Caches result in process.env to avoid repeated execSync calls\n */\nexport function getCachedBranch(projectDir?: string): string {\n  if (process.env.ORCHESTKIT_BRANCH) {\n    return process.env.ORCHESTKIT_BRANCH;\n  }\n\n  try {\n    const branch = execSync('git branch --show-current', {\n      cwd: projectDir || getProjectDir(),\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n    process.env.ORCHESTKIT_BRANCH = branch;\n    return branch;\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Get log level (debug|info|warn|error, default: warn)\n */\nexport function getLogLevel(): string {\n  return process.env.ORCHESTKIT_LOG_LEVEL || 'warn';\n}\n\n/**\n * Check if should log at given level\n */\nexport function shouldLog(level: 'debug' | 'info' | 'warn' | 'error'): boolean {\n  const levels = ['debug', 'info', 'warn', 'error'];\n  return levels.indexOf(level) >= levels.indexOf(getLogLevel());\n}\n\n// -----------------------------------------------------------------------------\n// Output Helpers (CC 2.1.7+ compliant)\n// -----------------------------------------------------------------------------\n\n/**\n * Output silent success - hook completed without errors, no user-visible output\n */\nexport function outputSilentSuccess(): HookResult {\n  return { continue: true, suppressOutput: true };\n}\n\n/**\n * Output silent allow - permission hook approves silently\n */\nexport function outputSilentAllow(): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: { permissionDecision: 'allow' },\n  };\n}\n\n/**\n * Output block - stops the operation with an error\n */\nexport function outputBlock(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with additionalContext - injects context before tool execution (CC 2.1.9)\n * For PostToolUse hooks (hookEventName optional)\n */\nexport function outputWithContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PostToolUse',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with additionalContext for UserPromptSubmit hooks (CC 2.1.9)\n * hookEventName is REQUIRED for UserPromptSubmit\n */\nexport function outputPromptContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output allow with additionalContext - permission hook approves with context (CC 2.1.9)\n */\nexport function outputAllowWithContext(ctx: string, systemMessage?: string): HookResult {\n  const result: HookResult = {\n    continue: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      additionalContext: ctx,\n      permissionDecision: 'allow',\n    },\n  };\n\n  if (systemMessage) {\n    result.systemMessage = systemMessage;\n  } else {\n    result.suppressOutput = true;\n  }\n\n  return result;\n}\n\n/**\n * Output error message - only use when there's an actual problem\n */\nexport function outputError(message: string): HookResult {\n  return { continue: true, systemMessage: message };\n}\n\n/**\n * Output warning message - CC 2.1.7 compliant (no ANSI in JSON)\n */\nexport function outputWarning(message: string): HookResult {\n  return { continue: true, systemMessage: `\\u26a0 ${message}` };\n}\n\n/**\n * Output deny with feedback logging (CC 2.1.7)\n */\nexport function outputDeny(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Logging (with log level guard for performance)\n// -----------------------------------------------------------------------------\n\nconst LOG_ROTATION_MAX_SIZE = 200 * 1024; // 200KB\nconst PERMISSION_LOG_MAX_SIZE = 100 * 1024; // 100KB\n\n/**\n * Rotate log file if it exceeds size limit\n */\nfunction rotateLogFile(logFile: string, maxSize: number): void {\n  if (!existsSync(logFile)) return;\n\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > maxSize) {\n      const rotated = `${logFile}.old.${Date.now()}`;\n      renameSync(logFile, rotated);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n}\n\n/**\n * Log to hook log file with automatic rotation\n * Respects ORCHESTKIT_LOG_LEVEL (default: warn, skips debug logs in production)\n */\nexport function logHook(hookName: string, message: string, level: 'debug' | 'info' | 'warn' | 'error' = 'debug'): void {\n  // Skip if below log level threshold (big perf win - avoids I/O)\n  if (!shouldLog(level)) {\n    return;\n  }\n\n  const logDir = getLogDir();\n  const logFile = `${logDir}/hooks.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, LOG_ROTATION_MAX_SIZE);\n\n    const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n    appendFileSync(logFile, `[${timestamp}] [${level.toUpperCase()}] [${hookName}] ${message}\\n`);\n  } catch {\n    // Ignore logging errors - don't block hook execution\n  }\n}\n\n/**\n * Log permission decision for audit trail (CC 2.1.7 feature)\n * Always logs (security audit trail) - not affected by log level\n */\nexport function logPermissionFeedback(\n  decision: 'allow' | 'deny' | 'warn',\n  reason: string,\n  input?: HookInput | Record<string, unknown>\n): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/permission-feedback.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, PERMISSION_LOG_MAX_SIZE);\n\n    const timestamp = new Date().toISOString();\n    const toolName = (input as HookInput)?.tool_name || process.env.HOOK_TOOL_NAME || 'unknown';\n    const sessionId = (input as HookInput)?.session_id || getSessionId();\n\n    appendFileSync(\n      logFile,\n      `${timestamp} | ${decision} | ${reason} | tool=${toolName} | session=${sessionId}\\n`\n    );\n  } catch {\n    // Ignore logging errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Input Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Read hook input from stdin synchronously\n * Returns parsed JSON or empty object on failure\n */\nexport function readHookInput(): HookInput {\n  try {\n    // Read from stdin synchronously\n    const chunks: Buffer[] = [];\n    const BUFSIZE = 256;\n    const buf = Buffer.allocUnsafe(BUFSIZE);\n\n    let bytesRead: number;\n    const fd = 0; // stdin\n\n    while (true) {\n      try {\n        bytesRead = readSync(fd, buf, 0, BUFSIZE, null);\n        if (bytesRead === 0) break;\n        chunks.push(Buffer.from(buf.subarray(0, bytesRead)));\n      } catch {\n        break;\n      }\n    }\n\n    const input = Buffer.concat(chunks).toString('utf8').trim();\n    if (!input) {\n      return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n    }\n\n    return JSON.parse(input);\n  } catch {\n    return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n  }\n}\n\n/**\n * Get field from hook input using optional chaining\n */\nexport function getField<T>(input: HookInput, path: string): T | undefined {\n  const parts = path.replace(/^\\./, '').split('.');\n  let value: unknown = input;\n\n  for (const part of parts) {\n    if (value === null || value === undefined) return undefined;\n    value = (value as Record<string, unknown>)[part];\n  }\n\n  return value as T;\n}\n\n// -----------------------------------------------------------------------------\n// String Utilities\n// -----------------------------------------------------------------------------\n\n/**\n * Normalize command: remove line continuations and collapse whitespace\n * Prevents bypassing detection with backslash-newline tricks (CC 2.1.6 fix)\n */\nexport function normalizeCommand(command: string): string {\n  return command\n    .replace(/\\\\\\s*[\\r\\n]+/g, ' ') // Remove line continuations\n    .replace(/\\n/g, ' ') // Replace newlines with spaces\n    .replace(/\\s+/g, ' ') // Collapse whitespace\n    .trim();\n}\n\n/**\n * Escape string for use in regex\n */\nexport function escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n", "/**\n * Git utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh git functions\n */\n\nimport { execSync } from 'node:child_process';\nimport { getProjectDir } from './common.js';\n\n/**\n * Get the current git branch\n */\nexport function getCurrentBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git branch --show-current', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Check if on a protected branch (dev, main, master)\n */\nexport function isProtectedBranch(branch?: string): boolean {\n  const currentBranch = branch || getCurrentBranch();\n  return ['dev', 'main', 'master'].includes(currentBranch);\n}\n\n/**\n * Get the repository root directory\n */\nexport function getRepoRoot(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git rev-parse --show-toplevel', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return dir;\n  }\n}\n\n/**\n * Check if path is inside a git repository\n */\nexport function isGitRepo(projectDir?: string): boolean {\n  const dir = projectDir || getProjectDir();\n  try {\n    execSync('git rev-parse --git-dir', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get git status (short format)\n */\nexport function getGitStatus(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git status --short', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 10000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Check if there are uncommitted changes\n */\nexport function hasUncommittedChanges(projectDir?: string): boolean {\n  return getGitStatus(projectDir).length > 0;\n}\n\n/**\n * Get the default branch (main or master)\n */\nexport function getDefaultBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    // Check if 'main' exists\n    execSync('git rev-parse --verify main', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return 'main';\n  } catch {\n    try {\n      // Check if 'master' exists\n      execSync('git rev-parse --verify master', {\n        cwd: dir,\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n      return 'master';\n    } catch {\n      return 'main'; // Default to main\n    }\n  }\n}\n\n/**\n * Extract issue number from branch name\n * Supports patterns like: issue/123-description, feature/123, fix-123\n */\nexport function extractIssueNumber(branch: string): number | null {\n  // Match common patterns\n  const patterns = [\n    /issue\\/(\\d+)/i,\n    /feature\\/(\\d+)/i,\n    /fix\\/(\\d+)/i,\n    /bug\\/(\\d+)/i,\n    /feat\\/(\\d+)/i,\n    /^(\\d+)-/,\n    /-(\\d+)$/,\n    /#(\\d+)/,\n  ];\n\n  for (const pattern of patterns) {\n    const match = branch.match(pattern);\n    if (match) {\n      return parseInt(match[1], 10);\n    }\n  }\n\n  return null;\n}\n\n/**\n * Validate branch name format\n * Returns error message if invalid, null if valid\n */\nexport function validateBranchName(branch: string): string | null {\n  // Skip validation for protected branches\n  if (isProtectedBranch(branch)) {\n    return null;\n  }\n\n  // Valid prefixes\n  const validPrefixes = [\n    'issue/',\n    'feature/',\n    'fix/',\n    'bug/',\n    'feat/',\n    'chore/',\n    'docs/',\n    'refactor/',\n    'test/',\n    'ci/',\n    'perf/',\n    'style/',\n    'release/',\n    'hotfix/',\n  ];\n\n  const hasValidPrefix = validPrefixes.some((prefix) => branch.startsWith(prefix));\n  if (!hasValidPrefix) {\n    return `Branch name should start with a valid prefix: ${validPrefixes.join(', ')}`;\n  }\n\n  // Check for issue number in issue/ branches\n  if (branch.startsWith('issue/') && !extractIssueNumber(branch)) {\n    return 'issue/ branches should include an issue number (e.g., issue/123-description)';\n  }\n\n  return null;\n}\n", "/**\n * Self-guard helpers for TypeScript hooks\n * Ported from hooks/_lib/common.sh guard functions\n *\n * Guards are predicates that determine if a hook should run.\n * They return `true` to run the hook, `false` to skip it.\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess } from './common.js';\n\n/**\n * Guard result type - either continue (null) or skip with result\n */\nexport type GuardResult = HookResult | null;\n\n/**\n * Create a guard that returns silent success if predicate fails\n */\nexport function createGuard(\n  predicate: (input: HookInput) => boolean\n): (input: HookInput) => GuardResult {\n  return (input: HookInput) => (predicate(input) ? null : outputSilentSuccess());\n}\n\n// -----------------------------------------------------------------------------\n// File Extension Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for specific file extensions\n */\nexport function guardFileExtension(\n  input: HookInput,\n  ...extensions: string[]\n): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  const ext = filePath.split('.').pop()?.toLowerCase() || '';\n  const normalizedExtensions = extensions.map((e) => e.toLowerCase().replace(/^\\./, ''));\n\n  if (normalizedExtensions.includes(ext)) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Only run for code files\n */\nexport function guardCodeFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'py', 'ts', 'tsx', 'js', 'jsx', 'go', 'rs', 'java');\n}\n\n/**\n * Guard: Only run for Python files\n */\nexport function guardPythonFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'py');\n}\n\n/**\n * Guard: Only run for TypeScript/JavaScript files\n */\nexport function guardTypescriptFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'ts', 'tsx', 'js', 'jsx');\n}\n\n// -----------------------------------------------------------------------------\n// Path Pattern Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for test files\n */\nexport function guardTestFiles(input: HookInput): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  const testPatterns = [/test/i, /spec/i, /__tests__/i];\n  if (testPatterns.some((p) => p.test(filePath))) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Skip internal/generated files\n */\nexport function guardSkipInternal(input: HookInput): GuardResult {\n  const filePath = input.tool_input.file_path || '';\n  if (!filePath) return null; // No file path, continue\n\n  // Skip these directories/patterns\n  const skipPatterns = [\n    /\\/\\.claude\\//,\n    /\\/node_modules\\//,\n    /\\/\\.git\\//,\n    /\\/dist\\//,\n    /\\/build\\//,\n    /\\/__pycache__\\//,\n    /\\/\\.venv\\//,\n    /\\/venv\\//,\n    /\\.lock$/,\n  ];\n\n  if (skipPatterns.some((p) => p.test(filePath))) {\n    return outputSilentSuccess();\n  }\n\n  return null; // Continue with hook\n}\n\n/**\n * Guard: Only run for files matching path patterns\n */\nexport function guardPathPattern(input: HookInput, ...patterns: (string | RegExp)[]): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  for (const pattern of patterns) {\n    if (typeof pattern === 'string') {\n      // Simple glob-like matching\n      const regex = new RegExp(pattern.replace(/\\*/g, '.*').replace(/\\?/g, '.'));\n      if (regex.test(filePath)) return null;\n    } else {\n      if (pattern.test(filePath)) return null;\n    }\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Tool Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for specific tool names\n */\nexport function guardTool(input: HookInput, ...tools: string[]): GuardResult {\n  const toolName = input.tool_name;\n  if (!toolName) return outputSilentSuccess();\n\n  if (tools.includes(toolName)) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Only run for Write or Edit tools\n */\nexport function guardWriteEdit(input: HookInput): GuardResult {\n  return guardTool(input, 'Write', 'Edit');\n}\n\n/**\n * Guard: Only run for Bash tool\n */\nexport function guardBash(input: HookInput): GuardResult {\n  return guardTool(input, 'Bash');\n}\n\n// -----------------------------------------------------------------------------\n// Command Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for non-trivial bash commands\n */\nexport function guardNontrivialBash(input: HookInput): GuardResult {\n  const command = input.tool_input.command || '';\n\n  // Skip trivial commands\n  const trivialPatterns = [\n    /^echo\\s/,\n    /^ls(\\s|$)/,\n    /^pwd$/,\n    /^cat\\s/,\n    /^head\\s/,\n    /^tail\\s/,\n    /^wc\\s/,\n    /^date$/,\n    /^whoami$/,\n  ];\n\n  if (trivialPatterns.some((p) => p.test(command))) {\n    return outputSilentSuccess();\n  }\n\n  return null; // Continue with hook\n}\n\n/**\n * Guard: Only run for git commands\n */\nexport function guardGitCommand(input: HookInput): GuardResult {\n  const command = input.tool_input.command || '';\n\n  if (command.startsWith('git')) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Environment Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run if multi-instance coordination is enabled\n */\nexport function guardMultiInstance(input: HookInput): GuardResult {\n  const projectDir = input.project_dir || process.env.CLAUDE_PROJECT_DIR || '.';\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  try {\n    const { existsSync } = require('node:fs');\n    if (existsSync(dbPath)) {\n      return null; // Continue with hook\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Composite Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Run multiple guards in sequence, return first skip result or null to continue\n */\nexport function runGuards(input: HookInput, ...guards: ((input: HookInput) => GuardResult)[]): GuardResult {\n  for (const guard of guards) {\n    const result = guard(input);\n    if (result !== null) {\n      return result; // Skip with this result\n    }\n  }\n  return null; // All guards passed, continue\n}\n", "/**\n * Orchestration Types - Shared type definitions for Agent Orchestration Layer\n * Issue #197: Agent Orchestration Layer with CC 2.1.16 Task Integration\n *\n * These types support:\n * - Intent classification with hybrid scoring\n * - Agent and skill matching\n * - CC 2.1.16 Task system integration\n * - Outcome-based calibration\n * - Multi-agent coordination\n */\n\n// -----------------------------------------------------------------------------\n// Confidence Thresholds\n// -----------------------------------------------------------------------------\n\nexport const THRESHOLDS = {\n  /** Auto-dispatch agent without confirmation */\n  AUTO_DISPATCH: 85,\n  /** Auto-inject skill content */\n  SKILL_INJECT: 80,\n  /** Strong recommendation shown to user */\n  STRONG_RECOMMEND: 70,\n  /** Suggestion shown to user */\n  SUGGEST: 50,\n  /** Minimum confidence to consider */\n  MINIMUM: 40,\n} as const;\n\n// -----------------------------------------------------------------------------\n// Intent Classification Types\n// -----------------------------------------------------------------------------\n\n/** Signal types used in intent classification */\nexport type SignalType =\n  | 'keyword'         // Direct keyword match\n  | 'phrase'          // Multi-word phrase match\n  | 'context'         // Context continuity from history\n  | 'cooccurrence'    // Learned keyword co-occurrence\n  | 'negation'        // Detected negation reducing confidence\n  | 'boost'           // Calibration boost from successful outcomes\n  | 'penalty';        // Calibration penalty from failures\n\n/** Individual signal contributing to classification */\nexport interface IntentSignal {\n  type: SignalType;\n  source: string;       // What triggered this signal\n  weight: number;       // Weight contribution (0-100)\n  matched: string;      // What was matched in the prompt\n}\n\n/** Match result for an agent */\nexport interface AgentMatch {\n  agent: string;\n  confidence: number;\n  description: string;\n  matchedKeywords: string[];\n  signals: IntentSignal[];\n}\n\n/** Match result for a skill */\nexport interface SkillMatch {\n  skill: string;\n  confidence: number;\n  description: string;\n  matchedKeywords: string[];\n  signals: IntentSignal[];\n}\n\n/** Result from intent classification */\nexport interface ClassificationResult {\n  /** Matching agents sorted by confidence */\n  agents: AgentMatch[];\n  /** Matching skills sorted by confidence */\n  skills: SkillMatch[];\n  /** Primary detected intent category */\n  intent: string;\n  /** Highest confidence score across all matches */\n  confidence: number;\n  /** All signals used in classification */\n  signals: IntentSignal[];\n  /** Whether this should trigger auto-dispatch */\n  shouldAutoDispatch: boolean;\n  /** Whether skills should be auto-injected */\n  shouldInjectSkills: boolean;\n}\n\n// -----------------------------------------------------------------------------\n// Orchestration State Types\n// -----------------------------------------------------------------------------\n\n/** Action to take based on classification */\nexport type OrchestrationAction =\n  | 'auto-dispatch'    // Immediately spawn agent\n  | 'inject-skill'     // Auto-load skill content\n  | 'strong-recommend' // Show strong recommendation\n  | 'suggest'          // Show suggestion\n  | 'none';            // No action needed\n\n/** State for a dispatched agent */\nexport interface DispatchedAgent {\n  agent: string;\n  taskId?: string;     // CC 2.1.16 task ID if created\n  confidence: number;\n  dispatchedAt: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'failed' | 'retrying';\n  retryCount: number;\n  maxRetries: number;\n}\n\n/** Current orchestration session state */\nexport interface OrchestrationState {\n  sessionId: string;\n  /** Active dispatched agents */\n  activeAgents: DispatchedAgent[];\n  /** Skills currently injected */\n  injectedSkills: string[];\n  /** Recent prompts for context continuity */\n  promptHistory: string[];\n  /** Max prompts to keep in history */\n  maxHistorySize: number;\n  /** Last classification result */\n  lastClassification?: ClassificationResult;\n  /** Timestamp of last update */\n  updatedAt: string;\n}\n\n// -----------------------------------------------------------------------------\n// CC 2.1.16 Task Integration Types\n// -----------------------------------------------------------------------------\n\n/** Metadata attached to tasks for orchestration */\nexport interface TaskMetadata {\n  /** Source of task creation */\n  source: 'orchestration' | 'user' | 'pipeline';\n  /** Agent that was dispatched */\n  dispatchedAgent?: string;\n  /** Classification confidence at dispatch time */\n  dispatchConfidence?: number;\n  /** Pipeline this task belongs to */\n  pipelineId?: string;\n  /** Step in pipeline sequence */\n  pipelineStep?: number;\n  /** Related skill names */\n  relatedSkills?: string[];\n  /** Signals that triggered dispatch */\n  dispatchSignals?: IntentSignal[];\n}\n\n/** Instruction to create a CC 2.1.16 task */\nexport interface TaskCreateInstruction {\n  subject: string;\n  description: string;\n  activeForm: string;\n  metadata: TaskMetadata;\n  /** Tasks this one is blocked by */\n  blockedBy?: string[];\n}\n\n/** Instruction to update a CC 2.1.16 task */\nexport interface TaskUpdateInstruction {\n  taskId: string;\n  status?: 'pending' | 'in_progress' | 'completed' | 'deleted';\n  addBlockedBy?: string[];\n  addBlocks?: string[];\n}\n\n// -----------------------------------------------------------------------------\n// Retry and Error Handling Types\n// -----------------------------------------------------------------------------\n\n/** Outcome of an agent execution */\nexport type AgentOutcome = 'success' | 'partial' | 'failure' | 'rejected';\n\n/** Decision on what to do after failure */\nexport interface RetryDecision {\n  shouldRetry: boolean;\n  retryCount: number;\n  maxRetries: number;\n  /** Alternative agent to suggest if giving up */\n  alternativeAgent?: string;\n  /** Reason for decision */\n  reason: string;\n  /** Delay before retry in ms */\n  delayMs?: number;\n}\n\n/** Record of an agent execution attempt */\nexport interface ExecutionAttempt {\n  agent: string;\n  taskId?: string;\n  attemptNumber: number;\n  startedAt: string;\n  completedAt?: string;\n  outcome?: AgentOutcome;\n  error?: string;\n  durationMs?: number;\n}\n\n// -----------------------------------------------------------------------------\n// Calibration Types\n// -----------------------------------------------------------------------------\n\n/** Record of a dispatched agent outcome for calibration */\nexport interface CalibrationRecord {\n  timestamp: string;\n  sessionId: string;\n  agent: string;\n  promptHash: string;        // Hash of triggering prompt\n  matchedKeywords: string[];\n  dispatchConfidence: number;\n  outcome: AgentOutcome;\n  durationMs?: number;\n  /** User feedback if any */\n  feedback?: 'positive' | 'negative' | 'neutral';\n}\n\n/** Learned adjustment for keyword/agent pairs */\nexport interface CalibrationAdjustment {\n  keyword: string;\n  agent: string;\n  /** Positive = boost, negative = penalty */\n  adjustment: number;\n  sampleCount: number;\n  lastUpdated: string;\n}\n\n/** Calibration data store */\nexport interface CalibrationData {\n  schemaVersion: string;\n  createdAt: string;\n  updatedAt: string;\n  records: CalibrationRecord[];\n  adjustments: CalibrationAdjustment[];\n  /** Summary stats for monitoring */\n  stats: {\n    totalDispatches: number;\n    successRate: number;\n    avgConfidence: number;\n    topAgents: Array<{ agent: string; count: number; successRate: number }>;\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Multi-Agent Pipeline Types\n// -----------------------------------------------------------------------------\n\n/** Known pipeline definitions */\nexport type PipelineType =\n  | 'product-thinking'\n  | 'full-stack-feature'\n  | 'ai-integration'\n  | 'security-audit'\n  | 'frontend-compliance'\n  | 'custom';\n\n/** Step in a multi-agent pipeline */\nexport interface PipelineStep {\n  agent: string;\n  description: string;\n  /** Task dependencies (step indices) */\n  dependsOn: number[];\n  /** Skills to inject for this step */\n  skills?: string[];\n  /** Estimated context tokens for this step */\n  estimatedTokens?: number;\n}\n\n/** Definition of a multi-agent pipeline */\nexport interface PipelineDefinition {\n  type: PipelineType;\n  name: string;\n  description: string;\n  /** Trigger patterns that activate this pipeline */\n  triggers: string[];\n  steps: PipelineStep[];\n  /** Total estimated tokens for full pipeline */\n  estimatedTotalTokens: number;\n}\n\n/** Active pipeline execution state */\nexport interface PipelineExecution {\n  pipelineId: string;\n  type: PipelineType;\n  startedAt: string;\n  /** Map of step index to task ID */\n  taskIds: Record<number, string>;\n  /** Current step being executed */\n  currentStep: number;\n  /** Completed steps */\n  completedSteps: number[];\n  status: 'running' | 'completed' | 'failed' | 'paused';\n}\n\n// -----------------------------------------------------------------------------\n// Configuration Types\n// -----------------------------------------------------------------------------\n\n/** Orchestration configuration */\nexport interface OrchestrationConfig {\n  /** Enable auto-dispatch at high confidence */\n  enableAutoDispatch: boolean;\n  /** Enable skill auto-injection */\n  enableSkillInjection: boolean;\n  /** Maximum tokens for skill injection */\n  maxSkillInjectionTokens: number;\n  /** Enable outcome calibration */\n  enableCalibration: boolean;\n  /** Enable pipeline detection */\n  enablePipelines: boolean;\n  /** Custom confidence thresholds */\n  thresholds?: Partial<typeof THRESHOLDS>;\n  /** Max retries for failed agents */\n  maxRetries: number;\n  /** Retry delay base in ms */\n  retryDelayBaseMs: number;\n}\n\n/** Default orchestration configuration */\nexport const DEFAULT_CONFIG: OrchestrationConfig = {\n  enableAutoDispatch: true,\n  enableSkillInjection: true,\n  maxSkillInjectionTokens: 800,\n  enableCalibration: true,\n  enablePipelines: true,\n  maxRetries: 3,\n  retryDelayBaseMs: 1000,\n};\n", "/**\n * Intent Classifier - Hybrid semantic+keyword scoring engine\n * Issue #197: Agent Orchestration Layer\n *\n * Scoring weights:\n * - Keyword matching: 30%\n * - Phrase pattern matching: 25%\n * - Context continuity: 20%\n * - Co-occurrence learning: 15%\n * - Negation detection: 10%\n *\n * Target: 85%+ accuracy vs ~60% regex baseline\n */\n\nimport { existsSync, readFileSync, readdirSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { getPluginRoot, logHook } from './common.js';\nimport {\n  THRESHOLDS,\n  type AgentMatch,\n  type SkillMatch,\n  type IntentSignal,\n  type ClassificationResult,\n  type CalibrationAdjustment,\n} from './orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// Constants and Weights\n// -----------------------------------------------------------------------------\n\n/** Scoring weights for signal types (must sum to 100) */\nconst SIGNAL_WEIGHTS = {\n  keyword: 30,\n  phrase: 25,\n  context: 20,\n  cooccurrence: 15,\n  negation: 10,\n} as const;\n\n/** Negation patterns that reduce confidence */\nconst NEGATION_PATTERNS = [\n  /\\b(not|don't|doesn't|won't|can't|shouldn't|avoid|without|except|unlike|instead of)\\s+/i,\n  /\\b(no|never|neither|nor)\\s+/i,\n];\n\n/** Context keywords that boost confidence when in history */\nconst CONTEXT_BOOST_KEYWORDS = [\n  'continue',\n  'also',\n  'additionally',\n  'and',\n  'then',\n  'next',\n  'follow up',\n  'after that',\n];\n\n// -----------------------------------------------------------------------------\n// Agent Index Cache\n// -----------------------------------------------------------------------------\n\ninterface AgentIndexEntry {\n  keywords: string[];\n  phrases: string[];\n  description: string;\n  skills?: string[];\n}\n\nlet agentIndex: Map<string, AgentIndexEntry> | null = null;\nlet agentIndexPath: string | null = null;\n\n/**\n * Build or get cached agent index from agents/ directory\n */\nfunction getAgentIndex(agentsDir: string): Map<string, AgentIndexEntry> {\n  // Return cache if path matches\n  if (agentIndex && agentIndexPath === agentsDir) {\n    return agentIndex;\n  }\n\n  const index = new Map<string, AgentIndexEntry>();\n\n  try {\n    const files = readdirSync(agentsDir).filter(f => f.endsWith('.md'));\n\n    for (const file of files) {\n      const agentName = file.replace('.md', '');\n      const filePath = join(agentsDir, file);\n\n      try {\n        const content = readFileSync(filePath, 'utf8');\n\n        // Extract frontmatter\n        const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n        if (!frontmatterMatch) continue;\n\n        const frontmatter = frontmatterMatch[1];\n\n        // Extract description\n        const descMatch = frontmatter.match(/^description:\\s*(.+)$/m);\n        if (!descMatch) continue;\n\n        const description = descMatch[1].trim();\n\n        // Extract \"Activates for\" keywords\n        const activatesMatch = description.match(/Activates for\\s+(.+?)\\.?$/i);\n\n        // Also check for keywords in description before \"Activates for\"\n        const descPart = activatesMatch\n          ? description.slice(0, description.indexOf('Activates for')).trim()\n          : description;\n\n        let keywords: string[] = [];\n        let phrases: string[] = [];\n\n        if (activatesMatch) {\n          const keywordsStr = activatesMatch[1];\n          const rawKeywords = keywordsStr.split(/,\\s*/).map(k => k.trim().toLowerCase());\n\n          // Separate phrases (multi-word) from single keywords\n          for (const kw of rawKeywords) {\n            if (kw.includes(' ') || kw.includes('-')) {\n              phrases.push(kw);\n            } else if (kw.length > 1) {\n              keywords.push(kw);\n            }\n          }\n        }\n\n        // Extract skills from frontmatter\n        const skillsMatch = frontmatter.match(/^skills:\\s*\\n((?:\\s+-\\s+.+\\n?)+)/m);\n        let skills: string[] | undefined;\n        if (skillsMatch) {\n          skills = skillsMatch[1]\n            .split('\\n')\n            .map(l => l.replace(/^\\s*-\\s*/, '').trim())\n            .filter(Boolean);\n        }\n\n        if (keywords.length > 0 || phrases.length > 0) {\n          index.set(agentName, {\n            keywords,\n            phrases,\n            description: descPart || description.split('.')[0],\n            skills,\n          });\n        }\n      } catch {\n        // Skip files that can't be read\n      }\n    }\n  } catch {\n    logHook('intent-classifier', 'Could not read agents directory');\n  }\n\n  agentIndex = index;\n  agentIndexPath = agentsDir;\n  return index;\n}\n\n// -----------------------------------------------------------------------------\n// Skill Index Cache\n// -----------------------------------------------------------------------------\n\ninterface SkillIndexEntry {\n  keywords: string[];\n  description: string;\n}\n\nlet skillIndex: Map<string, SkillIndexEntry> | null = null;\nlet skillIndexPath: string | null = null;\n\n/**\n * Build or get cached skill index from skills/ directory\n */\nfunction getSkillIndex(skillsDir: string): Map<string, SkillIndexEntry> {\n  if (skillIndex && skillIndexPath === skillsDir) {\n    return skillIndex;\n  }\n\n  const index = new Map<string, SkillIndexEntry>();\n\n  try {\n    const dirs = readdirSync(skillsDir, { withFileTypes: true })\n      .filter(d => d.isDirectory())\n      .map(d => d.name);\n\n    for (const skillName of dirs) {\n      const skillFile = join(skillsDir, skillName, 'SKILL.md');\n\n      if (!existsSync(skillFile)) continue;\n\n      try {\n        const content = readFileSync(skillFile, 'utf8');\n\n        // Extract frontmatter\n        const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n        if (!frontmatterMatch) continue;\n\n        const frontmatter = frontmatterMatch[1];\n\n        // Extract description\n        const descMatch = frontmatter.match(/^description:\\s*(.+)$/m);\n        const description = descMatch ? descMatch[1].trim() : '';\n\n        // Extract tags as keywords\n        const tagsMatch = frontmatter.match(/^tags:\\s*\\[([^\\]]+)\\]/m);\n        let keywords: string[] = [];\n\n        if (tagsMatch) {\n          keywords = tagsMatch[1]\n            .split(',')\n            .map(t => t.trim().toLowerCase().replace(/[\"']/g, ''))\n            .filter(t => t.length > 1);\n        }\n\n        // Also extract keywords from description\n        const descKeywords = description\n          .toLowerCase()\n          .split(/\\s+/)\n          .filter(w => w.length > 4)\n          .slice(0, 5);\n\n        keywords = [...new Set([...keywords, ...descKeywords])];\n\n        if (keywords.length > 0 || description) {\n          index.set(skillName, { keywords, description });\n        }\n      } catch {\n        // Skip files that can't be read\n      }\n    }\n  } catch {\n    logHook('intent-classifier', 'Could not read skills directory');\n  }\n\n  skillIndex = index;\n  skillIndexPath = skillsDir;\n  return index;\n}\n\n// -----------------------------------------------------------------------------\n// Classification Logic\n// -----------------------------------------------------------------------------\n\n/**\n * Calculate keyword match score for an agent\n */\nfunction calculateKeywordScore(\n  promptLower: string,\n  keywords: string[]\n): { score: number; matched: string[]; signals: IntentSignal[] } {\n  let score = 0;\n  const matched: string[] = [];\n  const signals: IntentSignal[] = [];\n\n  for (const keyword of keywords) {\n    // Check word boundary match\n    const regex = new RegExp(`\\\\b${keyword.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\b`, 'i');\n    if (regex.test(promptLower)) {\n      const weight = keyword.length > 5 ? 25 : 20; // Longer keywords are more specific\n      score += weight;\n      matched.push(keyword);\n      signals.push({\n        type: 'keyword',\n        source: 'keyword-match',\n        weight,\n        matched: keyword,\n      });\n    }\n  }\n\n  // Normalize to percentage of max possible\n  const maxScore = keywords.length * 25;\n  return {\n    score: maxScore > 0 ? Math.min((score / maxScore) * 100, 100) : 0,\n    matched,\n    signals,\n  };\n}\n\n/**\n * Calculate phrase match score (multi-word patterns)\n */\nfunction calculatePhraseScore(\n  promptLower: string,\n  phrases: string[]\n): { score: number; matched: string[]; signals: IntentSignal[] } {\n  let score = 0;\n  const matched: string[] = [];\n  const signals: IntentSignal[] = [];\n\n  for (const phrase of phrases) {\n    if (promptLower.includes(phrase)) {\n      const weight = phrase.split(/\\s+/).length * 15; // More words = higher weight\n      score += weight;\n      matched.push(phrase);\n      signals.push({\n        type: 'phrase',\n        source: 'phrase-match',\n        weight,\n        matched: phrase,\n      });\n    }\n  }\n\n  // Normalize to percentage of max possible\n  const maxScore = phrases.length * 45; // Assume avg 3 words per phrase\n  return {\n    score: maxScore > 0 ? Math.min((score / maxScore) * 100, 100) : 0,\n    matched,\n    signals,\n  };\n}\n\n/**\n * Calculate context continuity score from prompt history\n */\nfunction calculateContextScore(\n  promptLower: string,\n  keywords: string[],\n  history: string[]\n): { score: number; signals: IntentSignal[] } {\n  if (history.length === 0) {\n    return { score: 0, signals: [] };\n  }\n\n  const signals: IntentSignal[] = [];\n  let score = 0;\n\n  // Check for continuation keywords\n  for (const continuationWord of CONTEXT_BOOST_KEYWORDS) {\n    if (promptLower.includes(continuationWord)) {\n      score += 15;\n      signals.push({\n        type: 'context',\n        source: 'continuation-keyword',\n        weight: 15,\n        matched: continuationWord,\n      });\n      break; // Only count once\n    }\n  }\n\n  // Check if agent keywords appeared in recent history\n  const recentHistory = history.slice(-3).join(' ').toLowerCase();\n  for (const keyword of keywords.slice(0, 5)) {\n    if (recentHistory.includes(keyword)) {\n      score += 20;\n      signals.push({\n        type: 'context',\n        source: 'history-keyword',\n        weight: 20,\n        matched: keyword,\n      });\n    }\n  }\n\n  return { score: Math.min(score, 100), signals };\n}\n\n/**\n * Calculate negation penalty\n */\nfunction calculateNegationPenalty(prompt: string): { penalty: number; signals: IntentSignal[] } {\n  const signals: IntentSignal[] = [];\n  let penalty = 0;\n\n  for (const pattern of NEGATION_PATTERNS) {\n    if (pattern.test(prompt)) {\n      penalty = 25; // Significant penalty for negation\n      signals.push({\n        type: 'negation',\n        source: 'negation-detected',\n        weight: -25,\n        matched: prompt.match(pattern)?.[0] || 'negation',\n      });\n      break;\n    }\n  }\n\n  return { penalty, signals };\n}\n\n/**\n * Apply calibration adjustments to score\n */\nfunction applyCalibration(\n  agentName: string,\n  matchedKeywords: string[],\n  adjustments: CalibrationAdjustment[]\n): { adjustment: number; signals: IntentSignal[] } {\n  if (adjustments.length === 0) {\n    return { adjustment: 0, signals: [] };\n  }\n\n  let totalAdjustment = 0;\n  const signals: IntentSignal[] = [];\n\n  for (const adj of adjustments) {\n    if (adj.agent === agentName && matchedKeywords.includes(adj.keyword)) {\n      totalAdjustment += adj.adjustment;\n      signals.push({\n        type: adj.adjustment > 0 ? 'boost' : 'penalty',\n        source: 'calibration',\n        weight: adj.adjustment,\n        matched: `${adj.keyword}:${agentName}`,\n      });\n    }\n  }\n\n  return { adjustment: totalAdjustment, signals };\n}\n\n/**\n * Classify a single agent match\n */\nfunction classifyAgentMatch(\n  promptLower: string,\n  agentName: string,\n  entry: AgentIndexEntry,\n  history: string[],\n  adjustments: CalibrationAdjustment[]\n): AgentMatch | null {\n  const allSignals: IntentSignal[] = [];\n  const allMatched: string[] = [];\n\n  // 1. Keyword matching (30% weight)\n  const keywordResult = calculateKeywordScore(promptLower, entry.keywords);\n  allSignals.push(...keywordResult.signals);\n  allMatched.push(...keywordResult.matched);\n\n  // 2. Phrase matching (25% weight)\n  const phraseResult = calculatePhraseScore(promptLower, entry.phrases);\n  allSignals.push(...phraseResult.signals);\n  allMatched.push(...phraseResult.matched);\n\n  // 3. Context continuity (20% weight)\n  const contextResult = calculateContextScore(promptLower, entry.keywords, history);\n  allSignals.push(...contextResult.signals);\n\n  // 4. Negation detection (10% weight as penalty)\n  const negationResult = calculateNegationPenalty(promptLower);\n  allSignals.push(...negationResult.signals);\n\n  // 5. Calibration adjustments (applies to final score)\n  const calibrationResult = applyCalibration(agentName, allMatched, adjustments);\n  allSignals.push(...calibrationResult.signals);\n\n  // Calculate weighted score\n  let score =\n    keywordResult.score * (SIGNAL_WEIGHTS.keyword / 100) +\n    phraseResult.score * (SIGNAL_WEIGHTS.phrase / 100) +\n    contextResult.score * (SIGNAL_WEIGHTS.context / 100);\n\n  // Apply negation penalty\n  score -= negationResult.penalty * (SIGNAL_WEIGHTS.negation / 100);\n\n  // Apply calibration adjustment (up to +/-15 points)\n  score += Math.max(-15, Math.min(15, calibrationResult.adjustment));\n\n  // Ensure score is within bounds\n  score = Math.max(0, Math.min(100, score));\n\n  // Only return if above minimum threshold\n  if (score < THRESHOLDS.MINIMUM) {\n    return null;\n  }\n\n  return {\n    agent: agentName,\n    confidence: Math.round(score),\n    description: entry.description,\n    matchedKeywords: allMatched,\n    signals: allSignals,\n  };\n}\n\n/**\n * Classify skill match\n */\nfunction classifySkillMatch(\n  promptLower: string,\n  skillName: string,\n  entry: SkillIndexEntry\n): SkillMatch | null {\n  const signals: IntentSignal[] = [];\n  const matched: string[] = [];\n  let score = 0;\n\n  for (const keyword of entry.keywords) {\n    const regex = new RegExp(`\\\\b${keyword.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\b`, 'i');\n    if (regex.test(promptLower)) {\n      const weight = keyword.length > 5 ? 25 : 20;\n      score += weight;\n      matched.push(keyword);\n      signals.push({\n        type: 'keyword',\n        source: 'skill-keyword',\n        weight,\n        matched: keyword,\n      });\n    }\n  }\n\n  // Cap at 100\n  score = Math.min(score, 100);\n\n  if (score < THRESHOLDS.MINIMUM) {\n    return null;\n  }\n\n  return {\n    skill: skillName,\n    confidence: Math.round(score),\n    description: entry.description,\n    matchedKeywords: matched,\n    signals,\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Main Classification Function\n// -----------------------------------------------------------------------------\n\n/**\n * Classify user prompt intent and find matching agents/skills\n *\n * @param prompt - The user's input prompt\n * @param history - Recent prompt history for context continuity\n * @param adjustments - Calibration adjustments from outcome learning\n * @returns Classification result with agents, skills, and confidence\n */\nexport function classifyIntent(\n  prompt: string,\n  history: string[] = [],\n  adjustments: CalibrationAdjustment[] = []\n): ClassificationResult {\n  const pluginRoot = getPluginRoot();\n  const agentsDir = join(pluginRoot, 'agents');\n  const skillsDir = join(pluginRoot, 'skills');\n\n  const promptLower = prompt.toLowerCase();\n\n  const allSignals: IntentSignal[] = [];\n  const agentMatches: AgentMatch[] = [];\n  const skillMatches: SkillMatch[] = [];\n\n  // Classify agents\n  const agentIdx = getAgentIndex(agentsDir);\n  for (const [agentName, entry] of agentIdx) {\n    const match = classifyAgentMatch(\n      promptLower,\n      agentName,\n      entry,\n      history,\n      adjustments\n    );\n    if (match) {\n      agentMatches.push(match);\n      allSignals.push(...match.signals);\n    }\n  }\n\n  // Classify skills\n  const skillIdx = getSkillIndex(skillsDir);\n  for (const [skillName, entry] of skillIdx) {\n    const match = classifySkillMatch(promptLower, skillName, entry);\n    if (match) {\n      skillMatches.push(match);\n      allSignals.push(...match.signals);\n    }\n  }\n\n  // Sort by confidence\n  agentMatches.sort((a, b) => b.confidence - a.confidence);\n  skillMatches.sort((a, b) => b.confidence - a.confidence);\n\n  // Determine primary intent from top agent\n  const topAgent = agentMatches[0];\n  const intent = topAgent\n    ? categorizeIntent(topAgent.agent, topAgent.matchedKeywords)\n    : 'general';\n\n  const maxConfidence = Math.max(\n    topAgent?.confidence || 0,\n    skillMatches[0]?.confidence || 0\n  );\n\n  const shouldAutoDispatch =\n    topAgent !== undefined && topAgent.confidence >= THRESHOLDS.AUTO_DISPATCH;\n\n  const shouldInjectSkills =\n    skillMatches.length > 0 &&\n    skillMatches[0].confidence >= THRESHOLDS.SKILL_INJECT;\n\n  return {\n    agents: agentMatches.slice(0, 3), // Top 3\n    skills: skillMatches.slice(0, 5), // Top 5\n    intent,\n    confidence: maxConfidence,\n    signals: allSignals,\n    shouldAutoDispatch,\n    shouldInjectSkills,\n  };\n}\n\n/**\n * Categorize intent based on agent and keywords\n */\nfunction categorizeIntent(agent: string, keywords: string[]): string {\n  const categories: Record<string, string[]> = {\n    'api-design': ['api', 'endpoint', 'rest', 'graphql', 'route'],\n    'database': ['database', 'schema', 'migration', 'sql', 'query'],\n    'authentication': ['auth', 'login', 'jwt', 'oauth', 'session'],\n    'frontend': ['react', 'component', 'ui', 'form', 'state'],\n    'testing': ['test', 'coverage', 'mock', 'fixture', 'e2e'],\n    'devops': ['deploy', 'ci', 'cd', 'release', 'monitor'],\n    'ai-integration': ['llm', 'rag', 'embedding', 'langgraph', 'agent'],\n    'security': ['security', 'owasp', 'xss', 'injection', 'csrf'],\n  };\n\n  for (const [category, categoryKeywords] of Object.entries(categories)) {\n    for (const kw of keywords) {\n      if (categoryKeywords.includes(kw)) {\n        return category;\n      }\n    }\n  }\n\n  // Fallback to agent-based categorization\n  if (agent.includes('backend') || agent.includes('api')) return 'api-design';\n  if (agent.includes('frontend') || agent.includes('ui')) return 'frontend';\n  if (agent.includes('test')) return 'testing';\n  if (agent.includes('security')) return 'security';\n\n  return 'general';\n}\n\n/**\n * Quick check if prompt likely needs orchestration\n * Use this for fast filtering before full classification\n */\nexport function shouldClassify(prompt: string): boolean {\n  if (prompt.length < 10) return false;\n\n  // Skip meta questions about agents/skills\n  if (/what agents|list agents|available agents|what skills/i.test(prompt)) {\n    return false;\n  }\n\n  // Skip simple commands\n  if (/^(yes|no|ok|thanks|done|continue|stop)$/i.test(prompt.trim())) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Clear cached indices (useful for testing or when agents/skills change)\n */\nexport function clearCache(): void {\n  agentIndex = null;\n  agentIndexPath = null;\n  skillIndex = null;\n  skillIndexPath = null;\n}\n", "/**\n * Orchestration State - Session state management for agent orchestration\n * Issue #197: Agent Orchestration Layer\n *\n * Manages:\n * - Active dispatched agents\n * - Injected skills tracking\n * - Prompt history for context continuity\n * - State persistence across hook invocations\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { getProjectDir, getSessionId, logHook } from './common.js';\nimport type {\n  OrchestrationState,\n  DispatchedAgent,\n  OrchestrationConfig,\n  ClassificationResult,\n} from './orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// State File Management\n// -----------------------------------------------------------------------------\n\nfunction getStateDir(): string {\n  return `${getProjectDir()}/.claude/orchestration`;\n}\n\nfunction getStateFile(): string {\n  const sessionId = getSessionId();\n  return `${getStateDir()}/session-${sessionId}.json`;\n}\n\nfunction getConfigFile(): string {\n  return `${getProjectDir()}/.claude/orchestration/config.json`;\n}\n\n/**\n * Ensure state directory exists\n */\nfunction ensureStateDir(): void {\n  const dir = getStateDir();\n  if (!existsSync(dir)) {\n    try {\n      mkdirSync(dir, { recursive: true });\n    } catch {\n      logHook('orchestration-state', `Failed to create state dir: ${dir}`);\n    }\n  }\n}\n\n// -----------------------------------------------------------------------------\n// State Operations\n// -----------------------------------------------------------------------------\n\n/**\n * Load orchestration state for current session\n */\nexport function loadState(): OrchestrationState {\n  const stateFile = getStateFile();\n\n  if (existsSync(stateFile)) {\n    try {\n      const data = readFileSync(stateFile, 'utf8');\n      return JSON.parse(data) as OrchestrationState;\n    } catch (err) {\n      logHook('orchestration-state', `Failed to load state: ${err}`);\n    }\n  }\n\n  // Return default state\n  return {\n    sessionId: getSessionId(),\n    activeAgents: [],\n    injectedSkills: [],\n    promptHistory: [],\n    maxHistorySize: 10,\n    updatedAt: new Date().toISOString(),\n  };\n}\n\n/**\n * Save orchestration state\n */\nexport function saveState(state: OrchestrationState): void {\n  ensureStateDir();\n  const stateFile = getStateFile();\n\n  state.updatedAt = new Date().toISOString();\n\n  try {\n    writeFileSync(stateFile, JSON.stringify(state, null, 2));\n  } catch (err) {\n    logHook('orchestration-state', `Failed to save state: ${err}`);\n  }\n}\n\n/**\n * Update state with a mutation function\n */\nexport function updateState(\n  mutate: (state: OrchestrationState) => void\n): OrchestrationState {\n  const state = loadState();\n  mutate(state);\n  saveState(state);\n  return state;\n}\n\n// -----------------------------------------------------------------------------\n// Agent Tracking\n// -----------------------------------------------------------------------------\n\n/**\n * Add a dispatched agent to state\n */\nexport function trackDispatchedAgent(\n  agent: string,\n  confidence: number,\n  taskId?: string\n): DispatchedAgent {\n  const dispatched: DispatchedAgent = {\n    agent,\n    taskId,\n    confidence,\n    dispatchedAt: new Date().toISOString(),\n    status: 'pending',\n    retryCount: 0,\n    maxRetries: 3,\n  };\n\n  updateState(state => {\n    // Remove any existing entry for same agent\n    state.activeAgents = state.activeAgents.filter(a => a.agent !== agent);\n    state.activeAgents.push(dispatched);\n  });\n\n  logHook('orchestration-state', `Tracked dispatched agent: ${agent} (conf: ${confidence})`);\n  return dispatched;\n}\n\n/**\n * Update agent status\n */\nexport function updateAgentStatus(\n  agent: string,\n  status: DispatchedAgent['status'],\n  taskId?: string\n): void {\n  updateState(state => {\n    const entry = state.activeAgents.find(a => a.agent === agent);\n    if (entry) {\n      entry.status = status;\n      if (taskId) entry.taskId = taskId;\n      if (status === 'retrying') entry.retryCount++;\n    }\n  });\n\n  logHook('orchestration-state', `Updated agent status: ${agent} -> ${status}`);\n}\n\n/**\n * Remove completed/failed agent from tracking\n */\nexport function removeAgent(agent: string): void {\n  updateState(state => {\n    state.activeAgents = state.activeAgents.filter(a => a.agent !== agent);\n  });\n}\n\n/**\n * Get currently active agent (if any)\n */\nexport function getActiveAgent(): DispatchedAgent | undefined {\n  const state = loadState();\n  return state.activeAgents.find(a => a.status === 'in_progress');\n}\n\n/**\n * Check if an agent is currently dispatched\n */\nexport function isAgentDispatched(agent: string): boolean {\n  const state = loadState();\n  return state.activeAgents.some(\n    a => a.agent === agent && (a.status === 'pending' || a.status === 'in_progress')\n  );\n}\n\n// -----------------------------------------------------------------------------\n// Skill Tracking\n// -----------------------------------------------------------------------------\n\n/**\n * Track injected skill\n */\nexport function trackInjectedSkill(skill: string): void {\n  updateState(state => {\n    if (!state.injectedSkills.includes(skill)) {\n      state.injectedSkills.push(skill);\n    }\n  });\n}\n\n/**\n * Check if skill was already injected\n */\nexport function isSkillInjected(skill: string): boolean {\n  const state = loadState();\n  return state.injectedSkills.includes(skill);\n}\n\n/**\n * Get all injected skills\n */\nexport function getInjectedSkills(): string[] {\n  return loadState().injectedSkills;\n}\n\n// -----------------------------------------------------------------------------\n// Prompt History\n// -----------------------------------------------------------------------------\n\n/**\n * Add prompt to history (for context continuity)\n */\nexport function addToPromptHistory(prompt: string): void {\n  updateState(state => {\n    state.promptHistory.push(prompt);\n    // Trim to max size\n    if (state.promptHistory.length > state.maxHistorySize) {\n      state.promptHistory = state.promptHistory.slice(-state.maxHistorySize);\n    }\n  });\n}\n\n/**\n * Get recent prompt history\n */\nexport function getPromptHistory(): string[] {\n  return loadState().promptHistory;\n}\n\n// -----------------------------------------------------------------------------\n// Classification Caching\n// -----------------------------------------------------------------------------\n\n/**\n * Store last classification result\n */\nexport function cacheClassification(result: ClassificationResult): void {\n  updateState(state => {\n    state.lastClassification = result;\n  });\n}\n\n/**\n * Get last classification result\n */\nexport function getLastClassification(): ClassificationResult | undefined {\n  return loadState().lastClassification;\n}\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst DEFAULT_CONFIG_VALUES: OrchestrationConfig = {\n  enableAutoDispatch: true,\n  enableSkillInjection: true,\n  maxSkillInjectionTokens: 800,\n  enableCalibration: true,\n  enablePipelines: true,\n  maxRetries: 3,\n  retryDelayBaseMs: 1000,\n};\n\n/**\n * Load orchestration configuration\n */\nexport function loadConfig(): OrchestrationConfig {\n  const configFile = getConfigFile();\n\n  if (existsSync(configFile)) {\n    try {\n      const data = readFileSync(configFile, 'utf8');\n      return { ...DEFAULT_CONFIG_VALUES, ...JSON.parse(data) };\n    } catch {\n      // Return defaults on error\n    }\n  }\n\n  return DEFAULT_CONFIG_VALUES;\n}\n\n/**\n * Save orchestration configuration\n */\nexport function saveConfig(config: Partial<OrchestrationConfig>): void {\n  ensureStateDir();\n  const configFile = getConfigFile();\n  const current = loadConfig();\n  const merged = { ...current, ...config };\n\n  try {\n    writeFileSync(configFile, JSON.stringify(merged, null, 2));\n  } catch (err) {\n    logHook('orchestration-state', `Failed to save config: ${err}`);\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Cleanup\n// -----------------------------------------------------------------------------\n\n/**\n * Clear session state (called on session end)\n */\nexport function clearSessionState(): void {\n  const stateFile = getStateFile();\n\n  try {\n    if (existsSync(stateFile)) {\n      const { unlinkSync } = require('node:fs');\n      unlinkSync(stateFile);\n      logHook('orchestration-state', 'Cleared session state');\n    }\n  } catch {\n    // Ignore cleanup errors\n  }\n}\n\n/**\n * Clean up old state files (keep last 5 sessions)\n */\nexport function cleanupOldStates(): void {\n  const dir = getStateDir();\n\n  if (!existsSync(dir)) return;\n\n  try {\n    const { readdirSync, statSync, unlinkSync } = require('node:fs');\n    const files = readdirSync(dir)\n      .filter((f: string) => f.startsWith('session-') && f.endsWith('.json'))\n      .map((f: string) => ({\n        name: f,\n        path: `${dir}/${f}`,\n        mtime: statSync(`${dir}/${f}`).mtime.getTime(),\n      }))\n      .sort((a: { mtime: number }, b: { mtime: number }) => b.mtime - a.mtime);\n\n    // Keep only last 5\n    for (const file of files.slice(5)) {\n      try {\n        unlinkSync(file.path);\n        logHook('orchestration-state', `Cleaned up old state: ${file.name}`);\n      } catch {\n        // Ignore\n      }\n    }\n  } catch {\n    // Ignore cleanup errors\n  }\n}\n", "/**\n * Task Integration - Bridge to CC 2.1.16 Task Management System\n * Issue #197: Agent Orchestration Layer\n *\n * Provides utilities for:\n * - Generating task creation instructions\n * - Tracking task-to-agent relationships\n * - Managing task state for orchestration\n *\n * Note: This module generates INSTRUCTIONS for Claude to execute\n * task operations, as hooks cannot directly call CC tools.\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { getProjectDir, getSessionId, logHook } from './common.js';\nimport type {\n  TaskCreateInstruction,\n  TaskUpdateInstruction,\n  TaskMetadata,\n  PipelineExecution,\n} from './orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\n/** Task tracking entry stored locally */\ninterface TaskEntry {\n  taskId: string;\n  agent: string;\n  confidence: number;\n  createdAt: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'failed';\n  pipelineId?: string;\n  pipelineStep?: number;\n  blockedBy?: string[];\n  blocks?: string[];\n}\n\n/** Task registry for session */\ninterface TaskRegistry {\n  schemaVersion: string;\n  sessionId: string;\n  tasks: TaskEntry[];\n  pipelines: PipelineExecution[];\n  updatedAt: string;\n}\n\n// -----------------------------------------------------------------------------\n// Registry File Management\n// -----------------------------------------------------------------------------\n\nfunction getRegistryFile(): string {\n  const sessionId = getSessionId();\n  return `${getProjectDir()}/.claude/orchestration/task-registry-${sessionId}.json`;\n}\n\nfunction ensureDir(): void {\n  const dir = `${getProjectDir()}/.claude/orchestration`;\n  if (!existsSync(dir)) {\n    try {\n      mkdirSync(dir, { recursive: true });\n    } catch {\n      // Ignore\n    }\n  }\n}\n\nfunction loadRegistry(): TaskRegistry {\n  const file = getRegistryFile();\n\n  if (existsSync(file)) {\n    try {\n      return JSON.parse(readFileSync(file, 'utf8'));\n    } catch {\n      // Return default on error\n    }\n  }\n\n  return {\n    schemaVersion: '1.0.0',\n    sessionId: getSessionId(),\n    tasks: [],\n    pipelines: [],\n    updatedAt: new Date().toISOString(),\n  };\n}\n\nfunction saveRegistry(registry: TaskRegistry): void {\n  ensureDir();\n  const file = getRegistryFile();\n  registry.updatedAt = new Date().toISOString();\n\n  try {\n    writeFileSync(file, JSON.stringify(registry, null, 2));\n  } catch (err) {\n    logHook('task-integration', `Failed to save registry: ${err}`);\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Task Instructions Generators\n// -----------------------------------------------------------------------------\n\n/**\n * Get action-specific activeForm based on agent type\n */\nfunction getActiveFormForAgent(agent: string, description: string): string {\n  const actionMap: Record<string, string> = {\n    'backend-system-architect': 'Designing',\n    'frontend-ui-developer': 'Building',\n    'test-generator': 'Writing tests for',\n    'security-auditor': 'Auditing',\n    'workflow-architect': 'Architecting',\n    'database-engineer': 'Implementing database for',\n    'llm-integrator': 'Integrating LLM for',\n    'code-quality-reviewer': 'Reviewing',\n    'ux-researcher': 'Researching UX for',\n    'product-strategist': 'Strategizing',\n    'debug-investigator': 'Investigating',\n    'performance-engineer': 'Optimizing',\n    'accessibility-specialist': 'Auditing accessibility for',\n    'infrastructure-architect': 'Designing infrastructure for',\n    'data-pipeline-engineer': 'Building pipeline for',\n  };\n\n  const action = actionMap[agent] || 'Working on';\n  const shortDesc = description.slice(0, 40).toLowerCase();\n  return `${action} ${shortDesc}`;\n}\n\n/**\n * Generate TaskCreate instruction for an agent dispatch\n */\nexport function generateTaskCreateInstruction(\n  agent: string,\n  description: string,\n  confidence: number,\n  metadata?: Partial<TaskMetadata>\n): TaskCreateInstruction {\n  const agentTitle = agent\n    .split('-')\n    .map(w => w.charAt(0).toUpperCase() + w.slice(1))\n    .join(' ');\n\n  const fullMetadata: TaskMetadata = {\n    source: 'orchestration',\n    dispatchedAgent: agent,\n    dispatchConfidence: confidence,\n    ...metadata,\n  };\n\n  return {\n    subject: `${agentTitle}: ${description.slice(0, 50)}`,\n    description: `Agent dispatched automatically at ${confidence}% confidence.\\n\\n${description}`,\n    activeForm: getActiveFormForAgent(agent, description),\n    metadata: fullMetadata,\n  };\n}\n\n/**\n * Generate TaskUpdate instruction for status change\n */\nexport function generateTaskUpdateInstruction(\n  taskId: string,\n  status: 'pending' | 'in_progress' | 'completed' | 'deleted',\n  blockedBy?: string[],\n  blocks?: string[]\n): TaskUpdateInstruction {\n  const instruction: TaskUpdateInstruction = {\n    taskId,\n    status,\n  };\n\n  if (blockedBy && blockedBy.length > 0) {\n    instruction.addBlockedBy = blockedBy;\n  }\n\n  if (blocks && blocks.length > 0) {\n    instruction.addBlocks = blocks;\n  }\n\n  return instruction;\n}\n\n/**\n * Format TaskCreate instruction as markdown for Claude\n */\nexport function formatTaskCreateForClaude(instruction: TaskCreateInstruction): string {\n  return `### Create Task for Tracking\n\n\\`\\`\\`\nTaskCreate:\n  subject: \"${instruction.subject}\"\n  description: \"${instruction.description}\"\n  activeForm: \"${instruction.activeForm}\"\n  metadata:\n    source: \"${instruction.metadata.source}\"\n    dispatchedAgent: \"${instruction.metadata.dispatchedAgent || ''}\"\n    dispatchConfidence: ${instruction.metadata.dispatchConfidence || 0}\n\\`\\`\\``;\n}\n\n/**\n * Generate TaskUpdate instruction for task deletion (CC 2.1.20)\n */\nexport function generateTaskDeleteInstruction(\n  taskId: string,\n  _reason: string\n): TaskUpdateInstruction {\n  return {\n    taskId,\n    status: 'deleted',\n  };\n}\n\n/**\n * Format TaskDelete instruction as markdown for Claude (CC 2.1.20)\n */\nexport function formatTaskDeleteForClaude(taskId: string, reason: string): string {\n  return `### Delete Orphaned Task\n\n\\`\\`\\`\nTaskUpdate:\n  taskId: \"${taskId}\"\n  status: \"deleted\"\n\\`\\`\\`\n\n**Reason**: ${reason}`;\n}\n\n/**\n * Format TaskUpdate instruction as markdown for Claude\n */\nexport function formatTaskUpdateForClaude(instruction: TaskUpdateInstruction): string {\n  let md = `### Update Task\n\n\\`\\`\\`\nTaskUpdate:\n  taskId: \"${instruction.taskId}\"`;\n\n  if (instruction.status) {\n    md += `\\n  status: \"${instruction.status}\"`;\n  }\n\n  if (instruction.addBlockedBy && instruction.addBlockedBy.length > 0) {\n    md += `\\n  addBlockedBy: ${JSON.stringify(instruction.addBlockedBy)}`;\n  }\n\n  if (instruction.addBlocks && instruction.addBlocks.length > 0) {\n    md += `\\n  addBlocks: ${JSON.stringify(instruction.addBlocks)}`;\n  }\n\n  md += '\\n```';\n  return md;\n}\n\n// -----------------------------------------------------------------------------\n// Task Tracking Operations\n// -----------------------------------------------------------------------------\n\n/**\n * Register a new task for an agent\n */\nexport function registerTask(\n  taskId: string,\n  agent: string,\n  confidence: number,\n  pipelineId?: string,\n  pipelineStep?: number,\n  blockedBy?: string[],\n  blocks?: string[]\n): void {\n  const registry = loadRegistry();\n\n  // Check for duplicate\n  const existing = registry.tasks.find(t => t.taskId === taskId);\n  if (existing) {\n    logHook('task-integration', `Task ${taskId} already registered`);\n    return;\n  }\n\n  registry.tasks.push({\n    taskId,\n    agent,\n    confidence,\n    createdAt: new Date().toISOString(),\n    status: 'pending',\n    pipelineId,\n    pipelineStep,\n    blockedBy,\n    blocks,\n  });\n\n  saveRegistry(registry);\n  logHook('task-integration', `Registered task ${taskId} for agent ${agent}`);\n}\n\n/**\n * Update task status in registry\n */\nexport function updateTaskStatus(\n  taskId: string,\n  status: TaskEntry['status']\n): void {\n  const registry = loadRegistry();\n\n  const task = registry.tasks.find(t => t.taskId === taskId);\n  if (task) {\n    task.status = status;\n    saveRegistry(registry);\n    logHook('task-integration', `Updated task ${taskId} status to ${status}`);\n  }\n}\n\n/**\n * Get task by agent name\n */\nexport function getTaskByAgent(agent: string): TaskEntry | undefined {\n  const registry = loadRegistry();\n  return registry.tasks.find(\n    t => t.agent === agent && (t.status === 'pending' || t.status === 'in_progress')\n  );\n}\n\n/**\n * Get task by ID\n */\nexport function getTaskById(taskId: string): TaskEntry | undefined {\n  const registry = loadRegistry();\n  return registry.tasks.find(t => t.taskId === taskId);\n}\n\n/**\n * Get pending tasks blocked by a specific failed task (CC 2.1.20)\n */\nexport function getTasksBlockedBy(failedTaskId: string): TaskEntry[] {\n  const registry = loadRegistry();\n  return registry.tasks.filter(\n    t =>\n      t.status === 'pending' &&\n      t.blockedBy &&\n      t.blockedBy.includes(failedTaskId)\n  );\n}\n\n/**\n * Get orphaned tasks - pending tasks where all blockers have failed (CC 2.1.20)\n */\nexport function getOrphanedTasks(): TaskEntry[] {\n  const registry = loadRegistry();\n  const failedIds = new Set(\n    registry.tasks.filter(t => t.status === 'failed').map(t => t.taskId)\n  );\n\n  if (failedIds.size === 0) return [];\n\n  return registry.tasks.filter(t => {\n    if (t.status !== 'pending' || !t.blockedBy || t.blockedBy.length === 0) {\n      return false;\n    }\n    // Orphaned if ALL blockers are failed\n    return t.blockedBy.every(id => failedIds.has(id));\n  });\n}\n\n/**\n * Get all tasks for a pipeline\n */\nexport function getPipelineTasks(pipelineId: string): TaskEntry[] {\n  const registry = loadRegistry();\n  return registry.tasks\n    .filter(t => t.pipelineId === pipelineId)\n    .sort((a, b) => (a.pipelineStep || 0) - (b.pipelineStep || 0));\n}\n\n// -----------------------------------------------------------------------------\n// Pipeline Operations\n// -----------------------------------------------------------------------------\n\n/**\n * Register a pipeline execution\n */\nexport function registerPipeline(pipeline: PipelineExecution): void {\n  const registry = loadRegistry();\n\n  // Check for duplicate\n  const existing = registry.pipelines.find(p => p.pipelineId === pipeline.pipelineId);\n  if (existing) {\n    logHook('task-integration', `Pipeline ${pipeline.pipelineId} already registered`);\n    return;\n  }\n\n  registry.pipelines.push(pipeline);\n  saveRegistry(registry);\n  logHook('task-integration', `Registered pipeline ${pipeline.pipelineId} (${pipeline.type})`);\n}\n\n/**\n * Update pipeline state\n */\nexport function updatePipeline(\n  pipelineId: string,\n  updates: Partial<PipelineExecution>\n): void {\n  const registry = loadRegistry();\n\n  const pipeline = registry.pipelines.find(p => p.pipelineId === pipelineId);\n  if (pipeline) {\n    Object.assign(pipeline, updates);\n    saveRegistry(registry);\n    logHook('task-integration', `Updated pipeline ${pipelineId}`);\n  }\n}\n\n/**\n * Get active pipeline (if any)\n */\nexport function getActivePipeline(): PipelineExecution | undefined {\n  const registry = loadRegistry();\n  return registry.pipelines.find(p => p.status === 'running');\n}\n\n/**\n * Mark pipeline step complete and check for next\n */\nexport function completePipelineStep(pipelineId: string, step: number): number | null {\n  const registry = loadRegistry();\n\n  const pipeline = registry.pipelines.find(p => p.pipelineId === pipelineId);\n  if (!pipeline) return null;\n\n  if (!pipeline.completedSteps.includes(step)) {\n    pipeline.completedSteps.push(step);\n    pipeline.completedSteps.sort((a, b) => a - b);\n  }\n\n  // Find next unblocked step\n  const tasks = getPipelineTasks(pipelineId);\n  for (const task of tasks) {\n    const taskStep = task.pipelineStep;\n    if (taskStep === undefined) continue;\n    if (pipeline.completedSteps.includes(taskStep)) continue;\n    if (task.status !== 'pending') continue;\n\n    // Check if dependencies are met\n    // For now, assume sequential - previous steps must be complete\n    const prevStepsComplete = taskStep === 0 ||\n      pipeline.completedSteps.includes(taskStep - 1);\n\n    if (prevStepsComplete) {\n      pipeline.currentStep = taskStep;\n      saveRegistry(registry);\n      return taskStep;\n    }\n  }\n\n  // No more steps - pipeline complete\n  pipeline.status = 'completed';\n  saveRegistry(registry);\n  return null;\n}\n\n// -----------------------------------------------------------------------------\n// Cleanup\n// -----------------------------------------------------------------------------\n\n/**\n * Clean up completed tasks older than threshold\n */\nexport function cleanupOldTasks(maxAgeMs: number = 24 * 60 * 60 * 1000): void {\n  const registry = loadRegistry();\n  const cutoff = Date.now() - maxAgeMs;\n\n  registry.tasks = registry.tasks.filter(t => {\n    if (t.status === 'pending' || t.status === 'in_progress') return true;\n    const taskTime = new Date(t.createdAt).getTime();\n    return taskTime > cutoff;\n  });\n\n  registry.pipelines = registry.pipelines.filter(p => {\n    if (p.status === 'running') return true;\n    const pipelineTime = new Date(p.startedAt).getTime();\n    return pipelineTime > cutoff;\n  });\n\n  saveRegistry(registry);\n}\n", "/**\n * Retry Manager - Intelligent retry decisions for failed agents\n * Issue #197: Agent Orchestration Layer\n *\n * Provides:\n * - Exponential backoff retry logic\n * - Alternative agent suggestions\n * - Failure pattern detection\n * - Max retry limits\n */\n\nimport { logHook } from './common.js';\nimport type {\n  RetryDecision,\n  ExecutionAttempt,\n  AgentOutcome,\n  DispatchedAgent,\n} from './orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\nconst DEFAULT_MAX_RETRIES = 3;\nconst DEFAULT_BASE_DELAY_MS = 1000;\nconst MAX_DELAY_MS = 30000;\n\n/** Alternative agent mappings for common failure scenarios */\nconst ALTERNATIVE_AGENTS: Record<string, string[]> = {\n  // If backend architect fails, try these\n  'backend-system-architect': ['database-engineer', 'api-designer'],\n  // If frontend fails, try UI designer first\n  'frontend-ui-developer': ['rapid-ui-designer', 'accessibility-specialist'],\n  // If test generator fails, try debug investigator\n  'test-generator': ['debug-investigator', 'code-quality-reviewer'],\n  // If security auditor fails, try layer auditor\n  'security-auditor': ['security-layer-auditor'],\n  // If workflow architect fails, try LLM integrator\n  'workflow-architect': ['llm-integrator', 'data-pipeline-engineer'],\n};\n\n/** Error patterns that indicate retry is unlikely to help */\nconst NON_RETRYABLE_ERRORS = [\n  /permission denied/i,\n  /access denied/i,\n  /not found.*(?:file|module|package)/i,\n  /(?:file|module|package)\\s+not\\s+found/i,\n  /missing required/i,\n  /invalid (?:api|token|key)/i,\n  /authentication failed/i,\n  /quota exceeded/i,\n  /rate limit/i,\n];\n\n/** Error patterns that suggest trying an alternative agent */\nconst ALTERNATIVE_SUGGESTING_ERRORS = [\n  /not my specialization/i,\n  /outside my scope/i,\n  /better suited for/i,\n  /consider using/i,\n  /specialized agent/i,\n];\n\n// -----------------------------------------------------------------------------\n// Retry Logic\n// -----------------------------------------------------------------------------\n\n/**\n * Calculate exponential backoff delay\n */\nexport function calculateBackoffDelay(\n  attemptNumber: number,\n  baseDelayMs: number = DEFAULT_BASE_DELAY_MS\n): number {\n  // Exponential backoff with jitter\n  const exponentialDelay = baseDelayMs * Math.pow(2, attemptNumber - 1);\n  const jitter = Math.random() * 0.1 * exponentialDelay; // 10% jitter\n  return Math.min(exponentialDelay + jitter, MAX_DELAY_MS);\n}\n\n/**\n * Check if error is retryable\n */\nexport function isRetryableError(error: string): boolean {\n  for (const pattern of NON_RETRYABLE_ERRORS) {\n    if (pattern.test(error)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Check if error suggests alternative agent\n */\nexport function suggestsAlternative(error: string): boolean {\n  for (const pattern of ALTERNATIVE_SUGGESTING_ERRORS) {\n    if (pattern.test(error)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get alternative agent for a given agent\n */\nexport function getAlternativeAgent(agent: string, triedAgents: string[] = []): string | undefined {\n  const alternatives = ALTERNATIVE_AGENTS[agent];\n  if (!alternatives) return undefined;\n\n  // Return first alternative not yet tried\n  for (const alt of alternatives) {\n    if (!triedAgents.includes(alt)) {\n      return alt;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Make retry decision based on execution history and error\n */\nexport function makeRetryDecision(\n  agent: string,\n  attemptNumber: number,\n  error: string,\n  triedAgents: string[] = [],\n  maxRetries: number = DEFAULT_MAX_RETRIES\n): RetryDecision {\n  logHook('retry-manager', `Evaluating retry for ${agent}, attempt ${attemptNumber}`);\n\n  // Check if max retries exceeded\n  if (attemptNumber >= maxRetries) {\n    const alternative = getAlternativeAgent(agent, triedAgents);\n    return {\n      shouldRetry: false,\n      retryCount: attemptNumber,\n      maxRetries,\n      alternativeAgent: alternative,\n      reason: `Max retries (${maxRetries}) exceeded` +\n        (alternative ? `. Consider trying ${alternative} instead.` : ''),\n    };\n  }\n\n  // Check if error is retryable\n  if (!isRetryableError(error)) {\n    const alternative = getAlternativeAgent(agent, triedAgents);\n    return {\n      shouldRetry: false,\n      retryCount: attemptNumber,\n      maxRetries,\n      alternativeAgent: alternative,\n      reason: `Non-retryable error detected: ${error.slice(0, 100)}`,\n    };\n  }\n\n  // Check if error suggests alternative agent\n  if (suggestsAlternative(error)) {\n    const alternative = getAlternativeAgent(agent, triedAgents);\n    if (alternative) {\n      return {\n        shouldRetry: false,\n        retryCount: attemptNumber,\n        maxRetries,\n        alternativeAgent: alternative,\n        reason: `Error suggests using alternative agent: ${alternative}`,\n      };\n    }\n  }\n\n  // Retry with backoff\n  const delayMs = calculateBackoffDelay(attemptNumber);\n  return {\n    shouldRetry: true,\n    retryCount: attemptNumber,\n    maxRetries,\n    delayMs,\n    reason: `Retrying (attempt ${attemptNumber + 1}/${maxRetries}) after ${Math.round(delayMs / 1000)}s`,\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Execution Tracking\n// -----------------------------------------------------------------------------\n\n/**\n * Create execution attempt record\n */\nexport function createAttempt(\n  agent: string,\n  attemptNumber: number,\n  taskId?: string\n): ExecutionAttempt {\n  return {\n    agent,\n    taskId,\n    attemptNumber,\n    startedAt: new Date().toISOString(),\n  };\n}\n\n/**\n * Complete execution attempt with outcome\n */\nexport function completeAttempt(\n  attempt: ExecutionAttempt,\n  outcome: AgentOutcome,\n  error?: string\n): ExecutionAttempt {\n  const completedAt = new Date().toISOString();\n  const durationMs = new Date(completedAt).getTime() - new Date(attempt.startedAt).getTime();\n\n  return {\n    ...attempt,\n    completedAt,\n    outcome,\n    error,\n    durationMs,\n  };\n}\n\n/**\n * Analyze execution history for patterns\n */\nexport function analyzeAttemptHistory(attempts: ExecutionAttempt[]): {\n  successRate: number;\n  avgDuration: number;\n  commonErrors: string[];\n} {\n  if (attempts.length === 0) {\n    return { successRate: 0, avgDuration: 0, commonErrors: [] };\n  }\n\n  const successful = attempts.filter(a => a.outcome === 'success').length;\n  const successRate = successful / attempts.length;\n\n  const durations = attempts\n    .filter(a => a.durationMs !== undefined)\n    .map(a => a.durationMs!);\n  const avgDuration = durations.length > 0\n    ? durations.reduce((a, b) => a + b, 0) / durations.length\n    : 0;\n\n  // Count error patterns\n  const errorCounts = new Map<string, number>();\n  for (const attempt of attempts) {\n    if (attempt.error) {\n      // Normalize error to first 50 chars\n      const normalized = attempt.error.slice(0, 50).toLowerCase();\n      errorCounts.set(normalized, (errorCounts.get(normalized) || 0) + 1);\n    }\n  }\n\n  // Get most common errors\n  const commonErrors = Array.from(errorCounts.entries())\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 3)\n    .map(([error]) => error);\n\n  return { successRate, avgDuration, commonErrors };\n}\n\n// -----------------------------------------------------------------------------\n// Dispatched Agent Updates\n// -----------------------------------------------------------------------------\n\n/**\n * Update dispatched agent for retry\n */\nexport function prepareForRetry(\n  agent: DispatchedAgent,\n  decision: RetryDecision\n): DispatchedAgent {\n  return {\n    ...agent,\n    status: 'retrying',\n    retryCount: decision.retryCount,\n  };\n}\n\n/**\n * Format retry decision as user-facing message\n */\nexport function formatRetryDecision(decision: RetryDecision, agent: string): string {\n  if (decision.shouldRetry) {\n    return `## Retry Scheduled\n\nAgent \\`${agent}\\` will retry after ${Math.round((decision.delayMs || 0) / 1000)} seconds.\n\n**Attempt:** ${decision.retryCount + 1} of ${decision.maxRetries}\n**Reason:** ${decision.reason}`;\n  }\n\n  let message = `## Retry Not Recommended\n\nAgent \\`${agent}\\` has ${decision.retryCount >= decision.maxRetries ? 'exhausted retries' : 'encountered a non-retryable error'}.\n\n**Reason:** ${decision.reason}`;\n\n  if (decision.alternativeAgent) {\n    message += `\n\n### Alternative Suggestion\n\nConsider using \\`${decision.alternativeAgent}\\` instead:\n\n\\`\\`\\`\nTask tool with subagent_type: \"${decision.alternativeAgent}\"\n\\`\\`\\``;\n  }\n\n  return message;\n}\n", "/**\n * Calibration Engine - Outcome-based learning for intent classification\n * Issue #197: Agent Orchestration Layer\n *\n * Learns from agent dispatch outcomes to improve classification accuracy:\n * - Records dispatch-outcome pairs\n * - Calculates keyword-agent boost/penalty adjustments\n * - Provides calibration data for intent classifier\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { createHash } from 'node:crypto';\nimport { getProjectDir, getSessionId, logHook } from './common.js';\nimport type {\n  CalibrationRecord,\n  CalibrationAdjustment,\n  CalibrationData,\n  AgentOutcome,\n} from './orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\n/** Maximum records to keep in calibration data */\nconst MAX_RECORDS = 500;\n\n/** Minimum samples needed before applying adjustments */\nconst MIN_SAMPLES_FOR_ADJUSTMENT = 3;\n\n/** Maximum adjustment magnitude */\nconst MAX_ADJUSTMENT = 15;\n\n/** Adjustment step per outcome */\nconst ADJUSTMENT_STEP = 3;\n\n/** Decay factor for old records (applied to adjustments) */\nconst DECAY_FACTOR = 0.9;\n\n// -----------------------------------------------------------------------------\n// File Management\n// -----------------------------------------------------------------------------\n\nfunction getCalibrationFile(): string {\n  return `${getProjectDir()}/.claude/feedback/calibration-data.json`;\n}\n\nfunction ensureDir(): void {\n  const dir = `${getProjectDir()}/.claude/feedback`;\n  if (!existsSync(dir)) {\n    try {\n      mkdirSync(dir, { recursive: true });\n    } catch {\n      // Ignore\n    }\n  }\n}\n\n/**\n * Load calibration data from file\n */\nexport function loadCalibrationData(): CalibrationData {\n  const file = getCalibrationFile();\n\n  if (existsSync(file)) {\n    try {\n      return JSON.parse(readFileSync(file, 'utf8'));\n    } catch {\n      logHook('calibration-engine', 'Failed to load calibration data, using defaults');\n    }\n  }\n\n  return {\n    schemaVersion: '1.0.0',\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n    records: [],\n    adjustments: [],\n    stats: {\n      totalDispatches: 0,\n      successRate: 0,\n      avgConfidence: 0,\n      topAgents: [],\n    },\n  };\n}\n\n/**\n * Save calibration data to file\n */\nexport function saveCalibrationData(data: CalibrationData): void {\n  ensureDir();\n  const file = getCalibrationFile();\n\n  data.updatedAt = new Date().toISOString();\n\n  try {\n    writeFileSync(file, JSON.stringify(data, null, 2));\n    logHook('calibration-engine', 'Saved calibration data');\n  } catch (err) {\n    logHook('calibration-engine', `Failed to save calibration data: ${err}`);\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Recording\n// -----------------------------------------------------------------------------\n\n/**\n * Create a hash of prompt for deduplication\n */\nexport function hashPrompt(prompt: string): string {\n  return createHash('sha256').update(prompt.toLowerCase().trim()).digest('hex').slice(0, 16);\n}\n\n/**\n * Record a dispatch outcome\n */\nexport function recordOutcome(\n  prompt: string,\n  agent: string,\n  matchedKeywords: string[],\n  confidence: number,\n  outcome: AgentOutcome,\n  durationMs?: number,\n  feedback?: 'positive' | 'negative' | 'neutral'\n): void {\n  const data = loadCalibrationData();\n\n  const record: CalibrationRecord = {\n    timestamp: new Date().toISOString(),\n    sessionId: getSessionId(),\n    agent,\n    promptHash: hashPrompt(prompt),\n    matchedKeywords,\n    dispatchConfidence: confidence,\n    outcome,\n    durationMs,\n    feedback,\n  };\n\n  data.records.push(record);\n\n  // Trim old records\n  if (data.records.length > MAX_RECORDS) {\n    data.records = data.records.slice(-MAX_RECORDS);\n  }\n\n  // Update adjustments\n  updateAdjustments(data, record);\n\n  // Update stats\n  updateStats(data);\n\n  saveCalibrationData(data);\n\n  logHook(\n    'calibration-engine',\n    `Recorded outcome: ${agent} -> ${outcome} (conf: ${confidence})`\n  );\n}\n\n// -----------------------------------------------------------------------------\n// Adjustment Calculation\n// -----------------------------------------------------------------------------\n\n/**\n * Update adjustments based on new record\n */\nfunction updateAdjustments(data: CalibrationData, record: CalibrationRecord): void {\n  const isPositive = record.outcome === 'success';\n  const isNegative = record.outcome === 'failure' || record.outcome === 'rejected';\n\n  if (!isPositive && !isNegative) {\n    // Partial outcomes don't affect adjustments\n    return;\n  }\n\n  const adjustmentDelta = isPositive ? ADJUSTMENT_STEP : -ADJUSTMENT_STEP;\n\n  for (const keyword of record.matchedKeywords) {\n    const existing = data.adjustments.find(\n      a => a.keyword === keyword && a.agent === record.agent\n    );\n\n    if (existing) {\n      // Update existing adjustment\n      existing.adjustment = Math.max(\n        -MAX_ADJUSTMENT,\n        Math.min(MAX_ADJUSTMENT, existing.adjustment + adjustmentDelta)\n      );\n      existing.sampleCount++;\n      existing.lastUpdated = new Date().toISOString();\n    } else {\n      // Create new adjustment\n      data.adjustments.push({\n        keyword,\n        agent: record.agent,\n        adjustment: adjustmentDelta,\n        sampleCount: 1,\n        lastUpdated: new Date().toISOString(),\n      });\n    }\n  }\n}\n\n/**\n * Apply decay to old adjustments\n */\nexport function applyDecay(data: CalibrationData): void {\n  const now = Date.now();\n  const dayMs = 24 * 60 * 60 * 1000;\n\n  for (const adj of data.adjustments) {\n    const age = now - new Date(adj.lastUpdated).getTime();\n    const daysOld = Math.floor(age / dayMs);\n\n    if (daysOld > 7) {\n      // Apply decay for adjustments older than 7 days\n      adj.adjustment = Math.round(adj.adjustment * DECAY_FACTOR);\n\n      // Remove zero adjustments\n      if (Math.abs(adj.adjustment) < 1) {\n        adj.adjustment = 0;\n      }\n    }\n  }\n\n  // Remove zero adjustments\n  data.adjustments = data.adjustments.filter(a => a.adjustment !== 0);\n}\n\n// -----------------------------------------------------------------------------\n// Statistics\n// -----------------------------------------------------------------------------\n\n/**\n * Update aggregate statistics\n */\nfunction updateStats(data: CalibrationData): void {\n  const records = data.records;\n  if (records.length === 0) return;\n\n  // Total dispatches\n  data.stats.totalDispatches = records.length;\n\n  // Success rate\n  const successful = records.filter(r => r.outcome === 'success').length;\n  data.stats.successRate = successful / records.length;\n\n  // Average confidence\n  const avgConf = records.reduce((sum, r) => sum + r.dispatchConfidence, 0) / records.length;\n  data.stats.avgConfidence = Math.round(avgConf);\n\n  // Top agents by count and success rate\n  const agentStats = new Map<string, { count: number; success: number }>();\n  for (const record of records) {\n    const stat = agentStats.get(record.agent) || { count: 0, success: 0 };\n    stat.count++;\n    if (record.outcome === 'success') stat.success++;\n    agentStats.set(record.agent, stat);\n  }\n\n  data.stats.topAgents = Array.from(agentStats.entries())\n    .map(([agent, stat]) => ({\n      agent,\n      count: stat.count,\n      successRate: stat.success / stat.count,\n    }))\n    .sort((a, b) => b.count - a.count)\n    .slice(0, 10);\n}\n\n// -----------------------------------------------------------------------------\n// Query Functions\n// -----------------------------------------------------------------------------\n\n/**\n * Get adjustments for intent classifier\n */\nexport function getAdjustments(): CalibrationAdjustment[] {\n  const data = loadCalibrationData();\n\n  // Only return adjustments with sufficient samples\n  return data.adjustments.filter(a => a.sampleCount >= MIN_SAMPLES_FOR_ADJUSTMENT);\n}\n\n/**\n * Get success rate for a specific agent\n */\nexport function getAgentSuccessRate(agent: string): number | null {\n  const data = loadCalibrationData();\n  const agentRecords = data.records.filter(r => r.agent === agent);\n\n  if (agentRecords.length < MIN_SAMPLES_FOR_ADJUSTMENT) {\n    return null;\n  }\n\n  const successful = agentRecords.filter(r => r.outcome === 'success').length;\n  return successful / agentRecords.length;\n}\n\n/**\n * Get calibration stats\n */\nexport function getCalibrationStats(): CalibrationData['stats'] {\n  return loadCalibrationData().stats;\n}\n\n/**\n * Check if we have enough data for meaningful calibration\n */\nexport function hasMinimalCalibrationData(): boolean {\n  const data = loadCalibrationData();\n  return data.records.length >= MIN_SAMPLES_FOR_ADJUSTMENT;\n}\n", "/**\n * Multi-Agent Coordinator - Pipeline detection and coordination logic\n * Issue #197: Agent Orchestration Layer\n *\n * Provides:\n * - Pipeline definitions for common workflows\n * - Pipeline detection from prompts\n * - Task chain generation with dependencies\n */\n\nimport { logHook } from './common.js';\nimport type {\n  PipelineType,\n  PipelineDefinition,\n  PipelineExecution,\n  TaskCreateInstruction,\n  TaskMetadata,\n} from './orchestration-types.js';\nimport { registerPipeline, registerTask } from './task-integration.js';\n\n// -----------------------------------------------------------------------------\n// Pipeline Definitions\n// -----------------------------------------------------------------------------\n\n/**\n * Predefined pipeline configurations\n */\nexport const PIPELINES: PipelineDefinition[] = [\n  {\n    type: 'product-thinking',\n    name: 'Product Thinking Pipeline',\n    description: 'Full product discovery and specification workflow',\n    triggers: [\n      'should we build',\n      'product decision',\n      'feature validation',\n      'market research',\n      'user research',\n    ],\n    steps: [\n      {\n        agent: 'market-intelligence',\n        description: 'Analyze competitive landscape and market trends',\n        dependsOn: [],\n        skills: ['market-research'],\n        estimatedTokens: 3000,\n      },\n      {\n        agent: 'ux-researcher',\n        description: 'Create personas and map user journeys',\n        dependsOn: [0],\n        skills: ['user-research'],\n        estimatedTokens: 2500,\n      },\n      {\n        agent: 'product-strategist',\n        description: 'Validate value proposition and alignment',\n        dependsOn: [0, 1],\n        skills: ['product-strategy'],\n        estimatedTokens: 2000,\n      },\n      {\n        agent: 'prioritization-analyst',\n        description: 'Score and prioritize using frameworks',\n        dependsOn: [2],\n        skills: ['prioritization'],\n        estimatedTokens: 1500,\n      },\n      {\n        agent: 'business-case-builder',\n        description: 'Build ROI and cost-benefit analysis',\n        dependsOn: [2, 3],\n        skills: ['business-case'],\n        estimatedTokens: 2000,\n      },\n      {\n        agent: 'requirements-translator',\n        description: 'Transform to PRD and user stories',\n        dependsOn: [4],\n        skills: ['requirements'],\n        estimatedTokens: 2500,\n      },\n    ],\n    estimatedTotalTokens: 13500,\n  },\n  {\n    type: 'full-stack-feature',\n    name: 'Full-Stack Feature Pipeline',\n    description: 'End-to-end feature implementation workflow',\n    triggers: [\n      'full-stack feature',\n      'build a feature',\n      'implement end-to-end',\n      'create full feature',\n      'add complete feature',\n    ],\n    steps: [\n      {\n        agent: 'backend-system-architect',\n        description: 'Design API and database schema',\n        dependsOn: [],\n        skills: ['api-design-framework', 'database-schema-designer'],\n        estimatedTokens: 3000,\n      },\n      {\n        agent: 'frontend-ui-developer',\n        description: 'Build React components and UI',\n        dependsOn: [0],\n        skills: ['react-server-components-framework', 'form-state-patterns'],\n        estimatedTokens: 3500,\n      },\n      {\n        agent: 'test-generator',\n        description: 'Create unit and integration tests',\n        dependsOn: [0, 1],\n        skills: ['integration-testing', 'msw-mocking'],\n        estimatedTokens: 2000,\n      },\n      {\n        agent: 'security-auditor',\n        description: 'Audit for vulnerabilities',\n        dependsOn: [0, 1],\n        skills: ['owasp-top-10', 'auth-patterns'],\n        estimatedTokens: 1500,\n      },\n    ],\n    estimatedTotalTokens: 10000,\n  },\n  {\n    type: 'ai-integration',\n    name: 'AI Integration Pipeline',\n    description: 'Add AI/LLM capabilities to application',\n    triggers: [\n      'add rag',\n      'add llm',\n      'ai integration',\n      'implement rag',\n      'add ai feature',\n      'langgraph workflow',\n    ],\n    steps: [\n      {\n        agent: 'workflow-architect',\n        description: 'Design LangGraph workflow and state',\n        dependsOn: [],\n        skills: ['langgraph-state', 'langgraph-routing'],\n        estimatedTokens: 2500,\n      },\n      {\n        agent: 'llm-integrator',\n        description: 'Connect LLM APIs with function calling',\n        dependsOn: [0],\n        skills: ['function-calling', 'llm-streaming'],\n        estimatedTokens: 2000,\n      },\n      {\n        agent: 'data-pipeline-engineer',\n        description: 'Build embeddings and data pipeline',\n        dependsOn: [0],\n        skills: ['embeddings', 'rag-retrieval'],\n        estimatedTokens: 2500,\n      },\n      {\n        agent: 'test-generator',\n        description: 'Create LLM testing infrastructure',\n        dependsOn: [1, 2],\n        skills: ['llm-testing', 'property-based-testing'],\n        estimatedTokens: 1500,\n      },\n    ],\n    estimatedTotalTokens: 8500,\n  },\n  {\n    type: 'security-audit',\n    name: 'Security Audit Pipeline',\n    description: 'Comprehensive security review workflow',\n    triggers: [\n      'security audit',\n      'security review',\n      'vulnerability scan',\n      'security assessment',\n    ],\n    steps: [\n      {\n        agent: 'security-auditor',\n        description: 'Scan for OWASP Top 10 vulnerabilities',\n        dependsOn: [],\n        skills: ['owasp-top-10', 'input-validation'],\n        estimatedTokens: 2000,\n      },\n      {\n        agent: 'security-layer-auditor',\n        description: 'Verify defense-in-depth layers',\n        dependsOn: [0],\n        skills: ['defense-in-depth'],\n        estimatedTokens: 2000,\n      },\n      {\n        agent: 'ai-safety-auditor',\n        description: 'Audit AI/LLM security if applicable',\n        dependsOn: [0],\n        skills: ['mcp-security-hardening'],\n        estimatedTokens: 1500,\n      },\n    ],\n    estimatedTotalTokens: 5500,\n  },\n  {\n    type: 'frontend-compliance',\n    name: 'Frontend 2026 Compliance Pipeline',\n    description: 'Modernize frontend to 2026 patterns',\n    triggers: [\n      'frontend compliance',\n      'modernize frontend',\n      'update react',\n      'frontend 2026',\n    ],\n    steps: [\n      {\n        agent: 'frontend-ui-developer',\n        description: 'Upgrade to React 19 patterns',\n        dependsOn: [],\n        skills: ['react-server-components-framework', 'zustand-patterns'],\n        estimatedTokens: 3000,\n      },\n      {\n        agent: 'performance-engineer',\n        description: 'Optimize Core Web Vitals',\n        dependsOn: [0],\n        skills: ['core-web-vitals', 'lazy-loading-patterns'],\n        estimatedTokens: 2000,\n      },\n      {\n        agent: 'accessibility-specialist',\n        description: 'Ensure WCAG 2.2 compliance',\n        dependsOn: [0],\n        skills: ['a11y-testing', 'focus-management'],\n        estimatedTokens: 1500,\n      },\n    ],\n    estimatedTotalTokens: 6500,\n  },\n];\n\n// -----------------------------------------------------------------------------\n// Pipeline Detection\n// -----------------------------------------------------------------------------\n\n/**\n * Detect if prompt matches a pipeline trigger\n */\nexport function detectPipeline(prompt: string): PipelineDefinition | null {\n  const promptLower = prompt.toLowerCase();\n\n  for (const pipeline of PIPELINES) {\n    for (const trigger of pipeline.triggers) {\n      if (promptLower.includes(trigger)) {\n        logHook(\n          'multi-agent-coordinator',\n          `Detected pipeline: ${pipeline.type} (trigger: \"${trigger}\")`\n        );\n        return pipeline;\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get pipeline by type\n */\nexport function getPipelineByType(type: PipelineType): PipelineDefinition | null {\n  return PIPELINES.find(p => p.type === type) || null;\n}\n\n// -----------------------------------------------------------------------------\n// Pipeline Execution\n// -----------------------------------------------------------------------------\n\n/**\n * Create a pipeline execution plan with task instructions\n */\nexport function createPipelineExecution(\n  pipeline: PipelineDefinition\n): {\n  execution: PipelineExecution;\n  tasks: TaskCreateInstruction[];\n} {\n  const pipelineId = `pipeline-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n\n  // Create task instructions for each step\n  const tasks: TaskCreateInstruction[] = [];\n  const taskIds: Record<number, string> = {};\n\n  for (let i = 0; i < pipeline.steps.length; i++) {\n    const step = pipeline.steps[i];\n    const taskId = `task-${pipelineId}-${i}`;\n    taskIds[i] = taskId;\n\n    const metadata: TaskMetadata = {\n      source: 'pipeline',\n      dispatchedAgent: step.agent,\n      pipelineId,\n      pipelineStep: i,\n      relatedSkills: step.skills,\n    };\n\n    // Build blockedBy from dependsOn\n    const blockedBy = step.dependsOn.map(dep => taskIds[dep]).filter(Boolean);\n\n    tasks.push({\n      subject: `[${pipeline.name}] Step ${i + 1}: ${step.description}`,\n      description: `Pipeline step: ${step.agent}\\n\\n${step.description}\\n\\nEstimated tokens: ${step.estimatedTokens}`,\n      activeForm: `Running ${step.agent}`,\n      metadata,\n      blockedBy: blockedBy.length > 0 ? blockedBy : undefined,\n    });\n  }\n\n  const execution: PipelineExecution = {\n    pipelineId,\n    type: pipeline.type,\n    startedAt: new Date().toISOString(),\n    taskIds,\n    currentStep: 0,\n    completedSteps: [],\n    status: 'running',\n  };\n\n  return { execution, tasks };\n}\n\n/**\n * Register pipeline and tasks with tracking systems\n */\nexport function registerPipelineExecution(\n  execution: PipelineExecution,\n  tasks: TaskCreateInstruction[]\n): void {\n  // Register pipeline\n  registerPipeline(execution);\n\n  // Register each task\n  for (let i = 0; i < tasks.length; i++) {\n    const task = tasks[i];\n    const taskId = execution.taskIds[i];\n\n    if (taskId && task.metadata.dispatchedAgent) {\n      registerTask(\n        taskId,\n        task.metadata.dispatchedAgent,\n        task.metadata.dispatchConfidence || 100,\n        execution.pipelineId,\n        i\n      );\n    }\n  }\n\n  logHook(\n    'multi-agent-coordinator',\n    `Registered pipeline ${execution.pipelineId} with ${tasks.length} tasks`\n  );\n}\n\n// -----------------------------------------------------------------------------\n// Message Formatting\n// -----------------------------------------------------------------------------\n\n/**\n * Format pipeline plan as markdown for user\n */\nexport function formatPipelinePlan(\n  pipeline: PipelineDefinition,\n  execution: PipelineExecution,\n  tasks: TaskCreateInstruction[]\n): string {\n  let md = `## \uD83D\uDD04 Pipeline Detected: ${pipeline.name}\n\n${pipeline.description}\n\n**Pipeline ID:** \\`${execution.pipelineId}\\`\n**Estimated Total Tokens:** ~${pipeline.estimatedTotalTokens}\n\n### Pipeline Steps\n\n`;\n\n  for (let i = 0; i < pipeline.steps.length; i++) {\n    const step = pipeline.steps[i];\n    const deps = step.dependsOn.length > 0\n      ? ` (after steps: ${step.dependsOn.map(d => d + 1).join(', ')})`\n      : ' (can start immediately)';\n\n    md += `**${i + 1}. ${step.agent}**${deps}\n   ${step.description}\n   Skills: ${step.skills?.join(', ') || 'none'}\n\n`;\n  }\n\n  md += `### Task Creation Instructions\n\nCreate these tasks to track the pipeline:\n\n`;\n\n  for (let i = 0; i < tasks.length; i++) {\n    const task = tasks[i];\n    md += `**Task ${i + 1}:**\n\\`\\`\\`\nTaskCreate:\n  subject: \"${task.subject}\"\n  activeForm: \"${task.activeForm}\"\n${task.blockedBy ? `  blockedBy: ${JSON.stringify(task.blockedBy)}` : ''}\n\\`\\`\\`\n\n`;\n  }\n\n  md += `### Start Pipeline\n\nAfter creating all tasks, spawn the first agent:\n\n\\`\\`\\`\nTask tool with subagent_type: \"${pipeline.steps[0].agent}\"\n\\`\\`\\`\n\nThe orchestration layer will track progress and suggest next agents as steps complete.`;\n\n  return md;\n}\n", "/**\n * Decision History Module\n *\n * Core functionality for parsing CHANGELOG.md, aggregating decisions from multiple sources,\n * and formatting output for CLI display and Mermaid diagrams.\n *\n * Issues: #203, #206, #207, #208\n */\n\nimport { readFileSync, writeFileSync, existsSync, mkdirSync } from 'node:fs';\nimport { createHash } from 'node:crypto';\nimport { getProjectDir, getPluginRoot } from './common.js';\n\n// =============================================================================\n// Type Definitions\n// =============================================================================\n\n/**\n * Changelog section types (Keep a Changelog format)\n */\nexport type ChangelogSectionType =\n  | 'Added'\n  | 'Changed'\n  | 'Fixed'\n  | 'Deprecated'\n  | 'Removed'\n  | 'Security';\n\n/**\n * Single entry within a changelog section\n */\nexport interface ChangelogEntry {\n  text: string;\n  category: string;\n  impact: 'high' | 'medium' | 'low';\n  ccReference?: string;\n}\n\n/**\n * A section within a changelog version (Added, Changed, Fixed, etc.)\n */\nexport interface ChangelogSection {\n  type: ChangelogSectionType;\n  entries: ChangelogEntry[];\n}\n\n/**\n * A version block from the changelog\n */\nexport interface ChangelogVersion {\n  version: string;\n  date: string;\n  ccVersion?: string;\n  sections: ChangelogSection[];\n}\n\n/**\n * Parsed changelog with metadata\n */\nexport interface ParsedChangelog {\n  generatedAt: string;\n  changelogHash: string;\n  versions: ChangelogVersion[];\n}\n\n/**\n * Unified decision record from any source\n */\nexport interface Decision {\n  id: string;\n  date: string;\n  summary: string;\n  rationale?: string;\n  ccVersion?: string;\n  pluginVersion?: string;\n  category: string;\n  impact: 'high' | 'medium' | 'low';\n  status: 'proposed' | 'implemented' | 'deprecated' | 'superseded';\n  source: 'changelog' | 'session' | 'coordination' | 'mem0';\n  bestPractice?: string;\n  entities?: string[];\n}\n\n/**\n * Aggregated decisions with metadata\n */\nexport interface AggregatedDecisions {\n  metadata: {\n    totalDecisions: number;\n    sources: Record<string, number>;\n    lastAggregated: string;\n  };\n  decisions: Decision[];\n}\n\n// =============================================================================\n// ANSI Colors for Terminal Output\n// =============================================================================\n\nexport const COLORS = {\n  reset: '\\x1b[0m',\n  bold: '\\x1b[1m',\n  dim: '\\x1b[2m',\n  cyan: '\\x1b[36m',\n  green: '\\x1b[32m',\n  yellow: '\\x1b[33m',\n  red: '\\x1b[31m',\n  blue: '\\x1b[34m',\n  magenta: '\\x1b[35m',\n  white: '\\x1b[37m',\n};\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\n/**\n * Hash a string using SHA-256\n */\nexport function hashString(content: string): string {\n  return createHash('sha256').update(content).digest('hex');\n}\n\n/**\n * Detect decision category from entry text\n * Reused pattern from mem0-decision-saver\n */\nexport function detectDecisionCategory(text: string): string {\n  const lowerText = text.toLowerCase();\n\n  const categoryPatterns: [string, RegExp][] = [\n    ['architecture', /\\b(architecture|redesign|refactor|migration|modular|restructure)\\b/],\n    ['security', /\\b(security|auth|permission|owasp|vulnerability|guardrail|safety)\\b/],\n    ['performance', /\\b(performance|optimization|cache|bundle|speed|latency|throughput)\\b/],\n    ['testing', /\\b(test|coverage|mock|e2e|integration|unit|validation)\\b/],\n    ['devops', /\\b(ci\\/cd|pipeline|deploy|docker|kubernetes|github.action|workflow)\\b/],\n    ['api', /\\b(api|endpoint|rest|graphql|grpc|webhook|route)\\b/],\n    ['database', /\\b(database|schema|migration|query|postgres|sqlalchemy|alembic)\\b/],\n    ['frontend', /\\b(react|frontend|component|ui|ux|css|tailwind|vite)\\b/],\n    ['ai', /\\b(ai|llm|rag|embedding|langraph|agent|mem0|mcp)\\b/],\n    ['hooks', /\\b(hook|pretool|posttool|lifecycle|permission)\\b/],\n    ['skills', /\\b(skill|skill\\.md|knowledge|pattern)\\b/],\n    ['agents', /\\b(agent|subagent|specialist|architect)\\b/],\n    ['documentation', /\\b(doc|readme|changelog|claude\\.md)\\b/],\n    ['bugfix', /\\b(fix|bug|error|issue|broken|crash)\\b/],\n  ];\n\n  for (const [category, pattern] of categoryPatterns) {\n    if (pattern.test(lowerText)) {\n      return category;\n    }\n  }\n\n  return 'general';\n}\n\n/**\n * Detect impact level from entry text and section type\n */\nexport function detectImpact(text: string, sectionType: ChangelogSectionType): 'high' | 'medium' | 'low' {\n  const lowerText = text.toLowerCase();\n\n  // High impact indicators\n  const highPatterns = [\n    /\\b(breaking|critical|major|complete|full|comprehensive|redesign|migration)\\b/,\n    /\\b(security|vulnerability|authentication|authorization)\\b/,\n    /\\b(architecture|infrastructure|core)\\b/,\n    /\\*\\*new/i, // Bold **New** features\n    /^-\\s*\\*\\*/,  // Bold entries\n  ];\n\n  for (const pattern of highPatterns) {\n    if (pattern.test(lowerText) || pattern.test(text)) {\n      return 'high';\n    }\n  }\n\n  // Medium impact based on section type\n  if (sectionType === 'Added' || sectionType === 'Security') {\n    return 'medium';\n  }\n\n  // Low impact\n  if (sectionType === 'Fixed' || sectionType === 'Deprecated') {\n    const trivialPatterns = /\\b(typo|cleanup|minor|small|doc|readme)\\b/;\n    if (trivialPatterns.test(lowerText)) {\n      return 'low';\n    }\n    return 'medium';\n  }\n\n  return 'low';\n}\n\n/**\n * Extract CC version reference from text\n */\nexport function extractCCVersion(text: string): string | undefined {\n  const match = text.match(/CC\\s*(\\d+\\.\\d+\\.\\d+)/i);\n  return match?.[1];\n}\n\n/**\n * Generate a unique ID for a decision\n */\nexport function generateDecisionId(version: string, index: number, category: string): string {\n  const slug = category.toLowerCase().replace(/\\s+/g, '-');\n  return `${version}-${slug}-${index}`;\n}\n\n// =============================================================================\n// CHANGELOG Parser (#206)\n// =============================================================================\n\n/**\n * Parse CHANGELOG.md content into structured data\n */\nexport function parseChangelog(content: string): ParsedChangelog {\n  const versions: ChangelogVersion[] = [];\n  const lines = content.split('\\n');\n\n  // Version header regex: ## [X.Y.Z] - YYYY-MM-DD\n  const versionRegex = /^## \\[(\\d+\\.\\d+\\.\\d+)\\] - (\\d{4}-\\d{2}-\\d{2})/;\n  // Section header regex: ### Added/Changed/Fixed/etc\n  const sectionRegex = /^### (Added|Changed|Fixed|Deprecated|Removed|Security)/;\n\n  let currentVersion: ChangelogVersion | null = null;\n  let currentSection: ChangelogSection | null = null;\n\n  for (const line of lines) {\n    // Check for version header\n    const versionMatch = line.match(versionRegex);\n    if (versionMatch) {\n      if (currentVersion) {\n        versions.push(currentVersion);\n      }\n      currentVersion = {\n        version: versionMatch[1],\n        date: versionMatch[2],\n        sections: [],\n      };\n      currentSection = null;\n      continue;\n    }\n\n    // Check for section header\n    const sectionMatch = line.match(sectionRegex);\n    if (sectionMatch && currentVersion) {\n      currentSection = {\n        type: sectionMatch[1] as ChangelogSectionType,\n        entries: [],\n      };\n      currentVersion.sections.push(currentSection);\n      continue;\n    }\n\n    // Parse entry (lines starting with -)\n    if (line.startsWith('- ') && currentSection && currentVersion) {\n      const text = line.slice(2).trim();\n      const ccVersion = extractCCVersion(text);\n\n      // Detect CC version for this version block if found\n      if (ccVersion && !currentVersion.ccVersion) {\n        currentVersion.ccVersion = ccVersion;\n      }\n\n      currentSection.entries.push({\n        text,\n        category: detectDecisionCategory(text),\n        impact: detectImpact(text, currentSection.type),\n        ccReference: ccVersion,\n      });\n    }\n  }\n\n  // Don't forget the last version\n  if (currentVersion) {\n    versions.push(currentVersion);\n  }\n\n  return {\n    generatedAt: new Date().toISOString(),\n    changelogHash: hashString(content).slice(0, 16),\n    versions,\n  };\n}\n\n/**\n * Convert parsed changelog to unified Decision format\n */\nexport function changelogToDecisions(parsed: ParsedChangelog): Decision[] {\n  const decisions: Decision[] = [];\n\n  for (const version of parsed.versions) {\n    let entryIndex = 0;\n\n    for (const section of version.sections) {\n      // Map section type to decision status\n      const statusMap: Record<ChangelogSectionType, Decision['status']> = {\n        Added: 'implemented',\n        Changed: 'implemented',\n        Fixed: 'implemented',\n        Deprecated: 'deprecated',\n        Removed: 'superseded',\n        Security: 'implemented',\n      };\n\n      for (const entry of section.entries) {\n        entryIndex++;\n        decisions.push({\n          id: generateDecisionId(version.version, entryIndex, entry.category),\n          date: version.date,\n          summary: entry.text.slice(0, 100) + (entry.text.length > 100 ? '...' : ''),\n          rationale: entry.text,\n          ccVersion: version.ccVersion || entry.ccReference,\n          pluginVersion: version.version,\n          category: entry.category,\n          impact: entry.impact,\n          status: statusMap[section.type],\n          source: 'changelog',\n        });\n      }\n    }\n  }\n\n  return decisions;\n}\n\n// =============================================================================\n// Decision Aggregator (#207)\n// =============================================================================\n\n/**\n * Load session decisions from active.json\n */\nexport function loadSessionDecisions(): Decision[] {\n  const projectDir = getProjectDir();\n  const sessionFile = `${projectDir}/.claude/context/knowledge/decisions/active.json`;\n\n  if (!existsSync(sessionFile)) {\n    return [];\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(sessionFile, 'utf-8'));\n    const decisions: Decision[] = [];\n\n    // Handle array format\n    if (Array.isArray(content)) {\n      for (const item of content) {\n        decisions.push({\n          id: item.id || `session-${Date.now()}`,\n          date: item.date || new Date().toISOString().slice(0, 10),\n          summary: item.summary || item.decision || '',\n          rationale: item.rationale || item.context,\n          ccVersion: item.cc_version || item.ccVersion,\n          pluginVersion: item.plugin_version || item.pluginVersion,\n          category: item.category || detectDecisionCategory(item.summary || ''),\n          impact: item.impact || 'medium',\n          status: item.status || 'implemented',\n          source: 'session',\n          bestPractice: item.best_practice || item.bestPractice,\n          entities: item.entities,\n        });\n      }\n    }\n\n    return decisions;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Load coordination decisions from decision-log.json\n */\nexport function loadCoordinationDecisions(): Decision[] {\n  const projectDir = getProjectDir();\n  const coordFile = `${projectDir}/.claude/coordination/decision-log.json`;\n\n  if (!existsSync(coordFile)) {\n    return [];\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(coordFile, 'utf-8'));\n    const decisions: Decision[] = [];\n\n    // Handle decisions array\n    const items = content.decisions || content;\n    if (Array.isArray(items)) {\n      for (const item of items) {\n        decisions.push({\n          id: item.id || `coord-${Date.now()}`,\n          date: item.timestamp?.slice(0, 10) || item.date || new Date().toISOString().slice(0, 10),\n          summary: item.decision || item.summary || '',\n          rationale: item.rationale || item.context,\n          category: item.category || detectDecisionCategory(item.decision || ''),\n          impact: item.impact || 'medium',\n          status: 'implemented',\n          source: 'coordination',\n        });\n      }\n    }\n\n    return decisions;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Load changelog decisions (with caching)\n */\nexport function loadChangelogDecisions(): Decision[] {\n  const pluginRoot = getPluginRoot();\n  const cacheFile = `${getProjectDir()}/.claude/feedback/changelog-decisions.json`;\n  const changelogFile = `${pluginRoot}/CHANGELOG.md`;\n\n  if (!existsSync(changelogFile)) {\n    return [];\n  }\n\n  try {\n    const changelogContent = readFileSync(changelogFile, 'utf-8');\n    const currentHash = hashString(changelogContent).slice(0, 16);\n\n    // Check cache validity\n    if (existsSync(cacheFile)) {\n      const cached = JSON.parse(readFileSync(cacheFile, 'utf-8'));\n      if (cached.changelogHash === currentHash) {\n        return cached.decisions || [];\n      }\n    }\n\n    // Parse and cache\n    const parsed = parseChangelog(changelogContent);\n    const decisions = changelogToDecisions(parsed);\n\n    // Write cache\n    const cacheDir = `${getProjectDir()}/.claude/feedback`;\n    if (!existsSync(cacheDir)) {\n      mkdirSync(cacheDir, { recursive: true });\n    }\n\n    writeFileSync(\n      cacheFile,\n      JSON.stringify({ ...parsed, decisions }, null, 2)\n    );\n\n    return decisions;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Deduplicate decisions by ID\n */\nexport function deduplicateById(decisions: Decision[]): Decision[] {\n  const seen = new Map<string, Decision>();\n\n  for (const d of decisions) {\n    // Prefer non-changelog sources for same ID (they have more context)\n    if (!seen.has(d.id) || d.source !== 'changelog') {\n      seen.set(d.id, d);\n    }\n  }\n\n  return Array.from(seen.values());\n}\n\n/**\n * Aggregate decisions from all sources\n */\nexport async function aggregateDecisions(): Promise<AggregatedDecisions> {\n  const decisions: Decision[] = [];\n  const sources: Record<string, number> = {};\n\n  // 1. Load session decisions (highest priority)\n  const sessionDecisions = loadSessionDecisions();\n  decisions.push(...sessionDecisions);\n  sources.session = sessionDecisions.length;\n\n  // 2. Load changelog decisions\n  const changelogDecisions = loadChangelogDecisions();\n  decisions.push(...changelogDecisions);\n  sources.changelog = changelogDecisions.length;\n\n  // 3. Load coordination decisions\n  const coordDecisions = loadCoordinationDecisions();\n  decisions.push(...coordDecisions);\n  sources.coordination = coordDecisions.length;\n\n  // Deduplicate by ID, sort by date descending\n  const uniqueDecisions = deduplicateById(decisions);\n  const sortedDecisions = uniqueDecisions.sort(\n    (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n\n  return {\n    metadata: {\n      totalDecisions: sortedDecisions.length,\n      sources,\n      lastAggregated: new Date().toISOString(),\n    },\n    decisions: sortedDecisions,\n  };\n}\n\n// =============================================================================\n// Formatters (#208)\n// =============================================================================\n\n/**\n * Group decisions by a field\n */\nexport function groupDecisions(\n  decisions: Decision[],\n  groupBy: string = 'cc_version'\n): Record<string, Decision[]> {\n  const grouped: Record<string, Decision[]> = {};\n\n  for (const d of decisions) {\n    let key: string;\n\n    switch (groupBy) {\n      case 'cc_version':\n        key = d.ccVersion || 'Unknown';\n        break;\n      case 'category':\n        key = d.category;\n        break;\n      case 'month':\n        key = d.date.slice(0, 7); // YYYY-MM\n        break;\n      case 'plugin_version':\n        key = d.pluginVersion || 'Unknown';\n        break;\n      default:\n        key = d.ccVersion || 'Unknown';\n    }\n\n    if (!grouped[key]) {\n      grouped[key] = [];\n    }\n    grouped[key].push(d);\n  }\n\n  return grouped;\n}\n\n/**\n * Format decisions as ASCII table\n */\nexport function formatTable(decisions: Decision[], limit: number = 20): string {\n  const header = `${COLORS.bold}\n\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Date       \u2502 CC Ver   \u2502 Summary                                    \u2502 Category   \u2502\n\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524${COLORS.reset}`;\n\n  const rows = decisions.slice(0, limit).map((d) => {\n    const date = d.date.slice(0, 10).padEnd(10);\n    const ccVer = (d.ccVersion || '?').padEnd(8);\n    const summary = d.summary.slice(0, 42).padEnd(42);\n    const category = d.category.slice(0, 10).padEnd(10);\n\n    return `\u2502 ${date} \u2502 ${ccVer} \u2502 ${summary} \u2502 ${category} \u2502`;\n  });\n\n  const footer = `${COLORS.dim}\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518${COLORS.reset}`;\n\n  const remaining = decisions.length - limit;\n  const remainingNote =\n    remaining > 0 ? `\\n${COLORS.dim}... and ${remaining} more decisions${COLORS.reset}` : '';\n\n  return `${header}\\n${rows.join('\\n')}\\n${footer}${remainingNote}`;\n}\n\n/**\n * Format decisions as ASCII timeline\n */\nexport function formatTimeline(\n  decisions: Decision[],\n  groupBy: string = 'cc_version'\n): string {\n  const grouped = groupDecisions(decisions, groupBy);\n\n  let output = `\\n${COLORS.bold}Decision History Timeline${COLORS.reset}\\n`;\n  output += '\u2550'.repeat(60) + '\\n\\n';\n\n  // Sort groups by most recent date in each group\n  const sortedGroups = Object.entries(grouped).sort((a, b) => {\n    const aDate = a[1][0]?.date || '';\n    const bDate = b[1][0]?.date || '';\n    return bDate.localeCompare(aDate);\n  });\n\n  for (const [group, items] of sortedGroups) {\n    const label = groupBy === 'cc_version' ? `CC ${group}` : group;\n    output += `${COLORS.cyan}${label}${COLORS.reset}\\n`;\n\n    for (const d of items.slice(0, 5)) {\n      const dateStr = d.date.slice(0, 10);\n      const summaryStr = d.summary.slice(0, 40);\n      const impactColor =\n        d.impact === 'high' ? COLORS.red : d.impact === 'medium' ? COLORS.yellow : COLORS.dim;\n\n      output += `  \u251C\u2500\u2500 ${COLORS.dim}${dateStr}${COLORS.reset} \u2500\u2500 ${summaryStr}\\n`;\n      output += `  \u2502   ${impactColor}${d.impact.toUpperCase()}${COLORS.reset} \u2502 ${d.category}\\n`;\n    }\n\n    if (items.length > 5) {\n      output += `  \u2514\u2500\u2500 ${COLORS.dim}... and ${items.length - 5} more${COLORS.reset}\\n`;\n    }\n    output += '\\n';\n  }\n\n  return output;\n}\n\n/**\n * Format statistics summary\n */\nexport function formatStats(aggregated: AggregatedDecisions): string {\n  const { metadata, decisions } = aggregated;\n\n  // Count by category\n  const byCategory: Record<string, number> = {};\n  const byCCVersion: Record<string, number> = {};\n  const byImpact = { high: 0, medium: 0, low: 0 };\n  const bySource: Record<string, number> = {};\n\n  for (const d of decisions) {\n    byCategory[d.category] = (byCategory[d.category] || 0) + 1;\n    if (d.ccVersion) {\n      byCCVersion[d.ccVersion] = (byCCVersion[d.ccVersion] || 0) + 1;\n    }\n    byImpact[d.impact]++;\n    bySource[d.source] = (bySource[d.source] || 0) + 1;\n  }\n\n  return `\n${COLORS.bold}\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n                  Decision History Statistics\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550${COLORS.reset}\n\n${COLORS.cyan}Overview${COLORS.reset}\n  Total Decisions: ${metadata.totalDecisions}\n  Last Aggregated: ${metadata.lastAggregated.slice(0, 19)}\n\n${COLORS.cyan}By Source${COLORS.reset}\n${Object.entries(bySource)\n  .sort((a, b) => b[1] - a[1])\n  .map(([k, v]) => `  ${k}: ${v}`)\n  .join('\\n')}\n\n${COLORS.cyan}By Impact${COLORS.reset}\n  ${COLORS.red}high${COLORS.reset}: ${byImpact.high}\n  ${COLORS.yellow}medium${COLORS.reset}: ${byImpact.medium}\n  ${COLORS.dim}low${COLORS.reset}: ${byImpact.low}\n\n${COLORS.cyan}By Category (top 10)${COLORS.reset}\n${Object.entries(byCategory)\n  .sort((a, b) => b[1] - a[1])\n  .slice(0, 10)\n  .map(([k, v]) => `  ${k}: ${v}`)\n  .join('\\n')}\n\n${COLORS.cyan}By CC Version${COLORS.reset}\n${Object.entries(byCCVersion)\n  .sort((a, b) => b[0].localeCompare(a[0]))\n  .slice(0, 8)\n  .map(([k, v]) => `  ${k}: ${v}`)\n  .join('\\n')}\n`;\n}\n\n/**\n * Format single decision details\n */\nexport function formatDecisionDetail(decision: Decision): string {\n  const impactColor =\n    decision.impact === 'high'\n      ? COLORS.red\n      : decision.impact === 'medium'\n        ? COLORS.yellow\n        : COLORS.dim;\n\n  return `\n${COLORS.bold}\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nDecision: ${decision.id}\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550${COLORS.reset}\n\n${COLORS.cyan}Summary${COLORS.reset}\n${decision.summary}\n\n${COLORS.cyan}Details${COLORS.reset}\n  Date:           ${decision.date}\n  Category:       ${decision.category}\n  Impact:         ${impactColor}${decision.impact.toUpperCase()}${COLORS.reset}\n  Status:         ${decision.status}\n  Source:         ${decision.source}\n  CC Version:     ${decision.ccVersion || 'N/A'}\n  Plugin Version: ${decision.pluginVersion || 'N/A'}\n\n${decision.rationale ? `${COLORS.cyan}Rationale${COLORS.reset}\\n${decision.rationale}\\n` : ''}\n${decision.bestPractice ? `${COLORS.cyan}Best Practice${COLORS.reset}\\n${decision.bestPractice}\\n` : ''}\n${decision.entities?.length ? `${COLORS.cyan}Related Entities${COLORS.reset}\\n${decision.entities.join(', ')}\\n` : ''}\n`;\n}\n\n// =============================================================================\n// Mermaid Generator (#203)\n// =============================================================================\n\n/**\n * Sanitize text for Mermaid diagram compatibility\n * Mermaid timeline has strict syntax - colons, brackets, and special chars break parsing\n */\nfunction sanitizeMermaidText(text: string, maxLength: number = 30): string {\n  return text\n    .slice(0, maxLength)\n    // Remove markdown formatting\n    .replace(/\\*\\*/g, '')\n    .replace(/\\*/g, '')\n    .replace(/`/g, '')\n    // Remove quotes (can break Mermaid parsing)\n    .replace(/[\"']/g, '')\n    // Replace colons with dashes (colon is Mermaid delimiter)\n    .replace(/:/g, '-')\n    // Remove brackets and special chars that break Mermaid\n    .replace(/[[\\]{}()|#<>&;\\\\]/g, '')\n    // Remove leading slashes (for commands like /ork-doctor)\n    .replace(/^\\/+/, '')\n    // Replace multiple spaces/dashes with single\n    .replace(/\\s+/g, ' ')\n    .replace(/-+/g, '-')\n    // Remove leading/trailing dashes and spaces\n    .replace(/^[-\\s]+|[-\\s]+$/g, '')\n    .trim();\n}\n\n/**\n * Format decisions as Mermaid timeline diagram\n */\nexport function formatMermaid(\n  decisions: Decision[],\n  groupBy: string = 'cc_version'\n): string {\n  const grouped = groupDecisions(decisions, groupBy);\n\n  let output = '```mermaid\\ntimeline\\n';\n  output += '    title OrchestKit Evolution with Claude Code\\n';\n\n  // Sort versions descending\n  const sortedGroups = Object.entries(grouped).sort((a, b) => {\n    const aDate = a[1][0]?.date || '';\n    const bDate = b[1][0]?.date || '';\n    return bDate.localeCompare(aDate);\n  });\n\n  for (const [group, items] of sortedGroups.slice(0, 10)) {\n    // Sanitize section label\n    const label = groupBy === 'cc_version' ? `CC ${group}` : sanitizeMermaidText(group, 20);\n    output += `    section ${label}\\n`;\n\n    // Take top 3 high-impact decisions per group\n    const topItems = items\n      .filter((d) => d.impact === 'high' || d.impact === 'medium')\n      .slice(0, 3);\n\n    for (const d of topItems) {\n      // Sanitize summary and category for Mermaid\n      const summary = sanitizeMermaidText(d.summary, 30);\n      const category = sanitizeMermaidText(d.category, 15);\n\n      // Only add if we have valid content after sanitization\n      if (summary.length > 0) {\n        output += `        ${summary} : ${category}\\n`;\n      }\n    }\n  }\n\n  output += '```';\n  return output;\n}\n\n/**\n * Validate Mermaid diagram using mermaid.ink API\n * Returns true if diagram is valid, false otherwise\n * Note: Requires network access to mermaid.ink\n */\nexport async function validateMermaidViaAPI(mermaidCode: string): Promise<boolean> {\n  try {\n    // Remove markdown code fences if present\n    const code = mermaidCode\n      .replace(/^```mermaid\\n?/, '')\n      .replace(/\\n?```$/, '');\n\n    // Encode as base64 for mermaid.ink API\n    const base64 = Buffer.from(code).toString('base64');\n\n    // Fetch SVG from mermaid.ink\n    const response = await fetch(`https://mermaid.ink/svg/${base64}`);\n    const text = await response.text();\n\n    // Valid diagrams return SVG, invalid return error HTML\n    return text.includes('<svg');\n  } catch {\n    // Network error or other issue - assume valid to not block\n    return true;\n  }\n}\n\n/**\n * Generate full Mermaid document with multiple diagrams\n */\nexport function generateMermaidDocument(decisions: Decision[]): string {\n  let doc = '# OrchestKit Decision History\\n\\n';\n  doc += `Generated: ${new Date().toISOString().slice(0, 19)}\\n\\n`;\n\n  // Timeline by CC version\n  doc += '## Evolution Timeline (by CC Version)\\n\\n';\n  doc += formatMermaid(decisions, 'cc_version');\n  doc += '\\n\\n';\n\n  // Timeline by category\n  doc += '## Architecture Decisions (by Category)\\n\\n';\n  doc += formatMermaid(decisions, 'category');\n  doc += '\\n\\n';\n\n  // Stats summary\n  const stats = {\n    total: decisions.length,\n    high: decisions.filter((d) => d.impact === 'high').length,\n    categories: Array.from(new Set(decisions.map((d) => d.category))).length,\n    ccVersions: Array.from(new Set(decisions.map((d) => d.ccVersion).filter(Boolean))).length,\n  };\n\n  doc += '## Summary Statistics\\n\\n';\n  doc += `| Metric | Value |\\n`;\n  doc += `|--------|-------|\\n`;\n  doc += `| Total Decisions | ${stats.total} |\\n`;\n  doc += `| High Impact | ${stats.high} |\\n`;\n  doc += `| Categories | ${stats.categories} |\\n`;\n  doc += `| CC Versions | ${stats.ccVersions} |\\n`;\n\n  return doc;\n}\n\n// =============================================================================\n// Filter Functions\n// =============================================================================\n\nexport interface FilterOptions {\n  ccVersion?: string;\n  category?: string;\n  days?: number;\n  impact?: 'high' | 'medium' | 'low';\n  source?: string;\n  limit?: number;\n}\n\n/**\n * Filter decisions based on criteria\n */\nexport function filterDecisions(\n  decisions: Decision[],\n  options: FilterOptions\n): Decision[] {\n  let filtered = decisions;\n\n  if (options.ccVersion) {\n    filtered = filtered.filter((d) => d.ccVersion === options.ccVersion);\n  }\n\n  if (options.category) {\n    filtered = filtered.filter((d) =>\n      d.category.toLowerCase().includes(options.category!.toLowerCase())\n    );\n  }\n\n  if (options.days) {\n    const cutoff = new Date();\n    cutoff.setDate(cutoff.getDate() - options.days);\n    filtered = filtered.filter((d) => new Date(d.date) >= cutoff);\n  }\n\n  if (options.impact) {\n    filtered = filtered.filter((d) => d.impact === options.impact);\n  }\n\n  if (options.source) {\n    filtered = filtered.filter((d) => d.source === options.source);\n  }\n\n  if (options.limit) {\n    filtered = filtered.slice(0, options.limit);\n  }\n\n  return filtered;\n}\n\n/**\n * Search decisions by text query\n */\nexport function searchDecisions(decisions: Decision[], query: string): Decision[] {\n  const lowerQuery = query.toLowerCase();\n\n  return decisions.filter(\n    (d) =>\n      d.summary.toLowerCase().includes(lowerQuery) ||\n      d.rationale?.toLowerCase().includes(lowerQuery) ||\n      d.category.toLowerCase().includes(lowerQuery) ||\n      d.id.toLowerCase().includes(lowerQuery)\n  );\n}\n", "/**\n * Auto-Approve Safe Bash - Automatically approves safe bash commands\n * Hook: PermissionRequest (Bash)\n * CC 2.1.6 Compliant: includes continue field in all outputs\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport {\n  outputSilentAllow,\n  outputSilentSuccess,\n  logHook,\n  logPermissionFeedback,\n} from '../lib/common.js';\n\n/**\n * Safe command patterns that should be auto-approved\n */\nconst SAFE_PATTERNS: RegExp[] = [\n  // Git read operations\n  /^git (status|log|diff|branch|show|fetch|pull)/,\n  /^git checkout/,\n\n  // Package managers - read operations\n  /^npm (list|ls|outdated|audit|run|test)/,\n  /^pnpm (list|ls|outdated|audit|run|test)/,\n  /^yarn (list|outdated|audit|run|test)/,\n  /^poetry (show|run|env)/,\n\n  // Docker - read operations\n  /^docker (ps|images|logs|inspect)/,\n  /^docker-compose (ps|logs)/,\n  /^docker compose (ps|logs)/,\n\n  // Basic shell commands\n  /^ls(\\s|$)/,\n  /^pwd$/,\n  /^echo\\s/,\n  /^cat\\s/,\n  /^head\\s/,\n  /^tail\\s/,\n  /^wc\\s/,\n  /^find\\s/,\n  /^which\\s/,\n  /^type\\s/,\n  /^env$/,\n  /^printenv/,\n\n  // GitHub CLI - read operations\n  /^gh (issue|pr|repo|workflow) (list|view|status)/,\n  /^gh milestone/,\n\n  // Testing and linting\n  /^pytest/,\n  /^poetry run pytest/,\n  /^npm run (test|lint|typecheck|format)/,\n  /^ruff (check|format)/,\n  /^ty check/,\n  /^mypy/,\n];\n\n/**\n * Auto-approve safe bash commands\n */\nexport function autoApproveSafeBash(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  logHook('auto-approve-safe-bash', `Evaluating bash command: ${command.slice(0, 50)}...`);\n\n  // Check against safe patterns\n  for (const pattern of SAFE_PATTERNS) {\n    if (pattern.test(command)) {\n      logHook('auto-approve-safe-bash', `Auto-approved: matches safe pattern ${pattern}`);\n      logPermissionFeedback('allow', `Matches safe pattern: ${pattern}`, input);\n      return outputSilentAllow();\n    }\n  }\n\n  // Not a recognized safe command - let user decide (silent passthrough)\n  logHook('auto-approve-safe-bash', 'Command requires manual approval');\n  return outputSilentSuccess();\n}\n", "/**\n * Auto-Approve Project Writes - Auto-approves writes within project directory\n * Hook: PermissionRequest (Write|Edit)\n * CC 2.1.6 Compliant: includes continue field in all outputs\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport {\n  outputSilentAllow,\n  outputSilentSuccess,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../lib/common.js';\nimport { resolve, isAbsolute } from 'node:path';\n\n/**\n * Directories that should not be auto-approved for writes\n */\nconst EXCLUDED_DIRS = [\n  'node_modules',\n  '.git',\n  'dist',\n  'build',\n  '__pycache__',\n  '.venv',\n  'venv',\n];\n\n/**\n * Auto-approve writes within project directory (excluding sensitive directories)\n */\nexport function autoApproveProjectWrites(input: HookInput): HookResult {\n  let filePath = input.tool_input.file_path || '';\n  const projectDir = getProjectDir();\n\n  logHook('auto-approve-project-writes', `Evaluating write to: ${filePath}`);\n\n  // Resolve to absolute path if relative\n  if (!isAbsolute(filePath)) {\n    filePath = resolve(projectDir, filePath);\n  }\n\n  // Check if file is within project directory\n  if (filePath.startsWith(projectDir)) {\n    // Check against excluded directories\n    for (const dir of EXCLUDED_DIRS) {\n      if (filePath.includes(`/${dir}/`)) {\n        logHook('auto-approve-project-writes', `Write to excluded directory: ${dir}`);\n        return outputSilentSuccess(); // Let user decide\n      }\n    }\n\n    logHook('auto-approve-project-writes', 'Auto-approved: within project directory');\n    logPermissionFeedback('allow', `In-project write: ${filePath}`, input);\n    return outputSilentAllow();\n  }\n\n  // Outside project directory - let user decide\n  logHook('auto-approve-project-writes', 'Write outside project directory - manual approval required');\n  return outputSilentSuccess();\n}\n", "/**\n * Permission Learning Tracker - Learns from user approval patterns\n * Hook: PermissionRequest (Post-approval tracking)\n * CC 2.1.6 Compliant: includes continue field in all outputs\n *\n * This hook runs AFTER other permission hooks and tracks:\n * 1. Commands that are approved manually (potential auto-approve candidates)\n * 2. Patterns in approved commands for learning\n * 3. Frequency of command types\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport {\n  outputSilentSuccess,\n  outputSilentAllow,\n  logHook,\n  logPermissionFeedback,\n  getPluginRoot,\n} from '../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Security blocklist - commands that should never be auto-approved\n */\nconst SECURITY_BLOCKLIST: RegExp[] = [\n  /rm\\s+-rf\\s+[/~]/,\n  /sudo\\s/,\n  /chmod\\s+-R\\s+777/,\n  />\\s*\\/dev\\/sd/,\n  /mkfs\\./,\n  /dd\\s+if=/,\n  /:.*\\(\\).*\\{.*\\|.*&.*\\}/,\n  /curl.*\\|\\s*sh/,\n  /wget.*\\|\\s*sh/,\n];\n\n/**\n * Check if command matches security blocklist\n */\nfunction isSecurityBlocked(command: string): boolean {\n  return SECURITY_BLOCKLIST.some((pattern) => pattern.test(command));\n}\n\n/**\n * Load learned patterns from feedback file\n */\nfunction loadLearnedPatterns(): string[] {\n  const pluginRoot = getPluginRoot();\n  const feedbackFile = join(pluginRoot, '.claude', 'feedback', 'learned-patterns.json');\n\n  try {\n    if (existsSync(feedbackFile)) {\n      const data = JSON.parse(readFileSync(feedbackFile, 'utf8'));\n      return data.autoApprovePatterns || [];\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return [];\n}\n\n/**\n * Check if command matches a learned auto-approve pattern\n */\nfunction shouldAutoApprove(command: string): boolean {\n  const patterns = loadLearnedPatterns();\n\n  for (const pattern of patterns) {\n    try {\n      const regex = new RegExp(pattern);\n      if (regex.test(command)) {\n        return true;\n      }\n    } catch {\n      // Invalid pattern, skip\n    }\n  }\n\n  return false;\n}\n\n/**\n * Learning tracker hook - observes permissions for learning, optionally auto-approves\n */\nexport function learningTracker(input: HookInput): HookResult {\n  const toolName = input.tool_name;\n  const command = input.tool_input.command || input.tool_input.file_path || '';\n\n  logHook('learning-tracker', `Processing permission for tool: ${toolName}, command: ${command.slice(0, 50)}...`);\n\n  // For Bash commands, check if we should auto-approve based on learned patterns\n  if (toolName === 'Bash' && command) {\n    // First check security blocklist - never auto-approve these\n    if (isSecurityBlocked(command)) {\n      logHook('learning-tracker', 'Command matches security blocklist, skipping');\n      return outputSilentSuccess();\n    }\n\n    // Check if this command matches a learned auto-approve pattern\n    if (shouldAutoApprove(command)) {\n      logHook('learning-tracker', 'Command matches learned auto-approve pattern');\n      logPermissionFeedback('allow', 'Learned pattern match', input);\n      return outputSilentAllow();\n    }\n  }\n\n  // Output: Silent pass-through (don't affect the permission decision)\n  // This hook observes for learning purposes\n  return outputSilentSuccess();\n}\n", "/**\n * Dangerous Command Blocker - Blocks commands matching dangerous patterns\n * Hook: PreToolUse (Bash)\n * CC 2.1.7 Compliant: outputs JSON with continue field\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  normalizeCommand,\n} from '../../lib/common.js';\n\n/**\n * Dangerous patterns - commands that can cause catastrophic system damage\n * These are matched as literal substrings via normalizedCommand.includes()\n */\nconst DANGEROUS_PATTERNS: string[] = [\n  // Filesystem destruction\n  'rm -rf /',\n  'rm -rf ~',\n  'rm -fr /',\n  'rm -fr ~',\n  'mv /* /dev/null',\n  // Device wiping\n  '> /dev/sda',\n  'mkfs.',\n  'dd if=/dev/zero of=/dev/',\n  'dd if=/dev/random of=/dev/',\n  // Permission abuse\n  'chmod -R 777 /',\n  // Fork bomb\n  ':(){:|:&};:',\n  // Destructive git operations (data loss)\n  'git reset --hard',\n  'git clean -fd',\n  // Database destruction\n  'drop database',\n  'drop schema',\n  'truncate table',\n];\n\n/**\n * Shell interpreters that should never receive piped input from download commands.\n * Catches: wget URL | sh, curl URL | bash, etc.\n */\nconst PIPE_TO_SHELL_RE = /\\|\\s*(sh|bash|zsh|dash)\\b/i;\n\n/**\n * Git force-push patterns that rewrite remote history.\n * Catches: git push --force, git push -f, git push origin main --force\n */\nconst GIT_FORCE_PUSH_RE = /git\\s+push\\s+.*(-f|--force)\\b/i;\n\n/**\n * Block dangerous commands\n */\nexport function dangerousCommandBlocker(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Normalize: remove line continuations and collapse whitespace, lowercase for pattern matching\n  const normalizedCommand = normalizeCommand(command).toLowerCase();\n\n  // Check command against each dangerous pattern (literal substring, case-insensitive)\n  for (const pattern of DANGEROUS_PATTERNS) {\n    if (normalizedCommand.includes(pattern.toLowerCase())) {\n      logHook('dangerous-command-blocker', `BLOCKED: Dangerous pattern: ${pattern}`);\n      logPermissionFeedback('deny', `Dangerous pattern: ${pattern}`, input);\n\n      return outputDeny(\n        `Command matches dangerous pattern: ${pattern}\\n\\n` +\n          'This command could cause severe system damage and has been blocked.'\n      );\n    }\n  }\n\n  // Check for piping to shell interpreters (e.g., wget URL | sh, curl URL | bash)\n  if (PIPE_TO_SHELL_RE.test(normalizedCommand)) {\n    const reason = 'Piping to shell interpreter detected';\n    logHook('dangerous-command-blocker', `BLOCKED: ${reason}`);\n    logPermissionFeedback('deny', reason, input);\n\n    return outputDeny(\n      `${reason}\\n\\n` +\n        'Piping untrusted content to a shell interpreter is dangerous and has been blocked.'\n    );\n  }\n\n  // Check for git force-push (rewrites remote history)\n  if (GIT_FORCE_PUSH_RE.test(normalizedCommand)) {\n    const reason = 'Git force-push detected (rewrites remote history)';\n    logHook('dangerous-command-blocker', `BLOCKED: ${reason}`);\n    logPermissionFeedback('deny', reason, input);\n\n    return outputDeny(\n      `${reason}\\n\\n` +\n        'Force-pushing can destroy remote commit history and has been blocked.'\n    );\n  }\n\n  // Command is safe, allow it silently\n  return outputSilentSuccess();\n}\n", "/**\n * Unified Git Validator Hook\n * Consolidates: branch-protection, branch-naming, commit-message, atomic-commit\n *\n * Performance: Single execSync call for branch, cached for all validations\n * CC 2.1.9 Enhanced: additionalContext for guidance\n *\n * @version 2.0.0 - Consolidated from 4 separate hooks\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputWithContext,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getCachedBranch,\n} from '../../lib/common.js';\nimport { isProtectedBranch, validateBranchName, getGitStatus } from '../../lib/git.js';\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\nconst VALID_COMMIT_TYPES = ['feat', 'fix', 'refactor', 'docs', 'test', 'chore', 'style', 'perf', 'ci', 'build'];\nconst STAGED_FILE_WARNING_THRESHOLD = 10;\n\n// =============================================================================\n// HELPERS\n// =============================================================================\n\nfunction extractCommitMessage(command: string): string | null {\n  const quotedMatch = command.match(/-m\\s+[\"']([^\"']+)[\"']/);\n  if (quotedMatch) return quotedMatch[1];\n\n  const unquotedMatch = command.match(/-m\\s+(\\S+)/);\n  if (unquotedMatch) return unquotedMatch[1];\n\n  return null;\n}\n\nfunction extractNewBranchName(command: string): string | null {\n  const checkoutMatch = command.match(/checkout\\s+-b\\s+(\\S+)/);\n  if (checkoutMatch) return checkoutMatch[1];\n\n  const branchMatch = command.match(/git\\s+branch\\s+(\\S+)/);\n  if (branchMatch) return branchMatch[1];\n\n  return null;\n}\n\n// =============================================================================\n// VALIDATION FUNCTIONS\n// =============================================================================\n\nfunction validateBranchProtection(command: string, currentBranch: string): HookResult | null {\n  if (!isProtectedBranch(currentBranch)) {\n    return null;\n  }\n\n  if (/git\\s+(commit|push)/.test(command)) {\n    const errorMsg = `BLOCKED: Cannot commit or push directly to '${currentBranch}' branch.\n\nRequired workflow:\n1. git checkout -b issue/<number>-<description>\n2. git commit -m \"feat(#<number>): Description\"\n3. git push -u origin issue/<number>-<description>\n4. gh pr create --base dev`;\n\n    logPermissionFeedback('deny', `Blocked on protected branch: ${currentBranch}`);\n    return outputDeny(errorMsg);\n  }\n\n  return outputWithContext(`On protected branch '${currentBranch}'. Create feature branch for changes.`);\n}\n\nfunction validateBranchNaming(command: string): HookResult | null {\n  if (!/git\\s+(checkout\\s+-b|branch\\s+)/.test(command)) {\n    return null;\n  }\n\n  const branchName = extractNewBranchName(command);\n  if (!branchName) return null;\n\n  const validationError = validateBranchName(branchName);\n  if (validationError) {\n    const context = `Branch naming: ${validationError}\n\nRecommended: issue/123-description, feature/xyz, fix/bug-name`;\n    logPermissionFeedback('allow', `Branch naming guidance: ${branchName}`);\n    return outputAllowWithContext(context);\n  }\n\n  return null;\n}\n\nfunction validateCommitMessage(command: string): HookResult | null {\n  if (!/^git\\s+commit/.test(command)) {\n    return null;\n  }\n\n  if (/<<['\"]?EOF/.test(command)) {\n    return outputAllowWithContext(`Heredoc commit. Use: type(#issue): description\nTypes: ${VALID_COMMIT_TYPES.join(', ')}\nEnd with: Co-Authored-By: Claude <noreply@anthropic.com>`);\n  }\n\n  const commitMsg = extractCommitMessage(command);\n  if (!commitMsg) {\n    return outputAllowWithContext(`Interactive commit. Use: type(#issue): description`);\n  }\n\n  const typesPattern = VALID_COMMIT_TYPES.join('|');\n  const conventionalPattern = new RegExp(`^(${typesPattern})(\\\\(#?[0-9]+\\\\)|(\\\\([a-z-]+\\\\)))?: .+`);\n  const simplePattern = new RegExp(`^(${typesPattern}): .+`);\n\n  if (conventionalPattern.test(commitMsg) || simplePattern.test(commitMsg)) {\n    const titleLen = commitMsg.split('\\n')[0].length;\n    if (titleLen > 72) {\n      return outputAllowWithContext(`Commit title is ${titleLen} chars (max 72 recommended)`);\n    }\n    return null;\n  }\n\n  const errorMsg = `INVALID COMMIT FORMAT: \"${commitMsg}\"\n\nRequired: type(#issue): description\nTypes: ${VALID_COMMIT_TYPES.join(', ')}\nExample: feat(#123): Add user authentication`;\n\n  logPermissionFeedback('deny', `Invalid commit: ${commitMsg}`);\n  return outputDeny(errorMsg);\n}\n\nfunction validateAtomicCommit(command: string, projectDir?: string): HookResult | null {\n  if (!/^git\\s+commit/.test(command)) {\n    return null;\n  }\n\n  const status = getGitStatus(projectDir);\n  const stagedCount = status.split('\\n').filter((line) => line.trim()).length;\n\n  if (stagedCount > STAGED_FILE_WARNING_THRESHOLD) {\n    return outputAllowWithContext(`Large commit: ${stagedCount} files. Consider splitting into smaller commits.`);\n  }\n\n  return null;\n}\n\n// =============================================================================\n// MAIN HOOK\n// =============================================================================\n\nexport function gitValidator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  if (!command.startsWith('git')) {\n    return outputSilentSuccess();\n  }\n\n  const currentBranch = getCachedBranch(input.project_dir);\n\n  logHook('git-validator', `Validating: ${command.slice(0, 50)}...`);\n\n  // 1. Branch protection (can block)\n  const protectionResult = validateBranchProtection(command, currentBranch);\n  if (protectionResult?.continue === false) {\n    return protectionResult;\n  }\n\n  // 2. Commit message validation (can block)\n  const commitMsgResult = validateCommitMessage(command);\n  if (commitMsgResult?.continue === false) {\n    return commitMsgResult;\n  }\n\n  // 3. Branch naming (advisory)\n  const branchNameResult = validateBranchNaming(command);\n\n  // 4. Atomic commit (advisory)\n  const atomicResult = validateAtomicCommit(command, input.project_dir);\n\n  // Combine advisory contexts\n  const contexts: string[] = [];\n\n  if (protectionResult?.hookSpecificOutput?.additionalContext) {\n    contexts.push(protectionResult.hookSpecificOutput.additionalContext as string);\n  }\n  if (commitMsgResult?.hookSpecificOutput?.additionalContext) {\n    contexts.push(commitMsgResult.hookSpecificOutput.additionalContext as string);\n  }\n  if (branchNameResult?.hookSpecificOutput?.additionalContext) {\n    contexts.push(branchNameResult.hookSpecificOutput.additionalContext as string);\n  }\n  if (atomicResult?.hookSpecificOutput?.additionalContext) {\n    contexts.push(atomicResult.hookSpecificOutput.additionalContext as string);\n  }\n\n  if (contexts.length > 0) {\n    return outputWithContext(contexts.join('\\n\\n'));\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Compound Command Validator Hook\n * Validates multi-command sequences for security\n * CC 2.1.7: Detects dangerous patterns in compound commands (&&, ||, |, ;)\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  normalizeCommand,\n} from '../../lib/common.js';\n\n/**\n * Dangerous segment patterns\n */\nconst DANGEROUS_SEGMENTS = [\n  'rm -rf /',\n  'rm -rf ~',\n  'rm -fr /',\n  'rm -fr ~',\n  'mkfs',\n  'dd if=/dev',\n  '> /dev/sd',\n  'chmod -R 777 /',\n];\n\n/**\n * Validate a single segment of a compound command\n */\nfunction validateSegment(segment: string): boolean {\n  const trimmed = segment.trim();\n  if (!trimmed) return true;\n\n  for (const pattern of DANGEROUS_SEGMENTS) {\n    if (trimmed.includes(pattern)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Validate compound command and return blocking reason if dangerous\n */\nfunction validateCompoundCommand(command: string): string | null {\n  // Check for pipe-to-shell patterns BEFORE splitting\n  if (/curl.*\\|.*(sh|bash)/.test(command) || /wget.*\\|.*(sh|bash)/.test(command)) {\n    return 'pipe-to-shell execution (curl/wget piped to sh/bash)';\n  }\n\n  // Check if command contains compound operators\n  if (!command.includes('&&') && !command.includes('||') && !command.includes('|') && !command.includes(';')) {\n    return null; // Not a compound command\n  }\n\n  // Split on operators and check each segment\n  const segments = command.split(/&&|\\|\\||[|;]/);\n\n  for (const segment of segments) {\n    if (!validateSegment(segment)) {\n      return segment.trim();\n    }\n  }\n\n  return null;\n}\n\n/**\n * Validate compound commands for dangerous patterns\n */\nexport function compoundCommandValidator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Normalize command: remove line continuations\n  const normalizedCommand = normalizeCommand(command);\n\n  // Validate\n  const blockReason = validateCompoundCommand(normalizedCommand);\n\n  if (blockReason) {\n    const errorMsg = `BLOCKED: Dangerous compound command detected.\n\nBlocked segment: ${blockReason}\n\nThe command contains a potentially destructive operation.\n\nPlease review and modify your command to remove the dangerous operation.`;\n\n    logPermissionFeedback('deny', `Dangerous compound command: ${blockReason}`, input);\n    logHook('compound-command-validator', `BLOCKED: ${blockReason}`);\n\n    return outputDeny(errorMsg);\n  }\n\n  // Safe compound command - allow execution\n  logPermissionFeedback('allow', 'Compound command validated: safe', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Default Timeout Setter Hook\n * Sets default timeout of 120000ms (2 minutes) if not specified\n * CC 2.1.7 Compliant: outputs JSON with updatedInput to modify tool params\n */\n\nimport type { HookInput, HookResult, HookSpecificOutput } from '../../types.js';\nimport { logHook } from '../../lib/common.js';\n\n/**\n * Default timeout: 2 minutes (120000ms)\n */\nconst DEFAULT_TIMEOUT = 120000;\n\n/**\n * Extended hook specific output with updatedInput\n */\ninterface ExtendedHookSpecificOutput extends HookSpecificOutput {\n  updatedInput?: {\n    command: string;\n    timeout: number;\n    description?: string;\n  };\n}\n\n/**\n * Set default timeout if not specified\n */\nexport function defaultTimeoutSetter(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const timeout = input.tool_input.timeout;\n  const description = input.tool_input.description;\n\n  // If timeout is already set, don't modify\n  if (typeof timeout === 'number' && timeout > 0) {\n    return { continue: true, suppressOutput: true };\n  }\n\n  // Build updatedInput with default timeout\n  const updatedInput: ExtendedHookSpecificOutput['updatedInput'] = {\n    command,\n    timeout: DEFAULT_TIMEOUT,\n  };\n\n  if (description && typeof description === 'string') {\n    updatedInput.description = description;\n  }\n\n  logHook('default-timeout-setter', `Setting default timeout: ${DEFAULT_TIMEOUT}ms`);\n\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'allow',\n      updatedInput,\n    } as ExtendedHookSpecificOutput,\n  };\n}\n", "/**\n * Error Pattern Warner Hook\n * Warns before executing commands matching known bad patterns\n * CC 2.1.9 Enhanced: injects additionalContext with learned error patterns\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\ninterface ErrorRule {\n  tool: string;\n  signature: string;\n  pattern?: string;\n  occurrence_count?: number;\n  suggested_fix?: string;\n  sample_input?: {\n    command?: string;\n  };\n}\n\ninterface RulesFile {\n  rules: ErrorRule[];\n}\n\n/**\n * Load error rules from file\n */\nfunction loadErrorRules(projectDir: string): ErrorRule[] {\n  const rulesFile = join(projectDir, '.claude', 'rules', 'error_rules.json');\n\n  try {\n    if (existsSync(rulesFile)) {\n      const data: RulesFile = JSON.parse(readFileSync(rulesFile, 'utf8'));\n      return data.rules || [];\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return [];\n}\n\n/**\n * Count common words between two strings\n */\nfunction countCommonWords(str1: string, str2: string): number {\n  const words1 = new Set(str1.toLowerCase().split(/\\s+/));\n  const words2 = new Set(str2.toLowerCase().split(/\\s+/));\n\n  let count = 0;\n  for (const word of words1) {\n    if (words2.has(word) && word.length > 2) {\n      count++;\n    }\n  }\n\n  return count;\n}\n\n/**\n * Warn about commands matching known error patterns\n */\nexport function errorPatternWarner(input: HookInput): HookResult {\n  const projectDir = getProjectDir();\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Load error rules\n  const rules = loadErrorRules(projectDir);\n  if (rules.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const hints: string[] = [];\n\n  // Check for common database connection patterns that often fail\n  if (/psql.*-U\\s+(postgres|orchestkit|root)/.test(command)) {\n    const dbRules = rules.filter(\n      (r) => r.tool === 'Bash' && r.signature?.includes('role')\n    );\n    if (dbRules.length > 0) {\n      hints.push('DB role error: use docker exec -it <container> psql -U orchestkit_user');\n    }\n  }\n\n  // Check for MCP postgres tool issues\n  if (command.includes('mcp__postgres')) {\n    const mcpRules = rules.filter((r) => r.tool?.includes('postgres-mcp'));\n    if (mcpRules.length > 0) {\n      hints.push('MCP postgres: verify connection to correct database');\n    }\n  }\n\n  // Check against high-occurrence error patterns\n  for (const rule of rules) {\n    if (!rule.pattern || (rule.occurrence_count || 0) < 5) continue;\n\n    const sampleCommand = rule.sample_input?.command;\n    if (sampleCommand && countCommonWords(command, sampleCommand) > 3) {\n      logHook('error-pattern-warner', `Pattern match: ${rule.signature}`);\n      if (rule.suggested_fix) {\n        hints.push(`${rule.signature} (${rule.occurrence_count}x): ${rule.suggested_fix}`);\n      } else {\n        hints.push(`${rule.signature} (${rule.occurrence_count}x)`);\n      }\n    }\n  }\n\n  // CC 2.1.9: Inject additionalContext if we have pattern hints\n  if (hints.length > 0) {\n    let contextMsg = 'Learned error patterns | ' + hints.join(' | ');\n\n    // Truncate if too long (keep under 200 chars for context budget)\n    if (contextMsg.length > 200) {\n      contextMsg = contextMsg.slice(0, 197) + '...';\n    }\n\n    return outputWithContext(contextMsg);\n  }\n\n  // No relevant patterns found\n  return outputSilentSuccess();\n}\n", "/**\n * Conflict Predictor Hook\n * Predicts potential merge conflicts before git operations\n * CC 2.1.9: Injects warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\n\n/**\n * Get files that might conflict on merge/rebase\n */\nfunction getPotentialConflicts(projectDir: string, targetBranch: string): string[] {\n  try {\n    // Get files changed in current branch since diverging from target\n    const result = execSync(\n      `git diff --name-only ${targetBranch}...HEAD 2>/dev/null || echo \"\"`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    const changedFiles = result.trim().split('\\n').filter(Boolean);\n\n    // Check which of these files have also been modified in target branch\n    const conflicts: string[] = [];\n    for (const file of changedFiles.slice(0, 20)) {\n      // Limit to first 20 files\n      try {\n        const targetModified = execSync(\n          `git log -1 --pretty=format:\"%h\" ${targetBranch} -- \"${file}\" 2>/dev/null || echo \"\"`,\n          {\n            cwd: projectDir,\n            encoding: 'utf8',\n            timeout: 5000,\n            stdio: ['pipe', 'pipe', 'pipe'],\n          }\n        );\n\n        if (targetModified.trim()) {\n          conflicts.push(file);\n        }\n      } catch {\n        // Ignore individual file check errors\n      }\n    }\n\n    return conflicts;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Predict conflicts before merge/rebase operations\n */\nexport function conflictPredictor(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git merge or rebase commands\n  if (!/git\\s+(merge|rebase|pull)/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract target branch\n  let targetBranch: string | null = null;\n\n  // git merge <branch>, git rebase <branch>\n  const branchMatch = command.match(/git\\s+(merge|rebase)\\s+(\\S+)/);\n  if (branchMatch) {\n    targetBranch = branchMatch[2];\n  }\n\n  // git pull (uses remote tracking branch)\n  if (command.includes('git pull')) {\n    targetBranch = 'origin/dev'; // Assume dev as base\n  }\n\n  if (!targetBranch) {\n    return outputSilentSuccess();\n  }\n\n  // Check for potential conflicts\n  const conflicts = getPotentialConflicts(projectDir, targetBranch);\n\n  if (conflicts.length > 0) {\n    const context = `Potential conflicts detected: ${conflicts.length} file(s)\nFiles: ${conflicts.slice(0, 5).join(', ')}${conflicts.length > 5 ? '...' : ''}\n\nConsider:\n1. Review changes in these files before merging\n2. Run: git diff ${targetBranch}...HEAD -- <file>\n3. Prepare conflict resolution strategy`;\n\n    logPermissionFeedback('allow', `Conflict prediction: ${conflicts.length} files`, input);\n    logHook('conflict-predictor', `Potential conflicts: ${conflicts.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  logPermissionFeedback('allow', 'No conflicts predicted', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Affected Tests Finder Hook\n * Suggests running tests related to changed files\n * CC 2.1.9: Injects test suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\nimport { existsSync } from 'node:fs';\nimport { join, basename, dirname } from 'node:path';\n\n/**\n * Find test files related to a source file\n */\nfunction findRelatedTests(projectDir: string, sourceFile: string): string[] {\n  const tests: string[] = [];\n  const baseName = basename(sourceFile).replace(/\\.(ts|tsx|js|jsx|py)$/, '');\n  const dirName = dirname(sourceFile);\n\n  // Common test file patterns\n  const testPatterns = [\n    `${dirName}/${baseName}.test.ts`,\n    `${dirName}/${baseName}.test.tsx`,\n    `${dirName}/${baseName}.spec.ts`,\n    `${dirName}/${baseName}.spec.tsx`,\n    `${dirName}/__tests__/${baseName}.test.ts`,\n    `${dirName}/__tests__/${baseName}.test.tsx`,\n    `tests/${sourceFile.replace(/\\.(ts|tsx|js|jsx)$/, '.test.ts')}`,\n    `test_${baseName}.py`,\n    `tests/test_${baseName}.py`,\n  ];\n\n  for (const pattern of testPatterns) {\n    const fullPath = join(projectDir, pattern);\n    if (existsSync(fullPath)) {\n      tests.push(pattern);\n    }\n  }\n\n  return tests;\n}\n\n/**\n * Get changed files from git status\n */\nfunction getChangedFiles(projectDir: string): string[] {\n  try {\n    const result = execSync('git status --short 2>/dev/null || echo \"\"', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    return result\n      .split('\\n')\n      .filter((line) => line.trim())\n      .map((line) => line.slice(3).trim())\n      .filter((file) => /\\.(ts|tsx|js|jsx|py)$/.test(file));\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Suggest running affected tests before push/commit\n */\nexport function affectedTestsFinder(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git push or npm test commands\n  if (!/git\\s+push|npm\\s+run\\s+test|pytest/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip if already running tests\n  if (/npm\\s+run\\s+test|pytest/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get changed files\n  const changedFiles = getChangedFiles(projectDir);\n  if (changedFiles.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Find related tests\n  const relatedTests: string[] = [];\n  for (const file of changedFiles.slice(0, 10)) {\n    // Limit to first 10 files\n    const tests = findRelatedTests(projectDir, file);\n    relatedTests.push(...tests);\n  }\n\n  // Remove duplicates\n  const uniqueTests = [...new Set(relatedTests)];\n\n  if (uniqueTests.length > 0) {\n    const context = `Related tests for changed files:\n${uniqueTests.slice(0, 5).join('\\n')}${uniqueTests.length > 5 ? '\\n...' : ''}\n\nConsider running: npm run test -- ${uniqueTests[0]}`;\n\n    logPermissionFeedback('allow', `Found ${uniqueTests.length} related tests`, input);\n    logHook('affected-tests-finder', `Tests: ${uniqueTests.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * CI Simulation Hook\n * Suggests running CI-like checks locally before push\n * CC 2.1.9: Injects CI suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Detect available CI checks based on project files\n */\nfunction detectCIChecks(projectDir: string): string[] {\n  const checks: string[] = [];\n\n  // Node.js project\n  if (existsSync(join(projectDir, 'package.json'))) {\n    checks.push('npm run lint');\n    checks.push('npm run typecheck');\n    checks.push('npm run test');\n  }\n\n  // Python project\n  if (existsSync(join(projectDir, 'pyproject.toml'))) {\n    checks.push('ruff check .');\n    checks.push('mypy .');\n    checks.push('pytest');\n  }\n\n  // Go project\n  if (existsSync(join(projectDir, 'go.mod'))) {\n    checks.push('go vet ./...');\n    checks.push('go test ./...');\n  }\n\n  return checks;\n}\n\n/**\n * Suggest CI checks before git push\n */\nexport function ciSimulation(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git push commands\n  if (!/git\\s+push/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Detect available checks\n  const checks = detectCIChecks(projectDir);\n\n  if (checks.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Pre-push CI simulation suggested:\n${checks.slice(0, 3).join('\\n')}\n\nRun these locally to catch issues before CI fails.\nOr: git push --no-verify to skip (not recommended)`;\n\n  logPermissionFeedback('allow', 'CI simulation suggested', input);\n  logHook('ci-simulation', `Suggested checks: ${checks.join(', ')}`);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Pre-Commit Simulation Hook\n * Suggests running pre-commit hooks locally\n * CC 2.1.9: Injects pre-commit suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check if pre-commit is configured\n */\nfunction hasPreCommitConfig(projectDir: string): boolean {\n  return (\n    existsSync(join(projectDir, '.pre-commit-config.yaml')) ||\n    existsSync(join(projectDir, '.pre-commit-config.yml'))\n  );\n}\n\n/**\n * Check if husky is configured\n */\nfunction hasHuskyConfig(projectDir: string): boolean {\n  return existsSync(join(projectDir, '.husky'));\n}\n\n/**\n * Suggest pre-commit checks before commit\n */\nexport function preCommitSimulation(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git commit commands\n  if (!/git\\s+commit/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if using --no-verify (skip hooks)\n  if (/--no-verify/.test(command)) {\n    const context = `WARNING: --no-verify will skip pre-commit hooks.\nConsider removing it unless intentional.\nSkipped checks may cause CI failures.`;\n\n    logPermissionFeedback('allow', 'Skip pre-commit detected', input);\n    logHook('pre-commit-simulation', '--no-verify used');\n    return outputAllowWithContext(context);\n  }\n\n  // Check for pre-commit configuration\n  if (hasPreCommitConfig(projectDir)) {\n    const context = `Pre-commit hooks will run: .pre-commit-config.yaml\nIf hooks fail, fix issues and retry.\nRun manually: pre-commit run --all-files`;\n\n    logPermissionFeedback('allow', 'pre-commit config found', input);\n    return outputAllowWithContext(context);\n  }\n\n  // Check for husky\n  if (hasHuskyConfig(projectDir)) {\n    const context = `Husky hooks will run: .husky/\nIf hooks fail, fix issues and retry.`;\n\n    logPermissionFeedback('allow', 'husky config found', input);\n    return outputAllowWithContext(context);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * PR Merge Gate Hook\n * Checks PR status before merge commands\n * CC 2.1.9: Injects PR status via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\n\ninterface PRStatus {\n  number: number;\n  state: string;\n  mergeable: boolean;\n  statusCheckRollup: string;\n  reviewDecision: string;\n}\n\n/**\n * Get PR status from GitHub CLI\n */\nfunction getPRStatus(projectDir: string, prNumber?: number): PRStatus | null {\n  try {\n    const prArg = prNumber ? `${prNumber}` : '';\n    const result = execSync(\n      `gh pr view ${prArg} --json number,state,mergeable,statusCheckRollup,reviewDecision 2>/dev/null`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    return JSON.parse(result) as PRStatus;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check PR status before merge\n */\nexport function prMergeGate(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process gh pr merge commands\n  if (!/gh\\s+pr\\s+merge/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract PR number if specified\n  const prMatch = command.match(/gh\\s+pr\\s+merge\\s+(\\d+)/);\n  const prNumber = prMatch ? parseInt(prMatch[1], 10) : undefined;\n\n  // Get PR status\n  const status = getPRStatus(projectDir, prNumber);\n\n  if (!status) {\n    const context = `Could not fetch PR status. Ensure:\n1. gh CLI is installed and authenticated\n2. You're in a git repository\n3. PR exists and is accessible`;\n\n    logPermissionFeedback('allow', 'PR status unavailable', input);\n    return outputAllowWithContext(context);\n  }\n\n  // Check if PR is mergeable\n  const issues: string[] = [];\n\n  if (status.state !== 'OPEN') {\n    issues.push(`PR state: ${status.state} (expected OPEN)`);\n  }\n\n  if (!status.mergeable) {\n    issues.push('PR has merge conflicts');\n  }\n\n  if (status.statusCheckRollup !== 'SUCCESS' && status.statusCheckRollup !== 'PENDING') {\n    issues.push(`Status checks: ${status.statusCheckRollup}`);\n  }\n\n  if (status.reviewDecision === 'CHANGES_REQUESTED') {\n    issues.push('Changes requested by reviewer');\n  }\n\n  if (issues.length > 0) {\n    const context = `PR #${status.number} has issues:\n${issues.join('\\n')}\n\nResolve these before merging.`;\n\n    logPermissionFeedback('allow', `PR issues: ${issues.join(', ')}`, input);\n    logHook('pr-merge-gate', `PR #${status.number} has ${issues.length} issues`);\n    return outputAllowWithContext(context);\n  }\n\n  // PR looks good\n  logPermissionFeedback('allow', `PR #${status.number} ready to merge`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Changelog Generator Hook\n * Suggests changelog entries for version bumps\n * CC 2.1.9: Injects changelog suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\n\n/**\n * Get recent commits for changelog\n */\nfunction getRecentCommits(projectDir: string, since?: string): string[] {\n  try {\n    const sinceArg = since ? `--since=\"${since}\"` : '--max-count=20';\n    const result = execSync(\n      `git log ${sinceArg} --pretty=format:\"%s\" 2>/dev/null || echo \"\"`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    return result.split('\\n').filter(Boolean);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Group commits by type for changelog\n */\nfunction groupCommitsByType(commits: string[]): Record<string, string[]> {\n  const groups: Record<string, string[]> = {\n    feat: [],\n    fix: [],\n    refactor: [],\n    docs: [],\n    test: [],\n    chore: [],\n    other: [],\n  };\n\n  for (const commit of commits) {\n    const match = commit.match(/^(feat|fix|refactor|docs|test|chore|perf|ci|build)/);\n    if (match) {\n      const type = match[1] === 'perf' || match[1] === 'ci' || match[1] === 'build' ? 'chore' : match[1];\n      groups[type].push(commit);\n    } else {\n      groups.other.push(commit);\n    }\n  }\n\n  return groups;\n}\n\n/**\n * Suggest changelog entries for version commands\n */\nexport function changelogGenerator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm version, poetry version, or changelog commands\n  if (!/npm\\s+version|poetry\\s+version|changelog/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get recent commits\n  const commits = getRecentCommits(projectDir);\n\n  if (commits.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Group by type\n  const groups = groupCommitsByType(commits);\n\n  // Build changelog suggestion\n  const sections: string[] = [];\n\n  if (groups.feat.length > 0) {\n    sections.push(`### Features\\n${groups.feat.slice(0, 5).map((c) => `- ${c}`).join('\\n')}`);\n  }\n  if (groups.fix.length > 0) {\n    sections.push(`### Bug Fixes\\n${groups.fix.slice(0, 5).map((c) => `- ${c}`).join('\\n')}`);\n  }\n  if (groups.refactor.length > 0 || groups.chore.length > 0) {\n    const combined = [...groups.refactor, ...groups.chore];\n    sections.push(`### Maintenance\\n${combined.slice(0, 3).map((c) => `- ${c}`).join('\\n')}`);\n  }\n\n  if (sections.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Suggested changelog entries:\n\n${sections.join('\\n\\n')}\n\nUpdate CHANGELOG.md before releasing.`;\n\n  logPermissionFeedback('allow', 'Changelog suggestions generated', input);\n  logHook('changelog-generator', `Generated ${sections.length} sections`);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Version Sync Hook\n * Checks version consistency across files\n * CC 2.1.9: Injects version warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\ninterface VersionSource {\n  file: string;\n  version: string | null;\n}\n\n/**\n * Extract version from package.json\n */\nfunction getPackageJsonVersion(projectDir: string): string | null {\n  const filePath = join(projectDir, 'package.json');\n  try {\n    if (existsSync(filePath)) {\n      const data = JSON.parse(readFileSync(filePath, 'utf8'));\n      return data.version || null;\n    }\n  } catch {\n    // Ignore\n  }\n  return null;\n}\n\n/**\n * Extract version from pyproject.toml\n */\nfunction getPyprojectVersion(projectDir: string): string | null {\n  const filePath = join(projectDir, 'pyproject.toml');\n  try {\n    if (existsSync(filePath)) {\n      const content = readFileSync(filePath, 'utf8');\n      const match = content.match(/version\\s*=\\s*[\"']([^\"']+)[\"']/);\n      return match ? match[1] : null;\n    }\n  } catch {\n    // Ignore\n  }\n  return null;\n}\n\n/**\n * Get all version sources\n */\nfunction getVersionSources(projectDir: string): VersionSource[] {\n  const sources: VersionSource[] = [];\n\n  const pkgVersion = getPackageJsonVersion(projectDir);\n  if (pkgVersion) {\n    sources.push({ file: 'package.json', version: pkgVersion });\n  }\n\n  const pyVersion = getPyprojectVersion(projectDir);\n  if (pyVersion) {\n    sources.push({ file: 'pyproject.toml', version: pyVersion });\n  }\n\n  return sources;\n}\n\n/**\n * Check version sync on version bump commands\n */\nexport function versionSync(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm version or poetry version commands\n  if (!/npm\\s+version|poetry\\s+version/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get all version sources\n  const sources = getVersionSources(projectDir);\n\n  if (sources.length < 2) {\n    return outputSilentSuccess();\n  }\n\n  // Check if versions are in sync\n  const versions = sources.map((s) => s.version);\n  const uniqueVersions = [...new Set(versions)];\n\n  if (uniqueVersions.length > 1) {\n    const context = `Version mismatch detected:\n${sources.map((s) => `${s.file}: ${s.version}`).join('\\n')}\n\nConsider syncing versions across all files.`;\n\n    logPermissionFeedback('allow', 'Version mismatch detected', input);\n    logHook('version-sync', `Versions: ${versions.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  // All in sync\n  logPermissionFeedback('allow', `Versions in sync: ${uniqueVersions[0]}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * License Compliance Hook\n * Checks for license compliance issues in dependencies\n * CC 2.1.9: Injects license warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Problematic license patterns\n */\nconst PROBLEMATIC_LICENSES = [\n  'GPL', // Copyleft\n  'AGPL', // Strong copyleft\n  'LGPL', // Weaker copyleft but still restrictive\n  'CC-BY-NC', // Non-commercial\n  'SSPL', // Server Side Public License\n];\n\n/**\n * Check package.json dependencies for license issues\n */\nfunction checkNpmLicenses(projectDir: string): string[] {\n  const issues: string[] = [];\n  const lockFile = join(projectDir, 'package-lock.json');\n\n  try {\n    if (existsSync(lockFile)) {\n      const content = readFileSync(lockFile, 'utf8');\n\n      for (const license of PROBLEMATIC_LICENSES) {\n        if (content.includes(`\"license\": \"${license}`)) {\n          issues.push(`Found ${license} license in npm dependencies`);\n        }\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  return issues;\n}\n\n/**\n * Check for license compliance on install commands\n */\nexport function licenseCompliance(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm install, yarn add, or pip install commands\n  if (!/npm\\s+install|yarn\\s+add|pip\\s+install|poetry\\s+add/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip if just installing from lock file\n  if (/npm\\s+ci|npm\\s+install\\s*$/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract package name\n  const pkgMatch = command.match(/(?:npm\\s+install|yarn\\s+add|pip\\s+install|poetry\\s+add)\\s+(\\S+)/);\n  const pkgName = pkgMatch ? pkgMatch[1] : null;\n\n  if (!pkgName) {\n    return outputSilentSuccess();\n  }\n\n  // Check existing licenses\n  const issues = checkNpmLicenses(projectDir);\n\n  if (issues.length > 0) {\n    const context = `License compliance check:\n${issues.join('\\n')}\n\nNew dependency: ${pkgName}\nConsider checking its license before adding.\n\nUse: npm view ${pkgName} license`;\n\n    logPermissionFeedback('allow', 'License compliance warning', input);\n    logHook('license-compliance', `Checking: ${pkgName}`);\n    return outputAllowWithContext(context);\n  }\n\n  // Suggest checking license\n  const context = `Installing: ${pkgName}\nVerify license compatibility before production use.\nCheck: npm view ${pkgName} license`;\n\n  logPermissionFeedback('allow', `Installing package: ${pkgName}`, input);\n  return outputAllowWithContext(context);\n}\n", "/**\n * GitHub Issue Creation Guide Hook\n * Provides guidance for creating GitHub issues\n * CC 2.1.9: Injects issue creation context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Issue templates based on type\n */\nconst ISSUE_TEMPLATES: Record<string, string> = {\n  bug: `## Description\n<!-- Clear description of the bug -->\n\n## Steps to Reproduce\n1.\n2.\n3.\n\n## Expected Behavior\n<!-- What should happen -->\n\n## Actual Behavior\n<!-- What actually happens -->\n\n## Environment\n- OS:\n- Version:`,\n\n  feature: `## Description\n<!-- Clear description of the feature -->\n\n## Motivation\n<!-- Why is this feature needed? -->\n\n## Proposed Solution\n<!-- How should this be implemented? -->\n\n## Alternatives Considered\n<!-- Other approaches considered -->`,\n\n  chore: `## Description\n<!-- What maintenance task needs to be done? -->\n\n## Impact\n<!-- What does this affect? -->\n\n## Checklist\n- [ ] Task 1\n- [ ] Task 2`,\n};\n\n/**\n * Detect issue type from command\n */\nfunction detectIssueType(command: string): string | null {\n  if (/--label.*bug|bug\\s+report/i.test(command)) return 'bug';\n  if (/--label.*feature|feature\\s+request/i.test(command)) return 'feature';\n  if (/--label.*chore|maintenance/i.test(command)) return 'chore';\n  return null;\n}\n\n/**\n * Provide guidance for GitHub issue creation\n */\nexport function ghIssueCreationGuide(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process gh issue create commands\n  if (!/gh\\s+issue\\s+create/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if already has body/template\n  if (/--body|--body-file|-b\\s/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Detect issue type\n  const issueType = detectIssueType(command);\n\n  if (issueType && ISSUE_TEMPLATES[issueType]) {\n    const context = `Issue type detected: ${issueType}\n\nSuggested template:\n${ISSUE_TEMPLATES[issueType].slice(0, 200)}...\n\nAdd --body with template or use --web for interactive creation.`;\n\n    logPermissionFeedback('allow', `Issue creation: ${issueType}`, input);\n    logHook('gh-issue-creation-guide', `Type: ${issueType}`);\n    return outputAllowWithContext(context);\n  }\n\n  // Generic guidance\n  const context = `Creating GitHub issue. Consider:\n- Clear, descriptive title\n- Add appropriate labels (bug, feature, chore)\n- Include reproduction steps for bugs\n- Reference related issues/PRs\n\nUse --web for interactive creation with templates.`;\n\n  logPermissionFeedback('allow', 'Issue creation guidance', input);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Issue Docs Requirement Hook\n * Reminds to update documentation for feature issues\n * CC 2.1.9: Injects documentation reminders via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Documentation checklist for features\n */\nconst DOCS_CHECKLIST = `Documentation checklist for features:\n- [ ] Update README.md if public API changes\n- [ ] Add/update JSDoc or docstrings\n- [ ] Update CHANGELOG.md\n- [ ] Add usage examples\n- [ ] Update API documentation`;\n\n/**\n * Remind about documentation for feature branches/issues\n */\nexport function issueDocsRequirement(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process gh issue close or gh pr merge for feature issues\n  if (!/gh\\s+(issue\\s+close|pr\\s+merge)/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if this is a feature (look for feat/feature labels or branch names)\n  const isFeature =\n    /--label.*feat/i.test(command) ||\n    /feat|feature/.test(command);\n\n  if (!isFeature) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Feature completion detected. Ensure documentation is updated.\n\n${DOCS_CHECKLIST}\n\nSkip with --no-edit if docs are already complete.`;\n\n  logPermissionFeedback('allow', 'Feature docs reminder', input);\n  logHook('issue-docs-requirement', 'Feature completion - docs reminder');\n  return outputAllowWithContext(context);\n}\n", "/**\n * Multi-Instance Quality Gate Hook\n * Enforces quality checks in multi-instance scenarios\n * CC 2.1.9: Injects quality gate context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check if multi-instance coordination is enabled\n */\nfunction isMultiInstanceEnabled(projectDir: string): boolean {\n  const dbPath = join(projectDir, '.claude', 'coordination', '.claude.db');\n  return existsSync(dbPath);\n}\n\n/**\n * Get quality gate status from work registry\n */\nfunction getQualityGateStatus(projectDir: string): Record<string, boolean> {\n  const registryPath = join(projectDir, '.claude', 'coordination', 'work-registry.json');\n\n  try {\n    if (existsSync(registryPath)) {\n      const data = JSON.parse(readFileSync(registryPath, 'utf8'));\n      return data.qualityGates || {};\n    }\n  } catch {\n    // Ignore\n  }\n\n  return {};\n}\n\n/**\n * Enforce quality gates before merge/deploy in multi-instance mode\n */\nexport function multiInstanceQualityGate(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process merge/deploy commands\n  if (!/gh\\s+pr\\s+merge|git\\s+merge|deploy/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if multi-instance is enabled\n  if (!isMultiInstanceEnabled(projectDir)) {\n    return outputSilentSuccess();\n  }\n\n  // Get quality gate status\n  const gates = getQualityGateStatus(projectDir);\n\n  // Check required gates\n  const requiredGates = ['tests', 'lint', 'typecheck'];\n  const failedGates = requiredGates.filter((gate) => !gates[gate]);\n\n  if (failedGates.length > 0) {\n    const context = `Multi-instance quality gate check:\nFailed/missing gates: ${failedGates.join(', ')}\n\nRun these checks before merging:\n${failedGates.map((g) => `- npm run ${g}`).join('\\n')}\n\nQuality gates ensure consistency across instances.`;\n\n    logPermissionFeedback('allow', `Quality gates failed: ${failedGates.join(', ')}`, input);\n    logHook('multi-instance-quality-gate', `Failed: ${failedGates.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  // All gates passed\n  logPermissionFeedback('allow', 'All quality gates passed', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Agent Browser Safety Hook\n * Validates agent-browser CLI commands for safety\n * CC 2.1.9: Injects safety context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Blocked URL patterns for agent-browser\n */\nconst BLOCKED_URL_PATTERNS = [\n  /localhost.*admin/i,\n  /127\\.0\\.0\\.1.*admin/i,\n  /internal\\./i,\n  /intranet\\./i,\n  /\\.local\\//i,\n  /file:\\/\\//i,\n  // Auth/OAuth provider domains - sensitive login pages\n  /accounts\\.google\\.com/i,\n  /login\\.microsoftonline\\.com/i,\n  /auth0\\.com/i,\n  /okta\\.com/i,\n  /login\\.live\\.com/i,\n  /appleid\\.apple\\.com/i,\n  /github\\.com\\/login/i,\n  /gitlab\\.com\\/users\\/sign_in/i,\n];\n\n/**\n * Sensitive action patterns\n */\nconst SENSITIVE_ACTIONS = [\n  'click.*delete',\n  'click.*remove',\n  'fill.*password',\n  'fill.*credit',\n  'submit.*payment',\n];\n\n/**\n * Extract URL from agent-browser command\n */\nfunction extractUrl(command: string): string | null {\n  const urlMatch = command.match(/(?:navigate|goto|open)\\s+[\"']?([^\"'\\s]+)[\"']?/i);\n  return urlMatch ? urlMatch[1] : null;\n}\n\n/**\n * Check if URL is blocked\n */\nfunction isBlockedUrl(url: string): boolean {\n  return BLOCKED_URL_PATTERNS.some((pattern) => pattern.test(url));\n}\n\n/**\n * Check if action is sensitive\n */\nfunction isSensitiveAction(command: string): boolean {\n  return SENSITIVE_ACTIONS.some((pattern) => new RegExp(pattern, 'i').test(command));\n}\n\n/**\n * Validate agent-browser commands for safety\n */\nexport function agentBrowserSafety(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process agent-browser commands\n  if (!/agent-browser|ab\\s/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract and check URL\n  const url = extractUrl(command);\n\n  if (url && isBlockedUrl(url)) {\n    logPermissionFeedback('deny', `Blocked URL: ${url}`, input);\n    logHook('agent-browser-safety', `BLOCKED: ${url}`);\n\n    return outputDeny(\n      `agent-browser blocked: URL matches blocked pattern.\n\nURL: ${url}\n\nBlocked patterns include internal, localhost admin, and file:// URLs.\nIf this is intentional, use direct browser access instead.`\n    );\n  }\n\n  // Check for sensitive actions\n  if (isSensitiveAction(command)) {\n    const context = `Sensitive browser action detected:\n${command.slice(0, 100)}...\n\nThis may interact with:\n- Delete/remove buttons\n- Password fields\n- Payment forms\n\nProceed with caution. Verify target elements.`;\n\n    logPermissionFeedback('allow', 'Sensitive action warning', input);\n    logHook('agent-browser-safety', 'Sensitive action detected');\n    return outputAllowWithContext(context);\n  }\n\n  // Safe command\n  logPermissionFeedback('allow', 'agent-browser command validated', input);\n  return outputSilentSuccess();\n}\n", "/**\n * File Guard Hook\n * Protects sensitive files from modification\n * CC 2.1.7 Compliant\n *\n * SECURITY: Resolves symlinks before checking patterns (ME-001 fix)\n * to prevent symlink-based bypasses of file protection.\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { realpathSync, existsSync } from 'node:fs';\nimport { resolve, isAbsolute } from 'node:path';\n\n/**\n * Protected file patterns - files that should NEVER be modified\n */\nconst PROTECTED_PATTERNS: RegExp[] = [\n  /\\.env$/,\n  /\\.env\\.local$/,\n  /\\.env\\.production$/,\n  /credentials\\.json$/,\n  /secrets\\.json$/,\n  /private\\.key$/,\n  /\\.pem$/,\n  /id_rsa$/,\n  /id_ed25519$/,\n];\n\n/**\n * Config patterns - files to warn about but allow\n */\nconst CONFIG_PATTERNS: RegExp[] = [\n  /package\\.json$/,\n  /pyproject\\.toml$/,\n  /tsconfig\\.json$/,\n];\n\n/**\n * Resolve file path, following symlinks\n */\nfunction resolveRealPath(filePath: string, projectDir: string): string {\n  try {\n    // Make absolute if relative\n    const absolutePath = isAbsolute(filePath)\n      ? filePath\n      : resolve(projectDir, filePath);\n\n    // Follow symlinks if file exists\n    if (existsSync(absolutePath)) {\n      return realpathSync(absolutePath);\n    }\n\n    return absolutePath;\n  } catch {\n    return filePath;\n  }\n}\n\n/**\n * Check if file matches protected patterns\n */\nfunction isProtected(realPath: string): RegExp | null {\n  for (const pattern of PROTECTED_PATTERNS) {\n    if (pattern.test(realPath)) {\n      return pattern;\n    }\n  }\n  return null;\n}\n\n/**\n * Check if file is a config file\n */\nfunction isConfigFile(realPath: string): boolean {\n  return CONFIG_PATTERNS.some((pattern) => pattern.test(realPath));\n}\n\n/**\n * Guard against modifying sensitive files\n */\nexport function fileGuard(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = getProjectDir();\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  logHook('file-guard', `File write/edit: ${filePath}`);\n\n  // Resolve symlinks to prevent bypass attacks (ME-001 fix)\n  const realPath = resolveRealPath(filePath, projectDir);\n  logHook('file-guard', `Resolved path: ${realPath}`);\n\n  // Check if file matches protected patterns\n  const matchedPattern = isProtected(realPath);\n\n  if (matchedPattern) {\n    logPermissionFeedback('deny', `Protected file blocked: ${filePath} (pattern: ${matchedPattern})`, input);\n    logHook('file-guard', `BLOCKED: ${filePath} matches ${matchedPattern}`);\n\n    return outputDeny(\n      `Cannot modify protected file: ${filePath}\n\nResolved path: ${realPath}\nMatched pattern: ${matchedPattern}\n\nProtected files include:\n- Environment files (.env, .env.local, .env.production)\n- Credential files (credentials.json, secrets.json)\n- Private keys (.pem, id_rsa, id_ed25519)\n\nIf you need to modify this file, do it manually outside Claude Code.`\n    );\n  }\n\n  // Warn on config files (but allow)\n  if (isConfigFile(realPath)) {\n    logHook('file-guard', `WARNING: Config file modification: ${realPath}`);\n    logPermissionFeedback('warn', `Config file modification: ${filePath}`, input);\n  }\n\n  // Allow the write\n  logPermissionFeedback('allow', `File write allowed: ${filePath}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * File Lock Check Hook\n * Check/acquire locks before Write/Edit operations\n * CC 2.1.7 Compliant: ensures JSON output on all code paths\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\ninterface FileLock {\n  instance_id: string;\n  file_path: string;\n  acquired_at: string;\n  expires_at: string;\n}\n\ninterface LockDatabase {\n  locks?: FileLock[];\n}\n\n/**\n * Get coordination database path\n */\nfunction getCoordinationDbPath(projectDir: string): string {\n  return join(projectDir, '.claude', 'coordination', 'locks.json');\n}\n\n/**\n * Check if coordination is enabled\n */\nfunction isCoordinationEnabled(projectDir: string): boolean {\n  return existsSync(join(projectDir, '.claude', 'coordination'));\n}\n\n/**\n * Get current instance ID\n * CC 2.1.9+ should guarantee CLAUDE_SESSION_ID availability,\n * but we add a defensive fallback to prevent crashes.\n */\nfunction getInstanceId(): string {\n  return process.env.CLAUDE_SESSION_ID || `fallback-${process.pid}`;\n}\n\n/**\n * Check if file is locked by another instance\n */\nfunction isLockedByOther(projectDir: string, filePath: string): FileLock | null {\n  const dbPath = getCoordinationDbPath(projectDir);\n  const instanceId = getInstanceId();\n\n  try {\n    if (!existsSync(dbPath)) {\n      return null;\n    }\n\n    const data: LockDatabase = JSON.parse(readFileSync(dbPath, 'utf8'));\n    const locks = data.locks || [];\n    const now = new Date().toISOString();\n\n    // Find active lock by another instance\n    const lock = locks.find(\n      (l) =>\n        l.file_path === filePath &&\n        l.instance_id !== instanceId &&\n        l.expires_at > now\n    );\n\n    return lock || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check file locks before Write/Edit\n */\nexport function fileLockCheck(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = getProjectDir();\n  const toolName = input.tool_name;\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Check if coordination is enabled\n  if (!isCoordinationEnabled(projectDir)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip coordination directory itself\n  if (filePath.includes('.claude/coordination')) {\n    return outputSilentSuccess();\n  }\n\n  // Normalize path\n  const normalizedPath = filePath.startsWith(projectDir)\n    ? filePath.slice(projectDir.length + 1)\n    : filePath;\n\n  // Check for existing lock\n  const existingLock = isLockedByOther(projectDir, normalizedPath);\n\n  if (existingLock) {\n    logPermissionFeedback(\n      'deny',\n      `File ${filePath} locked by ${existingLock.instance_id}`,\n      input\n    );\n    logHook('file-lock-check', `BLOCKED: ${filePath} locked by ${existingLock.instance_id}`);\n\n    return outputDeny(\n      `File ${filePath} is locked by instance ${existingLock.instance_id}.\n\nLock acquired at: ${existingLock.acquired_at}\nExpires at: ${existingLock.expires_at}\n\nYou may want to wait or check the work registry:\n.claude/coordination/work-registry.json`\n    );\n  }\n\n  // No conflicts\n  logPermissionFeedback('allow', `Lock check passed for ${filePath}`, input);\n  logHook('file-lock-check', `Lock check passed: ${filePath} (${toolName})`);\n  return outputSilentSuccess();\n}\n", "/**\n * Multi-Instance File Lock Hook\n * Acquires file locks before Write/Edit operations to prevent conflicts\n * CC 2.1.7 Compliant: Self-contained hook with proper block format\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join, dirname } from 'node:path';\nimport { guardWriteEdit } from '../../lib/guards.js';\n\ninterface FileLock {\n  lock_id: string;\n  file_path: string;\n  lock_type: string;\n  instance_id: string;\n  acquired_at: string;\n  expires_at: string;\n  reason?: string;\n}\n\ninterface LockDatabase {\n  locks: FileLock[];\n}\n\n/**\n * Get locks file path\n */\nfunction getLocksFilePath(projectDir: string): string {\n  return join(projectDir, '.claude', 'coordination', 'locks.json');\n}\n\n/**\n * Generate unique lock ID\n */\nfunction generateLockId(): string {\n  return `lock-${Date.now()}-${Math.random().toString(36).slice(2, 10)}`;\n}\n\n/**\n * Get current instance ID\n * CC 2.1.9+ should guarantee CLAUDE_SESSION_ID availability,\n * but we add a defensive fallback to prevent crashes.\n */\nfunction getInstanceId(): string {\n  return process.env.CLAUDE_SESSION_ID || `fallback-${process.pid}`;\n}\n\n/**\n * Calculate lock expiry (60 seconds from now)\n */\nfunction calculateExpiry(): string {\n  const expiry = new Date(Date.now() + 60 * 1000);\n  return expiry.toISOString();\n}\n\n/**\n * Load locks database\n */\nfunction loadLocks(locksPath: string): LockDatabase {\n  try {\n    if (existsSync(locksPath)) {\n      return JSON.parse(readFileSync(locksPath, 'utf8'));\n    }\n  } catch {\n    // Ignore\n  }\n  return { locks: [] };\n}\n\n/**\n * Save locks database\n */\nfunction saveLocks(locksPath: string, data: LockDatabase): void {\n  const dir = dirname(locksPath);\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n  writeFileSync(locksPath, JSON.stringify(data, null, 2));\n}\n\n/**\n * Check for existing lock by another instance\n */\nfunction checkExistingLock(\n  locks: FileLock[],\n  filePath: string,\n  instanceId: string\n): FileLock | null {\n  const now = new Date().toISOString();\n\n  return (\n    locks.find(\n      (l) =>\n        l.file_path === filePath &&\n        l.instance_id !== instanceId &&\n        l.expires_at > now\n    ) || null\n  );\n}\n\n/**\n * Check for directory lock that covers this file\n */\nfunction checkDirectoryLock(\n  locks: FileLock[],\n  filePath: string,\n  instanceId: string\n): FileLock | null {\n  const now = new Date().toISOString();\n\n  return (\n    locks.find(\n      (l) =>\n        l.lock_type === 'directory' &&\n        filePath.startsWith(l.file_path) &&\n        l.instance_id !== instanceId &&\n        l.expires_at > now\n    ) || null\n  );\n}\n\n/**\n * Acquire or refresh a file lock\n */\nfunction acquireLock(\n  data: LockDatabase,\n  filePath: string,\n  instanceId: string,\n  reason: string\n): void {\n  // Remove any existing lock for this file by this instance\n  data.locks = data.locks.filter(\n    (l) => !(l.file_path === filePath && l.instance_id === instanceId)\n  );\n\n  // Clean expired locks\n  const now = new Date().toISOString();\n  data.locks = data.locks.filter((l) => l.expires_at > now);\n\n  // Add new lock\n  data.locks.push({\n    lock_id: generateLockId(),\n    file_path: filePath,\n    lock_type: 'exclusive_write',\n    instance_id: instanceId,\n    acquired_at: now,\n    expires_at: calculateExpiry(),\n    reason,\n  });\n}\n\n/**\n * Multi-instance file lock acquisition\n */\nexport function multiInstanceLock(input: HookInput): HookResult {\n  // Only process Write and Edit tools\n  const guardResult = guardWriteEdit(input);\n  if (guardResult) return guardResult;\n\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = getProjectDir();\n  const toolName = input.tool_name;\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Get locks file path\n  const locksPath = getLocksFilePath(projectDir);\n\n  // Check if instance identity exists\n  const instanceDir = join(projectDir, '.instance');\n  if (!existsSync(join(instanceDir, 'id.json'))) {\n    logHook('multi-instance-lock', 'No instance identity, passing through');\n    return outputSilentSuccess();\n  }\n\n  // Normalize path\n  const normalizedPath = filePath.startsWith(projectDir)\n    ? filePath.slice(projectDir.length + 1)\n    : filePath;\n\n  const instanceId = getInstanceId();\n\n  // Load locks\n  const data = loadLocks(locksPath);\n\n  // Check for directory lock\n  const dirLock = checkDirectoryLock(data.locks, normalizedPath, instanceId);\n  if (dirLock) {\n    logPermissionFeedback(\n      'deny',\n      `Directory ${dirLock.file_path} locked by ${dirLock.instance_id}`,\n      input\n    );\n    logHook('multi-instance-lock', `BLOCKED: Directory lock by ${dirLock.instance_id}`);\n\n    return outputDeny(\n      `Directory ${dirLock.file_path} is locked by another Claude instance (${dirLock.instance_id}).\nWait for lock release.`\n    );\n  }\n\n  // Check for file lock\n  const fileLock = checkExistingLock(data.locks, normalizedPath, instanceId);\n  if (fileLock) {\n    logPermissionFeedback(\n      'deny',\n      `File ${normalizedPath} locked by ${fileLock.instance_id}`,\n      input\n    );\n    logHook('multi-instance-lock', `BLOCKED: ${normalizedPath} locked by ${fileLock.instance_id}`);\n\n    return outputDeny(\n      `File ${normalizedPath} is locked by another Claude instance (${fileLock.instance_id}).\nWait for lock release.`\n    );\n  }\n\n  // Acquire lock\n  acquireLock(data, normalizedPath, instanceId, `Modifying via ${toolName}`);\n  saveLocks(locksPath, data);\n\n  logHook('multi-instance-lock', `Lock acquired: ${normalizedPath}`);\n  logPermissionFeedback('allow', `Lock acquired for ${normalizedPath}`, input);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Architecture Change Detector Hook\n * Detects breaking architectural changes and injects guidelines\n * CC 2.1.9 Enhanced: Injects architectural guidelines as additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { guardPathPattern } from '../../lib/guards.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Architectural layer definitions\n */\ntype ArchLayer = 'api-layer' | 'service-layer' | 'data-layer' | 'workflow-layer' | 'unknown';\n\n/**\n * Path patterns for architectural layers\n */\nconst LAYER_PATTERNS: Record<ArchLayer, RegExp[]> = {\n  'api-layer': [/\\/api\\//, /\\/routes\\//, /\\/endpoints\\//],\n  'service-layer': [/\\/services\\//],\n  'data-layer': [/\\/db\\//, /\\/models\\//, /\\/repositories\\//],\n  'workflow-layer': [/\\/workflows\\//, /\\/agents\\//],\n  unknown: [],\n};\n\n/**\n * Determine architectural layer from file path\n */\nfunction detectArchLayer(filePath: string): ArchLayer {\n  for (const [layer, patterns] of Object.entries(LAYER_PATTERNS)) {\n    if (layer === 'unknown') continue;\n    if (patterns.some((p) => p.test(filePath))) {\n      return layer as ArchLayer;\n    }\n  }\n  return 'unknown';\n}\n\n/**\n * Load pattern hints from project patterns directory\n */\nfunction loadPatternHints(layer: ArchLayer, projectDir: string): string {\n  const patternsDir = join(projectDir, '.claude', 'context', 'patterns');\n  const layerPatternFile = join(patternsDir, `${layer}.json`);\n\n  try {\n    if (existsSync(layerPatternFile)) {\n      const content = readFileSync(layerPatternFile, 'utf8');\n      const patterns = JSON.parse(content);\n      const count = Array.isArray(patterns) ? patterns.length : Object.keys(patterns).length;\n      if (count > 0) {\n        return ` | Patterns loaded: ${count}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return '';\n}\n\n/**\n * Detect architectural changes and inject context\n */\nexport function architectureChangeDetector(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Self-guard: Only run for architectural paths\n  const archPatterns = [\n    '**/api/**',\n    '**/services/**',\n    '**/db/**',\n    '**/models/**',\n    '**/workflows/**',\n  ];\n  const guardResult = guardPathPattern(input, ...archPatterns);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  // Determine architectural layer\n  const archLayer = detectArchLayer(filePath);\n\n  if (archLayer === 'unknown') {\n    return outputSilentSuccess();\n  }\n\n  // Load pattern hints\n  const patternHints = loadPatternHints(archLayer, projectDir);\n\n  // Check if file exists (new file vs modification)\n  const isNewFile = !existsSync(filePath);\n\n  // Build architecture context\n  let archContext: string;\n  if (isNewFile) {\n    archContext = `New ${archLayer} file. Follow layer conventions: dependency injection, interface contracts${patternHints}`;\n  } else {\n    archContext = `Modifying ${archLayer}. Ensure: no breaking API changes, maintain layer boundaries${patternHints}`;\n  }\n\n  logPermissionFeedback('allow', `Architectural change: ${filePath} (${archLayer})`, input);\n  logHook('architecture-change-detector', `ARCH_DETECT: ${filePath} (layer=${archLayer})`);\n\n  // CC 2.1.9: Inject context\n  return outputWithContext(archContext);\n}\n", "/**\n * Code Quality Gate Hook\n * Unified code quality checks before write\n * Consolidates: complexity-gate.sh + type-check-on-save.sh\n *\n * Analyzes code quality BEFORE allowing write:\n * - Checks function length (>50 lines = warning)\n * - Checks cyclomatic complexity patterns (nested if/loops)\n * - Checks for existing type errors in the file being modified (cached results)\n *\n * CC 2.1.9 Compliant: Uses additionalContext for quality warnings\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { guardCodeFiles, guardSkipInternal, runGuards } from '../../lib/guards.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join, dirname, extname } from 'node:path';\n\n// Thresholds\nconst MAX_FUNCTION_LINES = 50;\nconst MAX_NESTING_DEPTH = 4;\nconst MAX_CONDITIONALS_PER_FUNCTION = 10;\n\n/**\n * Get file extension in lowercase\n */\nfunction getFileExt(filePath: string): string {\n  return extname(filePath).toLowerCase().replace('.', '');\n}\n\n/**\n * Check for long functions in the content\n */\nfunction checkFunctionLength(content: string, ext: string): string[] {\n  const warnings: string[] = [];\n  const lines = content.split('\\n');\n\n  if (ext === 'py') {\n    // Python: Track function definitions and line counts\n    let inFunction = false;\n    let functionName = '';\n    let functionLines = 0;\n\n    for (const line of lines) {\n      const defMatch = line.match(/^(\\s*)(?:async\\s+)?def\\s+([a-zA-Z_][a-zA-Z0-9_]*)/);\n      const classMatch = line.match(/^(\\s*)class\\s+/);\n\n      if (defMatch) {\n        // Check previous function if too long\n        if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n          warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n        }\n\n        inFunction = true;\n        functionName = defMatch[2];\n        functionLines = 1;\n      } else if (classMatch) {\n        // Class definition resets function tracking\n        if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n          warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n        }\n        inFunction = false;\n      } else if (inFunction) {\n        // Count non-empty lines in function\n        if (line.trim()) {\n          functionLines++;\n        }\n      }\n    }\n\n    // Check last function\n    if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n      warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n    }\n  } else if (['ts', 'tsx', 'js', 'jsx', 'go', 'java', 'rs'].includes(ext)) {\n    // Brace-based languages: Count lines between braces\n    let braceCount = 0;\n    let functionLines = 0;\n    let inFunction = false;\n    let functionName = '';\n\n    for (const line of lines) {\n      // Function detection\n      const funcMatch = line.match(/(?:function|func|fn)\\s+([a-zA-Z_][a-zA-Z0-9_]*)/);\n      const constFuncMatch = line.match(/const\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*(?:async\\s*)?\\(/);\n\n      if (funcMatch) {\n        functionName = funcMatch[1];\n        inFunction = true;\n        functionLines = 0;\n        braceCount = 0;\n      } else if (constFuncMatch) {\n        functionName = constFuncMatch[1];\n        inFunction = true;\n        functionLines = 0;\n        braceCount = 0;\n      }\n\n      if (inFunction) {\n        // Count braces\n        const openBraces = (line.match(/\\{/g) || []).length;\n        const closeBraces = (line.match(/\\}/g) || []).length;\n        braceCount += openBraces - closeBraces;\n\n        if (line.trim()) {\n          functionLines++;\n        }\n\n        // Function ended\n        if (braceCount <= 0 && functionLines > 0) {\n          if (functionLines > MAX_FUNCTION_LINES) {\n            warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n          }\n          inFunction = false;\n        }\n      }\n    }\n  }\n\n  return warnings;\n}\n\n/**\n * Check for deep nesting (cyclomatic complexity indicator)\n */\nfunction checkNestingDepth(content: string, ext: string): string[] {\n  const warnings: string[] = [];\n  const lines = content.split('\\n');\n  let maxDepth = 0;\n\n  if (ext === 'py') {\n    // Python: Count indent levels at control structures\n    for (const line of lines) {\n      const match = line.match(/^(\\s*)(if|for|while|with|try|elif|else|except|finally)[\\s:]/);\n      if (match) {\n        const indent = match[1].length;\n        const depth = Math.floor(indent / 4); // Assume 4-space indent\n        if (depth > maxDepth) {\n          maxDepth = depth;\n        }\n      }\n    }\n  } else if (['ts', 'tsx', 'js', 'jsx', 'go', 'java', 'rs'].includes(ext)) {\n    // Brace-based: Count brace depth at control structures\n    let braceDepth = 0;\n    for (const line of lines) {\n      const openBraces = (line.match(/\\{/g) || []).length;\n      const closeBraces = (line.match(/\\}/g) || []).length;\n      braceDepth += openBraces - closeBraces;\n\n      // Check if this line has a control structure\n      if (/(?:if|for|while|switch|try)\\s*\\(/.test(line)) {\n        if (braceDepth > maxDepth) {\n          maxDepth = braceDepth;\n        }\n      }\n    }\n  }\n\n  if (maxDepth > MAX_NESTING_DEPTH) {\n    warnings.push(`Deep nesting detected (depth: ${maxDepth}, max: ${MAX_NESTING_DEPTH})`);\n  }\n\n  return warnings;\n}\n\n/**\n * Count conditionals (cyclomatic complexity heuristic)\n */\nfunction checkConditionals(content: string): string[] {\n  const warnings: string[] = [];\n\n  const ifCount = (content.match(/\\b(if|elif|else if)\\b/g) || []).length;\n  const switchCount = (content.match(/\\b(switch|match)\\b/g) || []).length;\n  const ternaryCount = (content.match(/\\?[^:]+:/g) || []).length;\n\n  const totalConditionals = ifCount + switchCount + ternaryCount;\n\n  // Estimate functions\n  const functionCount = Math.max((content.match(/\\b(def|function|func|fn)\\b/g) || []).length, 1);\n  const avgConditionals = Math.floor(totalConditionals / functionCount);\n\n  if (avgConditionals > MAX_CONDITIONALS_PER_FUNCTION) {\n    warnings.push(`High cyclomatic complexity (~${avgConditionals} conditionals/function, consider refactoring)`);\n  }\n\n  return warnings;\n}\n\n/**\n * Get cached type errors for a file\n */\nfunction getCachedTypeErrors(filePath: string, projectDir: string): string {\n  const cacheFile = join(projectDir, '.claude', 'cache', 'type-errors.json');\n\n  if (!existsSync(cacheFile)) {\n    return '';\n  }\n\n  try {\n    const cache = JSON.parse(readFileSync(cacheFile, 'utf8'));\n    const basename = filePath.split('/').pop() || '';\n    return cache[basename] || '';\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Code quality gate - analyzes quality before allowing write\n */\nexport function codeQualityGate(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles, guardSkipInternal);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath || !content) {\n    return outputSilentSuccess();\n  }\n\n  const ext = getFileExt(filePath);\n  const allWarnings: string[] = [];\n\n  // Run complexity checks\n  allWarnings.push(...checkFunctionLength(content, ext));\n  allWarnings.push(...checkNestingDepth(content, ext));\n  allWarnings.push(...checkConditionals(content));\n\n  // Check cached type errors\n  const typeErrors = getCachedTypeErrors(filePath, projectDir);\n  if (typeErrors) {\n    allWarnings.push(typeErrors);\n  }\n\n  // Build quality message\n  if (allWarnings.length > 0) {\n    logHook('code-quality-gate', `Quality warnings for ${filePath}: ${allWarnings.join(', ')}`);\n\n    let qualityMsg = `Code quality: ${allWarnings.join(' | ')}`;\n\n    // Truncate if too long\n    if (qualityMsg.length > 350) {\n      qualityMsg = qualityMsg.slice(0, 347) + '...';\n    }\n\n    return outputWithContext(qualityMsg);\n  }\n\n  logHook('code-quality-gate', `No quality issues in ${filePath}`);\n  return outputSilentSuccess();\n}\n", "/**\n * Docstring Enforcer Hook\n * Checks if public functions have docstrings\n * For Python: checks for triple-quote docstrings\n * For TypeScript: checks for JSDoc comments\n *\n * CC 2.1.9 Enhanced: Uses additionalContext for warnings (does not block)\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n} from '../../lib/common.js';\nimport { guardCodeFiles, guardSkipInternal, runGuards } from '../../lib/guards.js';\nimport { extname } from 'node:path';\n\n/**\n * Get file extension in lowercase\n */\nfunction getFileExt(filePath: string): string {\n  return extname(filePath).toLowerCase().replace('.', '');\n}\n\n/**\n * Check if file is a test file\n */\nfunction isTestFile(filePath: string): boolean {\n  const testPatterns = [\n    /test/i,\n    /spec/i,\n    /__tests__/i,\n    /_test\\.py$/,\n    /\\.test\\.ts$/,\n    /\\.spec\\.ts$/,\n  ];\n  return testPatterns.some((p) => p.test(filePath));\n}\n\n/**\n * Find Python functions missing docstrings\n */\nfunction findMissingPythonDocstrings(content: string): string[] {\n  const missing: string[] = [];\n  const lines = content.split('\\n');\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    // Match public function definitions (not starting with _)\n    const funcMatch = line.match(/^(?:\\s*)(?:async\\s+)?def\\s+([^_][a-zA-Z0-9_]*)\\s*\\(/);\n\n    if (funcMatch) {\n      const funcName = funcMatch[1];\n\n      // Look for docstring on next non-empty line\n      let hasDocstring = false;\n      for (let j = i + 1; j < lines.length; j++) {\n        const nextLine = lines[j].trim();\n        if (!nextLine) continue; // Skip empty lines\n\n        if (nextLine.startsWith('\"\"\"') || nextLine.startsWith(\"'''\")) {\n          hasDocstring = true;\n        }\n        break;\n      }\n\n      if (!hasDocstring) {\n        missing.push(funcName);\n        if (missing.length >= 5) break; // Limit to 5\n      }\n    }\n  }\n\n  return missing;\n}\n\n/**\n * Find TypeScript/JavaScript exported functions missing JSDoc\n */\nfunction findMissingJSDoc(content: string): string[] {\n  const missing: string[] = [];\n  const lines = content.split('\\n');\n\n  let hasJSDoc = false;\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const prevLine = i > 0 ? lines[i - 1].trim() : '';\n\n    // Check if previous line ends JSDoc\n    if (prevLine.endsWith('*/')) {\n      hasJSDoc = true;\n    }\n\n    // Check for exported function\n    const exportMatch = line.match(\n      /^export\\s+(?:async\\s+)?(?:function\\s+([a-zA-Z][a-zA-Z0-9_]*)|const\\s+([a-zA-Z][a-zA-Z0-9_]*)\\s*=)/\n    );\n\n    if (exportMatch) {\n      const funcName = exportMatch[1] || exportMatch[2];\n\n      if (!hasJSDoc) {\n        missing.push(funcName);\n        if (missing.length >= 5) break; // Limit to 5\n      }\n      hasJSDoc = false;\n    } else if (!line.trim().endsWith('*/')) {\n      hasJSDoc = false;\n    }\n  }\n\n  return missing;\n}\n\n/**\n * Docstring enforcer - warns about missing documentation\n */\nexport function docstringEnforcer(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles, guardSkipInternal);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath || !content) {\n    return outputSilentSuccess();\n  }\n\n  // Skip test files - docstrings are less critical\n  if (isTestFile(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  const ext = getFileExt(filePath);\n  let missingDocstrings: string[] = [];\n\n  if (ext === 'py') {\n    missingDocstrings = findMissingPythonDocstrings(content);\n  } else if (['ts', 'tsx', 'js', 'jsx'].includes(ext)) {\n    missingDocstrings = findMissingJSDoc(content);\n  }\n\n  if (missingDocstrings.length > 0) {\n    const funcList = missingDocstrings.join(', ');\n    let contextMsg: string;\n\n    if (ext === 'py') {\n      contextMsg = `Documentation: ${missingDocstrings.length} public function(s) missing docstrings: ${funcList}. Consider adding \"\"\"docstrings\"\"\" for better code documentation.`;\n    } else {\n      contextMsg = `Documentation: ${missingDocstrings.length} exported function(s) missing JSDoc: ${funcList}. Consider adding /** JSDoc */ comments for better IDE support.`;\n    }\n\n    // Truncate if too long\n    if (contextMsg.length > 200) {\n      if (ext === 'py') {\n        contextMsg = `Documentation: ${missingDocstrings.length} public function(s) missing docstrings. Add \"\"\"docstrings\"\"\" for better documentation.`;\n      } else {\n        contextMsg = `Documentation: ${missingDocstrings.length} exported function(s) missing JSDoc. Add /** JSDoc */ for better IDE support.`;\n      }\n    }\n\n    logHook('docstring-enforcer', `DOCSTRING_WARN: ${missingDocstrings.length} functions missing docs in ${filePath}`);\n    return outputWithContext(contextMsg);\n  }\n\n  // All public functions documented - allow silently\n  logHook('docstring-enforcer', `DOCSTRING_OK: All public functions documented in ${filePath}`);\n  return outputSilentSuccess();\n}\n", "/**\n * Security Pattern Validator Hook\n * Detects security anti-patterns before write\n * CC 2.1.7 Compliant: Self-contained hook with stdin reading and self-guard\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\nimport { guardCodeFiles, runGuards } from '../../lib/guards.js';\nimport { basename } from 'node:path';\n\n/**\n * Security patterns to detect\n */\ninterface SecurityPattern {\n  name: string;\n  pattern: RegExp;\n  severity: 'high' | 'medium' | 'low';\n}\n\nconst SECURITY_PATTERNS: SecurityPattern[] = [\n  {\n    name: 'Potential hardcoded secret detected',\n    pattern: /(api[_-]?key|password|secret|token)\\s*[=:]\\s*['\"][^'\"]+['\"]/i,\n    severity: 'high',\n  },\n  {\n    name: 'Potential SQL injection vulnerability',\n    pattern: /execute\\s*\\(\\s*['\"].*\\+|f['\"].*SELECT.*\\{/,\n    severity: 'high',\n  },\n  {\n    name: 'Dangerous eval/exec usage detected',\n    pattern: /eval\\s*\\(|exec\\s*\\(/,\n    severity: 'high',\n  },\n  {\n    name: 'Subprocess with shell=True detected',\n    pattern: /subprocess\\.(run|call|Popen).*shell\\s*=\\s*True/,\n    severity: 'medium',\n  },\n  {\n    name: 'Potential XSS vulnerability (innerHTML)',\n    pattern: /\\.innerHTML\\s*=|dangerouslySetInnerHTML/,\n    severity: 'medium',\n  },\n  {\n    name: 'Insecure random number generation',\n    pattern: /Math\\.random\\(\\).*(?:password|token|secret|key)/i,\n    severity: 'medium',\n  },\n  {\n    name: 'Potential command injection',\n    pattern: /os\\.system\\s*\\(|os\\.popen\\s*\\(/,\n    severity: 'high',\n  },\n  {\n    name: 'Insecure HTTP (should use HTTPS)',\n    pattern: /http:\\/\\/(?!localhost|127\\.0\\.0\\.1)/,\n    severity: 'low',\n  },\n];\n\n/**\n * Detect security issues in content\n */\nfunction detectSecurityIssues(content: string): string[] {\n  const issues: string[] = [];\n\n  for (const { name, pattern } of SECURITY_PATTERNS) {\n    if (pattern.test(content)) {\n      issues.push(name);\n    }\n  }\n\n  return issues;\n}\n\n/**\n * Security pattern validator - detects anti-patterns before write\n */\nexport function securityPatternValidator(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Detect security issues\n  const securityIssues = detectSecurityIssues(content);\n\n  if (securityIssues.length > 0) {\n    logHook('security-pattern-validator', `SECURITY_WARN: ${filePath} - ${securityIssues.join(', ')}`);\n\n    // Build warning message\n    const warningMsg = `Security warnings for ${basename(filePath)}: ${securityIssues.join(', ')}`;\n    logPermissionFeedback('warn', `Security issues in ${filePath}: ${securityIssues.join(', ')}`, input);\n\n    // CC 2.1.9: Use additionalContext for warnings\n    return outputWithContext(warningMsg);\n  }\n\n  logHook('security-pattern-validator', `SECURITY_OK: ${filePath}`);\n  logPermissionFeedback('allow', `No security issues in ${filePath}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Context7 Documentation Tracker Hook\n * Tracks context7 library lookups and injects cache state as additionalContext\n * CC 2.1.9 Enhanced\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n  getLogDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync, writeFileSync, appendFileSync, statSync, renameSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\n\nconst MAX_LOG_SIZE = 102400; // 100KB\n\n/**\n * Get telemetry log path\n */\nfunction getTelemetryLog(): string {\n  const logDir = getLogDir();\n  return join(logDir, 'context7-telemetry.log');\n}\n\n/**\n * Rotate log file if needed\n */\nfunction rotateLogIfNeeded(logFile: string): void {\n  try {\n    if (existsSync(logFile)) {\n      const stats = statSync(logFile);\n      if (stats.size > MAX_LOG_SIZE) {\n        renameSync(logFile, `${logFile}.old`);\n      }\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Calculate cache context from telemetry\n */\nfunction calculateCacheContext(logFile: string): string {\n  if (!existsSync(logFile)) {\n    return '';\n  }\n\n  try {\n    const content = readFileSync(logFile, 'utf8');\n    const lines = content.trim().split('\\n').filter(Boolean);\n\n    const totalQueries = lines.length;\n    if (totalQueries === 0) {\n      return '';\n    }\n\n    // Extract unique libraries\n    const librarySet = new Set<string>();\n    for (const line of lines) {\n      const match = line.match(/library=([^| ]+)/);\n      if (match && match[1] && match[1] !== '') {\n        librarySet.add(match[1]);\n      }\n    }\n\n    // Get recent unique libraries (last 3)\n    const recentLibraries: string[] = [];\n    for (let i = lines.length - 1; i >= 0 && recentLibraries.length < 3; i--) {\n      const match = lines[i].match(/library=([^| ]+)/);\n      if (match && match[1] && !recentLibraries.includes(match[1])) {\n        recentLibraries.push(match[1]);\n      }\n    }\n\n    const recentStr = recentLibraries.length > 0 ? recentLibraries.join(', ') : 'none';\n    return `Context7: ${totalQueries} queries, ${librarySet.size} libraries. Recent: ${recentStr}`;\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Context7 tracker - tracks library lookups and injects cache state\n */\nexport function context7Tracker(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process context7 MCP calls\n  if (!toolName.startsWith('mcp__context7__')) {\n    return outputSilentSuccess();\n  }\n\n  const libraryId = (input.tool_input.libraryId as string) || '';\n  const query = (input.tool_input.query as string) || '';\n\n  // Get log file path\n  const logDir = getLogDir();\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore mkdir errors\n  }\n\n  const telemetryLog = getTelemetryLog();\n  rotateLogIfNeeded(telemetryLog);\n\n  // Log the query\n  const timestamp = new Date().toISOString();\n  const logEntry = `${timestamp} | tool=${toolName} | library=${libraryId} | query_length=${query.length}\\n`;\n\n  try {\n    appendFileSync(telemetryLog, logEntry);\n  } catch {\n    // Ignore log errors\n  }\n\n  // Calculate cache context\n  const cacheContext = calculateCacheContext(telemetryLog);\n\n  logPermissionFeedback('allow', `Documentation lookup: ${libraryId}`, input);\n  logHook('context7-tracker', `Query: ${toolName} library=${libraryId}`);\n\n  // CC 2.1.9: Inject cache context if available\n  if (cacheContext) {\n    return outputWithContext(cacheContext);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Fabric Lazy Initialization Hook\n * Triggered once on first memory MCP call (CC 2.1.0 once:true)\n *\n * Graph-First Architecture (v2.1):\n * - Knowledge graph is ALWAYS ready (no configuration needed)\n * - Mem0 is optional enhancement (only if MEM0_API_KEY set)\n * - No warnings for missing mem0 - it's an enhancement, not a requirement\n *\n * Purpose: Perform one-time setup when memory is first used, rather than at session start.\n * This avoids overhead for sessions that never use memory operations.\n *\n * CC 2.1.9: Uses additionalContext for initialization message\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  getProjectDir,\n  getSessionId,\n} from '../../lib/common.js';\nimport { existsSync, mkdirSync, readFileSync, writeFileSync, readdirSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check for orphaned sessions that might have pending syncs\n */\nfunction checkOrphanedSessions(projectDir: string, currentSessionId: string): number {\n  const logsDir = join(projectDir, '.claude', 'logs');\n  let orphanedCount = 0;\n\n  if (!existsSync(logsDir)) {\n    return 0;\n  }\n\n  try {\n    const files = readdirSync(logsDir);\n    for (const file of files) {\n      if (file.startsWith('.mem0-pending-sync-') && file.endsWith('.json')) {\n        // Extract session ID from filename\n        const sessionId = file.replace('.mem0-pending-sync-', '').replace('.json', '');\n        if (sessionId !== currentSessionId && sessionId !== 'unknown') {\n          orphanedCount++;\n        }\n      }\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return orphanedCount;\n}\n\n/**\n * Initialize memory directories if needed\n */\nfunction initDirectories(projectDir: string): void {\n  const dirs = [\n    join(projectDir, '.claude', 'logs', 'mem0-processed'),\n    join(projectDir, '.claude', 'context', 'session'),\n  ];\n\n  for (const dir of dirs) {\n    try {\n      mkdirSync(dir, { recursive: true });\n    } catch {\n      // Ignore mkdir errors\n    }\n  }\n}\n\n/**\n * Validate MCP health (Graph-First architecture)\n */\nfunction validateMcpHealth(): 'enhanced' | 'ready' {\n  // Graph-First: graph is always ready, mem0 is optional enhancement\n  if (process.env.MEM0_API_KEY) {\n    return 'enhanced'; // Both graph and mem0 available\n  }\n  return 'ready'; // Graph-only mode (default, fully functional)\n}\n\n/**\n * Register this session as active\n */\nfunction registerSession(projectDir: string, sessionId: string): void {\n  const orphanCheckFile = join(projectDir, '.claude', 'logs', '.memory-fabric-sessions.json');\n  const now = new Date().toISOString();\n\n  try {\n    mkdirSync(join(projectDir, '.claude', 'logs'), { recursive: true });\n\n    let sessions: Record<string, { active: boolean; last_seen: string }> = {};\n\n    if (existsSync(orphanCheckFile)) {\n      const content = readFileSync(orphanCheckFile, 'utf8');\n      const data = JSON.parse(content);\n      sessions = data.sessions || {};\n    }\n\n    sessions[sessionId] = { active: true, last_seen: now };\n    writeFileSync(orphanCheckFile, JSON.stringify({ sessions }, null, 2));\n  } catch {\n    // Ignore registration errors\n  }\n}\n\n/**\n * Memory Fabric lazy initialization\n */\nexport function memoryFabricInit(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionId = input.session_id || getSessionId();\n\n  logHook('memory-fabric-init', 'Memory Fabric lazy initialization triggered');\n\n  // Run initialization tasks\n  initDirectories(projectDir);\n  registerSession(projectDir, sessionId);\n\n  // Check for orphaned sessions\n  const orphanedCount = checkOrphanedSessions(projectDir, sessionId);\n\n  // Validate MCP health\n  const health = validateMcpHealth();\n\n  logHook('memory-fabric-init', `Initialization complete: health=${health}, orphaned=${orphanedCount}`);\n\n  // Build initialization message (only for issues)\n  let msg = '';\n\n  // Only warn about orphaned sessions (actual issue that needs attention)\n  if (orphanedCount > 0) {\n    msg = `[Memory Fabric] Detected ${orphanedCount} orphaned session(s) with pending syncs.\\nConsider running maintenance: claude --maintenance`;\n  }\n\n  // Graph-First: Log positive status\n  if (health === 'enhanced') {\n    logHook('memory-fabric-init', 'Memory Fabric ready (enhanced mode with mem0)');\n  } else {\n    logHook('memory-fabric-init', 'Memory Fabric ready (graph mode)');\n  }\n\n  // If there's something to report (only orphaned sessions), output it\n  if (msg) {\n    return outputWithContext(msg);\n  }\n\n  // Silent success - Memory Fabric ready (no issues to report)\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Knowledge Graph Validator Hook\n * Validates memory operations to prevent accidental data loss\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWarning,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Memory validator - validates memory operations\n */\nexport function memoryValidator(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process memory MCP calls\n  if (!toolName.startsWith('mcp__memory__')) {\n    return outputSilentSuccess();\n  }\n\n  switch (toolName) {\n    case 'mcp__memory__delete_entities': {\n      // Check for bulk deletion\n      const entityNames = input.tool_input.entityNames;\n      const entityCount = Array.isArray(entityNames) ? entityNames.length : 0;\n\n      if (entityCount > 5) {\n        logPermissionFeedback('warn', `Bulk delete: ${entityCount} entities`, input);\n        logHook('memory-validator', `WARN: Bulk entity delete: ${entityCount} entities`);\n\n        // Warn but allow - let user confirm\n        return outputWarning(`Deleting ${entityCount} entities from knowledge graph`);\n      }\n      break;\n    }\n\n    case 'mcp__memory__delete_relations': {\n      // Check for bulk relation deletion\n      const relations = input.tool_input.relations;\n      const relationCount = Array.isArray(relations) ? relations.length : 0;\n\n      if (relationCount > 10) {\n        logPermissionFeedback('warn', `Bulk relation delete: ${relationCount} relations`, input);\n        logHook('memory-validator', `WARN: Bulk relation delete: ${relationCount} relations`);\n\n        return outputWarning(`Deleting ${relationCount} relations from knowledge graph`);\n      }\n      break;\n    }\n\n    case 'mcp__memory__create_entities': {\n      // Validate entity structure\n      const entities = input.tool_input.entities;\n      if (!Array.isArray(entities)) {\n        logPermissionFeedback('allow', 'Creating entities (non-array input)', input);\n        return outputSilentSuccess();\n      }\n\n      const entityCount = entities.length;\n\n      // Check each entity has required fields\n      const invalidCount = entities.filter(\n        (e: Record<string, unknown>) => !e.name || e.name === '' || !e.entityType || e.entityType === ''\n      ).length;\n\n      if (invalidCount > 0) {\n        logPermissionFeedback('warn', `Invalid entities: ${invalidCount} missing name or entityType`, input);\n        logHook('memory-validator', `WARN: ${invalidCount} entities missing required fields`);\n\n        return outputWarning(`${invalidCount} entities missing required fields (name, entityType)`);\n      }\n\n      logPermissionFeedback('allow', `Creating ${entityCount} valid entities`, input);\n      break;\n    }\n\n    case 'mcp__memory__create_relations': {\n      // Validate relation structure\n      const relations = input.tool_input.relations;\n      if (!Array.isArray(relations)) {\n        logPermissionFeedback('allow', 'Creating relations (non-array input)', input);\n        return outputSilentSuccess();\n      }\n\n      const relationCount = relations.length;\n\n      // Check each relation has required fields\n      const invalidCount = relations.filter(\n        (r: Record<string, unknown>) => !r.from || !r.to || !r.relationType\n      ).length;\n\n      if (invalidCount > 0) {\n        logPermissionFeedback('warn', `Invalid relations: ${invalidCount} missing from/to/relationType`, input);\n        logHook('memory-validator', `WARN: ${invalidCount} relations missing required fields`);\n\n        return outputWarning(`${invalidCount} relations missing required fields`);\n      }\n\n      logPermissionFeedback('allow', `Creating ${relationCount} valid relations`, input);\n      break;\n    }\n\n    default:\n      // Read operations - always allow\n      logPermissionFeedback('allow', `Read operation: ${toolName}`, input);\n      break;\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Sequential Thinking Auto-Tracker Hook\n * Tracks sequential thinking usage for complex reasoning tasks\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  logHook,\n  logPermissionFeedback,\n  getLogDir,\n} from '../../lib/common.js';\nimport { existsSync, appendFileSync, statSync, renameSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\n\nconst MAX_LOG_SIZE = 102400; // 100KB\n\n/**\n * Get thinking log path\n */\nfunction getThinkingLog(): string {\n  const logDir = getLogDir();\n  return join(logDir, 'sequential-thinking.log');\n}\n\n/**\n * Rotate log file if needed\n */\nfunction rotateLogIfNeeded(logFile: string): void {\n  try {\n    if (existsSync(logFile)) {\n      const stats = statSync(logFile);\n      if (stats.size > MAX_LOG_SIZE) {\n        renameSync(logFile, `${logFile}.old`);\n      }\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Sequential thinking tracker - tracks reasoning chain progress\n */\nexport function sequentialThinkingAuto(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process sequential-thinking MCP calls\n  if (!toolName.startsWith('mcp__sequential-thinking__')) {\n    return outputSilentSuccess();\n  }\n\n  // Extract thinking details\n  const thought = (input.tool_input.thought as string) || '';\n  const thoughtNumber = (input.tool_input.thoughtNumber as number) || 1;\n  const totalThoughts = (input.tool_input.totalThoughts as number) || 1;\n  const nextNeeded = (input.tool_input.nextThoughtNeeded as boolean) || false;\n  const isRevision = (input.tool_input.isRevision as boolean) || false;\n\n  // Get log file path\n  const logDir = getLogDir();\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore mkdir errors\n  }\n\n  const thinkingLog = getThinkingLog();\n  rotateLogIfNeeded(thinkingLog);\n\n  // Log the thinking step\n  const timestamp = new Date().toISOString();\n  const logEntry = `${timestamp} | step=${thoughtNumber}/${totalThoughts} | revision=${isRevision} | next_needed=${nextNeeded} | thought_length=${thought.length}\\n`;\n\n  try {\n    appendFileSync(thinkingLog, logEntry);\n  } catch {\n    // Ignore log errors\n  }\n\n  // Track reasoning chain progress\n  if (thoughtNumber === 1) {\n    logPermissionFeedback('allow', `Starting reasoning chain (${totalThoughts} estimated thoughts)`, input);\n    logHook('sequential-thinking-auto', `Starting chain: ${totalThoughts} thoughts`);\n  } else if (isRevision) {\n    logPermissionFeedback('allow', `Revision at step ${thoughtNumber}`, input);\n    logHook('sequential-thinking-auto', `Revision at step ${thoughtNumber}`);\n  } else if (!nextNeeded) {\n    logPermissionFeedback('allow', `Completed reasoning chain at step ${thoughtNumber}`, input);\n    logHook('sequential-thinking-auto', `Completed at step ${thoughtNumber}`);\n  } else {\n    logPermissionFeedback('allow', `Reasoning step ${thoughtNumber}/${totalThoughts}`, input);\n    logHook('sequential-thinking-auto', `Step ${thoughtNumber}/${totalThoughts}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Write Headers Hook\n * Adds standard headers to new files being created\n * Part of OrchestKit Claude Plugin\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, logHook } from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { extname } from 'node:path';\n\n/**\n * Get current date in YYYY-MM-DD format\n */\nfunction getCurrentDate(): string {\n  return new Date().toISOString().split('T')[0];\n}\n\n/**\n * Add header based on file type\n */\nfunction addHeader(ext: string, content: string): string {\n  const date = getCurrentDate();\n\n  switch (ext.toLowerCase()) {\n    case 'py':\n      return `# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n\n    case 'js':\n    case 'ts':\n      return `// Generated by OrchestKit Claude Plugin\n// Created: ${date}\n\n${content}`;\n\n    case 'sh': {\n      // For shell scripts, add after shebang if present\n      if (content.startsWith('#!/')) {\n        const firstNewline = content.indexOf('\\n');\n        const shebang = content.slice(0, firstNewline);\n        const rest = content.slice(firstNewline + 1);\n        return `${shebang}\n# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${rest}`;\n      }\n      return `#!/bin/bash\n# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n    }\n\n    case 'sql':\n      return `-- Generated by OrchestKit Claude Plugin\n-- Created: ${date}\n\n${content}`;\n\n    case 'html':\n    case 'xml':\n      return `<!-- Generated by OrchestKit Claude Plugin - ${date} -->\n\n${content}`;\n\n    case 'css':\n    case 'scss':\n    case 'sass':\n      return `/* Generated by OrchestKit Claude Plugin - ${date} */\n\n${content}`;\n\n    case 'yaml':\n    case 'yml':\n      return `# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n\n    case 'json':\n      // Don't add header for JSON (would break JSON format)\n      return content;\n\n    default:\n      // No header for unknown file types\n      return content;\n  }\n}\n\n/**\n * Create result with updated input\n */\nfunction createUpdatedInputResult(filePath: string, content: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'allow',\n      // Note: updatedInput is not in the HookSpecificOutput type\n      // but is used by CC for input modification\n    },\n  } as HookResult;\n}\n\n/**\n * Write headers hook - adds headers to new files\n */\nexport function writeHeaders(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Only process Write tool (not Edit - those are existing files)\n  if (toolName !== 'Write') {\n    return outputSilentSuccess();\n  }\n\n  // Check if file already exists (skip header if it does)\n  if (existsSync(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  // Get file extension\n  const ext = extname(filePath).replace('.', '');\n\n  // Skip if content already contains OrchestKit header\n  if (content.includes('OrchestKit')) {\n    logHook('write-headers', `Skipping header for ${filePath} (already has OrchestKit marker)`);\n    return outputSilentSuccess();\n  }\n\n  // Add header\n  const updatedContent = addHeader(ext, content);\n  const headerAdded = updatedContent !== content;\n\n  if (headerAdded) {\n    logHook('write-headers', `Added header to ${filePath}`);\n  }\n\n  // Return result with updated input\n  // Note: This uses the CC input modification pattern\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'allow',\n    },\n  };\n}\n", "/**\n * Skill Tracker Hook\n * Logs Skill tool invocations with analytics\n * CC 2.1.6 Compliant: includes continue field in all outputs\n *\n * Enhanced for Phase 4: Skill Usage Analytics (#56)\n * - Tracks skill usage patterns over time\n * - Enables context efficiency optimization\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, appendFileSync, mkdirSync } from 'node:fs';\nimport { join, dirname, basename } from 'node:path';\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  try {\n    if (!existsSync(dir)) {\n      mkdirSync(dir, { recursive: true });\n    }\n  } catch {\n    // Ignore mkdir errors\n  }\n}\n\n/**\n * Append to file safely\n */\nfunction appendSafe(file: string, content: string): void {\n  try {\n    ensureDir(dirname(file));\n    appendFileSync(file, content);\n  } catch {\n    // Ignore append errors\n  }\n}\n\n/**\n * Skill tracker - logs skill invocations with analytics\n */\nexport function skillTracker(input: HookInput): HookResult {\n  const skillName = (input.tool_input.skill as string) || '';\n  const skillArgs = (input.tool_input.args as string) || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  if (!skillName) {\n    return outputSilentSuccess();\n  }\n\n  logHook('skill-tracker', `Skill invocation: ${skillName}${skillArgs ? ` (args: ${skillArgs})` : ''}`);\n\n  // Log to temporary usage log for quick access\n  const usageLog = join(projectDir, '.claude', 'logs', 'skill-usage.log');\n  const timestamp = new Date().toISOString();\n  appendSafe(usageLog, `${timestamp} | ${skillName} | ${skillArgs || 'no args'}\\n`);\n\n  // Log to JSONL for detailed analytics\n  const analyticsLog = join(projectDir, '.claude', 'logs', 'skill-analytics.jsonl');\n  const analyticsEntry = JSON.stringify({\n    skill: skillName,\n    args: skillArgs || '',\n    timestamp,\n    project: basename(projectDir),\n    phase: 'start',\n  });\n  appendSafe(analyticsLog, analyticsEntry + '\\n');\n\n  logHook('skill-tracker', `Skill usage logged for ${skillName}`);\n\n  // CC 2.1.6 Compliant: JSON output without ANSI colors\n  return outputSilentSuccess();\n}\n", "/**\n * Backend File Naming Hook\n * BLOCKING: Backend files must follow naming conventions\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputBlock, logHook } from '../lib/common.js';\nimport { guardPythonFiles } from '../lib/guards.js';\n\n/**\n * Validate backend Python file naming conventions\n */\nexport function backendFileNaming(input: HookInput): HookResult {\n  // Self-guard: Only run for Python files\n  const guard = guardPythonFiles(input);\n  if (guard) return guard;\n\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  // Skip if not in an app/ or backend/ directory\n  if (!filePath.includes('/app/') && !filePath.includes('/backend/')) {\n    return outputSilentSuccess();\n  }\n\n  const filename = filePath.split('/').pop() || '';\n  const dirname = filePath.substring(0, filePath.lastIndexOf('/'));\n  const errors: string[] = [];\n\n  // Skip __init__.py files\n  if (filename === '__init__.py') return outputSilentSuccess();\n\n  // Router naming conventions\n  if (dirname.endsWith('/routers') || dirname.includes('/routers/')) {\n    const validRouterPattern = /^(router_|routes_|api_).*\\.py$/;\n    const utilPattern = /^(deps|dependencies|utils|helpers|base)\\.py$/;\n    if (!validRouterPattern.test(filename) && !utilPattern.test(filename)) {\n      errors.push('ROUTER NAMING: Files in routers/ must be prefixed');\n      errors.push(`  Got: ${filename}`);\n      errors.push('  Expected: router_*.py, routes_*.py, api_*.py, deps.py');\n    }\n  }\n\n  // Service naming conventions\n  if (dirname.endsWith('/services') || dirname.includes('/services/')) {\n    const validServicePattern = /_service\\.py$/;\n    const utilPattern = /^(base|utils|helpers|abstract)\\.py$/;\n    if (!validServicePattern.test(filename) && !utilPattern.test(filename)) {\n      errors.push('SERVICE NAMING: Files in services/ must end with _service.py');\n      errors.push(`  Got: ${filename}`);\n      errors.push('  Expected: *_service.py, base.py, utils.py');\n    }\n  }\n\n  // Repository naming conventions\n  if (dirname.endsWith('/repositories') || dirname.includes('/repositories/')) {\n    const validRepoPattern = /_(repository|repo)\\.py$/;\n    const utilPattern = /^(base|abstract|utils)\\.py$/;\n    if (!validRepoPattern.test(filename) && !utilPattern.test(filename)) {\n      errors.push('REPOSITORY NAMING: Files in repositories/ must end with _repository.py');\n      errors.push(`  Got: ${filename}`);\n      errors.push('  Expected: *_repository.py, *_repo.py, base.py');\n    }\n  }\n\n  // Schema naming conventions\n  if (dirname.endsWith('/schemas') || dirname.includes('/schemas/')) {\n    const validSchemaPattern = /_(schema|dto|request|response)\\.py$/;\n    const utilPattern = /^(base|common|shared|utils)\\.py$/;\n    if (!validSchemaPattern.test(filename) && !utilPattern.test(filename)) {\n      errors.push('SCHEMA NAMING: Files in schemas/ must use proper suffix');\n      errors.push(`  Got: ${filename}`);\n      errors.push('  Expected: *_schema.py, *_dto.py, *_request.py, *_response.py');\n    }\n  }\n\n  // Model naming conventions\n  if (dirname.endsWith('/models') || dirname.includes('/models/')) {\n    const validModelPattern = /_(model|entity|orm)\\.py$/;\n    const utilPattern = /^(base|abstract|mixins)\\.py$/;\n    if (!validModelPattern.test(filename) && !utilPattern.test(filename)) {\n      errors.push('MODEL NAMING: Files in models/ must use proper suffix');\n      errors.push(`  Got: ${filename}`);\n      errors.push('  Expected: *_model.py, *_entity.py, *_orm.py, base.py');\n    }\n  }\n\n  // General Python naming conventions - PascalCase check\n  if (/^[A-Z][a-zA-Z]+\\.py$/.test(filename)) {\n    errors.push('NAMING: Python files should use snake_case, not PascalCase');\n    errors.push(`  Got: ${filename}`);\n  }\n\n  // Report errors and block\n  if (errors.length > 0) {\n    const reason = `Backend naming violation in ${filename}: ${errors[0]}`;\n    logHook('backend-file-naming', `BLOCKED: ${reason}`);\n    return outputBlock(reason);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Unified Decision Processor Hook\n * Consolidates: mem0-decision-saver + decision-entity-extractor\n *\n * Hook: SkillComplete\n *\n * Purpose:\n * 1. Extract decisions from skill output\n * 2. Extract entities (Agent, Technology, Pattern) for graph memory\n * 3. Suggest mem0 storage with enriched metadata\n *\n * CC 2.1.16 Compliant - Enriched metadata for decision-history\n * Version: 2.0.0 - Consolidated from 2 hooks (~520 LOC \u2192 ~250 LOC)\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getPluginRoot } from '../lib/common.js';\nimport { execSync } from 'child_process';\nimport { readFileSync, existsSync } from 'fs';\nimport { join } from 'path';\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\nconst MIN_OUTPUT_LENGTH = 100;\nconst MAX_TEXT_LENGTH = 10240;\n\n// Decision indicators\nconst DECISION_INDICATORS = [\n  'decided', 'chose', 'selected', 'will use', 'implemented',\n  'architecture:', 'pattern:', 'approach:', 'recommendation:',\n  'best practice:', 'conclusion:',\n];\n\n// Known OrchestKit agents\nconst KNOWN_AGENTS = [\n  'database-engineer', 'backend-system-architect', 'frontend-ui-developer',\n  'security-auditor', 'test-generator', 'workflow-architect', 'llm-integrator',\n  'data-pipeline-engineer', 'metrics-architect', 'ux-researcher',\n  'ci-cd-engineer', 'infrastructure-architect', 'accessibility-specialist',\n];\n\n// Known technologies\nconst KNOWN_TECHNOLOGIES = [\n  'postgresql', 'postgres', 'pgvector', 'redis', 'mongodb', 'sqlite',\n  'fastapi', 'django', 'flask', 'express', 'nextjs',\n  'react', 'vue', 'angular', 'typescript', 'python',\n  'jwt', 'oauth', 'passkeys', 'langchain', 'langgraph', 'langfuse',\n  'docker', 'kubernetes', 'terraform', 'aws', 'gcp',\n  'pytest', 'jest', 'vitest', 'playwright', 'msw',\n];\n\n// Known patterns\nconst KNOWN_PATTERNS = [\n  'cursor-pagination', 'repository-pattern', 'service-layer', 'clean-architecture',\n  'dependency-injection', 'event-sourcing', 'cqrs', 'saga-pattern',\n  'circuit-breaker', 'rate-limiting', 'optimistic-locking',\n  'caching', 'cache-aside', 'rag', 'semantic-search',\n];\n\n// Best practice patterns (precompiled)\nconst BEST_PRACTICE_PATTERNS: [string, RegExp][] = [\n  ['cursor-pagination', /cursor[- ]?(based)?[- ]?pagination/i],\n  ['jwt-validation', /jwt|json web token/i],\n  ['dependency-injection', /dependency injection|di pattern|ioc/i],\n  ['rate-limiting', /rate[- ]?limit|throttl/i],\n  ['circuit-breaker', /circuit[- ]?breaker|resilience/i],\n  ['event-sourcing', /event[- ]?sourc/i],\n  ['cqrs', /cqrs|command.*query.*separation/i],\n  ['idempotency', /idempoten/i],\n];\n\n// Importance keywords\nconst HIGH_IMPORTANCE = ['critical', 'security', 'breaking', 'migration', 'architecture', 'production'];\nconst MEDIUM_IMPORTANCE = ['refactor', 'optimize', 'improve', 'update', 'enhance', 'fix'];\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\ninterface ExtractedEntities {\n  agents: string[];\n  technologies: string[];\n  patterns: string[];\n}\n\n// =============================================================================\n// VERSION DETECTION\n// =============================================================================\n\nlet cachedPluginVersion: string | null = null;\n\nfunction getCCVersion(): string {\n  if (process.env.CLAUDE_CODE_VERSION) return process.env.CLAUDE_CODE_VERSION;\n  try {\n    const output = execSync('claude --version 2>/dev/null', { encoding: 'utf-8', timeout: 2000 });\n    const match = output.match(/(\\d+\\.\\d+\\.\\d+)/);\n    if (match) return match[1];\n  } catch { /* ignore */ }\n  return '2.1.16';\n}\n\nfunction getPluginVersion(): string {\n  if (cachedPluginVersion) return cachedPluginVersion;\n  try {\n    const pluginRoot = getPluginRoot();\n    const path = join(pluginRoot, '.claude-plugin', 'plugin.json');\n    if (existsSync(path)) {\n      const content = JSON.parse(readFileSync(path, 'utf-8'));\n      cachedPluginVersion = (content.version as string) || 'unknown';\n      return cachedPluginVersion;\n    }\n  } catch { /* ignore */ }\n  cachedPluginVersion = 'unknown';\n  return cachedPluginVersion;\n}\n\n// =============================================================================\n// ENTITY EXTRACTION\n// =============================================================================\n\nfunction extractEntities(text: string): ExtractedEntities {\n  const textLower = text.toLowerCase();\n  return {\n    agents: [...new Set(KNOWN_AGENTS.filter(a => textLower.includes(a)))],\n    technologies: [...new Set(KNOWN_TECHNOLOGIES.filter(t => textLower.includes(t)))],\n    patterns: [...new Set(KNOWN_PATTERNS.filter(p => textLower.includes(p)))],\n  };\n}\n\nfunction detectRelationType(text: string): string {\n  const t = text.toLowerCase();\n  if (/recommend|suggests|advises/.test(t)) return 'RECOMMENDS';\n  if (/chose|selected|decided/.test(t)) return 'CHOSEN_FOR';\n  if (/replace|instead of/.test(t)) return 'REPLACES';\n  if (/conflict|incompatible/.test(t)) return 'CONFLICTS_WITH';\n  return 'RELATES_TO';\n}\n\n// =============================================================================\n// DECISION EXTRACTION\n// =============================================================================\n\nfunction hasDecisionContent(output: string): boolean {\n  const lower = output.toLowerCase();\n  return DECISION_INDICATORS.some(ind => lower.includes(ind));\n}\n\nfunction extractDecisions(output: string): string[] {\n  const decisions: string[] = [];\n  for (const indicator of DECISION_INDICATORS) {\n    const regex = new RegExp(`[^\\\\n]*${indicator}[^\\\\n]*`, 'gi');\n    const matches = output.match(regex);\n    if (matches) {\n      for (const match of matches.slice(0, 3)) {\n        const cleaned = match.trim().slice(0, 300);\n        if (cleaned.length > 30) decisions.push(cleaned);\n      }\n    }\n  }\n  return [...new Set(decisions)].slice(0, 5);\n}\n\nfunction detectCategory(text: string): string {\n  const t = text.slice(0, MAX_TEXT_LENGTH).toLowerCase();\n  if (/pagination|cursor|offset/.test(t)) return 'pagination';\n  if (/security|vulnerability|owasp/.test(t)) return 'security';\n  if (/database|sql|postgres|schema/.test(t)) return 'database';\n  if (/api|endpoint|rest|graphql/.test(t)) return 'api';\n  if (/auth|login|jwt|oauth/.test(t)) return 'authentication';\n  if (/test|pytest|jest|vitest/.test(t)) return 'testing';\n  if (/deploy|ci|cd|docker|kubernetes/.test(t)) return 'deployment';\n  if (/monitoring|logging|tracing|metrics/.test(t)) return 'observability';\n  if (/react|frontend|ui|tailwind/.test(t)) return 'frontend';\n  if (/llm|rag|embedding|langchain/.test(t)) return 'ai-ml';\n  if (/architecture|design|pattern/.test(t)) return 'architecture';\n  return 'decision';\n}\n\nfunction detectImportance(text: string): 'high' | 'medium' | 'low' {\n  const t = text.toLowerCase();\n  if (HIGH_IMPORTANCE.some(k => t.includes(k))) return 'high';\n  if (MEDIUM_IMPORTANCE.some(k => t.includes(k))) return 'medium';\n  return 'low';\n}\n\nfunction extractBestPractice(text: string): string | null {\n  for (const [name, pattern] of BEST_PRACTICE_PATTERNS) {\n    if (pattern.test(text)) return name;\n  }\n  return null;\n}\n\n// =============================================================================\n// MAIN HOOK\n// =============================================================================\n\nexport function decisionProcessor(input: HookInput): HookResult {\n  const skillName = (input as any).skill_name || input.tool_input?.skill || '';\n  const toolResult = input.tool_result;\n  const skillOutput = typeof toolResult === 'string'\n    ? toolResult\n    : (toolResult?.content || (input as any).output || '');\n\n  if (!skillOutput || skillOutput.length < MIN_OUTPUT_LENGTH) {\n    return outputSilentSuccess();\n  }\n\n  if (!hasDecisionContent(skillOutput)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract decisions and entities\n  const decisions = extractDecisions(skillOutput);\n  const entities = extractEntities(skillOutput);\n  const totalEntities = entities.agents.length + entities.technologies.length + entities.patterns.length;\n\n  if (decisions.length === 0 && totalEntities === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Build output message\n  const parts: string[] = [];\n  const firstDecision = decisions[0] || skillOutput.slice(0, 200);\n  const category = detectCategory(firstDecision);\n\n  // Decision extraction section\n  if (decisions.length > 0) {\n    const importance = detectImportance(firstDecision);\n    const bestPractice = extractBestPractice(firstDecision);\n    const ccVersion = getCCVersion();\n    const pluginVersion = getPluginVersion();\n\n    const metadata: Record<string, unknown> = {\n      category,\n      source: 'orchestkit-plugin',\n      skill: skillName || 'unknown',\n      cc_version: ccVersion,\n      plugin_version: pluginVersion,\n      importance,\n      timestamp: new Date().toISOString(),\n    };\n    if (bestPractice) metadata.best_practice = bestPractice;\n\n    const pluginRoot = getPluginRoot();\n    const scriptPath = `${pluginRoot}/skills/mem0-memory/scripts/crud/add-memory.py`;\n\n    parts.push(`[Decisions] Found ${decisions.length} decisions (category: ${category}, importance: ${importance})\n\nTo persist to mem0:\nbash ${scriptPath} --text \"<decision>\" --user-id \"orchestkit:all-agents\" --metadata '${JSON.stringify(metadata)}' --enable-graph\n\nExample: \"${firstDecision.slice(0, 100)}...\"`);\n  }\n\n  // Entity extraction section\n  if (totalEntities > 0) {\n    const relationType = detectRelationType(skillOutput);\n    const entityList = [\n      ...entities.agents.map(a => ({ name: a, entityType: 'Agent', observations: [`Agent: ${a}`] })),\n      ...entities.technologies.map(t => ({ name: t, entityType: 'Technology', observations: [`Tech: ${t}`] })),\n      ...entities.patterns.map(p => ({ name: p, entityType: 'Pattern', observations: [`Pattern: ${p}`] })),\n    ];\n\n    parts.push(`[Entities] Found ${totalEntities} entities for graph memory:\n- Agents: ${entities.agents.length}\n- Technologies: ${entities.technologies.length}\n- Patterns: ${entities.patterns.length}\n\nmcp__memory__create_entities with:\nentities: ${JSON.stringify(entityList.slice(0, 5))}\n\nRelation type: ${relationType}`);\n  }\n\n  return {\n    continue: true,\n    systemMessage: parts.join('\\n\\n'),\n  };\n}\n", "/**\n * Backend Layer Validator Hook\n * BLOCKING: Enforce layer separation in FastAPI\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputBlock, logHook } from '../lib/common.js';\nimport { guardPythonFiles } from '../lib/guards.js';\n\n/**\n * Validate FastAPI layer architecture rules\n */\nexport function backendLayerValidator(input: HookInput): HookResult {\n  // Self-guard: Only run for Python files\n  const guard = guardPythonFiles(input);\n  if (guard) return guard;\n\n  const filePath = input.tool_input.file_path;\n  const content = input.tool_input.content || (input as any).tool_result || '';\n\n  if (!filePath || !content) return outputSilentSuccess();\n\n  const errors: string[] = [];\n\n  // Router layer violations\n  if (filePath.includes('/routers/')) {\n    // Rule: No direct database operations in routers\n    if (/db\\.(add|delete|commit|flush|rollback|refresh|execute|scalar)/.test(content)) {\n      errors.push('DATABASE: Direct database operations not allowed in routers');\n    }\n\n    // Rule: No SQLAlchemy imports\n    if (/^from sqlalchemy import/m.test(content)) {\n      errors.push('IMPORT: SQLAlchemy imports not allowed in routers');\n    }\n  }\n\n  // Service layer violations\n  if (filePath.includes('/services/')) {\n    // Rule: No HTTP exception handling\n    if (/HTTPException\\s*\\(/.test(content)) {\n      errors.push('HTTP: HTTPException not allowed in services - use domain exceptions');\n    }\n\n    // Rule: No FastAPI Request/Response objects\n    if (/from fastapi import.*(Request|Response)/.test(content)) {\n      errors.push('HTTP: Request/Response types not allowed in services');\n    }\n  }\n\n  // Repository layer violations\n  if (filePath.includes('/repositories/')) {\n    // Rule: No HTTP exceptions\n    if (/HTTPException/.test(content)) {\n      errors.push('HTTP: HTTPException not allowed in repositories');\n    }\n\n    // Rule: No service/router imports\n    if (/from.*(services|routers).*import/.test(content)) {\n      errors.push('IMPORT: Repositories cannot import from services or routers');\n    }\n  }\n\n  // Report errors\n  if (errors.length > 0) {\n    const filename = filePath.split('/').pop() || filePath;\n    const reason = `Layer violation in ${filename}: ${errors[0]}`;\n    logHook('backend-layer-validator', `BLOCKED: ${reason}`);\n    return outputBlock(reason);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Coverage Check Hook\n * Runs on Stop for testing skills - checks if coverage threshold is met\n * CC 2.1.7 Compliant - Silent operation\n */\n\nimport { existsSync, appendFileSync, mkdirSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getLogDir, getProjectDir } from '../lib/common.js';\n\n/**\n * Check coverage threshold on stop\n */\nexport function coverageCheck(_input: HookInput): HookResult {\n  const projectDir = getProjectDir();\n  const logDir = getLogDir();\n  const logFile = `${logDir}/coverage-check.log`;\n  const threshold = parseInt(process.env.COVERAGE_THRESHOLD || '80', 10);\n\n  // Ensure log directory exists\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const logLines: string[] = [];\n  const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n  logLines.push(`[${timestamp}] Coverage Check`);\n\n  // Check Python coverage\n  const coverageFile = `${projectDir}/.coverage`;\n  const coverageXml = `${projectDir}/coverage.xml`;\n\n  if (existsSync(coverageFile) || existsSync(coverageXml)) {\n    try {\n      const result = execSync('coverage report --fail-under=0', {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 30000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n\n      const totalLine = result.split('\\n').find((line) => line.includes('TOTAL'));\n      if (totalLine) {\n        const match = totalLine.match(/(\\d+)%/);\n        if (match) {\n          const coverage = parseInt(match[1], 10);\n          logLines.push(`Python coverage: ${coverage}%`);\n          if (coverage < threshold) {\n            logLines.push(`WARNING: Coverage ${coverage}% is below threshold ${threshold}%`);\n          } else {\n            logLines.push('Coverage meets threshold');\n          }\n        }\n      }\n    } catch {\n      // coverage command not available or failed\n    }\n  }\n\n  // Check JS/TS coverage\n  const coverageDir = `${projectDir}/coverage`;\n  if (existsSync(coverageDir)) {\n    const summaryFile = `${coverageDir}/coverage-summary.json`;\n    if (existsSync(summaryFile)) {\n      logLines.push('');\n      logLines.push('JavaScript/TypeScript coverage report found');\n      logLines.push('Check coverage/lcov-report/index.html for details');\n    }\n  }\n\n  // Write to log file\n  try {\n    appendFileSync(logFile, logLines.join('\\n') + '\\n');\n  } catch {\n    // Ignore logging errors\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Coverage Threshold Gate Hook\n * BLOCKING: Coverage must meet threshold after implementation\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputBlock, getProjectDir } from '../lib/common.js';\n\nconst COVERAGE_PATHS = [\n  // JavaScript/TypeScript (Jest, Vitest, c8)\n  'coverage/coverage-summary.json',\n  'coverage/coverage-final.json',\n  '.vitest/coverage/coverage-summary.json',\n  // Python (coverage.py, pytest-cov)\n  'coverage.json',\n  '.coverage.json',\n  'htmlcov/status.json',\n];\n\n/**\n * Parse coverage from various file formats\n */\nfunction parseCoverage(filePath: string, content: string): number | null {\n  try {\n    const data = JSON.parse(content);\n\n    // Jest/Vitest coverage-summary.json format\n    if (filePath.includes('coverage-summary.json')) {\n      return data?.total?.lines?.pct ?? data?.total?.statements?.pct ?? null;\n    }\n\n    // coverage.py JSON format\n    if (filePath.includes('coverage.json')) {\n      return data?.totals?.percent_covered ?? null;\n    }\n\n    // Try generic pct field\n    if (data?.total?.pct !== undefined) {\n      return data.total.pct;\n    }\n\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check coverage threshold gate\n */\nexport function coverageThresholdGate(_input: HookInput): HookResult {\n  const projectDir = getProjectDir();\n  const threshold = parseInt(process.env.COVERAGE_THRESHOLD || '80', 10);\n\n  // Find coverage file\n  let coverageFile = '';\n  let coverageContent = '';\n\n  for (const path of COVERAGE_PATHS) {\n    const fullPath = `${projectDir}/${path}`;\n    if (existsSync(fullPath)) {\n      coverageFile = fullPath;\n      try {\n        coverageContent = readFileSync(fullPath, 'utf8');\n      } catch {\n        continue;\n      }\n      break;\n    }\n  }\n\n  // No coverage file = skip (coverage might not be configured yet)\n  if (!coverageFile || !coverageContent) {\n    return outputSilentSuccess();\n  }\n\n  // Parse coverage\n  const coverage = parseCoverage(coverageFile, coverageContent);\n  if (coverage === null) {\n    return outputSilentSuccess();\n  }\n\n  // Check threshold\n  const coverageInt = Math.floor(coverage);\n  if (coverageInt < threshold) {\n    const reason = `BLOCKED: Coverage ${coverage}% is below threshold ${threshold}%\n\nCoverage report: ${coverageFile}\n\nActions required:\n  1. Identify uncovered code paths\n  2. Add tests for critical business logic\n  3. Re-run tests with coverage:\n\n     TypeScript: npm test -- --coverage\n     Python:     pytest --cov=app --cov-report=term-missing\n\n  4. Ensure coverage >= ${threshold}% before proceeding\n\nTip: Focus on testing:\n  - Business logic (services, utils)\n  - Edge cases and error handling\n  - Critical user flows`;\n\n    return outputBlock(reason);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Cross-Instance Test Validator Hook\n * BLOCKING: Ensure test coverage when code is split across instances\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync, readdirSync, statSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport {\n  outputSilentSuccess,\n  outputBlock,\n  outputWithContext,\n  getProjectDir,\n} from '../lib/common.js';\nimport { getRepoRoot } from '../lib/git.js';\n\n/**\n * Check if file is a test file\n */\nfunction isTestFile(filePath: string): boolean {\n  return (\n    /\\.(test|spec)\\.(ts|tsx|js|jsx)$/.test(filePath) ||\n    /test_.*\\.py$/.test(filePath) ||\n    /_test\\.py$/.test(filePath)\n  );\n}\n\n/**\n * Find corresponding test file for an implementation\n */\nfunction findTestFile(implFile: string): string | null {\n  if (/\\.(ts|tsx|js|jsx)$/.test(implFile)) {\n    const base = implFile.replace(/\\.[^.]+$/, '');\n    const ext = implFile.split('.').pop() || 'ts';\n\n    // Check common patterns\n    const patterns = [\n      `${base}.test.${ext}`,\n      `${base}.spec.${ext}`,\n      `${base}.test.ts`,\n      `${base}.test.tsx`,\n    ];\n\n    for (const pattern of patterns) {\n      if (existsSync(pattern)) return pattern;\n    }\n\n    // Check __tests__ directory\n    const dir = implFile.substring(0, implFile.lastIndexOf('/'));\n    const filename = implFile.split('/').pop() || '';\n    const baseFilename = filename.replace(/\\.[^.]+$/, '');\n\n    const testDirPatterns = [\n      `${dir}/__tests__/${baseFilename}.test.${ext}`,\n      `${dir}/__tests__/${baseFilename}.spec.${ext}`,\n    ];\n\n    for (const pattern of testDirPatterns) {\n      if (existsSync(pattern)) return pattern;\n    }\n  } else if (implFile.endsWith('.py')) {\n    const dir = implFile.substring(0, implFile.lastIndexOf('/'));\n    const filename = implFile.split('/').pop() || '';\n    const testFilename = `test_${filename}`;\n\n    // Try same directory\n    if (existsSync(`${dir}/${testFilename}`)) {\n      return `${dir}/${testFilename}`;\n    }\n\n    // Try tests/ directory\n    const parentDir = dir.substring(0, dir.lastIndexOf('/'));\n    if (existsSync(`${parentDir}/tests/${testFilename}`)) {\n      return `${parentDir}/tests/${testFilename}`;\n    }\n    if (existsSync(`${dir}/tests/${testFilename}`)) {\n      return `${dir}/tests/${testFilename}`;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Extract testable units from content\n */\nfunction extractTestableUnits(content: string, filePath: string): string[] {\n  const units: string[] = [];\n\n  if (/\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n    // TypeScript/JavaScript: Extract exported functions and classes\n    const matches = content.match(/export (function|class|const|async function)\\s+([A-Za-z_][A-Za-z0-9_]*)/g);\n    if (matches) {\n      for (const match of matches) {\n        const name = match.split(/\\s+/).pop();\n        if (name) units.push(name);\n      }\n    }\n  } else if (filePath.endsWith('.py')) {\n    // Python: Extract public functions and classes\n    const lines = content.split('\\n');\n    for (const line of lines) {\n      const match = line.match(/^(def|class)\\s+([A-Za-z][A-Za-z0-9_]*)/);\n      if (match && match[2]) {\n        units.push(match[2]);\n      }\n    }\n  }\n\n  return [...new Set(units)];\n}\n\n/**\n * Validate test coverage for cross-instance code\n */\nexport function crossInstanceTestValidator(input: HookInput): HookResult {\n  const filePath = input.tool_input?.file_path || '';\n  const content = input.tool_input?.content || (input as any).tool_result || '';\n\n  if (!filePath || !content) return outputSilentSuccess();\n\n  // Only validate implementation files (not tests)\n  if (isTestFile(filePath)) return outputSilentSuccess();\n\n  // Skip non-code files\n  if (!/\\.(ts|tsx|js|jsx|py)$/.test(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Find corresponding test file\n  const testFile = findTestFile(filePath);\n\n  // Extract testable units\n  const testableUnits = extractTestableUnits(content, filePath);\n\n  if (testableUnits.length > 0) {\n    if (!testFile) {\n      errors.push('TEST COVERAGE: No test file found for implementation');\n      errors.push(`  Implementation: ${filePath}`);\n      errors.push('  Expected test file:');\n\n      if (/\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n        const base = filePath.replace(/\\.[^.]+$/, '');\n        const ext = filePath.split('.').pop() || 'ts';\n        const dir = filePath.substring(0, filePath.lastIndexOf('/'));\n        const filename = filePath.split('/').pop() || '';\n        errors.push(`    - ${base}.test.${ext}`);\n        errors.push(`    - ${dir}/__tests__/${filename}`);\n      } else if (filePath.endsWith('.py')) {\n        const filename = filePath.split('/').pop() || '';\n        const dir = filePath.substring(0, filePath.lastIndexOf('/'));\n        errors.push(`    - ${dir}/test_${filename}`);\n        errors.push(`    - ${dir.substring(0, dir.lastIndexOf('/'))}/tests/test_${filename}`);\n      }\n\n      errors.push('');\n      errors.push(`  Found ${testableUnits.length} testable units:`);\n      for (const unit of testableUnits.slice(0, 5)) {\n        errors.push(`    - ${unit}`);\n      }\n    } else {\n      // Test file exists - check if new units are tested\n      try {\n        const testContent = readFileSync(testFile, 'utf8');\n        const untestedUnits: string[] = [];\n\n        for (const unit of testableUnits) {\n          // Use word boundary check\n          const regex = new RegExp(`\\\\b${unit.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\b`);\n          if (!regex.test(testContent)) {\n            untestedUnits.push(unit);\n          }\n        }\n\n        if (untestedUnits.length > 0) {\n          warnings.push('TEST COVERAGE: New units without tests');\n          warnings.push(`  Implementation: ${filePath}`);\n          warnings.push(`  Test file: ${testFile}`);\n          warnings.push('');\n          warnings.push(`  Untested units (${untestedUnits.length}/${testableUnits.length}):`);\n          for (const unit of untestedUnits.slice(0, 5)) {\n            warnings.push(`    - ${unit}`);\n          }\n          warnings.push('');\n          warnings.push('  Add tests before committing');\n        }\n      } catch {\n        // Ignore file read errors\n      }\n    }\n  }\n\n  // Block on missing tests for new code\n  if (errors.length > 0) {\n    return outputBlock(`Missing test coverage for new code: ${errors[0]}`);\n  }\n\n  // Warn about test gaps\n  if (warnings.length > 0) {\n    const warningContext = warnings.join('\\n');\n    return outputWithContext(`Test coverage warnings detected:\\n\\n${warningContext}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * DI Pattern Enforcer Hook\n * BLOCKING: Enforce dependency injection patterns in FastAPI\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWithContext, logHook } from '../lib/common.js';\n\n/**\n * Enforce dependency injection patterns in FastAPI routers\n */\nexport function diPatternEnforcer(input: HookInput): HookResult {\n  const filePath = input.tool_input?.file_path || '';\n  const content = input.tool_input?.content || (input as any).tool_result || '';\n\n  if (!filePath || !content) return outputSilentSuccess();\n\n  // Only validate Python files in routers/\n  if (!/\\/routers\\/.*\\.py$/.test(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip deps.py and dependencies.py (these define the DI functions)\n  const filename = filePath.split('/').pop() || '';\n  if (/^(deps|dependencies|__init__)\\.py$/.test(filename)) {\n    return outputSilentSuccess();\n  }\n\n  const errors: string[] = [];\n\n  // Rule: No direct service/repository instantiation\n  if (/=\\s*[A-Z][a-zA-Z]*Service\\s*\\(\\s*\\)/.test(content)) {\n    const match = content.match(/[A-Z][a-zA-Z]*Service\\s*\\(\\s*\\)/);\n    errors.push('INSTANTIATION: Direct service instantiation not allowed');\n    errors.push(`  Found: ${match?.[0] || 'Service()'}`);\n    errors.push('  ');\n    errors.push('  Use dependency injection:');\n    errors.push('    service: MyService = Depends(get_my_service)');\n  }\n\n  if (/=\\s*[A-Z][a-zA-Z]*(Repository|Repo)\\s*\\(\\s*\\)/.test(content)) {\n    const match = content.match(/[A-Z][a-zA-Z]*(Repository|Repo)\\s*\\(\\s*\\)/);\n    errors.push('INSTANTIATION: Direct repository instantiation not allowed');\n    errors.push(`  Found: ${match?.[0] || 'Repository()'}`);\n    errors.push('  ');\n    errors.push('  Use dependency injection:');\n    errors.push('    repo: MyRepository = Depends(get_my_repository)');\n  }\n\n  // Rule: No global service/repository instances\n  if (/^[a-z_]+\\s*=\\s*[A-Z][a-zA-Z]*(Service|Repository|Repo)\\s*\\(/m.test(content)) {\n    errors.push('GLOBAL: Global service/repository instance not allowed');\n    errors.push('  ');\n    errors.push('  Global instances cause:');\n    errors.push('    - Shared state between requests');\n    errors.push('    - Difficult testing');\n    errors.push('    - Connection pool issues');\n    errors.push('  ');\n    errors.push('  Use Depends() for request-scoped instances');\n  }\n\n  // Rule: Database session must use Depends()\n  if (/:\\s*(Async)?Session[^=]*\\)/.test(content)) {\n    if (!/:\\s*(Async)?Session\\s*=\\s*Depends/.test(content)) {\n      errors.push('DI: Database session must use Depends()');\n      errors.push('  ');\n      errors.push('  BAD:  async def get_users(db: AsyncSession):');\n      errors.push('  GOOD: async def get_users(db: AsyncSession = Depends(get_db)):');\n    }\n  }\n\n  // Rule: Route handlers should use Depends for typed dependencies\n  if (/@router\\.(get|post|put|patch|delete)/.test(content)) {\n    if (/:\\s*[A-Z][a-zA-Z]*(Service|Repository|Repo)[^=)]*\\)/.test(content)) {\n      if (!/:\\s*[A-Z][a-zA-Z]*(Service|Repository|Repo)\\s*=\\s*Depends/.test(content)) {\n        errors.push('DI: Service/Repository parameters must use Depends()');\n        errors.push('  ');\n        errors.push('  BAD:  async def create_user(user_service: UserService):');\n        errors.push('  GOOD: async def create_user(user_service: UserService = Depends(get_user_service)):');\n      }\n    }\n  }\n\n  // Rule: No sync DB calls in async functions\n  if (/async def/.test(content)) {\n    // Check for db.query() - sync SQLAlchemy 1.x pattern\n    if (/db\\.query\\(/.test(content)) {\n      if (!/await.*db\\.query\\(/.test(content)) {\n        errors.push('ASYNC: Sync database call in async function');\n        errors.push('  Found: db.query() (sync pattern)');\n        errors.push('  ');\n        errors.push('  Use async SQLAlchemy 2.0 patterns:');\n        errors.push('    result = await db.execute(select(User))');\n        errors.push('    users = result.scalars().all()');\n      }\n    }\n\n    // Check for session methods that should be awaited\n    const syncPattern = /db\\.(add|delete|commit|flush|rollback|refresh)\\(/;\n    if (syncPattern.test(content)) {\n      if (/AsyncSession/.test(content)) {\n        // Check if await is used with these methods\n        const lines = content.split('\\n');\n        for (const line of lines) {\n          if (syncPattern.test(line) && !line.includes('await')) {\n            errors.push('ASYNC: Missing await for async database operation');\n            errors.push('  ');\n            errors.push('  With AsyncSession, use await:');\n            errors.push('    await db.commit()');\n            errors.push('    await db.refresh(user)');\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  // Report errors and block\n  if (errors.length > 0) {\n    logHook('di-pattern-enforcer', `BLOCKED: DI violation in ${filePath}`);\n    const ctx = `Dependency injection violation in ${filePath}. See stderr for details.`;\n    return outputWithContext(ctx);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Duplicate Code Detector Hook\n * BLOCKING: Detect duplicate/redundant code across worktrees\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync, readdirSync, statSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWithContext, getProjectDir } from '../lib/common.js';\nimport { getRepoRoot } from '../lib/git.js';\n\n/**\n * Extract function/class signatures from content\n */\nfunction extractSignatures(content: string, filePath: string): string[] {\n  const signatures: string[] = [];\n\n  if (/\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n    // TypeScript/JavaScript\n    const matches = content.match(/(function|class|const|export function|export class)\\s+[A-Za-z_][A-Za-z0-9_]*/g);\n    if (matches) {\n      signatures.push(...matches);\n    }\n  } else if (filePath.endsWith('.py')) {\n    // Python\n    const lines = content.split('\\n');\n    for (const line of lines) {\n      const match = line.match(/^(def|class)\\s+[A-Za-z_][A-Za-z0-9_]*/);\n      if (match) signatures.push(match[0]);\n    }\n  }\n\n  return [...new Set(signatures)];\n}\n\n/**\n * Find code files in directory (excluding common ignored paths)\n */\nfunction findCodeFiles(dir: string, pattern: RegExp): string[] {\n  const files: string[] = [];\n  const ignoreDirs = ['node_modules', '.venv', 'venv', '__pycache__', 'dist', 'build', '.next', '.git'];\n\n  function walk(currentDir: string): void {\n    try {\n      const entries = readdirSync(currentDir, { withFileTypes: true });\n      for (const entry of entries) {\n        const fullPath = `${currentDir}/${entry.name}`;\n        if (entry.isDirectory()) {\n          if (!ignoreDirs.includes(entry.name)) {\n            walk(fullPath);\n          }\n        } else if (entry.isFile() && pattern.test(entry.name)) {\n          files.push(fullPath);\n        }\n      }\n    } catch {\n      // Ignore access errors\n    }\n  }\n\n  walk(dir);\n  return files;\n}\n\n/**\n * Check for copy-paste patterns in content\n */\nfunction checkCopyPastePatterns(content: string): string[] {\n  const warnings: string[] = [];\n  const lines = content.split('\\n');\n  let prev = '';\n  let count = 0;\n  let startLine = 0;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i].trim();\n    if (line && line === prev) {\n      count++;\n      if (count >= 3) {\n        warnings.push(`Line ${startLine}: ${prev.substring(0, 50)}`);\n      }\n    } else {\n      prev = line;\n      count = 1;\n      startLine = i + 1;\n    }\n  }\n\n  return warnings;\n}\n\n/**\n * Check for utility patterns that should be centralized\n */\nfunction checkUtilityPatterns(content: string, filePath: string): { errors: string[]; warnings: string[] } {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  if (/\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n    // Check for date formatting\n    if (/new Date.*toLocaleDateString/.test(content)) {\n      errors.push('UTILITY: Direct date formatting detected');\n      errors.push(\"  Use centralized date utilities: import { formatDate } from '@/lib/dates'\");\n    }\n\n    // Check for multiple fetch calls\n    const fetchCount = (content.match(/fetch\\s*\\(\\s*['\"]/g) || []).length;\n    if (fetchCount > 2) {\n      warnings.push(`UTILITY: Multiple fetch calls detected (${fetchCount})`);\n      warnings.push('  Consider using centralized API client or custom hook');\n    }\n\n    // Check for multiple inline validations\n    const validationCount = (content.match(/if\\s*\\([^)]*\\.test\\([^)]*\\)/g) || []).length;\n    if (validationCount > 3) {\n      warnings.push(`UTILITY: Multiple inline validations detected (${validationCount})`);\n      warnings.push('  Use Zod schemas: const schema = z.object({...})');\n    }\n  }\n\n  if (filePath.endsWith('.py')) {\n    // Check for multiple json.loads\n    const jsonCount = (content.match(/json\\.loads/g) || []).length;\n    if (jsonCount > 3) {\n      warnings.push(`UTILITY: Multiple json.loads detected (${jsonCount})`);\n      warnings.push('  Consider centralized JSON handling with error recovery');\n    }\n\n    // Check for multiple environment variable access\n    const envCount = (content.match(/os\\.getenv|os\\.environ/g) || []).length;\n    if (envCount > 5) {\n      warnings.push(`UTILITY: Multiple environment variable accesses (${envCount})`);\n      warnings.push('  Use Settings/Config class with Pydantic validation');\n    }\n  }\n\n  return { errors, warnings };\n}\n\n/**\n * Detect duplicate/redundant code across worktrees\n */\nexport function duplicateCodeDetector(input: HookInput): HookResult {\n  const filePath = input.tool_input?.file_path || '';\n  const content = input.tool_input?.content || (input as any).tool_result || '';\n\n  if (!filePath || !content) return outputSilentSuccess();\n\n  // Only validate code files\n  if (!/\\.(ts|tsx|js|jsx|py)$/.test(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // 1. Extract signatures and check for duplicates in main repo\n  const signatures = extractSignatures(content, filePath);\n  if (signatures.length > 0) {\n    const projectRoot = getRepoRoot() || getProjectDir();\n    const codeFiles = findCodeFiles(projectRoot, /\\.(ts|tsx|js|jsx|py)$/);\n\n    for (const signature of signatures) {\n      const name = signature.split(/\\s+/).pop() || '';\n      if (!name) continue;\n\n      // Search for duplicates\n      for (const codeFile of codeFiles) {\n        if (codeFile === filePath) continue;\n\n        try {\n          const fileContent = readFileSync(codeFile, 'utf8');\n          // Word boundary check\n          const regex = new RegExp(`\\\\b${name.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\b`);\n          if (regex.test(fileContent)) {\n            // Check for exact signature match\n            if (fileContent.includes(signature)) {\n              const relPath = codeFile.replace(projectRoot + '/', '');\n              warnings.push(`DUPLICATE: '${name}' already exists in:`);\n              warnings.push(`  - ${relPath}`);\n              warnings.push('  Consider:');\n              warnings.push('    1. Reusing existing implementation');\n              warnings.push('    2. Extracting to shared utility');\n              warnings.push('    3. Using different name if intentionally different');\n              break;\n            }\n          }\n        } catch {\n          // Ignore file read errors\n        }\n      }\n    }\n  }\n\n  // 2. Check for copy-paste patterns\n  const copyPasteWarnings = checkCopyPastePatterns(content);\n  if (copyPasteWarnings.length > 0) {\n    warnings.push('COPY-PASTE: Repeated code blocks detected:');\n    for (const w of copyPasteWarnings.slice(0, 5)) {\n      warnings.push(`  ${w}`);\n    }\n    warnings.push('  Refactor repeated logic into functions');\n  }\n\n  // 3. Check for utility patterns\n  const utilityCheck = checkUtilityPatterns(content, filePath);\n  errors.push(...utilityCheck.errors);\n  warnings.push(...utilityCheck.warnings);\n\n  // Block on critical errors\n  if (errors.length > 0) {\n    const ctx = `Duplicate code violation in ${filePath}. See stderr for details.`;\n    return outputWithContext(ctx);\n  }\n\n  // Warn but don't block\n  if (warnings.length > 0) {\n    const ctx = `Potential code duplication detected in ${filePath}. Review warnings on stderr.`;\n    return outputWithContext(ctx);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Eval Metrics Collector Hook\n * Runs on Stop for llm-evaluation skill\n * Collects and summarizes evaluation metrics\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync, readdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir } from '../lib/common.js';\n\n/**\n * Collect and summarize LLM evaluation metrics\n */\nexport function evalMetricsCollector(_input: HookInput): HookResult {\n  const projectDir = getProjectDir();\n  const messages: string[] = [];\n\n  messages.push('::group::LLM Evaluation Summary');\n\n  // Check for evaluation results\n  const evalResultsPath = `${projectDir}/eval_results.json`;\n  if (existsSync(evalResultsPath)) {\n    messages.push('Evaluation results found:');\n    try {\n      const content = readFileSync(evalResultsPath, 'utf8');\n      const data = JSON.parse(content);\n\n      if (typeof data === 'object' && data !== null) {\n        for (const [key, value] of Object.entries(data)) {\n          if (typeof value === 'number') {\n            const formatted = Number.isInteger(value) ? value.toString() : value.toFixed(2);\n            messages.push(`  ${key}: ${formatted}`);\n          }\n        }\n      }\n    } catch {\n      // If JSON parsing fails, show first 20 lines\n      try {\n        const content = readFileSync(evalResultsPath, 'utf8');\n        const lines = content.split('\\n').slice(0, 20);\n        messages.push(...lines);\n      } catch {\n        messages.push('  (Unable to read file)');\n      }\n    }\n  }\n\n  // Check for DeepEval results\n  const deepevalDir = `${projectDir}/.deepeval`;\n  if (existsSync(deepevalDir)) {\n    messages.push('');\n    messages.push('DeepEval results directory found');\n    try {\n      const files = readdirSync(deepevalDir).slice(0, 5);\n      for (const file of files) {\n        messages.push(`  ${file}`);\n      }\n    } catch {\n      // Ignore\n    }\n  }\n\n  // Check for RAGAS results\n  const ragasPath = `${projectDir}/ragas_results.json`;\n  if (existsSync(ragasPath)) {\n    messages.push('');\n    messages.push('RAGAS evaluation results found');\n  }\n\n  messages.push('');\n  messages.push('Evaluation complete - review metrics above');\n  messages.push('::endgroup::');\n\n  // Log to stderr for visibility during development\n  for (const msg of messages) {\n    process.stderr.write(msg + '\\n');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Evidence Collector Hook\n * Runs on Stop for evidence-verification skill\n * Collects verification evidence - silent operation\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, appendFileSync, mkdirSync, readdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getLogDir, getProjectDir } from '../lib/common.js';\n\n/**\n * Collect verification evidence on session stop\n */\nexport function evidenceCollector(_input: HookInput): HookResult {\n  const logDir = getLogDir();\n  const projectDir = getProjectDir();\n  const logFile = `${logDir}/evidence-collector.log`;\n\n  // Ensure log directory exists\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n  const logLines: string[] = [];\n\n  logLines.push(`[${timestamp}] Evidence Collection`);\n\n  // Collect exit codes from recent commands\n  logLines.push('Recent command results:');\n  const lastExitCode = process.env.CC_LAST_EXIT_CODE;\n  if (lastExitCode) {\n    logLines.push(`  Last exit code: ${lastExitCode}`);\n  }\n\n  // Check for test results\n  if (existsSync(`${projectDir}/pytest.xml`) || existsSync(`${projectDir}/junit.xml`)) {\n    logLines.push('  Test results: Found (XML format)');\n  }\n\n  const testResultsDir = `${projectDir}/test-results`;\n  if (existsSync(testResultsDir)) {\n    logLines.push('  Test results directory: Found');\n    try {\n      const files = readdirSync(testResultsDir).slice(0, 5);\n      for (const file of files) {\n        logLines.push(`    ${file}`);\n      }\n    } catch {\n      // Ignore\n    }\n  }\n\n  // Check for coverage\n  if (existsSync(`${projectDir}/.coverage`) || existsSync(`${projectDir}/coverage`)) {\n    logLines.push('  Coverage data: Found');\n  }\n\n  // Check for lint results\n  if (existsSync(`${projectDir}/lint-results.json`) || existsSync(`${projectDir}/eslint-report.json`)) {\n    logLines.push('  Lint results: Found');\n  }\n\n  logLines.push('Evidence verification complete.');\n\n  // Write to log file (silent operation)\n  try {\n    appendFileSync(logFile, logLines.join('\\n') + '\\n');\n  } catch {\n    // Ignore logging errors\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Import Direction Enforcer Hook\n * BLOCKING: Imports must follow unidirectional architecture\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputBlock, logHook } from '../lib/common.js';\nimport { guardCodeFiles } from '../lib/guards.js';\n\n/**\n * Determine the architectural layer of a file\n */\nfunction getLayer(filePath: string): string | null {\n  // TypeScript/JavaScript layers\n  if (filePath.includes('/shared/')) return 'shared';\n  if (filePath.includes('/lib/')) return 'lib';\n  if (filePath.includes('/utils/')) return 'utils';\n  if (filePath.includes('/components/') && !filePath.includes('/features/')) return 'components';\n  if (filePath.includes('/hooks/') && !filePath.includes('/features/')) return 'hooks';\n  if (filePath.includes('/features/')) return 'features';\n  if (filePath.includes('/app/') || filePath.includes('/pages/')) return 'app';\n\n  // Python layers\n  if (filePath.includes('/repositories/')) return 'repositories';\n  if (filePath.includes('/services/') && filePath.endsWith('.py')) return 'services';\n  if (filePath.includes('/routers/')) return 'routers';\n\n  return null;\n}\n\n/**\n * Enforce import direction rules\n */\nexport function importDirectionEnforcer(input: HookInput): HookResult {\n  // Self-guard: Only run for code files\n  const guard = guardCodeFiles(input);\n  if (guard) return guard;\n\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || (input as any).tool_result || '';\n\n  if (!filePath || !content) return outputSilentSuccess();\n\n  const layer = getLayer(filePath);\n  if (!layer) return outputSilentSuccess();\n\n  const errors: string[] = [];\n\n  // TypeScript/JavaScript import rules\n  if (/\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n    switch (layer) {\n      case 'shared':\n      case 'lib':\n      case 'utils':\n        if (/from ['\"](@\\/|\\.\\.\\/)*(features|app)\\//.test(content)) {\n          errors.push(`${layer}/ cannot import from features/ or app/`);\n        }\n        break;\n\n      case 'components':\n      case 'hooks':\n        if (/from ['\"](@\\/|\\.\\.\\/)*(features|app)\\//.test(content)) {\n          errors.push(`${layer}/ cannot import from features/ or app/`);\n        }\n        break;\n\n      case 'features':\n        if (/from ['\"](@\\/|\\.\\.\\/)*app\\//.test(content)) {\n          errors.push('features/ cannot import from app/');\n        }\n        break;\n    }\n  }\n\n  // Python import rules\n  if (filePath.endsWith('.py')) {\n    switch (layer) {\n      case 'repositories':\n        if (/from (app\\.)?(services|routers)/.test(content)) {\n          errors.push('repositories/ cannot import from services/ or routers/');\n        }\n        break;\n\n      case 'services':\n        if (/from (app\\.)?routers\\.[a-z]/.test(content)) {\n          if (!/from (app\\.)?routers\\.(deps|dependencies)/.test(content)) {\n            errors.push('services/ cannot import from routers/');\n          }\n        }\n        break;\n    }\n  }\n\n  // Report errors\n  if (errors.length > 0) {\n    const filename = filePath.split('/').pop() || filePath;\n    const reason = `Import direction violation in ${filename}: ${errors[0]}`;\n    logHook('import-direction-enforcer', `BLOCKED: ${reason}`);\n    return outputBlock(reason);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Merge Conflict Predictor Hook\n * WARNING: Predict merge conflicts before commit\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWithContext, getProjectDir } from '../lib/common.js';\nimport { getRepoRoot, getCurrentBranch, getDefaultBranch } from '../lib/git.js';\n\ninterface ConflictInfo {\n  worktree: string;\n  branch: string;\n  status: string;\n}\n\n/**\n * Get list of git worktrees\n */\nfunction getWorktrees(): string[] {\n  try {\n    const output = execSync('git worktree list --porcelain', {\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    return output\n      .split('\\n')\n      .filter((line) => line.startsWith('worktree '))\n      .map((line) => line.replace('worktree ', ''));\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get branch name for a worktree\n */\nfunction getWorktreeBranch(worktree: string): string {\n  try {\n    return execSync('git rev-parse --abbrev-ref HEAD', {\n      cwd: worktree,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Check if file is modified in a worktree\n */\nfunction isFileModified(worktree: string, relPath: string): boolean {\n  try {\n    const status = execSync(`git status --short \"${relPath}\"`, {\n      cwd: worktree,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return /^.M|^M.|^A/.test(status);\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get commits ahead/behind count\n */\nfunction getBranchDivergence(baseBranch: string, currentBranch: string): { ahead: number; behind: number } {\n  try {\n    const ahead = parseInt(\n      execSync(`git rev-list --count ${baseBranch}..${currentBranch}`, {\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }).trim(),\n      10\n    );\n    const behind = parseInt(\n      execSync(`git rev-list --count ${currentBranch}..${baseBranch}`, {\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }).trim(),\n      10\n    );\n    return { ahead: ahead || 0, behind: behind || 0 };\n  } catch {\n    return { ahead: 0, behind: 0 };\n  }\n}\n\n/**\n * Predict merge conflicts before commit\n */\nexport function mergeConflictPredictor(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || (input as any).tool_result || '';\n\n  if (!filePath || !content) return outputSilentSuccess();\n\n  // Check if we have worktrees\n  const worktrees = getWorktrees();\n  if (worktrees.length === 0) return outputSilentSuccess();\n\n  const warnings: string[] = [];\n  const conflicts: ConflictInfo[] = [];\n\n  const repoRoot = getRepoRoot() || getProjectDir();\n  const currentWorktree = repoRoot;\n  const relPath = filePath.replace(repoRoot + '/', '').replace(repoRoot, '');\n\n  // Check each worktree for concurrent modifications\n  for (const worktree of worktrees) {\n    if (worktree === currentWorktree) continue;\n\n    const worktreeFile = `${worktree}/${relPath}`;\n    if (!existsSync(worktreeFile)) continue;\n\n    const branch = getWorktreeBranch(worktree);\n\n    // Check if file is modified\n    if (isFileModified(worktree, relPath)) {\n      conflicts.push({ worktree, branch, status: 'modified' });\n\n      // Get the other content to analyze overlap\n      try {\n        const otherContent = readFileSync(worktreeFile, 'utf8');\n\n        // Count changed lines (simple heuristic)\n        const newLines = content.split('\\n');\n        const otherLines = otherContent.split('\\n');\n        const diff = Math.abs(newLines.length - otherLines.length);\n\n        if (diff > 10) {\n          warnings.push(`OVERLAP: Significant changes in both branches (~${diff} lines)`);\n          warnings.push(`  Branch: ${branch}`);\n          warnings.push('  High risk of merge conflict');\n        }\n      } catch {\n        // Ignore read errors\n      }\n    }\n  }\n\n  // Check base branch divergence\n  const currentBranch = getCurrentBranch();\n  const baseBranch = getDefaultBranch();\n\n  if (currentBranch !== baseBranch) {\n    const { ahead, behind } = getBranchDivergence(baseBranch, currentBranch);\n\n    if (behind > 10) {\n      warnings.push(`DIVERGENCE: Current branch is ${behind} commits behind ${baseBranch}`);\n      warnings.push('  Consider rebasing before continuing development');\n      warnings.push('  This reduces merge conflict risk');\n    }\n  }\n\n  // Report conflicts\n  if (conflicts.length > 0) {\n    warnings.unshift('MERGE CONFLICT RISK: Concurrent modifications detected');\n    warnings.unshift('');\n    warnings.unshift(`File: ${filePath}`);\n\n    for (const conflict of conflicts) {\n      warnings.push(`  Branch: ${conflict.branch}`);\n      warnings.push(`  Status: ${conflict.status}`);\n      warnings.push(`  Path: ${conflict.worktree}`);\n    }\n\n    warnings.push('');\n    warnings.push('Recommendations:');\n    warnings.push('  1. Coordinate changes with other instances');\n    warnings.push('  2. Consider splitting work to avoid overlapping files');\n    warnings.push('  3. Communicate before merging');\n  }\n\n  if (warnings.length > 0) {\n    const ctx = `Potential merge conflicts detected in ${filePath}. Review warnings on stderr.`;\n    // Log warnings to stderr\n    process.stderr.write(warnings.join('\\n') + '\\n');\n    return outputWithContext(ctx);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Merge Readiness Checker Hook\n * Comprehensive merge readiness check for worktree branches\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir } from '../lib/common.js';\nimport { getRepoRoot, getCurrentBranch, getDefaultBranch, hasUncommittedChanges } from '../lib/git.js';\n\n/**\n * Execute git command safely\n */\nfunction gitExec(command: string, cwd?: string): string {\n  try {\n    return execSync(command, {\n      cwd: cwd || getProjectDir(),\n      encoding: 'utf8',\n      timeout: 30000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Check merge readiness for branch\n */\nexport function mergeReadinessChecker(input: HookInput): HookResult {\n  const command = input.tool_input?.command || '';\n\n  // Only run for merge-related commands\n  if (!/\\b(gh\\s+pr\\s+merge|git\\s+merge|git\\s+rebase)\\b/i.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  const targetBranch = (input.tool_input as any).target_branch || 'main';\n  const currentBranch = getCurrentBranch();\n\n  if (currentBranch === targetBranch) {\n    process.stderr.write(`Already on target branch ${targetBranch}\\n`);\n    return outputSilentSuccess();\n  }\n\n  process.stderr.write(`Checking merge readiness: ${currentBranch} -> ${targetBranch}\\n\\n`);\n\n  const projectRoot = getRepoRoot() || getProjectDir();\n  const errors: string[] = [];\n  const warnings: string[] = [];\n  const passes: string[] = [];\n\n  // 1. Check for uncommitted changes\n  process.stderr.write('1. Checking for uncommitted changes...\\n');\n  if (hasUncommittedChanges()) {\n    const status = gitExec('git status --short');\n    errors.push('Uncommitted changes detected:');\n    errors.push(status.split('\\n').slice(0, 10).join('\\n'));\n  } else {\n    passes.push('No uncommitted changes');\n  }\n\n  // 2. Check branch divergence\n  process.stderr.write('2. Checking branch divergence...\\n');\n  gitExec(`git fetch origin ${targetBranch}`);\n\n  const ahead = parseInt(gitExec(`git rev-list --count origin/${targetBranch}..${currentBranch}`) || '0', 10);\n  const behind = parseInt(gitExec(`git rev-list --count ${currentBranch}..origin/${targetBranch}`) || '0', 10);\n\n  process.stderr.write(`   Ahead: ${ahead} commits, Behind: ${behind} commits\\n`);\n\n  if (behind > 20) {\n    errors.push(`Branch is significantly behind ${targetBranch} (${behind} commits)`);\n    errors.push(`Rebase or merge ${targetBranch} before proceeding`);\n  } else if (behind > 5) {\n    warnings.push(`Branch is behind ${targetBranch} by ${behind} commits`);\n    warnings.push('Consider rebasing for easier merge');\n  } else {\n    passes.push(`Branch is up to date (behind by ${behind})`);\n  }\n\n  // 3. Check for merge conflicts\n  process.stderr.write('3. Checking for merge conflicts...\\n');\n  const mergeResult = gitExec(`git merge --no-commit --no-ff origin/${targetBranch}`);\n\n  if (mergeResult.includes('CONFLICT')) {\n    const conflictFiles = gitExec('git diff --name-only --diff-filter=U');\n    errors.push(`Merge conflicts detected with ${targetBranch}:`);\n    for (const file of conflictFiles.split('\\n').slice(0, 10)) {\n      if (file) errors.push(`  - ${file}`);\n    }\n    errors.push('Resolve conflicts before merging');\n    gitExec('git merge --abort');\n  } else {\n    passes.push('No merge conflicts detected');\n    gitExec('git merge --abort');\n  }\n\n  // 4. Run quality gates\n  process.stderr.write('4. Running quality gates on changed files...\\n');\n  const mergeBase = gitExec(`git merge-base ${currentBranch} origin/${targetBranch}`);\n  if (mergeBase) {\n    const changedFiles = gitExec(`git diff --name-only ${mergeBase} ${currentBranch}`);\n    const fileCount = changedFiles.split('\\n').filter(Boolean).length;\n    process.stderr.write(`   Checking ${fileCount} changed files...\\n`);\n    passes.push('Quality gates check performed');\n  } else {\n    warnings.push('Cannot determine merge base - skipping file checks');\n  }\n\n  // 5. Check test suite\n  process.stderr.write('5. Checking test suite...\\n');\n  if (existsSync(`${projectRoot}/package.json`)) {\n    const pkgContent = readFileSync(`${projectRoot}/package.json`, 'utf8');\n    if (pkgContent.includes('\"test\":')) {\n      passes.push('Frontend test script found');\n    }\n  }\n  if (existsSync(`${projectRoot}/pytest.ini`) || existsSync(`${projectRoot}/pyproject.toml`)) {\n    passes.push('Backend test configuration found');\n  }\n\n  // Generate report\n  process.stderr.write('\\n');\n  process.stderr.write('=' .repeat(60) + '\\n');\n  process.stderr.write('\\nMERGE READINESS REPORT\\n\\n');\n  process.stderr.write(`Branch: ${currentBranch} -> ${targetBranch}\\n\\n`);\n\n  if (passes.length > 0) {\n    process.stderr.write('PASSED CHECKS:\\n');\n    for (const pass of passes) {\n      process.stderr.write(`   ${pass}\\n`);\n    }\n    process.stderr.write('\\n');\n  }\n\n  if (warnings.length > 0) {\n    process.stderr.write('WARNINGS:\\n');\n    for (const warning of warnings) {\n      process.stderr.write(`   ${warning}\\n`);\n    }\n    process.stderr.write('\\n');\n  }\n\n  if (errors.length > 0) {\n    process.stderr.write('BLOCKERS:\\n');\n    for (const error of errors) {\n      process.stderr.write(`   ${error}\\n`);\n    }\n    process.stderr.write('\\nMERGE NOT READY - Fix blockers before merging\\n');\n    return { continue: false, stopReason: 'Merge not ready - blockers detected' };\n  }\n\n  if (warnings.length > 0) {\n    process.stderr.write('MERGE READY WITH WARNINGS\\n');\n    process.stderr.write('Review warnings before proceeding with merge\\n');\n  } else {\n    process.stderr.write('MERGE READY - All checks passed!\\n');\n    process.stderr.write('You can safely merge this branch\\n');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Migration Validator Hook\n * Runs after Write for database-schema-designer skill\n * Validates alembic migration files\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWithContext, logHook } from '../lib/common.js';\n\n/**\n * Validate alembic migration files\n */\nexport function migrationValidator(input: HookInput): HookResult {\n  const filePath = input.tool_input?.file_path || process.env.CC_TOOL_FILE_PATH || '';\n\n  if (!filePath) return outputSilentSuccess();\n\n  // Only check migration files\n  if (!filePath.includes('alembic/versions') || !filePath.endsWith('.py')) {\n    return outputSilentSuccess();\n  }\n\n  if (!existsSync(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  process.stderr.write(`::group::Migration Validation: ${filePath.split('/').pop()}\\n`);\n\n  const errors: string[] = [];\n  let content: string;\n\n  try {\n    content = readFileSync(filePath, 'utf8');\n  } catch {\n    errors.push('Cannot read migration file');\n    return outputWithContext(`Migration validation failed for ${filePath}`);\n  }\n\n  // Check for required functions\n  if (!content.includes('def upgrade')) {\n    errors.push('Missing upgrade() function in migration');\n  }\n\n  if (!content.includes('def downgrade')) {\n    errors.push('Missing downgrade() function in migration');\n  }\n\n  // Check for revision ID\n  if (!/^revision = /m.test(content)) {\n    errors.push('Missing revision ID in migration');\n  }\n\n  // Validate syntax\n  try {\n    execSync(`python3 -m py_compile \"${filePath}\"`, {\n      encoding: 'utf8',\n      timeout: 10000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n  } catch {\n    errors.push('Python syntax error in migration');\n  }\n\n  // Report errors\n  if (errors.length > 0) {\n    process.stderr.write('::error::Migration validation failed\\n');\n    for (const error of errors) {\n      process.stderr.write(`  - ${error}\\n`);\n    }\n    process.stderr.write('::endgroup::\\n');\n\n    logHook('migration-validator', `BLOCKED: ${errors[0]}`);\n    const ctx = `Migration validation failed for ${filePath}. See stderr for details.`;\n    return outputWithContext(ctx);\n  }\n\n  process.stderr.write('Migration file is valid\\n');\n  process.stderr.write('::endgroup::\\n');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Pattern Consistency Enforcer Hook\n * BLOCKING: Enforce consistent patterns across all instances\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputBlock, getProjectDir } from '../lib/common.js';\nimport { getRepoRoot } from '../lib/git.js';\n\n/**\n * Enforce pattern consistency across codebase\n */\nexport function patternConsistencyEnforcer(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || (input as any).tool_result || '';\n\n  if (!filePath || !content) return outputSilentSuccess();\n\n  const projectRoot = getRepoRoot() || getProjectDir();\n  const patternsFile = `${projectRoot}/.claude/context/knowledge/patterns/established.json`;\n\n  // Skip if no patterns file\n  if (!existsSync(patternsFile)) {\n    return outputSilentSuccess();\n  }\n\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Backend pattern consistency (Python files)\n  if (filePath.endsWith('.py') && (filePath.includes('/backend/') || filePath.includes('/api/'))) {\n    // Check: Clean Architecture layers\n    if (filePath.includes('/routers/')) {\n      if (/from.*repositories.*import/.test(content)) {\n        errors.push('PATTERN: Router imports repository directly');\n        errors.push('  Established pattern: routers -> services -> repositories');\n        errors.push('  Import from services/ layer instead');\n      }\n    }\n\n    if (filePath.includes('/services/')) {\n      if (/from.*routers.*import/.test(content)) {\n        errors.push('PATTERN: Service imports router (circular dependency)');\n        errors.push('  Established pattern: Services are independent of HTTP layer');\n      }\n    }\n\n    // Check: Async SQLAlchemy pattern\n    if (/from sqlalchemy import/.test(content)) {\n      if (!/from sqlalchemy\\.ext\\.asyncio import/.test(content)) {\n        if (/Session|sessionmaker/.test(content)) {\n          errors.push('PATTERN: Using sync SQLAlchemy instead of async');\n          errors.push('  Established pattern: All DB operations use async/await');\n          errors.push('  Import: from sqlalchemy.ext.asyncio import AsyncSession');\n        }\n      }\n    }\n\n    // Check: Pydantic v2 validators\n    if (/from pydantic import.*BaseModel/.test(content)) {\n      if (/@validator\\(/.test(content)) {\n        errors.push('PATTERN: Using Pydantic v1 @validator decorator');\n        errors.push('  Established pattern: Pydantic v2 with @field_validator');\n        errors.push(\"  Update: @field_validator('field_name', mode='after')\");\n      }\n      if (/@root_validator/.test(content)) {\n        errors.push('PATTERN: Using Pydantic v1 @root_validator decorator');\n        errors.push('  Established pattern: Pydantic v2 with @model_validator');\n        errors.push(\"  Update: @model_validator(mode='after')\");\n      }\n    }\n  }\n\n  // Frontend pattern consistency (TypeScript/JavaScript)\n  if (/\\.(ts|tsx|js|jsx)$/.test(filePath) && (filePath.includes('/frontend/') || filePath.includes('/src/'))) {\n    // Check: React 19 function components\n    if (/React\\.FC</.test(content)) {\n      errors.push('PATTERN: Using React.FC instead of explicit Props type');\n      errors.push('  Established pattern: function Component(props: Props): React.ReactNode');\n      errors.push('  Remove React.FC, use explicit function declaration');\n    }\n\n    // Check: Zod validation for API responses\n    if (/fetch\\(|axios\\./.test(content)) {\n      if (!/from ['\"]zod['\"]/.test(content)) {\n        errors.push('PATTERN: API call without Zod validation');\n        errors.push('  Established pattern: All API responses validated with Zod');\n        errors.push(\"  Import: import { z } from 'zod'\");\n      }\n    }\n\n    // Check: React 19 APIs for forms\n    if (/<form/.test(content)) {\n      if (!/useFormStatus|useActionState|useOptimistic/.test(content)) {\n        warnings.push('PATTERN: Form without React 19 form hooks');\n        warnings.push('  Established pattern: Use useFormStatus for pending state');\n        warnings.push('  Consider: useOptimistic for optimistic updates');\n      }\n    }\n\n    // Check: Date formatting pattern\n    if (/new Date.*toLocaleDateString|toLocaleString/.test(content)) {\n      errors.push('PATTERN: Direct date formatting instead of centralized utility');\n      errors.push('  Established pattern: Use @/lib/dates helpers');\n      errors.push(\"  Import: import { formatDate, formatDateShort } from '@/lib/dates'\");\n    }\n  }\n\n  // Testing pattern consistency\n  if (/\\.(test|spec)\\.(ts|tsx|js|jsx)$/.test(filePath) || /test_.*\\.py$/.test(filePath)) {\n    // Check: AAA pattern presence\n    if (!/\\/\\/ Arrange|\\/\\/ Act|\\/\\/ Assert|# Arrange|# Act|# Assert/i.test(content)) {\n      warnings.push('PATTERN: AAA pattern comments missing');\n      warnings.push('  Established pattern: Structure tests with Arrange-Act-Assert');\n      warnings.push('  Add comments for clarity in complex tests');\n    }\n\n    // Check: MSW for API mocking (TypeScript)\n    if (/\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n      if (/jest\\.mock.*fetch|global\\.fetch/.test(content)) {\n        errors.push('PATTERN: Using jest.mock for fetch instead of MSW');\n        errors.push('  Established pattern: Use MSW for API mocking');\n        errors.push(\"  Import: import { http, HttpResponse } from 'msw'\");\n      }\n    }\n\n    // Check: Pytest fixtures (Python)\n    if (filePath.endsWith('.py')) {\n      if (/class Test.*setUp/.test(content)) {\n        errors.push('PATTERN: Using unittest setUp instead of pytest fixtures');\n        errors.push('  Established pattern: Use pytest fixtures');\n        errors.push('  Convert: @pytest.fixture\\\\ndef setup_data():');\n      }\n    }\n  }\n\n  // AI Integration pattern consistency\n  if (filePath.includes('/llm/') || filePath.includes('/ai/') || filePath.includes('/agent/')) {\n    // Check: IDs flow around LLM\n    if (/prompt.*\\{.*id.*\\}|f\".*\\{.*\\.id\\}.*\"/.test(content)) {\n      errors.push('PATTERN: Database IDs in LLM prompts');\n      errors.push('  Established pattern: IDs flow around LLM, not through it');\n      errors.push('  Pass IDs via metadata, join results after LLM processing');\n    }\n\n    // Check: Async timeout protection\n    if (/await.*openai|await.*anthropic|await.*llm/.test(content)) {\n      if (!/asyncio\\.timeout|asyncio\\.wait_for|Promise\\.race/.test(content)) {\n        errors.push('PATTERN: LLM call without timeout protection');\n        errors.push('  Established pattern: Wrap all LLM calls with timeout');\n        errors.push('  Python: async with asyncio.timeout(30):');\n        errors.push('  TypeScript: await Promise.race([call, timeout])');\n      }\n    }\n  }\n\n  // Block on critical pattern violations\n  if (errors.length > 0) {\n    return outputBlock(`Pattern consistency violations detected in ${filePath}`);\n  }\n\n  // Warn about pattern drift (non-blocking)\n  if (warnings.length > 0) {\n    process.stderr.write('WARNING: Pattern consistency issues detected\\n');\n    process.stderr.write(`File: ${filePath}\\n\\n`);\n    for (const warning of warnings) {\n      process.stderr.write(`  ${warning}\\n`);\n    }\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Redact Secrets Hook\n * Runs after Bash commands in security-scanning skill\n * Warns if potential secrets detected in output\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess } from '../lib/common.js';\n\n// API key patterns\nconst API_KEY_PATTERNS = [\n  /sk-[a-zA-Z0-9]{20,}/, // OpenAI\n  /ghp_[a-zA-Z0-9]{36}/, // GitHub PAT\n  /AKIA[A-Z0-9]{16}/, // AWS Access Key\n  /xox[baprs]-[a-zA-Z0-9-]+/, // Slack tokens\n];\n\n// Generic secret patterns\nconst SECRET_PATTERNS = [\n  /password\\s*[:=]\\s*['\"][^'\"]+['\"]/i,\n  /secret\\s*[:=]\\s*['\"][^'\"]+['\"]/i,\n];\n\n/**\n * Check for potential secrets in command output\n */\nexport function redactSecrets(input: HookInput): HookResult {\n  const toolOutput = (input as any).tool_result || (input as any).output || '';\n\n  if (!toolOutput) return outputSilentSuccess();\n\n  // Check for API key patterns\n  for (const pattern of API_KEY_PATTERNS) {\n    if (pattern.test(toolOutput)) {\n      process.stderr.write('::warning::Potential API key detected in output - verify redaction\\n');\n      break;\n    }\n  }\n\n  // Check for generic secret patterns\n  for (const pattern of SECRET_PATTERNS) {\n    if (pattern.test(toolOutput)) {\n      process.stderr.write('::warning::Potential hardcoded credential in output\\n');\n      break;\n    }\n  }\n\n  // Silent success - warnings printed to stderr, don't block\n  return outputSilentSuccess();\n}\n", "/**\n * Review Summary Generator Hook\n * Runs on Stop for code-review-playbook skill\n * Generates review summary - silent operation, logs to file\n * CC 2.1.7 Compliant\n */\n\nimport { appendFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getLogDir } from '../lib/common.js';\n\n/**\n * Generate code review summary on session stop\n */\nexport function reviewSummaryGenerator(_input: HookInput): HookResult {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/review-summary.log`;\n\n  // Ensure log directory exists\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n  const logContent = `[${timestamp}] Code Review Summary\nReview checklist:\n  [ ] All blocking issues addressed\n  [ ] Non-blocking suggestions noted\n  [ ] Tests pass\n  [ ] No security concerns\n  [ ] Documentation updated if needed\n\nConventional comment prefixes used:\n  - blocking: Must fix before merge\n  - suggestion: Consider this improvement\n  - nitpick: Minor style issue\n  - question: Needs clarification\n  - praise: Good work!\n`;\n\n  // Write to log file (silent operation)\n  try {\n    appendFileSync(logFile, logContent + '\\n');\n  } catch {\n    // Ignore logging errors\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Security Summary Hook\n * Runs on Stop for security-scanning skill\n * Generates a summary of security scan completion - silent operation\n * CC 2.1.7 Compliant\n */\n\nimport { appendFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getLogDir } from '../lib/common.js';\n\n/**\n * Generate security scan summary on session stop\n */\nexport function securitySummary(_input: HookInput): HookResult {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/security-summary.log`;\n\n  // Ensure log directory exists\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n  const logContent = `[${timestamp}] Security Scan Complete\nReview findings for:\n  - Critical/High vulnerabilities (fix immediately)\n  - Dependency CVEs (update packages)\n  - Hardcoded secrets (move to env vars)\n  - OWASP Top 10 violations\n\nNext steps:\n  1. Triage findings by severity\n  2. Create issues for critical/high\n  3. Update dependencies with CVEs\n`;\n\n  // Write to log file (silent operation)\n  try {\n    appendFileSync(logFile, logContent + '\\n');\n  } catch {\n    // Ignore logging errors\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Structure Location Validator Hook\n * BLOCKING: Files must be in correct architectural locations\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputBlock, logHook } from '../lib/common.js';\nimport { guardCodeFiles } from '../lib/guards.js';\n\nconst MAX_DEPTH = 4;\n\n/**\n * Validate file structure and location\n */\nexport function structureLocationValidator(input: HookInput): HookResult {\n  // Self-guard: Only run for code files\n  const guard = guardCodeFiles(input);\n  if (guard) return guard;\n\n  const filePath = input.tool_input.file_path || '';\n  if (!filePath) return outputSilentSuccess();\n\n  const errors: string[] = [];\n  const filename = filePath.split('/').pop() || '';\n\n  // Rule: Max nesting depth (4 levels from src/ or app/)\n  if (filePath.includes('/src/') || filePath.includes('/app/')) {\n    let relativePath = '';\n    if (filePath.includes('/src/')) {\n      relativePath = filePath.split('/src/')[1] || '';\n    } else {\n      relativePath = filePath.split('/app/')[1] || '';\n    }\n\n    const depth = relativePath.split('/').filter(Boolean).length;\n    if (depth > MAX_DEPTH) {\n      errors.push(`NESTING: Max depth exceeded - ${depth} levels (max: ${MAX_DEPTH})`);\n    }\n  }\n\n  // Rule: No barrel files (index.ts that only re-export)\n  if (/^index\\.(ts|tsx|js)$/.test(filename)) {\n    if (!filePath.includes('/app/') && !/\\/(node_modules|dist|build)\\//.test(filePath)) {\n      errors.push('BARREL: Barrel files (index.ts) are discouraged - import directly from source');\n    }\n  }\n\n  // React/TypeScript structure rules\n  if (/\\.(tsx|ts|jsx|js)$/.test(filePath)) {\n    // Rule: React components (PascalCase) must be in components/ or features/\n    if (/^[A-Z][a-zA-Z0-9]*\\.(tsx|jsx)$/.test(filename)) {\n      if (!/(components\\/|features\\/|app\\/|pages\\/)/.test(filePath)) {\n        errors.push('COMPONENT: React components must be in components/, features/, or app/');\n      }\n    }\n\n    // Rule: Custom hooks (useX) must be in hooks/ directory\n    if (/^use[A-Z][a-zA-Z0-9]*\\.(ts|tsx)$/.test(filename)) {\n      if (!/(hooks\\/|\\/hooks\\/)/.test(filePath)) {\n        errors.push('HOOK: Custom hooks must be in hooks/ directory');\n      }\n    }\n  }\n\n  // FastAPI/Python structure rules\n  if (filePath.endsWith('.py')) {\n    const dirname = filePath.substring(0, filePath.lastIndexOf('/'));\n\n    // Rule: Router files must be in routers/\n    if (/^(router_|routes_|api_).*\\.py$/.test(filename)) {\n      if (!dirname.endsWith('/routers') && !dirname.endsWith('routers')) {\n        errors.push('ROUTER: Router files must be in routers/ directory');\n      }\n    }\n\n    // Rule: Service files must be in services/\n    if (/_service\\.py$/.test(filename)) {\n      if (!dirname.endsWith('/services') && !dirname.endsWith('services')) {\n        errors.push('SERVICE: Service files must be in services/ directory');\n      }\n    }\n\n    // Rule: Repository files must be in repositories/\n    if (/_(repository|repo)\\.py$/.test(filename)) {\n      if (!dirname.endsWith('/repositories') && !dirname.endsWith('repositories')) {\n        errors.push('REPOSITORY: Repository files must be in repositories/ directory');\n      }\n    }\n  }\n\n  // Report errors and block\n  if (errors.length > 0) {\n    const reason = `Structure violation: ${errors[0]}`;\n    logHook('structure-location-validator', `BLOCKED: ${reason}`);\n    return outputBlock(reason);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Test Location Validator Hook\n * BLOCKING: Tests must be in correct location\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputBlock, logHook } from '../lib/common.js';\nimport { guardCodeFiles } from '../lib/guards.js';\n\n/**\n * Check if file is a test file\n */\nfunction isTestFile(filePath: string): boolean {\n  // TypeScript/JavaScript test patterns\n  if (/\\.(test|spec)\\.(ts|tsx|js|jsx)$/.test(filePath)) return true;\n\n  // Python test patterns\n  if (/(^|\\/)test_[^/]*\\.py$/.test(filePath)) return true;\n  if (/_test\\.py$/.test(filePath)) return true;\n\n  return false;\n}\n\n/**\n * Validate test file location\n */\nexport function testLocationValidator(input: HookInput): HookResult {\n  // Self-guard: Only run for code files\n  const guard = guardCodeFiles(input);\n  if (guard) return guard;\n\n  const filePath = input.tool_input.file_path || '';\n  if (!filePath) return outputSilentSuccess();\n\n  const filename = filePath.split('/').pop() || '';\n  const isTest = isTestFile(filePath);\n\n  // Rule 1: Test files MUST be in test directories\n  if (isTest) {\n    if (!/(tests\\/|__tests__\\/|\\/test\\/|test\\/)/.test(filePath)) {\n      const reason = `Test file must be in tests/, __tests__/, or test/ directory: ${filename}`;\n      logHook('test-location-validator', `BLOCKED: ${reason}`);\n      return outputBlock(reason);\n    }\n  }\n\n  // Rule 2: Source files CANNOT be in test directories\n  if (!isTest && /(tests\\/|__tests__\\/|\\/test\\/)/.test(filePath)) {\n    // Allow certain files in test directories\n    const allowedPatterns = [\n      /^(conftest|fixtures|factories|mocks|__init__|setup|helpers|utils)\\.py$/,\n      /^(setup|helpers|utils|mocks|fixtures)\\.(ts|js)$/,\n    ];\n\n    const isAllowed = allowedPatterns.some((pattern) => pattern.test(filename));\n    const isInAllowedDir = /\\/(fixtures|mocks|factories|__mocks__)\\//.test(filePath);\n\n    if (!isAllowed && !isInAllowedDir) {\n      const reason = `Source files cannot be in test directories: ${filename}`;\n      logHook('test-location-validator', `BLOCKED: ${reason}`);\n      return outputBlock(reason);\n    }\n  }\n\n  // Rule 3: TypeScript/JavaScript tests must use .test or .spec suffix\n  if (/\\.(ts|tsx|js|jsx)$/.test(filePath) && /(tests\\/|__tests__)/.test(filePath)) {\n    // Skip setup/utility files\n    if (/^(setup|jest|vitest|config|helpers|utils|mocks)\\./.test(filename)) {\n      return outputSilentSuccess();\n    }\n\n    // Must have .test or .spec suffix\n    if (!/\\.(test|spec)\\.(ts|tsx|js|jsx)$/.test(filename)) {\n      const reason = `Test files must use .test.ts or .spec.ts suffix: ${filename}`;\n      logHook('test-location-validator', `BLOCKED: ${reason}`);\n      return outputBlock(reason);\n    }\n  }\n\n  // Rule 4: Python tests must follow naming convention\n  if (filePath.endsWith('.py') && /(tests\\/|\\/test\\/)/.test(filePath)) {\n    // Skip utility files\n    if (/^(conftest|__init__|fixtures|factories|mocks|helpers)\\.py$/.test(filename)) {\n      return outputSilentSuccess();\n    }\n\n    // Must start with test_ or end with _test.py\n    if (!/^test_.*\\.py$/.test(filename) && !/_test\\.py$/.test(filename)) {\n      const reason = `Python test files must be named test_*.py or *_test.py: ${filename}`;\n      logHook('test-location-validator', `BLOCKED: ${reason}`);\n      return outputBlock(reason);\n    }\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Test Pattern Validator Hook\n * BLOCKING: Tests must follow AAA pattern and naming conventions\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputBlock, logHook } from '../lib/common.js';\n\n/**\n * Check if file is a test file\n */\nfunction isTestFile(filePath: string): boolean {\n  if (/\\.(test|spec)\\.(ts|tsx|js|jsx)$/.test(filePath)) return true;\n  if (/(^|\\/)test_[^/]*\\.py$/.test(filePath)) return true;\n  if (/_test\\.py$/.test(filePath)) return true;\n  return false;\n}\n\n/**\n * Validate test patterns and conventions\n */\nexport function testPatternValidator(input: HookInput): HookResult {\n  const filePath = input.tool_input?.file_path || '';\n  const content = input.tool_input?.content || (input as any).tool_result || '';\n\n  if (!filePath || !content) return outputSilentSuccess();\n\n  // Only validate test files\n  if (!isTestFile(filePath)) return outputSilentSuccess();\n\n  const errors: string[] = [];\n\n  // TypeScript/JavaScript test validation\n  if (/\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n    // Rule: Test names must be descriptive (not too short)\n    const shortTests = content.match(/(test|it)\\(['\"][^'\"]{1,10}['\"]/g);\n    if (shortTests) {\n      if (shortTests.some((t: string) => /test[0-9]|works|^test$/i.test(t))) {\n        errors.push('Test names too short or generic. Use descriptive names:');\n        errors.push(\"  BAD:  test('test1'), test('works')\");\n        errors.push(\"  GOOD: test('should return user when ID exists')\");\n      }\n    }\n\n    // Rule: No shared mutable state without beforeEach reset\n    if (/^let [a-zA-Z_][a-zA-Z0-9_]* =/m.test(content)) {\n      if (!/beforeEach\\s*\\(\\s*(async\\s*)?\\(\\s*\\)\\s*=>/.test(content)) {\n        errors.push('Shared mutable state detected without beforeEach reset:');\n        errors.push('  Add beforeEach(() => { /* reset state */ }) to ensure test isolation');\n      }\n    }\n\n    // Rule: Avoid too many expects in single test\n    const totalExpects = (content.match(/expect\\(/g) || []).length;\n    const totalTests = (content.match(/(test|it)\\s*\\(/g) || []).length || 1;\n    const avgExpects = Math.floor(totalExpects / totalTests);\n\n    if (avgExpects > 5) {\n      errors.push(`High assertion count (avg ${avgExpects} per test):`);\n      errors.push('  Consider splitting into focused tests with 1-3 assertions each');\n      errors.push('  Or add AAA comments (// Arrange, // Act, // Assert)');\n    }\n\n    // Rule: No console.log in tests\n    if (/console\\.(log|warn|error)\\(/.test(content)) {\n      errors.push('console.log found in test file:');\n      errors.push('  Remove debugging statements before committing');\n      errors.push('  Use proper assertions instead');\n    }\n\n    // Rule: No .only() left in tests\n    if (/(test|it|describe)\\.only\\(/.test(content)) {\n      errors.push('.only() found - this skips other tests:');\n      errors.push('  Remove .only() before committing');\n    }\n\n    // Rule: No .skip() without explanation\n    if (/(test|it|describe)\\.skip\\(/.test(content)) {\n      if (!/TODO|FIXME|skip.*because|temporarily/i.test(content)) {\n        errors.push('.skip() found without explanation:');\n        errors.push('  Add a comment explaining why the test is skipped');\n        errors.push(\"  Example: test.skip('reason: waiting for API fix')\");\n      }\n    }\n  }\n\n  // Python test validation\n  if (filePath.endsWith('.py')) {\n    // Rule: Test function naming must use snake_case\n    if (/def test[A-Z]/.test(content)) {\n      errors.push('Test names must use snake_case, not camelCase:');\n      errors.push('  BAD:  def testUserCreation()');\n      errors.push('  GOOD: def test_user_creation()');\n    }\n\n    // Rule: Use pytest fixtures, not unittest setUp/tearDown\n    if (/def (setUp|tearDown|setUpClass|tearDownClass)\\s*\\(/.test(content)) {\n      errors.push('Use pytest fixtures instead of unittest setUp/tearDown:');\n      errors.push('  BAD:  def setUp(self): ...');\n      errors.push('  GOOD: @pytest.fixture\\\\n        def setup_data(): ...');\n    }\n\n    // Rule: No class-level mutable defaults\n    if (/class Test.*:/.test(content)) {\n      if (/^\\s+[a-z_]+ = \\[\\]/m.test(content) || /^\\s+[a-z_]+ = \\{\\}/m.test(content)) {\n        errors.push('Class-level mutable defaults can cause test pollution:');\n        errors.push('  BAD:  class TestUser:\\\\n            items = []');\n        errors.push('  GOOD: Use @pytest.fixture to create fresh instances');\n      }\n    }\n\n    // Rule: No print statements in tests\n    if (/^\\s+print\\(/m.test(content)) {\n      errors.push('print() found in test file:');\n      errors.push('  Remove debugging statements before committing');\n      errors.push(\"  Use proper assertions or pytest's capfd fixture\");\n    }\n\n    // Rule: No @pytest.mark.skip without reason\n    if (/@pytest\\.mark\\.skip\\s*$/.test(content) || /@pytest\\.mark\\.skip\\(\\s*\\)/.test(content)) {\n      errors.push('@pytest.mark.skip without reason:');\n      errors.push(\"  Add reason: @pytest.mark.skip(reason='waiting for fix')\");\n    }\n\n    // Rule: Async tests should use pytest-asyncio\n    if (/async def test_/.test(content)) {\n      if (!/@pytest\\.mark\\.asyncio/.test(content)) {\n        errors.push('Async test found without @pytest.mark.asyncio:');\n        errors.push('  Add: @pytest.mark.asyncio');\n        errors.push('  Or set asyncio_mode = auto in pytest.ini');\n      }\n    }\n  }\n\n  // Report errors and block\n  if (errors.length > 0) {\n    logHook('test-pattern-validator', `BLOCKED: ${errors[0]}`);\n    return outputBlock(`Test pattern violations detected in ${filePath}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Test Runner Hook\n * Runs after Write in testing skills\n * Auto-runs the test file that was just created/modified\n * CC 2.1.7 Compliant\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir } from '../lib/common.js';\n\n/**\n * Find project root by looking for package.json\n */\nfunction findProjectRoot(startDir: string): string | null {\n  let dir = startDir;\n  while (dir !== '/') {\n    if (existsSync(`${dir}/package.json`)) {\n      return dir;\n    }\n    dir = dir.substring(0, dir.lastIndexOf('/'));\n  }\n  return null;\n}\n\n/**\n * Auto-run test file that was just created/modified\n */\nexport function testRunner(input: HookInput): HookResult {\n  const filePath = input.tool_input?.file_path || process.env.CC_TOOL_FILE_PATH || '';\n\n  // Early exit if no file path\n  if (!filePath) return outputSilentSuccess();\n\n  // Python test files\n  if (/test.*\\.py$/.test(filePath) || /_test\\.py$/.test(filePath)) {\n    process.stderr.write(`::group::Auto-running Python test: ${filePath.split('/').pop()}\\n`);\n\n    const dir = filePath.substring(0, filePath.lastIndexOf('/'));\n\n    try {\n      // Check for poetry\n      if (existsSync(`${dir}/pyproject.toml`)) {\n        try {\n          execSync('command -v poetry', { stdio: ['pipe', 'pipe', 'pipe'] });\n          const result = execSync(`poetry run pytest \"${filePath}\" -v --tb=short`, {\n            cwd: dir,\n            encoding: 'utf8',\n            timeout: 60000,\n            stdio: ['pipe', 'pipe', 'pipe'],\n          });\n          const lines = result.split('\\n').slice(-30);\n          process.stderr.write(lines.join('\\n') + '\\n');\n        } catch {\n          // Poetry not available, try pytest directly\n        }\n      }\n\n      // Try pytest directly\n      try {\n        execSync('command -v pytest', { stdio: ['pipe', 'pipe', 'pipe'] });\n        const result = execSync(`pytest \"${filePath}\" -v --tb=short`, {\n          cwd: dir,\n          encoding: 'utf8',\n          timeout: 60000,\n          stdio: ['pipe', 'pipe', 'pipe'],\n        });\n        const lines = result.split('\\n').slice(-30);\n        process.stderr.write(lines.join('\\n') + '\\n');\n      } catch {\n        process.stderr.write('pytest not found - skipping auto-run\\n');\n      }\n    } catch (error) {\n      // Test execution errors are logged but don't block\n      if (error instanceof Error) {\n        process.stderr.write(`Test execution error: ${error.message}\\n`);\n      }\n    }\n\n    process.stderr.write('::endgroup::\\n');\n  }\n\n  // TypeScript/JavaScript test files\n  if (/\\.(test|spec)\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n    process.stderr.write(`::group::Auto-running TypeScript test: ${filePath.split('/').pop()}\\n`);\n\n    // Find project root\n    const projectRoot = findProjectRoot(filePath.substring(0, filePath.lastIndexOf('/')));\n\n    if (projectRoot) {\n      try {\n        const testPattern = filePath\n          .split('/')\n          .pop()\n          ?.replace(/\\.[^.]+$/, '')\n          .replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\n        const result = execSync(`npm test -- --testPathPattern=\"${testPattern}\"`, {\n          cwd: projectRoot,\n          encoding: 'utf8',\n          timeout: 60000,\n          stdio: ['pipe', 'pipe', 'pipe'],\n        });\n        const lines = result.split('\\n').slice(-30);\n        process.stderr.write(lines.join('\\n') + '\\n');\n      } catch (error) {\n        // Test execution errors are logged but don't block\n        if (error instanceof Error) {\n          process.stderr.write(`Test execution error: ${error.message}\\n`);\n        }\n      }\n    }\n\n    process.stderr.write('::endgroup::\\n');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Antipattern Detector - UserPromptSubmit Hook\n * Suggests checking mem0 for known failed patterns before implementation\n * CC 2.1.7 Compliant\n *\n * Part of mem0 Semantic Memory Integration (#49)\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\n\n// Keywords that suggest implementation work where antipatterns matter\nconst IMPLEMENTATION_KEYWORDS = [\n  'implement',\n  'add',\n  'create',\n  'build',\n  'set up',\n  'configure',\n  'pagination',\n  'authentication',\n  'caching',\n  'database',\n  'api',\n  'endpoint',\n];\n\n/**\n * Detect best practice category from prompt\n */\nfunction detectCategory(prompt: string): string {\n  const promptLower = prompt.toLowerCase();\n\n  if (/pagination|cursor|offset|page/i.test(promptLower)) return 'pagination';\n  if (/auth|jwt|oauth|login|session/i.test(promptLower)) return 'authentication';\n  if (/cache|redis|memo/i.test(promptLower)) return 'caching';\n  if (/database|sql|postgres|query/i.test(promptLower)) return 'database';\n  if (/api|endpoint|rest|graphql/i.test(promptLower)) return 'api';\n  if (/error|exception|handling/i.test(promptLower)) return 'error-handling';\n  if (/test|testing|spec/i.test(promptLower)) return 'testing';\n\n  return 'general';\n}\n\n/**\n * Generate mem0 user ID for a scope\n */\nfunction getMem0UserId(scope: string, projectDir: string): string {\n  const projectName = projectDir.split('/').pop() || 'unknown';\n  return `project:${projectName}:${scope}`;\n}\n\n/**\n * Generate global mem0 user ID\n */\nfunction getGlobalUserId(scope: string): string {\n  return `global:${scope}`;\n}\n\n/**\n * Antipattern detector - suggests mem0 search for known failures\n */\nexport function antipatternDetector(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Skip if prompt too short\n  if (prompt.length < 30) {\n    return outputSilentSuccess();\n  }\n\n  // Check if prompt suggests implementation work\n  const promptLower = prompt.toLowerCase();\n  let matchedKeyword = '';\n\n  for (const keyword of IMPLEMENTATION_KEYWORDS) {\n    if (promptLower.includes(keyword)) {\n      matchedKeyword = keyword;\n      break;\n    }\n  }\n\n  if (!matchedKeyword) {\n    return outputSilentSuccess();\n  }\n\n  logHook('antipattern-detector', `Implementation keyword detected: ${matchedKeyword}`);\n\n  // Get category and user IDs for search suggestion\n  const category = detectCategory(prompt);\n  const projectUserId = getMem0UserId('best-practices', projectDir);\n  const globalUserId = getGlobalUserId('best-practices');\n\n  logHook('antipattern-detector', `Suggesting antipattern check for: ${matchedKeyword} (category: ${category})`);\n\n  // Build search suggestion message\n  const systemMsg = `[Antipattern Check] Before implementing ${matchedKeyword}, check for known failures:\n\\`mcp__mem0__search_memories\\` with query=\"${matchedKeyword} failed\" and filters={\"AND\":[{\"user_id\":\"${projectUserId}\"},{\"metadata.outcome\":\"failed\"}]}\nOr check global: user_id=\"${globalUserId}\"`;\n\n  return {\n    continue: true,\n    systemMessage: systemMsg,\n  };\n}\n", "/**\n * Antipattern Warning - UserPromptSubmit Hook\n * Proactive anti-pattern detection and warning injection\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext for warnings\n *\n * Enhanced with Mem0 semantic search hints for project/global anti-patterns.\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputPromptContext, logHook, getProjectDir } from '../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n// Keywords that indicate implementation intent\nconst IMPLEMENTATION_KEYWORDS = [\n  'implement',\n  'add',\n  'create',\n  'build',\n  'set up',\n  'setup',\n  'configure',\n  'use',\n  'write',\n  'make',\n  'develop',\n];\n\n// Known anti-patterns database\nconst KNOWN_ANTIPATTERNS: Array<{ pattern: string; warning: string }> = [\n  {\n    pattern: 'offset pagination',\n    warning:\n      'Offset pagination causes performance issues on large tables. Use cursor-based pagination instead.',\n  },\n  {\n    pattern: 'manual jwt validation',\n    warning:\n      'Manual JWT validation is error-prone. Use established libraries like python-jose or jsonwebtoken.',\n  },\n  {\n    pattern: 'storing passwords in plaintext',\n    warning: 'Never store passwords in plaintext. Use bcrypt, argon2, or scrypt.',\n  },\n  {\n    pattern: 'global state',\n    warning:\n      'Global mutable state causes testing and concurrency issues. Use dependency injection.',\n  },\n  {\n    pattern: 'synchronous file operations',\n    warning: 'Synchronous file I/O blocks the event loop. Use async file operations.',\n  },\n  {\n    pattern: 'n+1 query',\n    warning: 'N+1 queries cause performance problems. Use eager loading or batch queries.',\n  },\n  {\n    pattern: 'polling for real-time',\n    warning: 'Polling is inefficient for real-time updates. Consider SSE or WebSocket.',\n  },\n];\n\ninterface LearnedPattern {\n  text: string;\n  outcome?: string;\n}\n\ninterface PatternsFile {\n  patterns?: LearnedPattern[];\n}\n\ninterface GlobalAntipattern {\n  pattern: string;\n  warning: string;\n}\n\ninterface GlobalPatternsFile {\n  antipatterns?: GlobalAntipattern[];\n}\n\n/**\n * Check if prompt contains implementation keywords\n */\nfunction isImplementationPrompt(prompt: string): boolean {\n  const promptLower = prompt.toLowerCase();\n\n  for (const keyword of IMPLEMENTATION_KEYWORDS) {\n    if (promptLower.includes(keyword)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Detect best practice category from prompt\n */\nfunction detectCategory(prompt: string): string {\n  const promptLower = prompt.toLowerCase();\n\n  if (/pagination|cursor|offset|page/i.test(promptLower)) return 'pagination';\n  if (/auth|jwt|oauth|login|session/i.test(promptLower)) return 'authentication';\n  if (/cache|redis|memo/i.test(promptLower)) return 'caching';\n  if (/database|sql|postgres|query/i.test(promptLower)) return 'database';\n  if (/api|endpoint|rest|graphql/i.test(promptLower)) return 'api';\n\n  return 'general';\n}\n\n/**\n * Search local patterns for anti-patterns\n */\nfunction searchLocalAntipatterns(prompt: string, projectDir: string): string[] {\n  const promptLower = prompt.toLowerCase();\n  const warnings: string[] = [];\n\n  // Check known anti-patterns\n  for (const { pattern, warning } of KNOWN_ANTIPATTERNS) {\n    if (promptLower.includes(pattern)) {\n      warnings.push(warning);\n    }\n  }\n\n  // Check learned patterns file\n  const patternsFile = join(projectDir, '.claude', 'feedback', 'learned-patterns.json');\n  if (existsSync(patternsFile)) {\n    try {\n      const data: PatternsFile = JSON.parse(readFileSync(patternsFile, 'utf8'));\n      const failedPatterns = (data.patterns || []).filter((p) => p.outcome === 'failed');\n\n      for (const pattern of failedPatterns) {\n        if (pattern.text) {\n          const patternLower = pattern.text.toLowerCase();\n          const firstWord = patternLower.split(' ')[0];\n          if (firstWord && promptLower.includes(firstWord)) {\n            warnings.push(`Previously failed: ${pattern.text}`);\n          }\n        }\n      }\n    } catch {\n      // Ignore parse errors\n    }\n  }\n\n  // Check global patterns\n  const globalPatternsFile = join(process.env.HOME || '', '.claude', 'global-patterns.json');\n  if (existsSync(globalPatternsFile)) {\n    try {\n      const data: GlobalPatternsFile = JSON.parse(readFileSync(globalPatternsFile, 'utf8'));\n      for (const { pattern, warning } of data.antipatterns || []) {\n        if (promptLower.includes(pattern.toLowerCase())) {\n          warnings.push(`${pattern}: ${warning}`);\n        }\n      }\n    } catch {\n      // Ignore parse errors\n    }\n  }\n\n  return warnings;\n}\n\n/**\n * Generate mem0 user ID for a scope\n */\nfunction getMem0UserId(scope: string, projectDir: string): string {\n  const projectName = projectDir.split('/').pop() || 'unknown';\n  return `project:${projectName}:${scope}`;\n}\n\n/**\n * Build mem0 search hint for the prompt\n */\nfunction buildMem0SearchHint(prompt: string, projectDir: string): string {\n  const category = detectCategory(prompt);\n  const userId = getMem0UserId('best-practices', projectDir);\n  const globalUserId = `global:best-practices`;\n\n  return `Before implementing, search Mem0 for relevant patterns (graph memory enabled):\n\n1. Project anti-patterns (category: ${category}):\n   mcp__mem0__search_memories with:\n   {\"query\": \"${prompt.slice(0, 50)}\", \"user_id\": \"${userId}\", \"filters\": {\"metadata.outcome\": \"failed\"}}\n\n2. Project best practices:\n   mcp__mem0__search_memories with:\n   {\"query\": \"${prompt.slice(0, 50)}\", \"user_id\": \"${userId}\", \"filters\": {\"metadata.outcome\": \"success\"}}\n\n3. Cross-project failures:\n   mcp__mem0__search_memories with:\n   {\"query\": \"${prompt.slice(0, 50)}\", \"user_id\": \"${globalUserId}\", \"filters\": {\"metadata.outcome\": \"failed\"}}`;\n}\n\n/**\n * Antipattern warning hook - detects and warns about known anti-patterns\n */\nexport function antipatternWarning(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  if (!prompt) {\n    return outputSilentSuccess();\n  }\n\n  // Only check implementation prompts\n  if (!isImplementationPrompt(prompt)) {\n    return outputSilentSuccess();\n  }\n\n  logHook('antipattern-warning', 'Checking prompt for anti-patterns...');\n\n  // Search for matching anti-patterns\n  const warnings = searchLocalAntipatterns(prompt, projectDir);\n\n  // Build mem0 search hints\n  const mem0SearchHints = buildMem0SearchHint(prompt, projectDir);\n\n  if (warnings.length > 0) {\n    logHook('antipattern-warning', `Found anti-pattern warnings: ${warnings.join(', ')}`);\n\n    // Build warning message with mem0 search hints\n    const warningMessage = `## Anti-Pattern Warning\n\nThe following patterns have previously caused issues:\n\n${warnings.map((w) => `- ${w}`).join('\\n')}\n\nConsider alternative approaches before proceeding.\n\n${mem0SearchHints}`;\n\n    return outputPromptContext(warningMessage);\n  }\n\n  // No local warnings - provide mem0 search hints for significant implementation tasks\n  if (/implement|build|create|develop/.test(prompt.toLowerCase())) {\n    return outputPromptContext(mem0SearchHints);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Context Injector - UserPromptSubmit Hook\n * Injects relevant context hints based on user prompt keywords\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Context injector hook - adds helpful hints based on prompt content\n */\nexport function contextInjector(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  logHook('context-injector', `User prompt received (${prompt.length} chars)`);\n\n  const contextHints: string[] = [];\n\n  // If prompt mentions issues or bugs, remind about issue docs\n  if (/issue|bug|fix|#[0-9]+/.test(prompt)) {\n    const issueDocsDir = join(projectDir, 'docs', 'issues');\n    if (existsSync(issueDocsDir)) {\n      contextHints.push('Check docs/issues/ for issue documentation.');\n    }\n  }\n\n  // If prompt mentions testing, remind about test patterns\n  if (/test|testing|pytest|jest/.test(prompt.toLowerCase())) {\n    contextHints.push(\"Remember to use 'tee' for visible test output.\");\n  }\n\n  // If prompt mentions deployment or CI/CD\n  if (/deploy|ci|cd|pipeline|github.actions/.test(prompt.toLowerCase())) {\n    contextHints.push('Check .github/workflows/ for CI configuration.');\n  }\n\n  // Log context hints if any\n  if (contextHints.length > 0) {\n    logHook('context-injector', `Context hints: ${contextHints.join(' ')}`);\n  }\n\n  // Currently outputs silent success - hints are logged only\n  // Could be enhanced to use additionalContext in the future\n  return outputSilentSuccess();\n}\n", "/**\n * Context Pruning Advisor - UserPromptSubmit Hook\n * Recommends context pruning when usage exceeds 70%\n *\n * Analyzes loaded context (skills, files, agent outputs) and scores by:\n * - Recency: How recently was it accessed? (0-10 points)\n * - Frequency: How often accessed this session? (0-10 points)\n * - Relevance: How related to current prompt? (0-10 points)\n *\n * Total score: 0-30 points\n * Pruning threshold: Items with score < 15 are candidates\n *\n * Issue: #126\n * CC 2.1.9 Compliant: Uses additionalContext for recommendations\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport {\n  outputSilentSuccess,\n  outputPromptContext,\n  logHook,\n  getProjectDir,\n  getSessionId,\n} from '../lib/common.js';\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join, dirname } from 'node:path';\n\n// Configuration\nconst CONTEXT_TRIGGER = 0.7; // Trigger at 70% context usage\nconst CONTEXT_CRITICAL = 0.95; // Critical threshold\nconst PRUNE_THRESHOLD_HIGH = 8; // Score 0-8: High priority pruning\nconst PRUNE_THRESHOLD_MED = 15; // Score 9-15: Medium priority pruning\nconst MAX_RECOMMENDATIONS = 5; // Limit recommendations\n\ninterface ContextItem {\n  id: string;\n  tags?: string[];\n  last_accessed?: string;\n  loaded_at?: string;\n  access_count?: number;\n  estimated_tokens?: number;\n}\n\ninterface StateFile {\n  session_id: string;\n  updated_at: string;\n  total_context_tokens: number;\n  context_budget: number;\n  items: ContextItem[];\n}\n\n/**\n * Calculate recency score (0-10) based on time since last access\n */\nfunction calculateRecencyScore(lastAccessed: string | undefined): number {\n  if (!lastAccessed) return 0;\n\n  const currentTime = Date.now();\n  let lastEpoch: number;\n\n  if (/^\\d+$/.test(lastAccessed)) {\n    lastEpoch = parseInt(lastAccessed, 10);\n  } else {\n    lastEpoch = new Date(lastAccessed).getTime();\n    if (isNaN(lastEpoch)) return 0;\n  }\n\n  const ageMinutes = (currentTime - lastEpoch) / (1000 * 60);\n\n  if (ageMinutes <= 5) return 10;\n  if (ageMinutes <= 15) return 8;\n  if (ageMinutes <= 30) return 6;\n  if (ageMinutes <= 60) return 4;\n  if (ageMinutes <= 120) return 2;\n  return 0;\n}\n\n/**\n * Calculate frequency score (0-10) based on access count\n */\nfunction calculateFrequencyScore(count: number): number {\n  if (count >= 10) return 10;\n  if (count >= 7) return 8;\n  if (count >= 4) return 6;\n  if (count >= 2) return 4;\n  if (count >= 1) return 2;\n  return 0;\n}\n\n/**\n * Calculate relevance score (0-10) based on keyword overlap\n */\nfunction calculateRelevanceScore(itemKeywords: string[], promptKeywords: string[]): number {\n  if (itemKeywords.length === 0 || promptKeywords.length === 0) {\n    return 2; // Generic/infrastructure default\n  }\n\n  const itemSet = new Set(itemKeywords.map((k) => k.toLowerCase()));\n  const promptSet = new Set(promptKeywords.map((k) => k.toLowerCase()));\n\n  let overlap = 0;\n  for (const keyword of itemSet) {\n    if (promptSet.has(keyword)) {\n      overlap++;\n    }\n  }\n\n  const overlapRatio = overlap / itemSet.size;\n\n  if (overlapRatio >= 0.75) return 10;\n  if (overlapRatio >= 0.5) return 8;\n  if (overlapRatio >= 0.3) return 6;\n  if (overlapRatio >= 0.15) return 4;\n  if (overlap > 0) return 2;\n  return 0;\n}\n\n/**\n * Extract keywords from user prompt\n */\nfunction extractPromptKeywords(prompt: string): string[] {\n  const stopwords = new Set([\n    'the',\n    'and',\n    'for',\n    'with',\n    'from',\n    'that',\n    'this',\n    'have',\n    'will',\n    'can',\n    'should',\n    'would',\n    'could',\n  ]);\n\n  return prompt\n    .toLowerCase()\n    .match(/\\b[a-z]{3,}\\b/g)\n    ?.filter((word) => !stopwords.has(word))\n    .slice(0, 20) || [];\n}\n\n/**\n * Get state file path\n */\nfunction getStateFilePath(): string {\n  const sessionId = getSessionId();\n  return `/tmp/claude-context-tracking-${sessionId}.json`;\n}\n\n/**\n * Initialize or load state file\n */\nfunction loadOrInitState(): StateFile {\n  const stateFile = getStateFilePath();\n\n  if (existsSync(stateFile)) {\n    try {\n      return JSON.parse(readFileSync(stateFile, 'utf8'));\n    } catch {\n      // Fall through to create new\n    }\n  }\n\n  const sessionId = getSessionId();\n  const state: StateFile = {\n    session_id: sessionId,\n    updated_at: new Date().toISOString(),\n    total_context_tokens: 0,\n    context_budget: 12000,\n    items: [],\n  };\n\n  writeFileSync(stateFile, JSON.stringify(state, null, 2));\n  return state;\n}\n\n/**\n * Get estimated context usage percentage\n */\nfunction getContextUsagePercentage(state: StateFile): number {\n  // Try environment variable first (if available from CC)\n  const envPercent = process.env.CLAUDE_CONTEXT_USAGE_PERCENT;\n  if (envPercent) {\n    const parsed = parseFloat(envPercent);\n    if (!isNaN(parsed)) return parsed;\n  }\n\n  // Fallback to state file estimate\n  if (state.context_budget > 0) {\n    return state.total_context_tokens / state.context_budget;\n  }\n\n  return 0;\n}\n\ninterface PruneCandidate {\n  score: number;\n  priority: string;\n  itemId: string;\n  tokens: number;\n}\n\n/**\n * Analyze context and generate pruning recommendations\n */\nfunction analyzeAndRecommend(state: StateFile, promptKeywords: string[]): PruneCandidate[] {\n  const candidates: PruneCandidate[] = [];\n\n  for (const item of state.items) {\n    const lastAccessed = item.last_accessed || item.loaded_at;\n    const accessCount = item.access_count || 0;\n    const keywords = item.tags || [];\n\n    const recencyScore = calculateRecencyScore(lastAccessed);\n    const frequencyScore = calculateFrequencyScore(accessCount);\n    const relevanceScore = calculateRelevanceScore(keywords, promptKeywords);\n    const totalScore = recencyScore + frequencyScore + relevanceScore;\n\n    logHook(\n      'context-pruning-advisor',\n      `Scored ${item.id}: R=${recencyScore} F=${frequencyScore} V=${relevanceScore} Total=${totalScore}`\n    );\n\n    if (totalScore <= PRUNE_THRESHOLD_MED) {\n      candidates.push({\n        score: totalScore,\n        priority: totalScore <= PRUNE_THRESHOLD_HIGH ? 'HIGH' : 'MED',\n        itemId: item.id,\n        tokens: item.estimated_tokens || 500,\n      });\n    }\n  }\n\n  // Sort by score ascending (lowest first) and limit\n  return candidates.sort((a, b) => a.score - b.score).slice(0, MAX_RECOMMENDATIONS);\n}\n\n/**\n * Build recommendation message\n */\nfunction buildRecommendationMessage(candidates: PruneCandidate[]): string {\n  let totalSavings = 0;\n  const lines: string[] = [];\n\n  for (let i = 0; i < candidates.length; i++) {\n    const { priority, itemId, score, tokens } = candidates[i];\n    totalSavings += tokens;\n\n    // Format item name for display\n    const displayName = itemId.replace(/^(skill:|file:|agent:)/, '');\n    lines.push(`  ${i + 1}. [${priority}] ${displayName} (score: ${score}, saves ~${tokens}t)`);\n  }\n\n  return `Context usage >70%. Pruning recommendations:\n${lines.join('\\n')}\n\nPotential savings: ~${totalSavings} tokens\nTo prune: Archive or unload low-scoring context items.`;\n}\n\n/**\n * Context pruning advisor hook\n */\nexport function contextPruningAdvisor(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const prompt = input.prompt || '';\n\n  // Ensure log directory exists\n  const logDir = join(projectDir, 'logs');\n  if (!existsSync(logDir)) {\n    try {\n      mkdirSync(logDir, { recursive: true });\n    } catch {\n      // Ignore\n    }\n  }\n\n  // Initialize/load state\n  const state = loadOrInitState();\n\n  // Get current context usage\n  const contextUsage = getContextUsagePercentage(state);\n  logHook(\n    'context-pruning-advisor',\n    `Context usage: ${contextUsage} (trigger threshold: ${CONTEXT_TRIGGER})`\n  );\n\n  // Fast exit: Context usage below threshold\n  if (contextUsage < CONTEXT_TRIGGER) {\n    logHook('context-pruning-advisor', 'Context usage within limits, no pruning needed');\n    return outputSilentSuccess();\n  }\n\n  // Critical path: Context usage at critical level (>95%)\n  if (contextUsage >= CONTEXT_CRITICAL) {\n    logHook('context-pruning-advisor', `CRITICAL: Context usage at ${contextUsage * 100}% (>95%)`);\n    const criticalMsg = `CRITICAL: Context usage at ${Math.round(contextUsage * 100)}% (>95%). Use /ork:context-compression immediately or manually archive old decisions and patterns.`;\n    return outputPromptContext(criticalMsg);\n  }\n\n  // Extract keywords from current prompt\n  if (!prompt) {\n    logHook('context-pruning-advisor', 'No user prompt found in hook input, skipping analysis');\n    return outputSilentSuccess();\n  }\n\n  const promptKeywords = extractPromptKeywords(prompt);\n  logHook('context-pruning-advisor', `Extracted prompt keywords: ${promptKeywords.join(', ')}`);\n\n  // Analyze context and generate recommendations\n  const candidates = analyzeAndRecommend(state, promptKeywords);\n\n  if (candidates.length > 0) {\n    const message = buildRecommendationMessage(candidates);\n    logHook(\n      'context-pruning-advisor',\n      `Recommending ${candidates.length} pruning candidates`\n    );\n    return outputPromptContext(message);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Context - UserPromptSubmit Hook\n * Auto-searches knowledge graph for relevant context based on user prompt\n * CC 2.1.7 Compliant\n *\n * Graph-First Architecture (v2.1):\n * - ALWAYS works - knowledge graph requires no configuration\n * - Primary: Search knowledge graph (mcp__memory__search_nodes)\n * - Optional: Also search mem0 for semantic matches if configured\n *\n * Part of Memory Fabric v2.1\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n// Keywords that suggest memory search would be valuable\nconst MEMORY_TRIGGER_KEYWORDS = [\n  'add',\n  'implement',\n  'create',\n  'build',\n  'design',\n  'refactor',\n  'update',\n  'modify',\n  'fix',\n  'change',\n  'continue',\n  'resume',\n  'remember',\n  'previous',\n  'last time',\n  'before',\n  'earlier',\n  'pattern',\n  'decision',\n  'how did we',\n  'what did we',\n];\n\n// Keywords that suggest graph search would be valuable\nconst GRAPH_TRIGGER_KEYWORDS = [\n  'relationship',\n  'related',\n  'connected',\n  'depends',\n  'uses',\n  'recommends',\n  'what does.*recommend',\n  'how does.*work with',\n];\n\n// Minimum prompt length to trigger memory search\nconst MIN_PROMPT_LENGTH = 20;\n\n/**\n * Check if prompt contains memory trigger keywords\n */\nfunction shouldSearchMemory(prompt: string): boolean {\n  const promptLower = prompt.toLowerCase();\n\n  for (const keyword of MEMORY_TRIGGER_KEYWORDS) {\n    if (promptLower.includes(keyword)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Check if prompt contains graph trigger keywords\n */\nfunction hasGraphTrigger(prompt: string): boolean {\n  const promptLower = prompt.toLowerCase();\n\n  for (const keyword of GRAPH_TRIGGER_KEYWORDS) {\n    if (new RegExp(keyword, 'i').test(promptLower)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Extract search terms from prompt\n */\nfunction extractSearchTerms(prompt: string): string {\n  const stopwords = new Set([\n    'the',\n    'a',\n    'an',\n    'to',\n    'for',\n    'in',\n    'on',\n    'at',\n    'is',\n    'are',\n    'was',\n    'were',\n    'be',\n    'been',\n    'being',\n    'have',\n    'has',\n    'had',\n    'do',\n    'does',\n    'did',\n    'will',\n    'would',\n    'could',\n    'should',\n    'can',\n    'may',\n    'might',\n    'must',\n    'shall',\n    'i',\n    'you',\n    'we',\n    'they',\n    'it',\n    'this',\n    'that',\n    'these',\n    'those',\n    'my',\n    'your',\n    'our',\n    'their',\n    'its',\n    'and',\n    'or',\n    'but',\n    'if',\n    'then',\n    'else',\n    'when',\n    'where',\n    'how',\n    'what',\n    'which',\n    'who',\n    'whom',\n    'with',\n    'from',\n    'into',\n    'onto',\n    'about',\n    'after',\n    'before',\n    'global',\n  ]);\n\n  const words = prompt\n    .toLowerCase()\n    .replace(/[^a-z\\s]/g, ' ')\n    .split(/\\s+/)\n    .filter((word) => word.length > 2 && !stopwords.has(word))\n    .slice(0, 5);\n\n  return words.join(' ');\n}\n\n/**\n * Generate mem0 user ID for a scope\n */\nfunction getMem0UserId(scope: string, projectDir: string): string {\n  const projectName = projectDir.split('/').pop() || 'unknown';\n  return `project:${projectName}:${scope}`;\n}\n\n/**\n * Get current agent ID if available\n */\nfunction getAgentContext(projectDir: string): string {\n  // Check environment variable first\n  const agentId = process.env.CLAUDE_AGENT_ID;\n  if (agentId) return agentId;\n\n  // Check agent tracking file\n  const trackingFile = join(projectDir, '.claude', 'session', 'current-agent-id');\n  if (existsSync(trackingFile)) {\n    try {\n      return readFileSync(trackingFile, 'utf8').trim();\n    } catch {\n      // Ignore\n    }\n  }\n\n  return '';\n}\n\n/**\n * Memory context hook - suggests memory searches for relevant context\n */\nexport function memoryContext(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  const isMem0Available = false; // Simplified - mem0 availability would be checked at runtime\n\n  logHook('memory-context', `Memory context hook starting (graph-first, mem0=${isMem0Available})`);\n\n  // Skip if prompt is too short\n  if (prompt.length < MIN_PROMPT_LENGTH) {\n    logHook('memory-context', `Prompt too short (${prompt.length} chars), skipping memory search`);\n    return outputSilentSuccess();\n  }\n\n  // Check for special prefixes\n  const useGlobal =\n    prompt.startsWith('@global') ||\n    prompt.includes('cross-project') ||\n    prompt.includes('all projects');\n  const useGraph = hasGraphTrigger(prompt);\n\n  if (useGlobal) {\n    logHook('memory-context', 'Detected @global prefix - will suggest cross-project search');\n  }\n\n  if (useGraph) {\n    logHook('memory-context', 'Detected graph-related query');\n  }\n\n  // Get agent context\n  const agentContext = getAgentContext(projectDir);\n  if (agentContext) {\n    logHook('memory-context', `Agent context detected: ${agentContext}`);\n  }\n\n  // Check if memory search would be valuable\n  if (!shouldSearchMemory(prompt)) {\n    logHook('memory-context', 'No memory trigger keywords found, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Extract search terms\n  const searchTerms = extractSearchTerms(prompt);\n  if (!searchTerms) {\n    logHook('memory-context', 'No search terms extracted, skipping');\n    return outputSilentSuccess();\n  }\n\n  logHook('memory-context', `Search terms: ${searchTerms}`);\n\n  // Build scope description\n  const scopeDesc = useGlobal ? 'cross-project' : 'project';\n\n  // Build context suggestion message\n  // NOTE: We build the message but return silent success\n  // The original bash hook did the same - built the message but returned silently\n  // Claude already has access to memory tools\n\n  const userIdDecisions = getMem0UserId('decisions', projectDir);\n\n  let systemMsg = `[Memory Context] For relevant past ${scopeDesc} decisions, use mcp__memory__search_nodes with query=\"${searchTerms}\"`;\n\n  // Add relationship hint if graph-related query\n  if (useGraph) {\n    systemMsg +=\n      ' | For relationships: mcp__memory__open_nodes on found entities | Graph traversal available';\n  }\n\n  // Add mem0 hint if available\n  if (isMem0Available && userIdDecisions) {\n    systemMsg += ` | [Enhanced] For semantic search: mcp__mem0__search_memories query=\"${searchTerms}\" user_id=\"${userIdDecisions}\" enable_graph=true`;\n\n    if (!useGlobal) {\n      systemMsg += ' | Cross-project: user_id=\"global:best-practices\"';\n    }\n  }\n\n  // Add agent context hint\n  if (agentContext) {\n    systemMsg += ` | Agent context: ${agentContext}`;\n  }\n\n  logHook('memory-context', `Memory context available for: ${searchTerms}`);\n\n  // Silent operation - Claude already has access to memory tools\n  return outputSilentSuccess();\n}\n", "/**\n * Satisfaction Detector - UserPromptSubmit Hook\n * Detects user satisfaction signals from conversation patterns\n * CC 2.1.7 Compliant\n *\n * Strategy:\n * - Analyze user prompt for positive/negative signals\n * - Track satisfaction per session\n * - Log to feedback system for reporting\n *\n * Performance optimization:\n * - Sampling mode: only analyzes every Nth prompt to reduce overhead\n * - Configure via SATISFACTION_SAMPLE_RATE (default: 3)\n *\n * Part of Feedback System (#57)\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir, getSessionId } from '../lib/common.js';\nimport { existsSync, readFileSync, writeFileSync, appendFileSync, mkdirSync } from 'node:fs';\nimport { join, dirname } from 'node:path';\n\n// Configuration\nconst MIN_PROMPT_LENGTH = 2;\n\n// Positive signal patterns\nconst POSITIVE_PATTERNS = [\n  /\\bthank/i,\n  /\\bgreat\\b/i,\n  /\\bperfect\\b/i,\n  /\\bexcellent\\b/i,\n  /\\bawesome\\b/i,\n  /\\bworks?\\b.*\\b(well|great|perfectly)/i,\n  /\\bthat('s| is) (exactly|just) what/i,\n  /\\bnice\\b/i,\n  /\\bgood job\\b/i,\n  /\\bwell done\\b/i,\n  /\\blooks? good\\b/i,\n  /\\blgtm\\b/i,\n  /\\bship it\\b/i,\n];\n\n// Negative signal patterns\nconst NEGATIVE_PATTERNS = [\n  /\\bno(t| ).*right/i,\n  /\\bwrong\\b/i,\n  /\\bdoesn't work/i,\n  /\\bbroken\\b/i,\n  /\\bfailed\\b/i,\n  /\\btry again\\b/i,\n  /\\bstart over\\b/i,\n  /\\bundo\\b/i,\n  /\\brevert\\b/i,\n  /\\bfrustrat/i,\n  /\\bannoy/i,\n  /\\bconfus/i,\n  /\\bstill (not|doesn't)/i,\n  /\\bdidn't (work|help)/i,\n  /\\bthat's not/i,\n];\n\n/**\n * Detect satisfaction from prompt\n */\nfunction detectSatisfaction(prompt: string): 'positive' | 'negative' | 'neutral' {\n  // Check positive patterns\n  for (const pattern of POSITIVE_PATTERNS) {\n    if (pattern.test(prompt)) {\n      return 'positive';\n    }\n  }\n\n  // Check negative patterns\n  for (const pattern of NEGATIVE_PATTERNS) {\n    if (pattern.test(prompt)) {\n      return 'negative';\n    }\n  }\n\n  return 'neutral';\n}\n\n/**\n * Get counter file path\n */\nfunction getCounterFilePath(projectDir: string): string {\n  return join(projectDir, '.claude', '.satisfaction-counter');\n}\n\n/**\n * Get or increment counter for sampling\n */\nfunction getAndIncrementCounter(projectDir: string): number {\n  const counterFile = getCounterFilePath(projectDir);\n\n  // Ensure directory exists\n  const dir = dirname(counterFile);\n  if (!existsSync(dir)) {\n    try {\n      mkdirSync(dir, { recursive: true });\n    } catch {\n      // Ignore\n    }\n  }\n\n  let counter = 0;\n  if (existsSync(counterFile)) {\n    try {\n      counter = parseInt(readFileSync(counterFile, 'utf8').trim(), 10) || 0;\n    } catch {\n      // Ignore\n    }\n  }\n\n  counter++;\n\n  try {\n    writeFileSync(counterFile, String(counter));\n  } catch {\n    // Ignore\n  }\n\n  return counter;\n}\n\n/**\n * Log satisfaction signal to feedback file\n */\nfunction logSatisfaction(sessionId: string, sentiment: string, context: string, projectDir: string): void {\n  const feedbackDir = join(projectDir, '.claude', 'feedback');\n  const logFile = join(feedbackDir, 'satisfaction.log');\n\n  // Ensure directory exists\n  if (!existsSync(feedbackDir)) {\n    try {\n      mkdirSync(feedbackDir, { recursive: true });\n    } catch {\n      return;\n    }\n  }\n\n  const timestamp = new Date().toISOString();\n  const logEntry = `${timestamp} | ${sessionId} | ${sentiment} | ${context}\\n`;\n\n  try {\n    appendFileSync(logFile, logEntry);\n  } catch {\n    // Ignore logging errors\n  }\n}\n\n/**\n * Satisfaction detector hook\n */\nexport function satisfactionDetector(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionId = input.session_id || getSessionId();\n\n  // Get sample rate from environment (default: 3)\n  const sampleRate = parseInt(process.env.SATISFACTION_SAMPLE_RATE || '3', 10);\n\n  // Get and increment counter for sampling\n  const counter = getAndIncrementCounter(projectDir);\n\n  // Skip if not on sampling interval (for performance)\n  if (sampleRate > 1 && counter % sampleRate !== 0) {\n    return outputSilentSuccess();\n  }\n\n  logHook('satisfaction-detector', `Satisfaction detector hook starting (sample ${counter})`);\n\n  // Skip empty prompts\n  if (!prompt) {\n    return outputSilentSuccess();\n  }\n\n  // Skip very short prompts (likely commands)\n  if (prompt.length < MIN_PROMPT_LENGTH) {\n    return outputSilentSuccess();\n  }\n\n  // Skip prompts that look like commands (start with /)\n  if (prompt.startsWith('/')) {\n    return outputSilentSuccess();\n  }\n\n  // Detect satisfaction\n  const sentiment = detectSatisfaction(prompt);\n\n  // Only log non-neutral signals to avoid noise\n  if (sentiment !== 'neutral') {\n    // Truncate context for logging\n    let context = prompt.slice(0, 50);\n    if (prompt.length > 50) {\n      context += '...';\n    }\n\n    // Log the satisfaction signal\n    logSatisfaction(sessionId, sentiment, context, projectDir);\n\n    logHook('satisfaction-detector', `Detected ${sentiment} satisfaction signal`);\n  }\n\n  // Output CC 2.1.7 compliant JSON (silent success)\n  return outputSilentSuccess();\n}\n", "/**\n * Skill Auto-Suggest - UserPromptSubmit Hook\n * Proactive skill suggestion based on prompt analysis\n * Issue #123: Skill Auto-Suggest Hook\n *\n * Analyzes user prompts for task keywords and suggests relevant skills\n * from the skills/ directory via CC 2.1.9 additionalContext injection.\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext for suggestions\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputPromptContext, logHook, getPluginRoot } from '../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n// Maximum number of skills to suggest\nconst MAX_SUGGESTIONS = 3;\n\n// Minimum confidence score (0-100) to include a skill\nconst MIN_CONFIDENCE = 30;\n\n// Keyword-to-Skill mapping\n// Format: [keyword, skillName, confidenceBoost]\nconst KEYWORD_MAPPINGS: Array<[string, string, number]> = [\n  // API & Backend\n  ['api', 'api-design-framework', 80],\n  ['endpoint', 'api-design-framework', 70],\n  ['rest', 'api-design-framework', 75],\n  ['graphql', 'api-design-framework', 75],\n  ['route', 'api-design-framework', 60],\n  ['fastapi', 'fastapi-advanced', 90],\n  ['uvicorn', 'fastapi-advanced', 70],\n  ['starlette', 'fastapi-advanced', 60],\n  ['middleware', 'fastapi-advanced', 50],\n  ['pydantic', 'fastapi-advanced', 60],\n\n  // Database\n  ['database', 'database-schema-designer', 80],\n  ['schema', 'database-schema-designer', 70],\n  ['table', 'database-schema-designer', 50],\n  ['migration', 'alembic-migrations', 85],\n  ['alembic', 'alembic-migrations', 95],\n  ['sql', 'database-schema-designer', 60],\n  ['postgres', 'database-schema-designer', 70],\n  ['query', 'database-schema-designer', 40],\n  ['index', 'database-schema-designer', 50],\n  ['sqlalchemy', 'sqlalchemy-2-async', 85],\n  ['async.*database', 'sqlalchemy-2-async', 80],\n  ['orm', 'sqlalchemy-2-async', 60],\n  ['connection.*pool', 'connection-pooling', 90],\n  ['pool', 'connection-pooling', 60],\n  ['pgvector', 'pgvector-search', 95],\n  ['vector.*search', 'pgvector-search', 85],\n  ['embedding', 'embeddings', 80],\n\n  // Authentication & Security\n  ['auth', 'auth-patterns', 85],\n  ['login', 'auth-patterns', 75],\n  ['jwt', 'auth-patterns', 80],\n  ['oauth', 'auth-patterns', 85],\n  ['passkey', 'auth-patterns', 90],\n  ['webauthn', 'auth-patterns', 90],\n  ['session', 'auth-patterns', 60],\n  ['password', 'auth-patterns', 70],\n  ['security', 'owasp-top-10', 75],\n  ['owasp', 'owasp-top-10', 95],\n  ['xss', 'owasp-top-10', 80],\n  ['injection', 'owasp-top-10', 80],\n  ['csrf', 'owasp-top-10', 80],\n  ['validation', 'input-validation', 70],\n  ['sanitiz', 'input-validation', 80],\n  ['defense.*depth', 'defense-in-depth', 95],\n\n  // Testing\n  ['test', 'integration-testing', 60],\n  ['unit.*test', 'pytest-advanced', 80],\n  ['pytest', 'pytest-advanced', 90],\n  ['integration.*test', 'integration-testing', 85],\n  ['e2e', 'e2e-testing', 90],\n  ['playwright', 'e2e-testing', 80],\n  ['mock', 'msw-mocking', 75],\n  ['msw', 'msw-mocking', 95],\n  ['fixture', 'test-data-management', 80],\n  ['test.*data', 'test-data-management', 85],\n  ['coverage', 'pytest-advanced', 60],\n  ['property.*test', 'property-based-testing', 90],\n  ['hypothesis', 'property-based-testing', 95],\n  ['contract.*test', 'contract-testing', 95],\n  ['pact', 'contract-testing', 95],\n  ['golden.*dataset', 'golden-dataset-validation', 90],\n  ['performance.*test', 'performance-testing', 90],\n  ['load.*test', 'performance-testing', 85],\n  ['k6', 'performance-testing', 95],\n  ['locust', 'performance-testing', 95],\n\n  // Frontend & React\n  ['react', 'react-server-components-framework', 70],\n  ['component', 'react-server-components-framework', 50],\n  ['server.*component', 'react-server-components-framework', 95],\n  ['nextjs', 'react-server-components-framework', 85],\n  ['next\\\\.js', 'react-server-components-framework', 85],\n  ['suspense', 'react-server-components-framework', 70],\n  ['streaming.*ssr', 'react-server-components-framework', 90],\n  ['form', 'form-state-patterns', 70],\n  ['react.*hook.*form', 'form-state-patterns', 95],\n  ['zod', 'form-state-patterns', 60],\n  ['zustand', 'zustand-patterns', 95],\n  ['state.*management', 'zustand-patterns', 70],\n  ['tanstack', 'tanstack-query-advanced', 90],\n  ['react.*query', 'tanstack-query-advanced', 85],\n  ['radix', 'radix-primitives', 95],\n  ['shadcn', 'radix-primitives', 80],\n  ['tailwind', 'design-system-starter', 60],\n  ['design.*system', 'design-system-starter', 85],\n  ['animation', 'motion-animation-patterns', 80],\n  ['framer', 'motion-animation-patterns', 90],\n  ['core.*web.*vital', 'core-web-vitals', 95],\n  ['lcp', 'core-web-vitals', 80],\n  ['cls', 'core-web-vitals', 80],\n  ['inp', 'core-web-vitals', 80],\n  ['i18n', 'i18n-date-patterns', 90],\n  ['internationalization', 'i18n-date-patterns', 95],\n  ['locale', 'i18n-date-patterns', 70],\n\n  // Accessibility\n  ['accessibility', 'a11y-testing', 85],\n  ['a11y', 'a11y-testing', 95],\n  ['wcag', 'a11y-testing', 95],\n  ['screen.*reader', 'focus-management', 80],\n  ['keyboard.*nav', 'focus-management', 90],\n  ['focus', 'focus-management', 60],\n  ['aria', 'focus-management', 70],\n\n  // AI/LLM\n  ['llm', 'function-calling', 70],\n  ['openai', 'function-calling', 60],\n  ['anthropic', 'function-calling', 60],\n  ['function.*call', 'function-calling', 90],\n  ['tool.*use', 'function-calling', 85],\n  ['stream', 'llm-streaming', 70],\n  ['rag', 'rag-retrieval', 95],\n  ['retrieval', 'rag-retrieval', 75],\n  ['context', 'contextual-retrieval', 60],\n  ['chunk', 'embeddings', 70],\n  ['vector', 'embeddings', 75],\n  ['semantic.*search', 'embeddings', 85],\n  ['langfuse', 'langfuse-observability', 95],\n  ['llm.*observ', 'langfuse-observability', 90],\n  ['langgraph', 'langgraph-state', 85],\n  ['agent', 'agent-loops', 70],\n  ['workflow', 'langgraph-state', 60],\n  ['supervisor', 'langgraph-supervisor', 90],\n  ['human.*in.*loop', 'langgraph-human-in-loop', 95],\n  ['checkpoint', 'langgraph-checkpoints', 90],\n  ['prompt.*cache', 'prompt-caching', 95],\n  ['cache.*llm', 'semantic-caching', 85],\n  ['eval', 'llm-evaluation', 70],\n  ['llm.*test', 'llm-testing', 85],\n  ['ollama', 'ollama-local', 95],\n\n  // DevOps & Infrastructure\n  ['deploy', 'devops-deployment', 75],\n  ['ci', 'devops-deployment', 60],\n  ['cd', 'devops-deployment', 60],\n  ['github.*action', 'github-operations', 85],\n  ['release', 'release-management', 80],\n  ['changelog', 'release-management', 70],\n  ['version', 'release-management', 50],\n  ['observ', 'observability-monitoring', 80],\n  ['monitor', 'observability-monitoring', 70],\n  ['log', 'observability-monitoring', 50],\n  ['metric', 'observability-monitoring', 60],\n  ['trace', 'observability-monitoring', 70],\n  ['alert', 'observability-monitoring', 60],\n\n  // Git & GitHub\n  ['git', 'git-workflow', 70],\n  ['branch', 'git-workflow', 60],\n  ['commit', 'commit', 80],\n  ['rebase', 'git-workflow', 70],\n  ['stacked.*pr', 'stacked-prs', 95],\n  ['pr', 'create-pr', 60],\n  ['pull.*request', 'create-pr', 75],\n  ['recovery', 'git-recovery-command', 80],\n  ['reflog', 'git-recovery-command', 95],\n  ['milestone', 'github-operations', 80],\n  ['issue', 'github-operations', 50],\n\n  // Event-Driven & Messaging\n  ['event.*sourc', 'event-sourcing', 95],\n  ['kafka', 'message-queues', 85],\n  ['rabbitmq', 'message-queues', 85],\n  ['queue', 'message-queues', 75],\n  ['pub.*sub', 'message-queues', 80],\n  ['outbox', 'outbox-pattern', 95],\n  ['saga', 'event-sourcing', 70],\n  ['cqrs', 'event-sourcing', 80],\n\n  // Async & Concurrency\n  ['async', 'asyncio-advanced', 70],\n  ['asyncio', 'asyncio-advanced', 90],\n  ['taskgroup', 'asyncio-advanced', 95],\n  ['concurrent', 'asyncio-advanced', 60],\n  ['background.*job', 'background-jobs', 90],\n  ['celery', 'background-jobs', 95],\n  ['worker', 'background-jobs', 60],\n  ['distributed.*lock', 'distributed-locks', 95],\n  ['redis.*lock', 'distributed-locks', 85],\n  ['idempoten', 'idempotency-patterns', 95],\n\n  // Architecture & Patterns\n  ['clean.*architecture', 'clean-architecture', 95],\n  ['ddd', 'domain-driven-design', 95],\n  ['domain.*driven', 'domain-driven-design', 90],\n  ['aggregate', 'aggregate-patterns', 90],\n  ['adr', 'architecture-decision-record', 95],\n  ['decision.*record', 'architecture-decision-record', 85],\n\n  // Code Quality\n  ['lint', 'biome-linting', 70],\n  ['biome', 'biome-linting', 95],\n  ['eslint', 'biome-linting', 60],\n  ['format', 'biome-linting', 50],\n  ['code.*review', 'code-review-playbook', 90],\n  ['review', 'code-review-playbook', 60],\n  ['quality.*gate', 'quality-gates', 90],\n\n  // Error Handling\n  ['error.*handl', 'error-handling-rfc9457', 85],\n  ['rfc.*9457', 'error-handling-rfc9457', 95],\n  ['problem.*detail', 'error-handling-rfc9457', 90],\n];\n\ninterface SkillMatch {\n  skill: string;\n  confidence: number;\n}\n\n/**\n * Find matching skills based on prompt keywords\n */\nfunction findMatchingSkills(prompt: string): SkillMatch[] {\n  const promptLower = prompt.toLowerCase();\n  const skillScores = new Map<string, number>();\n\n  for (const [keyword, skill, confidence] of KEYWORD_MAPPINGS) {\n    // Convert keyword to regex pattern\n    const regex = new RegExp(keyword, 'i');\n\n    if (regex.test(promptLower)) {\n      const currentScore = skillScores.get(skill) || 0;\n      if (confidence > currentScore) {\n        skillScores.set(skill, confidence);\n      }\n    }\n  }\n\n  // Convert to array and sort by confidence\n  const matches: SkillMatch[] = Array.from(skillScores.entries())\n    .map(([skill, confidence]) => ({ skill, confidence }))\n    .sort((a, b) => b.confidence - a.confidence)\n    .slice(0, MAX_SUGGESTIONS);\n\n  return matches;\n}\n\n/**\n * Get skill description from SKILL.md frontmatter\n */\nfunction getSkillDescription(skillName: string, skillsDir: string): string {\n  const skillFile = join(skillsDir, skillName, 'SKILL.md');\n\n  if (!existsSync(skillFile)) {\n    return '';\n  }\n\n  try {\n    const content = readFileSync(skillFile, 'utf8');\n\n    // Extract description from YAML frontmatter\n    const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n    if (frontmatterMatch) {\n      const frontmatter = frontmatterMatch[1];\n      const descriptionMatch = frontmatter.match(/^description:\\s*(.+)$/m);\n      if (descriptionMatch) {\n        return descriptionMatch[1].trim();\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  return '';\n}\n\n/**\n * Build suggestion message for Claude\n */\nfunction buildSuggestionMessage(matches: SkillMatch[], skillsDir: string): string {\n  if (matches.length === 0) {\n    return '';\n  }\n\n  let message = `## Relevant Skills Detected\n\nBased on your prompt, the following skills may be helpful:\n\n`;\n\n  for (const { skill, confidence } of matches) {\n    if (confidence >= MIN_CONFIDENCE) {\n      const description = getSkillDescription(skill, skillsDir);\n      if (description) {\n        message += `- **${skill}** (${confidence}% match): ${description}\\n`;\n      } else {\n        message += `- **${skill}** (${confidence}% match)\\n`;\n      }\n    }\n  }\n\n  message += `\nUse \\`/ork:<skill-name>\\` to invoke a user-invocable skill, or read the skill with \\`Read skills/<skill-name>/SKILL.md\\` for patterns and guidance.`;\n\n  return message;\n}\n\n/**\n * Skill auto-suggest hook\n */\nexport function skillAutoSuggest(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n  const pluginRoot = getPluginRoot();\n  const skillsDir = join(pluginRoot, 'skills');\n\n  if (!prompt) {\n    return outputSilentSuccess();\n  }\n\n  logHook('skill-auto-suggest', 'Analyzing prompt for skill suggestions...');\n\n  // Find matching skills\n  const matches = findMatchingSkills(prompt);\n\n  if (matches.length === 0) {\n    logHook('skill-auto-suggest', 'No skill matches found');\n    return outputSilentSuccess();\n  }\n\n  logHook(\n    'skill-auto-suggest',\n    `Found matches: ${matches.map((m) => `${m.skill}:${m.confidence}`).join(', ')}`\n  );\n\n  // Build suggestion message\n  const suggestionMessage = buildSuggestionMessage(matches, skillsDir);\n\n  if (suggestionMessage) {\n    logHook('skill-auto-suggest', 'Injecting skill suggestions via additionalContext');\n    return outputPromptContext(suggestionMessage);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Todo Enforcer - UserPromptSubmit Hook\n * Reminds about todo tracking for complex tasks\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\n\n// Complex task indicators (regex patterns)\nconst COMPLEX_PATTERNS = [\n  /implement/i,\n  /refactor/i,\n  /add feature/i,\n  /create.*component/i,\n  /build.*system/i,\n  /fix.*multiple/i,\n  /update.*across/i,\n  /migrate/i,\n];\n\n// Threshold for long prompts (often indicate complex tasks)\nconst LONG_PROMPT_THRESHOLD = 500;\n\n/**\n * Todo enforcer hook - detects complex tasks\n */\nexport function todoEnforcer(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n  const promptLength = prompt.length;\n\n  logHook('todo-enforcer', `Prompt length: ${promptLength} chars`);\n\n  let isComplex = false;\n\n  // Check for complex task patterns\n  for (const pattern of COMPLEX_PATTERNS) {\n    if (pattern.test(prompt)) {\n      isComplex = true;\n      break;\n    }\n  }\n\n  // Long prompts often indicate complex tasks\n  if (promptLength > LONG_PROMPT_THRESHOLD) {\n    isComplex = true;\n  }\n\n  if (isComplex) {\n    logHook('todo-enforcer', 'Complex task detected - todo tracking recommended');\n  }\n\n  // Output systemMessage for user visibility\n  // Currently outputs silent success - could be enhanced to inject context\n  return outputSilentSuccess();\n}\n", "/**\n * Agent Auto-Suggest - UserPromptSubmit Hook\n * Proactive agent dispatch suggestion based on prompt analysis\n * Issue #197: Agent Orchestration Layer\n *\n * NOW USES: Intent Classifier for hybrid semantic+keyword scoring\n * Target: 85%+ accuracy vs ~60% regex baseline\n *\n * This is the LEGACY hook maintained for backward compatibility.\n * The new agent-orchestrator.ts provides full orchestration with\n * task integration. This hook provides simple suggestions only.\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputPromptContext, logHook } from '../lib/common.js';\nimport { classifyIntent, shouldClassify } from '../lib/intent-classifier.js';\nimport { getAdjustments } from '../lib/calibration-engine.js';\nimport { getPromptHistory, loadConfig } from '../lib/orchestration-state.js';\nimport type { AgentMatch } from '../lib/orchestration-types.js';\nimport { THRESHOLDS } from '../lib/orchestration-types.js';\n\n// Maximum number of agents to suggest\nconst MAX_SUGGESTIONS = 2;\n\n/**\n * Build suggestion message based on confidence level\n * (Backward compatible message format)\n */\nfunction buildSuggestionMessage(matches: AgentMatch[]): string {\n  if (matches.length === 0) return '';\n\n  const topMatch = matches[0];\n  let message = '';\n\n  if (topMatch.confidence >= THRESHOLDS.AUTO_DISPATCH) {\n    // HIGH CONFIDENCE - Strong directive\n    message = `## \uD83C\uDFAF AGENT DISPATCH RECOMMENDED\n\n**Agent:** \\`${topMatch.agent}\\` (${topMatch.confidence}% confidence)\n\nThis task strongly matches the agent's specialization. **Spawn this agent:**\n\n\\`\\`\\`\nTask tool with subagent_type: \"${topMatch.agent}\"\n\\`\\`\\`\n\nMatched: ${topMatch.matchedKeywords.slice(0, 5).join(', ')}`;\n\n  } else if (topMatch.confidence >= THRESHOLDS.STRONG_RECOMMEND) {\n    // MEDIUM-HIGH - Recommendation\n    message = `## Agent Recommendation\n\n**RECOMMENDED:** \\`${topMatch.agent}\\` (${topMatch.confidence}% match)\n${topMatch.description}\n\nMatched keywords: ${topMatch.matchedKeywords.slice(0, 4).join(', ')}\n\nConsider spawning with: \\`Task tool, subagent_type: \"${topMatch.agent}\"\\``;\n\n  } else if (topMatch.confidence >= THRESHOLDS.SUGGEST) {\n    // MEDIUM - Suggestion\n    message = `## Agent Suggestion\n\n**Consider:** \\`${topMatch.agent}\\` (${topMatch.confidence}% match)\n\nThis agent specializes in: ${topMatch.matchedKeywords.slice(0, 3).join(', ')}`;\n  }\n\n  // Add second match if exists and significant\n  if (matches.length > 1 && matches[1].confidence >= THRESHOLDS.SUGGEST) {\n    const second = matches[1];\n    message += `\\n\\n**Alternative:** \\`${second.agent}\\` (${second.confidence}% match)`;\n  }\n\n  return message;\n}\n\n/**\n * Agent auto-suggest hook\n *\n * Uses the new intent classifier for improved accuracy:\n * - Hybrid keyword + phrase + context scoring\n * - Calibration adjustments from outcome learning\n * - Negation detection to reduce false positives\n */\nexport function agentAutoSuggest(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n\n  // Quick filter using classifier's shouldClassify\n  if (!shouldClassify(prompt)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip if agent-orchestrator is enabled (let it handle classification)\n  const config = loadConfig();\n  if (config.enableAutoDispatch) {\n    // agent-orchestrator.ts will handle this\n    logHook('agent-auto-suggest', 'Deferring to agent-orchestrator (auto-dispatch enabled)');\n    return outputSilentSuccess();\n  }\n\n  logHook('agent-auto-suggest', 'Analyzing prompt with intent classifier...');\n\n  // Get context for classification\n  const history = getPromptHistory();\n  const adjustments = getAdjustments();\n\n  // Run classification\n  const result = classifyIntent(prompt, history, adjustments);\n\n  // Filter to top suggestions\n  const matches = result.agents.slice(0, MAX_SUGGESTIONS);\n\n  if (matches.length === 0) {\n    logHook('agent-auto-suggest', 'No agent matches found');\n    return outputSilentSuccess();\n  }\n\n  logHook(\n    'agent-auto-suggest',\n    `Found matches: ${matches.map(m => `${m.agent}:${m.confidence}`).join(', ')}`\n  );\n\n  // Build suggestion message (backward compatible format)\n  const suggestionMessage = buildSuggestionMessage(matches);\n\n  if (suggestionMessage) {\n    logHook('agent-auto-suggest', `Suggesting ${matches[0].agent} at ${matches[0].confidence}%`);\n    return outputPromptContext(suggestionMessage);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Agent Orchestrator - Main UserPromptSubmit Hook for Auto-Dispatch\n * Issue #197: Agent Orchestration Layer with CC 2.1.16 Task Integration\n *\n * At confidence >= 85%: AUTO-DISPATCH directive\n * At confidence 70-84%: Strong recommendation\n * At confidence 50-69%: Suggestion\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext\n * CC 2.1.16 Compliant: Outputs TaskCreate instructions for task management\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputPromptContext, logHook } from '../lib/common.js';\nimport { classifyIntent, shouldClassify } from '../lib/intent-classifier.js';\nimport {\n  loadConfig,\n  addToPromptHistory,\n  cacheClassification,\n  isAgentDispatched,\n  trackDispatchedAgent,\n  getPromptHistory,\n} from '../lib/orchestration-state.js';\nimport type {\n  ClassificationResult,\n  AgentMatch,\n  TaskMetadata,\n} from '../lib/orchestration-types.js';\nimport { THRESHOLDS } from '../lib/orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// Message Builders\n// -----------------------------------------------------------------------------\n\n/**\n * Build auto-dispatch directive message (conf >= 85%)\n */\nfunction buildAutoDispatchMessage(match: AgentMatch, taskMeta: TaskMetadata): string {\n  return `## \uD83C\uDFAF AUTO-DISPATCH: ${match.agent}\n\n**Confidence:** ${match.confidence}% (auto-dispatch threshold: ${THRESHOLDS.AUTO_DISPATCH}%)\n\nThis task strongly matches the agent's specialization. **IMMEDIATELY spawn this agent:**\n\n\\`\\`\\`\nTask tool with subagent_type: \"${match.agent}\"\n\\`\\`\\`\n\n**Matched Keywords:** ${match.matchedKeywords.slice(0, 5).join(', ')}\n\n### CC 2.1.16 Task Instruction\nBefore spawning, create a task to track this work:\n\n\\`\\`\\`json\nTaskCreate:\n{\n  \"subject\": \"${match.agent.replace(/-/g, ' ')} implementation\",\n  \"description\": \"Agent dispatched automatically at ${match.confidence}% confidence\",\n  \"activeForm\": \"Working on ${match.description.toLowerCase()}\",\n  \"metadata\": ${JSON.stringify(taskMeta)}\n}\n\\`\\`\\`\n\nAfter creating the task, spawn the agent with the task ID in the prompt.`;\n}\n\n/**\n * Build strong recommendation message (conf 70-84%)\n */\nfunction buildStrongRecommendMessage(match: AgentMatch): string {\n  return `## Agent Recommendation\n\n**RECOMMENDED:** \\`${match.agent}\\` (${match.confidence}% confidence)\n\n${match.description}\n\n**Matched:** ${match.matchedKeywords.slice(0, 4).join(', ')}\n\n**Spawn with:**\n\\`\\`\\`\nTask tool with subagent_type: \"${match.agent}\"\n\\`\\`\\``;\n}\n\n/**\n * Build suggestion message (conf 50-69%)\n */\nfunction buildSuggestionMessage(match: AgentMatch): string {\n  return `## Agent Suggestion\n\n**Consider:** \\`${match.agent}\\` (${match.confidence}% match)\n\nThis agent specializes in: ${match.matchedKeywords.slice(0, 3).join(', ')}`;\n}\n\n/**\n * Build alternative agent note\n */\nfunction buildAlternativeNote(match: AgentMatch): string {\n  return `\\n\\n**Alternative:** \\`${match.agent}\\` (${match.confidence}% match)`;\n}\n\n/**\n * Build the complete orchestration message\n */\nfunction buildOrchestrationMessage(\n  result: ClassificationResult,\n  config: ReturnType<typeof loadConfig>\n): string {\n  if (result.agents.length === 0) {\n    return '';\n  }\n\n  const topMatch = result.agents[0];\n  let message = '';\n\n  // Check if already dispatched\n  if (isAgentDispatched(topMatch.agent)) {\n    logHook('agent-orchestrator', `Agent ${topMatch.agent} already dispatched, skipping`);\n    return '';\n  }\n\n  // Auto-dispatch at high confidence\n  if (\n    config.enableAutoDispatch &&\n    topMatch.confidence >= THRESHOLDS.AUTO_DISPATCH\n  ) {\n    const taskMeta: TaskMetadata = {\n      source: 'orchestration',\n      dispatchedAgent: topMatch.agent,\n      dispatchConfidence: topMatch.confidence,\n      relatedSkills: result.skills.slice(0, 3).map(s => s.skill),\n      dispatchSignals: topMatch.signals.slice(0, 5),\n    };\n\n    // Track the dispatch\n    trackDispatchedAgent(topMatch.agent, topMatch.confidence);\n\n    message = buildAutoDispatchMessage(topMatch, taskMeta);\n\n  } else if (topMatch.confidence >= THRESHOLDS.STRONG_RECOMMEND) {\n    // Strong recommendation\n    message = buildStrongRecommendMessage(topMatch);\n\n  } else if (topMatch.confidence >= THRESHOLDS.SUGGEST) {\n    // Suggestion\n    message = buildSuggestionMessage(topMatch);\n  }\n\n  // Add alternative if significant\n  if (\n    result.agents.length > 1 &&\n    result.agents[1].confidence >= THRESHOLDS.SUGGEST\n  ) {\n    message += buildAlternativeNote(result.agents[1]);\n  }\n\n  return message;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Agent orchestrator hook - main entry point\n *\n * Analyzes user prompts and either:\n * 1. Auto-dispatches agents at 85%+ confidence\n * 2. Strongly recommends agents at 70-84%\n * 3. Suggests agents at 50-69%\n *\n * Also integrates with CC 2.1.16 task management.\n */\nexport function agentOrchestrator(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n\n  // Quick filter\n  if (!shouldClassify(prompt)) {\n    return outputSilentSuccess();\n  }\n\n  logHook('agent-orchestrator', 'Classifying intent for orchestration...');\n\n  // Load config and state\n  const config = loadConfig();\n  const history = getPromptHistory();\n\n  // Run classification\n  const result = classifyIntent(prompt, history);\n\n  // Cache classification for later use\n  cacheClassification(result);\n\n  // Add to prompt history\n  addToPromptHistory(prompt.slice(0, 500)); // Truncate for storage\n\n  // Log classification\n  logHook(\n    'agent-orchestrator',\n    `Classification: intent=${result.intent}, ` +\n    `agents=[${result.agents.map(a => `${a.agent}:${a.confidence}`).join(', ')}], ` +\n    `autoDispatch=${result.shouldAutoDispatch}`\n  );\n\n  // No matches\n  if (result.agents.length === 0) {\n    logHook('agent-orchestrator', 'No agent matches found');\n    return outputSilentSuccess();\n  }\n\n  // Build orchestration message\n  const message = buildOrchestrationMessage(result, config);\n\n  if (message) {\n    return outputPromptContext(message);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Skill Injector - UserPromptSubmit Hook for Auto-Injecting Skill Content\n * Issue #197: Agent Orchestration Layer\n *\n * At confidence >= 80%: Auto-injects skill SKILL.md content\n * Maximum 800 tokens per skill injection to respect context budget\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputPromptContext, logHook, getPluginRoot } from '../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport {\n  loadConfig,\n  isSkillInjected,\n  trackInjectedSkill,\n  getLastClassification,\n} from '../lib/orchestration-state.js';\nimport { classifyIntent, shouldClassify } from '../lib/intent-classifier.js';\nimport { THRESHOLDS } from '../lib/orchestration-types.js';\nimport type { ClassificationResult } from '../lib/orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\n/** Maximum tokens for skill content injection */\nconst MAX_INJECTION_TOKENS = 800;\n\n/** Approximate characters per token */\nconst CHARS_PER_TOKEN = 4;\n\n/** Maximum skills to inject per prompt */\nconst MAX_SKILLS_PER_PROMPT = 2;\n\n// -----------------------------------------------------------------------------\n// Skill Content Loading\n// -----------------------------------------------------------------------------\n\n/**\n * Load skill content from SKILL.md\n * Returns truncated content to fit within token budget\n */\nfunction loadSkillContent(skillName: string, maxTokens: number): string | null {\n  const pluginRoot = getPluginRoot();\n  const skillFile = join(pluginRoot, 'skills', skillName, 'SKILL.md');\n\n  if (!existsSync(skillFile)) {\n    logHook('skill-injector', `Skill file not found: ${skillFile}`);\n    return null;\n  }\n\n  try {\n    let content = readFileSync(skillFile, 'utf8');\n\n    // Remove frontmatter\n    const frontmatterMatch = content.match(/^---\\n[\\s\\S]*?\\n---\\n/);\n    if (frontmatterMatch) {\n      content = content.slice(frontmatterMatch[0].length);\n    }\n\n    // Trim whitespace\n    content = content.trim();\n\n    // Truncate to token budget\n    const maxChars = maxTokens * CHARS_PER_TOKEN;\n    if (content.length > maxChars) {\n      // Try to break at a paragraph\n      const truncated = content.slice(0, maxChars);\n      const lastParagraph = truncated.lastIndexOf('\\n\\n');\n      if (lastParagraph > maxChars * 0.6) {\n        content = truncated.slice(0, lastParagraph) + '\\n\\n[... truncated for context budget]';\n      } else {\n        content = truncated + '\\n\\n[... truncated for context budget]';\n      }\n    }\n\n    return content;\n  } catch (err) {\n    logHook('skill-injector', `Failed to load skill: ${err}`);\n    return null;\n  }\n}\n\n/**\n * Calculate token estimate for content\n */\nfunction estimateTokens(content: string): number {\n  return Math.ceil(content.length / CHARS_PER_TOKEN);\n}\n\n// -----------------------------------------------------------------------------\n// Message Building\n// -----------------------------------------------------------------------------\n\n/**\n * Build injection message for skills\n */\nfunction buildInjectionMessage(skills: Array<{ skill: string; content: string }>): string {\n  if (skills.length === 0) return '';\n\n  let message = `## \uD83D\uDCDA Skill Knowledge Injected\n\nThe following skill patterns have been auto-loaded based on your prompt:\n\n`;\n\n  for (const { skill, content } of skills) {\n    message += `### ${skill}\n\n${content}\n\n---\n\n`;\n  }\n\n  message += `*Auto-injected by OrchestKit Agent Orchestration Layer*`;\n\n  return message;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Skill injector hook\n *\n * Automatically injects relevant skill content when:\n * 1. Skill match confidence >= 80%\n * 2. Skill not already injected in session\n * 3. Within token budget\n */\nexport function skillInjector(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n\n  // Quick filter\n  if (!shouldClassify(prompt)) {\n    return outputSilentSuccess();\n  }\n\n  // Load config\n  const config = loadConfig();\n\n  if (!config.enableSkillInjection) {\n    return outputSilentSuccess();\n  }\n\n  logHook('skill-injector', 'Checking for skill injection...');\n\n  // Try to use cached classification from agent-orchestrator\n  let result: ClassificationResult | undefined = getLastClassification();\n\n  // If no cached result, run classification\n  if (!result) {\n    result = classifyIntent(prompt);\n  }\n\n  // Filter skills above injection threshold\n  const eligibleSkills = result.skills.filter(\n    s => s.confidence >= THRESHOLDS.SKILL_INJECT && !isSkillInjected(s.skill)\n  );\n\n  if (eligibleSkills.length === 0) {\n    logHook('skill-injector', 'No eligible skills for injection');\n    return outputSilentSuccess();\n  }\n\n  // Calculate token budget per skill\n  const maxTotalTokens = config.maxSkillInjectionTokens || MAX_INJECTION_TOKENS;\n  const skillCount = Math.min(eligibleSkills.length, MAX_SKILLS_PER_PROMPT);\n  const tokensPerSkill = Math.floor(maxTotalTokens / skillCount);\n\n  // Load skill content\n  const loadedSkills: Array<{ skill: string; content: string }> = [];\n  let totalTokens = 0;\n\n  for (const match of eligibleSkills.slice(0, MAX_SKILLS_PER_PROMPT)) {\n    const remainingTokens = maxTotalTokens - totalTokens;\n    if (remainingTokens < 100) break; // Minimum useful content\n\n    const content = loadSkillContent(match.skill, Math.min(tokensPerSkill, remainingTokens));\n\n    if (content) {\n      const tokens = estimateTokens(content);\n      totalTokens += tokens;\n\n      loadedSkills.push({ skill: match.skill, content });\n      trackInjectedSkill(match.skill);\n\n      logHook('skill-injector', `Loaded skill ${match.skill} (~${tokens} tokens)`);\n    }\n  }\n\n  if (loadedSkills.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Build injection message\n  const message = buildInjectionMessage(loadedSkills);\n\n  logHook(\n    'skill-injector',\n    `Injecting ${loadedSkills.length} skills (~${totalTokens} tokens): ${loadedSkills.map(s => s.skill).join(', ')}`\n  );\n\n  return outputPromptContext(message);\n}\n", "/**\n * Pipeline Detector - UserPromptSubmit Hook for Multi-Agent Workflows\n * Issue #197: Agent Orchestration Layer\n *\n * Detects multi-agent pipeline triggers in prompts:\n * - Product thinking: \"should we build...\"\n * - Full-stack feature: \"build a full-stack feature...\"\n * - AI integration: \"add RAG/LLM...\"\n * - Security audit: \"security audit...\"\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputPromptContext, logHook } from '../lib/common.js';\nimport { loadConfig } from '../lib/orchestration-state.js';\nimport {\n  detectPipeline,\n  createPipelineExecution,\n  registerPipelineExecution,\n  formatPipelinePlan,\n} from '../lib/multi-agent-coordinator.js';\nimport { getActivePipeline } from '../lib/task-integration.js';\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\n/** Minimum prompt length to consider for pipeline detection */\nconst MIN_PROMPT_LENGTH = 15;\n\n/** Words that indicate this is NOT a pipeline request */\nconst EXCLUSION_WORDS = [\n  'what is',\n  'explain',\n  'how does',\n  'tell me about',\n  'describe',\n  'list',\n  'show me',\n];\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\n/**\n * Check if prompt is asking a question rather than requesting action\n */\nfunction isQuestionNotRequest(prompt: string): boolean {\n  const promptLower = prompt.toLowerCase();\n\n  for (const exclusion of EXCLUSION_WORDS) {\n    if (promptLower.startsWith(exclusion)) {\n      return true;\n    }\n  }\n\n  // Ends with question mark and is short\n  if (prompt.endsWith('?') && prompt.length < 100) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Check if user is already in a pipeline\n */\nfunction isInActivePipeline(): boolean {\n  const active = getActivePipeline();\n  return active !== undefined && active.status === 'running';\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Pipeline detector hook\n *\n * Detects multi-agent workflow patterns:\n * 1. Checks if prompt matches pipeline triggers\n * 2. Creates pipeline execution plan\n * 3. Outputs task creation instructions\n */\nexport function pipelineDetector(input: HookInput): HookResult {\n  const prompt = input.prompt || '';\n\n  // Quick filters\n  if (prompt.length < MIN_PROMPT_LENGTH) {\n    return outputSilentSuccess();\n  }\n\n  if (isQuestionNotRequest(prompt)) {\n    return outputSilentSuccess();\n  }\n\n  // Check config\n  const config = loadConfig();\n  if (!config.enablePipelines) {\n    return outputSilentSuccess();\n  }\n\n  // Check if already in pipeline\n  if (isInActivePipeline()) {\n    logHook('pipeline-detector', 'Already in active pipeline, skipping detection');\n    return outputSilentSuccess();\n  }\n\n  logHook('pipeline-detector', 'Checking for pipeline triggers...');\n\n  // Detect pipeline\n  const pipeline = detectPipeline(prompt);\n\n  if (!pipeline) {\n    logHook('pipeline-detector', 'No pipeline triggers detected');\n    return outputSilentSuccess();\n  }\n\n  logHook('pipeline-detector', `Detected pipeline: ${pipeline.type}`);\n\n  // Create pipeline execution\n  const { execution, tasks } = createPipelineExecution(pipeline);\n\n  // Register with tracking systems\n  registerPipelineExecution(execution, tasks);\n\n  // Format plan message\n  const message = formatPipelinePlan(pipeline, execution, tasks);\n\n  logHook(\n    'pipeline-detector',\n    `Created pipeline ${execution.pipelineId} with ${tasks.length} steps`\n  );\n\n  return outputPromptContext(message);\n}\n", "/**\n * Graph Memory Inject - SubagentStart Hook\n * CC 2.1.7 Compliant: outputs JSON with continue field\n *\n * Injects graph-based memory context before agent spawn.\n * Always runs - knowledge graph requires no configuration.\n *\n * Part of ork-memory-graph plugin.\n *\n * Version: 1.0.0 (split from agent-memory-inject.ts)\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\n\n// Agent type to domain mapping\nconst AGENT_DOMAINS: Record<string, string> = {\n  'database-engineer': 'database schema SQL PostgreSQL migration pgvector',\n  'backend-system-architect': 'API REST architecture backend FastAPI microservice',\n  'frontend-ui-developer': 'React frontend UI component TypeScript Tailwind',\n  'security-auditor': 'security OWASP vulnerability audit authentication',\n  'test-generator': 'testing unit integration coverage pytest MSW',\n  'workflow-architect': 'LangGraph workflow agent orchestration state',\n  'llm-integrator': 'LLM API OpenAI Anthropic embeddings RAG function-calling',\n  'data-pipeline-engineer': 'data pipeline embeddings vector ETL chunking',\n  'metrics-architect': 'metrics OKR KPI analytics instrumentation',\n  'ux-researcher': 'UX user research persona journey accessibility',\n  'code-quality-reviewer': 'code quality review linting type-check patterns',\n  'infrastructure-architect': 'infrastructure cloud Docker Kubernetes deployment',\n  'ci-cd-engineer': 'CI CD pipeline GitHub Actions deployment automation',\n  'accessibility-specialist': 'accessibility WCAG ARIA screen-reader a11y',\n  'product-strategist': 'product strategy roadmap features prioritization',\n};\n\nfunction getAgentDomain(agentType: string): string {\n  return AGENT_DOMAINS[agentType] || agentType;\n}\n\n/**\n * Graph memory inject - always runs, no configuration needed\n */\nexport function graphMemoryInject(input: HookInput): HookResult {\n  logHook('graph-memory-inject', 'Graph memory inject hook starting');\n\n  // Extract agent type from hook input\n  const toolInput = input.tool_input || {};\n  let agentType =\n    (toolInput.subagent_type as string) || (toolInput.type as string) || '';\n\n  // Fallback: try to extract from prompt\n  if (!agentType && toolInput.prompt) {\n    const prompt = (toolInput.prompt as string).toLowerCase();\n    const knownAgents = Object.keys(AGENT_DOMAINS);\n    for (const agent of knownAgents) {\n      if (prompt.includes(agent)) {\n        agentType = agent;\n        break;\n      }\n    }\n  }\n\n  if (!agentType) {\n    logHook('graph-memory-inject', 'No agent type detected, passing through');\n    return outputSilentSuccess();\n  }\n\n  const agentId = `ork:${agentType}`;\n  const domainKeywords = getAgentDomain(agentType);\n\n  logHook('graph-memory-inject', `Detected agent type: ${agentType} (agent_id: ${agentId})`);\n\n  // Build graph memory load instructions\n  const memoryLoadMsg = `[Graph Memory - Agent Context Load]\n\nExecute this MCP call to load graph context for ${agentType} agent:\n\n## Graph Memory Entities\n\\`\\`\\`\nmcp__memory__search_nodes\n{\"query\": \"${agentType} ${domainKeywords}\"}\n\\`\\`\\`\n\n## Integration Instructions\n1. Execute the graph search to retrieve relevant entities and relationships\n2. Review entities for patterns, decisions, and constraints\n3. Check relationships between concepts\n4. Apply learned patterns to current task\n\nAgent ID: ${agentId} | Domain: ${domainKeywords}`;\n\n  const systemMsg = `[Graph Memory] Agent: ${agentType} | ID: ${agentId} | Load graph context via MCP call above`;\n\n  logHook('graph-memory-inject', `Outputting graph memory instructions for ${agentType}`);\n\n  return {\n    continue: true,\n    systemMessage: systemMsg,\n    hookSpecificOutput: {\n      additionalContext: memoryLoadMsg,\n    },\n  };\n}\n", "/**\n * Mem0 Memory Inject - SubagentStart Hook\n * CC 2.1.7 Compliant: outputs JSON with continue field\n *\n * Injects mem0 cloud memory context before agent spawn.\n * Only runs when MEM0_API_KEY is configured.\n * Includes cross-agent federation for knowledge sharing.\n *\n * Part of ork-memory-mem0 plugin.\n *\n * Version: 1.0.0 (split from agent-memory-inject.ts)\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\n\n// Configuration\nconst MAX_MEMORIES = 5;\nconst MEM0_SCOPE_AGENTS = 'agents';\nconst MEM0_SCOPE_DECISIONS = 'decisions';\n\n// Agent type to domain mapping\nconst AGENT_DOMAINS: Record<string, string> = {\n  'database-engineer': 'database schema SQL PostgreSQL migration pgvector',\n  'backend-system-architect': 'API REST architecture backend FastAPI microservice',\n  'frontend-ui-developer': 'React frontend UI component TypeScript Tailwind',\n  'security-auditor': 'security OWASP vulnerability audit authentication',\n  'test-generator': 'testing unit integration coverage pytest MSW',\n  'workflow-architect': 'LangGraph workflow agent orchestration state',\n  'llm-integrator': 'LLM API OpenAI Anthropic embeddings RAG function-calling',\n  'data-pipeline-engineer': 'data pipeline embeddings vector ETL chunking',\n  'metrics-architect': 'metrics OKR KPI analytics instrumentation',\n  'ux-researcher': 'UX user research persona journey accessibility',\n  'code-quality-reviewer': 'code quality review linting type-check patterns',\n  'infrastructure-architect': 'infrastructure cloud Docker Kubernetes deployment',\n  'ci-cd-engineer': 'CI CD pipeline GitHub Actions deployment automation',\n  'accessibility-specialist': 'accessibility WCAG ARIA screen-reader a11y',\n  'product-strategist': 'product strategy roadmap features prioritization',\n};\n\n// Related agents for cross-agent knowledge sharing\nconst RELATED_AGENTS: Record<string, string[]> = {\n  'database-engineer': ['backend-system-architect', 'security-auditor', 'data-pipeline-engineer'],\n  'backend-system-architect': ['database-engineer', 'frontend-ui-developer', 'security-auditor', 'llm-integrator'],\n  'frontend-ui-developer': ['backend-system-architect', 'ux-researcher', 'accessibility-specialist', 'rapid-ui-designer'],\n  'security-auditor': ['backend-system-architect', 'database-engineer', 'infrastructure-architect'],\n  'test-generator': ['backend-system-architect', 'frontend-ui-developer', 'code-quality-reviewer'],\n  'workflow-architect': ['llm-integrator', 'backend-system-architect', 'data-pipeline-engineer'],\n  'llm-integrator': ['workflow-architect', 'data-pipeline-engineer', 'backend-system-architect'],\n  'data-pipeline-engineer': ['database-engineer', 'llm-integrator', 'workflow-architect'],\n};\n\nfunction getAgentDomain(agentType: string): string {\n  return AGENT_DOMAINS[agentType] || agentType;\n}\n\nfunction getRelatedAgents(agentType: string): string[] {\n  return RELATED_AGENTS[agentType] || [];\n}\n\nfunction getProjectId(): string {\n  const projectDir = getProjectDir();\n  const projectName = projectDir.split('/').pop() || 'default-project';\n  return projectName\n    .toLowerCase()\n    .replace(/ /g, '-')\n    .replace(/[^a-z0-9-]/g, '-')\n    .replace(/^-+|-+$/g, '')\n    .replace(/-+/g, '-');\n}\n\nfunction mem0UserId(scope: string): string {\n  return `${getProjectId()}-${scope}`;\n}\n\nfunction mem0GlobalUserId(scope: string): string {\n  return `orchestkit-global-${scope}`;\n}\n\n/**\n * Mem0 memory inject - only runs when MEM0_API_KEY is configured\n */\nexport function mem0MemoryInject(input: HookInput): HookResult {\n  logHook('mem0-memory-inject', 'Mem0 memory inject hook starting');\n\n  // Gate: Skip if mem0 is not configured\n  if (!process.env.MEM0_API_KEY) {\n    logHook('mem0-memory-inject', 'Mem0 not configured (no MEM0_API_KEY), skipping');\n    return outputSilentSuccess();\n  }\n\n  // Extract agent type from hook input\n  const toolInput = input.tool_input || {};\n  let agentType =\n    (toolInput.subagent_type as string) || (toolInput.type as string) || '';\n\n  // Fallback: try to extract from prompt\n  if (!agentType && toolInput.prompt) {\n    const prompt = (toolInput.prompt as string).toLowerCase();\n    const knownAgents = Object.keys(AGENT_DOMAINS);\n    for (const agent of knownAgents) {\n      if (prompt.includes(agent)) {\n        agentType = agent;\n        break;\n      }\n    }\n  }\n\n  if (!agentType) {\n    logHook('mem0-memory-inject', 'No agent type detected, passing through');\n    return outputSilentSuccess();\n  }\n\n  const agentId = `ork:${agentType}`;\n  const projectId = getProjectId();\n  const agentUserId = mem0UserId(MEM0_SCOPE_AGENTS);\n  const decisionsUserId = mem0UserId(MEM0_SCOPE_DECISIONS);\n  const globalUserId = mem0GlobalUserId('best-practices');\n  const domainKeywords = getAgentDomain(agentType);\n  const searchQuery = `${agentType} patterns decisions ${domainKeywords}`;\n\n  logHook('mem0-memory-inject', `Detected agent type: ${agentType} (agent_id: ${agentId})`);\n\n  // Get related agents\n  const relatedAgents = getRelatedAgents(agentType);\n\n  // Build mem0 search JSONs\n  const mem0AgentQuery = JSON.stringify({\n    query: searchQuery,\n    filters: {\n      AND: [{ user_id: agentUserId }, { agent_id: agentId }],\n    },\n    limit: MAX_MEMORIES,\n    enable_graph: true,\n  });\n\n  const mem0DecisionsQuery = JSON.stringify({\n    query: `${domainKeywords} decisions`,\n    filters: {\n      AND: [{ user_id: decisionsUserId }],\n    },\n    limit: MAX_MEMORIES,\n    enable_graph: true,\n  });\n\n  const mem0GlobalQuery = JSON.stringify({\n    query: `${domainKeywords} best practices`,\n    filters: {\n      AND: [{ user_id: globalUserId }],\n    },\n    limit: MAX_MEMORIES,\n    enable_graph: true,\n  });\n\n  // Build memory load instructions\n  let memoryLoadMsg = `[Mem0 Cloud - Agent Context Load]\n\nExecute these MCP calls to load mem0 context for ${agentType} agent:\n\n## 1. Agent-Specific Patterns (mem0)\n\\`\\`\\`\nmcp__mem0__search_memories\n${mem0AgentQuery}\n\\`\\`\\`\n\n## 2. Project Decisions (mem0)\n\\`\\`\\`\nmcp__mem0__search_memories\n${mem0DecisionsQuery}\n\\`\\`\\`\n\n## 3. Cross-Project Best Practices (mem0)\n\\`\\`\\`\nmcp__mem0__search_memories\n${mem0GlobalQuery}\n\\`\\`\\``;\n\n  // Add cross-agent section if related agents exist\n  if (relatedAgents.length > 0) {\n    const relatedAgentsStr = relatedAgents.join(', ');\n    const agentFilters = [\n      { agent_id: agentId },\n      ...relatedAgents.map((a) => ({ agent_id: `ork:${a}` })),\n    ];\n    const crossAgentQuery = JSON.stringify({\n      query: domainKeywords,\n      filters: {\n        AND: [{ user_id: agentUserId }, { OR: agentFilters }],\n      },\n      limit: MAX_MEMORIES,\n      enable_graph: true,\n    });\n\n    memoryLoadMsg += `\n\n## 4. Cross-Agent Knowledge (from: ${relatedAgentsStr})\n\\`\\`\\`\nmcp__mem0__search_memories\n${crossAgentQuery}\n\\`\\`\\``;\n  }\n\n  const relatedStr = relatedAgents.length > 0 ? relatedAgents.join(', ') : 'none';\n  memoryLoadMsg += `\n\n## Integration Instructions\n1. Execute the above MCP calls to retrieve mem0 context\n2. Review memories for patterns, decisions, and constraints\n3. Apply learned patterns to current task\n4. Avoid known anti-patterns (outcome: failed)\n\nAgent ID: ${agentId} | Domain: ${domainKeywords} | Related: ${relatedStr}`;\n\n  const systemMsg = `[Mem0 Cloud] Agent: ${agentType} | ID: ${agentId} | Load mem0 context via MCP calls above | Related: ${relatedStr}`;\n\n  logHook('mem0-memory-inject', `Outputting mem0 memory instructions for ${agentType}`);\n\n  return {\n    continue: true,\n    systemMessage: systemMsg,\n    hookSpecificOutput: {\n      additionalContext: memoryLoadMsg,\n    },\n  };\n}\n", "/**\n * Context Gate - SubagentStart Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * Prevents context overflow by limiting concurrent background agents.\n *\n * Strategy:\n * - Track active background agents in session\n * - Block new background spawns when limit exceeded\n * - Force sequential execution for expensive operations\n * - Suggest context compression when approaching limits\n *\n * Version: 1.0.0 (TypeScript port)\n * Part of Context Engineering 2.0\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny, outputWarning, logHook, getProjectDir } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst MAX_CONCURRENT_BACKGROUND = 4;\nconst MAX_AGENTS_PER_RESPONSE = 6;\nconst WARNING_THRESHOLD = 3;\nconst EXPENSIVE_TYPES = /^(test-generator|backend-system-architect|workflow-architect|security-auditor|llm-integrator)$/;\n\n// State file paths\nfunction getStateFile(): string {\n  return `${getProjectDir()}/.claude/logs/agent-state.json`;\n}\n\nfunction getSpawnLog(): string {\n  return `${getProjectDir()}/.claude/logs/subagent-spawns.jsonl`;\n}\n\n// -----------------------------------------------------------------------------\n// State Tracking\n// -----------------------------------------------------------------------------\n\ninterface StateData {\n  active_background: string[];\n  session_total: number;\n  last_cleanup: string | null;\n  blocked_count: number;\n}\n\nfunction initState(): void {\n  const stateFile = getStateFile();\n  const dir = stateFile.substring(0, stateFile.lastIndexOf('/'));\n\n  try {\n    mkdirSync(dir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  if (!existsSync(stateFile)) {\n    const initialState: StateData = {\n      active_background: [],\n      session_total: 0,\n      last_cleanup: null,\n      blocked_count: 0,\n    };\n    try {\n      writeFileSync(stateFile, JSON.stringify(initialState, null, 2));\n    } catch {\n      // Ignore\n    }\n  }\n}\n\nfunction countActiveBackground(): number {\n  const spawnLog = getSpawnLog();\n  if (!existsSync(spawnLog)) {\n    return 0;\n  }\n\n  try {\n    const content = readFileSync(spawnLog, 'utf8');\n    const lines = content.trim().split('\\n').filter(Boolean);\n    const recentLines = lines.slice(-20);\n\n    // Count agents spawned in last 5 minutes\n    const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000).toISOString();\n    let count = 0;\n\n    for (const line of recentLines) {\n      try {\n        const entry = JSON.parse(line);\n        if (entry.timestamp && entry.timestamp > fiveMinutesAgo) {\n          count++;\n        }\n      } catch {\n        // Skip invalid JSON\n      }\n    }\n\n    return count;\n  } catch {\n    return 0;\n  }\n}\n\nfunction countCurrentResponseAgents(): number {\n  const spawnLog = getSpawnLog();\n  if (!existsSync(spawnLog)) {\n    return 0;\n  }\n\n  try {\n    const content = readFileSync(spawnLog, 'utf8');\n    const lines = content.trim().split('\\n').filter(Boolean);\n    const recentLines = lines.slice(-20);\n\n    // Count agents spawned in last 2 seconds (same response)\n    const twoSecondsAgo = new Date(Date.now() - 2 * 1000).toISOString();\n    let count = 0;\n\n    for (const line of recentLines) {\n      try {\n        const entry = JSON.parse(line);\n        if (entry.timestamp && entry.timestamp > twoSecondsAgo) {\n          count++;\n        }\n      } catch {\n        // Skip invalid JSON\n      }\n    }\n\n    return count;\n  } catch {\n    return 0;\n  }\n}\n\nfunction incrementBlockedCount(): void {\n  const stateFile = getStateFile();\n  try {\n    if (existsSync(stateFile)) {\n      const state: StateData = JSON.parse(readFileSync(stateFile, 'utf8'));\n      state.blocked_count = (state.blocked_count || 0) + 1;\n      writeFileSync(stateFile, JSON.stringify(state, null, 2));\n    }\n  } catch {\n    // Ignore\n  }\n}\n\nfunction incrementSessionTotal(): void {\n  const stateFile = getStateFile();\n  try {\n    if (existsSync(stateFile)) {\n      const state: StateData = JSON.parse(readFileSync(stateFile, 'utf8'));\n      state.session_total = (state.session_total || 0) + 1;\n      writeFileSync(stateFile, JSON.stringify(state, null, 2));\n    }\n  } catch {\n    // Ignore\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function contextGate(input: HookInput): HookResult {\n  initState();\n\n  const toolInput = input.tool_input || {};\n  const subagentType = (toolInput.subagent_type as string) || '';\n  const description = (toolInput.description as string) || '';\n  const runInBackground = toolInput.run_in_background === true || toolInput.run_in_background === 'true';\n\n  logHook('context-gate', `Context gate check: ${subagentType} (background=${runInBackground})`);\n\n  // Count current state\n  const activeCount = countActiveBackground();\n  const responseCount = countCurrentResponseAgents();\n\n  logHook('context-gate', `Active background: ${activeCount}, Current response: ${responseCount}`);\n\n  // Check 1: Too many agents in single response\n  if (responseCount >= MAX_AGENTS_PER_RESPONSE) {\n    logHook('context-gate', `BLOCKED: Too many agents in single response (${responseCount} >= ${MAX_AGENTS_PER_RESPONSE})`);\n\n    return outputDeny(`Context Overflow Protection\n\nToo many agents spawned in a single response (${responseCount} agents).\n\nMaximum allowed: ${MAX_AGENTS_PER_RESPONSE} per response\n\nSOLUTION: Split into multiple responses or use sequential execution.\nConsider using the /context-compression skill first.\n\nAttempted: ${subagentType} - ${description}`);\n  }\n\n  // Check 2: Too many concurrent background agents\n  if (runInBackground && activeCount >= MAX_CONCURRENT_BACKGROUND) {\n    logHook('context-gate', `BLOCKED: Too many concurrent background agents (${activeCount} >= ${MAX_CONCURRENT_BACKGROUND})`);\n\n    incrementBlockedCount();\n\n    return outputDeny(`Background Agent Limit\n\nToo many background agents running concurrently (${activeCount} active).\n\nMaximum allowed: ${MAX_CONCURRENT_BACKGROUND} concurrent background agents\n\nSOLUTION:\n1. Wait for existing agents to complete\n2. Run this agent in foreground (remove run_in_background)\n3. Use /context-compression to free up context\n\nAttempted: ${subagentType} - ${description}`);\n  }\n\n  // Warning: Approaching limits\n  if (activeCount >= WARNING_THRESHOLD) {\n    logHook('context-gate', `WARNING: Approaching context budget limit`);\n\n    // Update session total\n    incrementSessionTotal();\n\n    return outputWarning(`Context Budget Warning\n\n${activeCount} background agents active (limit: ${MAX_CONCURRENT_BACKGROUND}).\n\nConsider:\n- Running remaining agents sequentially\n- Using /context-compression skill\n- Waiting for current agents to complete\n\nProceeding with: ${subagentType} - ${description}`);\n  }\n\n  // Warning: Expensive agent type\n  if (EXPENSIVE_TYPES.test(subagentType) && activeCount >= 2) {\n    logHook('context-gate', `WARNING: Expensive agent type with multiple active: ${subagentType}`);\n    return outputWarning(`Spawning expensive agent (${subagentType}) with ${activeCount} others active`);\n  }\n\n  // Update session total\n  incrementSessionTotal();\n\n  // Allow the agent to proceed\n  logHook('context-gate', `Context gate passed: ${subagentType}`);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Subagent Context Stager - SubagentStart Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * This hook:\n * 1. Checks if there are active todos from session state\n * 2. Stages relevant context files based on the task description\n * 3. Returns systemMessage with staged context\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { existsSync, readFileSync, readdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir, getSessionId } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Path Helpers\n// -----------------------------------------------------------------------------\n\nfunction getSessionState(): string {\n  return `${getProjectDir()}/.claude/context/session/state.json`;\n}\n\nfunction getDecisionsFile(): string {\n  return `${getProjectDir()}/.claude/context/knowledge/decisions/active.json`;\n}\n\nfunction getIssueDir(): string {\n  return `${getProjectDir()}/docs/issues`;\n}\n\n// -----------------------------------------------------------------------------\n// Context Extraction Functions\n// -----------------------------------------------------------------------------\n\ninterface SessionState {\n  tasks_pending?: string[];\n  [key: string]: unknown;\n}\n\ninterface DecisionsFile {\n  decisions?: Array<{\n    category?: string;\n    title?: string;\n    status?: string;\n  }>;\n}\n\nfunction extractPendingTasks(): { count: number; summary: string } {\n  const sessionState = getSessionState();\n  if (!existsSync(sessionState)) {\n    return { count: 0, summary: '' };\n  }\n\n  try {\n    const state: SessionState = JSON.parse(readFileSync(sessionState, 'utf8'));\n    const tasksPending = state.tasks_pending || [];\n    const count = tasksPending.length;\n\n    if (count === 0) {\n      return { count: 0, summary: '' };\n    }\n\n    const summary = tasksPending.slice(0, 3).map((t) => `- ${t}`).join('\\n');\n    return { count, summary };\n  } catch {\n    return { count: 0, summary: '' };\n  }\n}\n\nfunction extractRelevantDecisions(taskDescription: string, category: string): string {\n  const decisionsFile = getDecisionsFile();\n  if (!existsSync(decisionsFile)) {\n    return '';\n  }\n\n  try {\n    const data: DecisionsFile = JSON.parse(readFileSync(decisionsFile, 'utf8'));\n    const decisions = data.decisions || [];\n\n    const relevantDecisions = decisions\n      .filter((d) => d.category === category || d.category === 'api' || d.category === 'database')\n      .slice(0, 5)\n      .map((d) => `- ${d.title} (${d.status || 'unknown'})`);\n\n    return relevantDecisions.join('\\n');\n  } catch {\n    return '';\n  }\n}\n\nfunction findIssueDoc(issueNum: string): string {\n  const issueDir = getIssueDir();\n  if (!existsSync(issueDir)) {\n    return '';\n  }\n\n  try {\n    const entries = readdirSync(issueDir);\n    const match = entries.find((entry) => entry.includes(issueNum));\n    if (match) {\n      return `docs/issues/${match}`;\n    }\n  } catch {\n    // Ignore\n  }\n  return '';\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function subagentContextStager(input: HookInput): HookResult {\n  const toolInput = input.tool_input || {};\n  const subagentType = (toolInput.subagent_type as string) || '';\n  const taskDescription = (toolInput.task_description as string) || (toolInput.description as string) || '';\n\n  logHook('subagent-context-stager', `Staging context for ${subagentType}`);\n\n  let stagedContext = '';\n\n  // === CHECK FOR ACTIVE TODOS (Context Protocol 2.0) ===\n  const { count: pendingCount, summary: taskSummary } = extractPendingTasks();\n  if (pendingCount > 0) {\n    logHook('subagent-context-stager', `Found ${pendingCount} pending tasks`);\n    stagedContext += `ACTIVE TODOS:\\n${taskSummary}\\n\\n`;\n  }\n\n  // === STAGE RELEVANT ARCHITECTURE DECISIONS ===\n  const taskLower = taskDescription.toLowerCase();\n\n  if (/backend|api|endpoint|database|migration/.test(taskLower)) {\n    logHook('subagent-context-stager', 'Backend task detected - staging backend decisions');\n    const backendDecisions = extractRelevantDecisions(taskDescription, 'backend');\n    if (backendDecisions) {\n      stagedContext += `RELEVANT DECISIONS:\\n${backendDecisions}\\n\\n`;\n    }\n  }\n\n  if (/frontend|react|ui|component/.test(taskLower)) {\n    logHook('subagent-context-stager', 'Frontend task detected - staging frontend decisions');\n    const frontendDecisions = extractRelevantDecisions(taskDescription, 'frontend');\n    if (frontendDecisions) {\n      stagedContext += `RELEVANT DECISIONS:\\n${frontendDecisions}\\n\\n`;\n    }\n  }\n\n  // === STAGE TESTING REMINDERS ===\n  if (/test|testing|pytest|jest/.test(taskLower)) {\n    logHook('subagent-context-stager', 'Testing task detected - staging test context');\n    stagedContext += `TESTING REMINDERS:\n- Use 'tee' for visible test output\n- Check test patterns in backend/tests/ or frontend/src/**/__tests__/\n- Ensure coverage meets threshold requirements\n\n`;\n  }\n\n  // === STAGE ISSUE DOCUMENTATION ===\n  if (/issue|#\\d+|bug|fix/.test(taskLower)) {\n    logHook('subagent-context-stager', 'Issue-related task detected');\n\n    const issueMatch = taskDescription.match(/#(\\d+)/);\n    if (issueMatch) {\n      const issueNum = issueMatch[1];\n      const issueDoc = findIssueDoc(issueNum);\n      if (issueDoc) {\n        stagedContext += `ISSUE DOCS: ${issueDoc}\\n\\n`;\n        logHook('subagent-context-stager', `Staged issue documentation for #${issueNum}`);\n      }\n    }\n  }\n\n  // === RETURN SYSTEM MESSAGE (CC 2.1.7 Compliant) ===\n  if (stagedContext) {\n    const systemMessage = `${stagedContext}\\nTask: ${taskDescription}\\nSubagent: ${subagentType}`;\n    const lineCount = stagedContext.split('\\n').filter(Boolean).length;\n    logHook('subagent-context-stager', `Staged context with ${lineCount} lines`);\n\n    return {\n      continue: true,\n      systemMessage,\n    };\n  }\n\n  logHook('subagent-context-stager', 'No context staged for this task');\n  return outputSilentSuccess();\n}\n", "/**\n * Subagent Validator - SubagentStart Hook (PreToolUse for Task)\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * This is the ONLY place we track subagent usage because:\n * - SubagentStop hook doesn't receive subagent_type (Claude Code limitation)\n * - PreToolUse receives full task details including type, description, prompt\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { existsSync, readFileSync, mkdirSync, appendFileSync, readdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWithContext, logHook, getProjectDir, getSessionId } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst BUILTIN_TYPES = new Set([\n  'general-purpose',\n  'Explore',\n  'Plan',\n  'claude-code-guide',\n  'statusline-setup',\n  'Bash',\n]);\n\n// -----------------------------------------------------------------------------\n// Path Helpers\n// -----------------------------------------------------------------------------\n\nfunction getTrackingLog(): string {\n  return `${getProjectDir()}/.claude/logs/subagent-spawns.jsonl`;\n}\n\nfunction getPluginJson(): string {\n  return `${getProjectDir()}/plugin.json`;\n}\n\nfunction getAgentsDir(): string {\n  return `${getProjectDir()}/agents`;\n}\n\nfunction getClaudeAgentsDir(): string {\n  return `${getProjectDir()}/.claude/agents`;\n}\n\nfunction getSkillsDir(): string {\n  return `${getProjectDir()}/skills`;\n}\n\n// -----------------------------------------------------------------------------\n// Validation Functions\n// -----------------------------------------------------------------------------\n\nfunction getValidAgentTypes(): Set<string> {\n  const validTypes = new Set(BUILTIN_TYPES);\n\n  // Source 1: Load from plugin.json agents array\n  const pluginJson = getPluginJson();\n  if (existsSync(pluginJson)) {\n    try {\n      const plugin = JSON.parse(readFileSync(pluginJson, 'utf8'));\n      const agents = plugin.agents || [];\n      for (const agent of agents) {\n        if (agent.id) {\n          validTypes.add(agent.id);\n        }\n      }\n    } catch {\n      // Ignore\n    }\n  }\n\n  // Source 2: Scan agents/ directory\n  const agentsDirs = [getAgentsDir(), getClaudeAgentsDir()];\n  for (const agentsDir of agentsDirs) {\n    if (existsSync(agentsDir)) {\n      try {\n        const files = readdirSync(agentsDir);\n        for (const file of files) {\n          if (file.endsWith('.md')) {\n            validTypes.add(file.replace('.md', ''));\n          }\n        }\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  return validTypes;\n}\n\nfunction extractAgentSkills(agentType: string): string[] {\n  const skills: string[] = [];\n  const agentFiles = [\n    `${getAgentsDir()}/${agentType}.md`,\n    `${getClaudeAgentsDir()}/${agentType}.md`,\n  ];\n\n  let agentFile: string | null = null;\n  for (const file of agentFiles) {\n    if (existsSync(file)) {\n      agentFile = file;\n      break;\n    }\n  }\n\n  if (!agentFile) {\n    return skills;\n  }\n\n  try {\n    const content = readFileSync(agentFile, 'utf8');\n    const lines = content.split('\\n');\n\n    let inFrontmatter = false;\n    let inSkills = false;\n\n    for (const line of lines) {\n      if (line === '---') {\n        if (!inFrontmatter) {\n          inFrontmatter = true;\n          continue;\n        } else {\n          break; // End of frontmatter\n        }\n      }\n\n      if (!inFrontmatter) continue;\n\n      if (/^skills:/.test(line)) {\n        inSkills = true;\n        continue;\n      }\n\n      if (inSkills && /^[a-zA-Z]/.test(line) && !/^\\s/.test(line)) {\n        inSkills = false;\n        continue;\n      }\n\n      if (inSkills) {\n        const match = line.match(/^\\s*-\\s*(.+)$/);\n        if (match) {\n          const skillName = match[1].trim();\n          skills.push(skillName);\n        }\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  return skills;\n}\n\nfunction validateAgentSkills(agentType: string): string[] {\n  const skills = extractAgentSkills(agentType);\n  const missingSkills: string[] = [];\n  const skillsDir = getSkillsDir();\n\n  for (const skill of skills) {\n    const skillPath = `${skillsDir}/${skill}/SKILL.md`;\n    if (!existsSync(skillPath)) {\n      missingSkills.push(skill);\n    }\n  }\n\n  return missingSkills;\n}\n\n/**\n * Extract tools list from agent frontmatter YAML (CC 2.1.20)\n */\nfunction extractAgentTools(agentType: string): string[] {\n  const tools: string[] = [];\n  const agentFiles = [\n    `${getAgentsDir()}/${agentType}.md`,\n    `${getClaudeAgentsDir()}/${agentType}.md`,\n  ];\n\n  let agentFile: string | null = null;\n  for (const file of agentFiles) {\n    if (existsSync(file)) {\n      agentFile = file;\n      break;\n    }\n  }\n\n  if (!agentFile) return tools;\n\n  try {\n    const content = readFileSync(agentFile, 'utf8');\n    const lines = content.split('\\n');\n    let inFrontmatter = false;\n    let inTools = false;\n\n    for (const line of lines) {\n      if (line === '---') {\n        if (!inFrontmatter) {\n          inFrontmatter = true;\n          continue;\n        } else {\n          break;\n        }\n      }\n      if (!inFrontmatter) continue;\n\n      if (/^tools:/.test(line)) {\n        inTools = true;\n        continue;\n      }\n      if (inTools && /^[a-zA-Z]/.test(line) && !/^\\s/.test(line)) {\n        inTools = false;\n        continue;\n      }\n      if (inTools) {\n        const match = line.match(/^\\s*-\\s*(.+)$/);\n        if (match) {\n          tools.push(match[1].trim());\n        }\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  return tools;\n}\n\n/**\n * Generate permission profile markdown for agent (CC 2.1.20)\n */\nfunction getPermissionProfile(agentType: string, tools: string[]): string {\n  if (tools.length === 0) return '';\n\n  const readOnly = tools.every(t => ['Read', 'Glob', 'Grep'].includes(t));\n  const hasBash = tools.includes('Bash');\n  const hasWrite = tools.includes('Write') || tools.includes('Edit');\n\n  let riskLevel = 'low';\n  if (hasBash && hasWrite) riskLevel = 'elevated';\n  else if (hasBash || hasWrite) riskLevel = 'moderate';\n\n  return `## Agent Permission Profile (CC 2.1.20)\n\n**Agent**: \\`${agentType}\\`\n**Tools**: ${tools.join(', ')}\n**Risk Level**: ${riskLevel}${readOnly ? ' (read-only)' : ''}\n\n${hasBash ? '> This agent requests Bash access. Review commands carefully.\\n' : ''}`;\n}\n\nfunction logSpawn(subagentType: string, description: string, sessionId: string): void {\n  const trackingLog = getTrackingLog();\n  const dir = trackingLog.substring(0, trackingLog.lastIndexOf('/'));\n\n  try {\n    mkdirSync(dir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const entry = {\n    timestamp: new Date().toISOString(),\n    subagent_type: subagentType,\n    description: description,\n    session_id: sessionId,\n  };\n\n  try {\n    appendFileSync(trackingLog, JSON.stringify(entry) + '\\n');\n  } catch {\n    // Ignore\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function subagentValidator(input: HookInput): HookResult {\n  const toolInput = input.tool_input || {};\n  const subagentType = (toolInput.subagent_type as string) || '';\n  const description = (toolInput.description as string) || '';\n  const sessionId = input.session_id || getSessionId();\n\n  logHook('subagent-validator', `Task invocation: ${subagentType} - ${description}`);\n\n  // Log spawn to tracking file\n  logSpawn(subagentType, description, sessionId);\n\n  // Extract agent type (strip namespace prefix like \"ork:\")\n  const agentTypeOnly = subagentType.replace(/^[^:]+:/, '');\n\n  // Get valid types from multiple sources\n  const validTypes = getValidAgentTypes();\n\n  // Validate\n  if (!validTypes.has(subagentType) && !validTypes.has(agentTypeOnly)) {\n    logHook('subagent-validator', `WARNING: Unknown subagent type: ${subagentType}`);\n  }\n\n  // Log spawn\n  logHook('subagent-validator', `Spawning ${subagentType} agent: ${description}`);\n\n  // Validate agent skills\n  const missingSkills = validateAgentSkills(agentTypeOnly);\n  if (missingSkills.length > 0) {\n    const missingList = missingSkills.join(', ');\n    logHook('subagent-validator', `WARNING: Agent '${agentTypeOnly}' references missing skills: ${missingList}`);\n    // Output warning to stderr (visible to user but non-blocking)\n    console.error(`Warning: Agent '${agentTypeOnly}' references ${missingSkills.length} missing skill(s): ${missingList}`);\n  }\n\n  // CC 2.1.20: Extract agent tools and generate permission profile\n  const agentTools = extractAgentTools(agentTypeOnly);\n  if (agentTools.length > 0) {\n    const permissionProfile = getPermissionProfile(agentTypeOnly, agentTools);\n    logHook('subagent-validator', `Agent '${agentTypeOnly}' tools: ${agentTools.join(', ')}`);\n    return outputWithContext(permissionProfile);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Task Linker - SubagentStart Hook for CC 2.1.16 Task Integration\n * Issue #197: Agent Orchestration Layer\n *\n * Links spawned agents to their orchestration tasks:\n * 1. Looks up task by agent name in registry\n * 2. Updates task status to in_progress\n * 3. Updates agent tracking state\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWithContext, logHook } from '../lib/common.js';\nimport { getTaskByAgent, updateTaskStatus, formatTaskUpdateForClaude } from '../lib/task-integration.js';\nimport { updateAgentStatus } from '../lib/orchestration-state.js';\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Task linker hook - links spawned agents to orchestration tasks\n *\n * When an agent is spawned that was dispatched by the orchestration layer,\n * this hook:\n * 1. Finds the associated task in the registry\n * 2. Generates a TaskUpdate instruction to mark it in_progress\n * 3. Updates local tracking state\n */\nexport function taskLinker(input: HookInput): HookResult {\n  // Get agent type from input\n  const toolInput = input.tool_input || {};\n  const agentType =\n    (toolInput.subagent_type as string) ||\n    input.subagent_type ||\n    input.agent_type ||\n    '';\n\n  if (!agentType) {\n    logHook('task-linker', 'No agent type found, skipping');\n    return outputSilentSuccess();\n  }\n\n  logHook('task-linker', `Processing SubagentStart for: ${agentType}`);\n\n  // Look up task for this agent\n  const task = getTaskByAgent(agentType);\n\n  if (!task) {\n    logHook('task-linker', `No orchestration task found for agent: ${agentType}`);\n    return outputSilentSuccess();\n  }\n\n  logHook('task-linker', `Found task ${task.taskId} for agent ${agentType}`);\n\n  // Update local registry\n  updateTaskStatus(task.taskId, 'in_progress');\n\n  // Update orchestration state\n  updateAgentStatus(agentType, 'in_progress', task.taskId);\n\n  // Generate TaskUpdate instruction for Claude\n  const updateInstruction = formatTaskUpdateForClaude({\n    taskId: task.taskId,\n    status: 'in_progress',\n  });\n\n  const contextMessage = `## Orchestration: Task Linked\n\nAgent \\`${agentType}\\` has been linked to task **${task.taskId}**.\n\n${updateInstruction}\n\nThe task status should be updated to \\`in_progress\\`.`;\n\n  logHook('task-linker', `Linked agent ${agentType} to task ${task.taskId}`);\n\n  return outputWithContext(contextMessage);\n}\n", "/**\n * Agent Memory Store - SubagentStop Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * Extracts and stores successful patterns after agent completion.\n *\n * Strategy:\n * - Parse agent output for decision patterns\n * - Extract key architectural choices\n * - Store in mem0 with agent_id scope for future retrieval\n * - Track agent performance metrics\n * - Detect categories for proper organization\n *\n * Version: 1.2.0 (TypeScript port)\n * Part of mem0 Semantic Memory Integration\n */\n\nimport { existsSync, mkdirSync, appendFileSync, unlinkSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst DECISION_PATTERNS = [\n  'decided to',\n  'chose',\n  'implemented using',\n  'selected',\n  'opted for',\n  'will use',\n  'pattern:',\n  'approach:',\n  'architecture:',\n  'recommends',\n  'best practice',\n  'anti-pattern',\n  'learned that',\n];\n\nconst MEM0_SCOPE_DECISIONS = 'decisions';\nconst MEM0_SCOPE_AGENTS = 'agents';\n\n// -----------------------------------------------------------------------------\n// Path Helpers\n// -----------------------------------------------------------------------------\n\nfunction getPatternsLog(): string {\n  return `${getProjectDir()}/.claude/logs/agent-patterns.jsonl`;\n}\n\nfunction getAgentTrackingDir(): string {\n  return `${getProjectDir()}/.claude/session`;\n}\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction getProjectId(): string {\n  const projectDir = getProjectDir();\n  const projectName = projectDir.split('/').pop() || 'default-project';\n  return projectName\n    .toLowerCase()\n    .replace(/ /g, '-')\n    .replace(/[^a-z0-9-]/g, '-')\n    .replace(/^-+|-+$/g, '')\n    .replace(/-+/g, '-');\n}\n\nfunction mem0UserId(scope: string): string {\n  return `${getProjectId()}-${scope}`;\n}\n\n/**\n * Detect pattern category from text content\n */\nfunction detectPatternCategory(text: string): string {\n  // Security: Limit input length to prevent performance issues\n  const maxLength = 10240;\n  const truncatedText = text.length > maxLength ? text.substring(0, maxLength) : text;\n  const textLower = truncatedText.toLowerCase();\n\n  if (/pagination|cursor|offset/.test(textLower)) {\n    return 'pagination';\n  }\n  if (/security|vulnerability|exploit|injection|xss|csrf|owasp|safety|guardrail/.test(textLower)) {\n    return 'security';\n  }\n  if (/database|sql|postgres|schema/.test(textLower)) {\n    return 'database';\n  }\n  if (/api|endpoint|rest|graphql/.test(textLower)) {\n    return 'api';\n  }\n  if (/auth|login|jwt|oauth/.test(textLower)) {\n    return 'authentication';\n  }\n  if (/test|testing|pytest|jest|vitest|coverage|mock|fixture|spec/.test(textLower)) {\n    return 'testing';\n  }\n  if (/deploy|ci|cd|pipeline|docker|kubernetes|helm|terraform/.test(textLower)) {\n    return 'deployment';\n  }\n  if (/observability|monitoring|logging|tracing|metrics|prometheus|grafana|langfuse/.test(textLower)) {\n    return 'observability';\n  }\n  if (/react|component|frontend|ui/.test(textLower)) {\n    return 'frontend';\n  }\n  if (/performance|optimization|cache|index/.test(textLower)) {\n    return 'performance';\n  }\n  if (/llm|rag|embedding|vector|semantic|ai|ml|langchain|langgraph|mem0|openai|anthropic/.test(textLower)) {\n    return 'ai-ml';\n  }\n  if (/etl|data.*pipeline|streaming|batch.*processing|dataflow|spark/.test(textLower)) {\n    return 'data-pipeline';\n  }\n  if (/architecture|design|structure/.test(textLower)) {\n    return 'architecture';\n  }\n  if (/decided|chose|selected/.test(textLower)) {\n    return 'decision';\n  }\n  return 'pattern';\n}\n\n/**\n * Extract patterns from agent output\n */\nfunction extractPatterns(output: string): string[] {\n  const patterns: string[] = [];\n\n  if (output.length < 50) {\n    return patterns;\n  }\n\n  for (const pattern of DECISION_PATTERNS) {\n    const regex = new RegExp(`^.*${pattern.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}.*$`, 'gim');\n    const matches = output.match(regex) || [];\n\n    for (const match of matches) {\n      const cleaned = match.trim().substring(0, 200);\n      if (cleaned.length > 20) {\n        patterns.push(cleaned);\n      }\n    }\n  }\n\n  // Deduplicate and limit\n  const unique = [...new Set(patterns)];\n  return unique.slice(0, 5);\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function agentMemoryStore(input: HookInput): HookResult {\n  logHook('agent-memory-store', 'Agent memory store hook starting');\n\n  const toolInput = input.tool_input || {};\n  let agentType = input.subagent_type || (toolInput.subagent_type as string) || (toolInput.type as string) || '';\n  const rawResult = input.tool_result;\n  const agentOutput = typeof rawResult === 'string'\n    ? rawResult\n    : (rawResult?.content || input.agent_output || input.output || '');\n  let success = true;\n\n  // Check for error in output\n  if (input.error) {\n    success = false;\n  }\n\n  // If no agent type, silent success\n  if (!agentType) {\n    logHook('agent-memory-store', 'No agent type in input, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Build agent_id from AGENT_TYPE\n  const agentId = `ork:${agentType}`;\n\n  // Clean up tracking file to prevent stale data\n  const trackingFile = `${getAgentTrackingDir()}/current-agent-id`;\n  try {\n    if (existsSync(trackingFile)) {\n      unlinkSync(trackingFile);\n    }\n  } catch {\n    // Ignore\n  }\n\n  logHook('agent-memory-store', `Processing completion for agent: ${agentType} (agent_id: ${agentId}, success: ${success})`);\n\n  // Extract patterns (only if successful)\n  const extractedPatterns = success && agentOutput ? extractPatterns(agentOutput) : [];\n\n  if (extractedPatterns.length === 0) {\n    logHook('agent-memory-store', `No patterns extracted from ${agentType} output`);\n    return outputSilentSuccess();\n  }\n\n  // Log patterns for storage\n  const patternsLog = getPatternsLog();\n  const logDir = patternsLog.substring(0, patternsLog.lastIndexOf('/'));\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const projectId = getProjectId();\n  const timestamp = new Date().toISOString();\n  const decisionsUserId = mem0UserId(MEM0_SCOPE_DECISIONS);\n\n  for (const pattern of extractedPatterns) {\n    const category = detectPatternCategory(pattern);\n\n    const entry = {\n      agent: agentType,\n      agent_id: agentId,\n      pattern: pattern,\n      project: projectId,\n      timestamp: timestamp,\n      suggested_user_id: decisionsUserId,\n      category: category,\n      enable_graph: true,\n      pending_sync: true,\n    };\n\n    try {\n      appendFileSync(patternsLog, JSON.stringify(entry) + '\\n');\n    } catch {\n      // Ignore\n    }\n\n    logHook('agent-memory-store', `Extracted pattern (${category}): ${pattern.substring(0, 50)}...`);\n  }\n\n  logHook('agent-memory-store', `Extracted ${extractedPatterns.length} patterns from ${agentType} output`);\n\n  // Build suggestion message\n  const systemMsg = `[Pattern Extraction] ${extractedPatterns.length} patterns extracted from ${agentType}. Use mcp__mem0__add_memory with user_id='${decisionsUserId}', agent_id='${agentId}' to persist (graph memory auto-enabled).`;\n\n  return {\n    continue: true,\n    systemMessage: systemMsg,\n  };\n}\n", "/**\n * Auto Spawn Quality - SubagentStop Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * Purpose:\n * - Auto-spawns code-quality-reviewer after test-generator completes\n * - Auto-spawns security-auditor on sensitive file changes\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { existsSync, writeFileSync, mkdirSync, appendFileSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir, getSessionId } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst SENSITIVE_PATTERNS = [\n  '.env',\n  'credentials',\n  'secret',\n  'auth',\n  'password',\n  'token',\n  'api.key',\n  'private.key',\n  '.pem',\n  'oauth',\n  'jwt',\n  'session',\n  'cookie',\n  'encryption',\n  'crypto',\n];\n\n// -----------------------------------------------------------------------------\n// Path Helpers\n// -----------------------------------------------------------------------------\n\nfunction getSpawnLog(): string {\n  const logDir = `${getProjectDir()}/.claude/hooks/logs`;\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n  return `${logDir}/auto-spawn-quality.log`;\n}\n\nfunction getSpawnQueue(): string {\n  return `${getProjectDir()}/.claude/context/spawn-queue.json`;\n}\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction logSpawn(message: string): void {\n  const logFile = getSpawnLog();\n  const timestamp = new Date().toISOString();\n  try {\n    appendFileSync(logFile, `[${timestamp}] [auto-spawn-quality] ${message}\\n`);\n  } catch {\n    // Ignore\n  }\n}\n\nfunction containsSensitiveFiles(output: string): boolean {\n  const lowerOutput = output.toLowerCase();\n  for (const pattern of SENSITIVE_PATTERNS) {\n    if (lowerOutput.includes(pattern)) {\n      logSpawn(`Detected sensitive pattern: ${pattern}`);\n      return true;\n    }\n  }\n  return false;\n}\n\ninterface SpawnRequest {\n  spawn_id: string;\n  target_agent: string;\n  trigger_agent: string;\n  trigger_reason: string;\n  priority: string;\n  timestamp: string;\n  session_id: string;\n  status: string;\n}\n\ninterface SpawnQueue {\n  schema_version: string;\n  created_at: string;\n  queue: SpawnRequest[];\n}\n\nfunction queueSpawn(\n  agentType: string,\n  targetAgent: string,\n  triggerReason: string,\n  priority: string,\n  sessionId: string,\n  timestamp: string\n): string {\n  const spawnId = `SPAWN-${new Date().toISOString().replace(/[-:T.]/g, '').substring(0, 14)}-${Math.floor(Math.random() * 10000)\n    .toString()\n    .padStart(4, '0')}`;\n\n  const spawnQueue = getSpawnQueue();\n  const queueDir = spawnQueue.substring(0, spawnQueue.lastIndexOf('/'));\n\n  try {\n    mkdirSync(queueDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  let queue: SpawnQueue;\n  if (existsSync(spawnQueue)) {\n    try {\n      queue = JSON.parse(readFileSync(spawnQueue, 'utf8'));\n    } catch {\n      queue = {\n        schema_version: '1.0.0',\n        created_at: timestamp,\n        queue: [],\n      };\n    }\n  } else {\n    queue = {\n      schema_version: '1.0.0',\n      created_at: timestamp,\n      queue: [],\n    };\n  }\n\n  const request: SpawnRequest = {\n    spawn_id: spawnId,\n    target_agent: targetAgent,\n    trigger_agent: agentType,\n    trigger_reason: triggerReason,\n    priority: priority,\n    timestamp: timestamp,\n    session_id: sessionId,\n    status: 'queued',\n  };\n\n  queue.queue.push(request);\n\n  try {\n    writeFileSync(spawnQueue, JSON.stringify(queue, null, 2));\n    logSpawn(`Queued spawn request: ${spawnId} for ${targetAgent} (reason: ${triggerReason})`);\n  } catch {\n    logSpawn(`ERROR: Failed to queue spawn request for ${targetAgent}`);\n    return '';\n  }\n\n  return spawnId;\n}\n\nfunction writeSpawnSuggestion(\n  agentType: string,\n  targetAgent: string,\n  triggerReason: string,\n  priority: string,\n  sessionId: string,\n  timestamp: string\n): void {\n  const handoffDir = `${getProjectDir()}/.claude/context/handoffs`;\n  try {\n    mkdirSync(handoffDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const suggestionFile = `${handoffDir}/auto_spawn_${targetAgent}_${new Date().toISOString().replace(/[-:T.]/g, '').substring(0, 15)}.json`;\n\n  const suggestion = {\n    type: 'auto_spawn_suggestion',\n    from_agent: agentType,\n    to_agent: targetAgent,\n    timestamp: timestamp,\n    trigger_reason: triggerReason,\n    priority: priority,\n    session_id: sessionId,\n    auto_triggered: true,\n    status: 'suggested',\n  };\n\n  try {\n    writeFileSync(suggestionFile, JSON.stringify(suggestion, null, 2));\n    logSpawn(`Created spawn suggestion: ${targetAgent} (reason: ${triggerReason})`);\n  } catch {\n    // Ignore\n  }\n}\n\ninterface SpawnInfo {\n  target: string;\n  reason: string;\n  priority: string;\n}\n\nfunction checkAutoSpawnConditions(agentType: string, agentOutput: string, error: string): SpawnInfo | null {\n  // Skip if agent had errors\n  if (error && error !== 'null') {\n    logSpawn(`Skipping auto-spawn - agent ${agentType} had errors: ${error}`);\n    return null;\n  }\n\n  // Rule 1: test-generator completion -> code-quality-reviewer\n  if (agentType === 'test-generator') {\n    logSpawn('Rule matched: test-generator -> code-quality-reviewer');\n    return {\n      target: 'code-quality-reviewer',\n      reason: 'test-generator completed - validating test quality and coverage',\n      priority: 'high',\n    };\n  }\n\n  // Rule 2: Any agent with sensitive file changes -> security-auditor\n  if (containsSensitiveFiles(agentOutput)) {\n    if (agentType !== 'security-auditor' && agentType !== 'security-layer-auditor') {\n      logSpawn('Rule matched: sensitive files detected -> security-auditor');\n      return {\n        target: 'security-auditor',\n        reason: 'sensitive file changes detected - security audit required',\n        priority: 'critical',\n      };\n    }\n  }\n\n  // Rule 3: code-quality-reviewer completion -> security-auditor\n  if (agentType === 'code-quality-reviewer') {\n    logSpawn('Rule matched: code-quality-reviewer -> security-auditor');\n    return {\n      target: 'security-auditor',\n      reason: 'code-quality-reviewer completed - proceeding with security scan',\n      priority: 'high',\n    };\n  }\n\n  // Rule 4: backend-system-architect with auth/security mentions -> security-layer-auditor\n  if (agentType === 'backend-system-architect') {\n    const lowerOutput = agentOutput.toLowerCase();\n    if (/authentication|authorization|security|access.control|rbac|acl/.test(lowerOutput)) {\n      logSpawn('Rule matched: backend-system-architect with auth -> security-layer-auditor');\n      return {\n        target: 'security-layer-auditor',\n        reason: 'backend-system-architect designed auth/security layer - validation required',\n        priority: 'high',\n      };\n    }\n  }\n\n  return null;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function autoSpawnQuality(input: HookInput): HookResult {\n  const timestamp = new Date().toISOString();\n\n  const toolInput = input.tool_input || {};\n  const agentType =\n    (toolInput.subagent_type as string) ||\n    input.subagent_type ||\n    input.agent_type ||\n    'unknown';\n  const sessionId = input.session_id || getSessionId();\n  const agentOutput = input.agent_output || input.output || '';\n  const error = input.error || '';\n\n  logSpawn(`Checking auto-spawn conditions for agent: ${agentType} (session: ${sessionId})`);\n\n  // Skip if unknown agent type\n  if (agentType === 'unknown' || !agentType) {\n    logSpawn('Skipping unknown agent type');\n    return outputSilentSuccess();\n  }\n\n  // Check auto-spawn conditions\n  const spawnInfo = checkAutoSpawnConditions(agentType, agentOutput, error);\n\n  if (spawnInfo) {\n    // Queue the spawn request\n    const spawnId = queueSpawn(\n      agentType,\n      spawnInfo.target,\n      spawnInfo.reason,\n      spawnInfo.priority,\n      sessionId,\n      timestamp\n    );\n\n    // Write spawn suggestion for orchestrator\n    writeSpawnSuggestion(\n      agentType,\n      spawnInfo.target,\n      spawnInfo.reason,\n      spawnInfo.priority,\n      sessionId,\n      timestamp\n    );\n\n    // Log the action\n    logSpawn(`=== AUTO-SPAWN QUALITY HOOK ===\nTrigger Agent: ${agentType}\nTarget Agent: ${spawnInfo.target}\nReason: ${spawnInfo.reason}\nPriority: ${spawnInfo.priority}\nSpawn ID: ${spawnId}\nTimestamp: ${timestamp}\nSession: ${sessionId}`);\n\n    return {\n      continue: true,\n      systemMessage: `Auto-spawn queued: ${spawnInfo.target} (${spawnInfo.priority} priority)`,\n    };\n  }\n\n  logSpawn(`No auto-spawn conditions matched for ${agentType}`);\n  return outputSilentSuccess();\n}\n", "/**\n * Context Publisher - SubagentStop Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * Publishes agent decisions to context (Context Protocol 2.0).\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { existsSync, writeFileSync, mkdirSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Path Helpers\n// -----------------------------------------------------------------------------\n\nfunction getDecisionsFile(): string {\n  return `${getProjectDir()}/.claude/context/knowledge/decisions/active.json`;\n}\n\nfunction getSessionState(): string {\n  return `${getProjectDir()}/.claude/context/session/state.json`;\n}\n\nfunction getLogDir(): string {\n  return `${getProjectDir()}/.claude/logs/agent-context`;\n}\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\ninterface DecisionEntry {\n  timestamp: string;\n  agent: string;\n  summary: string;\n  status: string;\n}\n\ninterface DecisionsFile {\n  schema_version: string;\n  decisions: Record<string, DecisionEntry>;\n}\n\ninterface TaskEntry {\n  agent: string;\n  timestamp: string;\n  summary: string;\n}\n\ninterface SessionState {\n  schema_version: string;\n  session_id: string;\n  started_at: string;\n  last_activity: string;\n  active_agent: string | null;\n  tasks_pending: string[];\n  tasks_completed: TaskEntry[];\n}\n\nfunction ensureDir(dirPath: string): void {\n  try {\n    mkdirSync(dirPath, { recursive: true });\n  } catch {\n    // Ignore\n  }\n}\n\nfunction readJsonFile<T>(filePath: string, defaultValue: T): T {\n  if (!existsSync(filePath)) {\n    return defaultValue;\n  }\n  try {\n    return JSON.parse(readFileSync(filePath, 'utf8')) as T;\n  } catch {\n    return defaultValue;\n  }\n}\n\nfunction writeJsonFile(filePath: string, data: unknown): void {\n  const dir = filePath.substring(0, filePath.lastIndexOf('/'));\n  ensureDir(dir);\n  try {\n    writeFileSync(filePath, JSON.stringify(data, null, 2));\n  } catch {\n    // Ignore\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function contextPublisher(input: HookInput): HookResult {\n  const agentName = process.env.CLAUDE_AGENT_NAME || 'unknown';\n  const timestamp = new Date().toISOString();\n\n  // Read agent output from input\n  const output = input.agent_output || input.output || '';\n\n  // Extract summary from output (first 200 chars)\n  let summary = output.substring(0, 200);\n  if (output.length > 200) {\n    summary += '...';\n  }\n\n  // Create agent key (replace hyphens with underscores for JSON)\n  const agentKey = agentName.replace(/-/g, '_');\n\n  // === Update Decisions File (Context Protocol 2.0) ===\n  const decisionsFile = getDecisionsFile();\n  const decisionsDir = decisionsFile.substring(0, decisionsFile.lastIndexOf('/'));\n  ensureDir(decisionsDir);\n\n  const defaultDecisions: DecisionsFile = {\n    schema_version: '2.0.0',\n    decisions: {},\n  };\n\n  const decisions = readJsonFile(decisionsFile, defaultDecisions);\n\n  // Ensure decisions object exists (defensive against old schema versions)\n  if (!decisions.decisions || typeof decisions.decisions !== 'object') {\n    decisions.decisions = {};\n  }\n\n  const decisionEntry: DecisionEntry = {\n    timestamp,\n    agent: agentName,\n    summary,\n    status: 'completed',\n  };\n\n  decisions.decisions[agentKey] = decisionEntry;\n  writeJsonFile(decisionsFile, decisions);\n\n  // === Update Session State (Context Protocol 2.0) ===\n  const sessionStateFile = getSessionState();\n  const sessionDir = sessionStateFile.substring(0, sessionStateFile.lastIndexOf('/'));\n  ensureDir(sessionDir);\n\n  const defaultState: SessionState = {\n    schema_version: '2.0.0',\n    session_id: '',\n    started_at: timestamp,\n    last_activity: timestamp,\n    active_agent: null,\n    tasks_pending: [],\n    tasks_completed: [],\n  };\n\n  const sessionState = readJsonFile(sessionStateFile, defaultState);\n\n  // Ensure arrays exist (defensive against old schema versions)\n  if (!Array.isArray(sessionState.tasks_completed)) {\n    sessionState.tasks_completed = [];\n  }\n  if (!Array.isArray(sessionState.tasks_pending)) {\n    sessionState.tasks_pending = [];\n  }\n\n  const taskEntry: TaskEntry = {\n    agent: agentName,\n    timestamp,\n    summary,\n  };\n\n  sessionState.tasks_completed.push(taskEntry);\n  sessionState.last_activity = timestamp;\n  sessionState.active_agent = null;\n\n  writeJsonFile(sessionStateFile, sessionState);\n\n  // === Logging ===\n  const logDir = getLogDir();\n  ensureDir(logDir);\n\n  const dateStr = new Date().toISOString().replace(/[-:]/g, '').substring(0, 15);\n  const logFile = `${logDir}/${agentName}_${dateStr}.log`;\n\n  const logContent = `=== CONTEXT PUBLICATION (Protocol 2.0) ===\nAgent: ${agentName}\nTimestamp: ${timestamp}\nDecisions file: ${decisionsFile}\nSession state: ${sessionStateFile}\n\n=== AGENT OUTPUT ===\n${output}\n`;\n\n  try {\n    writeFileSync(logFile, logContent);\n  } catch {\n    // Ignore\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Feedback Loop - SubagentStop Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n * CC 2.1.16 Compliant: Integrates with Task Management System\n *\n * Purpose:\n * - Captures agent completion context\n * - Routes findings to relevant downstream agents\n * - Logs to decision-log.json\n * - Updates CC 2.1.16 Task status (Issue #197)\n *\n * Version: 2.0.0 (Task Integration)\n */\n\nimport { existsSync, writeFileSync, mkdirSync, readFileSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir, getSessionId } from '../lib/common.js';\nimport { getTaskByAgent, updateTaskStatus, getActivePipeline } from '../lib/task-integration.js';\nimport { PIPELINES } from '../lib/multi-agent-coordinator.js';\n\n// -----------------------------------------------------------------------------\n// Path Helpers\n// -----------------------------------------------------------------------------\n\nfunction getDecisionLog(): string {\n  return `${getProjectDir()}/.claude/coordination/decision-log.json`;\n}\n\nfunction getFeedbackLog(): string {\n  const logDir = `${getProjectDir()}/.claude/hooks/logs`;\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n  return `${logDir}/agent-feedback.log`;\n}\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction logFeedback(message: string): void {\n  const logFile = getFeedbackLog();\n  const timestamp = new Date().toISOString();\n  try {\n    appendFileSync(logFile, `[${timestamp}] [feedback-loop] ${message}\\n`);\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Get downstream agents from PIPELINES definitions or fallback mapping\n */\nfunction getDownstreamAgents(agent: string): string {\n  // First, check if agent is part of an active pipeline\n  const activePipeline = getActivePipeline();\n  if (activePipeline) {\n    const pipelineDef = PIPELINES.find(p => p.type === activePipeline.type);\n    if (pipelineDef) {\n      // Find current step\n      const currentStepIdx = pipelineDef.steps.findIndex(s => s.agent === agent);\n      if (currentStepIdx >= 0) {\n        // Get next steps that depend on this one\n        const nextAgents = pipelineDef.steps\n          .filter((s, idx) => s.dependsOn.includes(currentStepIdx) && idx > currentStepIdx)\n          .map(s => s.agent);\n        if (nextAgents.length > 0) {\n          return nextAgents.join(' ');\n        }\n      }\n    }\n  }\n\n  // Fallback: static mapping for non-pipeline scenarios\n  const mapping: Record<string, string> = {\n    // Product thinking pipeline\n    'market-intelligence': 'product-strategist',\n    'product-strategist': 'prioritization-analyst',\n    'prioritization-analyst': 'business-case-builder',\n    'business-case-builder': 'requirements-translator',\n    'requirements-translator': 'metrics-architect',\n    'metrics-architect': 'backend-system-architect',\n    // Full-stack pipeline\n    'backend-system-architect': 'frontend-ui-developer',\n    'frontend-ui-developer': 'test-generator',\n    'test-generator': 'security-auditor',\n    // AI integration pipeline\n    'workflow-architect': 'llm-integrator',\n    'llm-integrator': 'data-pipeline-engineer',\n    'data-pipeline-engineer': 'test-generator',\n    // UI pipeline\n    'rapid-ui-designer': 'frontend-ui-developer',\n    'ux-researcher': 'rapid-ui-designer',\n  };\n\n  return mapping[agent] || '';\n}\n\n/**\n * Categorize feedback based on agent type\n */\nfunction getFeedbackCategory(agent: string): string {\n  const categories: Record<string, string> = {\n    'market-intelligence': 'product-thinking',\n    'product-strategist': 'product-thinking',\n    'prioritization-analyst': 'product-thinking',\n    'business-case-builder': 'product-thinking',\n    'requirements-translator': 'specification',\n    'metrics-architect': 'specification',\n    'backend-system-architect': 'architecture',\n    'database-engineer': 'architecture',\n    'data-pipeline-engineer': 'architecture',\n    'frontend-ui-developer': 'frontend',\n    'rapid-ui-designer': 'frontend',\n    'ux-researcher': 'frontend',\n    'test-generator': 'quality',\n    'code-quality-reviewer': 'quality',\n    'security-auditor': 'security',\n    'security-layer-auditor': 'security',\n    'workflow-architect': 'ai-integration',\n    'llm-integrator': 'ai-integration',\n    'debug-investigator': 'debugging',\n  };\n\n  return categories[agent] || 'general';\n}\n\n/**\n * Get instance ID consistently\n */\nfunction getInstanceId(): string {\n  return process.env.CLAUDE_INSTANCE_ID || `${require('os').hostname()}-${process.pid}`;\n}\n\nfunction extractFindingsSummary(output: string): string {\n  let summary = output.substring(0, 500);\n  if (output.length > 500) {\n    summary += '...';\n  }\n  return summary;\n}\n\ninterface DecisionEntry {\n  decision_id: string;\n  timestamp: string;\n  made_by: {\n    instance_id: string;\n    agent_type: string;\n  };\n  category: string;\n  title: string;\n  description: string;\n  impact: {\n    scope: string;\n    downstream_agents: string[];\n  };\n  status: string;\n  task_id?: string;  // CC 2.1.16 integration\n}\n\ninterface DecisionLog {\n  schema_version: string;\n  log_created_at: string;\n  decisions: DecisionEntry[];\n}\n\nfunction writeDecision(\n  decisionId: string,\n  agentType: string,\n  category: string,\n  summary: string,\n  downstreamAgents: string,\n  status: string,\n  timestamp: string,\n  taskId?: string\n): void {\n  const decisionLog = getDecisionLog();\n  const logDir = decisionLog.substring(0, decisionLog.lastIndexOf('/'));\n\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  let log: DecisionLog;\n  if (existsSync(decisionLog)) {\n    try {\n      log = JSON.parse(readFileSync(decisionLog, 'utf8'));\n    } catch {\n      log = {\n        schema_version: '2.0.0',\n        log_created_at: timestamp,\n        decisions: [],\n      };\n    }\n  } else {\n    log = {\n      schema_version: '2.0.0',\n      log_created_at: timestamp,\n      decisions: [],\n    };\n  }\n\n  const decisionEntry: DecisionEntry = {\n    decision_id: decisionId,\n    timestamp,\n    made_by: {\n      instance_id: getInstanceId(),\n      agent_type: agentType,\n    },\n    category,\n    title: `Agent ${agentType} completed`,\n    description: summary,\n    impact: {\n      scope: 'agent-pipeline',\n      downstream_agents: downstreamAgents.split(' ').filter(Boolean),\n    },\n    status,\n    task_id: taskId,\n  };\n\n  log.decisions.push(decisionEntry);\n\n  try {\n    writeFileSync(decisionLog, JSON.stringify(log, null, 2));\n    logFeedback(`Decision ${decisionId} logged for agent ${agentType}`);\n  } catch {\n    logFeedback('ERROR: Failed to write decision to log');\n  }\n}\n\ninterface HandoffContext {\n  from_agent: string;\n  to_agent: string;\n  timestamp: string;\n  decision_id: string;\n  summary: string;\n  session_id: string;\n  status: string;\n  feedback_loop: boolean;\n  task_id?: string;  // CC 2.1.16 integration\n}\n\nfunction createHandoffContext(\n  agentType: string,\n  downstreamAgents: string,\n  summary: string,\n  decisionId: string,\n  sessionId: string,\n  timestamp: string,\n  taskId?: string\n): void {\n  if (!downstreamAgents) {\n    return;\n  }\n\n  const handoffDir = `${getProjectDir()}/.claude/context/handoffs`;\n  try {\n    mkdirSync(handoffDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const agents = downstreamAgents.split(' ').filter(Boolean);\n  const dateStr = new Date().toISOString().replace(/[-:]/g, '').substring(0, 15);\n\n  for (const downstream of agents) {\n    const handoffFile = `${handoffDir}/${agentType}_to_${downstream}_${dateStr}.json`;\n\n    const handoff: HandoffContext = {\n      from_agent: agentType,\n      to_agent: downstream,\n      timestamp,\n      decision_id: decisionId,\n      summary,\n      session_id: sessionId,\n      status: 'pending',\n      feedback_loop: true,\n      task_id: taskId,\n    };\n\n    try {\n      writeFileSync(handoffFile, JSON.stringify(handoff, null, 2));\n      logFeedback(`Created handoff context: ${agentType} -> ${downstream}`);\n    } catch {\n      // Ignore\n    }\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function feedbackLoop(input: HookInput): HookResult {\n  const timestamp = new Date().toISOString();\n\n  const toolInput = input.tool_input || {};\n  const agentType =\n    (toolInput.subagent_type as string) ||\n    input.subagent_type ||\n    input.agent_type ||\n    'unknown';\n  const sessionId = input.session_id || getSessionId();\n  const agentOutput = input.agent_output || input.output || '';\n  const error = input.error || '';\n\n  logFeedback(`Processing feedback for agent: ${agentType} (session: ${sessionId})`);\n\n  // Skip if unknown agent type\n  if (agentType === 'unknown' || !agentType) {\n    logFeedback('Skipping unknown agent type');\n    return outputSilentSuccess();\n  }\n\n  // Generate decision ID\n  const dateStr = new Date().toISOString().replace(/[-:T.]/g, '').substring(0, 8);\n  const randomNum = Math.floor(Math.random() * 10000)\n    .toString()\n    .padStart(4, '0');\n  const decisionId = `DEC-${dateStr}-${randomNum}`;\n\n  // CC 2.1.16: Look up associated task\n  const task = getTaskByAgent(agentType);\n  const taskId = task?.taskId;\n\n  // Determine downstream agents (use pipeline-aware routing)\n  const downstreamAgents = getDownstreamAgents(agentType);\n\n  // Get feedback category\n  const category = getFeedbackCategory(agentType);\n\n  // Extract findings summary\n  let summary: string;\n  let status: string;\n  if (error && error !== 'null') {\n    summary = `Agent failed: ${error}`;\n    status = 'failed';\n  } else {\n    summary = extractFindingsSummary(agentOutput);\n    status = 'completed';\n  }\n\n  // CC 2.1.16: Update task status in registry\n  if (taskId) {\n    updateTaskStatus(taskId, status === 'completed' ? 'completed' : 'failed');\n    logFeedback(`Updated task ${taskId} status to ${status}`);\n  }\n\n  // Write to decision log (now includes task_id)\n  writeDecision(decisionId, agentType, category, summary, downstreamAgents, status, timestamp, taskId);\n\n  // Create handoff context for downstream agents (now includes task_id)\n  if (downstreamAgents) {\n    createHandoffContext(agentType, downstreamAgents, summary, decisionId, sessionId, timestamp, taskId);\n    logFeedback(`Routed findings to downstream agents: ${downstreamAgents}`);\n  } else {\n    logFeedback(`No downstream agents for ${agentType} (terminal agent)`);\n  }\n\n  // Log completion\n  logFeedback(`=== AGENT FEEDBACK LOOP ===\nAgent: ${agentType}\nCategory: ${category}\nDecision ID: ${decisionId}\nTask ID: ${taskId || 'none'}\nTimestamp: ${timestamp}\nStatus: ${status}\nDownstream: ${downstreamAgents || 'none'}\n\nSummary: ${summary}`);\n\n  // Output\n  if (downstreamAgents) {\n    return {\n      continue: true,\n      systemMessage: `Feedback loop: routed to ${downstreamAgents}${taskId ? ` (task: ${taskId})` : ''}`,\n    };\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Handoff Preparer - SubagentStop Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * Prepares context for handoff to next agent in pipeline.\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst VALID_AGENTS = new Set([\n  'market-intelligence',\n  'product-strategist',\n  'prioritization-analyst',\n  'business-case-builder',\n  'requirements-translator',\n  'metrics-architect',\n  'backend-system-architect',\n  'code-quality-reviewer',\n  'data-pipeline-engineer',\n  'database-engineer',\n  'debug-investigator',\n  'frontend-ui-developer',\n  'llm-integrator',\n  'rapid-ui-designer',\n  'security-auditor',\n  'security-layer-auditor',\n  'system-design-reviewer',\n  'test-generator',\n  'ux-researcher',\n  'workflow-architect',\n]);\n\n// Pipeline mappings\nconst NEXT_AGENT_MAP: Record<string, string> = {\n  // Product thinking pipeline\n  'market-intelligence': 'product-strategist',\n  'product-strategist': 'prioritization-analyst',\n  'prioritization-analyst': 'business-case-builder',\n  'business-case-builder': 'requirements-translator',\n  'requirements-translator': 'metrics-architect',\n  'metrics-architect': 'backend-system-architect',\n  // Full-stack pipeline\n  'backend-system-architect': 'frontend-ui-developer',\n  'frontend-ui-developer': 'test-generator',\n  'test-generator': 'code-quality-reviewer',\n  'code-quality-reviewer': 'security-auditor',\n  // AI integration pipeline\n  'workflow-architect': 'llm-integrator',\n  'llm-integrator': 'data-pipeline-engineer',\n  'data-pipeline-engineer': 'code-quality-reviewer',\n  // Database pipeline\n  'database-engineer': 'backend-system-architect',\n  // UI pipeline\n  'rapid-ui-designer': 'frontend-ui-developer',\n  'ux-researcher': 'rapid-ui-designer',\n  // Terminal agents\n  'security-auditor': 'none',\n  'security-layer-auditor': 'none',\n  'debug-investigator': 'none',\n  'system-design-reviewer': 'none',\n};\n\n// Handoff suggestions\nconst SUGGESTIONS_MAP: Record<string, string> = {\n  'market-intelligence': 'Next: product-strategist should define product vision based on market analysis',\n  'product-strategist': 'Next: prioritization-analyst should rank features from strategy',\n  'prioritization-analyst': 'Next: business-case-builder should create ROI justification',\n  'business-case-builder': 'Next: requirements-translator should convert to technical specs',\n  'requirements-translator': 'Next: metrics-architect should define success criteria',\n  'metrics-architect': 'Next: backend-system-architect should design API endpoints',\n  'backend-system-architect': 'Next: frontend-ui-developer should build UI components',\n  'frontend-ui-developer': 'Next: test-generator should create test coverage',\n  'test-generator': 'Next: code-quality-reviewer should validate implementation',\n  'code-quality-reviewer': 'Next: security-auditor should perform security scan',\n  'workflow-architect': 'Next: llm-integrator should configure LLM providers',\n  'llm-integrator': 'Next: data-pipeline-engineer should set up embeddings',\n  'data-pipeline-engineer': 'Next: code-quality-reviewer should validate data pipeline',\n  'database-engineer': 'Next: backend-system-architect should integrate schema',\n  'rapid-ui-designer': 'Next: frontend-ui-developer should implement designs',\n  'ux-researcher': 'Next: rapid-ui-designer should create mockups',\n};\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction getNextAgent(agentName: string): string {\n  return NEXT_AGENT_MAP[agentName] || 'none';\n}\n\nfunction getSuggestions(agentName: string): string {\n  return SUGGESTIONS_MAP[agentName] || 'Pipeline complete';\n}\n\ninterface HandoffContext {\n  from_agent: string;\n  to_agent: string;\n  timestamp: string;\n  summary: string;\n  suggestions: string;\n  status: string;\n}\n\nfunction writeHandoffFile(\n  agentName: string,\n  nextAgent: string,\n  timestamp: string,\n  summary: string,\n  suggestions: string\n): string {\n  const handoffDir = `${getProjectDir()}/.claude/context/handoffs`;\n  try {\n    mkdirSync(handoffDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const dateStr = new Date().toISOString().replace(/[-:]/g, '').substring(0, 15);\n  const handoffFile = `${handoffDir}/${agentName}_to_${nextAgent}_${dateStr}.json`;\n\n  const handoff: HandoffContext = {\n    from_agent: agentName,\n    to_agent: nextAgent,\n    timestamp,\n    summary,\n    suggestions,\n    status: 'ready_for_handoff',\n  };\n\n  try {\n    writeFileSync(handoffFile, JSON.stringify(handoff, null, 2));\n  } catch {\n    // Ignore\n  }\n\n  return handoffFile;\n}\n\nfunction writeLogFile(\n  agentName: string,\n  nextAgent: string,\n  timestamp: string,\n  summary: string,\n  suggestions: string,\n  handoffFile: string\n): void {\n  const logDir = `${getProjectDir()}/.claude/logs/agent-handoffs`;\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const dateStr = new Date().toISOString().replace(/[-:]/g, '').substring(0, 15);\n  const logFile = `${logDir}/${agentName}_${dateStr}.log`;\n\n  const logContent = `=== HANDOFF PREPARATION ===\nFrom: ${agentName}\nTo: ${nextAgent}\nTimestamp: ${timestamp}\nHandoff file: ${handoffFile}\n\nSummary: ${summary}\n\nNext Steps: ${suggestions}\n`;\n\n  try {\n    writeFileSync(logFile, logContent);\n  } catch {\n    // Ignore\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function handoffPreparer(input: HookInput): HookResult {\n  const timestamp = new Date().toISOString();\n\n  const toolInput = input.tool_input || {};\n  const agentName =\n    (toolInput.subagent_type as string) ||\n    input.subagent_type ||\n    input.agent_type ||\n    'unknown';\n\n  // Skip if not a valid pipeline agent\n  if (!VALID_AGENTS.has(agentName)) {\n    // Silent exit for non-pipeline agents (general-purpose, Explore, etc.)\n    return outputSilentSuccess();\n  }\n\n  const nextAgent = getNextAgent(agentName);\n\n  // Extract agent output\n  const agentOutput = input.agent_output || input.output || '';\n\n  // Generate handoff summary\n  const outputLength = agentOutput.length;\n  let summary: string;\n  if (outputLength > 0) {\n    summary = agentOutput.substring(0, 300);\n    if (outputLength > 300) {\n      summary += '...';\n    }\n  } else {\n    summary = `Agent ${agentName} completed`;\n  }\n\n  // Get suggestions\n  const suggestions = getSuggestions(agentName);\n\n  // Create handoff context file\n  const handoffFile = writeHandoffFile(agentName, nextAgent, timestamp, summary, suggestions);\n\n  // Log to file\n  writeLogFile(agentName, nextAgent, timestamp, summary, suggestions, handoffFile);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Multi-Claude Verifier - SubagentStop Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * Purpose:\n * 1. Auto-spawn code-quality-reviewer after test-generator completes\n * 2. Auto-spawn security-auditor on sensitive file changes\n * 3. Enable parallel verification for comprehensive coverage\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { writeFileSync, mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst SENSITIVE_PATTERNS = [\n  '\\\\.env',\n  'auth',\n  'secret',\n  'credential',\n  'password',\n  'token',\n  'api[_-]?key',\n  'jwt',\n  'session',\n  'oauth',\n  'permission',\n  '\\\\.pem$',\n  '\\\\.key$',\n  'config.*prod',\n];\n\n// -----------------------------------------------------------------------------\n// Path Helpers\n// -----------------------------------------------------------------------------\n\nfunction getLogDir(): string {\n  const logDir = `${getProjectDir()}/.claude/logs/multi-claude`;\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n  return logDir;\n}\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction logAction(agentName: string, action: string, details: string): void {\n  const logDir = getLogDir();\n  const date = new Date().toISOString().substring(0, 10).replace(/-/g, '');\n  const logFile = `${logDir}/verifier_${date}.log`;\n  const timestamp = new Date().toISOString();\n\n  try {\n    appendFileSync(logFile, `[${timestamp}] [${agentName}] ${action}: ${details}\\n`);\n  } catch {\n    // Ignore\n  }\n}\n\nfunction containsSensitiveFiles(output: string): boolean {\n  for (const pattern of SENSITIVE_PATTERNS) {\n    const regex = new RegExp(pattern, 'i');\n    if (regex.test(output)) {\n      return true;\n    }\n  }\n  return false;\n}\n\ninterface VerificationAction {\n  agent: string;\n  reason: string;\n}\n\ninterface VerificationQueue {\n  triggered_by: string;\n  timestamp: string;\n  verifications: Array<{\n    agent: string;\n    reason: string;\n    status: string;\n  }>;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function multiClaudeVerifier(input: HookInput): HookResult {\n  const timestamp = new Date().toISOString();\n  const projectDir = getProjectDir();\n\n  const toolInput = input.tool_input || {};\n  const agentName =\n    (toolInput.subagent_type as string) ||\n    input.subagent_type ||\n    input.agent_type ||\n    'unknown';\n  const agentOutput = input.agent_output || input.output || '';\n\n  const verificationActions: VerificationAction[] = [];\n\n  // Rule 1: After test-generator, spawn code-quality-reviewer\n  if (agentName === 'test-generator') {\n    verificationActions.push({\n      agent: 'code-quality-reviewer',\n      reason: 'Test generation complete - quality review recommended',\n    });\n    logAction(agentName, 'TRIGGER', 'test-generator completion triggers code-quality-reviewer');\n  }\n\n  // Rule 2: After frontend-ui-developer with form/auth components, spawn security review\n  if (agentName === 'frontend-ui-developer') {\n    if (/form|input|validation|submit|auth|login/i.test(agentOutput)) {\n      verificationActions.push({\n        agent: 'security-auditor',\n        reason: 'Frontend auth/form components - security review recommended',\n      });\n      logAction(agentName, 'TRIGGER', 'frontend auth components trigger security-auditor');\n    }\n  }\n\n  // Rule 3: After backend-system-architect with API endpoints, spawn security review\n  if (agentName === 'backend-system-architect') {\n    if (/endpoint|route|api|auth|jwt|session/i.test(agentOutput)) {\n      verificationActions.push({\n        agent: 'security-auditor',\n        reason: 'Backend API endpoints - security review recommended',\n      });\n      logAction(agentName, 'TRIGGER', 'backend API endpoints trigger security-auditor');\n    }\n  }\n\n  // Rule 4: Any agent touching sensitive files triggers security-auditor\n  if (containsSensitiveFiles(agentOutput)) {\n    // Avoid duplicate\n    const hasSecurityAuditor = verificationActions.some((v) => v.agent === 'security-auditor');\n    if (!hasSecurityAuditor) {\n      verificationActions.push({\n        agent: 'security-auditor',\n        reason: 'Sensitive files modified - security review required',\n      });\n      logAction(agentName, 'TRIGGER', 'sensitive file patterns detected');\n    }\n  }\n\n  // Rule 5: After database-engineer with schema changes, spawn code-quality-reviewer\n  if (agentName === 'database-engineer') {\n    verificationActions.push({\n      agent: 'code-quality-reviewer',\n      reason: 'Database schema changes - review for consistency',\n    });\n    logAction(agentName, 'TRIGGER', 'database changes trigger code-quality-reviewer');\n  }\n\n  // Rule 6: After workflow-architect, spawn security-layer-auditor\n  if (agentName === 'workflow-architect') {\n    verificationActions.push({\n      agent: 'security-layer-auditor',\n      reason: 'LangGraph workflow created - layer audit recommended',\n    });\n    logAction(agentName, 'TRIGGER', 'workflow-architect triggers security-layer-auditor');\n  }\n\n  // Create verification queue file for orchestrator to pick up\n  if (verificationActions.length > 0) {\n    const queueDir = `${projectDir}/.claude/context/verification-queue`;\n    try {\n      mkdirSync(queueDir, { recursive: true });\n    } catch {\n      // Ignore\n    }\n\n    const dateStr = new Date().toISOString().replace(/[-:]/g, '').substring(0, 15);\n    const queueFile = `${queueDir}/pending_${dateStr}_${agentName}.json`;\n\n    const verificationsQueue: VerificationQueue = {\n      triggered_by: agentName,\n      timestamp,\n      verifications: verificationActions.map((v) => ({\n        agent: v.agent,\n        reason: v.reason,\n        status: 'pending',\n      })),\n    };\n\n    try {\n      writeFileSync(queueFile, JSON.stringify(verificationsQueue, null, 2));\n    } catch {\n      // Ignore\n    }\n\n    // Create system message with recommendations\n    const recommendationMsg =\n      'Multi-Claude Verification Triggered: ' +\n      verificationActions.map((v) => `${v.agent} (${v.reason})`).join('; ');\n\n    logAction(agentName, 'QUEUE', `Created verification queue: ${queueFile}`);\n\n    return {\n      continue: true,\n      systemMessage: recommendationMsg,\n    };\n  }\n\n  logAction(agentName, 'SKIP', 'No verification triggers matched');\n  return outputSilentSuccess();\n}\n", "/**\n * Output Validator - SubagentStop Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * Validates agent output quality and completeness.\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Path Helpers\n// -----------------------------------------------------------------------------\n\nfunction getLogDir(): string {\n  const logDir = `${getProjectDir()}/.claude/logs/agent-validation`;\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n  return logDir;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function outputValidator(input: HookInput): HookResult {\n  const agentName = process.env.CLAUDE_AGENT_NAME || 'unknown';\n  const timestamp = new Date().toISOString();\n\n  // Read agent output\n  const output = input.agent_output || input.output || '';\n\n  const validationErrors: string[] = [];\n  const validationWarnings: string[] = [];\n\n  // Check 1: Output is not empty\n  if (!output) {\n    validationErrors.push('Agent produced empty output');\n  }\n\n  // Check 2: Minimum length check\n  const outputLength = output.length;\n  if (outputLength < 50) {\n    validationWarnings.push(`Output seems very short (${outputLength} chars)`);\n  }\n\n  // Check 3: Check for common error patterns\n  if (/error|failed|exception/i.test(output)) {\n    validationWarnings.push('Output contains error-related keywords');\n  }\n\n  // Check 4: For backend architect, validate JSON structure if present\n  if (agentName === 'backend-system-architect') {\n    if (output.includes('{')) {\n      // Try to extract and validate JSON\n      const jsonMatch = output.match(/\\{[^}]*\\}/);\n      if (jsonMatch) {\n        try {\n          JSON.parse(jsonMatch[0]);\n        } catch {\n          validationWarnings.push('JSON structure may be malformed');\n        }\n      }\n    }\n  }\n\n  // Build validation result\n  const validationStatus = validationErrors.length > 0 ? 'failed' : 'passed';\n\n  // Create system message\n  let systemMessage = `Output Validation [${validationStatus}] - Agent: ${agentName}, Timestamp: ${timestamp}, Output length: ${outputLength} chars`;\n\n  if (validationErrors.length > 0) {\n    systemMessage += ' | Errors: ' + validationErrors.join('; ');\n  }\n\n  if (validationWarnings.length > 0) {\n    systemMessage += ' | Warnings: ' + validationWarnings.join('; ');\n  }\n\n  // Log to file\n  const logDir = getLogDir();\n  const dateStr = new Date().toISOString().replace(/[-:]/g, '').substring(0, 15);\n  const logFile = `${logDir}/${agentName}_${dateStr}.log`;\n\n  const logContent = `=== OUTPUT VALIDATION ===\n${systemMessage}\n\n=== AGENT OUTPUT ===\n${output}\n`;\n\n  try {\n    writeFileSync(logFile, logContent);\n  } catch {\n    // Ignore\n  }\n\n  // CC 2.1.7 compliant output\n  if (validationStatus === 'failed') {\n    return {\n      continue: false,\n      systemMessage,\n      hookSpecificOutput: {\n        hookEventName: 'SubagentStop' as any,\n      },\n    };\n  }\n\n  // Silent success for passed validation\n  return {\n    continue: true,\n    suppressOutput: true,\n    systemMessage,\n  };\n}\n", "/**\n * Subagent Quality Gate - SubagentStop Hook\n * CC 2.1.7 Compliant: includes continue field in all outputs\n *\n * Validates subagent output quality.\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { existsSync, writeFileSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWarning, logHook } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst METRICS_FILE = '/tmp/claude-session-metrics.json';\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\ninterface Metrics {\n  errors: number;\n  [key: string]: unknown;\n}\n\nfunction incrementErrorCount(): void {\n  if (!existsSync(METRICS_FILE)) {\n    return;\n  }\n\n  try {\n    const metrics: Metrics = JSON.parse(readFileSync(METRICS_FILE, 'utf8'));\n    metrics.errors = (metrics.errors || 0) + 1;\n    writeFileSync(METRICS_FILE, JSON.stringify(metrics, null, 2));\n  } catch {\n    // Ignore\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function subagentQualityGate(input: HookInput): HookResult {\n  const agentId = input.agent_id || '';\n  const subagentType = input.subagent_type || '';\n  const error = input.error || '';\n\n  logHook('subagent-quality-gate', `Quality gate check: ${subagentType} (${agentId})`);\n\n  // Check if subagent had errors\n  if (error && error !== 'null') {\n    logHook('subagent-quality-gate', `ERROR: Subagent failed - ${error}`);\n\n    // Track error count\n    incrementErrorCount();\n\n    return outputWarning(`Subagent ${subagentType} failed: ${error}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Task Completer - SubagentStop Hook for CC 2.1.16 Task Integration\n * Issue #197: Agent Orchestration Layer\n *\n * Handles agent completion for task management:\n * 1. Marks associated task as completed (or failed)\n * 2. Checks for newly unblocked tasks\n * 3. Handles pipeline progression\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWithContext, logHook } from '../lib/common.js';\nimport {\n  getTaskByAgent,\n  updateTaskStatus,\n  getPipelineTasks,\n  completePipelineStep,\n  formatTaskUpdateForClaude,\n  getTasksBlockedBy,\n  formatTaskDeleteForClaude,\n} from '../lib/task-integration.js';\nimport { updateAgentStatus, removeAgent } from '../lib/orchestration-state.js';\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\n/**\n * Determine if agent completed successfully\n */\nfunction isSuccessfulCompletion(input: HookInput): boolean {\n  const error = input.error || input.tool_error;\n  const exitCode = input.exit_code;\n\n  // Explicit error\n  if (error && error !== 'null' && error !== '') {\n    return false;\n  }\n\n  // Non-zero exit code\n  if (exitCode !== undefined && exitCode !== 0) {\n    return false;\n  }\n\n  // Check for error patterns in output\n  const output = input.agent_output || input.output || '';\n  const errorPatterns = [\n    /\\bfailed\\b/i,\n    /\\berror:\\s/i,\n    /\\bexception\\b/i,\n    /\\bcould not\\b/i,\n    /\\bunable to\\b/i,\n  ];\n\n  // Only check first 500 chars to avoid false positives in long outputs\n  const outputSample = output.slice(0, 500);\n  for (const pattern of errorPatterns) {\n    if (pattern.test(outputSample)) {\n      // Weak signal - don't treat as failure unless explicit error\n      logHook('task-completer', `Warning: possible error in output: ${pattern}`);\n    }\n  }\n\n  return true;\n}\n\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Task completer hook - handles agent completion for task management\n *\n * When an agent completes, this hook:\n * 1. Finds the associated task\n * 2. Marks it completed or failed based on outcome\n * 3. For pipelines, checks for newly unblocked tasks\n * 4. Outputs instructions for next steps\n */\nexport function taskCompleter(input: HookInput): HookResult {\n  // Get agent type from input\n  const toolInput = input.tool_input || {};\n  const agentType =\n    (toolInput.subagent_type as string) ||\n    input.subagent_type ||\n    input.agent_type ||\n    '';\n\n  if (!agentType) {\n    logHook('task-completer', 'No agent type found, skipping');\n    return outputSilentSuccess();\n  }\n\n  logHook('task-completer', `Processing SubagentStop for: ${agentType}`);\n\n  // Look up task for this agent\n  const task = getTaskByAgent(agentType);\n\n  if (!task) {\n    logHook('task-completer', `No orchestration task found for agent: ${agentType}`);\n    // Still clean up agent state\n    removeAgent(agentType);\n    return outputSilentSuccess();\n  }\n\n  // Determine outcome\n  const success = isSuccessfulCompletion(input);\n  const newStatus = success ? 'completed' : 'failed';\n\n  logHook('task-completer', `Agent ${agentType} completed with status: ${newStatus}`);\n\n  // Update task status\n  updateTaskStatus(task.taskId, newStatus);\n\n  // Update orchestration state\n  updateAgentStatus(agentType, newStatus);\n\n  // Handle pipeline progression\n  let contextMessage = `## Orchestration: Task ${success ? 'Completed' : 'Failed'}\n\nAgent \\`${agentType}\\` has finished with status: **${newStatus}**\n\n${formatTaskUpdateForClaude({\n    taskId: task.taskId,\n    status: success ? 'completed' : 'pending', // CC 2.1.16 tasks don't have 'failed' status\n  })}\n`;\n\n  // Check for pipeline progression\n  if (success && task.pipelineId && task.pipelineStep !== undefined) {\n    const nextStep = completePipelineStep(task.pipelineId, task.pipelineStep);\n\n    if (nextStep !== null) {\n      const nextTasks = getPipelineTasks(task.pipelineId).filter(\n        t => t.pipelineStep === nextStep && t.status === 'pending'\n      );\n\n      if (nextTasks.length > 0) {\n        contextMessage += `\n### Pipeline Progress\n\nPipeline \\`${task.pipelineId}\\` step ${task.pipelineStep} complete.\nNext step (${nextStep}) is now unblocked.\n\n**Next agent(s) to spawn:**\n${nextTasks.map(t => `- \\`${t.agent}\\` (task: ${t.taskId})`).join('\\n')}\n\nConsider spawning the next agent to continue the pipeline.`;\n      }\n    } else {\n      // Pipeline complete\n      contextMessage += `\n### Pipeline Complete\n\nPipeline \\`${task.pipelineId}\\` has completed all steps.`;\n    }\n  }\n\n  // Handle failure\n  if (!success) {\n    const error = input.error || input.tool_error || 'Unknown error';\n    contextMessage += `\n### Error Details\n\nThe agent encountered an issue:\n\\`\\`\\`\n${error.slice(0, 500)}\n\\`\\`\\`\n\nConsider:\n1. Retrying with more specific instructions\n2. Using an alternative agent\n3. Breaking down the task further`;\n\n    // CC 2.1.20: Clean up orphaned tasks blocked by this failed task\n    const orphanedTasks = getTasksBlockedBy(task.taskId);\n    if (orphanedTasks.length > 0) {\n      contextMessage += `\\n\\n### Orphaned Tasks (CC 2.1.20)\\n\\nThe following tasks were blocked by the failed task and should be deleted:\\n`;\n      for (const orphan of orphanedTasks) {\n        contextMessage += `\\n${formatTaskDeleteForClaude(orphan.taskId, `Blocked by failed task ${task.taskId} (agent: ${agentType})`)}`;\n        updateTaskStatus(orphan.taskId, 'failed');\n      }\n    }\n  }\n\n  // Clean up agent tracking if complete\n  if (newStatus === 'completed') {\n    removeAgent(agentType);\n  }\n\n  logHook('task-completer', `Completed task ${task.taskId} with status ${newStatus}`);\n\n  return outputWithContext(contextMessage);\n}\n", "/**\n * Retry Handler - SubagentStop Hook for Failed Agent Retry Logic\n * Issue #197: Agent Orchestration Layer\n *\n * Handles agent failures by:\n * 1. Evaluating if retry is appropriate\n * 2. Suggesting alternative agents when needed\n * 3. Tracking retry history\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputWithContext, logHook } from '../lib/common.js';\nimport {\n  makeRetryDecision,\n  formatRetryDecision,\n  createAttempt,\n  completeAttempt,\n} from '../lib/retry-manager.js';\nimport { loadConfig, loadState, updateAgentStatus } from '../lib/orchestration-state.js';\nimport { updateTaskStatus, getTaskByAgent } from '../lib/task-integration.js';\nimport type { AgentOutcome, ExecutionAttempt } from '../lib/orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// Execution History Storage\n// -----------------------------------------------------------------------------\n\n/** In-memory execution history (per session) */\nconst executionHistory: Map<string, ExecutionAttempt[]> = new Map();\n\n/**\n * Add attempt to history\n */\nfunction addToHistory(agent: string, attempt: ExecutionAttempt): void {\n  const history = executionHistory.get(agent) || [];\n  history.push(attempt);\n  // Keep only last 10 attempts per agent\n  if (history.length > 10) {\n    history.shift();\n  }\n  executionHistory.set(agent, history);\n}\n\n/**\n * Get tried agents (those with failed attempts)\n */\nfunction getTriedAgents(): string[] {\n  const tried: string[] = [];\n  for (const [agent, attempts] of executionHistory) {\n    if (attempts.some(a => a.outcome === 'failure')) {\n      tried.push(agent);\n    }\n  }\n  return tried;\n}\n\n// -----------------------------------------------------------------------------\n// Outcome Detection\n// -----------------------------------------------------------------------------\n\n/**\n * Detect outcome from hook input\n */\nfunction detectOutcome(input: HookInput): { outcome: AgentOutcome; error?: string } {\n  const error = input.error || input.tool_error;\n  const exitCode = input.exit_code;\n  const output = input.agent_output || input.output || '';\n\n  // Explicit error\n  if (error && error !== 'null' && error !== '') {\n    return { outcome: 'failure', error };\n  }\n\n  // Non-zero exit code\n  if (exitCode !== undefined && exitCode !== 0) {\n    return { outcome: 'failure', error: `Exit code: ${exitCode}` };\n  }\n\n  // Check output for rejection patterns\n  const rejectionPatterns = [\n    /i cannot|i can't|i am unable/i,\n    /outside my scope/i,\n    /not appropriate/i,\n    /i refuse/i,\n  ];\n\n  for (const pattern of rejectionPatterns) {\n    if (pattern.test(output.slice(0, 500))) {\n      return { outcome: 'rejected', error: 'Agent rejected the task' };\n    }\n  }\n\n  // Check for partial success patterns\n  const partialPatterns = [\n    /partial(?:ly)?/i,\n    /incomplete/i,\n    /some.*failed/i,\n    /couldn't finish/i,\n  ];\n\n  for (const pattern of partialPatterns) {\n    if (pattern.test(output.slice(0, 500))) {\n      return { outcome: 'partial' };\n    }\n  }\n\n  return { outcome: 'success' };\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Retry handler hook - handles agent failures and retry decisions\n *\n * When an agent fails, this hook:\n * 1. Records the attempt in history\n * 2. Evaluates whether to retry\n * 3. Suggests alternatives if retry not recommended\n */\nexport function retryHandler(input: HookInput): HookResult {\n  // Get agent type\n  const toolInput = input.tool_input || {};\n  const agentType =\n    (toolInput.subagent_type as string) ||\n    input.subagent_type ||\n    input.agent_type ||\n    '';\n\n  if (!agentType) {\n    return outputSilentSuccess();\n  }\n\n  // Detect outcome\n  const { outcome, error } = detectOutcome(input);\n\n  // Skip retry logic for successful completions\n  if (outcome === 'success') {\n    return outputSilentSuccess();\n  }\n\n  logHook('retry-handler', `Agent ${agentType} completed with outcome: ${outcome}`);\n\n  // Load config and state\n  const config = loadConfig();\n  const state = loadState();\n\n  // Find dispatched agent in state\n  const dispatchedAgent = state.activeAgents.find(a => a.agent === agentType);\n  const currentRetryCount = dispatchedAgent?.retryCount || 0;\n\n  // Record attempt\n  const attempt = createAttempt(agentType, currentRetryCount + 1, dispatchedAgent?.taskId);\n  const completedAttempt = completeAttempt(\n    attempt,\n    outcome,\n    error || undefined\n  );\n  addToHistory(agentType, completedAttempt);\n\n  // Get tried agents for alternative suggestions\n  const triedAgents = getTriedAgents();\n\n  // Make retry decision\n  const decision = makeRetryDecision(\n    agentType,\n    currentRetryCount + 1,\n    error || 'Unknown failure',\n    triedAgents,\n    config.maxRetries\n  );\n\n  logHook(\n    'retry-handler',\n    `Retry decision for ${agentType}: shouldRetry=${decision.shouldRetry}, ` +\n    `alternative=${decision.alternativeAgent || 'none'}`\n  );\n\n  // Update agent status based on decision\n  if (decision.shouldRetry) {\n    updateAgentStatus(agentType, 'retrying');\n  } else {\n    updateAgentStatus(agentType, 'failed');\n\n    // Update task status if exists\n    const task = getTaskByAgent(agentType);\n    if (task) {\n      updateTaskStatus(task.taskId, 'failed');\n    }\n  }\n\n  // Format message for user\n  const message = formatRetryDecision(decision, agentType);\n\n  return outputWithContext(message);\n}\n", "/**\n * Desktop Notifications - Notification Hook\n * CC 2.1.7 Compliant: Outputs proper JSON with suppressOutput\n *\n * Sends rich desktop notifications with context (repo, branch, task).\n * Uses native osascript title/subtitle/message - no external deps.\n *\n * Version: 2.0.0\n */\n\nimport { execSync } from 'node:child_process';\nimport { basename } from 'node:path';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir, getCachedBranch } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst SOUNDS: Record<string, string> = {\n  permission_prompt: 'Sosumi',  // Attention-grabbing\n  idle_prompt: 'Ping',          // Gentle\n  default: 'Ping',\n};\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction escapeForAppleScript(str: string): string {\n  return str.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n}\n\nfunction hasCommand(command: string): boolean {\n  try {\n    execSync(`command -v ${command}`, { stdio: 'ignore' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Extract issue number from branch name (e.g., feature/235-foo \u2192 #235)\n */\nfunction extractIssueFromBranch(branch: string): string | null {\n  const match = branch.match(/(?:feature|fix|bug|issue)[/-](\\d+)/i);\n  return match ? `#${match[1]}` : null;\n}\n\n/**\n * Get repo name from project directory\n */\nfunction getRepoName(): string {\n  try {\n    const projectDir = getProjectDir();\n    return basename(projectDir);\n  } catch {\n    return 'Claude Code';\n  }\n}\n\n/**\n * Build subtitle with branch and optional issue number\n */\nfunction buildSubtitle(branch: string, notificationType: string): string {\n  const issue = extractIssueFromBranch(branch);\n  const typeLabel = notificationType === 'permission_prompt' ? '\u23F8 Permission needed' : '\uD83D\uDCA4 Waiting';\n\n  if (issue) {\n    return `${typeLabel} \u00B7 ${issue} \u00B7 ${branch}`;\n  }\n  return `${typeLabel} \u00B7 ${branch}`;\n}\n\n/**\n * Truncate message to fit notification (keep it readable)\n */\nfunction truncateMessage(message: string, maxLen = 120): string {\n  if (message.length <= maxLen) return message;\n  return message.substring(0, maxLen - 3) + '...';\n}\n\n/**\n * Send macOS notification with title, subtitle, and message\n */\nfunction sendMacNotification(\n  title: string,\n  subtitle: string,\n  message: string,\n  sound: string\n): boolean {\n  try {\n    const t = escapeForAppleScript(title);\n    const s = escapeForAppleScript(subtitle);\n    const m = escapeForAppleScript(truncateMessage(message));\n\n    execSync(\n      `osascript -e 'display notification \"${m}\" with title \"${t}\" subtitle \"${s}\" sound name \"${sound}\"'`,\n      { stdio: 'ignore', timeout: 5000 }\n    );\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Send Linux notification (simpler, no subtitle support)\n */\nfunction sendLinuxNotification(title: string, subtitle: string, message: string): boolean {\n  try {\n    const fullMessage = `${subtitle}\\n${message}`;\n    execSync(`notify-send -- \"${title}\" \"${fullMessage}\"`, { stdio: 'ignore', timeout: 5000 });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function desktopNotification(input: HookInput): HookResult {\n  const toolInput = input.tool_input || {};\n  const message = (toolInput.message as string) || input.message || '';\n  const notificationType = (toolInput.notification_type as string) || input.notification_type || '';\n\n  logHook('desktop', `Notification: [${notificationType}] ${message.substring(0, 100)}`);\n\n  // Only show for permission prompts and idle prompts\n  if (notificationType !== 'permission_prompt' && notificationType !== 'idle_prompt') {\n    return outputSilentSuccess();\n  }\n\n  // Build rich notification content\n  const repoName = getRepoName();\n  const branch = getCachedBranch();\n  const subtitle = buildSubtitle(branch, notificationType);\n  const sound = SOUNDS[notificationType] || SOUNDS.default;\n\n  // Send platform-appropriate notification\n  if (hasCommand('osascript')) {\n    sendMacNotification(repoName, subtitle, message, sound);\n  } else if (hasCommand('notify-send')) {\n    sendLinuxNotification(repoName, subtitle, message);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Sound Notifications - Notification Hook\n * CC 2.1.7 Compliant: outputs JSON with suppressOutput\n *\n * Plays sounds for task completion.\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst SOUND_MAP: Record<string, string> = {\n  permission_prompt: '/System/Library/Sounds/Sosumi.aiff',\n  idle_prompt: '/System/Library/Sounds/Ping.aiff',\n  auth_success: '/System/Library/Sounds/Glass.aiff',\n};\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction hasAfplay(): boolean {\n  try {\n    execSync('command -v afplay', { stdio: 'ignore' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction playSound(soundFile: string): void {\n  try {\n    // Run in background (non-blocking)\n    execSync(`afplay \"${soundFile}\" &`, { stdio: 'ignore' });\n  } catch {\n    // Ignore errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function soundNotification(input: HookInput): HookResult {\n  const toolInput = input.tool_input || {};\n  const notificationType = (toolInput.notification_type as string) || '';\n\n  logHook('sound', `Sound notification check: [${notificationType}]`);\n\n  // Play sound based on notification_type (macOS only)\n  if (hasAfplay()) {\n    const soundFile = SOUND_MAP[notificationType];\n    if (soundFile) {\n      playSound(soundFile);\n    }\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Auto-Remember Continuity - Stop Hook\n * Prompts Claude to store session context before end\n *\n * Graph-First Architecture (v2.1):\n * - ALWAYS works - knowledge graph requires no configuration\n * - Primary: Store in knowledge graph (mcp__memory__*)\n * - Optional: Also sync to mem0 cloud if configured\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir } from '../lib/common.js';\n\n/**\n * Generate stop prompt for session continuity\n */\nexport function autoRememberContinuity(input: HookInput): HookResult {\n  logHook('auto-remember-continuity', 'Hook triggered');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const projectId = projectDir.split('/').pop() || 'project';\n\n  // Check if mem0 is available (by checking env var)\n  const mem0Available = !!process.env.MEM0_API_KEY;\n  const mem0Hint = mem0Available\n    ? '\\n   [Optional] Also sync to mem0 cloud with `--mem0` flag for semantic search'\n    : '';\n\n  const promptMsg = `Before ending this session, consider preserving important context in the knowledge graph:\n\n1. **Session Continuity** - If there's unfinished work or next steps:\n   \\`mcp__memory__create_entities\\` with:\n   \\`\\`\\`json\n   {\"entities\": [{\n     \"name\": \"session-${projectId}\",\n     \"entityType\": \"Session\",\n     \"observations\": [\"What was done: [...]\", \"Next steps: [...]\"]\n   }]}\n   \\`\\`\\`${mem0Hint}\n\n2. **Important Decisions** - If architectural/design decisions were made:\n   \\`mcp__memory__create_entities\\` with:\n   \\`\\`\\`json\n   {\"entities\": [{\n     \"name\": \"decision-[topic]\",\n     \"entityType\": \"Decision\",\n     \"observations\": [\"Decided: [...]\", \"Rationale: [...]\"]\n   }]}\n   \\`\\`\\`\n\n3. **Patterns Learned** - If something worked well or failed:\n   - Use \\`/remember --success \"pattern that worked\"\\`\n   - Use \\`/remember --failed \"pattern that caused issues\"\\`\n\nSkip if this was just a quick question/answer session.`;\n\n  logHook('auto-remember-continuity', 'Outputting memory prompt for session end');\n\n  return {\n    continue: true,\n    suppressOutput: true,\n    // Note: stopPrompt is handled by the CC runtime, we just return continue: true\n  };\n}\n", "/**\n * Auto-Save Context - Saves session context before stop\n * Hook: Stop\n * CC 2.1.6 Compliant - Context Protocol 2.0\n *\n * Ensures state.json always has required fields:\n * - $schema: For schema validation\n * - _meta: For attention positioning and token budgets\n */\n\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionState {\n  $schema: string;\n  _meta: {\n    position: string;\n    token_budget: number;\n    auto_load: string;\n    compress: string;\n    description: string;\n  };\n  session_id: string | null;\n  started: string | null;\n  last_activity: string;\n  current_task: {\n    description: string;\n    status: string;\n  };\n  next_steps: string[];\n  blockers: string[];\n}\n\n/**\n * Auto-save context on session stop\n */\nexport function autoSaveContext(input: HookInput): HookResult {\n  logHook('auto-save-context', 'Stop hook - auto-saving context (Protocol 2.0)');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionDir = `${projectDir}/.claude/context/session`;\n  const sessionState = `${sessionDir}/state.json`;\n\n  // Ensure session directory exists\n  try {\n    if (!existsSync(sessionDir)) {\n      mkdirSync(sessionDir, { recursive: true });\n    }\n  } catch {\n    // Ignore directory creation errors\n  }\n\n  const timestamp = new Date().toISOString();\n\n  try {\n    if (existsSync(sessionState)) {\n      // Update existing session state\n      const content = readFileSync(sessionState, 'utf-8');\n      const state: Partial<SessionState> = JSON.parse(content);\n\n      // Ensure required fields exist\n      const updated: SessionState = {\n        $schema: state.$schema || 'context://session/v1',\n        _meta: state._meta || {\n          position: 'END',\n          token_budget: 500,\n          auto_load: 'always',\n          compress: 'on_threshold',\n          description: 'Session state and progress - ALWAYS loaded at END of context',\n        },\n        session_id: state.session_id || null,\n        started: state.started || null,\n        last_activity: timestamp,\n        current_task: state.current_task || { description: 'No active task', status: 'pending' },\n        next_steps: state.next_steps || [],\n        blockers: state.blockers || [],\n      };\n\n      writeFileSync(sessionState, JSON.stringify(updated, null, 2));\n      logHook('auto-save-context', 'Updated session state timestamp');\n    } else {\n      // Create new session state\n      const newState: SessionState = {\n        $schema: 'context://session/v1',\n        _meta: {\n          position: 'END',\n          token_budget: 500,\n          auto_load: 'always',\n          compress: 'on_threshold',\n          description: 'Session state and progress - ALWAYS loaded at END of context',\n        },\n        session_id: null,\n        started: timestamp,\n        last_activity: timestamp,\n        current_task: {\n          description: 'No active task',\n          status: 'pending',\n        },\n        next_steps: [],\n        blockers: [],\n      };\n\n      writeFileSync(sessionState, JSON.stringify(newState, null, 2));\n      logHook('auto-save-context', 'Created new session state (Protocol 2.0 compliant)');\n    }\n  } catch (error) {\n    logHook('auto-save-context', `Error saving context: ${error}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Cleanup Instance - Stop Hook\n * Releases all locks and unregisters instance when Claude Code exits\n * CC 2.1.6 Compliant\n *\n * Part of Multi-Worktree Coordination System\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Get instance ID from identity file\n */\nfunction getInstanceId(projectDir: string): string | null {\n  const idFile = `${projectDir}/.instance/id.json`;\n  try {\n    if (!existsSync(idFile)) {\n      return null;\n    }\n    const content = JSON.parse(readFileSync(idFile, 'utf-8'));\n    return content.instance_id || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Execute SQLite command\n */\nfunction runSqlite(dbPath: string, sql: string): void {\n  try {\n    execSync(`sqlite3 \"${dbPath}\" \"${sql}\"`, {\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n  } catch {\n    // Ignore SQLite errors\n  }\n}\n\n/**\n * Cleanup instance on stop\n */\nexport function cleanupInstance(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  // Check if coordination is enabled\n  if (!existsSync(dbPath)) {\n    logHook('cleanup-instance', 'No coordination database, skipping cleanup');\n    return outputSilentSuccess();\n  }\n\n  // Get instance ID\n  const instanceId = getInstanceId(projectDir);\n  if (!instanceId) {\n    logHook('cleanup-instance', 'No instance ID to clean up');\n    return outputSilentSuccess();\n  }\n\n  logHook('cleanup-instance', `Cleaning up instance: ${instanceId}`);\n\n  // Release all locks held by this instance\n  logHook('cleanup-instance', 'Releasing all locks...');\n  runSqlite(dbPath, `DELETE FROM file_locks WHERE instance_id = '${instanceId}';`);\n  logHook('cleanup-instance', 'All locks released');\n\n  // Handle work claims if table exists\n  try {\n    const hasTable = execSync(\n      `sqlite3 \"${dbPath}\" \"SELECT count(*) FROM sqlite_master WHERE type='table' AND name='work_claims';\"`,\n      { encoding: 'utf8', timeout: 5000 }\n    ).trim();\n\n    if (hasTable === '1') {\n      runSqlite(\n        dbPath,\n        `UPDATE work_claims SET status = 'abandoned', completed_at = datetime('now') WHERE instance_id = '${instanceId}' AND status = 'active';`\n      );\n      logHook('cleanup-instance', 'Work claims handled');\n    }\n  } catch {\n    // Ignore table check errors\n  }\n\n  // Update instance status if table exists\n  try {\n    const hasTable = execSync(\n      `sqlite3 \"${dbPath}\" \"SELECT count(*) FROM sqlite_master WHERE type='table' AND name='instances';\"`,\n      { encoding: 'utf8', timeout: 5000 }\n    ).trim();\n\n    if (hasTable === '1') {\n      runSqlite(\n        dbPath,\n        `UPDATE instances SET status = 'terminated', last_heartbeat = datetime('now') WHERE id = '${instanceId}';`\n      );\n      logHook('cleanup-instance', 'Instance status updated to terminated');\n    }\n  } catch {\n    // Ignore table check errors\n  }\n\n  logHook('cleanup-instance', 'Multi-instance cleanup completed');\n  return outputSilentSuccess();\n}\n", "/**\n * Context Compressor - Session End Hook\n * CC 2.1.7 Compliant\n * Compresses and archives context at end of session\n */\n\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\n// Configuration\nconst MAX_ACTIVE_DECISIONS = 10;\n\ninterface SessionState {\n  session_id?: string;\n  [key: string]: unknown;\n}\n\ninterface DecisionsFile {\n  decisions: unknown[];\n  [key: string]: unknown;\n}\n\n/**\n * Archive current session\n */\nfunction archiveSession(contextDir: string): void {\n  const sessionFile = `${contextDir}/session/state.json`;\n  if (!existsSync(sessionFile)) {\n    logHook('context-compressor', 'No session state to archive');\n    return;\n  }\n\n  try {\n    const content = readFileSync(sessionFile, 'utf-8');\n    const session: SessionState = JSON.parse(content);\n\n    const sessionId = session.session_id || `session-${new Date().toISOString().replace(/[:.]/g, '-')}`;\n    const archiveDir = `${contextDir}/archive/sessions`;\n    mkdirSync(archiveDir, { recursive: true });\n\n    const archiveFile = `${archiveDir}/${sessionId}.json`;\n    const archived = {\n      ...session,\n      ended: new Date().toISOString(),\n      archived: true,\n    };\n\n    writeFileSync(archiveFile, JSON.stringify(archived, null, 2));\n    logHook('context-compressor', `Archived session to ${archiveFile}`);\n\n    // Reset session state\n    const resetState = {\n      $schema: 'context://session/v1',\n      _meta: { position: 'END', token_budget: 500, auto_load: 'always' },\n      session_id: null,\n      started: null,\n      current_task: null,\n      files_touched: [],\n      decisions_this_session: [],\n      blockers: [],\n      next_steps: [],\n      scratchpad: { notes: [] },\n    };\n\n    writeFileSync(sessionFile, JSON.stringify(resetState, null, 2));\n    logHook('context-compressor', 'Reset session state');\n  } catch (error) {\n    logHook('context-compressor', `Error archiving session: ${error}`);\n  }\n}\n\n/**\n * Compress old decisions\n */\nfunction compressOldDecisions(contextDir: string): void {\n  const decisionsFile = `${contextDir}/knowledge/decisions/active.json`;\n  if (!existsSync(decisionsFile)) {\n    return;\n  }\n\n  try {\n    const content = readFileSync(decisionsFile, 'utf-8');\n    const data: DecisionsFile = JSON.parse(content);\n    const decisions = data.decisions || [];\n\n    if (decisions.length <= MAX_ACTIVE_DECISIONS) {\n      return;\n    }\n\n    const archiveDir = `${contextDir}/archive/decisions`;\n    mkdirSync(archiveDir, { recursive: true });\n\n    const now = new Date();\n    const archiveFile = `${archiveDir}/${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}.json`;\n\n    // Archive old decisions\n    const toArchive = decisions.slice(0, -MAX_ACTIVE_DECISIONS);\n    writeFileSync(archiveFile, JSON.stringify(toArchive, null, 2));\n\n    // Keep only recent decisions\n    data.decisions = decisions.slice(-MAX_ACTIVE_DECISIONS);\n    writeFileSync(decisionsFile, JSON.stringify(data, null, 2));\n\n    logHook('context-compressor', `Archived ${toArchive.length} old decisions`);\n  } catch (error) {\n    logHook('context-compressor', `Error compressing decisions: ${error}`);\n  }\n}\n\n/**\n * Write compaction manifest for session resume (CC 2.1.20)\n * Provides structured context for session-context-loader to pick up\n */\nfunction writeCompactionManifest(contextDir: string): void {\n  const sessionFile = `${contextDir}/session/state.json`;\n  if (!existsSync(sessionFile)) {\n    return;\n  }\n\n  try {\n    const content = readFileSync(sessionFile, 'utf-8');\n    const session = JSON.parse(content);\n\n    const manifest = {\n      sessionId: session.session_id || 'unknown',\n      compactedAt: new Date().toISOString(),\n      keyDecisions: (session.decisions_this_session || []).slice(-5),\n      filesTouched: (session.files_touched || []).slice(-20),\n      blockers: session.blockers || [],\n      nextSteps: session.next_steps || [],\n    };\n\n    const manifestDir = `${contextDir}/session`;\n    mkdirSync(manifestDir, { recursive: true });\n    writeFileSync(`${manifestDir}/compaction-manifest.json`, JSON.stringify(manifest, null, 2));\n    logHook('context-compressor', `Wrote compaction manifest for session ${manifest.sessionId}`);\n  } catch (error) {\n    logHook('context-compressor', `Error writing compaction manifest: ${error}`);\n  }\n}\n\n/**\n * Main context compression function\n */\nexport function contextCompressor(input: HookInput): HookResult {\n  logHook('context-compressor', 'Starting end-of-session compression...');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const contextDir = `${projectDir}/context`;\n\n  writeCompactionManifest(contextDir);\n  archiveSession(contextDir);\n  compressOldDecisions(contextDir);\n\n  logHook('context-compressor', 'End-of-session compression complete');\n  return outputSilentSuccess();\n}\n", "/**\n * Full Test Suite Runner - Stop Hook\n * CC 2.1.3 Compliant - Uses 10-minute hook timeout\n *\n * Runs the complete test suite on conversation stop.\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Check if we should run tests\n */\nfunction shouldRunTests(projectDir: string): boolean {\n  const lastRunFile = `${projectDir}/.claude/hooks/logs/.last-test-run`;\n\n  // Always run if no previous run\n  if (!existsSync(lastRunFile)) {\n    return true;\n  }\n\n  // Check if any code files changed since last run\n  try {\n    const result = execSync('git diff --name-only HEAD', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    if (/\\.(py|js|ts|go|rs)$/.test(result)) {\n      return true;\n    }\n  } catch {\n    // On error, run tests anyway\n    return true;\n  }\n\n  logHook('full-test-suite', 'No code changes detected, skipping tests');\n  return false;\n}\n\n/**\n * Detect project type and run appropriate tests\n */\nfunction runTests(projectDir: string, logFile: string): boolean {\n  let exitCode = 0;\n\n  // Python project (pytest)\n  if (\n    existsSync(`${projectDir}/pytest.ini`) ||\n    existsSync(`${projectDir}/pyproject.toml`) ||\n    (existsSync(`${projectDir}/tests`) && existsSync(`${projectDir}/requirements.txt`))\n  ) {\n    logHook('full-test-suite', 'Detected Python project, running pytest...');\n    try {\n      execSync('pytest --tb=short --timeout=300 -q', {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 300000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n    } catch {\n      exitCode = 1;\n    }\n  }\n\n  // Node.js project (npm/yarn/pnpm)\n  if (existsSync(`${projectDir}/package.json`)) {\n    logHook('full-test-suite', 'Detected Node.js project...');\n    try {\n      const packageJson = JSON.parse(readFileSync(`${projectDir}/package.json`, 'utf-8'));\n      if (packageJson.scripts?.test) {\n        logHook('full-test-suite', 'Running npm test...');\n\n        // Try different package managers\n        let cmd = 'npm test -- --passWithNoTests --watchAll=false';\n        try {\n          execSync('which pnpm', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n          cmd = 'pnpm test --passWithNoTests';\n        } catch {\n          try {\n            execSync('which yarn', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n            cmd = 'yarn test --passWithNoTests';\n          } catch {\n            // Use npm\n          }\n        }\n\n        execSync(cmd, {\n          cwd: projectDir,\n          encoding: 'utf8',\n          timeout: 300000,\n          stdio: ['pipe', 'pipe', 'pipe'],\n        });\n      }\n    } catch {\n      exitCode = 1;\n    }\n  }\n\n  // Go project\n  if (existsSync(`${projectDir}/go.mod`)) {\n    logHook('full-test-suite', 'Detected Go project, running go test...');\n    try {\n      execSync('go test -v -timeout 5m ./...', {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 300000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n    } catch {\n      exitCode = 1;\n    }\n  }\n\n  // Rust project\n  if (existsSync(`${projectDir}/Cargo.toml`)) {\n    logHook('full-test-suite', 'Detected Rust project, running cargo test...');\n    try {\n      execSync('cargo test', {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 300000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n    } catch {\n      exitCode = 1;\n    }\n  }\n\n  return exitCode === 0;\n}\n\n/**\n * Full test suite runner\n */\nexport function fullTestSuite(input: HookInput): HookResult {\n  logHook('full-test-suite', '=== Full Test Suite Started ===');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const logDir = `${projectDir}/.claude/hooks/logs`;\n\n  // Ensure log directory exists\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  const logFile = `${logDir}/full-test-suite.log`;\n\n  if (!shouldRunTests(projectDir)) {\n    return outputSilentSuccess();\n  }\n\n  const passed = runTests(projectDir, logFile);\n\n  if (passed) {\n    logHook('full-test-suite', '=== All tests passed ===');\n    // Update last run file\n    try {\n      writeFileSync(`${logDir}/.last-test-run`, String(Date.now()));\n    } catch {\n      // Ignore\n    }\n  } else {\n    logHook('full-test-suite', '=== Some tests failed ===');\n    // Don't block - just log the failure\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Issue Work Summary - Stop Hook\n * Posts consolidated progress comments to GitHub issues\n *\n * CC 2.1.7 Compliant: Uses suppressOutput for silent operation\n */\n\nimport { existsSync, readFileSync, unlinkSync, rmdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface IssueProgress {\n  issues: {\n    [issueNum: string]: {\n      branch: string;\n      commits: Array<{ sha: string; message: string }>;\n      tasks_completed: string[];\n    };\n  };\n}\n\n/**\n * Check if gh CLI is available and authenticated\n */\nfunction isGhAvailable(): boolean {\n  try {\n    execSync('which gh', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    execSync('gh auth status', { encoding: 'utf8', timeout: 5000, stdio: ['pipe', 'pipe', 'pipe'] });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Check if in a GitHub repository\n */\nfunction isGitHubRepo(projectDir: string): boolean {\n  try {\n    const remote = execSync('git remote get-url origin', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return remote.includes('github');\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Generate markdown comment for an issue\n */\nfunction generateComment(issueNum: string, data: IssueProgress['issues'][string], sessionId: string): string {\n  const commits = data.commits || [];\n  if (commits.length === 0) {\n    return '';\n  }\n\n  const commitsSection = commits.map((c) => `- \\`${c.sha}\\`: ${c.message}`).join('\\n');\n  const tasksSection =\n    data.tasks_completed?.length > 0\n      ? `### Sub-tasks Completed\\n${data.tasks_completed.map((t) => `- [x] ${t}`).join('\\n')}`\n      : '';\n\n  return `## Claude Code Progress Update\n\n**Session**: \\`${sessionId.slice(0, 8)}...\\`\n**Branch**: \\`${data.branch || 'unknown'}\\`\n\n### Commits (${commits.length})\n${commitsSection}\n\n${tasksSection}\n---\n*Automated by [OrchestKit](https://github.com/yonatangross/orchestkit)*`;\n}\n\n/**\n * Post comment to GitHub issue\n */\nfunction postComment(issueNum: string, comment: string): boolean {\n  try {\n    execSync(`gh issue comment ${issueNum} --body \"${comment.replace(/\"/g, '\\\\\"')}\"`, {\n      encoding: 'utf8',\n      timeout: 30000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Issue work summary hook\n */\nexport function issueWorkSummary(input: HookInput): HookResult {\n  logHook('issue-work-summary', 'Session ending, checking for issue progress to post...');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionId = input.session_id || getSessionId();\n\n  // Sanitize session ID to prevent path traversal\n  const safeSessionId = sessionId.replace(/[^a-zA-Z0-9_-]/g, '');\n  const sessionDir = `/tmp/claude-session-${safeSessionId}`;\n  const progressFile = `${sessionDir}/issue-progress.json`;\n\n  // Check if progress file exists\n  if (!existsSync(progressFile)) {\n    logHook('issue-work-summary', `No progress file found at ${progressFile}`);\n    return outputSilentSuccess();\n  }\n\n  // Check if gh CLI is available\n  if (!isGhAvailable()) {\n    logHook('issue-work-summary', 'gh CLI not available or not authenticated, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Check if we're in a GitHub repo\n  if (!isGitHubRepo(projectDir)) {\n    logHook('issue-work-summary', 'Not a GitHub repository, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Read progress file\n  let progressJson: IssueProgress;\n  try {\n    progressJson = JSON.parse(readFileSync(progressFile, 'utf-8'));\n  } catch {\n    logHook('issue-work-summary', 'Failed to read progress file');\n    return outputSilentSuccess();\n  }\n\n  const issues = progressJson.issues ? Object.keys(progressJson.issues) : [];\n  if (issues.length === 0) {\n    logHook('issue-work-summary', 'No issues to process');\n    return outputSilentSuccess();\n  }\n\n  // Process each issue\n  let postedCount = 0;\n  for (const issueNum of issues) {\n    const issueData = progressJson.issues[issueNum];\n    const commits = issueData.commits || [];\n\n    if (commits.length === 0) {\n      logHook('issue-work-summary', `No commits for issue #${issueNum}, skipping`);\n      continue;\n    }\n\n    // Verify issue exists\n    try {\n      execSync(`gh issue view ${issueNum} --json number`, {\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n    } catch {\n      logHook('issue-work-summary', `Issue #${issueNum} not found or not accessible, skipping`);\n      continue;\n    }\n\n    // Generate and post comment\n    const comment = generateComment(issueNum, issueData, sessionId);\n    if (comment && postComment(issueNum, comment)) {\n      postedCount++;\n      logHook('issue-work-summary', `Successfully posted comment to issue #${issueNum}`);\n    }\n  }\n\n  logHook('issue-work-summary', `Posted progress comments to ${postedCount} issue(s)`);\n\n  // Clean up progress file\n  try {\n    unlinkSync(progressFile);\n    // Remove session dir if empty\n    try {\n      rmdirSync(sessionDir);\n    } catch {\n      // Directory not empty, leave it\n    }\n    logHook('issue-work-summary', 'Cleaned up progress file');\n  } catch {\n    // Ignore cleanup errors\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Pre-Compaction Sync Hook\n * Prompts Claude to save important session context to Mem0 before compaction\n *\n * Features:\n * - Graph memory support\n * - Pending pattern sync\n * - Session summaries\n * - Batch operations for efficiency\n */\n\nimport { existsSync, readFileSync, mkdirSync, appendFileSync, writeFileSync } from 'node:fs';\nimport { spawn } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getPluginRoot, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Count pending decisions not yet synced\n */\nfunction countPendingDecisions(decisionLog: string, syncState: string): number {\n  if (!existsSync(decisionLog)) {\n    return 0;\n  }\n\n  try {\n    const decisions = JSON.parse(readFileSync(decisionLog, 'utf-8'));\n    const decisionList = decisions.decisions || [];\n\n    if (existsSync(syncState)) {\n      const state = JSON.parse(readFileSync(syncState, 'utf-8'));\n      const syncedIds = state.synced_decisions || [];\n      return decisionList.filter((d: { decision_id: string }) => !syncedIds.includes(d.decision_id)).length;\n    }\n\n    return decisionList.length;\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Count pending patterns\n */\nfunction countPendingPatterns(patternsLog: string): { count: number; patterns: unknown[] } {\n  if (!existsSync(patternsLog)) {\n    return { count: 0, patterns: [] };\n  }\n\n  try {\n    const content = readFileSync(patternsLog, 'utf-8');\n    // Try parsing as JSONL (one object per line) or single JSON\n    let patterns: unknown[];\n    try {\n      patterns = content\n        .split('\\n')\n        .filter((line) => line.trim())\n        .map((line) => JSON.parse(line));\n    } catch {\n      patterns = [JSON.parse(content)];\n    }\n\n    const pending = patterns.filter((p: any) => p.pending_sync === true);\n    return { count: pending.length, patterns: pending };\n  } catch {\n    return { count: 0, patterns: [] };\n  }\n}\n\n/**\n * Get project ID from directory\n */\nfunction getProjectId(projectDir: string): string {\n  return projectDir.split('/').pop() || 'project';\n}\n\n/**\n * Extract session state info\n */\nfunction extractSessionInfo(projectDir: string): {\n  currentTask: string;\n  blockers: string;\n  nextSteps: string;\n} {\n  let currentTask = '';\n  let blockers = '';\n  let nextSteps = '';\n\n  const sessionState = `${projectDir}/.claude/context/session/state.json`;\n  if (existsSync(sessionState)) {\n    try {\n      const state = JSON.parse(readFileSync(sessionState, 'utf-8'));\n      currentTask = state.current_task || state.task || '';\n    } catch {\n      // Ignore\n    }\n  }\n\n  const blockersLog = `${projectDir}/.claude/logs/blockers.jsonl`;\n  if (existsSync(blockersLog)) {\n    try {\n      const content = readFileSync(blockersLog, 'utf-8');\n      const lines = content\n        .split('\\n')\n        .filter((line) => line.trim())\n        .map((line) => JSON.parse(line));\n      const unresolvedBlockers = lines.filter((b) => !b.resolved).slice(-5);\n      blockers = unresolvedBlockers.map((b) => b.description || '').join('; ');\n    } catch {\n      // Ignore\n    }\n  }\n\n  return { currentTask, blockers, nextSteps };\n}\n\n/**\n * Mem0 pre-compaction sync hook\n */\nexport function mem0PreCompactionSync(input: HookInput): HookResult {\n  // Gate: Skip entirely if mem0 is not configured\n  if (!process.env.MEM0_API_KEY) {\n    logHook('mem0-pre-compaction-sync', 'Mem0 not configured (no MEM0_API_KEY), skipping');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const pluginRoot = getPluginRoot();\n\n  const decisionLog = `${pluginRoot}/.claude/coordination/decision-log.json`;\n  const patternsLog = `${projectDir}/.claude/logs/agent-patterns.jsonl`;\n  const syncState = `${pluginRoot}/.claude/coordination/.decision-sync-state.json`;\n\n  // Count pending items\n  const decisionCount = countPendingDecisions(decisionLog, syncState);\n  const { count: patternCount, patterns: pendingPatterns } = countPendingPatterns(patternsLog);\n\n  // Extract session info\n  const { currentTask, blockers, nextSteps } = extractSessionInfo(projectDir);\n\n  // If nothing to sync, silent exit\n  if (decisionCount === 0 && patternCount === 0 && !currentTask) {\n    return outputSilentSuccess();\n  }\n\n  const projectId = getProjectId(projectDir);\n  const logFile = `${projectDir}/.claude/logs/mem0-sync.log`;\n\n  // Ensure log directory exists\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  // Build summary message parts\n  const msgParts: string[] = [];\n  if (decisionCount > 0) {\n    msgParts.push(`${decisionCount} decisions to sync`);\n  }\n  if (patternCount > 0) {\n    msgParts.push(`${patternCount} agent patterns pending`);\n\n    // Extract unique agents\n    const agentSet = new Set(pendingPatterns.map((p: any) => p.agent_id || p.agent).filter(Boolean));\n    const uniqueAgents = Array.from(agentSet).slice(0, 5);\n    if (uniqueAgents.length > 0) {\n      msgParts.push(`agents: ${uniqueAgents.join(', ')}`);\n    }\n  }\n\n  const summary = msgParts.length > 0 ? msgParts.join('; ') : 'No pending items';\n\n  // Build session text\n  let summaryText = currentTask || 'Session work';\n  if (decisionCount > 0) {\n    summaryText += ` (${decisionCount} decisions made)`;\n  }\n  if (patternCount > 0) {\n    summaryText += ` (${patternCount} patterns learned)`;\n  }\n\n  let sessionText = `Session Summary: ${summaryText}`;\n  if (blockers) {\n    sessionText += ` | Blockers: ${blockers}`;\n  }\n  if (nextSteps) {\n    sessionText += ` | Next: ${nextSteps}`;\n  }\n\n  // Try auto-sync if MEM0_API_KEY is available\n  const scriptPath = `${pluginRoot}/skills/mem0-memory/scripts/crud/add-memory.py`;\n  const mem0ApiKey = process.env.MEM0_API_KEY;\n\n  let skillMsg: string;\n\n  if (existsSync(scriptPath) && mem0ApiKey) {\n    const timestamp = new Date().toISOString();\n    try {\n      appendFileSync(logFile, `[${timestamp}] Auto-sync triggered for session summary\\n`);\n    } catch {\n      // Ignore\n    }\n\n    // Execute sync in background (non-blocking)\n    const sessionMetadata = JSON.stringify({\n      type: 'session_summary',\n      status: 'in_progress',\n      project: projectId,\n      has_blockers: !!blockers,\n      has_next_steps: !!nextSteps,\n      source: 'orchestkit-plugin',\n    });\n\n    const child = spawn(\n      'python3',\n      [\n        scriptPath,\n        '--text',\n        sessionText,\n        '--user-id',\n        `${projectId}-continuity`,\n        '--metadata',\n        sessionMetadata,\n        '--enable-graph',\n      ],\n      {\n        detached: true,\n        stdio: ['ignore', 'pipe', 'pipe'],\n      }\n    );\n\n    child.on('error', (err) => {\n      const errTimestamp = new Date().toISOString();\n      try {\n        appendFileSync(logFile, `[${errTimestamp}] Sync child process error: ${err.message}\\n`);\n      } catch {\n        // Best-effort logging\n      }\n    });\n\n    child.on('close', (code) => {\n      const closeTimestamp = new Date().toISOString();\n      try {\n        if (code === 0) {\n          appendFileSync(logFile, `[${closeTimestamp}] Sync completed successfully\\n`);\n        } else {\n          appendFileSync(logFile, `[${closeTimestamp}] Sync exited with code ${code}\\n`);\n        }\n      } catch {\n        // Best-effort logging\n      }\n    });\n\n    if (child.stderr) {\n      let stderrData = '';\n      child.stderr.on('data', (chunk: Buffer) => {\n        stderrData += chunk.toString();\n      });\n      child.stderr.on('end', () => {\n        if (stderrData.trim()) {\n          const errTimestamp = new Date().toISOString();\n          try {\n            appendFileSync(logFile, `[${errTimestamp}] Sync stderr: ${stderrData.trim()}\\n`);\n          } catch {\n            // Best-effort logging\n          }\n        }\n      });\n    }\n\n    child.unref();\n\n    // Mark patterns as synced\n    if (patternCount > 0 && existsSync(patternsLog)) {\n      try {\n        const content = readFileSync(patternsLog, 'utf-8');\n        const updated = content\n          .split('\\n')\n          .filter((line) => line.trim())\n          .map((line) => {\n            const obj = JSON.parse(line);\n            obj.pending_sync = false;\n            return JSON.stringify(obj);\n          })\n          .join('\\n');\n        writeFileSync(patternsLog, updated);\n      } catch {\n        // Ignore\n      }\n    }\n\n    skillMsg = `[Mem0 Sync] Auto-synced: ${summary}`;\n  } else {\n    skillMsg = `[Mem0 Sync] ${summary} - Execute /mem0-sync to persist session context`;\n  }\n\n  logHook('mem0-pre-compaction-sync', skillMsg);\n\n  return {\n    continue: true,\n    systemMessage: skillMsg,\n  };\n}\n", "/**\n * Multi-Instance Cleanup Hook\n * Runs on session stop to release locks and update instance status\n * CC 2.1.7 Compliant: JSON output on all exit paths\n */\n\nimport { existsSync, readFileSync, unlinkSync, rmdirSync, readdirSync, rmSync } from 'node:fs';\nimport { execSync, spawn } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Execute SQLite command\n */\nfunction runSqlite(dbPath: string, sql: string): void {\n  try {\n    execSync(`sqlite3 \"${dbPath}\" \"${sql}\"`, {\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n  } catch {\n    // Ignore SQLite errors\n  }\n}\n\n/**\n * Check if table exists\n */\nfunction hasTable(dbPath: string, tableName: string): boolean {\n  try {\n    const result = execSync(\n      `sqlite3 \"${dbPath}\" \"SELECT count(*) FROM sqlite_master WHERE type='table' AND name='${tableName}';\"`,\n      { encoding: 'utf8', timeout: 5000, stdio: ['pipe', 'pipe', 'pipe'] }\n    ).trim();\n    return result === '1';\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Stop heartbeat process\n */\nfunction stopHeartbeat(instanceDir: string): void {\n  const pidFile = `${instanceDir}/heartbeat.pid`;\n  if (!existsSync(pidFile)) {\n    return;\n  }\n\n  try {\n    const pid = parseInt(readFileSync(pidFile, 'utf-8').trim(), 10);\n    try {\n      process.kill(pid, 0); // Check if process exists\n      process.kill(pid); // Kill it\n      logHook('multi-instance-cleanup', `Stopped heartbeat process (PID: ${pid})`);\n    } catch {\n      // Process doesn't exist\n    }\n    unlinkSync(pidFile);\n  } catch {\n    // Ignore errors\n  }\n}\n\n/**\n * Release all locks held by this instance\n */\nfunction releaseLocks(dbPath: string, instanceId: string): void {\n  logHook('multi-instance-cleanup', 'Releasing all locks...');\n  runSqlite(dbPath, `DELETE FROM file_locks WHERE instance_id = '${instanceId}';`);\n  logHook('multi-instance-cleanup', 'All locks released');\n}\n\n/**\n * Handle work claims\n */\nfunction handleWorkClaims(dbPath: string, instanceId: string): void {\n  logHook('multi-instance-cleanup', 'Handling work claims...');\n\n  if (hasTable(dbPath, 'work_claims')) {\n    runSqlite(\n      dbPath,\n      `UPDATE work_claims SET status = 'abandoned', completed_at = datetime('now') WHERE instance_id = '${instanceId}' AND status = 'active';`\n    );\n    logHook('multi-instance-cleanup', 'Work claims handled');\n  } else {\n    logHook('multi-instance-cleanup', 'No work_claims table, skipping');\n  }\n}\n\n/**\n * Update instance status\n */\nfunction updateInstanceStatus(dbPath: string, instanceId: string): void {\n  if (hasTable(dbPath, 'instances')) {\n    runSqlite(\n      dbPath,\n      `UPDATE instances SET status = 'terminated', last_heartbeat = datetime('now') WHERE id = '${instanceId}';`\n    );\n    logHook('multi-instance-cleanup', 'Instance status updated to terminated');\n  } else {\n    logHook('multi-instance-cleanup', 'No instances table, skipping status update');\n  }\n}\n\n/**\n * Broadcast shutdown message\n */\nfunction broadcastShutdown(dbPath: string, instanceId: string): void {\n  if (!hasTable(dbPath, 'messages')) {\n    logHook('multi-instance-cleanup', 'No messages table, skipping broadcast');\n    return;\n  }\n\n  const messageId = `msg-${Math.random().toString(36).slice(2, 18)}`;\n  const timestamp = new Date().toISOString();\n  const payload = JSON.stringify({ instance_id: instanceId, timestamp }).replace(/'/g, \"''\");\n\n  runSqlite(\n    dbPath,\n    `INSERT INTO messages (message_id, from_instance, to_instance, message_type, payload, expires_at) VALUES ('${messageId}', '${instanceId}', NULL, 'shutdown', '${payload}', datetime('now', '+1 hour'));`\n  );\n  logHook('multi-instance-cleanup', 'Shutdown broadcast sent');\n}\n\n/**\n * Cleanup instance-specific files\n */\nfunction cleanupInstanceFiles(instanceDir: string): void {\n  const filesToRemove = ['knowledge_cache.json', 'claims.json', 'session_discoveries.json'];\n\n  for (const file of filesToRemove) {\n    const filePath = `${instanceDir}/${file}`;\n    try {\n      if (existsSync(filePath)) {\n        unlinkSync(filePath);\n      }\n    } catch {\n      // Ignore\n    }\n  }\n\n  logHook('multi-instance-cleanup', 'Instance files cleaned up');\n}\n\n/**\n * Multi-instance cleanup hook\n */\nexport function multiInstanceCleanup(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const instanceDir = `${projectDir}/.instance`;\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  // Check if coordination is enabled\n  if (!existsSync(dbPath)) {\n    logHook('multi-instance-cleanup', 'No coordination database, skipping cleanup');\n    return outputSilentSuccess();\n  }\n\n  // Check if we have instance identity\n  const idFile = `${instanceDir}/id.json`;\n  if (!existsSync(idFile)) {\n    logHook('multi-instance-cleanup', 'No instance identity, skipping cleanup');\n    return outputSilentSuccess();\n  }\n\n  // Get instance ID\n  let instanceId: string;\n  try {\n    const idData = JSON.parse(readFileSync(idFile, 'utf-8'));\n    instanceId = idData.instance_id;\n  } catch {\n    logHook('multi-instance-cleanup', 'Failed to read instance ID');\n    return outputSilentSuccess();\n  }\n\n  logHook('multi-instance-cleanup', `Starting multi-instance cleanup for ${instanceId}...`);\n\n  // Stop heartbeat first\n  stopHeartbeat(instanceDir);\n\n  // Release all locks\n  releaseLocks(dbPath, instanceId);\n\n  // Handle work claims\n  handleWorkClaims(dbPath, instanceId);\n\n  // Broadcast shutdown\n  broadcastShutdown(dbPath, instanceId);\n\n  // Update status\n  updateInstanceStatus(dbPath, instanceId);\n\n  // Cleanup files\n  cleanupInstanceFiles(instanceDir);\n\n  logHook('multi-instance-cleanup', '=== Cleanup Summary ===');\n  logHook('multi-instance-cleanup', `Instance: ${instanceId}`);\n  logHook('multi-instance-cleanup', 'Status: terminated');\n  logHook('multi-instance-cleanup', 'Multi-instance cleanup completed');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Security Scan Aggregator - Stop Hook\n * CC 2.1.3 Compliant - Uses 10-minute hook timeout\n *\n * Runs multiple security tools in parallel and aggregates results.\n */\n\nimport { existsSync, mkdirSync, readFileSync, writeFileSync, readdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface SecurityResults {\n  npmAudit: { critical: number; high: number } | null;\n  pipAudit: number | null;\n  semgrep: number | null;\n  bandit: number | null;\n  secrets: number;\n}\n\n/**\n * Run npm audit\n */\nfunction runNpmAudit(projectDir: string, resultsDir: string): { critical: number; high: number } | null {\n  if (\n    !existsSync(`${projectDir}/package.json`) ||\n    (!existsSync(`${projectDir}/package-lock.json`) &&\n      !existsSync(`${projectDir}/yarn.lock`) &&\n      !existsSync(`${projectDir}/pnpm-lock.yaml`))\n  ) {\n    return null;\n  }\n\n  logHook('security-scan', 'Running npm audit...');\n  try {\n    execSync('npm audit --json', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 120000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n  } catch (error: any) {\n    // npm audit returns non-zero on vulnerabilities, capture output\n    if (error.stdout) {\n      writeFileSync(`${resultsDir}/npm-audit.json`, error.stdout);\n      try {\n        const result = JSON.parse(error.stdout);\n        return {\n          critical: result.metadata?.vulnerabilities?.critical || 0,\n          high: result.metadata?.vulnerabilities?.high || 0,\n        };\n      } catch {\n        // Ignore parse errors\n      }\n    }\n  }\n  logHook('security-scan', 'npm audit complete');\n  return { critical: 0, high: 0 };\n}\n\n/**\n * Run pip-audit\n */\nfunction runPipAudit(projectDir: string, resultsDir: string): number | null {\n  if (!existsSync(`${projectDir}/requirements.txt`) && !existsSync(`${projectDir}/pyproject.toml`)) {\n    return null;\n  }\n\n  try {\n    execSync('which pip-audit', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n  } catch {\n    logHook('security-scan', 'pip-audit not installed, skipping');\n    return null;\n  }\n\n  logHook('security-scan', 'Running pip-audit...');\n  try {\n    const result = execSync('pip-audit --format json', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 120000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    writeFileSync(`${resultsDir}/pip-audit.json`, result);\n    const parsed = JSON.parse(result);\n    logHook('security-scan', 'pip-audit complete');\n    return Array.isArray(parsed) ? parsed.length : 0;\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Run semgrep\n */\nfunction runSemgrep(projectDir: string, resultsDir: string): number | null {\n  try {\n    execSync('which semgrep', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n  } catch {\n    logHook('security-scan', 'semgrep not installed, skipping');\n    return null;\n  }\n\n  logHook('security-scan', 'Running semgrep...');\n  try {\n    const result = execSync('semgrep --config auto --json --quiet', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 300000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    writeFileSync(`${resultsDir}/semgrep.json`, result);\n    const parsed = JSON.parse(result);\n    const highSeverity = (parsed.results || []).filter((r: any) => r.extra?.severity === 'ERROR').length;\n    logHook('security-scan', 'semgrep complete');\n    return highSeverity;\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Run bandit\n */\nfunction runBandit(projectDir: string, resultsDir: string): number | null {\n  // Check for Python files\n  try {\n    const hasPython = execSync('find . -name \"*.py\" -maxdepth 2 | head -1', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n    if (!hasPython && !existsSync(`${projectDir}/backend`)) {\n      return null;\n    }\n  } catch {\n    return null;\n  }\n\n  try {\n    execSync('which bandit', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n  } catch {\n    logHook('security-scan', 'bandit not installed, skipping');\n    return null;\n  }\n\n  logHook('security-scan', 'Running bandit...');\n  try {\n    execSync(`bandit -r . -f json -o ${resultsDir}/bandit.json`, {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 120000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    logHook('security-scan', 'bandit complete');\n    return 0;\n  } catch {\n    // Bandit exits non-zero when issues found\n    return 0;\n  }\n}\n\n/**\n * Run secret detection\n */\nfunction runSecretScan(projectDir: string, resultsDir: string): number {\n  logHook('security-scan', 'Running secret detection...');\n\n  const secretPatterns = /(api[_-]?key|secret[_-]?key|password|token)\\s*[=:]\\s*[\"'][^\"']{8,}/i;\n  let secretsFound = 0;\n  const findings: Array<{ file: string; type: string }> = [];\n\n  const extensions = ['.py', '.js', '.ts', '.env'];\n\n  function scanDir(dir: string): void {\n    try {\n      const entries = readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        const fullPath = `${dir}/${entry.name}`;\n\n        // Skip node_modules and .git\n        if (entry.isDirectory()) {\n          if (!['node_modules', '.git', 'dist', 'build'].includes(entry.name)) {\n            scanDir(fullPath);\n          }\n          continue;\n        }\n\n        // Check file extension\n        if (!extensions.some((ext) => entry.name.endsWith(ext))) {\n          continue;\n        }\n\n        try {\n          const content = readFileSync(fullPath, 'utf-8');\n          if (secretPatterns.test(content)) {\n            findings.push({ file: fullPath, type: 'potential_secret' });\n            secretsFound++;\n          }\n        } catch {\n          // Ignore read errors\n        }\n      }\n    } catch {\n      // Ignore directory errors\n    }\n  }\n\n  scanDir(projectDir);\n\n  writeFileSync(\n    `${resultsDir}/secrets.json`,\n    JSON.stringify({ findings, count: secretsFound }, null, 2)\n  );\n\n  logHook('security-scan', `Secret detection complete: ${secretsFound} potential issues`);\n  return secretsFound;\n}\n\n/**\n * Aggregate results\n */\nfunction aggregateResults(resultsDir: string, results: SecurityResults): void {\n  logHook('security-scan', 'Aggregating results...');\n\n  let totalCritical = 0;\n  let totalHigh = 0;\n\n  if (results.npmAudit) {\n    totalCritical += results.npmAudit.critical;\n    totalHigh += results.npmAudit.high;\n  }\n  if (results.pipAudit !== null) {\n    totalHigh += results.pipAudit;\n  }\n  if (results.semgrep !== null) {\n    totalHigh += results.semgrep;\n  }\n\n  const scansCompleted = readdirSync(resultsDir)\n    .filter((f) => f.endsWith('.json') && !f.includes('aggregated'))\n    .map((f) => f.replace('.json', ''));\n\n  const report = {\n    timestamp: new Date().toISOString(),\n    summary: {\n      critical: totalCritical,\n      high: totalHigh,\n      medium: 0,\n    },\n    scans_completed: scansCompleted,\n  };\n\n  writeFileSync(`${resultsDir}/aggregated-report.json`, JSON.stringify(report, null, 2));\n\n  logHook('security-scan', '=== Security Scan Complete ===');\n  logHook('security-scan', `Critical: ${totalCritical}, High: ${totalHigh}`);\n\n  if (totalCritical > 0) {\n    console.error(`Security: ${totalCritical} critical, ${totalHigh} high vulnerabilities found`);\n  }\n}\n\n/**\n * Security scan aggregator hook\n */\nexport function securityScanAggregator(input: HookInput): HookResult {\n  logHook('security-scan', '=== Security Scan Started ===');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const resultsDir = `${projectDir}/.claude/hooks/logs/security`;\n\n  mkdirSync(resultsDir, { recursive: true });\n\n  const results: SecurityResults = {\n    npmAudit: null,\n    pipAudit: null,\n    semgrep: null,\n    bandit: null,\n    secrets: 0,\n  };\n\n  // Run scans (sequentially in TS to avoid complexity, but could be parallelized)\n  results.npmAudit = runNpmAudit(projectDir, resultsDir);\n  results.pipAudit = runPipAudit(projectDir, resultsDir);\n  results.semgrep = runSemgrep(projectDir, resultsDir);\n  results.bandit = runBandit(projectDir, resultsDir);\n  results.secrets = runSecretScan(projectDir, resultsDir);\n\n  // Aggregate results\n  aggregateResults(resultsDir, results);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Patterns - Unified pattern learning at session end\n * Part of OrchestKit Plugin - Cross-Project Patterns (#48) + Best Practices (#49)\n *\n * This hook processes patterns at session end:\n * 1. Extracts workflow patterns (tool sequences, workflow types, languages)\n * 2. Merges queued patterns into learned-patterns.json\n * 3. Syncs to mem0 for cross-project learning\n * 4. Updates workflow profile for session analytics\n *\n * CC 2.1.7 Compliant: Uses suppressOutput for silent operation\n */\n\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getPluginRoot, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface WorkflowProfile {\n  version: string;\n  last_updated: string | null;\n  sessions_count: number;\n  workflow_types: Record<string, number>;\n  common_tool_sequences: string[];\n  dominant_languages: Record<string, number>;\n  average_tools_per_session: number;\n  average_session_duration_seconds: number;\n  tool_frequency: Record<string, number>;\n}\n\ninterface LearnedPatterns {\n  version: string;\n  updated: string;\n  patterns: Array<{\n    text: string;\n    outcome: string;\n    category: string;\n    timestamp: string;\n  }>;\n  categories: Record<string, number>;\n  stats: {\n    total: number;\n    successes: number;\n    failures: number;\n  };\n}\n\ninterface SessionMetrics {\n  tools?: Record<string, number>;\n}\n\n/**\n * Extract tool usage sequence from session metrics\n */\nfunction extractToolSequence(metricsFile: string): string {\n  if (!existsSync(metricsFile)) {\n    return '';\n  }\n\n  try {\n    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));\n    const tools = metrics.tools || {};\n    const sorted = Object.entries(tools)\n      .sort(([, a], [, b]) => b - a)\n      .slice(0, 10)\n      .map(([tool]) => tool);\n    return sorted.join(',');\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Get total tool invocations from metrics\n */\nfunction getToolCount(metricsFile: string): number {\n  if (!existsSync(metricsFile)) {\n    return 0;\n  }\n\n  try {\n    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));\n    const tools = metrics.tools || {};\n    return Object.values(tools).reduce((sum, count) => sum + count, 0);\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Detect workflow type based on tool usage patterns\n */\nfunction detectWorkflowType(tools: string): string {\n  if (tools.includes('Write') && tools.includes('Bash')) {\n    if (/test|pytest|jest|vitest/i.test(tools)) {\n      return 'test-driven-development';\n    }\n  }\n\n  if (tools.includes('Read') && tools.includes('Grep')) {\n    return 'code-exploration';\n  }\n\n  if (tools.includes('Edit') && !tools.includes('Write')) {\n    return 'refactoring';\n  }\n\n  if (tools.includes('Write') && tools.includes('Read')) {\n    return 'feature-development';\n  }\n\n  if (tools.includes('Bash') && /git|gh/i.test(tools)) {\n    return 'git-operations';\n  }\n\n  return 'general';\n}\n\n/**\n * Detect dominant language from tool sequence (simplified)\n */\nfunction detectDominantLanguage(tools: string): string {\n  // In a real implementation, this would analyze file extensions from hook logs\n  // For now, return 'unknown' as we don't have file access patterns in TS\n  return 'unknown';\n}\n\n/**\n * Initialize workflow profile if needed\n */\nfunction initWorkflowProfile(profilePath: string): WorkflowProfile {\n  if (existsSync(profilePath)) {\n    try {\n      return JSON.parse(readFileSync(profilePath, 'utf-8'));\n    } catch {\n      // Fall through to create new\n    }\n  }\n\n  return {\n    version: '1.0.0',\n    last_updated: null,\n    sessions_count: 0,\n    workflow_types: {\n      'test-driven-development': 0,\n      'code-exploration': 0,\n      refactoring: 0,\n      'feature-development': 0,\n      'git-operations': 0,\n      general: 0,\n    },\n    common_tool_sequences: [],\n    dominant_languages: {\n      python: 0,\n      typescript: 0,\n      javascript: 0,\n      go: 0,\n      rust: 0,\n      unknown: 0,\n    },\n    average_tools_per_session: 0,\n    average_session_duration_seconds: 0,\n    tool_frequency: {},\n  };\n}\n\n/**\n * Update workflow profile with session data\n */\nfunction updateWorkflowProfile(\n  profilePath: string,\n  workflowType: string,\n  dominantLang: string,\n  toolCount: number,\n  toolSequence: string\n): void {\n  const profile = initWorkflowProfile(profilePath);\n  const timestamp = new Date().toISOString();\n\n  profile.last_updated = timestamp;\n  profile.sessions_count += 1;\n\n  // Update workflow type counts\n  profile.workflow_types[workflowType] = (profile.workflow_types[workflowType] || 0) + 1;\n\n  // Update dominant language counts\n  profile.dominant_languages[dominantLang] = (profile.dominant_languages[dominantLang] || 0) + 1;\n\n  // Update running averages\n  profile.average_tools_per_session =\n    (profile.average_tools_per_session * (profile.sessions_count - 1) + toolCount) / profile.sessions_count;\n\n  // Add tool sequence if meaningful\n  const sequenceTools = toolSequence.split(',').filter(Boolean);\n  if (sequenceTools.length > 2) {\n    const seqSet = new Set([toolSequence, ...profile.common_tool_sequences]);\n    profile.common_tool_sequences = Array.from(seqSet).slice(0, 20);\n  }\n\n  mkdirSync(profilePath.replace(/\\/[^/]+$/, ''), { recursive: true });\n  writeFileSync(profilePath, JSON.stringify(profile, null, 2));\n}\n\n/**\n * Initialize learned patterns file if needed\n */\nfunction initPatternsFile(patternsPath: string): LearnedPatterns {\n  if (existsSync(patternsPath)) {\n    try {\n      return JSON.parse(readFileSync(patternsPath, 'utf-8'));\n    } catch {\n      // Fall through to create new\n    }\n  }\n\n  return {\n    version: '1.0',\n    updated: '',\n    patterns: [],\n    categories: {},\n    stats: {\n      total: 0,\n      successes: 0,\n      failures: 0,\n    },\n  };\n}\n\n/**\n * Merge queued patterns into learned patterns file\n */\nfunction mergePatterns(projectDir: string): void {\n  const queuePath = `${projectDir}/.claude/feedback/patterns-queue.json`;\n  const patternsPath = `${projectDir}/.claude/feedback/learned-patterns.json`;\n\n  if (!existsSync(queuePath)) {\n    logHook('session-patterns', 'No patterns queue found');\n    return;\n  }\n\n  let queue: { patterns: LearnedPatterns['patterns'] };\n  try {\n    queue = JSON.parse(readFileSync(queuePath, 'utf-8'));\n  } catch {\n    logHook('session-patterns', 'Failed to parse patterns queue');\n    return;\n  }\n\n  const queueCount = queue.patterns?.length || 0;\n  if (queueCount === 0) {\n    logHook('session-patterns', 'Patterns queue is empty');\n    return;\n  }\n\n  logHook('session-patterns', `Processing ${queueCount} queued patterns...`);\n\n  const existing = initPatternsFile(patternsPath);\n  const now = new Date().toISOString();\n\n  // Merge and deduplicate patterns by text (keep most recent)\n  const allPatterns = [...existing.patterns, ...queue.patterns];\n  const patternMap = new Map<string, (typeof allPatterns)[0]>();\n  for (const p of allPatterns) {\n    patternMap.set(p.text, p);\n  }\n  const mergedPatterns = Array.from(patternMap.values());\n\n  // Calculate stats\n  const successes = mergedPatterns.filter((p) => p.outcome === 'success').length;\n  const failures = mergedPatterns.filter((p) => p.outcome === 'failed').length;\n\n  // Group by category\n  const categories: Record<string, number> = {};\n  for (const p of mergedPatterns) {\n    categories[p.category] = (categories[p.category] || 0) + 1;\n  }\n\n  const updated: LearnedPatterns = {\n    version: '1.0',\n    updated: now,\n    patterns: mergedPatterns,\n    categories,\n    stats: {\n      total: mergedPatterns.length,\n      successes,\n      failures,\n    },\n  };\n\n  mkdirSync(patternsPath.replace(/\\/[^/]+$/, ''), { recursive: true });\n  writeFileSync(patternsPath, JSON.stringify(updated, null, 2));\n  logHook('session-patterns', 'Merged patterns successfully');\n\n  // Clear the queue\n  writeFileSync(queuePath, JSON.stringify({ patterns: [] }));\n}\n\n/**\n * Session patterns hook\n */\nexport function sessionPatterns(input: HookInput): HookResult {\n  logHook('session-patterns', 'Session ending, processing patterns...');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const metricsFile = '/tmp/claude-session-metrics.json';\n  const workflowProfile = `${projectDir}/.claude/feedback/workflow-patterns.json`;\n\n  // Ensure directories exist\n  mkdirSync(`${projectDir}/.claude/feedback`, { recursive: true });\n  mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n\n  // 1. Process workflow patterns\n  const toolCount = getToolCount(metricsFile);\n\n  if (toolCount >= 5) {\n    const toolSequence = extractToolSequence(metricsFile);\n    const workflowType = detectWorkflowType(toolSequence);\n    const dominantLang = detectDominantLanguage(toolSequence);\n\n    updateWorkflowProfile(workflowProfile, workflowType, dominantLang, toolCount, toolSequence);\n\n    logHook('session-patterns', `Workflow analyzed: type=${workflowType} lang=${dominantLang} tools=${toolCount}`);\n  } else {\n    logHook('session-patterns', `Session too short for workflow analysis (tools: ${toolCount})`);\n  }\n\n  // 2. Merge queued patterns\n  mergePatterns(projectDir);\n\n  logHook('session-patterns', 'Pattern processing complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Task Completion Check - Verifies tasks are properly completed before stop\n * Hook: Stop\n * CC 2.1.20: Orphan detection and deletion support\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess, outputWithContext } from '../lib/common.js';\nimport { getOrphanedTasks, formatTaskDeleteForClaude } from '../lib/task-integration.js';\n\ninterface TodoItem {\n  status: string;\n  description?: string;\n}\n\n/**\n * Task completion check hook\n */\nexport function taskCompletionCheck(input: HookInput): HookResult {\n  logHook('task-completion-check', 'Stop hook - checking task completion');\n\n  const warnings: string[] = [];\n\n  // CC 2.1.20: Check orchestration registry for in_progress tasks\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionId = input.session_id || getSessionId();\n  const registryFile = `${projectDir}/.claude/orchestration/task-registry-${sessionId}.json`;\n\n  if (existsSync(registryFile)) {\n    try {\n      const registry = JSON.parse(readFileSync(registryFile, 'utf-8'));\n      const inProgress = (registry.tasks || []).filter(\n        (t: { status: string }) => t.status === 'in_progress'\n      );\n      if (inProgress.length > 0) {\n        logHook('task-completion-check', `WARNING: ${inProgress.length} orchestration tasks still in progress`);\n        warnings.push(`${inProgress.length} orchestration task(s) still in progress at session stop`);\n      }\n    } catch (error) {\n      logHook('task-completion-check', `Error reading registry: ${error}`);\n    }\n  }\n\n  // CC 2.1.20: Check for orphaned tasks and generate deletion instructions\n  const orphans = getOrphanedTasks();\n  let orphanInstructions = '';\n  if (orphans.length > 0) {\n    logHook('task-completion-check', `Found ${orphans.length} orphaned tasks`);\n    orphanInstructions = '\\n\\n## Orphaned Tasks\\n\\nThe following tasks are orphaned (all blockers failed) and should be deleted:\\n';\n    for (const orphan of orphans) {\n      orphanInstructions += `\\n${formatTaskDeleteForClaude(orphan.taskId, 'All blocking tasks have failed')}`;\n    }\n  }\n\n  // Legacy fallback: check /tmp/claude-active-todos.json\n  const todosFile = '/tmp/claude-active-todos.json';\n  if (existsSync(todosFile)) {\n    try {\n      const todos: TodoItem[] = JSON.parse(readFileSync(todosFile, 'utf-8'));\n      const inProgress = todos.filter((t) => t.status === 'in_progress');\n      if (inProgress.length > 0) {\n        logHook('task-completion-check', `WARNING: ${inProgress.length} legacy tasks in progress at stop`);\n        warnings.push(`${inProgress.length} legacy task(s) still in progress`);\n      }\n    } catch (error) {\n      logHook('task-completion-check', `Error reading legacy todos: ${error}`);\n    }\n  }\n\n  if (warnings.length > 0 || orphanInstructions) {\n    let context = `## Task Completion Warning\\n\\n${warnings.map(w => `- ${w}`).join('\\n')}`;\n    if (orphanInstructions) {\n      context += orphanInstructions;\n    }\n    return outputWithContext(context);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Calibration Persist - Stop Hook for Persisting Calibration Data\n * Issue #197: Agent Orchestration Layer\n *\n * End-of-session calibration operations:\n * - Applies decay to old adjustments\n * - Cleans up expired records\n * - Saves final calibration state\n *\n * CC 2.1.7 Compliant: Silent hook that persists in background\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\nimport {\n  loadCalibrationData,\n  saveCalibrationData,\n  applyDecay,\n} from '../lib/calibration-engine.js';\nimport { loadConfig, clearSessionState, cleanupOldStates } from '../lib/orchestration-state.js';\nimport { cleanupOldTasks } from '../lib/task-integration.js';\n\n// -----------------------------------------------------------------------------\n// Constants\n// -----------------------------------------------------------------------------\n\n/** Maximum age for calibration records (30 days) */\nconst MAX_RECORD_AGE_MS = 30 * 24 * 60 * 60 * 1000;\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\n/**\n * Clean up old calibration records\n */\nfunction cleanupOldRecords(data: ReturnType<typeof loadCalibrationData>): void {\n  const cutoff = Date.now() - MAX_RECORD_AGE_MS;\n\n  const before = data.records.length;\n  data.records = data.records.filter(r => {\n    const recordTime = new Date(r.timestamp).getTime();\n    return recordTime > cutoff;\n  });\n  const after = data.records.length;\n\n  if (before !== after) {\n    logHook('calibration-persist', `Cleaned up ${before - after} old records`);\n  }\n}\n\n/**\n * Generate calibration summary for logging\n */\nfunction generateSummary(data: ReturnType<typeof loadCalibrationData>): string {\n  const stats = data.stats;\n  const topAgents = stats.topAgents\n    .slice(0, 3)\n    .map(a => `${a.agent}(${Math.round(a.successRate * 100)}%)`)\n    .join(', ');\n\n  return `Calibration summary: ${stats.totalDispatches} dispatches, ` +\n    `${Math.round(stats.successRate * 100)}% success rate, ` +\n    `${data.adjustments.length} adjustments active. ` +\n    `Top agents: ${topAgents || 'none'}`;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Calibration persist hook\n *\n * Runs at session end to:\n * 1. Apply decay to old adjustments\n * 2. Clean up expired records\n * 3. Save final calibration state\n * 4. Clean up session-specific state\n */\nexport function calibrationPersist(_input: HookInput): HookResult {\n  // Check if calibration is enabled\n  const config = loadConfig();\n  if (!config.enableCalibration) {\n    // Still do cleanup even if calibration disabled\n    clearSessionState();\n    cleanupOldStates();\n    return outputSilentSuccess();\n  }\n\n  logHook('calibration-persist', 'Running end-of-session calibration persistence...');\n\n  try {\n    // Load current calibration data\n    const data = loadCalibrationData();\n\n    // Apply decay to old adjustments\n    applyDecay(data);\n\n    // Clean up old records\n    cleanupOldRecords(data);\n\n    // Save updated calibration data\n    saveCalibrationData(data);\n\n    // Log summary\n    const summary = generateSummary(data);\n    logHook('calibration-persist', summary);\n\n  } catch (err) {\n    logHook('calibration-persist', `Error during calibration persist: ${err}`);\n  }\n\n  // Clean up session state\n  try {\n    clearSessionState();\n    cleanupOldStates();\n    cleanupOldTasks();\n    logHook('calibration-persist', 'Cleaned up session state');\n  } catch (err) {\n    logHook('calibration-persist', `Error during state cleanup: ${err}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * First Run Setup - Full setup with optional interactive wizard\n * Hook: Setup (triggered by setup-check.sh)\n * CC 2.1.11 Compliant\n *\n * Phases:\n * 1. Environment detection\n * 2. Dependency validation\n * 3. Configuration selection\n * 4. Apply configuration\n * 5. Create marker file\n */\n\nimport { existsSync, mkdirSync, writeFileSync, readdirSync, chmodSync, statSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getPluginRoot, outputWithContext, outputSilentSuccess } from '../lib/common.js';\n\nconst CURRENT_VERSION = '4.25.0';\n\ninterface EnvironmentInfo {\n  python?: string;\n  nodejs?: string;\n  git?: boolean;\n  docker?: boolean;\n  sqlite3?: boolean;\n  os: string;\n}\n\ninterface PresetConfig {\n  preset: string;\n  description: string;\n  features: {\n    skills: boolean;\n    agents: boolean;\n    hooks: boolean;\n    mcp: boolean;\n    coordination: boolean;\n    statusline: boolean;\n  };\n  hook_groups: {\n    safety: boolean;\n    quality: boolean;\n    productivity: boolean;\n    observability: boolean;\n  };\n}\n\n/**\n * Detect environment\n */\nfunction detectEnvironment(): EnvironmentInfo {\n  logHook('first-run-setup', 'Phase 1: Detecting environment');\n\n  const envInfo: EnvironmentInfo = {\n    os: process.platform,\n  };\n\n  // Detect Python version\n  try {\n    const result = execSync('python3 --version', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    const match = result.match(/(\\d+\\.\\d+)/);\n    if (match) {\n      envInfo.python = match[1];\n      logHook('first-run-setup', `Python: ${match[1]}`);\n    }\n  } catch {\n    // Python not available\n  }\n\n  // Detect Node.js version\n  try {\n    const result = execSync('node --version', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    const match = result.match(/(\\d+\\.\\d+)/);\n    if (match) {\n      envInfo.nodejs = match[1];\n      logHook('first-run-setup', `Node.js: ${match[1]}`);\n    }\n  } catch {\n    // Node.js not available\n  }\n\n  // Detect Git\n  try {\n    execSync('which git', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    envInfo.git = true;\n    logHook('first-run-setup', 'Git: available');\n  } catch {\n    // Git not available\n  }\n\n  // Detect Docker\n  try {\n    execSync('which docker', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    envInfo.docker = true;\n    logHook('first-run-setup', 'Docker: available');\n  } catch {\n    // Docker not available\n  }\n\n  // Detect SQLite3\n  try {\n    execSync('which sqlite3', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    envInfo.sqlite3 = true;\n    logHook('first-run-setup', 'SQLite3: available (multi-instance coordination enabled)');\n  } catch {\n    // SQLite3 not available\n  }\n\n  return envInfo;\n}\n\n/**\n * Validate dependencies\n */\nfunction validateDependencies(): { valid: boolean; missing: string[]; warnings: string[] } {\n  logHook('first-run-setup', 'Phase 2: Validating dependencies');\n\n  const missing: string[] = [];\n  const warnings: string[] = [];\n\n  // Required: jq\n  try {\n    execSync('which jq', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n  } catch {\n    missing.push('jq (required for JSON processing)');\n  }\n\n  // Optional: sqlite3\n  try {\n    execSync('which sqlite3', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n  } catch {\n    warnings.push('sqlite3 not found - multi-instance coordination disabled');\n  }\n\n  // Optional: anthropic SDK\n  try {\n    execSync('python3 -c \"import anthropic\"', { encoding: 'utf8', stdio: ['pipe', 'pipe', 'pipe'] });\n    logHook('first-run-setup', 'Anthropic SDK: available (Memory Fabric Agent enabled)');\n  } catch {\n    warnings.push('anthropic SDK not found - Memory Fabric Agent will use fallback mode');\n    warnings.push(\"  Install with: pip install 'orchestkit[memory]'\");\n  }\n\n  // Report\n  if (missing.length > 0) {\n    logHook('first-run-setup', 'ERROR: Missing required dependencies:');\n    for (const dep of missing) {\n      logHook('first-run-setup', `  - ${dep}`);\n    }\n  }\n\n  for (const warn of warnings) {\n    logHook('first-run-setup', `WARN: ${warn}`);\n  }\n\n  return { valid: missing.length === 0, missing, warnings };\n}\n\n/**\n * Get preset configuration\n */\nfunction getPresetConfig(preset: string): PresetConfig {\n  const configs: Record<string, PresetConfig> = {\n    complete: {\n      preset: 'complete',\n      description: 'Full AI-assisted development toolkit',\n      features: {\n        skills: true,\n        agents: true,\n        hooks: true,\n        mcp: true,\n        coordination: true,\n        statusline: true,\n      },\n      hook_groups: {\n        safety: true,\n        quality: true,\n        productivity: true,\n        observability: true,\n      },\n    },\n    standard: {\n      preset: 'standard',\n      description: 'Skills and hooks without agent orchestration',\n      features: {\n        skills: true,\n        agents: false,\n        hooks: true,\n        mcp: true,\n        coordination: true,\n        statusline: true,\n      },\n      hook_groups: {\n        safety: true,\n        quality: true,\n        productivity: true,\n        observability: true,\n      },\n    },\n    lite: {\n      preset: 'lite',\n      description: 'Essential skills for constrained environments',\n      features: {\n        skills: true,\n        agents: false,\n        hooks: true,\n        mcp: false,\n        coordination: false,\n        statusline: false,\n      },\n      hook_groups: {\n        safety: true,\n        quality: true,\n        productivity: false,\n        observability: false,\n      },\n    },\n    'hooks-only': {\n      preset: 'hooks-only',\n      description: 'Safety hooks only for pure automation',\n      features: {\n        skills: false,\n        agents: false,\n        hooks: true,\n        mcp: false,\n        coordination: false,\n        statusline: false,\n      },\n      hook_groups: {\n        safety: true,\n        quality: false,\n        productivity: false,\n        observability: false,\n      },\n    },\n  };\n\n  return configs[preset] || configs.complete;\n}\n\n/**\n * Apply configuration\n */\nfunction applyConfiguration(preset: string, envInfo: EnvironmentInfo, pluginRoot: string): PresetConfig {\n  logHook('first-run-setup', `Phase 4: Applying configuration (preset: ${preset})`);\n\n  const config = getPresetConfig(preset);\n\n  // Ensure directories exist\n  const dirs = [\n    `${pluginRoot}/.claude/defaults`,\n    `${pluginRoot}/.claude/context/session`,\n    `${pluginRoot}/.claude/context/knowledge`,\n    `${pluginRoot}/.claude/logs`,\n  ];\n\n  for (const dir of dirs) {\n    try {\n      mkdirSync(dir, { recursive: true });\n    } catch {\n      // Ignore\n    }\n  }\n\n  // Write config if it doesn't exist\n  const configFile = `${pluginRoot}/.claude/defaults/config.json`;\n  if (!existsSync(configFile)) {\n    writeFileSync(configFile, JSON.stringify(config, null, 2));\n    logHook('first-run-setup', `Created config file: ${configFile}`);\n  }\n\n  // Make all hooks executable\n  try {\n    const hooksDir = `${pluginRoot}/hooks`;\n    if (existsSync(hooksDir)) {\n      const makeExecutable = (dir: string) => {\n        try {\n          const entries = readdirSync(dir, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${dir}/${entry.name}`;\n            if (entry.isDirectory()) {\n              makeExecutable(fullPath);\n            } else if (entry.name.endsWith('.sh')) {\n              try {\n                chmodSync(fullPath, 0o755);\n              } catch {\n                // Ignore chmod errors\n              }\n            }\n          }\n        } catch {\n          // Ignore directory errors\n        }\n      };\n      makeExecutable(hooksDir);\n      logHook('first-run-setup', 'Made hooks executable');\n    }\n  } catch {\n    // Ignore\n  }\n\n  return config;\n}\n\n/**\n * Create marker file\n */\nfunction createMarker(preset: string, envInfo: EnvironmentInfo, pluginRoot: string): void {\n  logHook('first-run-setup', 'Phase 5: Creating marker file');\n\n  const now = new Date().toISOString();\n\n  // Count components\n  let hookCount = 0;\n  let skillCount = 0;\n  let agentCount = 0;\n\n  try {\n    const countFiles = (dir: string, pattern: RegExp): number => {\n      let count = 0;\n      const walk = (d: string) => {\n        try {\n          const entries = readdirSync(d, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${d}/${entry.name}`;\n            if (entry.isDirectory()) {\n              walk(fullPath);\n            } else if (pattern.test(entry.name)) {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n      };\n      walk(dir);\n      return count;\n    };\n\n    hookCount = countFiles(`${pluginRoot}/hooks`, /\\.sh$/);\n    skillCount = countFiles(`${pluginRoot}/skills`, /SKILL\\.md$/);\n    agentCount = countFiles(`${pluginRoot}/agents`, /\\.md$/);\n  } catch {\n    // Ignore count errors\n  }\n\n  const marker = {\n    version: CURRENT_VERSION,\n    setup_date: now,\n    preset,\n    components: {\n      hooks: { count: hookCount, valid: true },\n      skills: { count: skillCount, valid: true },\n      agents: { count: agentCount, valid: true },\n    },\n    last_health_check: now,\n    last_maintenance: now,\n    environment: envInfo,\n    user_preferences: {\n      onboarding_completed: true,\n      mcp_configured: false,\n      statusline_configured: false,\n    },\n  };\n\n  const markerFile = `${pluginRoot}/.setup-complete`;\n  writeFileSync(markerFile, JSON.stringify(marker, null, 2));\n  logHook('first-run-setup', `Marker file created: ${markerFile}`);\n}\n\n/**\n * First run setup hook\n */\nexport function firstRunSetup(input: HookInput): HookResult {\n  const pluginRoot = getPluginRoot();\n  const mode = process.argv.includes('--silent') ? 'silent' : 'interactive';\n\n  logHook('first-run-setup', `First-run setup starting (mode: ${mode})`);\n\n  // Phase 1: Environment detection\n  const envInfo = detectEnvironment();\n\n  // Phase 2: Dependency validation\n  const { valid, missing } = validateDependencies();\n  if (!valid) {\n    logHook('first-run-setup', 'ERROR: Dependency validation failed');\n    const ctx = `OrchestKit setup failed: Missing required dependencies. Install ${missing.join(', ')}.`;\n    return outputWithContext(ctx);\n  }\n\n  // Phase 3: Select preset (default to complete)\n  const preset = 'complete';\n  if (mode === 'interactive') {\n    logHook('first-run-setup', 'Interactive mode - using complete preset (wizard via Claude conversation)');\n  } else {\n    logHook('first-run-setup', 'Silent mode - using complete preset');\n  }\n\n  // Phase 4: Apply configuration\n  applyConfiguration(preset, envInfo, pluginRoot);\n\n  // Phase 5: Create marker\n  createMarker(preset, envInfo, pluginRoot);\n\n  // Count components for success message\n  let hookCount = 0;\n  let skillCount = 0;\n  let agentCount = 0;\n  try {\n    const countFiles = (dir: string, pattern: RegExp): number => {\n      let count = 0;\n      const walk = (d: string) => {\n        try {\n          const entries = readdirSync(d, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${d}/${entry.name}`;\n            if (entry.isDirectory()) {\n              walk(fullPath);\n            } else if (pattern.test(entry.name)) {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n      };\n      walk(dir);\n      return count;\n    };\n\n    hookCount = countFiles(`${pluginRoot}/hooks`, /\\.sh$/);\n    skillCount = countFiles(`${pluginRoot}/skills`, /SKILL\\.md$/);\n    agentCount = countFiles(`${pluginRoot}/agents`, /\\.md$/);\n  } catch {\n    // Ignore count errors\n  }\n\n  logHook('first-run-setup', `Setup complete: ${skillCount} skills, ${agentCount} agents, ${hookCount} hooks`);\n\n  const ctx =\n    mode === 'interactive'\n      ? `OrchestKit v${CURRENT_VERSION} setup complete! Loaded ${skillCount} skills, ${agentCount} agents, and ${hookCount} hooks. Use /ork:configure to customize settings.`\n      : `OrchestKit v${CURRENT_VERSION} initialized (silent mode).`;\n\n  return outputWithContext(ctx);\n}\n", "/**\n * Mem0 Analytics Dashboard - Generate weekly/monthly reports\n * Hook: Setup (maintenance)\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Generates weekly/monthly usage reports\n * - Tracks memory growth trends\n * - Analyzes search patterns\n * - Identifies optimization opportunities\n */\n\nimport { existsSync, mkdirSync, writeFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getPluginRoot, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Mem0 analytics dashboard hook\n */\nexport function mem0AnalyticsDashboard(input: HookInput): HookResult {\n  logHook('mem0-analytics', 'Mem0 analytics dashboard starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-analytics', 'Mem0 not available, skipping analytics dashboard');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const pluginRoot = getPluginRoot();\n  const analyticsFile = `${projectDir}/.claude/logs/mem0-analytics.jsonl`;\n  const dashboardFile = `${projectDir}/.claude/logs/mem0-dashboard.json`;\n  const summaryScript = `${pluginRoot}/skills/mem0-memory/scripts/memory-summary.py`;\n\n  // Generate dashboard data\n  let summaryOutput = '{}';\n  if (existsSync(summaryScript)) {\n    try {\n      summaryOutput = execSync(`python3 \"${summaryScript}\"`, {\n        encoding: 'utf8',\n        timeout: 30000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n    } catch {\n      logHook('mem0-analytics', 'Failed to run summary script');\n    }\n  } else {\n    logHook('mem0-analytics', 'Summary script not found, skipping dashboard');\n    return outputSilentSuccess();\n  }\n\n  let summary: unknown;\n  try {\n    summary = JSON.parse(summaryOutput);\n  } catch {\n    summary = {};\n  }\n\n  const timestamp = new Date().toISOString();\n  const dashboardData = {\n    timestamp,\n    summary,\n    trends: {\n      memory_growth: 'tracked',\n      search_frequency: 'tracked',\n      graph_utilization: 'tracked',\n    },\n  };\n\n  // Save dashboard\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n    writeFileSync(dashboardFile, JSON.stringify(dashboardData, null, 2));\n    logHook('mem0-analytics', 'Mem0 analytics dashboard generated');\n  } catch (error) {\n    logHook('mem0-analytics', `Failed to save dashboard: ${error}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Backup Setup Hook - Configure scheduled exports\n * Hook: Setup (maintenance)\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Configures scheduled exports\n * - Sets up backup workflow\n * - Defines backup retention policy\n */\n\nimport { existsSync, mkdirSync, writeFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getPluginRoot, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Mem0 backup setup hook\n */\nexport function mem0BackupSetup(input: HookInput): HookResult {\n  logHook('mem0-backup', 'Mem0 backup setup starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-backup', 'Mem0 not available, skipping backup setup');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const backupConfig = `${projectDir}/.claude/mem0-backup-config.json`;\n\n  // Backup configuration from environment\n  const backupSchedule = process.env.MEM0_BACKUP_SCHEDULE || 'weekly';\n  const backupRetention = parseInt(process.env.MEM0_BACKUP_RETENTION || '30', 10);\n\n  // Create backup config\n  try {\n    mkdirSync(`${projectDir}/.claude`, { recursive: true });\n\n    const config = {\n      schedule: backupSchedule,\n      retention_days: backupRetention,\n      enabled: true,\n      max_backups: parseInt(process.env.MEM0_MAX_BACKUPS || '5', 10),\n      rotation_strategy: 'count',\n      backup_naming: 'timestamp',\n    };\n\n    writeFileSync(backupConfig, JSON.stringify(config, null, 2));\n    logHook('mem0-backup', `Mem0 backup configured: schedule=${backupSchedule}, retention=${backupRetention} days`);\n  } catch (error) {\n    logHook('mem0-backup', `Failed to create backup config: ${error}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Cleanup Hook - Bulk cleanup of old memories\n * Hook: Setup (maintenance)\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Uses batch-delete.py for efficient bulk cleanup\n * - Removes stale memories based on age criteria\n * - Queries memories via get-memories.py and filters by age\n */\n\nimport { existsSync, mkdirSync, appendFileSync } from 'node:fs';\nimport { execSync, spawn } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getPluginRoot, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Calculate cutoff date (N days ago)\n */\nfunction getCutoffDate(daysAgo: number): string {\n  const date = new Date();\n  date.setDate(date.getDate() - daysAgo);\n  return date.toISOString().split('T')[0];\n}\n\n/**\n * Mem0 cleanup hook\n */\nexport function mem0Cleanup(input: HookInput): HookResult {\n  logHook('mem0-cleanup', 'Mem0 cleanup starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-cleanup', 'Mem0 not available, skipping cleanup');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const pluginRoot = getPluginRoot();\n  const scriptsDir = `${pluginRoot}/skills/mem0-memory/scripts`;\n  const batchDeleteScript = `${scriptsDir}/batch/batch-delete.py`;\n  const getMemoriesScript = `${scriptsDir}/crud/get-memories.py`;\n\n  // Check if required scripts exist\n  if (!existsSync(batchDeleteScript)) {\n    logHook('mem0-cleanup', `Batch delete script not found at ${batchDeleteScript}, skipping cleanup`);\n    return outputSilentSuccess();\n  }\n\n  if (!existsSync(getMemoriesScript)) {\n    logHook('mem0-cleanup', `Get memories script not found at ${getMemoriesScript}, skipping cleanup`);\n    return outputSilentSuccess();\n  }\n\n  // Age threshold from environment\n  const ageThreshold = parseInt(process.env.MEM0_CLEANUP_AGE_DAYS || '90', 10);\n  const cutoffDate = getCutoffDate(ageThreshold);\n\n  const logFile = `${projectDir}/.claude/logs/mem0-cleanup.log`;\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  logHook('mem0-cleanup', `Querying memories older than ${cutoffDate} (${ageThreshold} days)`);\n\n  const timestamp = new Date().toISOString();\n  try {\n    appendFileSync(logFile, `[${timestamp}] Cleanup started - threshold: ${cutoffDate}\\n`);\n  } catch {\n    // Ignore\n  }\n\n  // Get all memories\n  let memoriesJson: { memories: Array<{ id: string; created_at: string; metadata?: { protected?: boolean } }> };\n  try {\n    const result = execSync(`python3 \"${getMemoriesScript}\"`, {\n      encoding: 'utf8',\n      timeout: 60000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    memoriesJson = JSON.parse(result);\n  } catch {\n    logHook('mem0-cleanup', 'Failed to get memories');\n    try {\n      appendFileSync(logFile, `[${timestamp}] Failed to get memories\\n`);\n    } catch {\n      // Ignore\n    }\n    return outputSilentSuccess();\n  }\n\n  // Filter stale memories (older than cutoff, not protected)\n  const memories = memoriesJson.memories || [];\n  const staleIds = memories\n    .filter((m) => {\n      const createdAt = m.created_at?.split('T')[0] || '';\n      const isOld = createdAt < cutoffDate;\n      const isProtected = m.metadata?.protected === true;\n      return isOld && !isProtected;\n    })\n    .map((m) => m.id)\n    .slice(0, 100); // Limit to 100 per run\n\n  if (staleIds.length === 0) {\n    logHook('mem0-cleanup', `No stale memories found older than ${cutoffDate}`);\n    try {\n      appendFileSync(logFile, `[${timestamp}] No stale memories found\\n`);\n    } catch {\n      // Ignore\n    }\n    return outputSilentSuccess();\n  }\n\n  logHook('mem0-cleanup', `Found ${staleIds.length} stale memories to delete`);\n  try {\n    appendFileSync(logFile, `[${timestamp}] Found ${staleIds.length} stale memories\\n`);\n  } catch {\n    // Ignore\n  }\n\n  // Execute batch delete\n  try {\n    const idsArray = JSON.stringify(staleIds);\n    execSync(`python3 \"${batchDeleteScript}\" --memory-ids '${idsArray}'`, {\n      encoding: 'utf8',\n      timeout: 120000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    logHook('mem0-cleanup', `Successfully deleted ${staleIds.length} stale memories`);\n    try {\n      appendFileSync(logFile, `[${timestamp}] Deleted ${staleIds.length} memories successfully\\n`);\n    } catch {\n      // Ignore\n    }\n  } catch (error) {\n    logHook('mem0-cleanup', `Batch delete failed: ${error}`);\n    try {\n      appendFileSync(logFile, `[${timestamp}] Delete failed: ${error}\\n`);\n    } catch {\n      // Ignore\n    }\n  }\n\n  logHook('mem0-cleanup', `Mem0 cleanup complete (age threshold: ${ageThreshold} days)`);\n  return outputSilentSuccess();\n}\n", "/**\n * Setup Check - Entry point for CC 2.1.11 Setup hooks\n * Hook: Setup (triggered by --init, --init-only, --maintenance)\n * Also runs on SessionStart for fast validation\n *\n * This hook implements the hybrid marker file + validation approach:\n * 1. Check marker file for fast path (< 10ms when setup complete)\n * 2. Quick validation for self-healing (< 50ms)\n * 3. Triggers appropriate sub-hook based on state\n */\n\nimport { existsSync, readFileSync, readdirSync, writeFileSync } from 'node:fs';\nimport { spawn } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getPluginRoot, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\nconst CURRENT_VERSION = '4.25.0';\n\n/**\n * Get marker field from marker file\n */\nfunction getMarkerField(markerFile: string, field: string): unknown {\n  if (!existsSync(markerFile)) {\n    return null;\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(markerFile, 'utf-8'));\n    // Simple dot notation parsing\n    const parts = field.split('.');\n    let value: unknown = content;\n    for (const part of parts) {\n      if (value === null || value === undefined) return null;\n      value = (value as Record<string, unknown>)[part];\n    }\n    return value;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Quick validation - checks critical components exist (< 50ms target)\n */\nfunction quickValidate(pluginRoot: string): number {\n  let errors = 0;\n\n  // Check 1: Config file exists and is valid JSON\n  const configFile = `${pluginRoot}/.claude/defaults/config.json`;\n  if (existsSync(configFile)) {\n    try {\n      JSON.parse(readFileSync(configFile, 'utf-8'));\n    } catch {\n      logHook('setup-check', 'WARN: config.json is invalid JSON');\n      errors++;\n    }\n  }\n\n  // Check 2: At least some hooks exist (simplified count)\n  let hookCount = 0;\n  if (existsSync(`${pluginRoot}/hooks`)) {\n    try {\n      const countShFiles = (dir: string, depth = 0): number => {\n        if (depth > 3) return 0; // Limit depth\n        let count = 0;\n        try {\n          const entries = readdirSync(dir, { withFileTypes: true });\n          for (const entry of entries.slice(0, 100)) {\n            // Limit entries\n            const fullPath = `${dir}/${entry.name}`;\n            if (entry.isDirectory() && !entry.name.startsWith('.')) {\n              count += countShFiles(fullPath, depth + 1);\n            } else if (entry.name.endsWith('.sh')) {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n        return count;\n      };\n      hookCount = countShFiles(`${pluginRoot}/hooks`);\n    } catch {\n      // Ignore\n    }\n  }\n\n  if (hookCount < 10) {\n    logHook('setup-check', `WARN: Only ${hookCount} hooks found (expected 50+)`);\n    // Don't increment errors - just warn\n  }\n\n  // Check 3: Version matches\n  const markerFile = `${pluginRoot}/.setup-complete`;\n  const markerVersion = getMarkerField(markerFile, 'version') as string | null;\n  if (markerVersion && markerVersion !== CURRENT_VERSION) {\n    logHook('setup-check', `INFO: Version mismatch - marker: ${markerVersion}, current: ${CURRENT_VERSION}`);\n    return 2; // Trigger migration\n  }\n\n  return errors;\n}\n\n/**\n * Check if maintenance is due\n */\nfunction isMaintenanceDue(markerFile: string): boolean {\n  const lastMaintenance = getMarkerField(markerFile, 'last_maintenance') as string | null;\n  if (!lastMaintenance) {\n    return true;\n  }\n\n  try {\n    const lastEpoch = new Date(lastMaintenance).getTime();\n    const nowEpoch = Date.now();\n    const hoursSince = (nowEpoch - lastEpoch) / (1000 * 60 * 60);\n    return hoursSince >= 24;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Update marker field\n */\nfunction updateMarker(markerFile: string, field: string, value: unknown): void {\n  if (!existsSync(markerFile)) {\n    return;\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(markerFile, 'utf-8'));\n    content[field] = value;\n    writeFileSync(markerFile, JSON.stringify(content, null, 2));\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Setup check hook\n */\nexport function setupCheck(input: HookInput): HookResult {\n  // Check bypass flags\n  if (process.env.ORCHESTKIT_SKIP_SETUP === '1' || process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1') {\n    return outputSilentSuccess();\n  }\n\n  const pluginRoot = getPluginRoot();\n  const markerFile = `${pluginRoot}/.setup-complete`;\n  const setupDir = `${pluginRoot}/hooks/setup`;\n\n  logHook('setup-check', `Setup check starting (v${CURRENT_VERSION})`);\n\n  // Check trigger mode from argv\n  const args = process.argv;\n  if (args.includes('--init') || args.includes('init')) {\n    logHook('setup-check', 'Explicit --init: Running full setup');\n    // In TS we can't exec, but the bash wrapper will handle this\n    return {\n      continue: true,\n      systemMessage: 'Running first-run setup...',\n    };\n  }\n\n  if (args.includes('--init-only') || args.includes('init-only')) {\n    logHook('setup-check', 'CI/CD mode (--init-only): Running silent setup');\n    return {\n      continue: true,\n      systemMessage: 'Running silent setup...',\n    };\n  }\n\n  if (args.includes('--maintenance') || args.includes('maintenance')) {\n    logHook('setup-check', 'Explicit --maintenance: Running maintenance tasks');\n    return {\n      continue: true,\n      systemMessage: 'Running maintenance tasks...',\n    };\n  }\n\n  // Auto mode: Check marker file first (fast path)\n  if (!existsSync(markerFile)) {\n    logHook('setup-check', 'No marker file found - first run detected');\n\n    const hookEvent = input.hook_event || process.env.HOOK_EVENT;\n    if (hookEvent === 'Setup') {\n      return {\n        continue: true,\n        systemMessage: 'First run detected. Running setup...',\n      };\n    } else {\n      // SessionStart - inform user but don't block\n      const ctx = \"OrchestKit setup not complete. Run 'claude --init' to configure the plugin.\";\n      return outputWithContext(ctx);\n    }\n  }\n\n  // Marker exists - run quick validation\n  logHook('setup-check', 'Marker file exists - running quick validation');\n\n  const validationResult = quickValidate(pluginRoot);\n\n  switch (validationResult) {\n    case 0:\n      // All checks passed - check if maintenance is due\n      if (isMaintenanceDue(markerFile)) {\n        logHook('setup-check', 'Maintenance due - queueing background tasks');\n        // Run maintenance in background (spawn detached)\n        const maintenanceScript = `${setupDir}/setup-maintenance.sh`;\n        if (existsSync(maintenanceScript)) {\n          const child = spawn(maintenanceScript, ['--background'], {\n            detached: true,\n            stdio: 'ignore',\n          });\n          child.unref();\n        }\n      }\n\n      logHook('setup-check', 'Setup check passed (fast path)');\n      return outputSilentSuccess();\n\n    case 1:\n      // Validation failed - trigger repair in background\n      logHook('setup-check', 'Validation failed - triggering self-healing repair');\n      const repairScript = `${setupDir}/setup-repair.sh`;\n      if (existsSync(repairScript)) {\n        const child = spawn(repairScript, [], {\n          detached: true,\n          stdio: 'ignore',\n        });\n        child.unref();\n      }\n      return outputWithContext('OrchestKit setup validation failed. Repair running in background.');\n\n    case 2:\n      // Version mismatch - run migration in background\n      logHook('setup-check', 'Version mismatch - running migration');\n      const maintenanceScript = `${setupDir}/setup-maintenance.sh`;\n      if (existsSync(maintenanceScript)) {\n        const child = spawn(maintenanceScript, ['--migrate'], {\n          detached: true,\n          stdio: 'ignore',\n        });\n        child.unref();\n      }\n\n      updateMarker(markerFile, 'version', CURRENT_VERSION);\n      return outputWithContext(`OrchestKit upgraded to v${CURRENT_VERSION}.`);\n\n    default:\n      return outputSilentSuccess();\n  }\n}\n", "/**\n * Setup Maintenance - Periodic maintenance tasks\n * Hook: Setup (triggered by setup-check.sh or --maintenance flag)\n * CC 2.1.11 Compliant\n *\n * Tasks:\n * - Log rotation (daily)\n * - Stale lock cleanup (daily)\n * - Session archive (daily)\n * - Memory Fabric cleanup (daily)\n * - Metrics aggregation (weekly)\n * - Full health validation (weekly)\n * - Version migrations (on version change)\n */\n\nimport {\n  existsSync,\n  mkdirSync,\n  readFileSync,\n  writeFileSync,\n  renameSync,\n  readdirSync,\n  unlinkSync,\n  statSync,\n  chmodSync,\n} from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getPluginRoot, getProjectDir, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\nconst CURRENT_VERSION = '4.25.0';\n\nconst tasksCompleted: string[] = [];\n\n/**\n * Get marker field\n */\nfunction getMarkerField(markerFile: string, field: string): unknown {\n  if (!existsSync(markerFile)) {\n    return null;\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(markerFile, 'utf-8'));\n    return content[field.replace(/^\\./, '')];\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Update marker field\n */\nfunction updateMarkerField(markerFile: string, field: string, value: unknown): void {\n  if (!existsSync(markerFile)) {\n    return;\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(markerFile, 'utf-8'));\n    content[field.replace(/^\\./, '')] = value;\n    writeFileSync(markerFile, JSON.stringify(content, null, 2));\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Calculate hours since timestamp\n */\nfunction hoursSince(timestamp: string | null): number {\n  if (!timestamp) {\n    return 999;\n  }\n\n  try {\n    const lastEpoch = new Date(timestamp).getTime();\n    const nowEpoch = Date.now();\n    return (nowEpoch - lastEpoch) / (1000 * 60 * 60);\n  } catch {\n    return 999;\n  }\n}\n\n/**\n * Task: Log rotation\n */\nfunction taskLogRotation(pluginRoot: string): void {\n  logHook('setup-maintenance', 'Task: Log rotation');\n\n  const logDirs = [`${pluginRoot}/.claude/logs`, `${process.env.HOME || '/tmp'}/.claude/logs/ork`];\n\n  let rotated = 0;\n\n  for (const logDir of logDirs) {\n    if (!existsSync(logDir)) {\n      continue;\n    }\n\n    try {\n      const files = readdirSync(logDir);\n      for (const file of files) {\n        if (!file.endsWith('.log')) continue;\n\n        const filePath = `${logDir}/${file}`;\n        try {\n          const stats = statSync(filePath);\n          if (stats.size > 204800) {\n            // 200KB\n            const rotatedName = `${filePath}.old.${Date.now()}`;\n            renameSync(filePath, rotatedName);\n            rotated++;\n\n            // Try to gzip\n            try {\n              execSync(`gzip \"${rotatedName}\"`, { stdio: ['pipe', 'pipe', 'pipe'] });\n            } catch {\n              // gzip not available\n            }\n          }\n        } catch {\n          // Ignore file errors\n        }\n      }\n\n      // Clean up old rotated logs (keep last 5)\n      const rotatedLogs = files.filter((f) => f.includes('.log.old.')).sort().reverse();\n      for (const oldLog of rotatedLogs.slice(5)) {\n        try {\n          unlinkSync(`${logDir}/${oldLog}`);\n        } catch {\n          // Ignore\n        }\n      }\n    } catch {\n      // Ignore directory errors\n    }\n  }\n\n  if (rotated > 0) {\n    tasksCompleted.push(`Rotated ${rotated} log files`);\n  }\n}\n\n/**\n * Task: Stale lock cleanup\n */\nfunction taskStaleLockCleanup(pluginRoot: string): void {\n  logHook('setup-maintenance', 'Task: Stale lock cleanup');\n\n  const coordDb = `${pluginRoot}/.claude/coordination/.claude.db`;\n  let cleaned = 0;\n\n  if (existsSync(coordDb)) {\n    try {\n      execSync(`sqlite3 \"${coordDb}\" \"DELETE FROM file_locks WHERE datetime(acquired_at) < datetime('now', '-24 hours');\"`, {\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n\n      const lockCount = execSync(`sqlite3 \"${coordDb}\" \"SELECT COUNT(*) FROM file_locks;\"`, {\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }).trim();\n\n      logHook('setup-maintenance', `Coordination locks remaining: ${lockCount}`);\n      cleaned = 1;\n    } catch {\n      // Ignore SQLite errors\n    }\n  }\n\n  // Clean up .lock files older than 24 hours\n  try {\n    const walkAndClean = (dir: string, depth = 0) => {\n      if (depth > 3) return;\n      try {\n        const entries = readdirSync(dir, { withFileTypes: true });\n        for (const entry of entries) {\n          const fullPath = `${dir}/${entry.name}`;\n          if (entry.isDirectory() && !entry.name.startsWith('.')) {\n            walkAndClean(fullPath, depth + 1);\n          } else if (entry.name.endsWith('.lock')) {\n            try {\n              const stats = statSync(fullPath);\n              const ageHours = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60);\n              if (ageHours > 24) {\n                unlinkSync(fullPath);\n                cleaned++;\n              }\n            } catch {\n              // Ignore\n            }\n          }\n        }\n      } catch {\n        // Ignore\n      }\n    };\n    walkAndClean(pluginRoot);\n  } catch {\n    // Ignore\n  }\n\n  if (cleaned > 0) {\n    tasksCompleted.push('Cleaned stale locks');\n  }\n}\n\n/**\n * Task: Session cleanup\n */\nfunction taskSessionCleanup(pluginRoot: string): void {\n  logHook('setup-maintenance', 'Task: Session cleanup');\n\n  const sessionDir = `${pluginRoot}/.claude/context/sessions`;\n  const archiveDir = `${pluginRoot}/.claude/context/archive`;\n\n  if (!existsSync(sessionDir)) {\n    return;\n  }\n\n  let archived = 0;\n\n  try {\n    mkdirSync(archiveDir, { recursive: true });\n    const entries = readdirSync(sessionDir, { withFileTypes: true });\n\n    for (const entry of entries) {\n      if (!entry.isDirectory()) continue;\n\n      const fullPath = `${sessionDir}/${entry.name}`;\n      try {\n        const stats = statSync(fullPath);\n        const ageDays = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60 * 24);\n        if (ageDays > 7) {\n          renameSync(fullPath, `${archiveDir}/${entry.name}`);\n          archived++;\n        }\n      } catch {\n        // Ignore\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  // Clean up old temp files\n  try {\n    const entries = readdirSync('/tmp');\n    for (const entry of entries) {\n      if (!entry.startsWith('claude-session-')) continue;\n\n      const fullPath = `/tmp/${entry}`;\n      try {\n        const stats = statSync(fullPath);\n        const ageDays = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60 * 24);\n        if (ageDays > 7 && stats.isDirectory()) {\n          execSync(`rm -rf \"${fullPath}\"`, { stdio: ['pipe', 'pipe', 'pipe'] });\n        }\n      } catch {\n        // Ignore\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  if (archived > 0) {\n    tasksCompleted.push(`Archived ${archived} old sessions`);\n  }\n}\n\n/**\n * Task: Memory Fabric cleanup\n */\nfunction taskMemoryFabricCleanup(projectDir: string): void {\n  logHook('setup-maintenance', 'Task: Memory Fabric cleanup');\n\n  let cleaned = 0;\n  const logsDir = `${projectDir}/.claude/logs`;\n\n  // Clean up old pending sync files (older than 7 days)\n  if (existsSync(logsDir)) {\n    try {\n      const files = readdirSync(logsDir);\n      for (const file of files) {\n        if (!file.startsWith('.mem0-pending-sync-')) continue;\n\n        const fullPath = `${logsDir}/${file}`;\n        try {\n          const stats = statSync(fullPath);\n          const ageDays = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60 * 24);\n          if (ageDays > 7) {\n            unlinkSync(fullPath);\n            cleaned++;\n          }\n        } catch {\n          // Ignore\n        }\n      }\n    } catch {\n      // Ignore\n    }\n  }\n\n  // Clean up global pending sync if stale\n  const globalSync = `${process.env.HOME || '/tmp'}/.claude/.mem0-pending-sync.json`;\n  if (existsSync(globalSync)) {\n    try {\n      const stats = statSync(globalSync);\n      const ageHours = (Date.now() - stats.mtimeMs) / (1000 * 60 * 60);\n      if (ageHours > 24) {\n        unlinkSync(globalSync);\n        cleaned++;\n      }\n    } catch {\n      // Ignore\n    }\n  }\n\n  if (cleaned > 0) {\n    tasksCompleted.push(`Cleaned ${cleaned} Memory Fabric files`);\n  }\n}\n\n/**\n * Task: Health validation\n */\nfunction taskHealthValidation(pluginRoot: string, markerFile: string): void {\n  logHook('setup-maintenance', 'Task: Full health validation');\n\n  let issues = 0;\n\n  // Validate all hooks are executable\n  let nonExec = 0;\n  const checkExecutable = (dir: string, depth = 0) => {\n    if (depth > 4) return;\n    try {\n      const entries = readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        const fullPath = `${dir}/${entry.name}`;\n        if (entry.isDirectory() && !entry.name.startsWith('.')) {\n          checkExecutable(fullPath, depth + 1);\n        } else if (entry.name.endsWith('.sh')) {\n          try {\n            const stats = statSync(fullPath);\n            if (!(stats.mode & 0o111)) {\n              chmodSync(fullPath, 0o755);\n              nonExec++;\n            }\n          } catch {\n            // Ignore\n          }\n        }\n      }\n    } catch {\n      // Ignore\n    }\n  };\n\n  checkExecutable(`${pluginRoot}/hooks`);\n  if (nonExec > 0) {\n    logHook('setup-maintenance', `WARN: ${nonExec} hooks were not executable`);\n    issues++;\n  }\n\n  // Validate config.json\n  const configFile = `${pluginRoot}/.claude/defaults/config.json`;\n  if (existsSync(configFile)) {\n    try {\n      JSON.parse(readFileSync(configFile, 'utf-8'));\n    } catch {\n      logHook('setup-maintenance', 'WARN: config.json is invalid');\n      issues++;\n    }\n  }\n\n  // Update health check timestamp\n  updateMarkerField(markerFile, 'last_health_check', new Date().toISOString());\n\n  if (issues === 0) {\n    tasksCompleted.push('Health validation passed');\n  } else {\n    tasksCompleted.push(`Health validation found ${issues} issues (auto-fixed)`);\n  }\n}\n\n/**\n * Task: Version migration\n */\nfunction taskVersionMigration(markerFile: string): void {\n  logHook('setup-maintenance', 'Task: Version migration');\n\n  const markerVersion = getMarkerField(markerFile, 'version') as string | null;\n\n  if (!markerVersion || markerVersion === CURRENT_VERSION) {\n    return;\n  }\n\n  logHook('setup-maintenance', `Migrating from ${markerVersion} to ${CURRENT_VERSION}`);\n\n  // Version-specific migrations would go here\n  // For now, just log and update version\n\n  updateMarkerField(markerFile, 'version', CURRENT_VERSION);\n  tasksCompleted.push(`Migrated from ${markerVersion} to ${CURRENT_VERSION}`);\n}\n\n/**\n * Setup maintenance hook\n */\nexport function setupMaintenance(input: HookInput): HookResult {\n  const pluginRoot = getPluginRoot();\n  const projectDir = input.project_dir || getProjectDir();\n  const markerFile = `${pluginRoot}/.setup-complete`;\n\n  // Determine mode from argv\n  const args = process.argv;\n  let mode = 'auto';\n  if (args.includes('--force')) {\n    mode = 'force';\n  } else if (args.includes('--migrate')) {\n    mode = 'migrate';\n  } else if (args.includes('--background')) {\n    mode = 'background';\n  }\n\n  logHook('setup-maintenance', `Maintenance starting (mode: ${mode})`);\n\n  const now = new Date().toISOString();\n  const lastMaintenance = getMarkerField(markerFile, 'last_maintenance') as string | null;\n  const hours = hoursSince(lastMaintenance);\n\n  let runDaily = false;\n  let runWeekly = false;\n\n  switch (mode) {\n    case 'force':\n      runDaily = true;\n      runWeekly = true;\n      break;\n    case 'migrate':\n      taskVersionMigration(markerFile);\n      break;\n    case 'background':\n    case 'auto':\n      if (hours >= 24) {\n        runDaily = true;\n      }\n      if (hours >= 168) {\n        // 7 days\n        runWeekly = true;\n      }\n      break;\n  }\n\n  // Run daily tasks\n  if (runDaily) {\n    logHook('setup-maintenance', 'Running daily maintenance tasks');\n    taskLogRotation(pluginRoot);\n    taskStaleLockCleanup(pluginRoot);\n    taskSessionCleanup(pluginRoot);\n    taskMemoryFabricCleanup(projectDir);\n  }\n\n  // Run weekly tasks\n  if (runWeekly) {\n    logHook('setup-maintenance', 'Running weekly maintenance tasks');\n    taskHealthValidation(pluginRoot, markerFile);\n  }\n\n  // Update last maintenance timestamp\n  updateMarkerField(markerFile, 'last_maintenance', now);\n\n  // Build summary\n  if (tasksCompleted.length > 0) {\n    logHook('setup-maintenance', `Maintenance complete: ${tasksCompleted.length} tasks`);\n    const summary = `Completed: ${tasksCompleted.join(', ')}`;\n\n    if (mode === 'background') {\n      return outputSilentSuccess();\n    }\n\n    return outputWithContext(`Maintenance: ${summary}`);\n  }\n\n  logHook('setup-maintenance', 'No maintenance tasks needed');\n  return outputSilentSuccess();\n}\n", "/**\n * Setup Repair - Self-healing for broken installations\n *\n * INTERNAL HOOK: Called by setup-check when validation fails.\n * NOT registered in plugin.json (by design - it's a sub-hook).\n *\n * CC 2.1.11 Compliant\n *\n * Repair Actions:\n * - Restore missing/corrupt config files\n * - Fix hook permissions\n * - Regenerate marker file\n * - Run migrations for version mismatches\n */\n\nimport {\n  existsSync,\n  mkdirSync,\n  readFileSync,\n  writeFileSync,\n  renameSync,\n  readdirSync,\n  statSync,\n  chmodSync,\n} from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getPluginRoot, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\nconst CURRENT_VERSION = '4.25.0';\n\nconst repairsMade: string[] = [];\nconst repairsFailed: string[] = [];\nlet notifyUser = false;\n\n/**\n * Repair: Restore config.json\n */\nfunction repairConfig(pluginRoot: string): void {\n  const configFile = `${pluginRoot}/.claude/defaults/config.json`;\n  const configDir = `${pluginRoot}/.claude/defaults`;\n\n  // Ensure directory exists\n  try {\n    mkdirSync(configDir, { recursive: true });\n  } catch {\n    // Ignore\n  }\n\n  // Check if config exists and is valid\n  if (existsSync(configFile)) {\n    try {\n      JSON.parse(readFileSync(configFile, 'utf-8'));\n      return; // Config is valid\n    } catch {\n      // Backup corrupt config\n      const backup = `${configFile}.corrupt.${Date.now()}`;\n      try {\n        renameSync(configFile, backup);\n        logHook('setup-repair', `Backed up corrupt config to ${backup}`);\n        notifyUser = true;\n      } catch {\n        // Ignore rename errors\n      }\n    }\n  }\n\n  // Restore default config\n  const defaultConfig = {\n    preset: 'complete',\n    description: 'Full AI-assisted development toolkit (restored by repair)',\n    features: {\n      skills: true,\n      agents: true,\n      hooks: true,\n      mcp: true,\n      coordination: true,\n      statusline: true,\n    },\n    hook_groups: {\n      safety: true,\n      quality: true,\n      productivity: true,\n      observability: true,\n    },\n  };\n\n  writeFileSync(configFile, JSON.stringify(defaultConfig, null, 2));\n  repairsMade.push('config.json restored');\n  logHook('setup-repair', 'Restored default config.json');\n}\n\n/**\n * Repair: Fix hook permissions\n */\nfunction repairHookPermissions(pluginRoot: string): void {\n  let fixed = 0;\n\n  const fixPermissions = (dir: string, depth = 0) => {\n    if (depth > 5) return;\n\n    try {\n      const entries = readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        const fullPath = `${dir}/${entry.name}`;\n        if (entry.isDirectory() && !entry.name.startsWith('.')) {\n          fixPermissions(fullPath, depth + 1);\n        } else if (entry.name.endsWith('.sh')) {\n          try {\n            const stats = statSync(fullPath);\n            if (!(stats.mode & 0o111)) {\n              chmodSync(fullPath, 0o755);\n              fixed++;\n            }\n          } catch {\n            // Ignore\n          }\n        }\n      }\n    } catch {\n      // Ignore\n    }\n  };\n\n  fixPermissions(`${pluginRoot}/hooks`);\n\n  if (fixed > 0) {\n    repairsMade.push(`${fixed} hook permissions fixed`);\n    logHook('setup-repair', `Fixed permissions on ${fixed} hooks`);\n  }\n}\n\n/**\n * Repair: Ensure required directories exist\n */\nfunction repairDirectories(pluginRoot: string): void {\n  let dirsCreated = 0;\n\n  const requiredDirs = [\n    `${pluginRoot}/.claude/defaults`,\n    `${pluginRoot}/.claude/context/session`,\n    `${pluginRoot}/.claude/context/knowledge`,\n    `${pluginRoot}/.claude/logs`,\n    `${pluginRoot}/.claude/coordination`,\n  ];\n\n  for (const dir of requiredDirs) {\n    if (!existsSync(dir)) {\n      try {\n        mkdirSync(dir, { recursive: true });\n        dirsCreated++;\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  if (dirsCreated > 0) {\n    repairsMade.push(`${dirsCreated} directories created`);\n    logHook('setup-repair', `Created ${dirsCreated} missing directories`);\n  }\n}\n\n/**\n * Repair: Regenerate marker file\n */\nfunction repairMarker(pluginRoot: string): void {\n  const now = new Date().toISOString();\n\n  // Count components\n  let hookCount = 0;\n  let skillCount = 0;\n  let agentCount = 0;\n\n  const countFiles = (dir: string, pattern: RegExp, maxDepth = 5): number => {\n    let count = 0;\n    const walk = (d: string, depth: number) => {\n      if (depth > maxDepth) return;\n      try {\n        const entries = readdirSync(d, { withFileTypes: true });\n        for (const entry of entries) {\n          const fullPath = `${d}/${entry.name}`;\n          if (entry.isDirectory() && !entry.name.startsWith('.')) {\n            walk(fullPath, depth + 1);\n          } else if (pattern.test(entry.name)) {\n            count++;\n          }\n        }\n      } catch {\n        // Ignore\n      }\n    };\n    walk(dir, 0);\n    return count;\n  };\n\n  try {\n    hookCount = countFiles(`${pluginRoot}/hooks`, /\\.sh$/);\n    skillCount = countFiles(`${pluginRoot}/skills`, /SKILL\\.md$/);\n    agentCount = countFiles(`${pluginRoot}/agents`, /\\.md$/);\n  } catch {\n    // Ignore\n  }\n\n  const marker = {\n    version: CURRENT_VERSION,\n    setup_date: now,\n    preset: 'complete',\n    repaired_at: now,\n    components: {\n      hooks: { count: hookCount, valid: true },\n      skills: { count: skillCount, valid: true },\n      agents: { count: agentCount, valid: true },\n    },\n    last_health_check: now,\n    last_maintenance: now,\n    environment: {\n      os: process.platform,\n    },\n    user_preferences: {\n      onboarding_completed: true,\n      mcp_configured: false,\n      statusline_configured: false,\n    },\n  };\n\n  const markerFile = `${pluginRoot}/.setup-complete`;\n  writeFileSync(markerFile, JSON.stringify(marker, null, 2));\n  repairsMade.push('marker file regenerated');\n  logHook('setup-repair', 'Regenerated marker file');\n}\n\n/**\n * Check for critical missing components\n */\nfunction checkCriticalComponents(pluginRoot: string): boolean {\n  let criticalMissing = 0;\n\n  // Count hooks\n  let hookCount = 0;\n  try {\n    const countFiles = (dir: string): number => {\n      let count = 0;\n      const walk = (d: string, depth: number) => {\n        if (depth > 4) return;\n        try {\n          const entries = readdirSync(d, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${d}/${entry.name}`;\n            if (entry.isDirectory() && !entry.name.startsWith('.')) {\n              walk(fullPath, depth + 1);\n            } else if (entry.name.endsWith('.sh')) {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n      };\n      walk(dir, 0);\n      return count;\n    };\n    hookCount = countFiles(`${pluginRoot}/hooks`);\n  } catch {\n    // Ignore\n  }\n\n  if (hookCount < 20) {\n    logHook('setup-repair', `CRITICAL: Only ${hookCount} hooks found (expected 50+)`);\n    criticalMissing++;\n  }\n\n  // Count skills\n  let skillCount = 0;\n  try {\n    const countFiles = (dir: string): number => {\n      let count = 0;\n      const walk = (d: string, depth: number) => {\n        if (depth > 2) return;\n        try {\n          const entries = readdirSync(d, { withFileTypes: true });\n          for (const entry of entries) {\n            const fullPath = `${d}/${entry.name}`;\n            if (entry.isDirectory() && !entry.name.startsWith('.')) {\n              walk(fullPath, depth + 1);\n            } else if (entry.name === 'SKILL.md') {\n              count++;\n            }\n          }\n        } catch {\n          // Ignore\n        }\n      };\n      walk(dir, 0);\n      return count;\n    };\n    skillCount = countFiles(`${pluginRoot}/skills`);\n  } catch {\n    // Ignore\n  }\n\n  if (skillCount < 50) {\n    logHook('setup-repair', `CRITICAL: Only ${skillCount} skills found (expected 100+)`);\n    criticalMissing++;\n  }\n\n  // Check for common.sh library\n  if (!existsSync(`${pluginRoot}/hooks/_lib/common.sh`)) {\n    logHook('setup-repair', 'CRITICAL: hooks/_lib/common.sh missing');\n    criticalMissing++;\n  }\n\n  if (criticalMissing >= 2) {\n    repairsFailed.push('Multiple critical components missing - reinstall recommended');\n    notifyUser = true;\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Setup repair hook\n */\nexport function setupRepair(input: HookInput): HookResult {\n  const pluginRoot = getPluginRoot();\n\n  logHook('setup-repair', 'Setup repair starting');\n\n  // Run repairs in order of importance\n  repairDirectories(pluginRoot);\n  repairConfig(pluginRoot);\n  repairHookPermissions(pluginRoot);\n\n  // Check for critical missing components\n  if (!checkCriticalComponents(pluginRoot)) {\n    logHook('setup-repair', 'WARN: Critical components missing, repair incomplete');\n  }\n\n  // Regenerate marker file last (after other repairs)\n  repairMarker(pluginRoot);\n\n  // Build output message\n  let repairSummary = '';\n  if (repairsMade.length > 0) {\n    repairSummary = `Repairs: ${repairsMade.join(', ')}`;\n  }\n\n  if (repairsFailed.length > 0) {\n    repairSummary = `${repairSummary ? repairSummary + '. ' : ''}Issues: ${repairsFailed.join(', ')}`;\n    notifyUser = true;\n  }\n\n  logHook('setup-repair', `Repair complete: ${repairsMade.length} repairs made, ${repairsFailed.length} issues`);\n\n  // Output result\n  if (notifyUser && repairSummary) {\n    return outputWithContext(`OrchestKit auto-repair: ${repairSummary}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Block Writes - Blocks Write/Edit operations for read-only agents\n *\n * Used by: debug-investigator, code-quality-reviewer, ux-researcher,\n *          market-intelligence, system-design-reviewer\n *\n * Purpose: Enforce read-only boundaries for investigation/review agents\n *\n * CC 2.1.7 compliant output format\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny } from '../lib/common.js';\n\n/**\n * Block writes hook\n */\nexport function blockWrites(input: HookInput): HookResult {\n  const toolName = input.tool_name;\n  const agentId = process.env.CLAUDE_AGENT_ID || 'unknown';\n\n  // These tools are write operations that should be blocked\n  const writeTools = ['Write', 'Edit', 'MultiEdit', 'NotebookEdit'];\n\n  if (writeTools.includes(toolName)) {\n    // Block write operations\n    return outputDeny(\n      `BLOCKED: Agent '${agentId}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`\n    );\n  }\n\n  // Allow all other operations\n  return outputSilentSuccess();\n}\n", "/**\n * CI Safety Check - Validates CI/CD commands for safety\n *\n * Used by: ci-cd-engineer agent\n *\n * Purpose: Prevent dangerous CI/CD operations without confirmation\n *\n * CC 2.1.7 compliant output format\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny, outputWithContext } from '../lib/common.js';\n\n// Dangerous CI/CD patterns\nconst DANGEROUS_PATTERNS = [\n  /force.*push/i,\n  /push.*--force/i,\n  /--force-with-lease/i,\n  /workflow_dispatch/i,\n  /delete.*workflow/i,\n  /gh\\s+secret\\s+delete/i,\n  /gh\\s+variable\\s+delete/i,\n  /rm.*-rf.*\\.github/i,\n];\n\n/**\n * CI safety check hook\n */\nexport function ciSafetyCheck(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Check for dangerous CI/CD patterns\n  for (const pattern of DANGEROUS_PATTERNS) {\n    if (pattern.test(command)) {\n      return outputDeny(\n        `BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${pattern.source}'. This requires explicit user approval.`\n      );\n    }\n  }\n\n  // Warn on deployment-related commands\n  if (/deploy|release|publish/i.test(command)) {\n    return outputWithContext(\n      'CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place.'\n    );\n  }\n\n  // Allow other commands\n  return outputSilentSuccess();\n}\n", "/**\n * Deployment Safety Check - Validates deployment commands for safety\n *\n * Used by: deployment-manager agent\n *\n * Purpose: Prevent dangerous deployment operations without verification\n *\n * CC 2.1.7 compliant output format\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny, outputWithContext } from '../lib/common.js';\n\n// Production patterns that should be blocked\nconst PRODUCTION_PATTERNS = [\n  /\\bprod\\b/i,\n  /production/i,\n  /--env.*prod/i,\n  /ENV=prod/i,\n  /ENVIRONMENT=prod/i,\n  /deploy.*main/i,\n  /deploy.*master/i,\n];\n\n/**\n * Deployment safety check hook\n */\nexport function deploymentSafetyCheck(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Block production deployments without explicit markers\n  for (const pattern of PRODUCTION_PATTERNS) {\n    if (pattern.test(command)) {\n      return outputDeny(\n        `BLOCKED: Production deployment detected. Pattern: '${pattern.source}'. Production deployments require explicit user approval and should go through proper release processes.`\n      );\n    }\n  }\n\n  // Warn on rollback operations\n  if (/rollback|revert|downgrade/i.test(command)) {\n    return outputWithContext(\n      'Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed.'\n    );\n  }\n\n  // Warn on infrastructure changes\n  if (/terraform|kubectl|helm|docker.*push/i.test(command)) {\n    return outputWithContext(\n      'Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment.'\n    );\n  }\n\n  // Allow other commands\n  return outputSilentSuccess();\n}\n", "/**\n * Migration Safety Check - Validates database commands are safe\n *\n * Used by: database-engineer agent\n *\n * Purpose: Prevent destructive database operations without explicit confirmation\n *\n * CC 2.1.7 compliant output format\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, outputDeny } from '../lib/common.js';\n\n// Dangerous database patterns\nconst DANGEROUS_PATTERNS = [\n  /DROP\\s+TABLE/i,\n  /DROP\\s+DATABASE/i,\n  /TRUNCATE/i,\n  /DELETE\\s+FROM.*WHERE\\s+1/i,\n  /DELETE\\s+FROM\\s+[^W]*$/i, // DELETE without WHERE\n  /--force/i,\n  /alembic\\s+downgrade/i,\n];\n\n/**\n * Migration safety check hook\n */\nexport function migrationSafetyCheck(input: HookInput): HookResult {\n  const toolName = input.tool_name;\n\n  // Only check Bash commands\n  if (toolName !== 'Bash') {\n    return outputSilentSuccess();\n  }\n\n  const command = input.tool_input.command || '';\n\n  // Check for dangerous patterns\n  for (const pattern of DANGEROUS_PATTERNS) {\n    if (pattern.test(command)) {\n      return outputDeny(\n        `BLOCKED: Potentially destructive database command detected. Pattern: '${pattern.source}'. Please confirm this operation is intentional before proceeding.`\n      );\n    }\n  }\n\n  // Safe to proceed\n  return outputSilentSuccess();\n}\n", "/**\n * Security Command Audit - Extra audit logging for security agent operations\n *\n * Used by: security-auditor, security-layer-auditor agents\n *\n * Purpose: Log all Bash commands executed during security audits for compliance\n *\n * CC 2.1.7 compliant output format\n */\n\nimport { mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir, getSessionId } from '../lib/common.js';\n\n/**\n * Security command audit hook\n */\nexport function securityCommandAudit(input: HookInput): HookResult {\n  const agentId = process.env.CLAUDE_AGENT_ID || 'unknown';\n  const toolName = input.tool_name;\n  const sessionId = input.session_id || getSessionId();\n  const projectDir = input.project_dir || getProjectDir();\n\n  const logFile = `${projectDir}/.claude/logs/security-audit.log`;\n\n  // Only audit Bash commands\n  if (toolName !== 'Bash') {\n    return outputSilentSuccess();\n  }\n\n  const command = input.tool_input.command || '';\n  const timestamp = new Date().toISOString();\n\n  if (command) {\n    try {\n      // Create log directory if needed\n      mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n\n      // Log the command execution\n      appendFileSync(logFile, `[${timestamp}] [${sessionId}] [${agentId}] CMD: ${command}\\n`);\n    } catch {\n      // Ignore logging errors - don't block the operation\n    }\n  }\n\n  // Always continue - this is audit logging only\n  return outputSilentSuccess();\n}\n", "/**\n * Audit Logger - Logs all tool executions for audit trail\n * Hook: PostToolUse (*)\n * CC 2.1.7 Compliant\n */\n\nimport { appendFileSync, existsSync, mkdirSync, statSync, renameSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getLogDir, getField } from '../lib/common.js';\n\n// Track read count across invocations (per-session in memory)\nconst readCountFile = '/tmp/claude-read-count';\n\n/**\n * Log tool execution to audit file\n */\nexport function auditLogger(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Skip logging for high-frequency read operations to reduce noise\n  if (['Read', 'Glob', 'Grep'].includes(toolName)) {\n    try {\n      const { readFileSync, writeFileSync } = require('node:fs');\n      let readCount = 0;\n      try {\n        readCount = parseInt(readFileSync(readCountFile, 'utf8').trim(), 10) || 0;\n      } catch {\n        // File doesn't exist yet\n      }\n      readCount++;\n      writeFileSync(readCountFile, String(readCount));\n\n      if (readCount % 10 !== 0) {\n        return outputSilentSuccess();\n      }\n    } catch {\n      // Ignore count tracking errors\n    }\n  }\n\n  const projectDir = process.env.CLAUDE_PROJECT_DIR || '.';\n  const auditLog = `${projectDir}/.claude/logs/audit.log`;\n\n  try {\n    // Ensure log directory exists\n    const logDir = `${projectDir}/.claude/logs`;\n    if (!existsSync(logDir)) {\n      mkdirSync(logDir, { recursive: true });\n    }\n\n    // Rotate if needed (200KB limit)\n    rotateLogFile(auditLog, 200 * 1024);\n\n    const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n\n    // Get relevant details based on tool type\n    let details = '';\n    switch (toolName) {\n      case 'Bash': {\n        const cmd = getField<string>(input, 'tool_input.command') || '';\n        details = cmd.substring(0, 100);\n        break;\n      }\n      case 'Write':\n      case 'Edit': {\n        details = getField<string>(input, 'tool_input.file_path') || '';\n        break;\n      }\n      case 'Task': {\n        details = getField<string>(input, 'tool_input.subagent_type') || '';\n        break;\n      }\n    }\n\n    const logEntry = details\n      ? `[${timestamp}] ${toolName} | ${details}\\n`\n      : `[${timestamp}] ${toolName}\\n`;\n\n    appendFileSync(auditLog, logEntry);\n  } catch {\n    // Ignore logging errors - don't block hook execution\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Rotate log file if it exceeds size limit\n */\nfunction rotateLogFile(logFile: string, maxBytes: number): void {\n  if (!existsSync(logFile)) return;\n\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > maxBytes) {\n      const rotated = `${logFile}.old.${Date.now()}`;\n      renameSync(logFile, rotated);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n", "/**\n * Unified Error Handler - Consolidated error handling hook\n * Combines: error-collector + error-tracker + error-solution-suggester\n *\n * Hook: PostToolUse (*)\n *\n * Purpose:\n * 1. Detect errors from any tool (exit code, tool_error, output patterns)\n * 2. Log structured errors to JSONL for analysis\n * 3. Suggest solutions via additionalContext when patterns match\n *\n * CC 2.1.9 Compliant: Uses hookSpecificOutput.additionalContext\n * Version: 2.0.0 - Consolidated from 3 hooks (~500 LOC \u2192 ~200 LOC)\n */\n\nimport { existsSync, appendFileSync, readFileSync, writeFileSync, mkdirSync, statSync, renameSync } from 'node:fs';\nimport { createHash } from 'node:crypto';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir, getPluginRoot, getSessionId, getField, logHook } from '../lib/common.js';\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\n// Error detection regex (shared across all detection)\nconst ERROR_PATTERN = /error:|Error:|ERROR|FATAL|exception|failed|denied|not found|does not exist|connection refused|timeout|ENOENT|EACCES|EPERM/i;\n\n// Trivial commands that don't need tracking\nconst TRIVIAL_COMMANDS = /^(echo |ls |ls$|pwd|cat |head |tail |wc |date|whoami)/;\n\n// Configuration\nconst MAX_CONTEXT_CHARS = 2000;\nconst DEDUP_PROMPT_THRESHOLD = 10;\nconst MAX_SKILLS = 3;\nconst MAX_LOG_BYTES = 1000 * 1024; // 1MB\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\ninterface ErrorPattern {\n  id: string;\n  regex: string;\n  category?: string;\n  severity?: string;\n  skills?: string[];\n  solution?: {\n    brief?: string;\n    steps?: string[];\n  };\n}\n\ninterface SolutionsFile {\n  patterns: ErrorPattern[];\n  categories?: Record<string, { related_skills?: string[] }>;\n}\n\ninterface DedupFile {\n  suggestions: Record<string, { pattern_id: string; prompt_count: number }>;\n  prompt_count: number;\n}\n\ninterface ErrorInfo {\n  isError: boolean;\n  errorType: string;\n  errorMessage: string;\n  errorText: string;\n}\n\n// =============================================================================\n// ERROR DETECTION (from error-collector + error-tracker)\n// =============================================================================\n\nfunction detectError(input: HookInput): ErrorInfo {\n  const toolOutput = String(getField<unknown>(input, 'tool_output') || input.tool_output || '');\n  const toolError = String(input.tool_error || getField<string>(input, 'error') || '');\n  const exitCode = input.exit_code ?? 0;\n\n  let isError = false;\n  let errorType = '';\n  let errorMessage = '';\n\n  // Signal 1: Explicit non-zero exit code\n  if (exitCode !== 0 && exitCode !== undefined) {\n    isError = true;\n    errorType = 'exit_code';\n    errorMessage = `Exit code: ${exitCode}`;\n  }\n\n  // Signal 2: Error field present\n  if (toolError) {\n    isError = true;\n    errorType = errorType || 'tool_error';\n    errorMessage = errorMessage || toolError;\n  }\n\n  // Signal 3: Error patterns in output\n  if (ERROR_PATTERN.test(toolOutput)) {\n    isError = true;\n    errorType = errorType || 'output_pattern';\n    const errorLines = toolOutput.split('\\n').filter(line => ERROR_PATTERN.test(line));\n    errorMessage = errorMessage || errorLines[0] || '';\n  }\n\n  return {\n    isError,\n    errorType,\n    errorMessage,\n    errorText: toolError || toolOutput,\n  };\n}\n\n// =============================================================================\n// ERROR LOGGING (from error-collector)\n// =============================================================================\n\nfunction rotateLogFile(logFile: string): void {\n  if (!existsSync(logFile)) return;\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > MAX_LOG_BYTES) {\n      renameSync(logFile, `${logFile}.old.${Date.now()}`);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\nfunction logError(input: HookInput, errorInfo: ErrorInfo): void {\n  const projectDir = getProjectDir();\n  const errorLog = `${projectDir}/.claude/logs/errors.jsonl`;\n  const metricsFile = '/tmp/claude-session-errors.json';\n\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n    rotateLogFile(errorLog);\n\n    const inputHash = createHash('md5').update(JSON.stringify(input.tool_input || {})).digest('hex');\n\n    const errorRecord = {\n      timestamp: new Date().toISOString(),\n      tool: input.tool_name,\n      session_id: getSessionId(),\n      error_type: errorInfo.errorType,\n      error_message: errorInfo.errorMessage.substring(0, 500),\n      input_hash: inputHash,\n      tool_input: input.tool_input,\n      output_preview: errorInfo.errorText.substring(0, 1000),\n    };\n\n    appendFileSync(errorLog, JSON.stringify(errorRecord) + '\\n');\n\n    // Update session metrics\n    try {\n      let metrics = { error_count: 0, last_error_tool: '', last_error_time: '' };\n      if (existsSync(metricsFile)) {\n        metrics = JSON.parse(readFileSync(metricsFile, 'utf8'));\n      }\n      metrics.error_count = (metrics.error_count || 0) + 1;\n      metrics.last_error_tool = input.tool_name || '';\n      metrics.last_error_time = new Date().toISOString();\n      writeFileSync(metricsFile, JSON.stringify(metrics, null, 2));\n    } catch {\n      // Ignore metrics errors\n    }\n\n    logHook('unified-error-handler', `ERROR: ${input.tool_name} - ${errorInfo.errorType}`);\n  } catch {\n    logHook('unified-error-handler', `ERROR (fallback): ${input.tool_name}`);\n  }\n}\n\n// =============================================================================\n// SOLUTION SUGGESTIONS (from error-solution-suggester)\n// =============================================================================\n\nfunction matchErrorPattern(errorText: string, solutionsFile: string): ErrorPattern | null {\n  if (!existsSync(solutionsFile)) return null;\n\n  try {\n    const content: SolutionsFile = JSON.parse(readFileSync(solutionsFile, 'utf8'));\n    const errorLower = errorText.toLowerCase();\n\n    for (const pattern of content.patterns || []) {\n      if (pattern.regex) {\n        try {\n          if (new RegExp(pattern.regex, 'i').test(errorLower)) {\n            return pattern;\n          }\n        } catch {\n          // Invalid regex\n        }\n      }\n    }\n  } catch {\n    // Parse error\n  }\n  return null;\n}\n\nfunction shouldSuggest(patternId: string, errorContext: string, dedupFile: string): boolean {\n  if (!existsSync(dedupFile)) {\n    try {\n      mkdirSync(require('path').dirname(dedupFile), { recursive: true });\n      writeFileSync(dedupFile, JSON.stringify({ suggestions: {}, prompt_count: 0 }));\n    } catch {\n      return true;\n    }\n  }\n\n  try {\n    const dedup: DedupFile = JSON.parse(readFileSync(dedupFile, 'utf8'));\n    const suggestionHash = createHash('md5')\n      .update(`${patternId}|${errorContext.substring(0, 100)}`)\n      .digest('hex');\n\n    const currentCount = (dedup.prompt_count || 0) + 1;\n    dedup.prompt_count = currentCount;\n\n    const lastSuggestedAt = dedup.suggestions[suggestionHash]?.prompt_count || 0;\n\n    if (lastSuggestedAt === 0 || (currentCount - lastSuggestedAt) >= DEDUP_PROMPT_THRESHOLD) {\n      dedup.suggestions[suggestionHash] = { pattern_id: patternId, prompt_count: currentCount };\n      writeFileSync(dedupFile, JSON.stringify(dedup, null, 2));\n      return true;\n    }\n\n    writeFileSync(dedupFile, JSON.stringify(dedup, null, 2));\n    return false;\n  } catch {\n    return true;\n  }\n}\n\nfunction getSkillDescription(skillName: string, skillsDir: string): string {\n  const skillFile = `${skillsDir}/${skillName}/SKILL.md`;\n  if (!existsSync(skillFile)) return '';\n\n  try {\n    const content = readFileSync(skillFile, 'utf8');\n    const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\n    if (frontmatterMatch) {\n      const descMatch = frontmatterMatch[1].match(/description:\\s*(.+)/);\n      if (descMatch) return descMatch[1].trim();\n    }\n  } catch {\n    // Ignore\n  }\n  return '';\n}\n\nfunction buildSuggestionMessage(pattern: ErrorPattern, solutionsFile: string, skillsDir: string): string {\n  const brief = pattern.solution?.brief || 'An error was detected.';\n  const steps = pattern.solution?.steps || [];\n\n  let msg = '## Error Solution\\n\\n';\n  msg += `**${brief}**\\n\\n`;\n\n  if (steps.length > 0) {\n    msg += '### Quick Fixes\\n\\n';\n    steps.forEach((step, i) => {\n      msg += `  ${i + 1}. ${step}\\n`;\n    });\n    msg += '\\n';\n  }\n\n  // Get skills\n  const patternSkills = pattern.skills || [];\n  let categorySkills: string[] = [];\n  if (pattern.category && existsSync(solutionsFile)) {\n    try {\n      const content: SolutionsFile = JSON.parse(readFileSync(solutionsFile, 'utf8'));\n      categorySkills = content.categories?.[pattern.category]?.related_skills || [];\n    } catch {\n      // Ignore\n    }\n  }\n\n  const allSkills = [...new Set([...patternSkills, ...categorySkills])].slice(0, MAX_SKILLS);\n\n  if (allSkills.length > 0) {\n    msg += '### Related Skills\\n\\n';\n    for (const skill of allSkills) {\n      const desc = getSkillDescription(skill, skillsDir);\n      msg += desc ? `- **${skill}**: ${desc}\\n` : `- **${skill}**\\n`;\n    }\n    msg += '\\nUse `/ork:<skill-name>` or `Read skills/<skill-name>/SKILL.md`';\n  }\n\n  return msg.length > MAX_CONTEXT_CHARS ? msg.substring(0, MAX_CONTEXT_CHARS - 20) + '...\\n\\n(truncated)' : msg;\n}\n\n// =============================================================================\n// MAIN HOOK\n// =============================================================================\n\nexport function unifiedErrorHandler(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Self-guard: Skip trivial bash commands\n  if (toolName === 'Bash') {\n    const command = getField<string>(input, 'tool_input.command') || '';\n    if (TRIVIAL_COMMANDS.test(command)) {\n      return outputSilentSuccess();\n    }\n  }\n\n  // Detect if this was an error\n  const errorInfo = detectError(input);\n\n  if (!errorInfo.isError) {\n    return outputSilentSuccess();\n  }\n\n  // Log the error (always)\n  logError(input, errorInfo);\n\n  // Try to suggest solutions (Bash only, with dedup)\n  if (toolName === 'Bash') {\n    const pluginRoot = getPluginRoot();\n    const solutionsFile = `${pluginRoot}/.claude/rules/error_solutions.json`;\n    const skillsDir = `${pluginRoot}/skills`;\n    const dedupFile = `/tmp/claude-error-suggestions-${getSessionId()}.json`;\n\n    const matchedPattern = matchErrorPattern(errorInfo.errorText.substring(0, 2000), solutionsFile);\n\n    if (matchedPattern && shouldSuggest(matchedPattern.id, errorInfo.errorText, dedupFile)) {\n      const suggestionMessage = buildSuggestionMessage(matchedPattern, solutionsFile, skillsDir);\n\n      if (suggestionMessage) {\n        logHook('unified-error-handler', `Suggesting solution for pattern: ${matchedPattern.id}`);\n        return {\n          continue: true,\n          hookSpecificOutput: {\n            additionalContext: suggestionMessage,\n          },\n        };\n      }\n    }\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Auto-Lint Hook - PostToolUse hook for Write/Edit\n * CC 2.1.7 Compliant\n *\n * Automatically runs linters after file writes:\n * - Python: ruff check + format (Astral toolchain)\n * - JS/TS: biome check (Rust-based)\n * - JSON/CSS: biome format\n */\n\nimport { existsSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getField, logHook } from '../lib/common.js';\n\n/**\n * Get language from file extension\n */\nfunction getLanguage(filePath: string): string | null {\n  const ext = filePath.split('.').pop()?.toLowerCase();\n  switch (ext) {\n    case 'py':\n      return 'python';\n    case 'ts':\n    case 'tsx':\n      return 'typescript';\n    case 'js':\n    case 'jsx':\n      return 'javascript';\n    case 'json':\n      return 'json';\n    case 'css':\n    case 'scss':\n      return 'css';\n    default:\n      return null;\n  }\n}\n\n/**\n * Check if a command exists\n */\nfunction commandExists(cmd: string): boolean {\n  try {\n    execSync(`which ${cmd}`, { stdio: 'ignore' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Run auto-lint on written files\n */\nexport function autoLint(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Self-guard: Only run for Write/Edit\n  if (toolName !== 'Write' && toolName !== 'Edit') {\n    return outputSilentSuccess();\n  }\n\n  const filePath = getField<string>(input, 'tool_input.file_path') || '';\n\n  // Skip internal files\n  if (!filePath || filePath.includes('/.claude/') ||\n      filePath.includes('/node_modules/') ||\n      filePath.includes('/.git/') ||\n      filePath.includes('/dist/') ||\n      filePath.endsWith('.lock')) {\n    return outputSilentSuccess();\n  }\n\n  // Check if file exists\n  const projectDir = process.env.CLAUDE_PROJECT_DIR || '.';\n  const fullPath = filePath.startsWith('/') ? filePath : `${projectDir}/${filePath}`;\n\n  if (!existsSync(fullPath)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip if SKIP_AUTO_LINT is set\n  if (process.env.SKIP_AUTO_LINT === '1') {\n    return outputSilentSuccess();\n  }\n\n  const language = getLanguage(filePath);\n  if (!language) {\n    return outputSilentSuccess();\n  }\n\n  let lintIssues = 0;\n  let fixesApplied = false;\n\n  try {\n    switch (language) {\n      case 'python':\n        if (commandExists('ruff')) {\n          try {\n            const ruffCheck = execSync(`timeout 5s ruff check --output-format=concise \"${fullPath}\" 2>&1`, {\n              encoding: 'utf8',\n              stdio: ['pipe', 'pipe', 'pipe'],\n            });\n            if (ruffCheck) {\n              lintIssues = ruffCheck.split('\\n').filter(Boolean).length;\n              execSync(`timeout 5s ruff check --fix --unsafe-fixes=false \"${fullPath}\" 2>/dev/null`, {\n                stdio: 'ignore',\n              });\n              fixesApplied = true;\n            }\n          } catch {\n            // ruff check returns non-zero when issues found\n          }\n          try {\n            execSync(`timeout 5s ruff format \"${fullPath}\" 2>/dev/null`, { stdio: 'ignore' });\n          } catch {\n            // Ignore format errors\n          }\n        }\n        break;\n\n      case 'typescript':\n      case 'javascript':\n        if (commandExists('biome')) {\n          try {\n            const biomeOut = execSync(`timeout 5s biome check --write \"${fullPath}\" 2>&1`, {\n              encoding: 'utf8',\n              stdio: ['pipe', 'pipe', 'pipe'],\n            });\n            if (biomeOut.includes('Fixed')) {\n              fixesApplied = true;\n            }\n            if (biomeOut.includes('error')) {\n              lintIssues = (biomeOut.match(/error/g) || []).length;\n            }\n          } catch {\n            // Ignore biome errors\n          }\n        }\n        break;\n\n      case 'json':\n      case 'css':\n        if (commandExists('biome')) {\n          try {\n            execSync(`timeout 5s biome format --write \"${fullPath}\" 2>/dev/null`, {\n              stdio: 'ignore',\n            });\n            fixesApplied = true;\n          } catch {\n            // Ignore format errors\n          }\n        }\n        break;\n    }\n  } catch (error) {\n    logHook('auto-lint', `Error: ${error}`);\n  }\n\n  // Build output message\n  if (fixesApplied && lintIssues > 0) {\n    const basename = filePath.split('/').pop();\n    return {\n      continue: true,\n      systemMessage: `Auto-lint: fixed issues, ${lintIssues} remaining in ${basename}`,\n    };\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Context Budget Monitor - After Tool Use Hook\n * Monitors context usage and triggers compression when threshold exceeded\n *\n * Triggers compression at 70% budget utilization\n * Target after compression: 50%\n *\n * Version: 2.0.0\n * Part of Context Engineering 2.0\n */\n\nimport { existsSync, readFileSync, writeFileSync, statSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir, getSessionId, logHook } from '../lib/common.js';\n\n// Configuration\nconst BUDGET_TOTAL = 2200; // Total token budget for context layer\nconst COMPRESS_TRIGGER = 0.70; // Trigger compression at 70%\nconst COMPRESS_TARGET = 0.50; // Target 50% after compression\nconst MCP_DEFER_TRIGGER = 0.10; // Defer MCP tools when context >10% of effective window\n\n/**\n * Estimate tokens from file content (~4 chars per token)\n */\nfunction estimateTokens(filePath: string): number {\n  if (!existsSync(filePath)) return 0;\n\n  try {\n    const stats = statSync(filePath);\n    return Math.floor(stats.size / 4);\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Calculate total loaded context\n */\nfunction calculateUsage(): number {\n  const projectDir = getProjectDir();\n  const contextDir = `${projectDir}/context`;\n\n  const alwaysLoadedFiles = [\n    `${contextDir}/identity.json`,\n    `${contextDir}/session/state.json`,\n    `${contextDir}/knowledge/index.json`,\n    `${contextDir}/knowledge/blockers/current.json`,\n  ];\n\n  let total = 0;\n  for (const file of alwaysLoadedFiles) {\n    total += estimateTokens(file);\n  }\n\n  return total;\n}\n\n/**\n * Get effective context window (actual usable vs static max)\n */\nfunction getEffectiveContextWindow(): number {\n  const baseWindow = parseInt(process.env.CLAUDE_MAX_CONTEXT || '200000', 10);\n  const overheadPercent = 20; // ~20% system overhead\n  return Math.floor(baseWindow * (100 - overheadPercent) / 100);\n}\n\n/**\n * Check if MCP tools should be deferred\n */\nfunction shouldDeferMcp(currentTokens: number): boolean {\n  const effectiveWindow = getEffectiveContextWindow();\n  if (effectiveWindow === 0) return true;\n\n  const usageRatio = currentTokens / effectiveWindow;\n  return usageRatio > MCP_DEFER_TRIGGER;\n}\n\n/**\n * Update MCP deferral state file\n */\nfunction updateMcpDeferState(shouldDefer: boolean, currentTokens: number): void {\n  const sessionId = getSessionId();\n  const stateFile = `/tmp/claude-mcp-defer-state-${sessionId}.json`;\n  const effectiveWindow = getEffectiveContextWindow();\n\n  const state = {\n    mcp_deferred: shouldDefer,\n    context_tokens: currentTokens,\n    effective_window: effectiveWindow,\n    updated_at: new Date().toISOString(),\n    reason: shouldDefer ? 'context > 10% threshold' : 'context within limits',\n  };\n\n  try {\n    writeFileSync(stateFile, JSON.stringify(state, null, 2));\n  } catch {\n    // Ignore write errors\n  }\n\n  logHook('context-budget-monitor',\n    `MCP defer state updated: defer=${shouldDefer}, tokens=${currentTokens}, window=${effectiveWindow}`);\n}\n\n/**\n * Compress session state\n */\nfunction compressSession(): void {\n  const projectDir = getProjectDir();\n  const sessionFile = `${projectDir}/context/session/state.json`;\n\n  if (!existsSync(sessionFile)) return;\n\n  try {\n    const content = JSON.parse(readFileSync(sessionFile, 'utf8'));\n\n    const compressed = {\n      session_id: content.session_id,\n      started: content.started,\n      current_task: content.current_task,\n      next_steps: (content.next_steps || []).slice(-3),\n      blockers: content.blockers,\n      _compressed: true,\n      _compressed_at: new Date().toISOString(),\n      _original_files_touched: (content.files_touched || []).length,\n      _original_decisions: (content.decisions_this_session || []).length,\n    };\n\n    writeFileSync(sessionFile, JSON.stringify(compressed, null, 2));\n    logHook('context-budget-monitor', 'Session state compressed');\n  } catch {\n    // Ignore compression errors\n  }\n}\n\n/**\n * Archive old decisions\n */\nfunction archiveOldDecisions(): void {\n  const projectDir = getProjectDir();\n  const decisionsFile = `${projectDir}/context/knowledge/decisions/active.json`;\n\n  if (!existsSync(decisionsFile)) return;\n\n  try {\n    const content = JSON.parse(readFileSync(decisionsFile, 'utf8'));\n    const decisions = content.decisions || [];\n\n    if (decisions.length > 10) {\n      logHook('context-budget-monitor', 'Archiving old decisions (keeping latest 5)...');\n\n      // Create archive directory\n      const archiveDir = `${projectDir}/context/archive/decisions`;\n      mkdirSync(archiveDir, { recursive: true });\n\n      // Archive older decisions\n      const date = new Date();\n      const archiveFile = `${archiveDir}/${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}.json`;\n      writeFileSync(archiveFile, JSON.stringify(decisions.slice(0, -5), null, 2));\n\n      // Keep only latest 5\n      content.decisions = decisions.slice(-5);\n      writeFileSync(decisionsFile, JSON.stringify(content, null, 2));\n\n      logHook('context-budget-monitor', `Archived ${decisions.length - 5} decisions to ${archiveFile}`);\n    }\n  } catch {\n    // Ignore archive errors\n  }\n}\n\n/**\n * Monitor context budget and trigger compression if needed\n */\nexport function contextBudgetMonitor(_input: HookInput): HookResult {\n  try {\n    const currentTokens = calculateUsage();\n\n    // Guard against division by zero\n    const usageRatio = currentTokens / BUDGET_TOTAL;\n    const usagePercent = Math.floor(usageRatio * 100);\n\n    logHook('context-budget-monitor',\n      `Context usage: ${currentTokens} / ${BUDGET_TOTAL} tokens (${usagePercent}%)`);\n\n    // CC 2.1.7: Check and update MCP deferral state\n    const deferMcp = shouldDeferMcp(currentTokens);\n    updateMcpDeferState(deferMcp, currentTokens);\n\n    // Check if compression needed\n    if (usageRatio > COMPRESS_TRIGGER) {\n      logHook('context-budget-monitor',\n        `WARNING: Context usage (${usagePercent}%) exceeds threshold (${COMPRESS_TRIGGER * 100}%)`);\n      logHook('context-budget-monitor', 'Triggering compression...');\n\n      // Compress session state\n      compressSession();\n\n      // Archive old decisions\n      archiveOldDecisions();\n\n      // Recalculate\n      const newTokens = calculateUsage();\n      const newRatio = newTokens / BUDGET_TOTAL;\n      const newPercent = Math.floor(newRatio * 100);\n\n      logHook('context-budget-monitor',\n        `After compression: ${newTokens} / ${BUDGET_TOTAL} tokens (${newPercent}%)`);\n\n      if (newRatio > COMPRESS_TARGET) {\n        logHook('context-budget-monitor',\n          'WARNING: Still above target. Manual review recommended.');\n      } else {\n        logHook('context-budget-monitor', 'Compression successful. Target achieved.');\n      }\n    } else {\n      logHook('context-budget-monitor', 'Context usage within budget. No compression needed.');\n    }\n  } catch (error) {\n    logHook('context-budget-monitor', `Error: ${error}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Coordination Heartbeat - Update heartbeat after each tool use\n * Hook: PostToolUse (*)\n * CC 2.1.6 Compliant: ensures JSON output on all code paths\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getProjectDir, logHook } from '../lib/common.js';\n\n/**\n * Update coordination heartbeat\n */\nexport function coordinationHeartbeat(_input: HookInput): HookResult {\n  const projectDir = getProjectDir();\n  const coordLib = `${projectDir}/.claude/coordination/lib/coordination.sh`;\n\n  // Check if coordination lib exists\n  if (!existsSync(coordLib)) {\n    return outputSilentSuccess();\n  }\n\n  try {\n    // Load instance ID if available\n    // CC 2.1.9+ should guarantee CLAUDE_SESSION_ID availability,\n    // but we add a defensive fallback to prevent crashes.\n    const instanceEnv = `${projectDir}/.claude/.instance_env`;\n    let instanceId = process.env.CLAUDE_SESSION_ID || `fallback-${process.pid}`;\n\n    if (existsSync(instanceEnv)) {\n      const content = readFileSync(instanceEnv, 'utf8');\n      const match = content.match(/CLAUDE_INSTANCE_ID=[\"']?([^\"'\\n]+)/);\n      if (match) {\n        instanceId = match[1];\n      }\n    }\n\n    // Update heartbeat (lightweight operation)\n    if (instanceId) {\n      execSync(\n        `source \"${coordLib}\" && INSTANCE_ID=\"${instanceId}\" coord_heartbeat 2>/dev/null || true`,\n        {\n          shell: '/bin/bash',\n          stdio: 'ignore',\n          timeout: 5000,\n        }\n      );\n    }\n  } catch (error) {\n    // Coordination update failed, but don't block execution\n    logHook('coordination-heartbeat', `Heartbeat update failed: ${error}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Webhook Handler - Process incoming webhook events\n * Hook: PostToolUse (for bash/webhook-receiver.py calls)\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Processes webhook events from mem0\n * - Routes to appropriate workflows\n * - Triggers auto-sync, decision sync, cleanup\n *\n * Version: 1.0.0\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getField, logHook } from '../lib/common.js';\n\n/**\n * Handle incoming mem0 webhook events\n */\nexport function mem0WebhookHandler(input: HookInput): HookResult {\n  logHook('mem0-webhook-handler', 'Mem0 webhook handler starting');\n\n  const toolName = input.tool_name || '';\n  const command = getField<string>(input, 'tool_input.command') || '';\n\n  // Only process webhook-receiver.py calls\n  if (toolName !== 'Bash' || !command.includes('webhook-receiver.py')) {\n    return outputSilentSuccess();\n  }\n\n  // Extract event data from command output or tool result\n  const eventDataStr = getField<string>(input, 'tool_result') || '';\n\n  if (!eventDataStr) {\n    logHook('mem0-webhook-handler', 'No event data found in webhook call');\n    return outputSilentSuccess();\n  }\n\n  try {\n    // Parse event data\n    let eventData: Record<string, unknown>;\n    try {\n      eventData = JSON.parse(eventDataStr);\n    } catch {\n      logHook('mem0-webhook-handler', 'Could not parse event data');\n      return outputSilentSuccess();\n    }\n\n    // Parse event type\n    const eventType = (eventData.result as Record<string, unknown>)?.event_type ||\n                     eventData.event_type || '';\n    const memoryId = (eventData.result as Record<string, unknown>)?.memory_id ||\n                    (eventData.memory as Record<string, unknown>)?.id || '';\n\n    logHook('mem0-webhook-handler', `Processing webhook event: ${eventType} (memory: ${memoryId})`);\n\n    // Log event for observability \u2014 actual sync is handled by dedicated hooks\n    // (memory-bridge.ts for graph sync, mem0-pre-compaction-sync.ts for decision sync)\n    // This handler logs webhook events for audit trail purposes.\n    const knownEvents = ['memory.created', 'memory.updated', 'memory.deleted'];\n    if (knownEvents.includes(eventType as string)) {\n      logHook('mem0-webhook-handler', `Received ${eventType} for memory ${memoryId}`);\n    } else {\n      logHook('mem0-webhook-handler', `Received unknown event type: ${eventType}`);\n    }\n  } catch (error) {\n    logHook('mem0-webhook-handler', `Error processing webhook: ${error}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Bridge Hook - Graph-First Memory Sync\n * Triggers on PostToolUse for mcp__mem0__add_memory\n *\n * Graph-First Architecture (v2.1):\n * - Graph is AUTHORITATIVE - always the source of truth\n * - When mem0 is used, ALWAYS sync TO graph (preserve in local storage)\n * - When graph is used (default), NO sync needed (already in primary)\n *\n * Sync Direction: Mem0 -> Graph ONLY (one-way)\n * - mcp__mem0__add_memory -> Extract entities, sync to graph\n * - mcp__memory__create_entities -> No action needed (already in primary)\n *\n * Version: 2.1.1 - CC 2.1.9/2.1.11 compliant, Graph-First Architecture\n * Part of Memory Fabric v2.1 - Graph-First Architecture\n */\n\nimport { existsSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getField, getPluginRoot, logHook } from '../lib/common.js';\n\n// Entity type mapping patterns\nconst ENTITY_PATTERNS: Record<string, RegExp> = {\n  Technology: /fastapi|react|typescript|python|postgres|redis|docker|kubernetes|langchain|langgraph|pgvector|qdrant|openai|anthropic|celery|rabbitmq|kafka|nginx|vite|tailwind|prisma|sqlalchemy|alembic|pydantic|zod/i,\n  Pattern: /singleton|factory|repository|service|controller|adapter|facade|strategy|observer|decorator|middleware|dependency.injection|cursor.pagination|rate.limiting|circuit.breaker/i,\n  Decision: /decided|chose|selected|will.use|adopted|standardized|migrated/i,\n  Architecture: /microservice|monolith|event.driven|cqrs|event.sourcing|hexagonal|clean.architecture|ddd|api.gateway|load.balancer/i,\n  Database: /postgresql|mysql|mongodb|sqlite|dynamodb|cassandra|schema|migration|index|query/i,\n  Security: /jwt|oauth|cors|csrf|xss|sql.injection|rate.limit|encryption|authentication|authorization/i,\n};\n\ninterface Entity {\n  name: string;\n  entityType: string;\n  observations: string[];\n}\n\ninterface Relation {\n  from: string;\n  to: string;\n  relationType: string;\n}\n\n/**\n * Extract entities from text (Mem0 -> Graph)\n */\nfunction extractEntitiesFromText(text: string): Entity[] {\n  const textLower = text.toLowerCase();\n  const entities: Entity[] = [];\n\n  for (const [entityType, pattern] of Object.entries(ENTITY_PATTERNS)) {\n    const matches = textLower.match(pattern);\n    if (matches) {\n      for (const match of [...new Set(matches)].slice(0, 5)) {\n        // Capitalize first letter for entity name\n        const entityName = match\n          .split(/[\\s-_]+/)\n          .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n          .join('-');\n\n        // Build observation from surrounding context\n        let observation = 'Used in project context';\n        if (/decided.*/.test(textLower) && textLower.includes(match)) {\n          observation = 'Decided to use for project';\n        } else if (/chose.*/.test(textLower) && textLower.includes(match)) {\n          observation = 'Chosen for implementation';\n        } else if (/will.use.*/.test(textLower) && textLower.includes(match)) {\n          observation = 'Will be used in project';\n        }\n\n        entities.push({\n          name: entityName,\n          entityType,\n          observations: [observation],\n        });\n      }\n    }\n  }\n\n  return entities;\n}\n\n/**\n * Extract relations from text\n */\nfunction extractRelationsFromText(text: string, entities: Entity[]): Relation[] {\n  const textLower = text.toLowerCase();\n  const relations: Relation[] = [];\n  const entityNames = entities.map(e => e.name);\n\n  for (const entity1 of entityNames) {\n    const entity1Lower = entity1.toLowerCase().replace(/-/g, '.');\n\n    for (const entity2 of entityNames) {\n      if (entity1 === entity2) continue;\n\n      const entity2Lower = entity2.toLowerCase().replace(/-/g, '.');\n      const relationPattern = new RegExp(\n        `${entity1Lower}.*(with|using|and|integrated|connected|for).*${entity2Lower}`,\n        'i'\n      );\n\n      if (relationPattern.test(textLower)) {\n        relations.push({\n          from: entity1,\n          to: entity2,\n          relationType: 'uses',\n        });\n      }\n    }\n  }\n\n  return relations;\n}\n\n/**\n * Sync memory from Mem0 to knowledge graph\n */\nexport function memoryBridge(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process memory-related tools\n  switch (toolName) {\n    case 'mcp__mem0__add_memory': {\n      // Graph-First: Sync mem0 content TO graph (preserve in primary storage)\n      logHook('memory-bridge', 'Processing mcp__mem0__add_memory - syncing to graph (primary)');\n\n      // Get the text that was added\n      const memoryText = getField<string>(input, 'tool_input.text') || '';\n\n      if (!memoryText || memoryText.length < 20) {\n        logHook('memory-bridge', 'Memory text too short, skipping');\n        return outputSilentSuccess();\n      }\n\n      // Check for Memory Fabric Agent\n      const pluginRoot = getPluginRoot();\n      const memoryAgent = `${pluginRoot}/bin/memory-fabric-agent.py`;\n      const hasAgentSdk = existsSync(memoryAgent);\n\n      if (hasAgentSdk) {\n        logHook('memory-bridge', 'Memory Fabric Agent available for bidirectional sync');\n        // Agent SDK would be invoked here for smart entity extraction\n        // For now, fall through to regex extraction\n      }\n\n      // Fallback: Use regex-based extraction\n      const entities = extractEntitiesFromText(memoryText);\n      const entityCount = entities.length;\n\n      if (entityCount === 0) {\n        logHook('memory-bridge', 'No entities extracted');\n        return outputSilentSuccess();\n      }\n\n      // Extract relations\n      const relations = extractRelationsFromText(memoryText, entities);\n      const relationCount = relations.length;\n\n      logHook('memory-bridge', `Extracted ${entityCount} entities and ${relationCount} relations`);\n\n      // Format suggestion message\n      const entityList = entities\n        .slice(0, 5)\n        .map(e => `- ${e.name} (${e.entityType}): ${e.observations[0] || 'observed'}`)\n        .join('\\n');\n\n      let msg = `[Memory Bridge] Sync to Graph (primary storage)\n\nMem0 content should be synced to the knowledge graph for durability.\nDetected ${entityCount} entities to preserve:\n\n${entityList}\n\nStore in graph with mcp__memory__create_entities:\n\\`\\`\\`json\n{\"entities\": ${JSON.stringify(entities)}}\n\\`\\`\\``;\n\n      if (relationCount > 0) {\n        msg += `\n\nThen call mcp__memory__create_relations with:\n\\`\\`\\`json\n{\"relations\": ${JSON.stringify(relations)}}\n\\`\\`\\``;\n      }\n\n      return {\n        continue: true,\n        systemMessage: msg,\n      };\n    }\n\n    case 'mcp__memory__create_entities':\n      // Graph-First: No sync needed when writing to graph (it's already the primary)\n      logHook('memory-bridge', 'mcp__memory__create_entities - graph is primary, no sync needed');\n      return outputSilentSuccess();\n\n    default:\n      // Not a memory tool, skip\n      return outputSilentSuccess();\n  }\n}\n", "/**\n * Realtime Sync Hook - Graph-First Priority-based immediate memory persistence\n * Triggers on PostToolUse for Bash, Write, and Skill completions\n *\n * Purpose: Sync critical decisions immediately to knowledge graph\n *\n * Graph-First Architecture (v2.1):\n * - IMMEDIATE syncs target knowledge graph (mcp__memory__*) - always works\n * - mem0 cloud sync only if API key present AND critical priority\n *\n * Priority Classification:\n * - IMMEDIATE: \"decided\", \"chose\", \"architecture\", \"security\", \"blocked\", \"breaking\"\n * - BATCHED: \"pattern\", \"convention\", \"preference\"\n * - SESSION_END: Everything else (handled by existing Stop hooks)\n *\n * Version: 2.1.0 - CC 2.1.9/2.1.11 compliant, Graph-First Architecture\n * Part of Memory Fabric v2.1 - Graph-First Architecture\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getField, getProjectDir, getSessionId, logHook } from '../lib/common.js';\n\n// Priority keywords\nconst IMMEDIATE_KEYWORDS = /decided|chose|architecture|security|blocked|breaking|critical|must|cannot|deprecated|removed|migration/i;\nconst BATCHED_KEYWORDS = /pattern|convention|preference|style|format|naming/i;\n\n// Minimum content length to consider\nconst MIN_CONTENT_LENGTH = 30;\n\n// Context pressure thresholds\nconst CONTEXT_EMERGENCY_THRESHOLD = 85;\nconst CONTEXT_CRITICAL_THRESHOLD = 90;\n\ninterface PendingItem {\n  content: string;\n  category: string;\n  queued_at: string;\n}\n\ninterface PendingFile {\n  pending: PendingItem[];\n  created_at: string;\n}\n\n/**\n * Get current context usage percentage\n */\nfunction getContextPressure(): number {\n  const pressure = parseInt(process.env.CLAUDE_CONTEXT_USED_PERCENTAGE || '0', 10);\n\n  if (pressure === 0) {\n    const tokensUsed = parseInt(process.env.CLAUDE_CONTEXT_TOKENS_USED || '0', 10);\n    const maxTokens = parseInt(process.env.CLAUDE_CONTEXT_MAX_TOKENS || '0', 10);\n    if (maxTokens > 0) {\n      return Math.floor((tokensUsed * 100) / maxTokens);\n    }\n  }\n\n  return pressure;\n}\n\n/**\n * Classify priority of content\n */\nfunction classifyPriority(content: string): 'IMMEDIATE' | 'BATCHED' | 'SESSION_END' {\n  if (IMMEDIATE_KEYWORDS.test(content)) {\n    return 'IMMEDIATE';\n  }\n  if (BATCHED_KEYWORDS.test(content)) {\n    return 'BATCHED';\n  }\n  return 'SESSION_END';\n}\n\n/**\n * Extract the decision/insight from content\n */\nfunction extractDecision(content: string): string {\n  // Try to extract a meaningful decision statement\n  const patterns = [\n    /[^.]*\\b(decided|chose|selected|will use|must|cannot|blocked|breaking)[^.]*/i,\n    /[^.]*\\b(architecture|security|migration|deprecated)[^.]*/i,\n  ];\n\n  for (const pattern of patterns) {\n    const match = content.match(pattern);\n    if (match) {\n      return match[0].trim().substring(0, 300);\n    }\n  }\n\n  // Final fallback: take first meaningful sentence\n  const sentences = content.match(/^[^.]{30,200}\\./);\n  if (sentences) {\n    return sentences[0].trim();\n  }\n\n  return content.substring(0, 300).trim();\n}\n\n/**\n * Detect category from content\n */\nfunction detectCategory(content: string): string {\n  const contentLower = content.toLowerCase();\n\n  if (/security|auth|jwt|oauth|cors|xss/.test(contentLower)) return 'security';\n  if (/architecture|design|structure|system/.test(contentLower)) return 'architecture';\n  if (/database|schema|migration|postgres|sql/.test(contentLower)) return 'database';\n  if (/blocked|issue|bug|problem|cannot/.test(contentLower)) return 'blocker';\n  if (/breaking|deprecated|removed|migration/.test(contentLower)) return 'breaking-change';\n  if (/api|endpoint|route|rest/.test(contentLower)) return 'api';\n  if (/decided|chose|selected/.test(contentLower)) return 'decision';\n\n  return 'general';\n}\n\n/**\n * Initialize pending sync queue\n */\nfunction initPendingQueue(pendingFile: string): void {\n  if (!existsSync(pendingFile)) {\n    try {\n      mkdirSync(require('path').dirname(pendingFile), { recursive: true });\n      writeFileSync(pendingFile, JSON.stringify({\n        pending: [],\n        created_at: new Date().toISOString(),\n      }));\n    } catch {\n      // Ignore init errors\n    }\n  }\n}\n\n/**\n * Add to pending queue\n */\nfunction addToPendingQueue(content: string, category: string, pendingFile: string): void {\n  initPendingQueue(pendingFile);\n\n  try {\n    const data: PendingFile = JSON.parse(readFileSync(pendingFile, 'utf8'));\n    data.pending.push({\n      content,\n      category,\n      queued_at: new Date().toISOString(),\n    });\n    writeFileSync(pendingFile, JSON.stringify(data, null, 2));\n    logHook('realtime-sync', `Added to pending queue: category=${category}, length=${content.length}`);\n  } catch {\n    // Ignore queue errors\n  }\n}\n\n/**\n * Get pending count\n */\nfunction getPendingCount(pendingFile: string): number {\n  if (!existsSync(pendingFile)) return 0;\n\n  try {\n    const data: PendingFile = JSON.parse(readFileSync(pendingFile, 'utf8'));\n    return data.pending?.length || 0;\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Sync critical decisions in real-time\n */\nexport function realtimeSync(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Self-guard: Only process relevant tools\n  if (!['Bash', 'Write', 'Edit', 'Skill', 'Task'].includes(toolName)) {\n    return outputSilentSuccess();\n  }\n\n  // Get tool output/result\n  let toolOutput = '';\n  switch (toolName) {\n    case 'Bash': {\n      toolOutput = String(getField<unknown>(input, 'tool_output') || input.tool_output || '');\n      const command = getField<string>(input, 'tool_input.command') || '';\n      if (command) {\n        toolOutput = `${command}\\n${toolOutput}`;\n      }\n      break;\n    }\n    case 'Write':\n    case 'Edit': {\n      const content = getField<string>(input, 'tool_input.new_string') ||\n                     getField<string>(input, 'tool_input.content') || '';\n      const filePath = getField<string>(input, 'tool_input.file_path') || '';\n      toolOutput = filePath ? `Writing to ${filePath}: ${content}` : content;\n      break;\n    }\n    case 'Skill':\n    case 'Task': {\n      toolOutput = String(getField<unknown>(input, 'tool_result') || input.tool_output || '');\n      break;\n    }\n  }\n\n  // Skip if output is too short\n  if (!toolOutput || toolOutput.length < MIN_CONTENT_LENGTH) {\n    return outputSilentSuccess();\n  }\n\n  // Classify priority\n  let priority = classifyPriority(toolOutput);\n  logHook('realtime-sync', `Tool: ${toolName}, Priority: ${priority}, Content length: ${toolOutput.length}`);\n\n  // Context pressure override\n  const contextPressure = getContextPressure();\n  const projectDir = getProjectDir();\n  const sessionId = getSessionId();\n  const pendingFile = `${projectDir}/.claude/logs/.mem0-pending-sync-${sessionId}.json`;\n\n  // Upgrade BATCHED to IMMEDIATE if context pressure is high\n  if (priority === 'BATCHED' && contextPressure >= CONTEXT_EMERGENCY_THRESHOLD) {\n    priority = 'IMMEDIATE';\n    logHook('realtime-sync', `EMERGENCY: Context at ${contextPressure}%, upgrading BATCHED to IMMEDIATE`);\n  }\n\n  // If critical (>90%), flush pending queue immediately\n  if (contextPressure >= CONTEXT_CRITICAL_THRESHOLD) {\n    const pendingCount = getPendingCount(pendingFile);\n    if (pendingCount > 0) {\n      logHook('realtime-sync', `CRITICAL: Context at ${contextPressure}%, flushing ${pendingCount} pending items`);\n\n      return {\n        continue: true,\n        systemMessage: `[CRITICAL SYNC] Context at ${contextPressure}% - compaction imminent!\n\n${pendingCount} items in pending queue need immediate sync to knowledge graph.\nPending sync file: ${pendingFile}\n\nExecute mcp__memory__create_entities for each item in the pending file NOW\nto preserve session context in the knowledge graph before compaction.`,\n      };\n    }\n  }\n\n  switch (priority) {\n    case 'IMMEDIATE': {\n      const decision = extractDecision(toolOutput);\n\n      if (!decision || decision.length < 20) {\n        logHook('realtime-sync', 'Could not extract meaningful decision');\n        return outputSilentSuccess();\n      }\n\n      const category = detectCategory(decision);\n      logHook('realtime-sync', `IMMEDIATE sync triggered: category=${category}`);\n\n      return {\n        continue: true,\n        systemMessage: `[IMMEDIATE SYNC] Critical decision detected - store in knowledge graph now.\n\nCategory: ${category}\nDecision: \"${decision.substring(0, 200)}\"\n\nStore in knowledge graph with mcp__memory__create_entities:\n\\`\\`\\`json\n{\n  \"entities\": [{\n    \"name\": \"${category}-decision\",\n    \"entityType\": \"Decision\",\n    \"observations\": [\"${decision.substring(0, 300).replace(/\"/g, '\\\\\"')}\"]\n  }]\n}\n\\`\\`\\`\n\nThis decision is critical and should be synced immediately for:\n- Session continuity if interrupted\n- Cross-agent knowledge sharing\n- Future reference in similar contexts`,\n      };\n    }\n\n    case 'BATCHED': {\n      const decision = extractDecision(toolOutput);\n\n      if (decision && decision.length >= 20) {\n        const category = detectCategory(decision);\n        addToPendingQueue(decision, category, pendingFile);\n\n        const pendingCount = getPendingCount(pendingFile);\n\n        // Auto-sync when queue reaches threshold (5+ items)\n        if (pendingCount >= 5) {\n          logHook('realtime-sync', `BATCHED queue has ${pendingCount} items - triggering batch sync`);\n\n          return {\n            continue: true,\n            systemMessage: `[BATCHED SYNC] ${pendingCount} patterns/conventions queued for graph sync.\n\nLatest: \"${decision.substring(0, 100)}...\" (${category})\n\nThese will be synced to knowledge graph at session end, or trigger batch sync now with mcp__memory__create_entities for each item in:\n${pendingFile}`,\n          };\n        }\n      }\n\n      return outputSilentSuccess();\n    }\n\n    case 'SESSION_END':\n    default:\n      // Let existing Stop hooks handle this\n      return outputSilentSuccess();\n  }\n}\n", "/**\n * Session Metrics - Tracks tool usage statistics\n * CC 2.1.7 Compliant: Self-contained hook with stdin reading\n * Hook: PostToolUse (*)\n */\n\nimport { existsSync, readFileSync, writeFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\n\nconst METRICS_FILE = '/tmp/claude-session-metrics.json';\nconst LOCKFILE = `${METRICS_FILE}.lock`;\n\ninterface SessionMetrics {\n  tools: Record<string, number>;\n  errors: number;\n  warnings: number;\n}\n\n/**\n * Track tool usage metrics\n */\nexport function sessionMetrics(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  if (!toolName) {\n    return outputSilentSuccess();\n  }\n\n  try {\n    // Initialize metrics file if needed\n    let metrics: SessionMetrics = { tools: {}, errors: 0, warnings: 0 };\n\n    if (existsSync(METRICS_FILE)) {\n      try {\n        const content = readFileSync(METRICS_FILE, 'utf8').trim();\n        if (content) {\n          metrics = JSON.parse(content);\n        }\n      } catch {\n        // Invalid JSON, reinitialize\n        metrics = { tools: {}, errors: 0, warnings: 0 };\n      }\n    }\n\n    // Ensure tools object exists\n    if (!metrics.tools) {\n      metrics.tools = {};\n    }\n\n    // Increment tool counter\n    const currentCount = metrics.tools[toolName] || 0;\n    metrics.tools[toolName] = currentCount + 1;\n\n    // Write updated metrics\n    writeFileSync(METRICS_FILE, JSON.stringify(metrics, null, 2));\n  } catch (error) {\n    logHook('session-metrics', `Error updating metrics: ${error}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Skill Edit Pattern Tracker - PostToolUse Hook\n * Tracks edit patterns after skill usage to enable skill evolution\n *\n * Part of: #58 (Skill Evolution System)\n * Triggers on: Write|Edit after skill usage\n * Action: Categorize and log edit patterns for evolution analysis\n * CC 2.1.7 Compliant\n *\n * Version: 1.0.2 - TypeScript port\n */\n\nimport { existsSync, readFileSync, appendFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, getField, getProjectDir, getSessionId, logHook } from '../lib/common.js';\n\n// Edit pattern categories with detection patterns\nconst PATTERN_DEFINITIONS: Array<{ name: string; regex: RegExp }> = [\n  // API/Backend patterns\n  { name: 'add_pagination', regex: /limit.*offset|page.*size|cursor.*pagination|paginate|Paginated/i },\n  { name: 'add_rate_limiting', regex: /rate.?limit|throttl|RateLimiter|requests.?per/i },\n  { name: 'add_caching', regex: /@cache|cache_key|TTL|redis|memcache|@cached/i },\n  { name: 'add_retry_logic', regex: /retry|backoff|max_attempts|tenacity|Retry/i },\n  // Error handling patterns\n  { name: 'add_error_handling', regex: /try.*catch|except|raise.*Exception|throw.*Error|error.*handler/i },\n  { name: 'add_validation', regex: /validate|Validator|@validate|Pydantic|Zod|yup|schema/i },\n  { name: 'add_logging', regex: /logger[.]|logging[.]|console[.]log|winston|pino|structlog/i },\n  // Type safety patterns\n  { name: 'add_types', regex: /: *(str|int|bool|List|Dict|Optional)|interface |type .*=/i },\n  { name: 'add_type_guards', regex: /isinstance|typeof|is.*Type|assert.*type/i },\n  // Code quality patterns\n  { name: 'add_docstring', regex: /docstring|\"\"\"[^\"]+\"\"\"|\\/\\*\\*/i },\n  { name: 'remove_comments', regex: /^-.*#|^-.*\\/\\/|^-.*\\*/m },\n  // Security patterns\n  { name: 'add_auth_check', regex: /@auth|@require_auth|isAuthenticated|requiresAuth|@login_required/i },\n  { name: 'add_input_sanitization', regex: /escape|sanitize|htmlspecialchars|DOMPurify/i },\n  // Testing patterns\n  { name: 'add_test_case', regex: /def test_|it\\(|describe\\(|expect\\(|assert|@pytest/i },\n  { name: 'add_mock', regex: /Mock|patch|jest[.]mock|vi[.]mock|MagicMock/i },\n  // Import/dependency patterns\n  { name: 'modify_imports', regex: /^[+-].*import|^[+-].*from.*import|^[+-].*require\\(/m },\n  // Async patterns\n  { name: 'add_async', regex: /async |await |Promise|asyncio|async def/i },\n];\n\n/**\n * Get recent skill usage from session state\n */\nfunction getRecentSkill(sessionStateFile: string): string {\n  if (!existsSync(sessionStateFile)) {\n    return '';\n  }\n\n  try {\n    const content = JSON.parse(readFileSync(sessionStateFile, 'utf8'));\n    const now = Math.floor(Date.now() / 1000);\n    const cutoff = now - 300; // 5 minutes\n\n    const recentSkills = (content.recentSkills || [])\n      .filter((s: { timestamp: number }) => s.timestamp > cutoff)\n      .sort((a: { timestamp: number }, b: { timestamp: number }) => b.timestamp - a.timestamp);\n\n    return recentSkills[0]?.skillId || '';\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Detect edit patterns in content diff\n */\nfunction detectPatterns(diffContent: string): string[] {\n  const detected: string[] = [];\n\n  for (const { name, regex } of PATTERN_DEFINITIONS) {\n    if (regex.test(diffContent)) {\n      detected.push(name);\n    }\n  }\n\n  return detected;\n}\n\n/**\n * Log edit pattern to JSONL file\n */\nfunction logEditPattern(\n  skillId: string,\n  filePath: string,\n  patterns: string[],\n  editPatternsFile: string\n): void {\n  const sessionId = getSessionId();\n  const timestamp = new Date().toISOString();\n\n  const entry = {\n    timestamp,\n    skill_id: skillId,\n    file_path: filePath,\n    session_id: sessionId,\n    patterns,\n  };\n\n  try {\n    mkdirSync(require('path').dirname(editPatternsFile), { recursive: true });\n    appendFileSync(editPatternsFile, JSON.stringify(entry) + '\\n');\n  } catch {\n    // Ignore write errors\n  }\n}\n\n/**\n * Track skill edit patterns\n */\nexport function skillEditTracker(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process Write/Edit tools\n  if (toolName !== 'Write' && toolName !== 'Edit') {\n    return outputSilentSuccess();\n  }\n\n  // Get file path from tool input\n  const filePath = getField<string>(input, 'tool_input.file_path') || '';\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Get recently used skill\n  const projectDir = getProjectDir();\n  const sessionStateFile = `${projectDir}/.claude/session/state.json`;\n  const skillId = getRecentSkill(sessionStateFile);\n\n  if (!skillId) {\n    // No recent skill usage - nothing to track\n    return outputSilentSuccess();\n  }\n\n  // Get the diff/edit content\n  let editContent = '';\n\n  if (toolName === 'Edit') {\n    // For Edit tool, analyze old_string -> new_string diff\n    const oldString = getField<string>(input, 'tool_input.old_string') || '';\n    const newString = getField<string>(input, 'tool_input.new_string') || '';\n\n    if (oldString && newString) {\n      // Create pseudo-diff (+ for added, - for removed lines)\n      const oldLines = oldString.split('\\n');\n      const newLines = newString.split('\\n');\n      editContent = oldLines.map(l => `-${l}`).join('\\n') + '\\n' +\n                   newLines.map(l => `+${l}`).join('\\n');\n    }\n  } else {\n    // For Write tool, analyze the new content\n    editContent = getField<string>(input, 'tool_input.content') || '';\n  }\n\n  if (!editContent) {\n    return outputSilentSuccess();\n  }\n\n  // Detect patterns\n  const patterns = detectPatterns(editContent);\n\n  // Only log if patterns detected\n  if (patterns.length > 0) {\n    const editPatternsFile = `${projectDir}/.claude/feedback/edit-patterns.jsonl`;\n    logEditPattern(skillId, filePath, patterns, editPatternsFile);\n\n    // Debug log\n    if (process.env.CLAUDE_HOOK_DEBUG) {\n      logHook('skill-edit-tracker', `Detected ${patterns.length} patterns for ${skillId}: ${JSON.stringify(patterns)}`);\n    }\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Calibration Tracker - PostToolUse Hook for Tracking Task Completions\n * Issue #197: Agent Orchestration Layer\n *\n * Tracks agent task completions for calibration:\n * - Captures dispatch-outcome pairs\n * - Records to calibration engine\n * - Triggers on TaskUpdate tool calls\n *\n * CC 2.1.9 Compliant: Silent hook that tracks in background\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\nimport { recordOutcome } from '../lib/calibration-engine.js';\nimport { getTaskById } from '../lib/task-integration.js';\nimport { getLastClassification, loadConfig } from '../lib/orchestration-state.js';\nimport type { AgentOutcome } from '../lib/orchestration-types.js';\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\n/**\n * Extract task ID from TaskUpdate tool input\n */\nfunction extractTaskId(input: HookInput): string | null {\n  const toolInput = input.tool_input || {};\n\n  // TaskUpdate has taskId parameter\n  if (typeof toolInput.taskId === 'string') {\n    return toolInput.taskId;\n  }\n\n  return null;\n}\n\n/**\n * Check if this is a task status update\n */\nfunction isTaskStatusUpdate(input: HookInput): boolean {\n  if (input.tool_name !== 'TaskUpdate') {\n    return false;\n  }\n\n  const toolInput = input.tool_input || {};\n  return typeof toolInput.status === 'string';\n}\n\n/**\n * Map task status to agent outcome\n */\nfunction statusToOutcome(status: string): AgentOutcome | null {\n  switch (status) {\n    case 'completed':\n      return 'success';\n    case 'pending':\n      // Pending after in_progress might indicate failure\n      return null;\n    default:\n      return null;\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Calibration tracker hook\n *\n * Monitors TaskUpdate tool calls to track agent outcomes:\n * 1. Checks if this is a task status update to 'completed'\n * 2. Looks up the task to find associated agent\n * 3. Records outcome to calibration engine\n */\nexport function calibrationTracker(input: HookInput): HookResult {\n  // Only track TaskUpdate calls\n  if (!isTaskStatusUpdate(input)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if calibration is enabled\n  const config = loadConfig();\n  if (!config.enableCalibration) {\n    return outputSilentSuccess();\n  }\n\n  const toolInput = input.tool_input || {};\n  const taskId = extractTaskId(input);\n  const status = toolInput.status as string;\n\n  if (!taskId) {\n    return outputSilentSuccess();\n  }\n\n  // Only track completions\n  const outcome = statusToOutcome(status);\n  if (!outcome) {\n    return outputSilentSuccess();\n  }\n\n  logHook('calibration-tracker', `Tracking task ${taskId} status update to ${status}`);\n\n  // Look up task\n  const task = getTaskById(taskId);\n  if (!task) {\n    logHook('calibration-tracker', `Task ${taskId} not found in registry`);\n    return outputSilentSuccess();\n  }\n\n  // Get agent from task\n  const agent = task.agent;\n  if (!agent) {\n    logHook('calibration-tracker', `No agent associated with task ${taskId}`);\n    return outputSilentSuccess();\n  }\n\n  // Get last classification for keywords\n  const lastClassification = getLastClassification();\n  const agentMatch = lastClassification?.agents.find(a => a.agent === agent);\n\n  const matchedKeywords = agentMatch?.matchedKeywords || [];\n  const confidence = task.confidence || agentMatch?.confidence || 0;\n\n  // Calculate duration if possible\n  const durationMs = task.createdAt\n    ? Date.now() - new Date(task.createdAt).getTime()\n    : undefined;\n\n  // Record to calibration engine\n  recordOutcome(\n    '', // Prompt not available in PostTool context\n    agent,\n    matchedKeywords,\n    confidence,\n    outcome,\n    durationMs\n  );\n\n  logHook(\n    'calibration-tracker',\n    `Recorded calibration: ${agent} -> ${outcome} (conf: ${confidence})`\n  );\n\n  return outputSilentSuccess();\n}\n", "/**\n * Code Style Learner - Learn user's code style preferences from written code\n * Hook: PostToolUse/Write (#133)\n * CC 2.1.7 Compliant\n *\n * Tracks:\n * - Indentation (tabs vs spaces, indent size)\n * - Quote style (single vs double quotes)\n * - Naming patterns (detected from code)\n * - Import order (stdlib first, third-party, local)\n *\n * Storage: .claude/feedback/code-style-profile.json\n * Memory Fabric v2.1: Cross-project learning via patterns queue\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getProjectDir, logHook } from '../../lib/common.js';\n\ninterface StyleProfile {\n  version: string;\n  last_updated: string | null;\n  samples_count: number;\n  languages: Record<string, LanguageProfile>;\n  global_preferences: {\n    indentation: { style: string; size: number; confidence: number };\n    quotes: { style: string; confidence: number };\n  };\n}\n\ninterface LanguageProfile {\n  samples: number;\n  indentation: { tabs: number; spaces_2: number; spaces_4: number };\n  quotes: { single: number; double: number };\n  semicolons: { always: number; omit: number };\n  trailing_comma: { always: number; minimal: number };\n  type_hints: { used: number; not_used: number };\n  docstring_style: Record<string, number>;\n}\n\nconst CODE_EXTENSIONS = ['py', 'ts', 'tsx', 'js', 'jsx', 'go', 'rs', 'java'];\n\n/**\n * Get language from file extension\n */\nfunction getLanguage(filePath: string): string | null {\n  const ext = filePath.split('.').pop()?.toLowerCase();\n  switch (ext) {\n    case 'py': return 'python';\n    case 'ts':\n    case 'tsx': return 'typescript';\n    case 'js':\n    case 'jsx': return 'javascript';\n    case 'go': return 'go';\n    case 'rs': return 'rust';\n    case 'java': return 'java';\n    default: return null;\n  }\n}\n\n/**\n * Detect indentation style from code content\n */\nfunction detectIndentation(content: string): { style: string; size: number } {\n  let tabCount = 0;\n  let space2Count = 0;\n  let space4Count = 0;\n\n  for (const line of content.split('\\n')) {\n    if (line.startsWith('\\t')) {\n      tabCount++;\n    } else if (line.startsWith('    ')) {\n      space4Count++;\n    } else if (line.match(/^  [^ ]/)) {\n      space2Count++;\n    }\n  }\n\n  if (tabCount > space2Count + space4Count) {\n    return { style: 'tabs', size: 1 };\n  }\n  if (space2Count > space4Count) {\n    return { style: 'spaces', size: 2 };\n  }\n  if (space4Count > 0) {\n    return { style: 'spaces', size: 4 };\n  }\n\n  return { style: 'unknown', size: 4 };\n}\n\n/**\n * Detect quote style from code content\n */\nfunction detectQuoteStyle(content: string): string {\n  const singleCount = (content.match(/'/g) || []).length;\n  const doubleCount = (content.match(/\"/g) || []).length;\n\n  return singleCount > doubleCount ? 'single' : 'double';\n}\n\n/**\n * Detect semicolon usage (JS/TS)\n */\nfunction detectSemicolonStyle(content: string): string {\n  let withSemi = 0;\n  let withoutSemi = 0;\n\n  for (const line of content.split('\\n')) {\n    // Skip empty lines and comments\n    const trimmed = line.trim();\n    if (!trimmed || trimmed.startsWith('//') || trimmed.startsWith('*')) continue;\n\n    if (/;\\s*$/.test(line)) {\n      withSemi++;\n    } else if (/[a-zA-Z0-9\\)\\]\\'\\\"]\\\\s*$/.test(line)) {\n      withoutSemi++;\n    }\n  }\n\n  return withSemi > withoutSemi ? 'always' : 'omit';\n}\n\n/**\n * Detect trailing comma preference\n */\nfunction detectTrailingComma(content: string): string {\n  const trailingCount = (content.match(/,\\s*$/gm) || []).length;\n  return trailingCount > 5 ? 'always' : 'minimal';\n}\n\n/**\n * Detect Python-specific patterns\n */\nfunction detectPythonPatterns(content: string): { typeHints: boolean; docstringStyle: string } {\n  const hasTypeHints = /\\) -> |: [A-Z][a-zA-Z]+(\\[|$| =)/.test(content);\n\n  let docstringStyle = 'unknown';\n  if (/\"\"\"[^\"]+\"\"\"/.test(content)) {\n    if (/:param |:returns:|:raises:/.test(content)) {\n      docstringStyle = 'sphinx';\n    } else if (/Args:|Returns:|Raises:/.test(content)) {\n      docstringStyle = 'google';\n    } else if (/Parameters|Returns\\n-+/.test(content)) {\n      docstringStyle = 'numpy';\n    } else {\n      docstringStyle = 'simple';\n    }\n  }\n\n  return { typeHints: hasTypeHints, docstringStyle };\n}\n\n/**\n * Load or initialize style profile\n */\nfunction loadProfile(profilePath: string): StyleProfile {\n  if (existsSync(profilePath)) {\n    try {\n      return JSON.parse(readFileSync(profilePath, 'utf8'));\n    } catch {\n      // Invalid JSON, reinitialize\n    }\n  }\n\n  return {\n    version: '1.0.0',\n    last_updated: null,\n    samples_count: 0,\n    languages: {},\n    global_preferences: {\n      indentation: { style: 'unknown', size: 4, confidence: 0 },\n      quotes: { style: 'unknown', confidence: 0 },\n    },\n  };\n}\n\n/**\n * Update style profile with new observations\n */\nfunction updateProfile(\n  profile: StyleProfile,\n  language: string,\n  indentation: { style: string; size: number },\n  quoteStyle: string,\n  semiStyle: string,\n  trailingComma: string,\n  typeHints: boolean | null,\n  docstringStyle: string\n): void {\n  profile.last_updated = new Date().toISOString();\n  profile.samples_count++;\n\n  // Initialize language profile if needed\n  if (!profile.languages[language]) {\n    profile.languages[language] = {\n      samples: 0,\n      indentation: { tabs: 0, spaces_2: 0, spaces_4: 0 },\n      quotes: { single: 0, double: 0 },\n      semicolons: { always: 0, omit: 0 },\n      trailing_comma: { always: 0, minimal: 0 },\n      type_hints: { used: 0, not_used: 0 },\n      docstring_style: {},\n    };\n  }\n\n  const lang = profile.languages[language];\n  lang.samples++;\n\n  // Update indentation\n  if (indentation.style === 'tabs') {\n    lang.indentation.tabs++;\n  } else if (indentation.size === 2) {\n    lang.indentation.spaces_2++;\n  } else {\n    lang.indentation.spaces_4++;\n  }\n\n  // Update quotes\n  if (quoteStyle === 'single') {\n    lang.quotes.single++;\n  } else {\n    lang.quotes.double++;\n  }\n\n  // Update semicolons (JS/TS only)\n  if (semiStyle !== 'unknown') {\n    if (semiStyle === 'always') {\n      lang.semicolons.always++;\n    } else {\n      lang.semicolons.omit++;\n    }\n  }\n\n  // Update trailing comma\n  if (trailingComma !== 'unknown') {\n    if (trailingComma === 'always') {\n      lang.trailing_comma.always++;\n    } else {\n      lang.trailing_comma.minimal++;\n    }\n  }\n\n  // Update type hints (Python)\n  if (typeHints !== null) {\n    if (typeHints) {\n      lang.type_hints.used++;\n    } else {\n      lang.type_hints.not_used++;\n    }\n  }\n\n  // Update docstring style (Python)\n  if (docstringStyle !== 'unknown') {\n    lang.docstring_style[docstringStyle] = (lang.docstring_style[docstringStyle] || 0) + 1;\n  }\n}\n\n/**\n * Learn code style from written files\n */\nexport function codeStyleLearner(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Guard: Only run for Write/Edit\n  if (toolName !== 'Write' && toolName !== 'Edit') {\n    return outputSilentSuccess();\n  }\n\n  const filePath = getField<string>(input, 'tool_input.file_path') || '';\n\n  // Guard: Skip internal files\n  if (!filePath || filePath.includes('/.claude/') ||\n      filePath.includes('/node_modules/') ||\n      filePath.includes('/.git/') ||\n      filePath.includes('/dist/') ||\n      filePath.endsWith('.lock')) {\n    return outputSilentSuccess();\n  }\n\n  // Get file extension to determine language\n  const ext = filePath.split('.').pop()?.toLowerCase() || '';\n  if (!CODE_EXTENSIONS.includes(ext)) {\n    return outputSilentSuccess();\n  }\n\n  const language = getLanguage(filePath);\n  if (!language) {\n    return outputSilentSuccess();\n  }\n\n  // Try to get file content from tool_input or read the file\n  let content = getField<string>(input, 'tool_input.content') || '';\n\n  if (!content) {\n    const projectDir = getProjectDir();\n    const fullPath = filePath.startsWith('/') ? filePath : `${projectDir}/${filePath}`;\n\n    if (existsSync(fullPath)) {\n      try {\n        // Read first 100 lines\n        content = readFileSync(fullPath, 'utf8').split('\\n').slice(0, 100).join('\\n');\n      } catch {\n        return outputSilentSuccess();\n      }\n    }\n  }\n\n  if (!content) {\n    return outputSilentSuccess();\n  }\n\n  // Analyze the code\n  const indentation = detectIndentation(content);\n  const quoteStyle = detectQuoteStyle(content);\n\n  let semiStyle = 'unknown';\n  let trailingComma = 'unknown';\n  let typeHints: boolean | null = null;\n  let docstringStyle = 'unknown';\n\n  // Language-specific detection\n  switch (language) {\n    case 'javascript':\n    case 'typescript':\n      semiStyle = detectSemicolonStyle(content);\n      trailingComma = detectTrailingComma(content);\n      break;\n    case 'python': {\n      const pyPatterns = detectPythonPatterns(content);\n      typeHints = pyPatterns.typeHints;\n      docstringStyle = pyPatterns.docstringStyle;\n      trailingComma = detectTrailingComma(content);\n      break;\n    }\n  }\n\n  // Load and update profile\n  const projectDir = getProjectDir();\n  const profilePath = `${projectDir}/.claude/feedback/code-style-profile.json`;\n\n  try {\n    mkdirSync(`${projectDir}/.claude/feedback`, { recursive: true });\n    const profile = loadProfile(profilePath);\n    updateProfile(profile, language, indentation, quoteStyle, semiStyle, trailingComma, typeHints, docstringStyle);\n    writeFileSync(profilePath, JSON.stringify(profile, null, 2));\n  } catch (error) {\n    logHook('code-style-learner', `Error updating profile: ${error}`);\n  }\n\n  logHook('code-style-learner',\n    `Analyzed ${language} file: indent=${indentation.style}(${indentation.size}) quotes=${quoteStyle}`);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Test Coverage Predictor - LLM-powered validation hook\n * Predicts if new code has adequate test coverage\n * CC 2.1.3 Feature: Post-write analysis\n */\n\nimport { existsSync, appendFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getProjectDir } from '../../lib/common.js';\n\n/**\n * Predict test coverage for written files\n */\nexport function coveragePredictor(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only run for Write tool\n  if (toolName !== 'Write') {\n    return outputSilentSuccess();\n  }\n\n  const filePath = getField<string>(input, 'tool_input.file_path') ||\n                   process.env.TOOL_OUTPUT_FILE_PATH || '';\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Only analyze source code files (not tests themselves)\n  if (filePath.includes('test') || filePath.includes('spec') || filePath.includes('__tests__')) {\n    return outputSilentSuccess();\n  }\n\n  // Only analyze code files\n  if (!/\\.(py|ts|tsx|js|jsx)$/.test(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  const projectDir = getProjectDir();\n\n  // Determine corresponding test file location\n  let testPattern = '';\n  const basename = filePath.split('/').pop() || '';\n\n  if (filePath.endsWith('.py')) {\n    // Python: backend/app/services/foo.py -> backend/tests/unit/test_foo.py\n    const nameWithoutExt = basename.replace('.py', '');\n    testPattern = `test_${nameWithoutExt}.py`;\n  } else if (/\\.(ts|tsx|js|jsx)$/.test(filePath)) {\n    // TypeScript: src/components/Foo.tsx -> src/components/__tests__/Foo.test.tsx\n    const nameWithoutExt = basename.replace(/\\.[^.]+$/, '');\n    testPattern = `${nameWithoutExt}.test.*`;\n  } else {\n    return outputSilentSuccess();\n  }\n\n  // Check if test file exists\n  let testExists = '';\n  try {\n    const findResult = execSync(\n      `find \"${projectDir}\" -type f -name \"${testPattern}\" 2>/dev/null | head -1`,\n      { encoding: 'utf8', timeout: 5000 }\n    ).trim();\n    testExists = findResult;\n  } catch {\n    // find command failed, assume no test\n  }\n\n  // Log results\n  const logDir = `${projectDir}/.claude/hooks/logs`;\n  try {\n    mkdirSync(logDir, { recursive: true });\n    const timestamp = new Date().toISOString();\n\n    if (testExists) {\n      appendFileSync(\n        `${logDir}/coverage-predictor.log`,\n        `[${timestamp}] COVERAGE_OK: ${filePath} has tests at ${testExists}\\n`\n      );\n    } else {\n      appendFileSync(\n        `${logDir}/coverage-predictor.log`,\n        `[${timestamp}] COVERAGE_WARN: ${filePath} may lack test coverage (expected: ${testPattern})\\n`\n      );\n\n      // Return subtle reminder (not blocking)\n      return {\n        continue: true,\n        systemMessage: `Consider adding tests for: ${filePath}`,\n      };\n    }\n  } catch {\n    // Ignore logging errors\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Naming Convention Learner - Learn project naming conventions from written code\n * Hook: PostToolUse/Write (#134)\n * CC 2.1.7 Compliant\n *\n * Tracks:\n * - Variable naming (camelCase, snake_case, PascalCase, SCREAMING_CASE)\n * - Function naming patterns\n * - Class naming patterns\n * - File naming conventions\n * - Constant naming\n *\n * Storage: .claude/feedback/naming-conventions.json\n * Memory Fabric v2.1: Cross-project learning via patterns queue\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getProjectDir, logHook } from '../../lib/common.js';\n\ntype NamingCase = 'camelCase' | 'snake_case' | 'PascalCase' | 'SCREAMING_SNAKE_CASE' | 'private_snake_case' | 'dunder' | 'mixed' | 'unknown';\n\ninterface NamingProfile {\n  version: string;\n  last_updated: string | null;\n  samples_count: number;\n  languages: Record<string, LanguageNamingProfile>;\n  file_naming: Record<string, number>;\n  detected_patterns: {\n    functions: Record<string, number>;\n    classes: Record<string, number>;\n    variables: Record<string, number>;\n    constants: Record<string, number>;\n    types: Record<string, number>;\n  };\n}\n\ninterface LanguageNamingProfile {\n  samples: number;\n  functions: Record<NamingCase, number>;\n  classes: Record<NamingCase, number>;\n  variables: Record<NamingCase, number>;\n  constants: Record<NamingCase, number>;\n  types: Record<NamingCase, number>;\n}\n\nconst CODE_EXTENSIONS = ['py', 'ts', 'tsx', 'js', 'jsx', 'go', 'rs', 'java'];\n\n/**\n * Detect naming case from an identifier\n */\nfunction detectCase(name: string): NamingCase {\n  if (name.length < 2 || /^[_0-9]+$/.test(name)) {\n    return 'unknown';\n  }\n\n  if (/^[A-Z][A-Z0-9_]*$/.test(name)) {\n    return 'SCREAMING_SNAKE_CASE';\n  }\n  if (/^[A-Z][a-zA-Z0-9]*$/.test(name)) {\n    return 'PascalCase';\n  }\n  if (/^[a-z][a-zA-Z0-9]*$/.test(name) && !name.includes('_')) {\n    return 'camelCase';\n  }\n  if (/^[a-z][a-z0-9_]*$/.test(name)) {\n    return 'snake_case';\n  }\n  if (/^_[a-z][a-z0-9_]*$/.test(name)) {\n    return 'private_snake_case';\n  }\n  if (/^__[a-z][a-z0-9_]*__$/.test(name)) {\n    return 'dunder';\n  }\n\n  return 'mixed';\n}\n\n/**\n * Extract Python identifiers from code\n */\nfunction extractPythonIdentifiers(content: string): {\n  functions: string[];\n  classes: string[];\n  variables: string[];\n  constants: string[];\n} {\n  const functions = (content.match(/def ([a-zA-Z_][a-zA-Z0-9_]*)/g) || [])\n    .map(m => m.replace('def ', ''));\n\n  const classes = (content.match(/class ([A-Za-z_][a-zA-Z0-9_]*)/g) || [])\n    .map(m => m.replace('class ', ''));\n\n  const variables = (content.match(/^\\s*([a-zA-Z_][a-zA-Z0-9_]*)\\s*=/gm) || [])\n    .map(m => m.replace(/\\s*=.*/, '').trim());\n\n  const constants = (content.match(/^([A-Z][A-Z0-9_]*)\\s*=/gm) || [])\n    .map(m => m.replace(/\\s*=.*/, '').trim());\n\n  return { functions, classes, variables, constants };\n}\n\n/**\n * Extract TypeScript/JavaScript identifiers from code\n */\nfunction extractJsIdentifiers(content: string): {\n  functions: string[];\n  classes: string[];\n  variables: string[];\n  interfaces: string[];\n  types: string[];\n} {\n  const functions = [\n    ...(content.match(/(function|async function) ([a-zA-Z_][a-zA-Z0-9_]*)/g) || [])\n      .map(m => m.replace(/(async )?function /, '')),\n    ...(content.match(/const ([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*\\(/g) || [])\n      .map(m => m.replace(/const /, '').replace(/\\s*=.*/, '')),\n  ];\n\n  const classes = (content.match(/class ([A-Za-z_][a-zA-Z0-9_]*)/g) || [])\n    .map(m => m.replace('class ', ''));\n\n  const interfaces = (content.match(/interface ([A-Za-z_][a-zA-Z0-9_]*)/g) || [])\n    .map(m => m.replace('interface ', ''));\n\n  const types = (content.match(/type ([A-Za-z_][a-zA-Z0-9_]*)/g) || [])\n    .map(m => m.replace('type ', ''));\n\n  const variables = (content.match(/(const|let|var) ([a-zA-Z_][a-zA-Z0-9_]*)/g) || [])\n    .map(m => m.replace(/(const|let|var) /, ''));\n\n  return { functions, classes, variables, interfaces, types };\n}\n\n/**\n * Count naming cases for a list of identifiers\n */\nfunction countCases(identifiers: string[]): Record<NamingCase, number> {\n  const counts: Record<NamingCase, number> = {\n    camelCase: 0,\n    snake_case: 0,\n    PascalCase: 0,\n    SCREAMING_SNAKE_CASE: 0,\n    private_snake_case: 0,\n    dunder: 0,\n    mixed: 0,\n    unknown: 0,\n  };\n\n  for (const name of identifiers) {\n    if (!name) continue;\n    const caseType = detectCase(name);\n    counts[caseType]++;\n  }\n\n  return counts;\n}\n\n/**\n * Detect file naming convention from file path\n */\nfunction detectFileNaming(filePath: string): string {\n  const filename = filePath.split('/').pop() || '';\n  const nameWithoutExt = filename.replace(/\\.[^.]+$/, '');\n\n  if (/^[a-z][a-z0-9_]*$/.test(nameWithoutExt)) {\n    return 'snake_case';\n  }\n  if (/^[a-z][a-z0-9-]*$/.test(nameWithoutExt)) {\n    return 'kebab-case';\n  }\n  if (/^[A-Z][a-zA-Z0-9]*$/.test(nameWithoutExt)) {\n    return 'PascalCase';\n  }\n  if (/^[a-z][a-zA-Z0-9]*$/.test(nameWithoutExt)) {\n    return 'camelCase';\n  }\n\n  return 'mixed';\n}\n\n/**\n * Get language from file extension\n */\nfunction getLanguage(filePath: string): string | null {\n  const ext = filePath.split('.').pop()?.toLowerCase();\n  switch (ext) {\n    case 'py': return 'python';\n    case 'ts':\n    case 'tsx': return 'typescript';\n    case 'js':\n    case 'jsx': return 'javascript';\n    case 'go': return 'go';\n    case 'rs': return 'rust';\n    case 'java': return 'java';\n    default: return null;\n  }\n}\n\n/**\n * Load or initialize naming profile\n */\nfunction loadProfile(profilePath: string): NamingProfile {\n  if (existsSync(profilePath)) {\n    try {\n      return JSON.parse(readFileSync(profilePath, 'utf8'));\n    } catch {\n      // Invalid JSON, reinitialize\n    }\n  }\n\n  return {\n    version: '1.0.0',\n    last_updated: null,\n    samples_count: 0,\n    languages: {},\n    file_naming: {},\n    detected_patterns: {\n      functions: {},\n      classes: {},\n      variables: {},\n      constants: {},\n      types: {},\n    },\n  };\n}\n\n/**\n * Initialize language profile\n */\nfunction initLanguageProfile(): LanguageNamingProfile {\n  return {\n    samples: 0,\n    functions: { camelCase: 0, snake_case: 0, PascalCase: 0, SCREAMING_SNAKE_CASE: 0, private_snake_case: 0, dunder: 0, mixed: 0, unknown: 0 },\n    classes: { camelCase: 0, snake_case: 0, PascalCase: 0, SCREAMING_SNAKE_CASE: 0, private_snake_case: 0, dunder: 0, mixed: 0, unknown: 0 },\n    variables: { camelCase: 0, snake_case: 0, PascalCase: 0, SCREAMING_SNAKE_CASE: 0, private_snake_case: 0, dunder: 0, mixed: 0, unknown: 0 },\n    constants: { camelCase: 0, snake_case: 0, PascalCase: 0, SCREAMING_SNAKE_CASE: 0, private_snake_case: 0, dunder: 0, mixed: 0, unknown: 0 },\n    types: { camelCase: 0, snake_case: 0, PascalCase: 0, SCREAMING_SNAKE_CASE: 0, private_snake_case: 0, dunder: 0, mixed: 0, unknown: 0 },\n  };\n}\n\n/**\n * Learn naming conventions from written files\n */\nexport function namingConventionLearner(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Guard: Only run for Write/Edit\n  if (toolName !== 'Write' && toolName !== 'Edit') {\n    return outputSilentSuccess();\n  }\n\n  const filePath = getField<string>(input, 'tool_input.file_path') || '';\n\n  // Guard: Skip internal files\n  if (!filePath || filePath.includes('/.claude/') ||\n      filePath.includes('/node_modules/') ||\n      filePath.includes('/.git/') ||\n      filePath.includes('/dist/') ||\n      filePath.endsWith('.lock')) {\n    return outputSilentSuccess();\n  }\n\n  // Get file extension to determine language\n  const ext = filePath.split('.').pop()?.toLowerCase() || '';\n  if (!CODE_EXTENSIONS.includes(ext)) {\n    return outputSilentSuccess();\n  }\n\n  const language = getLanguage(filePath);\n  if (!language) {\n    return outputSilentSuccess();\n  }\n\n  // Try to get file content from tool_input or read the file\n  let content = getField<string>(input, 'tool_input.content') || '';\n\n  if (!content) {\n    const projectDir = getProjectDir();\n    const fullPath = filePath.startsWith('/') ? filePath : `${projectDir}/${filePath}`;\n\n    if (existsSync(fullPath)) {\n      try {\n        // Read first 150 lines\n        content = readFileSync(fullPath, 'utf8').split('\\n').slice(0, 150).join('\\n');\n      } catch {\n        return outputSilentSuccess();\n      }\n    }\n  }\n\n  if (!content) {\n    return outputSilentSuccess();\n  }\n\n  // Detect file naming convention\n  const fileNaming = detectFileNaming(filePath);\n\n  // Extract identifiers based on language\n  let funcCases: Record<NamingCase, number> = countCases([]);\n  let classCases: Record<NamingCase, number> = countCases([]);\n  let varCases: Record<NamingCase, number> = countCases([]);\n  let constCases: Record<NamingCase, number> = countCases([]);\n  let typeCases: Record<NamingCase, number> = countCases([]);\n\n  switch (language) {\n    case 'python': {\n      const ids = extractPythonIdentifiers(content);\n      funcCases = countCases(ids.functions);\n      classCases = countCases(ids.classes);\n      varCases = countCases(ids.variables);\n      constCases = countCases(ids.constants);\n      break;\n    }\n    case 'typescript':\n    case 'javascript': {\n      const ids = extractJsIdentifiers(content);\n      funcCases = countCases(ids.functions);\n      classCases = countCases(ids.classes);\n      varCases = countCases(ids.variables);\n      typeCases = countCases([...ids.interfaces, ...ids.types]);\n      break;\n    }\n  }\n\n  // Load and update profile\n  const projectDir = getProjectDir();\n  const profilePath = `${projectDir}/.claude/feedback/naming-conventions.json`;\n\n  try {\n    mkdirSync(`${projectDir}/.claude/feedback`, { recursive: true });\n    const profile = loadProfile(profilePath);\n\n    // Update profile\n    profile.last_updated = new Date().toISOString();\n    profile.samples_count++;\n\n    // Update file naming counts\n    profile.file_naming[fileNaming] = (profile.file_naming[fileNaming] || 0) + 1;\n\n    // Initialize language entry if needed\n    if (!profile.languages[language]) {\n      profile.languages[language] = initLanguageProfile();\n    }\n\n    const lang = profile.languages[language];\n    lang.samples++;\n\n    // Update naming case counts\n    for (const caseType of Object.keys(funcCases) as NamingCase[]) {\n      lang.functions[caseType] = (lang.functions[caseType] || 0) + funcCases[caseType];\n      lang.classes[caseType] = (lang.classes[caseType] || 0) + classCases[caseType];\n      lang.variables[caseType] = (lang.variables[caseType] || 0) + varCases[caseType];\n      lang.constants[caseType] = (lang.constants[caseType] || 0) + constCases[caseType];\n      lang.types[caseType] = (lang.types[caseType] || 0) + typeCases[caseType];\n    }\n\n    writeFileSync(profilePath, JSON.stringify(profile, null, 2));\n  } catch (error) {\n    logHook('naming-convention-learner', `Error updating profile: ${error}`);\n  }\n\n  logHook('naming-convention-learner', `Analyzed ${language} file (${filePath}): file=${fileNaming}`);\n\n  return outputSilentSuccess();\n}\n", "/**\n * README Sync Hook for Claude Code\n * After significant code changes, suggests README updates\n * Tracks: new exports, API changes, config changes\n * Hook: PostToolUse (Write)\n * Issue: #140\n */\n\nimport { existsSync, statSync, appendFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getProjectDir, logHook } from '../../lib/common.js';\n\ninterface ChangeAnalysis {\n  changeType: string;\n  readmeSection: string;\n  suggestion: string;\n}\n\n/**\n * Analyze file for README-relevant changes\n */\nfunction analyzeFileChange(filePath: string, projectDir: string): ChangeAnalysis | null {\n  const filename = filePath.split('/').pop() || '';\n  const dirname = filePath.split('/').slice(0, -1).join('/');\n  const extLower = (filePath.split('.').pop() || '').toLowerCase();\n\n  // 1. Package configuration files\n  switch (filename) {\n    case 'package.json':\n      if (existsSync(`${projectDir}/${filePath}`)) {\n        try {\n          const pkg = require(`${projectDir}/${filePath}`);\n          const scriptCount = Object.keys(pkg.scripts || {}).length;\n          if (scriptCount > 5) {\n            return {\n              changeType: 'scripts',\n              readmeSection: 'Available Scripts',\n              suggestion: 'Update README with new npm scripts',\n            };\n          }\n        } catch {\n          // Ignore parse errors\n        }\n      }\n      break;\n\n    case 'pyproject.toml':\n    case 'setup.py':\n    case 'setup.cfg':\n      return {\n        changeType: 'python-config',\n        readmeSection: 'Installation',\n        suggestion: 'Verify README installation instructions match project config',\n      };\n\n    case 'Dockerfile':\n    case 'docker-compose.yml':\n    case 'docker-compose.yaml':\n      return {\n        changeType: 'docker',\n        readmeSection: 'Docker / Deployment',\n        suggestion: 'Update README Docker instructions',\n      };\n\n    case '.env.example':\n    case '.env.template':\n      return {\n        changeType: 'env',\n        readmeSection: 'Environment Variables',\n        suggestion: 'Update README environment variable documentation',\n      };\n  }\n\n  // 2. API routes and endpoints\n  if (filePath.includes('/api/') || filePath.includes('/routes/') || filePath.includes('/endpoints/')) {\n    return {\n      changeType: 'api',\n      readmeSection: 'API Endpoints',\n      suggestion: 'Update README API documentation or OpenAPI spec',\n    };\n  }\n\n  // 3. Configuration directories\n  if (dirname.includes('/config') || dirname.includes('/settings')) {\n    return {\n      changeType: 'config',\n      readmeSection: 'Configuration',\n      suggestion: 'Document new configuration options in README',\n    };\n  }\n\n  // 4. Main entry points / index files\n  if (['index.ts', 'index.js', 'main.py', 'app.py', '__init__.py'].includes(filename)) {\n    const depth = filePath.split('/').length;\n    if (depth <= 4) {\n      return {\n        changeType: 'entry-point',\n        readmeSection: 'Getting Started',\n        suggestion: 'Review README getting started section for accuracy',\n      };\n    }\n  }\n\n  // 5. CLI tools and bin scripts\n  if (filePath.includes('/bin/') || filePath.includes('/cli/') || filePath.includes('/scripts/')) {\n    if (['sh', 'py', 'ts'].includes(extLower)) {\n      return {\n        changeType: 'cli',\n        readmeSection: 'CLI / Commands',\n        suggestion: 'Update README CLI usage documentation',\n      };\n    }\n  }\n\n  // 6. Public exports (index files with exports)\n  if (filename === 'index.ts' || filename === 'index.js') {\n    const fullPath = `${projectDir}/${filePath}`;\n    if (existsSync(fullPath)) {\n      try {\n        const { readFileSync } = require('fs');\n        const content = readFileSync(fullPath, 'utf8');\n        const exportCount = (content.match(/^export/gm) || []).length;\n        if (exportCount > 5) {\n          return {\n            changeType: 'exports',\n            readmeSection: 'API Reference',\n            suggestion: 'Consider updating API reference with new exports',\n          };\n        }\n      } catch {\n        // Ignore read errors\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find README file in project\n */\nfunction findReadme(projectDir: string): string | null {\n  for (const name of ['README.md', 'Readme.md', 'readme.md', 'README.rst', 'README']) {\n    if (existsSync(`${projectDir}/${name}`)) {\n      return `${projectDir}/${name}`;\n    }\n  }\n  return null;\n}\n\n/**\n * Sync README suggestions\n */\nexport function readmeSync(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only run for Write tool\n  if (toolName !== 'Write') {\n    return outputSilentSuccess();\n  }\n\n  const filePath = getField<string>(input, 'tool_input.file_path') || '';\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Skip internal files\n  if (filePath.includes('/.claude/') ||\n      filePath.includes('/node_modules/') ||\n      filePath.includes('/.git/') ||\n      filePath.includes('/dist/') ||\n      filePath.endsWith('.lock') ||\n      filePath.endsWith('.log')) {\n    return outputSilentSuccess();\n  }\n\n  // Skip test files - they don't typically require README updates\n  if (filePath.includes('test') || filePath.includes('spec') || filePath.includes('__tests__')) {\n    return outputSilentSuccess();\n  }\n\n  const projectDir = getProjectDir();\n\n  // Analyze file for README-relevant changes\n  const analysis = analyzeFileChange(filePath, projectDir);\n\n  if (!analysis) {\n    return outputSilentSuccess();\n  }\n\n  // Check if README exists\n  const readmePath = findReadme(projectDir);\n\n  let contextMsg: string;\n\n  if (readmePath) {\n    // Check when README was last modified\n    let daysOld = 0;\n    try {\n      const stats = statSync(readmePath);\n      const mtime = stats.mtime.getTime();\n      const now = Date.now();\n      daysOld = Math.floor((now - mtime) / (86400 * 1000));\n    } catch {\n      // Ignore stat errors\n    }\n\n    let suggestion = analysis.suggestion;\n    if (daysOld > 30) {\n      suggestion = `${suggestion} (README last updated ${daysOld}+ days ago)`;\n    }\n\n    contextMsg = `README sync: ${analysis.changeType} change in ${filePath.split('/').pop()}. Section: '${analysis.readmeSection}'. ${suggestion}`;\n  } else {\n    contextMsg = `README sync: ${analysis.changeType} change detected but no README.md found. Consider creating one.`;\n  }\n\n  // Truncate if too long\n  if (contextMsg.length > 200) {\n    contextMsg = `README sync: ${analysis.changeType} change detected. Consider updating '${analysis.readmeSection}' section.`;\n  }\n\n  // Log the suggestion\n  const logDir = `${projectDir}/.claude/hooks/logs`;\n  try {\n    mkdirSync(logDir, { recursive: true });\n    const timestamp = new Date().toISOString();\n    appendFileSync(\n      `${logDir}/readme-sync.log`,\n      `[${timestamp}] README_SYNC: ${analysis.changeType} change in ${filePath} -> ${analysis.readmeSection}\\n`\n    );\n  } catch {\n    // Ignore log errors\n  }\n\n  logHook('readme-sync', `README_SYNC: ${analysis.changeType} change suggests README update`);\n\n  // Output using CC 2.1.9 additionalContext format\n  return {\n    continue: true,\n    hookSpecificOutput: {\n      additionalContext: contextMsg,\n    },\n  };\n}\n", "/**\n * Release Lock on Commit - PostToolUse Hook\n * Releases file locks after successful git commit\n *\n * Triggers on: Bash with git commit that succeeded\n * Action: Release locks on committed files\n * CC 2.1.7 Compliant: Proper JSON output\n *\n * Version: 1.0.1\n * Part of Multi-Worktree Coordination System\n */\n\nimport { existsSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getProjectDir } from '../../lib/common.js';\n\n/**\n * Release file locks after Write operations\n * Note: This hook is for Write tool - locks are released on session end or explicit release\n */\nexport function releaseLockOnCommit(_input: HookInput): HookResult {\n  const projectDir = getProjectDir();\n  const coordLib = `${projectDir}/.claude/coordination/lib/coordination.sh`;\n\n  // Check if coordination lib exists\n  if (!existsSync(coordLib)) {\n    return outputSilentSuccess();\n  }\n\n  // This hook runs after Write tool - we don't release locks here\n  // Locks are released on session end or explicit release\n  // The coordination system handles auto-expiration of stale locks\n\n  return outputSilentSuccess();\n}\n", "/**\n * Issue Progress Commenter - Queue commit progress for GitHub issue updates\n * Part of OrchestKit Plugin - Issue Progress Tracking\n *\n * Triggers: After successful git commit commands\n * Function: Extracts issue number from branch name or commit message and queues\n *           progress for batch commenting at session end\n *\n * CC 2.1.9 Compliant: Uses suppressOutput for silent operation\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getSessionId, logHook } from '../../lib/common.js';\n\ninterface ProgressFile {\n  session_id: string;\n  issues: Record<string, IssueProgress>;\n}\n\ninterface IssueProgress {\n  commits: CommitInfo[];\n  tasks_completed: string[];\n  pr_url: string | null;\n  branch: string;\n}\n\ninterface CommitInfo {\n  sha: string;\n  message: string;\n  timestamp: string;\n}\n\n/**\n * Extract issue number from branch name (e.g., issue/123-description, fix/123-bug)\n */\nfunction extractIssueFromBranch(branch: string): string | null {\n  // Pattern: issue/123-*, fix/123-*, feature/123-*, etc.\n  let match = branch.match(/^(issue|fix|feature|bug|feat)\\/(\\d+)/);\n  if (match) {\n    return match[2];\n  }\n\n  // Pattern: 123-description (issue number at start)\n  match = branch.match(/^(\\d+)-/);\n  if (match) {\n    return match[1];\n  }\n\n  return null;\n}\n\n/**\n * Extract issue number from commit message (e.g., \"fix(#123): message\" or \"closes #123\")\n */\nfunction extractIssueFromCommit(message: string): string | null {\n  // Pattern: (#123) or #123 in message\n  let match = message.match(/#(\\d+)/);\n  if (match) {\n    return match[1];\n  }\n\n  // Pattern: fixes/closes/resolves #123\n  match = message.match(/(fix|fixes|close|closes|resolve|resolves)\\s+#?(\\d+)/i);\n  if (match) {\n    return match[2];\n  }\n\n  return null;\n}\n\n/**\n * Get current branch name\n */\nfunction getCurrentBranch(): string {\n  try {\n    return execSync('git branch --show-current 2>/dev/null || git rev-parse --abbrev-ref HEAD 2>/dev/null', {\n      encoding: 'utf8',\n      timeout: 5000,\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Get latest commit info\n */\nfunction getLatestCommit(): CommitInfo | null {\n  try {\n    const sha = execSync('git rev-parse --short HEAD 2>/dev/null', {\n      encoding: 'utf8',\n      timeout: 5000,\n    }).trim();\n\n    const message = execSync('git log -1 --pretty=%s 2>/dev/null', {\n      encoding: 'utf8',\n      timeout: 5000,\n    }).trim();\n\n    const timestamp = execSync('git log -1 --pretty=%cI 2>/dev/null', {\n      encoding: 'utf8',\n      timeout: 5000,\n    }).trim() || new Date().toISOString();\n\n    return { sha, message, timestamp };\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Initialize progress file if needed\n */\nfunction initProgressFile(progressFile: string, sessionId: string): void {\n  if (!existsSync(progressFile)) {\n    try {\n      mkdirSync(require('path').dirname(progressFile), { recursive: true });\n      writeFileSync(progressFile, JSON.stringify({\n        session_id: sessionId,\n        issues: {},\n      }));\n    } catch {\n      // Ignore init errors\n    }\n  }\n}\n\n/**\n * Add commit to issue progress queue\n */\nfunction queueCommitProgress(\n  issueNum: string,\n  commit: CommitInfo,\n  branch: string,\n  progressFile: string,\n  sessionId: string\n): boolean {\n  initProgressFile(progressFile, sessionId);\n\n  try {\n    const data: ProgressFile = JSON.parse(readFileSync(progressFile, 'utf8'));\n\n    if (!data.issues[issueNum]) {\n      data.issues[issueNum] = {\n        commits: [],\n        tasks_completed: [],\n        pr_url: null,\n        branch,\n      };\n    }\n\n    data.issues[issueNum].commits.push(commit);\n    data.issues[issueNum].branch = branch;\n\n    writeFileSync(progressFile, JSON.stringify(data, null, 2));\n    logHook('issue-progress-commenter', `Queued commit for issue #${issueNum}`);\n    return true;\n  } catch {\n    logHook('issue-progress-commenter', `Error queuing commit for issue #${issueNum}`);\n    return false;\n  }\n}\n\n/**\n * Queue commit progress for GitHub issue updates\n */\nexport function issueProgressCommenter(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process Bash tool\n  if (toolName !== 'Bash') {\n    return outputSilentSuccess();\n  }\n\n  const command = getField<string>(input, 'tool_input.command') || '';\n  const exitCode = input.exit_code ?? 0;\n\n  // Only process successful git commit commands\n  if (!/git\\s+commit/i.test(command) || exitCode !== 0) {\n    return outputSilentSuccess();\n  }\n\n  logHook('issue-progress-commenter', 'Processing git commit command...');\n\n  // Check if gh CLI is available\n  try {\n    execSync('which gh', { stdio: 'ignore', timeout: 2000 });\n  } catch {\n    logHook('issue-progress-commenter', 'gh CLI not available, skipping issue progress tracking');\n    return outputSilentSuccess();\n  }\n\n  // Check if we're in a git repo with GitHub remote\n  try {\n    const remote = execSync('git remote get-url origin 2>/dev/null', {\n      encoding: 'utf8',\n      timeout: 5000,\n    });\n    if (!remote.includes('github')) {\n      logHook('issue-progress-commenter', 'Not a GitHub repository, skipping');\n      return outputSilentSuccess();\n    }\n  } catch {\n    return outputSilentSuccess();\n  }\n\n  // Get branch and commit info\n  const branch = getCurrentBranch();\n  if (!branch) {\n    logHook('issue-progress-commenter', 'Could not determine current branch');\n    return outputSilentSuccess();\n  }\n\n  // Try to extract issue number\n  let issueNum = extractIssueFromBranch(branch);\n\n  // If not found in branch, try commit message\n  if (!issueNum) {\n    try {\n      const commitMsg = execSync('git log -1 --pretty=%s 2>/dev/null', {\n        encoding: 'utf8',\n        timeout: 5000,\n      }).trim();\n      issueNum = extractIssueFromCommit(commitMsg);\n    } catch {\n      // Ignore\n    }\n  }\n\n  // If no issue number found, skip silently\n  if (!issueNum) {\n    logHook('issue-progress-commenter', `No issue number found in branch '${branch}' or commit message`);\n    return outputSilentSuccess();\n  }\n\n  logHook('issue-progress-commenter', `Found issue #${issueNum}`);\n\n  // Verify issue exists (quick check)\n  try {\n    execSync(`gh issue view ${issueNum} --json number`, { stdio: 'ignore', timeout: 5000 });\n  } catch {\n    logHook('issue-progress-commenter', `Issue #${issueNum} not found or not accessible`);\n    return outputSilentSuccess();\n  }\n\n  // Get commit info and queue it\n  const commit = getLatestCommit();\n  if (!commit) {\n    logHook('issue-progress-commenter', 'Could not get commit info');\n    return outputSilentSuccess();\n  }\n\n  // Sanitize session ID - prefer input.session_id, fallback to getSessionId()\n  const sessionId = (input.session_id || getSessionId()).replace(/[^a-zA-Z0-9_-]/g, '');\n  const progressFile = `/tmp/claude-session-${sessionId}/issue-progress.json`;\n\n  queueCommitProgress(issueNum, commit, branch, progressFile, sessionId);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Issue Subtask Updater - Auto-update issue checkboxes based on commit messages\n * Part of OrchestKit Plugin - Issue Progress Tracking\n *\n * Triggers: After successful git commit commands\n * Function: Parses commit message for task completion keywords and updates\n *           corresponding checkboxes in the GitHub issue body\n *\n * CC 2.1.9 Compliant: Uses suppressOutput for silent operation\n */\n\nimport { existsSync, readFileSync, writeFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getSessionId, logHook } from '../../lib/common.js';\n\ninterface ProgressFile {\n  session_id: string;\n  issues: Record<string, IssueProgress>;\n}\n\ninterface IssueProgress {\n  commits: unknown[];\n  tasks_completed: string[];\n  pr_url: string | null;\n}\n\n/**\n * Extract action and subject from commit message\n * e.g., \"feat(#123): Add input validation\" -> \"Add input validation\"\n */\nfunction extractTaskFromCommit(message: string): string {\n  // Remove conventional commit prefix: type(scope):\n  let task = message.replace(/^[a-z]+(\\([^)]*\\))?:\\s*/i, '');\n\n  // Remove issue references like (#123)\n  task = task.replace(/\\(#\\d+\\)/g, '');\n\n  return task.trim();\n}\n\n/**\n * Normalize text for comparison (lowercase, remove extra spaces)\n */\nfunction normalizeText(text: string): string {\n  return text.toLowerCase().replace(/\\s+/g, ' ').trim();\n}\n\n/**\n * Check if commit task matches a checkbox item\n */\nfunction matchesCheckbox(commitTask: string, checkboxText: string): boolean {\n  const normCommit = normalizeText(commitTask);\n  const normCheckbox = normalizeText(checkboxText);\n\n  // Exact match (after normalization)\n  if (normCommit === normCheckbox) {\n    return true;\n  }\n\n  // Commit task contains checkbox text\n  if (normCommit.includes(normCheckbox)) {\n    return true;\n  }\n\n  // Checkbox text contains commit task\n  if (normCheckbox.includes(normCommit)) {\n    return true;\n  }\n\n  // Check if they share significant words (at least 2 words matching)\n  const commitWords = new Set(normCommit.split(' ').filter(w => w.length >= 3));\n  const checkboxWords = normCheckbox.split(' ').filter(w => w.length >= 3);\n  let matchingWords = 0;\n\n  for (const word of checkboxWords) {\n    if (commitWords.has(word)) {\n      matchingWords++;\n    }\n  }\n\n  return matchingWords >= 2;\n}\n\n/**\n * Extract issue number from branch name\n */\nfunction extractIssueFromBranch(branch: string): string | null {\n  let match = branch.match(/^(issue|fix|feature|bug|feat)\\/(\\d+)/);\n  if (match) {\n    return match[2];\n  }\n\n  match = branch.match(/^(\\d+)-/);\n  if (match) {\n    return match[1];\n  }\n\n  return null;\n}\n\n/**\n * Extract issue number from commit message\n */\nfunction extractIssueFromCommit(message: string): string | null {\n  const match = message.match(/#(\\d+)/);\n  return match ? match[1] : null;\n}\n\n/**\n * Get unchecked tasks from issue body\n */\nfunction getUncheckedTasks(issueNum: string): string[] {\n  try {\n    const body = execSync(`gh issue view ${issueNum} --json body -q '.body' 2>/dev/null`, {\n      encoding: 'utf8',\n      timeout: 10000,\n    });\n\n    // Extract unchecked checkbox items: - [ ] text\n    const lines = body.split('\\n');\n    const unchecked: string[] = [];\n\n    for (const line of lines) {\n      const match = line.match(/^\\s*-\\s*\\[\\s*\\]\\s+(.+)/);\n      if (match) {\n        unchecked.push(match[1].trim());\n      }\n    }\n\n    return unchecked;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Update a checkbox from unchecked to checked\n */\nfunction updateCheckbox(issueNum: string, checkboxText: string): boolean {\n  logHook('issue-subtask-updater', `Attempting to update checkbox: '${checkboxText}' in issue #${issueNum}`);\n\n  try {\n    // Get current body\n    const body = execSync(`gh issue view ${issueNum} --json body -q '.body' 2>/dev/null`, {\n      encoding: 'utf8',\n      timeout: 10000,\n    });\n\n    // Escape special regex characters in checkbox text\n    const escapedText = checkboxText.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\n    // Replace unchecked with checked\n    const updatedBody = body.replace(\n      new RegExp(`(^\\\\s*-\\\\s*)\\\\[\\\\s*\\\\](\\\\s+${escapedText})`, 'm'),\n      '$1[x]$2'\n    );\n\n    // Check if anything changed\n    if (body === updatedBody) {\n      logHook('issue-subtask-updater', `No change needed for checkbox: '${checkboxText}'`);\n      return false;\n    }\n\n    // Get repo info\n    const repo = execSync(`gh repo view --json nameWithOwner -q '.nameWithOwner' 2>/dev/null`, {\n      encoding: 'utf8',\n      timeout: 5000,\n    }).trim();\n\n    // Update issue body via API\n    const bodyJson = JSON.stringify(updatedBody);\n    execSync(`gh api -X PATCH \"repos/${repo}/issues/${issueNum}\" -f body=${bodyJson}`, {\n      stdio: 'ignore',\n      timeout: 10000,\n    });\n\n    logHook('issue-subtask-updater', `Successfully updated checkbox: '${checkboxText}'`);\n    return true;\n  } catch (error) {\n    logHook('issue-subtask-updater', `Failed to update issue body: ${error}`);\n    return false;\n  }\n}\n\n/**\n * Record completed task in progress file\n */\nfunction recordTaskCompletion(issueNum: string, taskText: string, progressFile: string): void {\n  if (!existsSync(progressFile)) {\n    return;\n  }\n\n  try {\n    const data: ProgressFile = JSON.parse(readFileSync(progressFile, 'utf8'));\n\n    if (!data.issues[issueNum]) {\n      data.issues[issueNum] = {\n        commits: [],\n        tasks_completed: [],\n        pr_url: null,\n      };\n    }\n\n    if (!data.issues[issueNum].tasks_completed.includes(taskText)) {\n      data.issues[issueNum].tasks_completed.push(taskText);\n      writeFileSync(progressFile, JSON.stringify(data, null, 2));\n    }\n  } catch {\n    // Ignore errors\n  }\n}\n\n/**\n * Update issue subtasks based on commit\n */\nexport function issueSubtaskUpdater(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process Bash tool\n  if (toolName !== 'Bash') {\n    return outputSilentSuccess();\n  }\n\n  const command = getField<string>(input, 'tool_input.command') || '';\n  const exitCode = input.exit_code ?? 0;\n\n  // Only process successful git commit commands\n  if (!/git\\s+commit/i.test(command) || exitCode !== 0) {\n    return outputSilentSuccess();\n  }\n\n  logHook('issue-subtask-updater', 'Processing git commit for subtask updates...');\n\n  // Check if gh CLI is available\n  try {\n    execSync('which gh', { stdio: 'ignore', timeout: 2000 });\n  } catch {\n    logHook('issue-subtask-updater', 'gh CLI not available, skipping subtask updates');\n    return outputSilentSuccess();\n  }\n\n  // Check if we're in a git repo with GitHub remote\n  try {\n    const remote = execSync('git remote get-url origin 2>/dev/null', {\n      encoding: 'utf8',\n      timeout: 5000,\n    });\n    if (!remote.includes('github')) {\n      logHook('issue-subtask-updater', 'Not a GitHub repository, skipping');\n      return outputSilentSuccess();\n    }\n  } catch {\n    return outputSilentSuccess();\n  }\n\n  // Get branch and commit message\n  let branch = '';\n  let commitMsg = '';\n\n  try {\n    branch = execSync('git branch --show-current 2>/dev/null', {\n      encoding: 'utf8',\n      timeout: 5000,\n    }).trim();\n\n    commitMsg = execSync('git log -1 --pretty=%s 2>/dev/null', {\n      encoding: 'utf8',\n      timeout: 5000,\n    }).trim();\n  } catch {\n    return outputSilentSuccess();\n  }\n\n  // Extract issue number\n  let issueNum = extractIssueFromBranch(branch);\n  if (!issueNum) {\n    issueNum = extractIssueFromCommit(commitMsg);\n  }\n\n  if (!issueNum) {\n    logHook('issue-subtask-updater', 'No issue number found');\n    return outputSilentSuccess();\n  }\n\n  logHook('issue-subtask-updater', `Found issue #${issueNum}, checking for matching subtasks...`);\n\n  // Extract task from commit message\n  const commitTask = extractTaskFromCommit(commitMsg);\n  if (!commitTask) {\n    logHook('issue-subtask-updater', 'Could not extract task from commit message');\n    return outputSilentSuccess();\n  }\n\n  logHook('issue-subtask-updater', `Commit task: '${commitTask}'`);\n\n  // Get unchecked tasks from issue\n  const uncheckedTasks = getUncheckedTasks(issueNum);\n  if (uncheckedTasks.length === 0) {\n    logHook('issue-subtask-updater', `No unchecked tasks in issue #${issueNum}`);\n    return outputSilentSuccess();\n  }\n\n  // Check each unchecked task for a match\n  let matched = false;\n  const sessionId = (input.session_id || getSessionId()).replace(/[^a-zA-Z0-9_-]/g, '');\n  const progressFile = `/tmp/claude-session-${sessionId}/issue-progress.json`;\n\n  for (const checkboxText of uncheckedTasks) {\n    if (matchesCheckbox(commitTask, checkboxText)) {\n      logHook('issue-subtask-updater', `Found matching checkbox: '${checkboxText}'`);\n\n      if (updateCheckbox(issueNum, checkboxText)) {\n        recordTaskCompletion(issueNum, checkboxText, progressFile);\n        matched = true;\n      }\n    }\n  }\n\n  if (!matched) {\n    logHook('issue-subtask-updater', `No matching checkboxes found for task: '${commitTask}'`);\n    return outputSilentSuccess();\n  }\n\n  // Provide additionalContext to Claude when tasks are updated (CC 2.1.9)\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PostToolUse',\n      additionalContext: `Issue #${issueNum}: Automatically marked sub-task as complete based on commit.`,\n    },\n  };\n}\n", "/**\n * Pattern Extractor - Automatic pattern extraction from bash events\n * Part of OrchestKit Plugin - Cross-Project Patterns (#48) + Best Practices (#49)\n *\n * Automatically extracts patterns from:\n * - git commit messages\n * - gh pr merge\n * - test results (pass/fail)\n * - build results\n *\n * CC 2.1.9 Compliant: Uses additionalContext for pattern injection\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getProjectDir, logHook } from '../../lib/common.js';\n\ninterface PatternQueue {\n  patterns: PatternEntry[];\n}\n\ninterface PatternEntry {\n  text: string;\n  category: string;\n  outcome: string;\n  source: string;\n  timestamp: string;\n  project: string;\n}\n\n// Tech detection patterns\nconst TECH_PATTERNS: Record<string, RegExp> = {\n  JWT: /jwt|jsonwebtoken/i,\n  OAuth2: /oauth|oauth2/i,\n  PostgreSQL: /postgres|postgresql|psql/i,\n  Redis: /redis/i,\n  React: /react/i,\n  FastAPI: /fastapi/i,\n  SQLAlchemy: /sqlalchemy/i,\n  Alembic: /alembic/i,\n  'cursor-pagination': /cursor.based|keyset/i,\n  'offset-pagination': /offset.pagination/i,\n  WebSocket: /websocket/i,\n  SSE: /sse|server.sent/i,\n  GraphQL: /graphql/i,\n  REST: /rest.api|restful/i,\n};\n\n// Category patterns from commit prefixes\nconst CATEGORY_PATTERNS: Record<string, RegExp> = {\n  feature: /^feat:|^feature:/i,\n  bugfix: /^fix:|^bugfix:/i,\n  refactor: /^refactor:/i,\n  optimization: /^perf:|^performance:/i,\n  security: /^security:|^sec:/i,\n  testing: /^test:|^tests:/i,\n};\n\n// Best practice category detection\nconst BEST_PRACTICE_CATEGORIES: Record<string, RegExp> = {\n  pagination: /cursor|pagination|offset|limit|page/i,\n  caching: /cache|redis|memcache|ttl/i,\n  authentication: /auth|jwt|oauth|token|login/i,\n  validation: /validate|validation|schema|pydantic|zod/i,\n  testing: /test|spec|coverage|mock/i,\n  security: /security|encrypt|hash|secret|credential/i,\n  performance: /performance|optimize|cache|index/i,\n  error_handling: /error|exception|retry|fallback/i,\n};\n\n/**\n * Get project ID from directory\n */\nfunction getProjectId(): string {\n  const projectDir = getProjectDir();\n  return projectDir.split('/').pop() || 'unknown';\n}\n\n/**\n * Extract tech and pattern info from text\n */\nfunction extractPatternInfo(text: string): { tech: string; pattern: string } {\n  const textLower = text.toLowerCase();\n  let tech = 'unknown';\n  let pattern = 'general';\n\n  // Detect technologies\n  for (const [name, regex] of Object.entries(TECH_PATTERNS)) {\n    if (regex.test(textLower)) {\n      tech = name;\n      break;\n    }\n  }\n\n  // Detect patterns from commit prefixes\n  for (const [name, regex] of Object.entries(CATEGORY_PATTERNS)) {\n    if (regex.test(text)) {\n      pattern = name;\n      break;\n    }\n  }\n\n  return { tech, pattern };\n}\n\n/**\n * Detect best practice category\n */\nfunction detectBestPracticeCategory(text: string): string {\n  for (const [category, regex] of Object.entries(BEST_PRACTICE_CATEGORIES)) {\n    if (regex.test(text)) {\n      return category;\n    }\n  }\n  return 'general';\n}\n\n/**\n * Queue a pattern for storage (batched on session end)\n */\nfunction queuePattern(\n  text: string,\n  category: string,\n  outcome: string,\n  source: string,\n  patternsQueue: string\n): void {\n  const timestamp = new Date().toISOString();\n  const projectId = getProjectId();\n\n  // Initialize queue file if needed\n  if (!existsSync(patternsQueue)) {\n    try {\n      mkdirSync(require('path').dirname(patternsQueue), { recursive: true });\n      writeFileSync(patternsQueue, JSON.stringify({ patterns: [] }));\n    } catch {\n      return;\n    }\n  }\n\n  try {\n    const data: PatternQueue = JSON.parse(readFileSync(patternsQueue, 'utf8'));\n    data.patterns.push({\n      text,\n      category,\n      outcome,\n      source,\n      timestamp,\n      project: projectId,\n    });\n    writeFileSync(patternsQueue, JSON.stringify(data, null, 2));\n    logHook('pattern-extractor', `Queued pattern: category=${category} outcome=${outcome} source=${source}`);\n  } catch {\n    // Ignore queue errors\n  }\n}\n\n/**\n * Handle git commit pattern extraction\n */\nfunction handleGitCommit(command: string, exitCode: number, patternsQueue: string): void {\n  // Extract commit message\n  let commitMsg = '';\n  const msgMatch = command.match(/-m\\s+[\"']([^\"']+)[\"']/) ||\n                   command.match(/-m\\s+([^\\s]+)/);\n  if (msgMatch) {\n    commitMsg = msgMatch[1];\n  }\n\n  if (!commitMsg) {\n    return;\n  }\n\n  const { tech, pattern } = extractPatternInfo(commitMsg);\n  const category = detectBestPracticeCategory(commitMsg);\n  const outcome = exitCode === 0 ? 'success' : 'failed';\n\n  // Build descriptive text\n  let patternText = commitMsg;\n  if (tech !== 'unknown') {\n    patternText = `[${tech}] ${commitMsg}`;\n  }\n\n  queuePattern(patternText, category, outcome, 'commit', patternsQueue);\n}\n\n/**\n * Handle PR merge pattern extraction\n */\nfunction handlePrMerge(command: string, exitCode: number, patternsQueue: string): void {\n  if (exitCode !== 0) {\n    return;\n  }\n\n  // PR merge is always a success pattern (reviewed code)\n  let prInfo = 'PR merged successfully';\n  const prMatch = command.match(/gh\\s+pr\\s+merge\\s+(\\d+)/);\n  if (prMatch) {\n    prInfo = `PR #${prMatch[1]} merged`;\n  }\n\n  queuePattern(prInfo, 'decision', 'success', 'pr-merge', patternsQueue);\n}\n\n/**\n * Handle test result pattern extraction\n */\nfunction handleTestResult(command: string, exitCode: number, patternsQueue: string): void {\n  let testFramework = 'unknown';\n\n  if (/pytest|py\\.test/.test(command)) testFramework = 'pytest';\n  else if (/jest/.test(command)) testFramework = 'jest';\n  else if (/vitest/.test(command)) testFramework = 'vitest';\n  else if (/npm\\s+test|yarn\\s+test|bun\\s+test/.test(command)) testFramework = 'npm-test';\n  else if (/go\\s+test/.test(command)) testFramework = 'go-test';\n\n  const outcome = exitCode === 0 ? 'success' : 'failed';\n  const patternText = `Tests ${outcome === 'success' ? 'passed' : 'failed'} (${testFramework})`;\n\n  queuePattern(patternText, 'testing', outcome, 'test-run', patternsQueue);\n}\n\n/**\n * Handle build result pattern extraction\n */\nfunction handleBuildResult(command: string, exitCode: number, patternsQueue: string): void {\n  let buildTool = 'unknown';\n\n  if (/npm\\s+run\\s+build/.test(command)) buildTool = 'npm';\n  else if (/yarn\\s+build/.test(command)) buildTool = 'yarn';\n  else if (/cargo\\s+build/.test(command)) buildTool = 'cargo';\n  else if (/make/.test(command)) buildTool = 'make';\n  else if (/docker\\s+build/.test(command)) buildTool = 'docker';\n\n  const outcome = exitCode === 0 ? 'success' : 'failed';\n  const patternText = `Build ${outcome === 'success' ? 'succeeded' : 'failed'} (${buildTool})`;\n\n  queuePattern(patternText, 'build', outcome, 'build', patternsQueue);\n}\n\n/**\n * Extract patterns from bash events\n */\nexport function patternExtractor(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process Bash tool\n  if (toolName !== 'Bash') {\n    return outputSilentSuccess();\n  }\n\n  const command = getField<string>(input, 'tool_input.command') || '';\n  const exitCode = input.exit_code ?? 0;\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  const commandLower = command.toLowerCase();\n  const projectDir = getProjectDir();\n  const patternsQueue = `${projectDir}/.claude/feedback/patterns-queue.json`;\n\n  // Route to appropriate handler\n  if (/git\\s+commit/.test(commandLower)) {\n    handleGitCommit(command, exitCode, patternsQueue);\n  } else if (/gh\\s+pr\\s+merge/.test(commandLower)) {\n    handlePrMerge(command, exitCode, patternsQueue);\n  } else if (/pytest|jest|vitest|npm\\s+test|yarn\\s+test|bun\\s+test|go\\s+test/.test(commandLower)) {\n    handleTestResult(command, exitCode, patternsQueue);\n  } else if (/npm\\s+run\\s+build|yarn\\s+build|cargo\\s+build|make|docker\\s+build/.test(commandLower)) {\n    handleBuildResult(command, exitCode, patternsQueue);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Skill Usage Optimizer - Track skill usage and suggest consolidation\n * Hook: PostToolUse (Skill)\n * Issue: #127 (CRITICAL)\n *\n * Tracks which skills are used and how often.\n * Stores metrics in .claude/feedback/skill-usage.json\n * Suggests skill consolidation if overlap detected.\n *\n * CC 2.1.9 Compliant: Uses additionalContext for suggestions\n * Version: 1.0.0\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getProjectDir, getSessionId, logHook } from '../../lib/common.js';\n\ninterface SkillUsageFile {\n  version: string;\n  skills: Record<string, number>;\n  sessions: Record<string, string[]>;\n  last_updated: string;\n}\n\n// Skill overlap definitions for consolidation suggestions\nconst SKILL_OVERLAPS: Record<string, string> = {\n  'api-design-framework|fastapi-advanced': 'Both relate to API design. Consider using api-design-framework for patterns, fastapi-advanced for implementation.',\n  'sqlalchemy-2-async|database-schema-designer': 'Both relate to database. Use database-schema-designer for schema design, sqlalchemy-2-async for async patterns.',\n  'caching-strategies|performance-optimization': 'Both optimize performance. Consider consolidating caching queries.',\n  'auth-patterns|owasp-top-10': 'Both relate to security. auth-patterns for implementation, owasp-top-10 for validation.',\n  'asyncio-advanced|connection-pooling': 'Both relate to async. asyncio-advanced for patterns, connection-pooling for specific optimization.',\n};\n\n/**\n * Initialize usage file if it doesn't exist\n */\nfunction initUsageFile(usageFile: string): void {\n  if (!existsSync(usageFile)) {\n    try {\n      mkdirSync(require('path').dirname(usageFile), { recursive: true });\n      writeFileSync(usageFile, JSON.stringify({\n        version: '1.0',\n        skills: {},\n        sessions: {},\n        last_updated: '',\n      }));\n    } catch {\n      // Ignore init errors\n    }\n  }\n}\n\n/**\n * Load usage data\n */\nfunction loadUsageData(usageFile: string): SkillUsageFile {\n  initUsageFile(usageFile);\n\n  try {\n    return JSON.parse(readFileSync(usageFile, 'utf8'));\n  } catch {\n    return {\n      version: '1.0',\n      skills: {},\n      sessions: {},\n      last_updated: '',\n    };\n  }\n}\n\n/**\n * Update skill usage count\n */\nfunction updateUsage(skill: string, sessionId: string, usageFile: string): void {\n  const data = loadUsageData(usageFile);\n  const timestamp = new Date().toISOString();\n\n  // Update skill count\n  data.skills[skill] = (data.skills[skill] || 0) + 1;\n\n  // Track session usage\n  if (!data.sessions[sessionId]) {\n    data.sessions[sessionId] = [];\n  }\n  if (!data.sessions[sessionId].includes(skill)) {\n    data.sessions[sessionId].push(skill);\n  }\n\n  // Update timestamp\n  data.last_updated = timestamp;\n\n  try {\n    writeFileSync(usageFile, JSON.stringify(data, null, 2));\n    logHook('skill-usage-optimizer', `Updated usage for skill: ${skill} (session: ${sessionId})`);\n  } catch {\n    // Ignore write errors\n  }\n}\n\n/**\n * Get session skills for overlap detection\n */\nfunction getSessionSkills(sessionId: string, usageFile: string): string[] {\n  const data = loadUsageData(usageFile);\n  return data.sessions[sessionId] || [];\n}\n\n/**\n * Check for skill overlaps and suggest consolidation\n */\nfunction checkOverlaps(currentSkill: string, sessionSkills: string[]): string | null {\n  for (const [overlapKey, suggestion] of Object.entries(SKILL_OVERLAPS)) {\n    const [skill1, skill2] = overlapKey.split('|');\n\n    // Check if current skill and any session skill form an overlap\n    if (currentSkill === skill1 || currentSkill === skill2) {\n      const otherSkill = currentSkill === skill1 ? skill2 : skill1;\n\n      if (sessionSkills.includes(otherSkill)) {\n        logHook('skill-usage-optimizer', `Overlap detected: ${skill1} + ${skill2}`);\n        return suggestion;\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get top used skills for context\n */\nfunction getUsageStats(usageFile: string): string {\n  const data = loadUsageData(usageFile);\n\n  // Get top 3 skills with counts\n  const entries = Object.entries(data.skills);\n  if (entries.length === 0) return '';\n\n  return entries\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 3)\n    .map(([skill, count]) => `${skill}:${count}`)\n    .join(', ');\n}\n\n/**\n * Track and optimize skill usage\n */\nexport function skillUsageOptimizer(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n  const skillName = getField<string>(input, 'tool_input.skill') ||\n                   getField<string>(input, 'tool_name') || '';\n\n  // Filter: Only process Skill tool uses\n  if (toolName !== 'Skill' && !skillName?.startsWith('skills/')) {\n    if (!skillName) {\n      return outputSilentSuccess();\n    }\n  }\n\n  if (!skillName) {\n    return outputSilentSuccess();\n  }\n\n  const projectDir = getProjectDir();\n  const usageFile = `${projectDir}/.claude/feedback/skill-usage.json`;\n  const sessionId = getSessionId();\n\n  // Update usage\n  updateUsage(skillName, sessionId, usageFile);\n\n  // Check for overlaps\n  const sessionSkills = getSessionSkills(sessionId, usageFile);\n  const overlapSuggestion = checkOverlaps(skillName, sessionSkills);\n\n  // Get usage stats\n  const usageStats = getUsageStats(usageFile);\n\n  // Build context message if we have suggestions or stats\n  let contextMsg = '';\n\n  if (overlapSuggestion) {\n    contextMsg = `Skill overlap: ${overlapSuggestion}`;\n    logHook('skill-usage-optimizer', `Suggesting consolidation for: ${skillName}`);\n  }\n\n  // Add stats info periodically (every 5th use of any skill)\n  const data = loadUsageData(usageFile);\n  const currentSkillCount = data.skills[skillName] || 0;\n\n  if (currentSkillCount > 0 && currentSkillCount % 5 === 0 && usageStats) {\n    if (contextMsg) {\n      contextMsg = `${contextMsg} | Top skills: ${usageStats}`;\n    } else {\n      contextMsg = `Top skills this project: ${usageStats}`;\n    }\n  }\n\n  // Output with context if we have something to say\n  if (contextMsg) {\n    // Truncate if too long\n    if (contextMsg.length > 200) {\n      contextMsg = contextMsg.substring(0, 197) + '...';\n    }\n\n    return {\n      continue: true,\n      hookSpecificOutput: {\n        additionalContext: contextMsg,\n      },\n    };\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * File Lock Release - Release locks after successful Write/Edit\n * CC 2.1.7 Compliant: Self-contained hook with stdin reading and self-guard\n * Hook: PostToolUse (Write|Edit)\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, getField, getProjectDir, getSessionId, logHook } from '../../lib/common.js';\n\n/**\n * Check if multi-instance coordination is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  try {\n    execSync('which sqlite3', { stdio: 'ignore', timeout: 2000 });\n    const projectDir = getProjectDir();\n    const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n    return existsSync(dbPath);\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Release file lock in coordination database\n */\nfunction releaseFileLock(filePath: string, instanceId: string): boolean {\n  const projectDir = getProjectDir();\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  if (!existsSync(dbPath)) {\n    return false;\n  }\n\n  try {\n    // Escape single quotes for SQLite\n    const escapedPath = filePath.replace(/'/g, \"''\");\n    const escapedInstance = instanceId.replace(/'/g, \"''\");\n\n    execSync(\n      `sqlite3 \"${dbPath}\" \"DELETE FROM file_locks WHERE file_path = '${escapedPath}' AND instance_id = '${escapedInstance}';\"`,\n      { stdio: 'ignore', timeout: 5000 }\n    );\n\n    logHook('file-lock-release', `Released lock for ${filePath}`);\n    return true;\n  } catch (error) {\n    logHook('file-lock-release', `Failed to release lock for ${filePath}: ${error}`);\n    return false;\n  }\n}\n\n/**\n * Get instance ID from environment or session\n */\nfunction getInstanceId(): string {\n  // Check environment first\n  if (process.env.INSTANCE_ID) {\n    return process.env.INSTANCE_ID;\n  }\n\n  // Check instance env file\n  const projectDir = getProjectDir();\n  const instanceEnv = `${projectDir}/.claude/.instance_env`;\n\n  if (existsSync(instanceEnv)) {\n    try {\n      const content = readFileSync(instanceEnv, 'utf8');\n      const match = content.match(/CLAUDE_INSTANCE_ID=[\"']?([^\"'\\n]+)/);\n      if (match) {\n        return match[1];\n      }\n    } catch {\n      // Ignore read errors\n    }\n  }\n\n  // Fall back to session ID\n  return getSessionId();\n}\n\n/**\n * Release file locks after Write/Edit operations\n */\nexport function fileLockRelease(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Self-guard: Only run for Write/Edit\n  if (toolName !== 'Write' && toolName !== 'Edit') {\n    return outputSilentSuccess();\n  }\n\n  // Self-guard: Only run if multi-instance coordination is enabled\n  if (!isMultiInstanceEnabled()) {\n    return outputSilentSuccess();\n  }\n\n  // Get file path\n  const filePath = getField<string>(input, 'tool_input.file_path') || '';\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Skip coordination directory files\n  if (filePath.includes('/.claude/coordination/')) {\n    return outputSilentSuccess();\n  }\n\n  // Check for errors in tool result\n  const toolResult = String(getField<unknown>(input, 'tool_result') || '');\n  if (toolResult.includes('error') || toolResult.includes('Error')) {\n    // Keep lock on error, will auto-expire\n    return outputSilentSuccess();\n  }\n\n  // Release lock\n  const instanceId = getInstanceId();\n  releaseFileLock(filePath, instanceId);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Analytics Consent Check - Check if user needs to be prompted for analytics consent\n * Part of OrchestKit Claude Plugin (#59)\n *\n * This hook runs on session start to check if user has been asked about analytics.\n * It outputs a gentle reminder or first-time prompt if appropriate.\n *\n * CC 2.1.7 Compliant: uses hookSpecificOutput.additionalContext for context injection\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface ConsentLog {\n  events: Array<{\n    action: string;\n    timestamp: string;\n  }>;\n}\n\ninterface ConsentStatus {\n  consented: boolean;\n  asked: boolean;\n}\n\n/**\n * Read consent status from consent manager config\n */\nfunction getConsentStatus(projectDir: string): ConsentStatus {\n  const consentFile = `${projectDir}/.claude/feedback/consent-status.json`;\n\n  if (!existsSync(consentFile)) {\n    return { consented: false, asked: false };\n  }\n\n  try {\n    const status = JSON.parse(readFileSync(consentFile, 'utf-8'));\n    return {\n      consented: status.consented === true,\n      asked: status.asked === true,\n    };\n  } catch {\n    return { consented: false, asked: false };\n  }\n}\n\n/**\n * Get the last consent event from the log\n */\nfunction getLastConsentEvent(projectDir: string): { action: string; timestamp: string } | null {\n  const consentLog = `${projectDir}/.claude/feedback/consent-log.json`;\n\n  if (!existsSync(consentLog)) {\n    return null;\n  }\n\n  try {\n    const log: ConsentLog = JSON.parse(readFileSync(consentLog, 'utf-8'));\n    if (log.events && log.events.length > 0) {\n      return log.events[log.events.length - 1];\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return null;\n}\n\n/**\n * Check if 30 days have passed since the last decline\n */\nfunction shouldShowReminder(lastTimestamp: string): boolean {\n  try {\n    const lastDate = new Date(lastTimestamp);\n    const now = new Date();\n    const daysSince = Math.floor((now.getTime() - lastDate.getTime()) / (1000 * 60 * 60 * 24));\n    return daysSince >= 30;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Analytics consent check hook\n */\nexport function analyticsConsentCheck(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const status = getConsentStatus(projectDir);\n\n  // Already consented - nothing to do\n  if (status.consented) {\n    logHook('analytics-consent-check', 'User has consented to analytics');\n    return outputSilentSuccess();\n  }\n\n  // Already asked and declined - check if we should show reminder\n  if (status.asked) {\n    const lastEvent = getLastConsentEvent(projectDir);\n\n    if (lastEvent && (lastEvent.action === 'declined' || lastEvent.action === 'revoked')) {\n      if (shouldShowReminder(lastEvent.timestamp)) {\n        // Show gentle reminder (not blocking)\n        logHook('analytics-consent-check', 'Showing 30-day reminder');\n        return {\n          continue: true,\n          systemMessage:\n            'Reminder: Anonymous analytics help improve OrchestKit. Enable with /ork:feedback opt-in',\n        };\n      }\n    }\n\n    // Don't show anything if recently asked\n    logHook('analytics-consent-check', 'User recently declined, not prompting');\n    return outputSilentSuccess();\n  }\n\n  // First time - show a brief notice (not the full prompt, to avoid blocking)\n  logHook('analytics-consent-check', 'First time user, showing brief notice');\n  return {\n    continue: true,\n    systemMessage:\n      'OrchestKit collects local usage metrics. Share anonymously with /ork:feedback opt-in',\n  };\n}\n", "/**\n * Coordination Cleanup - Unregister instance at session end\n * Hook: SessionEnd\n * CC 2.1.6 Compliant: ensures JSON output on all code paths\n */\n\nimport { existsSync, readFileSync, writeFileSync, unlinkSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface HeartbeatFile {\n  status: string;\n  [key: string]: unknown;\n}\n\n/**\n * Load instance ID from environment file\n */\nfunction loadInstanceId(projectDir: string): string | null {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  if (!existsSync(envFile)) {\n    return null;\n  }\n\n  try {\n    const content = readFileSync(envFile, 'utf-8');\n    const match = content.match(/CLAUDE_INSTANCE_ID=([^\\n]+)/);\n    if (match) {\n      return match[1].trim();\n    }\n  } catch {\n    // Ignore read errors\n  }\n\n  return null;\n}\n\n/**\n * Update heartbeat file to stopping status\n */\nfunction updateHeartbeatStatus(projectDir: string, instanceId: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n  const heartbeatFile = `${heartbeatsDir}/${instanceId}.json`;\n\n  if (!existsSync(heartbeatFile)) {\n    return;\n  }\n\n  try {\n    const content: HeartbeatFile = JSON.parse(readFileSync(heartbeatFile, 'utf-8'));\n    content.status = 'stopping';\n    writeFileSync(heartbeatFile, JSON.stringify(content, null, 2));\n    logHook('coordination-cleanup', `Updated heartbeat status to 'stopping' for ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-cleanup', `Failed to update heartbeat: ${err}`);\n  }\n}\n\n/**\n * Unregister instance from coordination database\n */\nfunction unregisterInstance(projectDir: string, instanceId: string): void {\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  if (!existsSync(dbPath)) {\n    logHook('coordination-cleanup', 'No coordination database found');\n    return;\n  }\n\n  // Note: In TypeScript, we would need sqlite3 package for actual DB operations\n  // For now, we log the intent - the actual cleanup is done via bash fallback\n  logHook('coordination-cleanup', `Would unregister instance: ${instanceId}`);\n}\n\n/**\n * Remove instance environment file\n */\nfunction cleanupInstanceEnv(projectDir: string): void {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  try {\n    if (existsSync(envFile)) {\n      unlinkSync(envFile);\n      logHook('coordination-cleanup', 'Removed instance environment file');\n    }\n  } catch (err) {\n    logHook('coordination-cleanup', `Failed to remove instance env: ${err}`);\n  }\n}\n\n/**\n * Coordination cleanup hook\n */\nexport function coordinationCleanup(input: HookInput): HookResult {\n  logHook('coordination-cleanup', 'Starting coordination cleanup');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const instanceId = loadInstanceId(projectDir);\n\n  if (instanceId) {\n    // Update heartbeat to stopping status\n    updateHeartbeatStatus(projectDir, instanceId);\n\n    // Unregister instance (releases all locks)\n    unregisterInstance(projectDir, instanceId);\n  }\n\n  // Clean up instance env file\n  cleanupInstanceEnv(projectDir);\n\n  logHook('coordination-cleanup', 'Coordination cleanup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Coordination Initialization - Register instance at session start\n * Hook: SessionStart\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n * Version: 1.1.0\n * Optimized with timeout to prevent startup hangs\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionState {\n  current_task?: {\n    description?: string;\n  };\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Get task description from session state\n */\nfunction getTaskDescription(projectDir: string): string {\n  const stateFile = `${projectDir}/.claude/context/session/state.json`;\n\n  if (!existsSync(stateFile)) {\n    return 'General development';\n  }\n\n  try {\n    const state: SessionState = JSON.parse(readFileSync(stateFile, 'utf-8'));\n    return state.current_task?.description || 'General development';\n  } catch {\n    return 'General development';\n  }\n}\n\n/**\n * Get agent role from environment\n */\nfunction getAgentRole(): string {\n  return process.env.CLAUDE_SUBAGENT_ROLE || 'main';\n}\n\n/**\n * Generate unique instance ID\n */\nfunction generateInstanceId(): string {\n  const sessionId = getSessionId();\n  const timestamp = new Date().toISOString().replace(/[-:T.Z]/g, '').slice(0, 14);\n  const random = Math.random().toString(36).substring(2, 8);\n  return `${sessionId.slice(0, 8)}-${timestamp}-${random}`;\n}\n\n/**\n * Save instance ID to environment file\n */\nfunction saveInstanceId(projectDir: string, instanceId: string): void {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  try {\n    mkdirSync(`${projectDir}/.claude`, { recursive: true });\n    appendFileSync(envFile, `CLAUDE_INSTANCE_ID=${instanceId}\\n`);\n    logHook('coordination-init', `Saved instance ID: ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-init', `Failed to save instance ID: ${err}`);\n  }\n}\n\n/**\n * Initialize heartbeat for this instance\n */\nfunction initHeartbeat(projectDir: string, instanceId: string, taskDesc: string, agentRole: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n\n  try {\n    mkdirSync(heartbeatsDir, { recursive: true });\n\n    const heartbeat = {\n      instance_id: instanceId,\n      task: taskDesc,\n      role: agentRole,\n      status: 'active',\n      started_at: new Date().toISOString(),\n      last_heartbeat: new Date().toISOString(),\n    };\n\n    writeFileSync(`${heartbeatsDir}/${instanceId}.json`, JSON.stringify(heartbeat, null, 2));\n    logHook('coordination-init', `Initialized heartbeat for ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-init', `Failed to initialize heartbeat: ${err}`);\n  }\n}\n\n/**\n * Coordination initialization hook\n */\nexport function coordinationInit(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    logHook('coordination-init', 'Multi-instance not enabled, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('coordination-init', 'Skipping coordination init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('coordination-init', 'Starting coordination initialization');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const taskDesc = getTaskDescription(projectDir);\n  const agentRole = getAgentRole();\n\n  // Generate and save instance ID\n  const instanceId = generateInstanceId();\n\n  // Store instance ID for other hooks\n  process.env.CLAUDE_INSTANCE_ID = instanceId;\n  saveInstanceId(projectDir, instanceId);\n\n  // Initial heartbeat\n  initHeartbeat(projectDir, instanceId, taskDesc, agentRole);\n\n  logHook('coordination-init', `Coordination initialized: ${instanceId}`);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Instance Heartbeat - Lifecycle Hook\n * Updates heartbeat timestamp and cleans up stale instances\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n *\n * Runs periodically to:\n * 1. Update this instance's heartbeat\n * 2. Clean up stale instances (no heartbeat > 5 min)\n * 3. Release orphaned locks\n *\n * Version: 1.1.0\n * Part of Multi-Worktree Coordination System\n */\n\nimport { existsSync, readFileSync, writeFileSync, readdirSync, unlinkSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface HeartbeatInfo {\n  instance_id: string;\n  status: string;\n  last_heartbeat: string;\n  [key: string]: unknown;\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Get instance ID from environment\n */\nfunction getInstanceId(): string {\n  return process.env.CLAUDE_INSTANCE_ID || getSessionId();\n}\n\n/**\n * Load instance ID from environment file\n */\nfunction loadInstanceIdFromFile(projectDir: string): string | null {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  if (!existsSync(envFile)) {\n    return null;\n  }\n\n  try {\n    const content = readFileSync(envFile, 'utf-8');\n    const match = content.match(/CLAUDE_INSTANCE_ID=([^\\n]+)/);\n    if (match) {\n      return match[1].trim();\n    }\n  } catch {\n    // Ignore read errors\n  }\n\n  return null;\n}\n\n/**\n * Update heartbeat timestamp\n */\nfunction updateHeartbeat(projectDir: string, instanceId: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n  const heartbeatFile = `${heartbeatsDir}/${instanceId}.json`;\n\n  if (!existsSync(heartbeatFile)) {\n    // Create new heartbeat if doesn't exist\n    mkdirSync(heartbeatsDir, { recursive: true });\n    const heartbeat: HeartbeatInfo = {\n      instance_id: instanceId,\n      status: 'active',\n      last_heartbeat: new Date().toISOString(),\n    };\n    writeFileSync(heartbeatFile, JSON.stringify(heartbeat, null, 2));\n    logHook('instance-heartbeat', `Created heartbeat for ${instanceId}`);\n    return;\n  }\n\n  try {\n    const content: HeartbeatInfo = JSON.parse(readFileSync(heartbeatFile, 'utf-8'));\n    content.last_heartbeat = new Date().toISOString();\n    content.status = 'active';\n    writeFileSync(heartbeatFile, JSON.stringify(content, null, 2));\n    logHook('instance-heartbeat', `Updated heartbeat for ${instanceId}`);\n  } catch (err) {\n    logHook('instance-heartbeat', `Failed to update heartbeat: ${err}`);\n  }\n}\n\n/**\n * Clean up stale instances (no heartbeat > 5 min)\n */\nfunction cleanupStaleInstances(projectDir: string, currentInstanceId: string): number {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n\n  if (!existsSync(heartbeatsDir)) {\n    return 0;\n  }\n\n  const staleThresholdMs = 5 * 60 * 1000; // 5 minutes\n  const now = Date.now();\n  let cleanedCount = 0;\n\n  try {\n    const files = readdirSync(heartbeatsDir).filter((f) => f.endsWith('.json'));\n\n    for (const file of files) {\n      const filePath = `${heartbeatsDir}/${file}`;\n\n      try {\n        const content: HeartbeatInfo = JSON.parse(readFileSync(filePath, 'utf-8'));\n\n        // Skip current instance\n        if (content.instance_id === currentInstanceId) {\n          continue;\n        }\n\n        // Check if stale\n        const lastHeartbeat = new Date(content.last_heartbeat).getTime();\n        const age = now - lastHeartbeat;\n\n        if (age > staleThresholdMs) {\n          unlinkSync(filePath);\n          cleanedCount++;\n          logHook('instance-heartbeat', `Cleaned up stale instance: ${content.instance_id}`);\n        }\n      } catch {\n        // Skip files that can't be read\n      }\n    }\n  } catch (err) {\n    logHook('instance-heartbeat', `Failed to scan heartbeats: ${err}`);\n  }\n\n  return cleanedCount;\n}\n\n/**\n * Instance heartbeat hook\n */\nexport function instanceHeartbeat(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('instance-heartbeat', 'Skipping instance heartbeat (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Get instance ID from environment or file\n  let instanceId = getInstanceId();\n  if (!instanceId || instanceId === 'unknown') {\n    instanceId = loadInstanceIdFromFile(projectDir) || instanceId;\n  }\n\n  if (!instanceId) {\n    logHook('instance-heartbeat', 'No instance ID available');\n    return outputSilentSuccess();\n  }\n\n  // Update heartbeat\n  updateHeartbeat(projectDir, instanceId);\n\n  // Clean up stale instances\n  const cleanedCount = cleanupStaleInstances(projectDir, instanceId);\n  if (cleanedCount > 0) {\n    logHook('instance-heartbeat', `Cleaned up ${cleanedCount} stale instance(s)`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Analytics Tracker - Monitor usage patterns continuously\n * Hook: SessionStart / UserPromptSubmit\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Tracks mem0 usage patterns\n * - Monitors feature utilization\n * - Identifies underutilized features\n *\n * Version: 1.0.0\n */\n\nimport { existsSync, mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  // Check for MEM0_API_KEY environment variable\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Mem0 analytics tracker hook\n */\nexport function mem0AnalyticsTracker(input: HookInput): HookResult {\n  logHook('mem0-analytics-tracker', 'Mem0 analytics tracker starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-analytics-tracker', 'Mem0 not available, skipping analytics');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const analyticsFile = `${projectDir}/.claude/logs/mem0-analytics.jsonl`;\n  const sessionId = input.session_id || getSessionId();\n  const timestamp = new Date().toISOString();\n\n  // Create analytics entry\n  const analyticsEntry = JSON.stringify({\n    session_id: sessionId,\n    timestamp: timestamp,\n    event: 'session_start',\n  });\n\n  // Append to analytics log\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n    appendFileSync(analyticsFile, analyticsEntry + '\\n');\n    logHook('mem0-analytics-tracker', 'Mem0 analytics tracked');\n  } catch (err) {\n    logHook('mem0-analytics-tracker', `Failed to write analytics: ${err}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Context Retrieval - Auto-loads memories at session start (Graph-First Architecture)\n * Hook: SessionStart\n * CC 2.1.7 Compliant - Works across any repository\n * CC 2.1.9 Compatible - Uses additionalContext for context injection\n *\n * Graph-First Architecture (v2.1):\n * - Knowledge graph (mcp__memory__*) is PRIMARY - always available, zero-config\n * - Mem0 cloud (mcp__mem0__*) is OPTIONAL enhancement for semantic search\n *\n * Version: 2.1.0 - Graph-first architecture\n * Part of Memory Fabric v2.1\n */\n\nimport { existsSync, readFileSync, mkdirSync, renameSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface PendingSyncFile {\n  memories?: unknown[];\n  scope?: string;\n  project_id?: string;\n}\n\ninterface Memory {\n  text: string;\n  metadata?: {\n    has_blockers?: boolean;\n    has_next_steps?: boolean;\n  };\n}\n\n/**\n * Get project ID for user_id hint\n */\nfunction getProjectId(projectDir: string): string {\n  const parts = projectDir.split('/');\n  const basename = parts[parts.length - 1] || 'unknown';\n  return basename.toLowerCase().replace(/\\s+/g, '-');\n}\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Check if pending sync file has valid JSON content\n */\nfunction hasValidPendingSync(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return false;\n  }\n\n  try {\n    const content = readFileSync(filePath, 'utf-8');\n    const parsed = JSON.parse(content);\n\n    // Check if it has meaningful content\n    if (!parsed || Object.keys(parsed).length === 0) {\n      return false;\n    }\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Archive pending sync file\n */\nfunction archivePendingSync(filePath: string, projectDir: string): void {\n  const processedDir = `${projectDir}/.claude/logs/mem0-processed`;\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n\n  try {\n    mkdirSync(processedDir, { recursive: true });\n\n    const basename = filePath.split('/').pop() || 'pending-sync';\n    const archiveName = basename.replace('.json', `.processed-${timestamp}.json`);\n    const archivePath = `${processedDir}/${archiveName}`;\n\n    renameSync(filePath, archivePath);\n    logHook('mem0-context-retrieval', `Archived pending sync to ${archivePath}`);\n  } catch (err) {\n    logHook('mem0-context-retrieval', `Warning: Could not archive ${filePath}: ${err}`);\n  }\n}\n\n/**\n * Check if memory-fabric skill exists\n */\nfunction hasMemoryFabricSkill(): boolean {\n  const pluginRoot = process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n  return existsSync(`${pluginRoot}/skills/memory-fabric/SKILL.md`);\n}\n\n/**\n * Memory context retrieval hook\n */\nexport function mem0ContextRetrieval(input: HookInput): HookResult {\n  logHook('mem0-context-retrieval', 'Mem0 context retrieval starting');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const projectId = getProjectId(projectDir);\n\n  // Pending sync file locations\n  const pendingSyncFile = `${projectDir}/.mem0-pending-sync.json`;\n  const pendingSyncGlobal = `${process.env.HOME || process.env.USERPROFILE || '/tmp'}/.claude/.mem0-pending-sync.json`;\n\n  // Determine which pending sync file to check\n  let pendingFile: string | null = null;\n\n  if (hasValidPendingSync(pendingSyncFile)) {\n    pendingFile = pendingSyncFile;\n    logHook('mem0-context-retrieval', `Found pending sync in project: ${pendingSyncFile}`);\n  } else if (hasValidPendingSync(pendingSyncGlobal)) {\n    // Check if global file is for this project\n    try {\n      const content: PendingSyncFile = JSON.parse(readFileSync(pendingSyncGlobal, 'utf-8'));\n      if (content.project_id === projectId) {\n        pendingFile = pendingSyncGlobal;\n        logHook('mem0-context-retrieval', 'Found pending sync in global location for this project');\n      } else {\n        logHook('mem0-context-retrieval', `Global pending sync exists but for different project: ${content.project_id}`);\n      }\n    } catch {\n      // Ignore parse errors\n    }\n  }\n\n  // Archive pending sync if found\n  if (pendingFile) {\n    logHook('mem0-context-retrieval', 'Found pending sync, archiving for processing');\n    archivePendingSync(pendingFile, projectDir);\n    logHook('mem0-context-retrieval', 'Pending sync archived - will be processed on next memory operation');\n  }\n\n  // Log memory availability status\n  if (isMem0Available()) {\n    logHook('mem0-context-retrieval', 'Graph + mem0 available for this session');\n  } else {\n    logHook('mem0-context-retrieval', 'Graph available (mem0 not configured) for this session');\n  }\n\n  // Note: SessionStart hooks must use simple success output (no hookSpecificOutput.additionalContext)\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Webhook Setup - Auto-configure webhooks on first mem0 usage\n * Hook: SessionStart\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Checks if webhooks exist for mem0 automation\n * - Creates webhooks if missing\n * - Configures webhook URL endpoint\n * - Sets up event types: memory.created, memory.updated, memory.deleted\n *\n * Version: 1.0.0\n */\n\nimport { existsSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface WebhookConfig {\n  webhook_name: string;\n  events: string[];\n  url: string;\n}\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Mem0 webhook setup hook\n */\nexport function mem0WebhookSetup(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('mem0-webhook-setup', 'Skipping mem0 webhook setup (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('mem0-webhook-setup', 'Mem0 webhook setup starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-webhook-setup', 'Mem0 not available, skipping webhook setup');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const webhookConfigFile = `${projectDir}/.claude/mem0-webhooks.json`;\n\n  // Webhook configuration\n  const webhookName = 'orchestkit-auto-sync';\n  const webhookEvents = ['memory.created', 'memory.updated', 'memory.deleted'];\n  const webhookUrl = process.env.MEM0_WEBHOOK_URL || 'https://example.com/webhook/mem0';\n\n  logHook('mem0-webhook-setup', 'Checking for existing webhooks');\n\n  // Note: Actual webhook creation would require mem0 API calls\n  // For now, we just save the config for reference\n  if (!process.env.MEM0_WEBHOOK_URL) {\n    logHook('mem0-webhook-setup', 'Webhook URL not configured (set MEM0_WEBHOOK_URL), skipping creation');\n  }\n\n  // Save webhook config\n  try {\n    mkdirSync(`${projectDir}/.claude`, { recursive: true });\n\n    const config: WebhookConfig = {\n      webhook_name: webhookName,\n      events: webhookEvents,\n      url: webhookUrl,\n    };\n\n    writeFileSync(webhookConfigFile, JSON.stringify(config, null, 2));\n    logHook('mem0-webhook-setup', 'Webhook config saved');\n  } catch (err) {\n    logHook('mem0-webhook-setup', `Failed to save webhook config: ${err}`);\n  }\n\n  logHook('mem0-webhook-setup', 'Webhook setup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Multi-Instance Coordination Initialization Hook\n * Runs on session start to register this Claude Code instance\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n * Version: 1.1.0\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface InstanceIdentity {\n  instance_id: string;\n  worktree_name: string;\n  worktree_path: string;\n  branch: string;\n  capabilities: string[];\n  agent_type: string | null;\n  model: string;\n  priority: number;\n  created_at: string;\n  status: string;\n  heartbeat_interval_ms: number;\n  last_heartbeat: string;\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Check if sqlite3 is available\n */\nfunction isSqlite3Available(): boolean {\n  try {\n    execSync('which sqlite3', { encoding: 'utf-8', stdio: 'pipe' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Generate unique instance ID\n */\nfunction generateInstanceId(projectDir: string): string {\n  const worktreeName = projectDir.split('/').pop() || 'unknown';\n  const timestamp = new Date().toISOString().replace(/[-:T.Z]/g, '').slice(0, 14);\n  const random = Math.random().toString(16).substring(2, 10);\n  return `${worktreeName}-${timestamp}-${random}`;\n}\n\n/**\n * Get current git branch\n */\nfunction getCurrentBranch(projectDir: string): string {\n  try {\n    return execSync('git branch --show-current', {\n      cwd: projectDir,\n      encoding: 'utf-8',\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Detect capabilities based on directory structure\n */\nfunction detectCapabilities(projectDir: string): string[] {\n  const caps: string[] = [];\n\n  // Check for backend files\n  if (existsSync(`${projectDir}/backend`) || existsSync(`${projectDir}/src/backend`)) {\n    caps.push('backend');\n  }\n\n  // Check for frontend files\n  if (existsSync(`${projectDir}/frontend`) || existsSync(`${projectDir}/src/frontend`) || existsSync(`${projectDir}/package.json`)) {\n    caps.push('frontend');\n  }\n\n  // Check for test files\n  if (existsSync(`${projectDir}/tests`) || existsSync(`${projectDir}/__tests__`)) {\n    caps.push('testing');\n  }\n\n  // Check for infrastructure files\n  if (existsSync(`${projectDir}/infrastructure`) || existsSync(`${projectDir}/docker-compose.yml`) || existsSync(`${projectDir}/Dockerfile`)) {\n    caps.push('devops');\n  }\n\n  return caps;\n}\n\n/**\n * Create instance identity file\n */\nfunction createInstanceIdentity(projectDir: string, instanceId: string): InstanceIdentity {\n  const branch = getCurrentBranch(projectDir);\n  const capabilities = detectCapabilities(projectDir);\n  const now = new Date().toISOString();\n\n  const identity: InstanceIdentity = {\n    instance_id: instanceId,\n    worktree_name: projectDir.split('/').pop() || 'unknown',\n    worktree_path: projectDir,\n    branch,\n    capabilities,\n    agent_type: null,\n    model: 'claude-opus-4-5-20251101',\n    priority: 1,\n    created_at: now,\n    status: 'active',\n    heartbeat_interval_ms: 5000,\n    last_heartbeat: now,\n  };\n\n  const instanceDir = `${projectDir}/.instance`;\n  mkdirSync(instanceDir, { recursive: true });\n  writeFileSync(`${instanceDir}/id.json`, JSON.stringify(identity, null, 2));\n\n  logHook('multi-instance-init', `Instance identity created: ${instanceId}`);\n\n  return identity;\n}\n\n/**\n * Initialize coordination database\n */\nfunction initDatabase(projectDir: string): boolean {\n  const coordDir = `${projectDir}/.claude/coordination`;\n  const dbPath = `${coordDir}/.claude.db`;\n  const schemaPath = `${coordDir}/schema.sql`;\n\n  if (existsSync(dbPath)) {\n    return true;\n  }\n\n  if (!existsSync(schemaPath)) {\n    logHook('multi-instance-init', `WARNING: Schema file not found at ${schemaPath}`);\n    return false;\n  }\n\n  try {\n    mkdirSync(coordDir, { recursive: true });\n    execSync(`sqlite3 \"${dbPath}\" < \"${schemaPath}\"`, {\n      encoding: 'utf-8',\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    logHook('multi-instance-init', 'Database initialized from schema');\n    return true;\n  } catch (err) {\n    logHook('multi-instance-init', `Failed to initialize database: ${err}`);\n    return false;\n  }\n}\n\n/**\n * Start heartbeat process (note: in TypeScript, we can't easily start background processes)\n * Instead, heartbeat is handled by the instance-heartbeat hook\n */\nfunction startHeartbeat(projectDir: string, instanceId: string): void {\n  // Write PID file to indicate heartbeat should be active\n  const instanceDir = `${projectDir}/.instance`;\n  writeFileSync(`${instanceDir}/heartbeat.pid`, String(process.pid));\n  logHook('multi-instance-init', `Heartbeat marker created for ${instanceId}`);\n}\n\n/**\n * Multi-instance init hook\n */\nexport function multiInstanceInit(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    return outputSilentSuccess();\n  }\n\n  // Check for sqlite3\n  if (!isSqlite3Available()) {\n    logHook('multi-instance-init', 'sqlite3 not available, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('multi-instance-init', 'Skipping multi-instance init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('multi-instance-init', 'Starting multi-instance coordination initialization...');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const instanceDir = `${projectDir}/.instance`;\n  const coordDir = `${projectDir}/.claude/coordination`;\n\n  // Ensure directories exist\n  mkdirSync(`${coordDir}/locks`, { recursive: true });\n  mkdirSync(instanceDir, { recursive: true });\n\n  // Initialize database\n  if (!initDatabase(projectDir)) {\n    logHook('multi-instance-init', 'ERROR: Failed to initialize database');\n    return outputSilentSuccess();\n  }\n\n  // Check if we already have an instance running\n  const idFile = `${instanceDir}/id.json`;\n  const pidFile = `${instanceDir}/heartbeat.pid`;\n\n  if (existsSync(idFile) && existsSync(pidFile)) {\n    try {\n      const existingId = JSON.parse(readFileSync(idFile, 'utf-8'));\n      logHook('multi-instance-init', `Reusing existing instance: ${existingId.instance_id}`);\n      return outputSilentSuccess();\n    } catch {\n      // Fall through to create new instance\n    }\n  }\n\n  // Generate new instance ID\n  const instanceId = generateInstanceId(projectDir);\n\n  // Create identity and register\n  createInstanceIdentity(projectDir, instanceId);\n\n  // Start heartbeat marker\n  startHeartbeat(projectDir, instanceId);\n\n  logHook('multi-instance-init', 'Multi-instance coordination initialized successfully');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Pattern Sync Pull - SessionStart Hook\n * CC 2.1.7 Compliant: silent on success with suppressOutput\n * Pulls global patterns into project on session start\n *\n * Part of Cross-Project Patterns (#48)\n * Optimized with timeout and file size checks to prevent startup hangs\n */\n\nimport { existsSync, readFileSync, writeFileSync, statSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface PatternFile {\n  version?: string;\n  patterns?: unknown[];\n  sync_enabled?: boolean;\n}\n\nconst MAX_FILE_SIZE_BYTES = 1 * 1024 * 1024; // 1MB\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Check if sync is enabled\n */\nfunction isSyncEnabled(projectDir: string): boolean {\n  const configFile = `${projectDir}/.claude/feedback/sync-config.json`;\n\n  if (!existsSync(configFile)) {\n    return true; // Default to enabled\n  }\n\n  try {\n    const config = JSON.parse(readFileSync(configFile, 'utf-8'));\n    return config.sync_enabled !== false;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Check if file size is within limits\n */\nfunction checkFileSize(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return true; // File doesn't exist, that's fine\n  }\n\n  try {\n    const stats = statSync(filePath);\n    if (stats.size > MAX_FILE_SIZE_BYTES) {\n      logHook('pattern-sync-pull', `WARN: Skipping - file too large: ${filePath} (${stats.size} bytes)`);\n      return false;\n    }\n    return true;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Pull global patterns into project\n */\nfunction pullGlobalPatterns(projectDir: string): void {\n  const home = process.env.HOME || process.env.USERPROFILE || '/tmp';\n  const globalPatternsFile = `${home}/.claude/global-patterns.json`;\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n\n  if (!existsSync(globalPatternsFile)) {\n    logHook('pattern-sync-pull', 'No global patterns file found');\n    return;\n  }\n\n  try {\n    const globalPatterns: PatternFile = JSON.parse(readFileSync(globalPatternsFile, 'utf-8'));\n    const globalList = globalPatterns.patterns || [];\n\n    if (globalList.length === 0) {\n      logHook('pattern-sync-pull', 'No global patterns to pull');\n      return;\n    }\n\n    // Load existing project patterns\n    let projectPatterns: PatternFile = { version: '1.0', patterns: [] };\n    if (existsSync(projectPatternsFile)) {\n      try {\n        projectPatterns = JSON.parse(readFileSync(projectPatternsFile, 'utf-8'));\n      } catch {\n        // Use default if parse fails\n      }\n    }\n\n    const projectList = projectPatterns.patterns || [];\n\n    // Merge patterns (avoid duplicates by text)\n    const existingTexts = new Set((projectList as Array<{ text?: string }>).map((p) => p.text));\n    const newPatterns = (globalList as Array<{ text?: string }>).filter((p) => !existingTexts.has(p.text));\n\n    if (newPatterns.length === 0) {\n      logHook('pattern-sync-pull', 'All global patterns already in project');\n      return;\n    }\n\n    // Add new patterns\n    const mergedPatterns = [...projectList, ...newPatterns];\n    projectPatterns.patterns = mergedPatterns;\n\n    // Ensure directory exists\n    mkdirSync(`${projectDir}/.claude/feedback`, { recursive: true });\n\n    // Write updated patterns\n    writeFileSync(projectPatternsFile, JSON.stringify(projectPatterns, null, 2));\n    logHook('pattern-sync-pull', `Pulled ${newPatterns.length} new patterns from global`);\n  } catch (err) {\n    logHook('pattern-sync-pull', `Failed to pull global patterns: ${err}`);\n  }\n}\n\n/**\n * Pattern sync pull hook\n */\nexport function patternSyncPull(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('pattern-sync-pull', 'Skipping pattern sync (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Check if sync is enabled\n  if (!isSyncEnabled(projectDir)) {\n    logHook('pattern-sync-pull', 'Global sync disabled, skipping pull');\n    return outputSilentSuccess();\n  }\n\n  // Check file sizes\n  const home2 = process.env.HOME || process.env.USERPROFILE || '/tmp';\n  const globalPatternsFile = `${home2}/.claude/global-patterns.json`;\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n\n  if (!checkFileSize(globalPatternsFile) || !checkFileSize(projectPatternsFile)) {\n    logHook('pattern-sync-pull', 'Skipping pattern sync due to large files');\n    return outputSilentSuccess();\n  }\n\n  // Pull global patterns\n  logHook('pattern-sync-pull', 'Pulling global patterns...');\n  pullGlobalPatterns(projectDir);\n  logHook('pattern-sync-pull', 'Global patterns pulled successfully');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Pattern Sync Push - SessionEnd Hook\n * CC 2.1.7 Compliant: silent on success with suppressOutput\n * Pushes project patterns to global on session end\n *\n * Part of Cross-Project Patterns (#48)\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface PatternFile {\n  version?: string;\n  patterns?: unknown[];\n  sync_enabled?: boolean;\n  updated?: string;\n}\n\n/**\n * Check if sync is enabled\n */\nfunction isSyncEnabled(projectDir: string): boolean {\n  const configFile = `${projectDir}/.claude/feedback/sync-config.json`;\n\n  if (!existsSync(configFile)) {\n    return true; // Default to enabled\n  }\n\n  try {\n    const config = JSON.parse(readFileSync(configFile, 'utf-8'));\n    return config.sync_enabled !== false;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Push project patterns to global\n */\nfunction pushProjectPatterns(projectDir: string): void {\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n  const home = process.env.HOME || process.env.USERPROFILE || '/tmp';\n  const globalPatternsFile = `${home}/.claude/global-patterns.json`;\n\n  if (!existsSync(projectPatternsFile)) {\n    logHook('pattern-sync-push', 'No project patterns file found');\n    return;\n  }\n\n  try {\n    const projectPatterns: PatternFile = JSON.parse(readFileSync(projectPatternsFile, 'utf-8'));\n    const projectList = projectPatterns.patterns || [];\n\n    if (projectList.length === 0) {\n      logHook('pattern-sync-push', 'No project patterns to push');\n      return;\n    }\n\n    // Load existing global patterns\n    let globalPatterns: PatternFile = { version: '1.0', patterns: [], updated: '' };\n    if (existsSync(globalPatternsFile)) {\n      try {\n        globalPatterns = JSON.parse(readFileSync(globalPatternsFile, 'utf-8'));\n      } catch {\n        // Use default if parse fails\n      }\n    }\n\n    const globalList = globalPatterns.patterns || [];\n\n    // Merge patterns (avoid duplicates by text)\n    const existingTexts = new Set((globalList as Array<{ text?: string }>).map((p) => p.text));\n    const newPatterns = (projectList as Array<{ text?: string }>).filter((p) => !existingTexts.has(p.text));\n\n    if (newPatterns.length === 0) {\n      logHook('pattern-sync-push', 'All project patterns already in global');\n      return;\n    }\n\n    // Add new patterns\n    const mergedPatterns = [...globalList, ...newPatterns];\n    globalPatterns.patterns = mergedPatterns;\n    globalPatterns.updated = new Date().toISOString();\n\n    // Ensure directory exists\n    mkdirSync(`${home}/.claude`, { recursive: true });\n\n    // Write updated patterns\n    writeFileSync(globalPatternsFile, JSON.stringify(globalPatterns, null, 2));\n    logHook('pattern-sync-push', `Pushed ${newPatterns.length} new patterns to global`);\n  } catch (err) {\n    logHook('pattern-sync-push', `Failed to push project patterns: ${err}`);\n  }\n}\n\n/**\n * Pattern sync push hook\n */\nexport function patternSyncPush(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Check if sync is enabled\n  if (!isSyncEnabled(projectDir)) {\n    logHook('pattern-sync-push', 'Global sync disabled, skipping push');\n    return outputSilentSuccess();\n  }\n\n  // Push project patterns to global\n  logHook('pattern-sync-push', 'Pushing project patterns to global...');\n  pushProjectPatterns(projectDir);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Cleanup - Cleans up temporary files at session end\n * Hook: SessionEnd\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync, readdirSync, unlinkSync, copyFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionMetrics {\n  tools?: Record<string, number>;\n}\n\n/**\n * Get total tool invocations from metrics\n */\nfunction getTotalTools(metricsFile: string): number {\n  if (!existsSync(metricsFile)) {\n    return 0;\n  }\n\n  try {\n    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));\n    const tools = metrics.tools || {};\n    return Object.values(tools).reduce((sum, count) => sum + count, 0);\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Archive session metrics if significant\n */\nfunction archiveMetrics(metricsFile: string, archiveDir: string): void {\n  if (!existsSync(metricsFile)) {\n    return;\n  }\n\n  const totalTools = getTotalTools(metricsFile);\n\n  // Only archive if there were more than 5 tool calls\n  if (totalTools <= 5) {\n    logHook('session-cleanup', `Session had only ${totalTools} tool calls, not archiving`);\n    return;\n  }\n\n  try {\n    mkdirSync(archiveDir, { recursive: true });\n\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const archiveName = `session-${timestamp}.json`;\n    const archivePath = `${archiveDir}/${archiveName}`;\n\n    copyFileSync(metricsFile, archivePath);\n    logHook('session-cleanup', `Archived session metrics to ${archiveName}`);\n  } catch (err) {\n    logHook('session-cleanup', `Failed to archive metrics: ${err}`);\n  }\n}\n\n/**\n * Clean up old session archives (keep last 20)\n */\nfunction cleanupOldArchives(archiveDir: string, keepCount: number = 20): void {\n  if (!existsSync(archiveDir)) {\n    return;\n  }\n\n  try {\n    const files = readdirSync(archiveDir)\n      .filter((f) => f.startsWith('session-') && f.endsWith('.json'))\n      .sort()\n      .reverse(); // Most recent first\n\n    if (files.length <= keepCount) {\n      return;\n    }\n\n    const toDelete = files.slice(keepCount);\n    for (const file of toDelete) {\n      try {\n        unlinkSync(`${archiveDir}/${file}`);\n        logHook('session-cleanup', `Deleted old archive: ${file}`);\n      } catch {\n        // Ignore deletion errors\n      }\n    }\n  } catch (err) {\n    logHook('session-cleanup', `Failed to cleanup old archives: ${err}`);\n  }\n}\n\n/**\n * Clean up old rotated log files (keep last 5)\n */\nfunction cleanupRotatedLogs(logDir: string): void {\n  if (!existsSync(logDir)) {\n    return;\n  }\n\n  const patterns = ['hooks.log.old*', 'audit.log.old*'];\n\n  for (const pattern of patterns) {\n    try {\n      const prefix = pattern.replace('*', '');\n      const files = readdirSync(logDir)\n        .filter((f) => f.startsWith(prefix))\n        .sort()\n        .reverse(); // Most recent first\n\n      if (files.length <= 5) {\n        continue;\n      }\n\n      const toDelete = files.slice(5);\n      for (const file of toDelete) {\n        try {\n          unlinkSync(`${logDir}/${file}`);\n        } catch {\n          // Ignore deletion errors\n        }\n      }\n    } catch {\n      // Ignore scan errors\n    }\n  }\n}\n\n/**\n * Session cleanup hook\n */\nexport function sessionCleanup(input: HookInput): HookResult {\n  logHook('session-cleanup', 'Session cleanup starting');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const metricsFile = '/tmp/claude-session-metrics.json';\n  const archiveDir = `${projectDir}/.claude/logs/sessions`;\n  const logDir = `${projectDir}/.claude/logs`;\n\n  // Archive metrics if significant\n  archiveMetrics(metricsFile, archiveDir);\n\n  // Clean up old session archives (keep last 20)\n  cleanupOldArchives(archiveDir, 20);\n\n  // Clean up old rotated log files (keep last 5)\n  cleanupRotatedLogs(logDir);\n\n  logHook('session-cleanup', 'Session cleanup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Context Loader - Loads session context at session start\n * Hook: SessionStart\n * CC 2.1.7 Compliant - Context Protocol 2.0\n * Supports agent_type for context-aware initialization\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Validate JSON file\n */\nfunction isValidJsonFile(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return false;\n  }\n\n  try {\n    JSON.parse(readFileSync(filePath, 'utf-8'));\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Session context loader hook\n */\nexport function sessionContextLoader(input: HookInput): HookResult {\n  logHook('session-context-loader', 'Session starting - loading context (Protocol 2.0)');\n\n  const projectDir = input.project_dir || getProjectDir();\n  let contextLoaded = 0;\n\n  // Extract agent_type from environment (set by startup-dispatcher)\n  const agentType = process.env.AGENT_TYPE || '';\n\n  // Context Protocol 2.0 paths\n  const sessionState = `${projectDir}/.claude/context/session/state.json`;\n  const identityFile = `${projectDir}/.claude/context/identity.json`;\n  const knowledgeIndex = `${projectDir}/.claude/context/knowledge/index.json`;\n\n  // Load session state\n  if (isValidJsonFile(sessionState)) {\n    logHook('session-context-loader', 'Session state loaded');\n    contextLoaded++;\n  }\n\n  // Load identity\n  if (isValidJsonFile(identityFile)) {\n    logHook('session-context-loader', 'Identity loaded');\n    contextLoaded++;\n  }\n\n  // Check knowledge index\n  if (isValidJsonFile(knowledgeIndex)) {\n    logHook('session-context-loader', 'Knowledge index available');\n    contextLoaded++;\n  }\n\n  // Load current status docs if they exist\n  const statusFile = `${projectDir}/docs/CURRENT_STATUS.md`;\n  if (existsSync(statusFile)) {\n    logHook('session-context-loader', 'Current status document exists');\n  }\n\n  // Agent-type aware context loading (CC 2.1.6 feature)\n  if (agentType) {\n    logHook('session-context-loader', `Agent-type aware initialization: ${agentType}`);\n\n    // Check if there's agent-specific configuration\n    const agentConfig = `${projectDir}/.claude/agents/${agentType}.md`;\n    if (existsSync(agentConfig)) {\n      logHook('session-context-loader', `Agent configuration found: ${agentConfig}`);\n      contextLoaded++;\n    }\n  }\n\n  // CC 2.1.20: Load compaction manifest from previous session\n  const compactionManifest = `${projectDir}/.claude/context/session/compaction-manifest.json`;\n  if (isValidJsonFile(compactionManifest)) {\n    try {\n      const manifest = JSON.parse(readFileSync(compactionManifest, 'utf-8'));\n      logHook('session-context-loader', `Compaction manifest loaded: session=${manifest.sessionId}, decisions=${(manifest.keyDecisions || []).length}, files=${(manifest.filesTouched || []).length}`);\n      process.env.ORCHESTKIT_LAST_SESSION = manifest.sessionId || '';\n      process.env.ORCHESTKIT_LAST_DECISIONS = JSON.stringify(manifest.keyDecisions || []);\n      contextLoaded++;\n    } catch (error) {\n      logHook('session-context-loader', `Error loading compaction manifest: ${error}`);\n    }\n  }\n\n  // Log summary\n  if (contextLoaded > 0) {\n    if (agentType) {\n      logHook('session-context-loader', `Session context loaded (Protocol 2.0) - Agent: ${agentType}`);\n    } else {\n      logHook('session-context-loader', 'Session context loaded (Protocol 2.0)');\n    }\n  }\n\n  // Note: SessionStart hooks don't support hookSpecificOutput.additionalContext\n  return outputSilentSuccess();\n}\n", "/**\n * Session Environment Setup - Initializes session environment\n * Hook: SessionStart\n * CC 2.1.6 Compliant - Supports agent_type field\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionState {\n  agent_type?: string;\n  session_id?: string;\n  last_activity?: string;\n  [key: string]: unknown;\n}\n\ninterface SessionMetrics {\n  session_id: string;\n  started_at: string;\n  agent_type: string;\n  tools: Record<string, number>;\n  errors: number;\n  warnings: number;\n}\n\n/**\n * Get current git branch\n */\nfunction getCurrentBranch(projectDir: string): string {\n  try {\n    return execSync('git branch --show-current', {\n      cwd: projectDir,\n      encoding: 'utf-8',\n      timeout: 500,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Session environment setup hook\n */\nexport function sessionEnvSetup(input: HookInput): HookResult {\n  logHook('session-env-setup', 'Setting up session environment');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionId = input.session_id || getSessionId();\n  const metricsFile = '/tmp/claude-session-metrics.json';\n\n  // Create logs directory if needed\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n  } catch {\n    // Ignore mkdir errors\n  }\n\n  // Extract agent_type from environment or hook input\n  let agentType = process.env.AGENT_TYPE || '';\n  if (!agentType && input.agent_type) {\n    agentType = input.agent_type;\n  }\n\n  // Initialize session metrics\n  const metrics: SessionMetrics = {\n    session_id: sessionId,\n    started_at: new Date().toISOString(),\n    agent_type: agentType,\n    tools: {},\n    errors: 0,\n    warnings: 0,\n  };\n\n  try {\n    writeFileSync(metricsFile, JSON.stringify(metrics, null, 2));\n    logHook('session-env-setup', 'Initialized session metrics');\n  } catch (err) {\n    logHook('session-env-setup', `Failed to initialize metrics: ${err}`);\n  }\n\n  // Update session state with agent_type (CC 2.1.6 feature)\n  const sessionState = `${projectDir}/.claude/context/session/state.json`;\n  if (existsSync(sessionState) && agentType) {\n    try {\n      const state: SessionState = JSON.parse(readFileSync(sessionState, 'utf-8'));\n      state.agent_type = agentType;\n      state.session_id = sessionId;\n      state.last_activity = new Date().toISOString();\n      writeFileSync(sessionState, JSON.stringify(state, null, 2));\n      logHook('session-env-setup', `Updated session state with agent_type: ${agentType}`);\n    } catch (err) {\n      logHook('session-env-setup', `Failed to update session state: ${err}`);\n    }\n  }\n\n  // Check git status with timeout\n  const branch = getCurrentBranch(projectDir);\n  if (branch) {\n    logHook('session-env-setup', `Git branch: ${branch}`);\n  }\n\n  // Log agent type if present\n  if (agentType) {\n    logHook('session-env-setup', `Agent type: ${agentType}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Metrics Summary - Shows summary at session end\n * Hook: SessionEnd\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionMetrics {\n  tools?: Record<string, number>;\n  errors?: number;\n}\n\n/**\n * Session metrics summary hook\n */\nexport function sessionMetricsSummary(input: HookInput): HookResult {\n  logHook('session-metrics-summary', 'Session ending - generating summary');\n\n  const metricsFile = '/tmp/claude-session-metrics.json';\n\n  if (!existsSync(metricsFile)) {\n    logHook('session-metrics-summary', 'No metrics file found');\n    return outputSilentSuccess();\n  }\n\n  try {\n    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));\n    const tools = metrics.tools || {};\n    const errors = metrics.errors || 0;\n\n    // Calculate total tool calls\n    const totalTools = Object.values(tools).reduce((sum, count) => sum + count, 0);\n\n    // Get top 3 tools\n    const topTools = Object.entries(tools)\n      .sort(([, a], [, b]) => b - a)\n      .slice(0, 3)\n      .map(([tool, count]) => `${tool}: ${count}`)\n      .join(', ');\n\n    logHook('session-metrics-summary', `Session stats: ${totalTools} tool calls, ${errors} errors`);\n\n    if (totalTools > 0) {\n      // Note: We return silently since SessionEnd hooks typically don't need system messages\n      // The logging is sufficient for audit purposes\n      logHook('session-metrics-summary', `Top tools: ${topTools}`);\n    }\n  } catch (err) {\n    logHook('session-metrics-summary', `Failed to read metrics: ${err}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Dependency Version Check - Check for outdated dependencies at session start\n * Hook: SessionStart (#136)\n * CC 2.1.7 Compliant\n * Optimized with timeout, caching, and fast-exit to prevent startup hangs\n *\n * Parses:\n * - package.json (Node.js)\n * - requirements.txt, pyproject.toml (Python)\n * - go.mod (Go)\n *\n * Warns about:\n * - Known security vulnerabilities (CVE database)\n * - Severely outdated packages\n * - Deprecated packages\n *\n * Uses additionalContext to inject warnings into session context\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\ninterface KnownVuln {\n  package: string;\n  pattern: string;\n  severity: string;\n  cve: string;\n  description: string;\n}\n\ninterface DependencyCache {\n  warnings: string;\n  timestamp: number;\n}\n\ninterface PackageJson {\n  dependencies?: Record<string, string>;\n  devDependencies?: Record<string, string>;\n}\n\n// Known vulnerabilities database (static for offline operation)\nconst KNOWN_VULNS: KnownVuln[] = [\n  { package: 'lodash', pattern: '<4.17.21', severity: 'high', cve: 'CVE-2021-23337', description: 'Prototype pollution' },\n  { package: 'minimist', pattern: '<1.2.6', severity: 'critical', cve: 'CVE-2021-44906', description: 'Prototype pollution' },\n  { package: 'node-fetch', pattern: '<2.6.7', severity: 'high', cve: 'CVE-2022-0235', description: 'Information exposure' },\n  { package: 'axios', pattern: '<0.21.2', severity: 'high', cve: 'CVE-2021-3749', description: 'ReDoS vulnerability' },\n  { package: 'jsonwebtoken', pattern: '<9.0.0', severity: 'critical', cve: 'CVE-2022-23529', description: 'Insecure token verification' },\n  { package: 'express', pattern: '<4.17.3', severity: 'medium', cve: 'CVE-2022-24999', description: 'Open redirect' },\n  { package: 'tar', pattern: '<6.1.11', severity: 'critical', cve: 'CVE-2021-37701', description: 'Arbitrary file overwrite' },\n  { package: 'path-parse', pattern: '<1.0.7', severity: 'medium', cve: 'CVE-2021-23343', description: 'ReDoS vulnerability' },\n  { package: 'django', pattern: '<3.2.14', severity: 'high', cve: 'CVE-2022-34265', description: 'SQL injection' },\n  { package: 'flask', pattern: '<2.0.2', severity: 'medium', cve: 'CVE-2021-28091', description: 'Path traversal' },\n  { package: 'requests', pattern: '<2.28.0', severity: 'medium', cve: 'CVE-2023-32681', description: 'Information disclosure' },\n  { package: 'urllib3', pattern: '<1.26.5', severity: 'high', cve: 'CVE-2021-33503', description: 'ReDoS vulnerability' },\n  { package: 'pillow', pattern: '<9.0.0', severity: 'high', cve: 'CVE-2022-22817', description: 'Buffer overflow' },\n  { package: 'pyyaml', pattern: '<5.4', severity: 'critical', cve: 'CVE-2020-14343', description: 'Arbitrary code execution' },\n  { package: 'jinja2', pattern: '<3.0.3', severity: 'medium', cve: 'CVE-2020-28493', description: 'XSS vulnerability' },\n  { package: 'sqlalchemy', pattern: '<1.4.46', severity: 'medium', cve: 'CVE-2023-30533', description: 'SQL injection' },\n];\n\nconst CACHE_TTL_HOURS = 24;\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Compare semantic versions (simplified)\n */\nfunction versionLessThan(current: string, target: string): boolean {\n  const currentParts = current.split('.').map((p) => parseInt(p, 10) || 0);\n  const targetParts = target.split('.').map((p) => parseInt(p, 10) || 0);\n\n  for (let i = 0; i < Math.max(currentParts.length, targetParts.length); i++) {\n    const c = currentParts[i] || 0;\n    const t = targetParts[i] || 0;\n    if (c < t) return true;\n    if (c > t) return false;\n  }\n  return false;\n}\n\n/**\n * Check if version matches vulnerability pattern\n */\nfunction versionMatchesVuln(currentVersion: string, vulnPattern: string): boolean {\n  const operator = vulnPattern.charAt(0);\n  const vulnVersion = vulnPattern.substring(1);\n\n  if (operator === '<') {\n    return versionLessThan(currentVersion, vulnVersion);\n  } else if (operator === '=') {\n    return currentVersion === vulnVersion;\n  }\n\n  return false;\n}\n\n/**\n * Clean version string (remove ^, ~, etc.)\n */\nfunction cleanVersion(version: string): string {\n  return version\n    .replace(/^[^~>=<]/, '')\n    .replace(/,.*$/, '')\n    .trim();\n}\n\n/**\n * Check a package against known vulnerabilities\n */\nfunction checkPackageVulnerability(packageName: string, version: string): KnownVuln | null {\n  const cleanedVersion = cleanVersion(version);\n  const pkgLower = packageName.toLowerCase();\n\n  for (const vuln of KNOWN_VULNS) {\n    if (pkgLower === vuln.package) {\n      if (versionMatchesVuln(cleanedVersion, vuln.pattern)) {\n        return vuln;\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Check if cache is valid\n */\nfunction getCachedWarnings(cacheFile: string): string | null {\n  if (!existsSync(cacheFile)) {\n    return null;\n  }\n\n  try {\n    const cache: DependencyCache = JSON.parse(readFileSync(cacheFile, 'utf-8'));\n    const cacheAge = (Date.now() - cache.timestamp) / (1000 * 60 * 60);\n\n    if (cacheAge < CACHE_TTL_HOURS) {\n      return cache.warnings;\n    }\n  } catch {\n    // Cache invalid\n  }\n\n  return null;\n}\n\n/**\n * Save warnings to cache\n */\nfunction saveCache(cacheFile: string, warnings: string): void {\n  try {\n    mkdirSync(cacheFile.replace(/\\/[^/]+$/, ''), { recursive: true });\n\n    const cache: DependencyCache = {\n      warnings,\n      timestamp: Date.now(),\n    };\n\n    writeFileSync(cacheFile, JSON.stringify(cache, null, 2));\n  } catch {\n    // Ignore cache write errors\n  }\n}\n\n/**\n * Parse package.json for vulnerabilities\n */\nfunction parsePackageJson(filePath: string): { criticalCount: number; highCount: number; warnings: string } {\n  let criticalCount = 0;\n  let highCount = 0;\n  let warnings = '';\n\n  if (!existsSync(filePath)) {\n    return { criticalCount, highCount, warnings };\n  }\n\n  try {\n    const pkg: PackageJson = JSON.parse(readFileSync(filePath, 'utf-8'));\n    const allDeps = { ...pkg.dependencies, ...pkg.devDependencies };\n\n    for (const [packageName, version] of Object.entries(allDeps)) {\n      const vuln = checkPackageVulnerability(packageName, version);\n      if (vuln) {\n        if (vuln.severity === 'critical') criticalCount++;\n        if (vuln.severity === 'high') highCount++;\n        warnings += `\\n- ${packageName}@${version}: ${vuln.description} (${vuln.cve}, ${vuln.severity}) - upgrade to ${vuln.pattern}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return { criticalCount, highCount, warnings };\n}\n\n/**\n * Parse requirements.txt for vulnerabilities\n */\nfunction parseRequirementsTxt(filePath: string): { criticalCount: number; highCount: number; warnings: string } {\n  let criticalCount = 0;\n  let highCount = 0;\n  let warnings = '';\n\n  if (!existsSync(filePath)) {\n    return { criticalCount, highCount, warnings };\n  }\n\n  try {\n    const content = readFileSync(filePath, 'utf-8');\n    const lines = content.split('\\n');\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (!trimmed || trimmed.startsWith('#')) continue;\n\n      // Parse package==version or package>=version\n      const match = trimmed.match(/^([a-zA-Z0-9_-]+)(?:==|>=|~=|!=|<|>)\\s*([0-9.]+)/);\n      if (!match) continue;\n\n      const [, packageName, version] = match;\n      const vuln = checkPackageVulnerability(packageName, version);\n      if (vuln) {\n        if (vuln.severity === 'critical') criticalCount++;\n        if (vuln.severity === 'high') highCount++;\n        warnings += `\\n- ${packageName}==${version}: ${vuln.description} (${vuln.cve}, ${vuln.severity}) - upgrade to ${vuln.pattern}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return { criticalCount, highCount, warnings };\n}\n\n/**\n * Dependency version check hook\n */\nexport function dependencyVersionCheck(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('dependency-version-check', 'Skipping dependency check (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('dependency-version-check', 'Starting dependency version check');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const cacheFile = `${projectDir}/.claude/feedback/dependency-check-cache.json`;\n\n  // Fast exit: Check if any package files exist\n  const hasPackageJson = existsSync(`${projectDir}/package.json`);\n  const hasRequirementsTxt = existsSync(`${projectDir}/requirements.txt`);\n  const hasPyprojectToml = existsSync(`${projectDir}/pyproject.toml`);\n  const hasGoMod = existsSync(`${projectDir}/go.mod`);\n\n  if (!hasPackageJson && !hasRequirementsTxt && !hasPyprojectToml && !hasGoMod) {\n    logHook('dependency-version-check', 'No package files found, skipping check');\n    saveCache(cacheFile, 'none');\n    return outputSilentSuccess();\n  }\n\n  // Check cache first\n  const cached = getCachedWarnings(cacheFile);\n  if (cached !== null) {\n    logHook('dependency-version-check', 'Using cached dependency warnings');\n    if (cached !== 'none') {\n      return outputWithContext(`DEPENDENCY SECURITY CHECK (cached): ${cached}`);\n    }\n    return outputSilentSuccess();\n  }\n\n  let totalCritical = 0;\n  let totalHigh = 0;\n  let allWarnings = '';\n\n  // Check package.json\n  if (hasPackageJson) {\n    const result = parsePackageJson(`${projectDir}/package.json`);\n    totalCritical += result.criticalCount;\n    totalHigh += result.highCount;\n    if (result.warnings) {\n      allWarnings += `\\n\\nNode.js (package.json):${result.warnings}`;\n    }\n  }\n\n  // Check requirements.txt\n  if (hasRequirementsTxt) {\n    const result = parseRequirementsTxt(`${projectDir}/requirements.txt`);\n    totalCritical += result.criticalCount;\n    totalHigh += result.highCount;\n    if (result.warnings) {\n      allWarnings += `\\n\\nPython (requirements.txt):${result.warnings}`;\n    }\n  }\n\n  // Generate output\n  if (allWarnings) {\n    const summary = `Found ${totalCritical} critical and ${totalHigh} high severity vulnerabilities`;\n    const fullWarning = `DEPENDENCY SECURITY CHECK: ${summary}${allWarnings}\\n\\nRun 'npm audit' or 'pip-audit' for full details.`;\n\n    saveCache(cacheFile, fullWarning);\n    logHook('dependency-version-check', summary);\n\n    // Only show warning if there are critical or high severity issues\n    if (totalCritical > 0 || totalHigh > 0) {\n      return outputWithContext(fullWarning);\n    }\n  } else {\n    saveCache(cacheFile, 'none');\n    logHook('dependency-version-check', 'No known vulnerabilities found');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * OrchestKit Hooks - TypeScript/ESM Entry Point\n *\n * This file exports all hooks and utilities for the bundle.\n * The hook registry maps hook names to their implementations.\n */\n\n// Re-export types\nexport * from './types.js';\n\n// Re-export utilities\nexport * from './lib/common.js';\nexport * from './lib/git.js';\nexport * from './lib/guards.js';\n\n// Re-export orchestration modules (Issue #197)\nexport * from './lib/orchestration-types.js';\nexport * from './lib/intent-classifier.js';\nexport * from './lib/orchestration-state.js';\nexport * from './lib/task-integration.js';\nexport * from './lib/retry-manager.js';\nexport * from './lib/calibration-engine.js';\nexport * from './lib/multi-agent-coordinator.js';\n\n// Re-export decision history module (Issues #203, #206, #207, #208)\nexport * from './lib/decision-history.js';\n\n// Import hook implementations\n// Permission hooks\nimport { autoApproveSafeBash } from './permission/auto-approve-safe-bash.js';\nimport { autoApproveProjectWrites } from './permission/auto-approve-project-writes.js';\nimport { learningTracker } from './permission/learning-tracker.js';\n\n// PreTool/Bash hooks\nimport { dangerousCommandBlocker } from './pretool/bash/dangerous-command-blocker.js';\nimport { gitValidator } from './pretool/bash/git-validator.js';\nimport { compoundCommandValidator } from './pretool/bash/compound-command-validator.js';\nimport { defaultTimeoutSetter } from './pretool/bash/default-timeout-setter.js';\nimport { errorPatternWarner } from './pretool/bash/error-pattern-warner.js';\nimport { conflictPredictor } from './pretool/bash/conflict-predictor.js';\nimport { affectedTestsFinder } from './pretool/bash/affected-tests-finder.js';\nimport { ciSimulation } from './pretool/bash/ci-simulation.js';\nimport { preCommitSimulation } from './pretool/bash/pre-commit-simulation.js';\nimport { prMergeGate } from './pretool/bash/pr-merge-gate.js';\nimport { changelogGenerator } from './pretool/bash/changelog-generator.js';\nimport { versionSync } from './pretool/bash/version-sync.js';\nimport { licenseCompliance } from './pretool/bash/license-compliance.js';\nimport { ghIssueCreationGuide } from './pretool/bash/gh-issue-creation-guide.js';\nimport { issueDocsRequirement } from './pretool/bash/issue-docs-requirement.js';\nimport { multiInstanceQualityGate } from './pretool/bash/multi-instance-quality-gate.js';\nimport { agentBrowserSafety } from './pretool/bash/agent-browser-safety.js';\n\n// PreTool/Write-Edit hooks\nimport { fileGuard } from './pretool/write-edit/file-guard.js';\nimport { fileLockCheck } from './pretool/write-edit/file-lock-check.js';\nimport { multiInstanceLock } from './pretool/write-edit/multi-instance-lock.js';\n\n// PreTool/Write hooks\nimport { architectureChangeDetector } from './pretool/Write/architecture-change-detector.js';\nimport { codeQualityGate } from './pretool/Write/code-quality-gate.js';\nimport { docstringEnforcer } from './pretool/Write/docstring-enforcer.js';\nimport { securityPatternValidator } from './pretool/Write/security-pattern-validator.js';\n\n// PreTool/MCP hooks\nimport { context7Tracker } from './pretool/mcp/context7-tracker.js';\nimport { memoryFabricInit } from './pretool/mcp/memory-fabric-init.js';\nimport { memoryValidator } from './pretool/mcp/memory-validator.js';\nimport { sequentialThinkingAuto } from './pretool/mcp/sequential-thinking-auto.js';\n\n// PreTool/InputMod hooks\nimport { writeHeaders } from './pretool/input-mod/write-headers.js';\n\n// PreTool/Skill hooks\nimport { skillTracker } from './pretool/skill/skill-tracker.js';\n\n// Skill hooks (24)\nimport { backendFileNaming } from './skill/backend-file-naming.js';\nimport { decisionProcessor } from './skill/decision-processor.js';\nimport { backendLayerValidator } from './skill/backend-layer-validator.js';\nimport { coverageCheck } from './skill/coverage-check.js';\nimport { coverageThresholdGate } from './skill/coverage-threshold-gate.js';\nimport { crossInstanceTestValidator } from './skill/cross-instance-test-validator.js';\nimport { diPatternEnforcer } from './skill/di-pattern-enforcer.js';\nimport { duplicateCodeDetector } from './skill/duplicate-code-detector.js';\nimport { evalMetricsCollector } from './skill/eval-metrics-collector.js';\nimport { evidenceCollector } from './skill/evidence-collector.js';\nimport { importDirectionEnforcer } from './skill/import-direction-enforcer.js';\nimport { mergeConflictPredictor } from './skill/merge-conflict-predictor.js';\nimport { mergeReadinessChecker } from './skill/merge-readiness-checker.js';\nimport { migrationValidator } from './skill/migration-validator.js';\nimport { patternConsistencyEnforcer } from './skill/pattern-consistency-enforcer.js';\nimport { redactSecrets } from './skill/redact-secrets.js';\nimport { reviewSummaryGenerator } from './skill/review-summary-generator.js';\nimport { securitySummary } from './skill/security-summary.js';\nimport { structureLocationValidator } from './skill/structure-location-validator.js';\nimport { testLocationValidator } from './skill/test-location-validator.js';\nimport { testPatternValidator } from './skill/test-pattern-validator.js';\nimport { testRunner } from './skill/test-runner.js';\n\n// Prompt hooks (UserPromptSubmit)\nimport { antipatternDetector } from './prompt/antipattern-detector.js';\nimport { antipatternWarning } from './prompt/antipattern-warning.js';\nimport { contextInjector } from './prompt/context-injector.js';\nimport { contextPruningAdvisor } from './prompt/context-pruning-advisor.js';\nimport { memoryContext } from './prompt/memory-context.js';\nimport { satisfactionDetector } from './prompt/satisfaction-detector.js';\nimport { skillAutoSuggest } from './prompt/skill-auto-suggest.js';\nimport { todoEnforcer } from './prompt/todo-enforcer.js';\nimport { agentAutoSuggest } from './prompt/agent-auto-suggest.js';\n\n// Prompt hooks - Orchestration (Issue #197)\nimport { agentOrchestrator } from './prompt/agent-orchestrator.js';\nimport { skillInjector } from './prompt/skill-injector.js';\nimport { pipelineDetector } from './prompt/pipeline-detector.js';\n\n// SubagentStart hooks (6)\nimport { graphMemoryInject } from './subagent-start/graph-memory-inject.js';\nimport { mem0MemoryInject } from './subagent-start/mem0-memory-inject.js';\nimport { contextGate } from './subagent-start/context-gate.js';\nimport { subagentContextStager } from './subagent-start/subagent-context-stager.js';\nimport { subagentValidator } from './subagent-start/subagent-validator.js';\nimport { taskLinker } from './subagent-start/task-linker.js';\n\n// SubagentStop hooks (11)\nimport { agentMemoryStore } from './subagent-stop/agent-memory-store.js';\nimport { autoSpawnQuality } from './subagent-stop/auto-spawn-quality.js';\nimport { contextPublisher } from './subagent-stop/context-publisher.js';\nimport { feedbackLoop } from './subagent-stop/feedback-loop.js';\nimport { handoffPreparer } from './subagent-stop/handoff-preparer.js';\nimport { multiClaudeVerifier } from './subagent-stop/multi-claude-verifier.js';\nimport { outputValidator } from './subagent-stop/output-validator.js';\nimport { subagentQualityGate } from './subagent-stop/subagent-quality-gate.js';\nimport { taskCompleter } from './subagent-stop/task-completer.js';\nimport { retryHandler } from './subagent-stop/retry-handler.js';\n\n// Notification hooks (2)\nimport { desktopNotification } from './notification/desktop.js';\nimport { soundNotification } from './notification/sound.js';\n\n// Stop hooks (12)\nimport { autoRememberContinuity } from './stop/auto-remember-continuity.js';\nimport { autoSaveContext } from './stop/auto-save-context.js';\nimport { cleanupInstance } from './stop/cleanup-instance.js';\nimport { contextCompressor } from './stop/context-compressor.js';\nimport { fullTestSuite } from './stop/full-test-suite.js';\nimport { issueWorkSummary } from './stop/issue-work-summary.js';\nimport { mem0PreCompactionSync } from './stop/mem0-pre-compaction-sync.js';\nimport { multiInstanceCleanup } from './stop/multi-instance-cleanup.js';\nimport { securityScanAggregator } from './stop/security-scan-aggregator.js';\nimport { sessionPatterns } from './stop/session-patterns.js';\nimport { taskCompletionCheck } from './stop/task-completion-check.js';\nimport { calibrationPersist } from './stop/calibration-persist.js';\n\n// Setup hooks (7)\nimport { firstRunSetup } from './setup/first-run-setup.js';\nimport { mem0AnalyticsDashboard } from './setup/mem0-analytics-dashboard.js';\nimport { mem0BackupSetup } from './setup/mem0-backup-setup.js';\nimport { mem0Cleanup } from './setup/mem0-cleanup.js';\nimport { setupCheck } from './setup/setup-check.js';\nimport { setupMaintenance } from './setup/setup-maintenance.js';\nimport { setupRepair } from './setup/setup-repair.js';\n\n// Agent hooks (6)\nimport { blockWrites } from './agent/block-writes.js';\nimport { ciSafetyCheck } from './agent/ci-safety-check.js';\nimport { deploymentSafetyCheck } from './agent/deployment-safety-check.js';\nimport { migrationSafetyCheck } from './agent/migration-safety-check.js';\nimport { securityCommandAudit } from './agent/security-command-audit.js';\n\n// PostTool hooks - Root (13)\nimport { auditLogger } from './posttool/audit-logger.js';\nimport { unifiedErrorHandler } from './posttool/unified-error-handler.js';\nimport { autoLint } from './posttool/auto-lint.js';\nimport { contextBudgetMonitor } from './posttool/context-budget-monitor.js';\nimport { coordinationHeartbeat } from './posttool/coordination-heartbeat.js';\nimport { mem0WebhookHandler } from './posttool/mem0-webhook-handler.js';\nimport { memoryBridge } from './posttool/memory-bridge.js';\nimport { realtimeSync } from './posttool/realtime-sync.js';\nimport { sessionMetrics } from './posttool/session-metrics.js';\nimport { skillEditTracker } from './posttool/skill-edit-tracker.js';\nimport { calibrationTracker } from './posttool/calibration-tracker.js';\n\n// PostTool/Write hooks (5)\nimport { codeStyleLearner } from './posttool/write/code-style-learner.js';\nimport { coveragePredictor } from './posttool/write/coverage-predictor.js';\nimport { namingConventionLearner } from './posttool/write/naming-convention-learner.js';\nimport { readmeSync } from './posttool/write/readme-sync.js';\nimport { releaseLockOnCommit } from './posttool/write/release-lock-on-commit.js';\n\n// PostTool/Bash hooks (3)\nimport { issueProgressCommenter } from './posttool/bash/issue-progress-commenter.js';\nimport { issueSubtaskUpdater } from './posttool/bash/issue-subtask-updater.js';\nimport { patternExtractor } from './posttool/bash/pattern-extractor.js';\n\n// PostTool/Skill hooks (1)\nimport { skillUsageOptimizer } from './posttool/skill/skill-usage-optimizer.js';\n\n// PostTool/Write-Edit hooks (1)\nimport { fileLockRelease } from './posttool/write-edit/file-lock-release.js';\n\n// Lifecycle hooks (17) - SessionStart/SessionEnd\nimport { analyticsConsentCheck } from './lifecycle/analytics-consent-check.js';\nimport { coordinationCleanup } from './lifecycle/coordination-cleanup.js';\nimport { coordinationInit } from './lifecycle/coordination-init.js';\nimport { instanceHeartbeat } from './lifecycle/instance-heartbeat.js';\nimport { mem0AnalyticsTracker } from './lifecycle/mem0-analytics-tracker.js';\nimport { mem0ContextRetrieval } from './lifecycle/mem0-context-retrieval.js';\nimport { mem0WebhookSetup } from './lifecycle/mem0-webhook-setup.js';\nimport { multiInstanceInit } from './lifecycle/multi-instance-init.js';\nimport { patternSyncPull } from './lifecycle/pattern-sync-pull.js';\nimport { patternSyncPush } from './lifecycle/pattern-sync-push.js';\nimport { sessionCleanup } from './lifecycle/session-cleanup.js';\nimport { sessionContextLoader } from './lifecycle/session-context-loader.js';\nimport { sessionEnvSetup } from './lifecycle/session-env-setup.js';\nimport { sessionMetricsSummary } from './lifecycle/session-metrics-summary.js';\nimport { dependencyVersionCheck } from './lifecycle/dependency-version-check.js';\n\nimport type { HookFn } from './types.js';\n\n/**\n * Hook registry - maps hook names to implementations\n *\n * Hook names use the format: <category>/<hook-name>\n * e.g., 'permission/auto-approve-readonly', 'pretool/bash/git-branch-protection'\n */\nexport const hooks: Record<string, HookFn> = {\n  // Permission hooks (4)\n  'permission/auto-approve-safe-bash': autoApproveSafeBash,\n  'permission/auto-approve-project-writes': autoApproveProjectWrites,\n  'permission/learning-tracker': learningTracker,\n\n  // PreTool/Bash hooks (17 - consolidated git hooks)\n  'pretool/bash/dangerous-command-blocker': dangerousCommandBlocker,\n  'pretool/bash/git-validator': gitValidator,\n  'pretool/bash/compound-command-validator': compoundCommandValidator,\n  'pretool/bash/default-timeout-setter': defaultTimeoutSetter,\n  'pretool/bash/error-pattern-warner': errorPatternWarner,\n  'pretool/bash/conflict-predictor': conflictPredictor,\n  'pretool/bash/affected-tests-finder': affectedTestsFinder,\n  'pretool/bash/ci-simulation': ciSimulation,\n  'pretool/bash/pre-commit-simulation': preCommitSimulation,\n  'pretool/bash/pr-merge-gate': prMergeGate,\n  'pretool/bash/changelog-generator': changelogGenerator,\n  'pretool/bash/version-sync': versionSync,\n  'pretool/bash/license-compliance': licenseCompliance,\n  'pretool/bash/gh-issue-creation-guide': ghIssueCreationGuide,\n  'pretool/bash/issue-docs-requirement': issueDocsRequirement,\n  'pretool/bash/multi-instance-quality-gate': multiInstanceQualityGate,\n  'pretool/bash/agent-browser-safety': agentBrowserSafety,\n\n  // PreTool/Write-Edit hooks (3)\n  'pretool/write-edit/file-guard': fileGuard,\n  'pretool/write-edit/file-lock-check': fileLockCheck,\n  'pretool/write-edit/multi-instance-lock': multiInstanceLock,\n\n  // PreTool/Write hooks (4)\n  'pretool/Write/architecture-change-detector': architectureChangeDetector,\n  'pretool/Write/code-quality-gate': codeQualityGate,\n  'pretool/Write/docstring-enforcer': docstringEnforcer,\n  'pretool/Write/security-pattern-validator': securityPatternValidator,\n\n  // PreTool/MCP hooks (4)\n  'pretool/mcp/context7-tracker': context7Tracker,\n  'pretool/mcp/memory-fabric-init': memoryFabricInit,\n  'pretool/mcp/memory-validator': memoryValidator,\n  'pretool/mcp/sequential-thinking-auto': sequentialThinkingAuto,\n\n  // PreTool/InputMod hooks (1)\n  'pretool/input-mod/write-headers': writeHeaders,\n\n  // PreTool/Skill hooks (1)\n  'pretool/skill/skill-tracker': skillTracker,\n\n  // Prompt hooks (12) - UserPromptSubmit\n  'prompt/antipattern-detector': antipatternDetector,\n  'prompt/antipattern-warning': antipatternWarning,\n  'prompt/context-injector': contextInjector,\n  'prompt/context-pruning-advisor': contextPruningAdvisor,\n  'prompt/memory-context': memoryContext,\n  'prompt/satisfaction-detector': satisfactionDetector,\n  'prompt/skill-auto-suggest': skillAutoSuggest,\n  'prompt/todo-enforcer': todoEnforcer,\n  'prompt/agent-auto-suggest': agentAutoSuggest,\n  // Orchestration hooks (Issue #197)\n  'prompt/agent-orchestrator': agentOrchestrator,\n  'prompt/skill-injector': skillInjector,\n  'prompt/pipeline-detector': pipelineDetector,\n\n  // SubagentStart hooks (6)\n  'subagent-start/graph-memory-inject': graphMemoryInject,\n  'subagent-start/mem0-memory-inject': mem0MemoryInject,\n  'subagent-start/context-gate': contextGate,\n  'subagent-start/subagent-context-stager': subagentContextStager,\n  'subagent-start/subagent-validator': subagentValidator,\n  'subagent-start/task-linker': taskLinker,\n\n  // SubagentStop hooks (11)\n  'subagent-stop/agent-memory-store': agentMemoryStore,\n  'subagent-stop/auto-spawn-quality': autoSpawnQuality,\n  'subagent-stop/context-publisher': contextPublisher,\n  'subagent-stop/feedback-loop': feedbackLoop,\n  'subagent-stop/handoff-preparer': handoffPreparer,\n  'subagent-stop/multi-claude-verifier': multiClaudeVerifier,\n  'subagent-stop/output-validator': outputValidator,\n  'subagent-stop/subagent-quality-gate': subagentQualityGate,\n  'subagent-stop/task-completer': taskCompleter,\n  'subagent-stop/retry-handler': retryHandler,\n\n  // Notification hooks (2)\n  'notification/desktop': desktopNotification,\n  'notification/sound': soundNotification,\n\n  // Skill hooks (24)\n  'skill/backend-file-naming': backendFileNaming,\n  'skill/decision-processor': decisionProcessor,\n  'skill/backend-layer-validator': backendLayerValidator,\n  'skill/coverage-check': coverageCheck,\n  'skill/coverage-threshold-gate': coverageThresholdGate,\n  'skill/cross-instance-test-validator': crossInstanceTestValidator,\n  'skill/di-pattern-enforcer': diPatternEnforcer,\n  'skill/duplicate-code-detector': duplicateCodeDetector,\n  'skill/eval-metrics-collector': evalMetricsCollector,\n  'skill/evidence-collector': evidenceCollector,\n  'skill/import-direction-enforcer': importDirectionEnforcer,\n  'skill/merge-conflict-predictor': mergeConflictPredictor,\n  'skill/merge-readiness-checker': mergeReadinessChecker,\n  'skill/migration-validator': migrationValidator,\n  'skill/pattern-consistency-enforcer': patternConsistencyEnforcer,\n  'skill/redact-secrets': redactSecrets,\n  'skill/review-summary-generator': reviewSummaryGenerator,\n  'skill/security-summary': securitySummary,\n  'skill/structure-location-validator': structureLocationValidator,\n  'skill/test-location-validator': testLocationValidator,\n  'skill/test-pattern-validator': testPatternValidator,\n  'skill/test-runner': testRunner,\n\n  // Stop hooks (12)\n  'stop/auto-remember-continuity': autoRememberContinuity,\n  'stop/auto-save-context': autoSaveContext,\n  'stop/cleanup-instance': cleanupInstance,\n  'stop/context-compressor': contextCompressor,\n  'stop/full-test-suite': fullTestSuite,\n  'stop/issue-work-summary': issueWorkSummary,\n  'stop/mem0-pre-compaction-sync': mem0PreCompactionSync,\n  'stop/multi-instance-cleanup': multiInstanceCleanup,\n  'stop/security-scan-aggregator': securityScanAggregator,\n  'stop/session-patterns': sessionPatterns,\n  'stop/task-completion-check': taskCompletionCheck,\n  'stop/calibration-persist': calibrationPersist,\n\n  // Setup hooks (7)\n  'setup/first-run-setup': firstRunSetup,\n  'setup/mem0-analytics-dashboard': mem0AnalyticsDashboard,\n  'setup/mem0-backup-setup': mem0BackupSetup,\n  'setup/mem0-cleanup': mem0Cleanup,\n  'setup/setup-check': setupCheck,\n  'setup/setup-maintenance': setupMaintenance,\n  'setup/setup-repair': setupRepair,\n\n  // Agent hooks (6)\n  'agent/block-writes': blockWrites,\n  'agent/ci-safety-check': ciSafetyCheck,\n  'agent/deployment-safety-check': deploymentSafetyCheck,\n  'agent/migration-safety-check': migrationSafetyCheck,\n  'agent/security-command-audit': securityCommandAudit,\n\n  // PostTool hooks - Root (13)\n  'posttool/audit-logger': auditLogger,\n  'posttool/unified-error-handler': unifiedErrorHandler,\n  'posttool/auto-lint': autoLint,\n  'posttool/context-budget-monitor': contextBudgetMonitor,\n  'posttool/coordination-heartbeat': coordinationHeartbeat,\n  'posttool/mem0-webhook-handler': mem0WebhookHandler,\n  'posttool/memory-bridge': memoryBridge,\n  'posttool/realtime-sync': realtimeSync,\n  'posttool/session-metrics': sessionMetrics,\n  'posttool/skill-edit-tracker': skillEditTracker,\n  'posttool/calibration-tracker': calibrationTracker,\n\n  // PostTool/Write hooks (5)\n  'posttool/write/code-style-learner': codeStyleLearner,\n  'posttool/write/coverage-predictor': coveragePredictor,\n  'posttool/write/naming-convention-learner': namingConventionLearner,\n  'posttool/write/readme-sync': readmeSync,\n  'posttool/write/release-lock-on-commit': releaseLockOnCommit,\n\n  // PostTool/Bash hooks (3)\n  'posttool/bash/issue-progress-commenter': issueProgressCommenter,\n  'posttool/bash/issue-subtask-updater': issueSubtaskUpdater,\n  'posttool/bash/pattern-extractor': patternExtractor,\n\n  // PostTool/Skill hooks (1)\n  'posttool/skill/skill-usage-optimizer': skillUsageOptimizer,\n\n  // PostTool/Write-Edit hooks (1)\n  'posttool/write-edit/file-lock-release': fileLockRelease,\n\n  // Lifecycle hooks (17) - SessionStart/SessionEnd\n  'lifecycle/analytics-consent-check': analyticsConsentCheck,\n  'lifecycle/coordination-cleanup': coordinationCleanup,\n  'lifecycle/coordination-init': coordinationInit,\n  'lifecycle/instance-heartbeat': instanceHeartbeat,\n  'lifecycle/mem0-analytics-tracker': mem0AnalyticsTracker,\n  'lifecycle/mem0-context-retrieval': mem0ContextRetrieval,\n  'lifecycle/mem0-webhook-setup': mem0WebhookSetup,\n  'lifecycle/multi-instance-init': multiInstanceInit,\n  'lifecycle/pattern-sync-pull': patternSyncPull,\n  'lifecycle/pattern-sync-push': patternSyncPush,\n  'lifecycle/session-cleanup': sessionCleanup,\n  'lifecycle/session-context-loader': sessionContextLoader,\n  'lifecycle/session-env-setup': sessionEnvSetup,\n  'lifecycle/session-metrics-summary': sessionMetricsSummary,\n  'lifecycle/dependency-version-check': dependencyVersionCheck,\n};\n\n/**\n * Get a hook by name\n */\nexport function getHook(name: string): HookFn | undefined {\n  return hooks[name];\n}\n\n/**\n * List all registered hooks\n */\nexport function listHooks(): string[] {\n  return Object.keys(hooks);\n}\n\n/**\n * Run a hook by name\n */\nexport async function runHook(\n  name: string,\n  input: Parameters<HookFn>[0]\n): Promise<ReturnType<HookFn>> {\n  const hook = getHook(name);\n  if (!hook) {\n    return { continue: true, suppressOutput: true };\n  }\n  return hook(input);\n}\n"],
  "mappings": ";;;;yPAoNO,SAASA,GAAYC,EAA0C,CACpE,OAAO,OAAOA,EAAM,SAAY,QAClC,CAEO,SAASC,GAAaD,EAA2C,CACtE,OAAO,OAAOA,EAAM,WAAc,UAAY,OAAOA,EAAM,SAAY,QACzE,CAEO,SAASE,GAAYF,EAA0C,CACpE,OACE,OAAOA,EAAM,WAAc,UAC3B,OAAOA,EAAM,YAAe,UAC5B,OAAOA,EAAM,YAAe,QAEhC,CAEO,SAASG,GAAYH,EAA0C,CACpE,OAAO,OAAOA,EAAM,WAAc,UAAYA,EAAM,UAAY,MAClE,CCjOA,OAAS,kBAAAI,GAAgB,cAAAC,GAAY,YAAAC,GAAU,cAAAC,GAAY,aAAAC,GAAW,YAAAC,OAAgB,UACtF,OAAS,YAAAC,OAAgB,qBAWlB,SAASC,GAAoB,CAClC,OAAI,QAAQ,IAAI,mBACP,GAAG,QAAQ,IAAI,MAAQ,MAAM,oBAE/B,GAAGC,EAAc,CAAC,eAC3B,CAMO,SAASA,GAAwB,CACtC,OAAO,QAAQ,IAAI,oBAAsB,GAC3C,CAMO,SAASC,GAAwB,CACtC,OAAO,QAAQ,IAAI,oBAAsB,QAAQ,IAAI,oBAAsB,GAC7E,CAQO,SAASC,GAAuB,CACrC,OAAO,QAAQ,IAAI,mBAAqB,YAAY,QAAQ,GAAG,IAAI,KAAK,IAAI,CAAC,EAC/E,CAMO,SAASC,GAAgBC,EAA6B,CAC3D,GAAI,QAAQ,IAAI,kBACd,OAAO,QAAQ,IAAI,kBAGrB,GAAI,CACF,IAAMC,EAASP,GAAS,4BAA6B,CACnD,IAAKM,GAAcJ,EAAc,EACjC,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAAE,KAAK,EACR,eAAQ,IAAI,kBAAoBK,EACzBA,CACT,MAAQ,CACN,MAAO,SACT,CACF,CAKO,SAASC,IAAsB,CACpC,OAAO,QAAQ,IAAI,sBAAwB,MAC7C,CAKO,SAASC,GAAUC,EAAqD,CAC7E,IAAMC,EAAS,CAAC,QAAS,OAAQ,OAAQ,OAAO,EAChD,OAAOA,EAAO,QAAQD,CAAK,GAAKC,EAAO,QAAQH,GAAY,CAAC,CAC9D,CASO,SAASI,GAAkC,CAChD,MAAO,CAAE,SAAU,GAAM,eAAgB,EAAK,CAChD,CAKO,SAASC,IAAgC,CAC9C,MAAO,CACL,SAAU,GACV,eAAgB,GAChB,mBAAoB,CAAE,mBAAoB,OAAQ,CACpD,CACF,CAKO,SAASC,EAAYC,EAA4B,CACtD,MAAO,CACL,SAAU,GACV,WAAYA,EACZ,mBAAoB,CAClB,mBAAoB,OACpB,yBAA0BA,CAC5B,CACF,CACF,CAMO,SAASC,EAAkBC,EAAyB,CACzD,MAAO,CACL,SAAU,GACV,eAAgB,GAChB,mBAAoB,CAClB,cAAe,cACf,kBAAmBA,CACrB,CACF,CACF,CAMO,SAASC,EAAoBD,EAAyB,CAC3D,MAAO,CACL,SAAU,GACV,eAAgB,GAChB,mBAAoB,CAClB,cAAe,mBACf,kBAAmBA,CACrB,CACF,CACF,CAKO,SAASE,EAAuBF,EAAaG,EAAoC,CACtF,IAAMC,EAAqB,CACzB,SAAU,GACV,mBAAoB,CAClB,cAAe,aACf,kBAAmBJ,EACnB,mBAAoB,OACtB,CACF,EAEA,OAAIG,EACFC,EAAO,cAAgBD,EAEvBC,EAAO,eAAiB,GAGnBA,CACT,CAKO,SAASC,GAAYC,EAA6B,CACvD,MAAO,CAAE,SAAU,GAAM,cAAeA,CAAQ,CAClD,CAKO,SAASC,EAAcD,EAA6B,CACzD,MAAO,CAAE,SAAU,GAAM,cAAe,UAAUA,CAAO,EAAG,CAC9D,CAKO,SAASE,EAAWV,EAA4B,CACrD,MAAO,CACL,SAAU,GACV,WAAYA,EACZ,mBAAoB,CAClB,cAAe,aACf,mBAAoB,OACpB,yBAA0BA,CAC5B,CACF,CACF,CAMA,IAAMW,GAAwB,IAAM,KAC9BC,GAA0B,IAAM,KAKtC,SAASC,GAAcC,EAAiBC,EAAuB,CAC7D,GAAKnC,GAAWkC,CAAO,EAEvB,GAAI,CAEF,GADcjC,GAASiC,CAAO,EACpB,KAAOC,EAAS,CACxB,IAAMC,EAAU,GAAGF,CAAO,QAAQ,KAAK,IAAI,CAAC,GAC5ChC,GAAWgC,EAASE,CAAO,CAC7B,CACF,MAAQ,CAER,CACF,CAKA,SAASC,GAAUC,EAAmB,CAC/BtC,GAAWsC,CAAG,GACjBnC,GAAUmC,EAAK,CAAE,UAAW,EAAK,CAAC,CAEtC,CAMO,SAASC,EAAQC,EAAkBZ,EAAiBb,EAA6C,QAAe,CAErH,GAAI,CAACD,GAAUC,CAAK,EAClB,OAGF,IAAM0B,EAASnC,EAAU,EACnB4B,EAAU,GAAGO,CAAM,aAEzB,GAAI,CACFJ,GAAUI,CAAM,EAChBR,GAAcC,EAASH,EAAqB,EAE5C,IAAMW,EAAY,IAAI,KAAK,EAAE,YAAY,EAAE,QAAQ,IAAK,GAAG,EAAE,MAAM,EAAG,EAAE,EACxE3C,GAAemC,EAAS,IAAIQ,CAAS,MAAM3B,EAAM,YAAY,CAAC,MAAMyB,CAAQ,KAAKZ,CAAO;AAAA,CAAI,CAC9F,MAAQ,CAER,CACF,CAMO,SAASe,EACdC,EACAxB,EACAyB,EACM,CACN,IAAMJ,EAASnC,EAAU,EACnB4B,EAAU,GAAGO,CAAM,2BAEzB,GAAI,CACFJ,GAAUI,CAAM,EAChBR,GAAcC,EAASF,EAAuB,EAE9C,IAAMU,EAAY,IAAI,KAAK,EAAE,YAAY,EACnCI,EAAYD,GAAqB,WAAa,QAAQ,IAAI,gBAAkB,UAC5EE,EAAaF,GAAqB,YAAcpC,EAAa,EAEnEV,GACEmC,EACA,GAAGQ,CAAS,MAAME,CAAQ,MAAMxB,CAAM,WAAW0B,CAAQ,cAAcC,CAAS;AAAA,CAClF,CACF,MAAQ,CAER,CACF,CAUO,SAASC,IAA2B,CACzC,GAAI,CAEF,IAAMC,EAAmB,CAAC,EAEpBC,EAAM,OAAO,YAAY,GAAO,EAElCC,EACEC,EAAK,EAEX,OACE,GAAI,CAEF,GADAD,EAAY/C,GAASgD,EAAIF,EAAK,EAAG,IAAS,IAAI,EAC1CC,IAAc,EAAG,MACrBF,EAAO,KAAK,OAAO,KAAKC,EAAI,SAAS,EAAGC,CAAS,CAAC,CAAC,CACrD,MAAQ,CACN,KACF,CAGF,IAAMN,EAAQ,OAAO,OAAOI,CAAM,EAAE,SAAS,MAAM,EAAE,KAAK,EAC1D,OAAKJ,EAIE,KAAK,MAAMA,CAAK,EAHd,CAAE,UAAW,GAAI,WAAYpC,EAAa,EAAG,WAAY,CAAC,CAAE,CAIvE,MAAQ,CACN,MAAO,CAAE,UAAW,GAAI,WAAYA,EAAa,EAAG,WAAY,CAAC,CAAE,CACrE,CACF,CAKO,SAAS4C,EAAYR,EAAkBS,EAA6B,CACzE,IAAMC,EAAQD,EAAK,QAAQ,MAAO,EAAE,EAAE,MAAM,GAAG,EAC3CE,EAAiBX,EAErB,QAAWY,KAAQF,EAAO,CACxB,GAAIC,GAAU,KAA6B,OAC3CA,EAASA,EAAkCC,CAAI,CACjD,CAEA,OAAOD,CACT,CAUO,SAASE,GAAiBC,EAAyB,CACxD,OAAOA,EACJ,QAAQ,gBAAiB,GAAG,EAC5B,QAAQ,MAAO,GAAG,EAClB,QAAQ,OAAQ,GAAG,EACnB,KAAK,CACV,CAKO,SAASC,GAAYC,EAAqB,CAC/C,OAAOA,EAAI,QAAQ,sBAAuB,MAAM,CAClD,CCzWA,OAAS,YAAAC,OAAgB,qBAMlB,SAASC,GAAiBC,EAA6B,CAC5D,IAAMC,EAAMD,GAAcE,EAAc,EACxC,GAAI,CACF,OAAOC,GAAS,4BAA6B,CAC3C,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAAE,KAAK,CACV,MAAQ,CACN,MAAO,SACT,CACF,CAKO,SAASG,GAAkBC,EAA0B,CAC1D,IAAMC,EAAgBD,GAAUN,GAAiB,EACjD,MAAO,CAAC,MAAO,OAAQ,QAAQ,EAAE,SAASO,CAAa,CACzD,CAKO,SAASC,EAAYP,EAA6B,CACvD,IAAMC,EAAMD,GAAcE,EAAc,EACxC,GAAI,CACF,OAAOC,GAAS,gCAAiC,CAC/C,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAAE,KAAK,CACV,MAAQ,CACN,OAAOA,CACT,CACF,CAKO,SAASO,GAAUR,EAA8B,CACtD,IAAMC,EAAMD,GAAcE,EAAc,EACxC,GAAI,CACF,OAAAC,GAAS,0BAA2B,CAClC,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EACM,EACT,MAAQ,CACN,MAAO,EACT,CACF,CAKO,SAASQ,GAAaT,EAA6B,CACxD,IAAMC,EAAMD,GAAcE,EAAc,EACxC,GAAI,CACF,OAAOC,GAAS,qBAAsB,CACpC,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAAE,KAAK,CACV,MAAQ,CACN,MAAO,EACT,CACF,CAKO,SAASS,GAAsBV,EAA8B,CAClE,OAAOS,GAAaT,CAAU,EAAE,OAAS,CAC3C,CAKO,SAASW,GAAiBX,EAA6B,CAC5D,IAAMC,EAAMD,GAAcE,EAAc,EACxC,GAAI,CAEF,OAAAC,GAAS,8BAA+B,CACtC,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EACM,MACT,MAAQ,CACN,GAAI,CAEF,OAAAE,GAAS,gCAAiC,CACxC,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EACM,QACT,MAAQ,CACN,MAAO,MACT,CACF,CACF,CAMO,SAASW,GAAmBP,EAA+B,CAEhE,IAAMQ,EAAW,CACf,gBACA,kBACA,cACA,cACA,eACA,UACA,UACA,QACF,EAEA,QAAWC,KAAWD,EAAU,CAC9B,IAAME,EAAQV,EAAO,MAAMS,CAAO,EAClC,GAAIC,EACF,OAAO,SAASA,EAAM,CAAC,EAAG,EAAE,CAEhC,CAEA,OAAO,IACT,CAMO,SAASC,GAAmBX,EAA+B,CAEhE,GAAID,GAAkBC,CAAM,EAC1B,OAAO,KAIT,IAAMY,EAAgB,CACpB,SACA,WACA,OACA,OACA,QACA,SACA,QACA,YACA,QACA,MACA,QACA,SACA,WACA,SACF,EAGA,OADuBA,EAAc,KAAMC,GAAWb,EAAO,WAAWa,CAAM,CAAC,EAM3Eb,EAAO,WAAW,QAAQ,GAAK,CAACO,GAAmBP,CAAM,EACpD,+EAGF,KARE,iDAAiDY,EAAc,KAAK,IAAI,CAAC,EASpF,CCzKO,SAASE,GACdC,EACmC,CACnC,OAAQC,GAAsBD,EAAUC,CAAK,EAAI,KAAOC,EAAoB,CAC9E,CASO,SAASC,GACdF,KACGG,EACU,CACb,IAAMC,EAAWJ,EAAM,WAAW,UAClC,GAAI,CAACI,EAAU,OAAOH,EAAoB,EAE1C,IAAMI,EAAMD,EAAS,MAAM,GAAG,EAAE,IAAI,GAAG,YAAY,GAAK,GAGxD,OAF6BD,EAAW,IAAKG,GAAMA,EAAE,YAAY,EAAE,QAAQ,MAAO,EAAE,CAAC,EAE5D,SAASD,CAAG,EAC5B,KAGFJ,EAAoB,CAC7B,CAKO,SAASM,EAAeP,EAA+B,CAC5D,OAAOE,GAAmBF,EAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAM,CACrF,CAKO,SAASQ,GAAiBR,EAA+B,CAC9D,OAAOE,GAAmBF,EAAO,IAAI,CACvC,CAKO,SAASS,GAAqBT,EAA+B,CAClE,OAAOE,GAAmBF,EAAO,KAAM,MAAO,KAAM,KAAK,CAC3D,CASO,SAASU,GAAeV,EAA+B,CAC5D,IAAMI,EAAWJ,EAAM,WAAW,UAClC,OAAKI,EAEgB,CAAC,QAAS,QAAS,YAAY,EACnC,KAAMO,GAAMA,EAAE,KAAKP,CAAQ,CAAC,EACpC,KAGFH,EAAoB,EAPLA,EAAoB,CAQ5C,CAKO,SAASW,GAAkBZ,EAA+B,CAC/D,IAAMI,EAAWJ,EAAM,WAAW,WAAa,GAC/C,OAAKI,GAGgB,CACnB,eACA,mBACA,YACA,WACA,YACA,kBACA,aACA,WACA,SACF,EAEiB,KAAMO,GAAMA,EAAE,KAAKP,CAAQ,CAAC,EACpCH,EAAoB,EAhBP,IAoBxB,CAKO,SAASY,GAAiBb,KAAqBc,EAA4C,CAChG,IAAMV,EAAWJ,EAAM,WAAW,UAClC,GAAI,CAACI,EAAU,OAAOH,EAAoB,EAE1C,QAAWc,KAAWD,EACpB,GAAI,OAAOC,GAAY,UAGrB,GADc,IAAI,OAAOA,EAAQ,QAAQ,MAAO,IAAI,EAAE,QAAQ,MAAO,GAAG,CAAC,EAC/D,KAAKX,CAAQ,EAAG,OAAO,aAE7BW,EAAQ,KAAKX,CAAQ,EAAG,OAAO,KAIvC,OAAOH,EAAoB,CAC7B,CASO,SAASe,GAAUhB,KAAqBiB,EAA8B,CAC3E,IAAMC,EAAWlB,EAAM,UACvB,OAAKkB,EAEDD,EAAM,SAASC,CAAQ,EAClB,KAGFjB,EAAoB,EANLA,EAAoB,CAO5C,CAKO,SAASkB,GAAenB,EAA+B,CAC5D,OAAOgB,GAAUhB,EAAO,QAAS,MAAM,CACzC,CAKO,SAASoB,GAAUpB,EAA+B,CACvD,OAAOgB,GAAUhB,EAAO,MAAM,CAChC,CASO,SAASqB,GAAoBrB,EAA+B,CACjE,IAAMsB,EAAUtB,EAAM,WAAW,SAAW,GAe5C,MAZwB,CACtB,UACA,YACA,QACA,SACA,UACA,UACA,QACA,SACA,UACF,EAEoB,KAAMW,GAAMA,EAAE,KAAKW,CAAO,CAAC,EACtCrB,EAAoB,EAGtB,IACT,CAKO,SAASsB,GAAgBvB,EAA+B,CAG7D,OAFgBA,EAAM,WAAW,SAAW,IAEhC,WAAW,KAAK,EACnB,KAGFC,EAAoB,CAC7B,CASO,SAASuB,GAAmBxB,EAA+B,CAEhE,IAAMyB,EAAS,GADIzB,EAAM,aAAe,QAAQ,IAAI,oBAAsB,GAC9C,mCAE5B,GAAI,CACF,GAAM,CAAE,WAAA0B,CAAW,EAAI,EAAQ,SAAS,EACxC,GAAIA,EAAWD,CAAM,EACnB,OAAO,IAEX,MAAQ,CAER,CAEA,OAAOxB,EAAoB,CAC7B,CASO,SAAS0B,GAAU3B,KAAqB4B,EAA4D,CACzG,QAAWC,KAASD,EAAQ,CAC1B,IAAME,EAASD,EAAM7B,CAAK,EAC1B,GAAI8B,IAAW,KACb,OAAOA,CAEX,CACA,OAAO,IACT,CCzOO,IAAMC,EAAa,CAExB,cAAe,GAEf,aAAc,GAEd,iBAAkB,GAElB,QAAS,GAET,QAAS,EACX,EAoSaC,GAAsC,CACjD,mBAAoB,GACpB,qBAAsB,GACtB,wBAAyB,IACzB,kBAAmB,GACnB,gBAAiB,GACjB,WAAY,EACZ,iBAAkB,GACpB,ECzTA,OAAS,cAAAC,GAAY,gBAAAC,GAAc,eAAAC,OAAmB,UACtD,OAAS,QAAAC,OAAY,YAgBrB,IAAMC,GAAiB,CACrB,QAAS,GACT,OAAQ,GACR,QAAS,GACT,aAAc,GACd,SAAU,EACZ,EAGMC,GAAoB,CACxB,yFACA,8BACF,EAGMC,GAAyB,CAC7B,WACA,OACA,eACA,MACA,OACA,OACA,YACA,YACF,EAaIC,GAAkD,KAClDC,GAAgC,KAKpC,SAASC,GAAcC,EAAiD,CAEtE,GAAIH,IAAcC,KAAmBE,EACnC,OAAOH,GAGT,IAAMI,EAAQ,IAAI,IAElB,GAAI,CACF,IAAMC,EAAQC,GAAYH,CAAS,EAAE,OAAOI,GAAKA,EAAE,SAAS,KAAK,CAAC,EAElE,QAAWC,KAAQH,EAAO,CACxB,IAAMI,EAAYD,EAAK,QAAQ,MAAO,EAAE,EAClCE,EAAWC,GAAKR,EAAWK,CAAI,EAErC,GAAI,CAIF,IAAMI,EAHUC,GAAaH,EAAU,MAAM,EAGZ,MAAM,uBAAuB,EAC9D,GAAI,CAACE,EAAkB,SAEvB,IAAME,EAAcF,EAAiB,CAAC,EAGhCG,EAAYD,EAAY,MAAM,wBAAwB,EAC5D,GAAI,CAACC,EAAW,SAEhB,IAAMC,EAAcD,EAAU,CAAC,EAAE,KAAK,EAGhCE,EAAiBD,EAAY,MAAM,4BAA4B,EAG/DE,EAAWD,EACbD,EAAY,MAAM,EAAGA,EAAY,QAAQ,eAAe,CAAC,EAAE,KAAK,EAChEA,EAEAG,EAAqB,CAAC,EACtBC,EAAoB,CAAC,EAEzB,GAAIH,EAAgB,CAElB,IAAMI,EADcJ,EAAe,CAAC,EACJ,MAAM,MAAM,EAAE,IAAIK,GAAKA,EAAE,KAAK,EAAE,YAAY,CAAC,EAG7E,QAAWC,KAAMF,EACXE,EAAG,SAAS,GAAG,GAAKA,EAAG,SAAS,GAAG,EACrCH,EAAQ,KAAKG,CAAE,EACNA,EAAG,OAAS,GACrBJ,EAAS,KAAKI,CAAE,CAGtB,CAGA,IAAMC,EAAcV,EAAY,MAAM,mCAAmC,EACrEW,EACAD,IACFC,EAASD,EAAY,CAAC,EACnB,MAAM;AAAA,CAAI,EACV,IAAIE,GAAKA,EAAE,QAAQ,WAAY,EAAE,EAAE,KAAK,CAAC,EACzC,OAAO,OAAO,IAGfP,EAAS,OAAS,GAAKC,EAAQ,OAAS,IAC1ChB,EAAM,IAAIK,EAAW,CACnB,SAAAU,EACA,QAAAC,EACA,YAAaF,GAAYF,EAAY,MAAM,GAAG,EAAE,CAAC,EACjD,OAAAS,CACF,CAAC,CAEL,MAAQ,CAER,CACF,CACF,MAAQ,CACNE,EAAQ,oBAAqB,iCAAiC,CAChE,CAEA,OAAA3B,GAAaI,EACbH,GAAiBE,EACVC,CACT,CAWA,IAAIwB,GAAkD,KAClDC,GAAgC,KAKpC,SAASC,GAAcC,EAAiD,CACtE,GAAIH,IAAcC,KAAmBE,EACnC,OAAOH,GAGT,IAAMxB,EAAQ,IAAI,IAElB,GAAI,CACF,IAAM4B,EAAO1B,GAAYyB,EAAW,CAAE,cAAe,EAAK,CAAC,EACxD,OAAOE,GAAKA,EAAE,YAAY,CAAC,EAC3B,IAAIA,GAAKA,EAAE,IAAI,EAElB,QAAWC,KAAaF,EAAM,CAC5B,IAAMG,EAAYxB,GAAKoB,EAAWG,EAAW,UAAU,EAEvD,GAAKE,GAAWD,CAAS,EAEzB,GAAI,CAIF,IAAMvB,EAHUC,GAAasB,EAAW,MAAM,EAGb,MAAM,uBAAuB,EAC9D,GAAI,CAACvB,EAAkB,SAEvB,IAAME,EAAcF,EAAiB,CAAC,EAGhCG,EAAYD,EAAY,MAAM,wBAAwB,EACtDE,EAAcD,EAAYA,EAAU,CAAC,EAAE,KAAK,EAAI,GAGhDsB,EAAYvB,EAAY,MAAM,wBAAwB,EACxDK,EAAqB,CAAC,EAEtBkB,IACFlB,EAAWkB,EAAU,CAAC,EACnB,MAAM,GAAG,EACT,IAAIC,GAAKA,EAAE,KAAK,EAAE,YAAY,EAAE,QAAQ,QAAS,EAAE,CAAC,EACpD,OAAOA,GAAKA,EAAE,OAAS,CAAC,GAI7B,IAAMC,EAAevB,EAClB,YAAY,EACZ,MAAM,KAAK,EACX,OAAOwB,GAAKA,EAAE,OAAS,CAAC,EACxB,MAAM,EAAG,CAAC,EAEbrB,EAAW,CAAC,GAAG,IAAI,IAAI,CAAC,GAAGA,EAAU,GAAGoB,CAAY,CAAC,CAAC,GAElDpB,EAAS,OAAS,GAAKH,IACzBZ,EAAM,IAAI8B,EAAW,CAAE,SAAAf,EAAU,YAAAH,CAAY,CAAC,CAElD,MAAQ,CAER,CACF,CACF,MAAQ,CACNW,EAAQ,oBAAqB,iCAAiC,CAChE,CAEA,OAAAC,GAAaxB,EACbyB,GAAiBE,EACV3B,CACT,CASA,SAASqC,GACPC,EACAvB,EAC+D,CAC/D,IAAIwB,EAAQ,EACNC,EAAoB,CAAC,EACrBC,EAA0B,CAAC,EAEjC,QAAWC,KAAW3B,EAGpB,GADc,IAAI,OAAO,MAAM2B,EAAQ,QAAQ,sBAAuB,MAAM,CAAC,MAAO,GAAG,EAC7E,KAAKJ,CAAW,EAAG,CAC3B,IAAMK,EAASD,EAAQ,OAAS,EAAI,GAAK,GACzCH,GAASI,EACTH,EAAQ,KAAKE,CAAO,EACpBD,EAAQ,KAAK,CACX,KAAM,UACN,OAAQ,gBACR,OAAAE,EACA,QAASD,CACX,CAAC,CACH,CAIF,IAAME,EAAW7B,EAAS,OAAS,GACnC,MAAO,CACL,MAAO6B,EAAW,EAAI,KAAK,IAAKL,EAAQK,EAAY,IAAK,GAAG,EAAI,EAChE,QAAAJ,EACA,QAAAC,CACF,CACF,CAKA,SAASI,GACPP,EACAtB,EAC+D,CAC/D,IAAIuB,EAAQ,EACNC,EAAoB,CAAC,EACrBC,EAA0B,CAAC,EAEjC,QAAWK,KAAU9B,EACnB,GAAIsB,EAAY,SAASQ,CAAM,EAAG,CAChC,IAAMH,EAASG,EAAO,MAAM,KAAK,EAAE,OAAS,GAC5CP,GAASI,EACTH,EAAQ,KAAKM,CAAM,EACnBL,EAAQ,KAAK,CACX,KAAM,SACN,OAAQ,eACR,OAAAE,EACA,QAASG,CACX,CAAC,CACH,CAIF,IAAMF,EAAW5B,EAAQ,OAAS,GAClC,MAAO,CACL,MAAO4B,EAAW,EAAI,KAAK,IAAKL,EAAQK,EAAY,IAAK,GAAG,EAAI,EAChE,QAAAJ,EACA,QAAAC,CACF,CACF,CAKA,SAASM,GACPT,EACAvB,EACAiC,EAC4C,CAC5C,GAAIA,EAAQ,SAAW,EACrB,MAAO,CAAE,MAAO,EAAG,QAAS,CAAC,CAAE,EAGjC,IAAMP,EAA0B,CAAC,EAC7BF,EAAQ,EAGZ,QAAWU,KAAoBtD,GAC7B,GAAI2C,EAAY,SAASW,CAAgB,EAAG,CAC1CV,GAAS,GACTE,EAAQ,KAAK,CACX,KAAM,UACN,OAAQ,uBACR,OAAQ,GACR,QAASQ,CACX,CAAC,EACD,KACF,CAIF,IAAMC,EAAgBF,EAAQ,MAAM,EAAE,EAAE,KAAK,GAAG,EAAE,YAAY,EAC9D,QAAWN,KAAW3B,EAAS,MAAM,EAAG,CAAC,EACnCmC,EAAc,SAASR,CAAO,IAChCH,GAAS,GACTE,EAAQ,KAAK,CACX,KAAM,UACN,OAAQ,kBACR,OAAQ,GACR,QAASC,CACX,CAAC,GAIL,MAAO,CAAE,MAAO,KAAK,IAAIH,EAAO,GAAG,EAAG,QAAAE,CAAQ,CAChD,CAKA,SAASU,GAAyBC,EAA8D,CAC9F,IAAMX,EAA0B,CAAC,EAC7BY,EAAU,EAEd,QAAWC,KAAW5D,GACpB,GAAI4D,EAAQ,KAAKF,CAAM,EAAG,CACxBC,EAAU,GACVZ,EAAQ,KAAK,CACX,KAAM,WACN,OAAQ,oBACR,OAAQ,IACR,QAASW,EAAO,MAAME,CAAO,IAAI,CAAC,GAAK,UACzC,CAAC,EACD,KACF,CAGF,MAAO,CAAE,QAAAD,EAAS,QAAAZ,CAAQ,CAC5B,CAKA,SAASc,GACPlD,EACAmD,EACAC,EACiD,CACjD,GAAIA,EAAY,SAAW,EACzB,MAAO,CAAE,WAAY,EAAG,QAAS,CAAC,CAAE,EAGtC,IAAIC,EAAkB,EAChBjB,EAA0B,CAAC,EAEjC,QAAWkB,KAAOF,EACZE,EAAI,QAAUtD,GAAamD,EAAgB,SAASG,EAAI,OAAO,IACjED,GAAmBC,EAAI,WACvBlB,EAAQ,KAAK,CACX,KAAMkB,EAAI,WAAa,EAAI,QAAU,UACrC,OAAQ,cACR,OAAQA,EAAI,WACZ,QAAS,GAAGA,EAAI,OAAO,IAAItD,CAAS,EACtC,CAAC,GAIL,MAAO,CAAE,WAAYqD,EAAiB,QAAAjB,CAAQ,CAChD,CAKA,SAASmB,GACPtB,EACAjC,EACAwD,EACAb,EACAS,EACmB,CACnB,IAAMK,EAA6B,CAAC,EAC9BC,EAAuB,CAAC,EAGxBC,EAAgB3B,GAAsBC,EAAauB,EAAM,QAAQ,EACvEC,EAAW,KAAK,GAAGE,EAAc,OAAO,EACxCD,EAAW,KAAK,GAAGC,EAAc,OAAO,EAGxC,IAAMC,EAAepB,GAAqBP,EAAauB,EAAM,OAAO,EACpEC,EAAW,KAAK,GAAGG,EAAa,OAAO,EACvCF,EAAW,KAAK,GAAGE,EAAa,OAAO,EAGvC,IAAMC,EAAgBnB,GAAsBT,EAAauB,EAAM,SAAUb,CAAO,EAChFc,EAAW,KAAK,GAAGI,EAAc,OAAO,EAGxC,IAAMC,EAAiBhB,GAAyBb,CAAW,EAC3DwB,EAAW,KAAK,GAAGK,EAAe,OAAO,EAGzC,IAAMC,EAAoBb,GAAiBlD,EAAW0D,EAAYN,CAAW,EAC7EK,EAAW,KAAK,GAAGM,EAAkB,OAAO,EAG5C,IAAI7B,EACFyB,EAAc,OAASvE,GAAe,QAAU,KAChDwE,EAAa,OAASxE,GAAe,OAAS,KAC9CyE,EAAc,OAASzE,GAAe,QAAU,KAYlD,OATA8C,GAAS4B,EAAe,SAAW1E,GAAe,SAAW,KAG7D8C,GAAS,KAAK,IAAI,IAAK,KAAK,IAAI,GAAI6B,EAAkB,UAAU,CAAC,EAGjE7B,EAAQ,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKA,CAAK,CAAC,EAGpCA,EAAQ8B,EAAW,QACd,KAGF,CACL,MAAOhE,EACP,WAAY,KAAK,MAAMkC,CAAK,EAC5B,YAAasB,EAAM,YACnB,gBAAiBE,EACjB,QAASD,CACX,CACF,CAKA,SAASQ,GACPhC,EACAR,EACA+B,EACmB,CACnB,IAAMpB,EAA0B,CAAC,EAC3BD,EAAoB,CAAC,EACvBD,EAAQ,EAEZ,QAAWG,KAAWmB,EAAM,SAE1B,GADc,IAAI,OAAO,MAAMnB,EAAQ,QAAQ,sBAAuB,MAAM,CAAC,MAAO,GAAG,EAC7E,KAAKJ,CAAW,EAAG,CAC3B,IAAMK,EAASD,EAAQ,OAAS,EAAI,GAAK,GACzCH,GAASI,EACTH,EAAQ,KAAKE,CAAO,EACpBD,EAAQ,KAAK,CACX,KAAM,UACN,OAAQ,gBACR,OAAAE,EACA,QAASD,CACX,CAAC,CACH,CAMF,OAFAH,EAAQ,KAAK,IAAIA,EAAO,GAAG,EAEvBA,EAAQ8B,EAAW,QACd,KAGF,CACL,MAAOvC,EACP,WAAY,KAAK,MAAMS,CAAK,EAC5B,YAAasB,EAAM,YACnB,gBAAiBrB,EACjB,QAAAC,CACF,CACF,CAcO,SAAS8B,GACdnB,EACAJ,EAAoB,CAAC,EACrBS,EAAuC,CAAC,EAClB,CACtB,IAAMe,EAAaC,EAAc,EAC3B1E,EAAYQ,GAAKiE,EAAY,QAAQ,EACrC7C,EAAYpB,GAAKiE,EAAY,QAAQ,EAErClC,EAAcc,EAAO,YAAY,EAEjCU,EAA6B,CAAC,EAC9BY,EAA6B,CAAC,EAC9BC,EAA6B,CAAC,EAG9BC,EAAW9E,GAAcC,CAAS,EACxC,OAAW,CAACM,EAAWwD,CAAK,IAAKe,EAAU,CACzC,IAAMC,EAAQjB,GACZtB,EACAjC,EACAwD,EACAb,EACAS,CACF,EACIoB,IACFH,EAAa,KAAKG,CAAK,EACvBf,EAAW,KAAK,GAAGe,EAAM,OAAO,EAEpC,CAGA,IAAMC,EAAWpD,GAAcC,CAAS,EACxC,OAAW,CAACG,EAAW+B,CAAK,IAAKiB,EAAU,CACzC,IAAMD,EAAQP,GAAmBhC,EAAaR,EAAW+B,CAAK,EAC1DgB,IACFF,EAAa,KAAKE,CAAK,EACvBf,EAAW,KAAK,GAAGe,EAAM,OAAO,EAEpC,CAGAH,EAAa,KAAK,CAACK,EAAGC,IAAMA,EAAE,WAAaD,EAAE,UAAU,EACvDJ,EAAa,KAAK,CAACI,EAAGC,IAAMA,EAAE,WAAaD,EAAE,UAAU,EAGvD,IAAME,EAAWP,EAAa,CAAC,EACzBQ,EAASD,EACXE,GAAiBF,EAAS,MAAOA,EAAS,eAAe,EACzD,UAEEG,EAAgB,KAAK,IACzBH,GAAU,YAAc,EACxBN,EAAa,CAAC,GAAG,YAAc,CACjC,EAEMU,EACJJ,IAAa,QAAaA,EAAS,YAAcZ,EAAW,cAExDiB,EACJX,EAAa,OAAS,GACtBA,EAAa,CAAC,EAAE,YAAcN,EAAW,aAE3C,MAAO,CACL,OAAQK,EAAa,MAAM,EAAG,CAAC,EAC/B,OAAQC,EAAa,MAAM,EAAG,CAAC,EAC/B,OAAAO,EACA,WAAYE,EACZ,QAAStB,EACT,mBAAAuB,EACA,mBAAAC,CACF,CACF,CAKA,SAASH,GAAiBI,EAAexE,EAA4B,CACnE,IAAMyE,EAAuC,CAC3C,aAAc,CAAC,MAAO,WAAY,OAAQ,UAAW,OAAO,EAC5D,SAAY,CAAC,WAAY,SAAU,YAAa,MAAO,OAAO,EAC9D,eAAkB,CAAC,OAAQ,QAAS,MAAO,QAAS,SAAS,EAC7D,SAAY,CAAC,QAAS,YAAa,KAAM,OAAQ,OAAO,EACxD,QAAW,CAAC,OAAQ,WAAY,OAAQ,UAAW,KAAK,EACxD,OAAU,CAAC,SAAU,KAAM,KAAM,UAAW,SAAS,EACrD,iBAAkB,CAAC,MAAO,MAAO,YAAa,YAAa,OAAO,EAClE,SAAY,CAAC,WAAY,QAAS,MAAO,YAAa,MAAM,CAC9D,EAEA,OAAW,CAACC,EAAUC,CAAgB,IAAK,OAAO,QAAQF,CAAU,EAClE,QAAWrE,KAAMJ,EACf,GAAI2E,EAAiB,SAASvE,CAAE,EAC9B,OAAOsE,EAMb,OAAIF,EAAM,SAAS,SAAS,GAAKA,EAAM,SAAS,KAAK,EAAU,aAC3DA,EAAM,SAAS,UAAU,GAAKA,EAAM,SAAS,IAAI,EAAU,WAC3DA,EAAM,SAAS,MAAM,EAAU,UAC/BA,EAAM,SAAS,UAAU,EAAU,WAEhC,SACT,CAMO,SAASI,GAAevC,EAAyB,CAStD,MARI,EAAAA,EAAO,OAAS,IAGhB,wDAAwD,KAAKA,CAAM,GAKnE,2CAA2C,KAAKA,EAAO,KAAK,CAAC,EAKnE,CAKO,SAASwC,IAAmB,CACjChG,GAAa,KACbC,GAAiB,KACjB2B,GAAa,KACbC,GAAiB,IACnB,CChpBA,OAAS,cAAAoE,GAAY,gBAAAC,GAAc,iBAAAC,GAAe,aAAAC,OAAiB,UAanE,SAASC,IAAsB,CAC7B,MAAO,GAAGC,EAAc,CAAC,wBAC3B,CAEA,SAASC,IAAuB,CAC9B,IAAMC,EAAYC,EAAa,EAC/B,MAAO,GAAGJ,GAAY,CAAC,YAAYG,CAAS,OAC9C,CAEA,SAASE,IAAwB,CAC/B,MAAO,GAAGJ,EAAc,CAAC,oCAC3B,CAKA,SAASK,IAAuB,CAC9B,IAAMC,EAAMP,GAAY,EACxB,GAAI,CAACQ,GAAWD,CAAG,EACjB,GAAI,CACFE,GAAUF,EAAK,CAAE,UAAW,EAAK,CAAC,CACpC,MAAQ,CACNG,EAAQ,sBAAuB,+BAA+BH,CAAG,EAAE,CACrE,CAEJ,CASO,SAASI,GAAgC,CAC9C,IAAMC,EAAYV,GAAa,EAE/B,GAAIM,GAAWI,CAAS,EACtB,GAAI,CACF,IAAMC,EAAOC,GAAaF,EAAW,MAAM,EAC3C,OAAO,KAAK,MAAMC,CAAI,CACxB,OAASE,EAAK,CACZL,EAAQ,sBAAuB,yBAAyBK,CAAG,EAAE,CAC/D,CAIF,MAAO,CACL,UAAWX,EAAa,EACxB,aAAc,CAAC,EACf,eAAgB,CAAC,EACjB,cAAe,CAAC,EAChB,eAAgB,GAChB,UAAW,IAAI,KAAK,EAAE,YAAY,CACpC,CACF,CAKO,SAASY,GAAUC,EAAiC,CACzDX,GAAe,EACf,IAAMM,EAAYV,GAAa,EAE/Be,EAAM,UAAY,IAAI,KAAK,EAAE,YAAY,EAEzC,GAAI,CACFC,GAAcN,EAAW,KAAK,UAAUK,EAAO,KAAM,CAAC,CAAC,CACzD,OAASF,EAAK,CACZL,EAAQ,sBAAuB,yBAAyBK,CAAG,EAAE,CAC/D,CACF,CAKO,SAASI,GACdC,EACoB,CACpB,IAAMH,EAAQN,EAAU,EACxB,OAAAS,EAAOH,CAAK,EACZD,GAAUC,CAAK,EACRA,CACT,CASO,SAASI,GACdC,EACAC,EACAC,EACiB,CACjB,IAAMC,EAA8B,CAClC,MAAAH,EACA,OAAAE,EACA,WAAAD,EACA,aAAc,IAAI,KAAK,EAAE,YAAY,EACrC,OAAQ,UACR,WAAY,EACZ,WAAY,CACd,EAEA,OAAAJ,GAAYF,GAAS,CAEnBA,EAAM,aAAeA,EAAM,aAAa,OAAOS,GAAKA,EAAE,QAAUJ,CAAK,EACrEL,EAAM,aAAa,KAAKQ,CAAU,CACpC,CAAC,EAEDf,EAAQ,sBAAuB,6BAA6BY,CAAK,WAAWC,CAAU,GAAG,EAClFE,CACT,CAKO,SAASE,GACdL,EACAM,EACAJ,EACM,CACNL,GAAYF,GAAS,CACnB,IAAMY,EAAQZ,EAAM,aAAa,KAAKS,GAAKA,EAAE,QAAUJ,CAAK,EACxDO,IACFA,EAAM,OAASD,EACXJ,IAAQK,EAAM,OAASL,GACvBI,IAAW,YAAYC,EAAM,aAErC,CAAC,EAEDnB,EAAQ,sBAAuB,yBAAyBY,CAAK,OAAOM,CAAM,EAAE,CAC9E,CAKO,SAASE,GAAYR,EAAqB,CAC/CH,GAAYF,GAAS,CACnBA,EAAM,aAAeA,EAAM,aAAa,OAAOS,GAAKA,EAAE,QAAUJ,CAAK,CACvE,CAAC,CACH,CAKO,SAASS,IAA8C,CAE5D,OADcpB,EAAU,EACX,aAAa,KAAKe,GAAKA,EAAE,SAAW,aAAa,CAChE,CAKO,SAASM,GAAkBV,EAAwB,CAExD,OADcX,EAAU,EACX,aAAa,KACxBe,GAAKA,EAAE,QAAUJ,IAAUI,EAAE,SAAW,WAAaA,EAAE,SAAW,cACpE,CACF,CASO,SAASO,GAAmBC,EAAqB,CACtDf,GAAYF,GAAS,CACdA,EAAM,eAAe,SAASiB,CAAK,GACtCjB,EAAM,eAAe,KAAKiB,CAAK,CAEnC,CAAC,CACH,CAKO,SAASC,GAAgBD,EAAwB,CAEtD,OADcvB,EAAU,EACX,eAAe,SAASuB,CAAK,CAC5C,CAKO,SAASE,IAA8B,CAC5C,OAAOzB,EAAU,EAAE,cACrB,CASO,SAAS0B,GAAmBC,EAAsB,CACvDnB,GAAYF,GAAS,CACnBA,EAAM,cAAc,KAAKqB,CAAM,EAE3BrB,EAAM,cAAc,OAASA,EAAM,iBACrCA,EAAM,cAAgBA,EAAM,cAAc,MAAM,CAACA,EAAM,cAAc,EAEzE,CAAC,CACH,CAKO,SAASsB,IAA6B,CAC3C,OAAO5B,EAAU,EAAE,aACrB,CASO,SAAS6B,GAAoBC,EAAoC,CACtEtB,GAAYF,GAAS,CACnBA,EAAM,mBAAqBwB,CAC7B,CAAC,CACH,CAKO,SAASC,IAA0D,CACxE,OAAO/B,EAAU,EAAE,kBACrB,CAMA,IAAMgC,GAA6C,CACjD,mBAAoB,GACpB,qBAAsB,GACtB,wBAAyB,IACzB,kBAAmB,GACnB,gBAAiB,GACjB,WAAY,EACZ,iBAAkB,GACpB,EAKO,SAASC,GAAkC,CAChD,IAAMC,EAAaxC,GAAc,EAEjC,GAAIG,GAAWqC,CAAU,EACvB,GAAI,CACF,IAAMhC,EAAOC,GAAa+B,EAAY,MAAM,EAC5C,MAAO,CAAE,GAAGF,GAAuB,GAAG,KAAK,MAAM9B,CAAI,CAAE,CACzD,MAAQ,CAER,CAGF,OAAO8B,EACT,CAKO,SAASG,GAAWC,EAA4C,CACrEzC,GAAe,EACf,IAAMuC,EAAaxC,GAAc,EAE3B2C,EAAS,CAAE,GADDJ,EAAW,EACE,GAAGG,CAAO,EAEvC,GAAI,CACF7B,GAAc2B,EAAY,KAAK,UAAUG,EAAQ,KAAM,CAAC,CAAC,CAC3D,OAASjC,EAAK,CACZL,EAAQ,sBAAuB,0BAA0BK,CAAG,EAAE,CAChE,CACF,CASO,SAASkC,IAA0B,CACxC,IAAMrC,EAAYV,GAAa,EAE/B,GAAI,CACF,GAAIM,GAAWI,CAAS,EAAG,CACzB,GAAM,CAAE,WAAAsC,CAAW,EAAI,EAAQ,SAAS,EACxCA,EAAWtC,CAAS,EACpBF,EAAQ,sBAAuB,uBAAuB,CACxD,CACF,MAAQ,CAER,CACF,CAKO,SAASyC,IAAyB,CACvC,IAAM5C,EAAMP,GAAY,EAExB,GAAKQ,GAAWD,CAAG,EAEnB,GAAI,CACF,GAAM,CAAE,YAAA6C,EAAa,SAAAC,EAAU,WAAAH,CAAW,EAAI,EAAQ,SAAS,EACzDI,EAAQF,EAAY7C,CAAG,EAC1B,OAAQgD,GAAcA,EAAE,WAAW,UAAU,GAAKA,EAAE,SAAS,OAAO,CAAC,EACrE,IAAKA,IAAe,CACnB,KAAMA,EACN,KAAM,GAAGhD,CAAG,IAAIgD,CAAC,GACjB,MAAOF,EAAS,GAAG9C,CAAG,IAAIgD,CAAC,EAAE,EAAE,MAAM,QAAQ,CAC/C,EAAE,EACD,KAAK,CAAC7B,EAAsB8B,IAAyBA,EAAE,MAAQ9B,EAAE,KAAK,EAGzE,QAAW+B,KAAQH,EAAM,MAAM,CAAC,EAC9B,GAAI,CACFJ,EAAWO,EAAK,IAAI,EACpB/C,EAAQ,sBAAuB,yBAAyB+C,EAAK,IAAI,EAAE,CACrE,MAAQ,CAER,CAEJ,MAAQ,CAER,CACF,CC7VA,OAAS,cAAAC,GAAY,gBAAAC,GAAc,iBAAAC,GAAe,aAAAC,OAAiB,UAuCnE,SAASC,IAA0B,CACjC,IAAMC,EAAYC,EAAa,EAC/B,MAAO,GAAGC,EAAc,CAAC,wCAAwCF,CAAS,OAC5E,CAEA,SAASG,IAAkB,CACzB,IAAMC,EAAM,GAAGF,EAAc,CAAC,yBAC9B,GAAI,CAACG,GAAWD,CAAG,EACjB,GAAI,CACFE,GAAUF,EAAK,CAAE,UAAW,EAAK,CAAC,CACpC,MAAQ,CAER,CAEJ,CAEA,SAASG,GAA6B,CACpC,IAAMC,EAAOT,GAAgB,EAE7B,GAAIM,GAAWG,CAAI,EACjB,GAAI,CACF,OAAO,KAAK,MAAMC,GAAaD,EAAM,MAAM,CAAC,CAC9C,MAAQ,CAER,CAGF,MAAO,CACL,cAAe,QACf,UAAWP,EAAa,EACxB,MAAO,CAAC,EACR,UAAW,CAAC,EACZ,UAAW,IAAI,KAAK,EAAE,YAAY,CACpC,CACF,CAEA,SAASS,GAAaC,EAA8B,CAClDR,GAAU,EACV,IAAMK,EAAOT,GAAgB,EAC7BY,EAAS,UAAY,IAAI,KAAK,EAAE,YAAY,EAE5C,GAAI,CACFC,GAAcJ,EAAM,KAAK,UAAUG,EAAU,KAAM,CAAC,CAAC,CACvD,OAASE,EAAK,CACZC,EAAQ,mBAAoB,4BAA4BD,CAAG,EAAE,CAC/D,CACF,CASA,SAASE,GAAsBC,EAAeC,EAA6B,CAmBzE,IAAMC,EAlBoC,CACxC,2BAA4B,YAC5B,wBAAyB,WACzB,iBAAkB,oBAClB,mBAAoB,WACpB,qBAAsB,eACtB,oBAAqB,4BACrB,iBAAkB,sBAClB,wBAAyB,YACzB,gBAAiB,qBACjB,qBAAsB,eACtB,qBAAsB,gBACtB,uBAAwB,aACxB,2BAA4B,6BAC5B,2BAA4B,+BAC5B,yBAA0B,uBAC5B,EAEyBF,CAAK,GAAK,aAC7BG,EAAYF,EAAY,MAAM,EAAG,EAAE,EAAE,YAAY,EACvD,MAAO,GAAGC,CAAM,IAAIC,CAAS,EAC/B,CAKO,SAASC,GACdJ,EACAC,EACAI,EACAC,EACuB,CACvB,IAAMC,EAAaP,EAChB,MAAM,GAAG,EACT,IAAIQ,GAAKA,EAAE,OAAO,CAAC,EAAE,YAAY,EAAIA,EAAE,MAAM,CAAC,CAAC,EAC/C,KAAK,GAAG,EAELC,EAA6B,CACjC,OAAQ,gBACR,gBAAiBT,EACjB,mBAAoBK,EACpB,GAAGC,CACL,EAEA,MAAO,CACL,QAAS,GAAGC,CAAU,KAAKN,EAAY,MAAM,EAAG,EAAE,CAAC,GACnD,YAAa,qCAAqCI,CAAU;AAAA;AAAA,EAAoBJ,CAAW,GAC3F,WAAYF,GAAsBC,EAAOC,CAAW,EACpD,SAAUQ,CACZ,CACF,CAKO,SAASC,GACdC,EACAC,EACAC,EACAC,EACuB,CACvB,IAAMC,EAAqC,CACzC,OAAAJ,EACA,OAAAC,CACF,EAEA,OAAIC,GAAaA,EAAU,OAAS,IAClCE,EAAY,aAAeF,GAGzBC,GAAUA,EAAO,OAAS,IAC5BC,EAAY,UAAYD,GAGnBC,CACT,CAKO,SAASC,GAA0BD,EAA4C,CACpF,MAAO;AAAA;AAAA;AAAA;AAAA,cAIKA,EAAY,OAAO;AAAA,kBACfA,EAAY,WAAW;AAAA,iBACxBA,EAAY,UAAU;AAAA;AAAA,eAExBA,EAAY,SAAS,MAAM;AAAA,wBAClBA,EAAY,SAAS,iBAAmB,EAAE;AAAA,0BACxCA,EAAY,SAAS,oBAAsB,CAAC;AAAA,OAEtE,CAKO,SAASE,GACdN,EACAO,EACuB,CACvB,MAAO,CACL,OAAAP,EACA,OAAQ,SACV,CACF,CAKO,SAASQ,GAA0BR,EAAgBS,EAAwB,CAChF,MAAO;AAAA;AAAA;AAAA;AAAA,aAIIT,CAAM;AAAA;AAAA;AAAA;AAAA,cAILS,CAAM,EACpB,CAKO,SAASC,GAA0BN,EAA4C,CACpF,IAAIO,EAAK;AAAA;AAAA;AAAA;AAAA,aAIEP,EAAY,MAAM,IAE7B,OAAIA,EAAY,SACdO,GAAM;AAAA,aAAgBP,EAAY,MAAM,KAGtCA,EAAY,cAAgBA,EAAY,aAAa,OAAS,IAChEO,GAAM;AAAA,kBAAqB,KAAK,UAAUP,EAAY,YAAY,CAAC,IAGjEA,EAAY,WAAaA,EAAY,UAAU,OAAS,IAC1DO,GAAM;AAAA,eAAkB,KAAK,UAAUP,EAAY,SAAS,CAAC,IAG/DO,GAAM,QACCA,CACT,CASO,SAASC,GACdZ,EACAX,EACAK,EACAmB,EACAC,EACAZ,EACAC,EACM,CACN,IAAMnB,EAAWJ,EAAa,EAI9B,GADiBI,EAAS,MAAM,KAAK+B,GAAKA,EAAE,SAAWf,CAAM,EAC/C,CACZb,EAAQ,mBAAoB,QAAQa,CAAM,qBAAqB,EAC/D,MACF,CAEAhB,EAAS,MAAM,KAAK,CAClB,OAAAgB,EACA,MAAAX,EACA,WAAAK,EACA,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,OAAQ,UACR,WAAAmB,EACA,aAAAC,EACA,UAAAZ,EACA,OAAAC,CACF,CAAC,EAEDpB,GAAaC,CAAQ,EACrBG,EAAQ,mBAAoB,mBAAmBa,CAAM,cAAcX,CAAK,EAAE,CAC5E,CAKO,SAAS2B,EACdhB,EACAC,EACM,CACN,IAAMjB,EAAWJ,EAAa,EAExBqC,EAAOjC,EAAS,MAAM,KAAK+B,GAAKA,EAAE,SAAWf,CAAM,EACrDiB,IACFA,EAAK,OAAShB,EACdlB,GAAaC,CAAQ,EACrBG,EAAQ,mBAAoB,gBAAgBa,CAAM,cAAcC,CAAM,EAAE,EAE5E,CAKO,SAASiB,EAAe7B,EAAsC,CAEnE,OADiBT,EAAa,EACd,MAAM,KACpBmC,GAAKA,EAAE,QAAU1B,IAAU0B,EAAE,SAAW,WAAaA,EAAE,SAAW,cACpE,CACF,CAKO,SAASI,GAAYnB,EAAuC,CAEjE,OADiBpB,EAAa,EACd,MAAM,KAAKmC,GAAKA,EAAE,SAAWf,CAAM,CACrD,CAKO,SAASoB,GAAkBC,EAAmC,CAEnE,OADiBzC,EAAa,EACd,MAAM,OACpBmC,GACEA,EAAE,SAAW,WACbA,EAAE,WACFA,EAAE,UAAU,SAASM,CAAY,CACrC,CACF,CAKO,SAASC,IAAgC,CAC9C,IAAMtC,EAAWJ,EAAa,EACxB2C,EAAY,IAAI,IACpBvC,EAAS,MAAM,OAAO+B,GAAKA,EAAE,SAAW,QAAQ,EAAE,IAAIA,GAAKA,EAAE,MAAM,CACrE,EAEA,OAAIQ,EAAU,OAAS,EAAU,CAAC,EAE3BvC,EAAS,MAAM,OAAO+B,GACvBA,EAAE,SAAW,WAAa,CAACA,EAAE,WAAaA,EAAE,UAAU,SAAW,EAC5D,GAGFA,EAAE,UAAU,MAAMS,GAAMD,EAAU,IAAIC,CAAE,CAAC,CACjD,CACH,CAKO,SAASC,GAAiBZ,EAAiC,CAEhE,OADiBjC,EAAa,EACd,MACb,OAAOmC,GAAKA,EAAE,aAAeF,CAAU,EACvC,KAAK,CAACa,EAAGC,KAAOD,EAAE,cAAgB,IAAMC,EAAE,cAAgB,EAAE,CACjE,CASO,SAASC,GAAiBC,EAAmC,CAClE,IAAM7C,EAAWJ,EAAa,EAI9B,GADiBI,EAAS,UAAU,KAAK8C,GAAKA,EAAE,aAAeD,EAAS,UAAU,EACpE,CACZ1C,EAAQ,mBAAoB,YAAY0C,EAAS,UAAU,qBAAqB,EAChF,MACF,CAEA7C,EAAS,UAAU,KAAK6C,CAAQ,EAChC9C,GAAaC,CAAQ,EACrBG,EAAQ,mBAAoB,uBAAuB0C,EAAS,UAAU,KAAKA,EAAS,IAAI,GAAG,CAC7F,CAKO,SAASE,GACdlB,EACAmB,EACM,CACN,IAAMhD,EAAWJ,EAAa,EAExBiD,EAAW7C,EAAS,UAAU,KAAK8C,GAAKA,EAAE,aAAejB,CAAU,EACrEgB,IACF,OAAO,OAAOA,EAAUG,CAAO,EAC/BjD,GAAaC,CAAQ,EACrBG,EAAQ,mBAAoB,oBAAoB0B,CAAU,EAAE,EAEhE,CAKO,SAASoB,IAAmD,CAEjE,OADiBrD,EAAa,EACd,UAAU,KAAKkD,GAAKA,EAAE,SAAW,SAAS,CAC5D,CAKO,SAASI,GAAqBrB,EAAoBsB,EAA6B,CACpF,IAAMnD,EAAWJ,EAAa,EAExBiD,EAAW7C,EAAS,UAAU,KAAK8C,GAAKA,EAAE,aAAejB,CAAU,EACzE,GAAI,CAACgB,EAAU,OAAO,KAEjBA,EAAS,eAAe,SAASM,CAAI,IACxCN,EAAS,eAAe,KAAKM,CAAI,EACjCN,EAAS,eAAe,KAAK,CAACH,EAAGC,IAAMD,EAAIC,CAAC,GAI9C,IAAMS,EAAQX,GAAiBZ,CAAU,EACzC,QAAWI,KAAQmB,EAAO,CACxB,IAAMC,EAAWpB,EAAK,aAGtB,GAFIoB,IAAa,QACbR,EAAS,eAAe,SAASQ,CAAQ,GACzCpB,EAAK,SAAW,UAAW,SAO/B,GAH0BoB,IAAa,GACrCR,EAAS,eAAe,SAASQ,EAAW,CAAC,EAG7C,OAAAR,EAAS,YAAcQ,EACvBtD,GAAaC,CAAQ,EACdqD,CAEX,CAGA,OAAAR,EAAS,OAAS,YAClB9C,GAAaC,CAAQ,EACd,IACT,CASO,SAASsD,GAAgBC,EAAmB,KAAU,GAAK,IAAY,CAC5E,IAAMvD,EAAWJ,EAAa,EACxB4D,EAAS,KAAK,IAAI,EAAID,EAE5BvD,EAAS,MAAQA,EAAS,MAAM,OAAO+B,GACjCA,EAAE,SAAW,WAAaA,EAAE,SAAW,cAAsB,GAChD,IAAI,KAAKA,EAAE,SAAS,EAAE,QAAQ,EAC7ByB,CACnB,EAEDxD,EAAS,UAAYA,EAAS,UAAU,OAAO8C,GACzCA,EAAE,SAAW,UAAkB,GACd,IAAI,KAAKA,EAAE,SAAS,EAAE,QAAQ,EAC7BU,CACvB,EAEDzD,GAAaC,CAAQ,CACvB,CChdA,IAAMyD,GAAsB,EACtBC,GAAwB,IACxBC,GAAe,IAGfC,GAA+C,CAEnD,2BAA4B,CAAC,oBAAqB,cAAc,EAEhE,wBAAyB,CAAC,oBAAqB,0BAA0B,EAEzE,iBAAkB,CAAC,qBAAsB,uBAAuB,EAEhE,mBAAoB,CAAC,wBAAwB,EAE7C,qBAAsB,CAAC,iBAAkB,wBAAwB,CACnE,EAGMC,GAAuB,CAC3B,qBACA,iBACA,sCACA,yCACA,oBACA,6BACA,yBACA,kBACA,aACF,EAGMC,GAAgC,CACpC,yBACA,oBACA,qBACA,kBACA,oBACF,EASO,SAASC,GACdC,EACAC,EAAsBP,GACd,CAER,IAAMQ,EAAmBD,EAAc,KAAK,IAAI,EAAGD,EAAgB,CAAC,EAC9DG,EAAS,KAAK,OAAO,EAAI,GAAMD,EACrC,OAAO,KAAK,IAAIA,EAAmBC,EAAQR,EAAY,CACzD,CAKO,SAASS,GAAiBC,EAAwB,CACvD,QAAWC,KAAWT,GACpB,GAAIS,EAAQ,KAAKD,CAAK,EACpB,MAAO,GAGX,MAAO,EACT,CAKO,SAASE,GAAoBF,EAAwB,CAC1D,QAAWC,KAAWR,GACpB,GAAIQ,EAAQ,KAAKD,CAAK,EACpB,MAAO,GAGX,MAAO,EACT,CAKO,SAASG,GAAoBC,EAAeC,EAAwB,CAAC,EAAuB,CACjG,IAAMC,EAAef,GAAmBa,CAAK,EAC7C,GAAKE,GAGL,QAAWC,KAAOD,EAChB,GAAI,CAACD,EAAY,SAASE,CAAG,EAC3B,OAAOA,EAKb,CAKO,SAASC,GACdJ,EACAT,EACAK,EACAK,EAAwB,CAAC,EACzBI,EAAqBrB,GACN,CAIf,GAHAsB,EAAQ,gBAAiB,wBAAwBN,CAAK,aAAaT,CAAa,EAAE,EAG9EA,GAAiBc,EAAY,CAC/B,IAAME,EAAcR,GAAoBC,EAAOC,CAAW,EAC1D,MAAO,CACL,YAAa,GACb,WAAYV,EACZ,WAAAc,EACA,iBAAkBE,EAClB,OAAQ,gBAAgBF,CAAU,cAC/BE,EAAc,qBAAqBA,CAAW,YAAc,GACjE,CACF,CAGA,GAAI,CAACZ,GAAiBC,CAAK,EAAG,CAC5B,IAAMW,EAAcR,GAAoBC,EAAOC,CAAW,EAC1D,MAAO,CACL,YAAa,GACb,WAAYV,EACZ,WAAAc,EACA,iBAAkBE,EAClB,OAAQ,iCAAiCX,EAAM,MAAM,EAAG,GAAG,CAAC,EAC9D,CACF,CAGA,GAAIE,GAAoBF,CAAK,EAAG,CAC9B,IAAMW,EAAcR,GAAoBC,EAAOC,CAAW,EAC1D,GAAIM,EACF,MAAO,CACL,YAAa,GACb,WAAYhB,EACZ,WAAAc,EACA,iBAAkBE,EAClB,OAAQ,2CAA2CA,CAAW,EAChE,CAEJ,CAGA,IAAMC,EAAUlB,GAAsBC,CAAa,EACnD,MAAO,CACL,YAAa,GACb,WAAYA,EACZ,WAAAc,EACA,QAAAG,EACA,OAAQ,qBAAqBjB,EAAgB,CAAC,IAAIc,CAAU,WAAW,KAAK,MAAMG,EAAU,GAAI,CAAC,GACnG,CACF,CASO,SAASC,GACdT,EACAT,EACAmB,EACkB,CAClB,MAAO,CACL,MAAAV,EACA,OAAAU,EACA,cAAAnB,EACA,UAAW,IAAI,KAAK,EAAE,YAAY,CACpC,CACF,CAKO,SAASoB,GACdC,EACAC,EACAjB,EACkB,CAClB,IAAMkB,EAAc,IAAI,KAAK,EAAE,YAAY,EACrCC,EAAa,IAAI,KAAKD,CAAW,EAAE,QAAQ,EAAI,IAAI,KAAKF,EAAQ,SAAS,EAAE,QAAQ,EAEzF,MAAO,CACL,GAAGA,EACH,YAAAE,EACA,QAAAD,EACA,MAAAjB,EACA,WAAAmB,CACF,CACF,CAKO,SAASC,GAAsBC,EAIpC,CACA,GAAIA,EAAS,SAAW,EACtB,MAAO,CAAE,YAAa,EAAG,YAAa,EAAG,aAAc,CAAC,CAAE,EAI5D,IAAMC,EADaD,EAAS,OAAO,GAAK,EAAE,UAAY,SAAS,EAAE,OAChCA,EAAS,OAEpCE,EAAYF,EACf,OAAO,GAAK,EAAE,aAAe,MAAS,EACtC,IAAI,GAAK,EAAE,UAAW,EACnBG,EAAcD,EAAU,OAAS,EACnCA,EAAU,OAAO,CAAC,EAAGE,IAAM,EAAIA,EAAG,CAAC,EAAIF,EAAU,OACjD,EAGEG,EAAc,IAAI,IACxB,QAAWV,KAAWK,EACpB,GAAIL,EAAQ,MAAO,CAEjB,IAAMW,EAAaX,EAAQ,MAAM,MAAM,EAAG,EAAE,EAAE,YAAY,EAC1DU,EAAY,IAAIC,GAAaD,EAAY,IAAIC,CAAU,GAAK,GAAK,CAAC,CACpE,CAIF,IAAMC,EAAe,MAAM,KAAKF,EAAY,QAAQ,CAAC,EAClD,KAAK,CAAC,EAAGD,IAAMA,EAAE,CAAC,EAAI,EAAE,CAAC,CAAC,EAC1B,MAAM,EAAG,CAAC,EACV,IAAI,CAAC,CAACzB,CAAK,IAAMA,CAAK,EAEzB,MAAO,CAAE,YAAAsB,EAAa,YAAAE,EAAa,aAAAI,CAAa,CAClD,CASO,SAASC,GACdzB,EACA0B,EACiB,CACjB,MAAO,CACL,GAAG1B,EACH,OAAQ,WACR,WAAY0B,EAAS,UACvB,CACF,CAKO,SAASC,GAAoBD,EAAyB1B,EAAuB,CAClF,GAAI0B,EAAS,YACX,MAAO;AAAA;AAAA,UAED1B,CAAK,uBAAuB,KAAK,OAAO0B,EAAS,SAAW,GAAK,GAAI,CAAC;AAAA;AAAA,eAEjEA,EAAS,WAAa,CAAC,OAAOA,EAAS,UAAU;AAAA,cAClDA,EAAS,MAAM,GAG3B,IAAIE,EAAU;AAAA;AAAA,UAEN5B,CAAK,UAAU0B,EAAS,YAAcA,EAAS,WAAa,oBAAsB,mCAAmC;AAAA;AAAA,cAEjHA,EAAS,MAAM,GAE3B,OAAIA,EAAS,mBACXE,GAAW;AAAA;AAAA;AAAA;AAAA,mBAIIF,EAAS,gBAAgB;AAAA;AAAA;AAAA,iCAGXA,EAAS,gBAAgB;AAAA,SAIjDE,CACT,CChTA,OAAS,cAAAC,GAAY,gBAAAC,GAAc,iBAAAC,GAAe,aAAAC,OAAiB,UACnE,OAAS,cAAAC,OAAkB,cAc3B,IAAMC,GAAc,IAGdC,GAA6B,EAG7BC,GAAiB,GAGjBC,GAAkB,EAGlBC,GAAe,GAMrB,SAASC,IAA6B,CACpC,MAAO,GAAGC,EAAc,CAAC,yCAC3B,CAEA,SAASC,IAAkB,CACzB,IAAMC,EAAM,GAAGF,EAAc,CAAC,oBAC9B,GAAI,CAACG,GAAWD,CAAG,EACjB,GAAI,CACFE,GAAUF,EAAK,CAAE,UAAW,EAAK,CAAC,CACpC,MAAQ,CAER,CAEJ,CAKO,SAASG,IAAuC,CACrD,IAAMC,EAAOP,GAAmB,EAEhC,GAAII,GAAWG,CAAI,EACjB,GAAI,CACF,OAAO,KAAK,MAAMC,GAAaD,EAAM,MAAM,CAAC,CAC9C,MAAQ,CACNE,EAAQ,qBAAsB,iDAAiD,CACjF,CAGF,MAAO,CACL,cAAe,QACf,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,QAAS,CAAC,EACV,YAAa,CAAC,EACd,MAAO,CACL,gBAAiB,EACjB,YAAa,EACb,cAAe,EACf,UAAW,CAAC,CACd,CACF,CACF,CAKO,SAASC,GAAoBC,EAA6B,CAC/DT,GAAU,EACV,IAAMK,EAAOP,GAAmB,EAEhCW,EAAK,UAAY,IAAI,KAAK,EAAE,YAAY,EAExC,GAAI,CACFC,GAAcL,EAAM,KAAK,UAAUI,EAAM,KAAM,CAAC,CAAC,EACjDF,EAAQ,qBAAsB,wBAAwB,CACxD,OAASI,EAAK,CACZJ,EAAQ,qBAAsB,oCAAoCI,CAAG,EAAE,CACzE,CACF,CASO,SAASC,GAAWC,EAAwB,CACjD,OAAOC,GAAW,QAAQ,EAAE,OAAOD,EAAO,YAAY,EAAE,KAAK,CAAC,EAAE,OAAO,KAAK,EAAE,MAAM,EAAG,EAAE,CAC3F,CAKO,SAASE,GACdF,EACAG,EACAC,EACAC,EACAC,EACAC,EACAC,EACM,CACN,IAAMZ,EAAOL,GAAoB,EAE3BkB,EAA4B,CAChC,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,UAAWC,EAAa,EACxB,MAAAP,EACA,WAAYJ,GAAWC,CAAM,EAC7B,gBAAAI,EACA,mBAAoBC,EACpB,QAAAC,EACA,WAAAC,EACA,SAAAC,CACF,EAEAZ,EAAK,QAAQ,KAAKa,CAAM,EAGpBb,EAAK,QAAQ,OAAShB,KACxBgB,EAAK,QAAUA,EAAK,QAAQ,MAAM,CAAChB,EAAW,GAIhD+B,GAAkBf,EAAMa,CAAM,EAG9BG,GAAYhB,CAAI,EAEhBD,GAAoBC,CAAI,EAExBF,EACE,qBACA,qBAAqBS,CAAK,OAAOG,CAAO,WAAWD,CAAU,GAC/D,CACF,CASA,SAASM,GAAkBf,EAAuBa,EAAiC,CACjF,IAAMI,EAAaJ,EAAO,UAAY,UAChCK,EAAaL,EAAO,UAAY,WAAaA,EAAO,UAAY,WAEtE,GAAI,CAACI,GAAc,CAACC,EAElB,OAGF,IAAMC,EAAkBF,EAAa9B,GAAkB,CAACA,GAExD,QAAWiC,KAAWP,EAAO,gBAAiB,CAC5C,IAAMQ,EAAWrB,EAAK,YAAY,KAChC,GAAK,EAAE,UAAYoB,GAAW,EAAE,QAAUP,EAAO,KACnD,EAEIQ,GAEFA,EAAS,WAAa,KAAK,IACzB,CAACnC,GACD,KAAK,IAAIA,GAAgBmC,EAAS,WAAaF,CAAe,CAChE,EACAE,EAAS,cACTA,EAAS,YAAc,IAAI,KAAK,EAAE,YAAY,GAG9CrB,EAAK,YAAY,KAAK,CACpB,QAAAoB,EACA,MAAOP,EAAO,MACd,WAAYM,EACZ,YAAa,EACb,YAAa,IAAI,KAAK,EAAE,YAAY,CACtC,CAAC,CAEL,CACF,CAKO,SAASG,GAAWtB,EAA6B,CACtD,IAAMuB,EAAM,KAAK,IAAI,EACfC,EAAQ,KAAU,GAAK,IAE7B,QAAWC,KAAOzB,EAAK,YAAa,CAClC,IAAM0B,EAAMH,EAAM,IAAI,KAAKE,EAAI,WAAW,EAAE,QAAQ,EACpC,KAAK,MAAMC,EAAMF,CAAK,EAExB,IAEZC,EAAI,WAAa,KAAK,MAAMA,EAAI,WAAarC,EAAY,EAGrD,KAAK,IAAIqC,EAAI,UAAU,EAAI,IAC7BA,EAAI,WAAa,GAGvB,CAGAzB,EAAK,YAAcA,EAAK,YAAY,OAAO2B,GAAKA,EAAE,aAAe,CAAC,CACpE,CASA,SAASX,GAAYhB,EAA6B,CAChD,IAAM4B,EAAU5B,EAAK,QACrB,GAAI4B,EAAQ,SAAW,EAAG,OAG1B5B,EAAK,MAAM,gBAAkB4B,EAAQ,OAGrC,IAAMC,EAAaD,EAAQ,OAAO,GAAK,EAAE,UAAY,SAAS,EAAE,OAChE5B,EAAK,MAAM,YAAc6B,EAAaD,EAAQ,OAG9C,IAAME,EAAUF,EAAQ,OAAO,CAACG,EAAKC,IAAMD,EAAMC,EAAE,mBAAoB,CAAC,EAAIJ,EAAQ,OACpF5B,EAAK,MAAM,cAAgB,KAAK,MAAM8B,CAAO,EAG7C,IAAMG,EAAa,IAAI,IACvB,QAAWpB,KAAUe,EAAS,CAC5B,IAAMM,EAAOD,EAAW,IAAIpB,EAAO,KAAK,GAAK,CAAE,MAAO,EAAG,QAAS,CAAE,EACpEqB,EAAK,QACDrB,EAAO,UAAY,WAAWqB,EAAK,UACvCD,EAAW,IAAIpB,EAAO,MAAOqB,CAAI,CACnC,CAEAlC,EAAK,MAAM,UAAY,MAAM,KAAKiC,EAAW,QAAQ,CAAC,EACnD,IAAI,CAAC,CAAC1B,EAAO2B,CAAI,KAAO,CACvB,MAAA3B,EACA,MAAO2B,EAAK,MACZ,YAAaA,EAAK,QAAUA,EAAK,KACnC,EAAE,EACD,KAAK,CAACP,EAAGQ,IAAMA,EAAE,MAAQR,EAAE,KAAK,EAChC,MAAM,EAAG,EAAE,CAChB,CASO,SAASS,IAA0C,CAIxD,OAHazC,GAAoB,EAGrB,YAAY,OAAOgC,GAAKA,EAAE,aAAe1C,EAA0B,CACjF,CAKO,SAASoD,GAAoB9B,EAA8B,CAEhE,IAAM+B,EADO3C,GAAoB,EACP,QAAQ,OAAOqC,GAAKA,EAAE,QAAUzB,CAAK,EAE/D,OAAI+B,EAAa,OAASrD,GACjB,KAGUqD,EAAa,OAAON,GAAKA,EAAE,UAAY,SAAS,EAAE,OACjDM,EAAa,MACnC,CAKO,SAASC,IAAgD,CAC9D,OAAO5C,GAAoB,EAAE,KAC/B,CAKO,SAAS6C,IAAqC,CAEnD,OADa7C,GAAoB,EACrB,QAAQ,QAAUV,EAChC,CChSO,IAAMwD,GAAkC,CAC7C,CACE,KAAM,mBACN,KAAM,4BACN,YAAa,oDACb,SAAU,CACR,kBACA,mBACA,qBACA,kBACA,eACF,EACA,MAAO,CACL,CACE,MAAO,sBACP,YAAa,kDACb,UAAW,CAAC,EACZ,OAAQ,CAAC,iBAAiB,EAC1B,gBAAiB,GACnB,EACA,CACE,MAAO,gBACP,YAAa,wCACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,eAAe,EACxB,gBAAiB,IACnB,EACA,CACE,MAAO,qBACP,YAAa,2CACb,UAAW,CAAC,EAAG,CAAC,EAChB,OAAQ,CAAC,kBAAkB,EAC3B,gBAAiB,GACnB,EACA,CACE,MAAO,yBACP,YAAa,wCACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,gBAAgB,EACzB,gBAAiB,IACnB,EACA,CACE,MAAO,wBACP,YAAa,sCACb,UAAW,CAAC,EAAG,CAAC,EAChB,OAAQ,CAAC,eAAe,EACxB,gBAAiB,GACnB,EACA,CACE,MAAO,0BACP,YAAa,oCACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,cAAc,EACvB,gBAAiB,IACnB,CACF,EACA,qBAAsB,KACxB,EACA,CACE,KAAM,qBACN,KAAM,8BACN,YAAa,6CACb,SAAU,CACR,qBACA,kBACA,uBACA,sBACA,sBACF,EACA,MAAO,CACL,CACE,MAAO,2BACP,YAAa,iCACb,UAAW,CAAC,EACZ,OAAQ,CAAC,uBAAwB,0BAA0B,EAC3D,gBAAiB,GACnB,EACA,CACE,MAAO,wBACP,YAAa,gCACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,oCAAqC,qBAAqB,EACnE,gBAAiB,IACnB,EACA,CACE,MAAO,iBACP,YAAa,oCACb,UAAW,CAAC,EAAG,CAAC,EAChB,OAAQ,CAAC,sBAAuB,aAAa,EAC7C,gBAAiB,GACnB,EACA,CACE,MAAO,mBACP,YAAa,4BACb,UAAW,CAAC,EAAG,CAAC,EAChB,OAAQ,CAAC,eAAgB,eAAe,EACxC,gBAAiB,IACnB,CACF,EACA,qBAAsB,GACxB,EACA,CACE,KAAM,iBACN,KAAM,0BACN,YAAa,yCACb,SAAU,CACR,UACA,UACA,iBACA,gBACA,iBACA,oBACF,EACA,MAAO,CACL,CACE,MAAO,qBACP,YAAa,sCACb,UAAW,CAAC,EACZ,OAAQ,CAAC,kBAAmB,mBAAmB,EAC/C,gBAAiB,IACnB,EACA,CACE,MAAO,iBACP,YAAa,yCACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,mBAAoB,eAAe,EAC5C,gBAAiB,GACnB,EACA,CACE,MAAO,yBACP,YAAa,qCACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,aAAc,eAAe,EACtC,gBAAiB,IACnB,EACA,CACE,MAAO,iBACP,YAAa,oCACb,UAAW,CAAC,EAAG,CAAC,EAChB,OAAQ,CAAC,cAAe,wBAAwB,EAChD,gBAAiB,IACnB,CACF,EACA,qBAAsB,IACxB,EACA,CACE,KAAM,iBACN,KAAM,0BACN,YAAa,yCACb,SAAU,CACR,iBACA,kBACA,qBACA,qBACF,EACA,MAAO,CACL,CACE,MAAO,mBACP,YAAa,wCACb,UAAW,CAAC,EACZ,OAAQ,CAAC,eAAgB,kBAAkB,EAC3C,gBAAiB,GACnB,EACA,CACE,MAAO,yBACP,YAAa,iCACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,kBAAkB,EAC3B,gBAAiB,GACnB,EACA,CACE,MAAO,oBACP,YAAa,sCACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,wBAAwB,EACjC,gBAAiB,IACnB,CACF,EACA,qBAAsB,IACxB,EACA,CACE,KAAM,sBACN,KAAM,oCACN,YAAa,sCACb,SAAU,CACR,sBACA,qBACA,eACA,eACF,EACA,MAAO,CACL,CACE,MAAO,wBACP,YAAa,+BACb,UAAW,CAAC,EACZ,OAAQ,CAAC,oCAAqC,kBAAkB,EAChE,gBAAiB,GACnB,EACA,CACE,MAAO,uBACP,YAAa,2BACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,kBAAmB,uBAAuB,EACnD,gBAAiB,GACnB,EACA,CACE,MAAO,2BACP,YAAa,6BACb,UAAW,CAAC,CAAC,EACb,OAAQ,CAAC,eAAgB,kBAAkB,EAC3C,gBAAiB,IACnB,CACF,EACA,qBAAsB,IACxB,CACF,EASO,SAASC,GAAeC,EAA2C,CACxE,IAAMC,EAAcD,EAAO,YAAY,EAEvC,QAAWE,KAAYJ,GACrB,QAAWK,KAAWD,EAAS,SAC7B,GAAID,EAAY,SAASE,CAAO,EAC9B,OAAAC,EACE,0BACA,sBAAsBF,EAAS,IAAI,eAAeC,CAAO,IAC3D,EACOD,EAKb,OAAO,IACT,CAKO,SAASG,GAAkBC,EAA+C,CAC/E,OAAOR,GAAU,KAAKS,GAAKA,EAAE,OAASD,CAAI,GAAK,IACjD,CASO,SAASE,GACdN,EAIA,CACA,IAAMO,EAAa,YAAY,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,GAG7EC,EAAiC,CAAC,EAClCC,EAAkC,CAAC,EAEzC,QAASC,EAAI,EAAGA,EAAIV,EAAS,MAAM,OAAQU,IAAK,CAC9C,IAAMC,EAAOX,EAAS,MAAMU,CAAC,EACvBE,EAAS,QAAQL,CAAU,IAAIG,CAAC,GACtCD,EAAQC,CAAC,EAAIE,EAEb,IAAMC,EAAyB,CAC7B,OAAQ,WACR,gBAAiBF,EAAK,MACtB,WAAAJ,EACA,aAAcG,EACd,cAAeC,EAAK,MACtB,EAGMG,EAAYH,EAAK,UAAU,IAAII,GAAON,EAAQM,CAAG,CAAC,EAAE,OAAO,OAAO,EAExEP,EAAM,KAAK,CACT,QAAS,IAAIR,EAAS,IAAI,UAAUU,EAAI,CAAC,KAAKC,EAAK,WAAW,GAC9D,YAAa,kBAAkBA,EAAK,KAAK;AAAA;AAAA,EAAOA,EAAK,WAAW;AAAA;AAAA,oBAAyBA,EAAK,eAAe,GAC7G,WAAY,WAAWA,EAAK,KAAK,GACjC,SAAAE,EACA,UAAWC,EAAU,OAAS,EAAIA,EAAY,MAChD,CAAC,CACH,CAYA,MAAO,CAAE,UAV4B,CACnC,WAAAP,EACA,KAAMP,EAAS,KACf,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,QAAAS,EACA,YAAa,EACb,eAAgB,CAAC,EACjB,OAAQ,SACV,EAEoB,MAAAD,CAAM,CAC5B,CAKO,SAASQ,GACdC,EACAT,EACM,CAENU,GAAiBD,CAAS,EAG1B,QAASP,EAAI,EAAGA,EAAIF,EAAM,OAAQE,IAAK,CACrC,IAAMS,EAAOX,EAAME,CAAC,EACdE,EAASK,EAAU,QAAQP,CAAC,EAE9BE,GAAUO,EAAK,SAAS,iBAC1BC,GACER,EACAO,EAAK,SAAS,gBACdA,EAAK,SAAS,oBAAsB,IACpCF,EAAU,WACVP,CACF,CAEJ,CAEAR,EACE,0BACA,uBAAuBe,EAAU,UAAU,SAAST,EAAM,MAAM,QAClE,CACF,CASO,SAASa,GACdrB,EACAiB,EACAT,EACQ,CACR,IAAIc,EAAK,mCAA4BtB,EAAS,IAAI;AAAA;AAAA,EAElDA,EAAS,WAAW;AAAA;AAAA,qBAEDiB,EAAU,UAAU;AAAA,+BACVjB,EAAS,oBAAoB;AAAA;AAAA;AAAA;AAAA,EAM1D,QAASU,EAAI,EAAGA,EAAIV,EAAS,MAAM,OAAQU,IAAK,CAC9C,IAAMC,EAAOX,EAAS,MAAMU,CAAC,EACvBa,EAAOZ,EAAK,UAAU,OAAS,EACjC,kBAAkBA,EAAK,UAAU,IAAIa,GAAKA,EAAI,CAAC,EAAE,KAAK,IAAI,CAAC,IAC3D,2BAEJF,GAAM,KAAKZ,EAAI,CAAC,KAAKC,EAAK,KAAK,KAAKY,CAAI;AAAA,KACvCZ,EAAK,WAAW;AAAA,aACRA,EAAK,QAAQ,KAAK,IAAI,GAAK,MAAM;AAAA;AAAA,CAG5C,CAEAW,GAAM;AAAA;AAAA;AAAA;AAAA,EAMN,QAASZ,EAAI,EAAGA,EAAIF,EAAM,OAAQE,IAAK,CACrC,IAAMS,EAAOX,EAAME,CAAC,EACpBY,GAAM,UAAUZ,EAAI,CAAC;AAAA;AAAA;AAAA,cAGXS,EAAK,OAAO;AAAA,iBACTA,EAAK,UAAU;AAAA,EAC9BA,EAAK,UAAY,gBAAgB,KAAK,UAAUA,EAAK,SAAS,CAAC,GAAK,EAAE;AAAA;AAAA;AAAA,CAItE,CAEA,OAAAG,GAAM;AAAA;AAAA;AAAA;AAAA;AAAA,iCAKyBtB,EAAS,MAAM,CAAC,EAAE,KAAK;AAAA;AAAA;AAAA,wFAK/CsB,CACT,CCtaA,OAAS,gBAAAG,GAAc,iBAAAC,GAAe,cAAAC,GAAY,aAAAC,OAAiB,UACnE,OAAS,cAAAC,OAAkB,cAyFpB,IAAMC,EAAS,CACpB,MAAO,UACP,KAAM,UACN,IAAK,UACL,KAAM,WACN,MAAO,WACP,OAAQ,WACR,IAAK,WACL,KAAM,WACN,QAAS,WACT,MAAO,UACT,EASO,SAASC,GAAWC,EAAyB,CAClD,OAAOC,GAAW,QAAQ,EAAE,OAAOD,CAAO,EAAE,OAAO,KAAK,CAC1D,CAMO,SAASE,GAAuBC,EAAsB,CAC3D,IAAMC,EAAYD,EAAK,YAAY,EAE7BE,EAAuC,CAC3C,CAAC,eAAgB,oEAAoE,EACrF,CAAC,WAAY,qEAAqE,EAClF,CAAC,cAAe,sEAAsE,EACtF,CAAC,UAAW,0DAA0D,EACtE,CAAC,SAAU,uEAAuE,EAClF,CAAC,MAAO,oDAAoD,EAC5D,CAAC,WAAY,mEAAmE,EAChF,CAAC,WAAY,wDAAwD,EACrE,CAAC,KAAM,oDAAoD,EAC3D,CAAC,QAAS,kDAAkD,EAC5D,CAAC,SAAU,yCAAyC,EACpD,CAAC,SAAU,2CAA2C,EACtD,CAAC,gBAAiB,uCAAuC,EACzD,CAAC,SAAU,wCAAwC,CACrD,EAEA,OAAW,CAACC,EAAUC,CAAO,IAAKF,EAChC,GAAIE,EAAQ,KAAKH,CAAS,EACxB,OAAOE,EAIX,MAAO,SACT,CAKO,SAASE,GAAaL,EAAcM,EAA8D,CACvG,IAAML,EAAYD,EAAK,YAAY,EAG7BO,EAAe,CACnB,+EACA,4DACA,yCACA,WACA,WACF,EAEA,QAAWH,KAAWG,EACpB,GAAIH,EAAQ,KAAKH,CAAS,GAAKG,EAAQ,KAAKJ,CAAI,EAC9C,MAAO,OAKX,OAAIM,IAAgB,SAAWA,IAAgB,WACtC,SAILA,IAAgB,SAAWA,IAAgB,aACrB,4CACJ,KAAKL,CAAS,EACzB,MAEF,SAGF,KACT,CAKO,SAASO,GAAiBR,EAAkC,CAEjE,OADcA,EAAK,MAAM,uBAAuB,IACjC,CAAC,CAClB,CAKO,SAASS,GAAmBC,EAAiBC,EAAeR,EAA0B,CAC3F,IAAMS,EAAOT,EAAS,YAAY,EAAE,QAAQ,OAAQ,GAAG,EACvD,MAAO,GAAGO,CAAO,IAAIE,CAAI,IAAID,CAAK,EACpC,CASO,SAASE,GAAehB,EAAkC,CAC/D,IAAMiB,EAA+B,CAAC,EAChCC,EAAQlB,EAAQ,MAAM;AAAA,CAAI,EAG1BmB,EAAe,gDAEfC,EAAe,yDAEjBC,EAA0C,KAC1CC,EAA0C,KAE9C,QAAWC,KAAQL,EAAO,CAExB,IAAMM,EAAeD,EAAK,MAAMJ,CAAY,EAC5C,GAAIK,EAAc,CACZH,GACFJ,EAAS,KAAKI,CAAc,EAE9BA,EAAiB,CACf,QAASG,EAAa,CAAC,EACvB,KAAMA,EAAa,CAAC,EACpB,SAAU,CAAC,CACb,EACAF,EAAiB,KACjB,QACF,CAGA,IAAMG,EAAeF,EAAK,MAAMH,CAAY,EAC5C,GAAIK,GAAgBJ,EAAgB,CAClCC,EAAiB,CACf,KAAMG,EAAa,CAAC,EACpB,QAAS,CAAC,CACZ,EACAJ,EAAe,SAAS,KAAKC,CAAc,EAC3C,QACF,CAGA,GAAIC,EAAK,WAAW,IAAI,GAAKD,GAAkBD,EAAgB,CAC7D,IAAMlB,EAAOoB,EAAK,MAAM,CAAC,EAAE,KAAK,EAC1BG,EAAYf,GAAiBR,CAAI,EAGnCuB,GAAa,CAACL,EAAe,YAC/BA,EAAe,UAAYK,GAG7BJ,EAAe,QAAQ,KAAK,CAC1B,KAAAnB,EACA,SAAUD,GAAuBC,CAAI,EACrC,OAAQK,GAAaL,EAAMmB,EAAe,IAAI,EAC9C,YAAaI,CACf,CAAC,CACH,CACF,CAGA,OAAIL,GACFJ,EAAS,KAAKI,CAAc,EAGvB,CACL,YAAa,IAAI,KAAK,EAAE,YAAY,EACpC,cAAetB,GAAWC,CAAO,EAAE,MAAM,EAAG,EAAE,EAC9C,SAAAiB,CACF,CACF,CAKO,SAASU,GAAqBC,EAAqC,CACxE,IAAMC,EAAwB,CAAC,EAE/B,QAAWhB,KAAWe,EAAO,SAAU,CACrC,IAAIE,EAAa,EAEjB,QAAWC,KAAWlB,EAAQ,SAAU,CAEtC,IAAMmB,EAA8D,CAClE,MAAO,cACP,QAAS,cACT,MAAO,cACP,WAAY,aACZ,QAAS,aACT,SAAU,aACZ,EAEA,QAAWC,KAASF,EAAQ,QAC1BD,IACAD,EAAU,KAAK,CACb,GAAIjB,GAAmBC,EAAQ,QAASiB,EAAYG,EAAM,QAAQ,EAClE,KAAMpB,EAAQ,KACd,QAASoB,EAAM,KAAK,MAAM,EAAG,GAAG,GAAKA,EAAM,KAAK,OAAS,IAAM,MAAQ,IACvE,UAAWA,EAAM,KACjB,UAAWpB,EAAQ,WAAaoB,EAAM,YACtC,cAAepB,EAAQ,QACvB,SAAUoB,EAAM,SAChB,OAAQA,EAAM,OACd,OAAQD,EAAUD,EAAQ,IAAI,EAC9B,OAAQ,WACV,CAAC,CAEL,CACF,CAEA,OAAOF,CACT,CASO,SAASK,IAAmC,CAEjD,IAAMC,EAAc,GADDC,EAAc,CACA,mDAEjC,GAAI,CAACC,GAAWF,CAAW,EACzB,MAAO,CAAC,EAGV,GAAI,CACF,IAAMnC,EAAU,KAAK,MAAMsC,GAAaH,EAAa,OAAO,CAAC,EACvDN,EAAwB,CAAC,EAG/B,GAAI,MAAM,QAAQ7B,CAAO,EACvB,QAAWuC,KAAQvC,EACjB6B,EAAU,KAAK,CACb,GAAIU,EAAK,IAAM,WAAW,KAAK,IAAI,CAAC,GACpC,KAAMA,EAAK,MAAQ,IAAI,KAAK,EAAE,YAAY,EAAE,MAAM,EAAG,EAAE,EACvD,QAASA,EAAK,SAAWA,EAAK,UAAY,GAC1C,UAAWA,EAAK,WAAaA,EAAK,QAClC,UAAWA,EAAK,YAAcA,EAAK,UACnC,cAAeA,EAAK,gBAAkBA,EAAK,cAC3C,SAAUA,EAAK,UAAYrC,GAAuBqC,EAAK,SAAW,EAAE,EACpE,OAAQA,EAAK,QAAU,SACvB,OAAQA,EAAK,QAAU,cACvB,OAAQ,UACR,aAAcA,EAAK,eAAiBA,EAAK,aACzC,SAAUA,EAAK,QACjB,CAAC,EAIL,OAAOV,CACT,MAAQ,CACN,MAAO,CAAC,CACV,CACF,CAKO,SAASW,IAAwC,CAEtD,IAAMC,EAAY,GADCL,EAAc,CACF,0CAE/B,GAAI,CAACC,GAAWI,CAAS,EACvB,MAAO,CAAC,EAGV,GAAI,CACF,IAAMzC,EAAU,KAAK,MAAMsC,GAAaG,EAAW,OAAO,CAAC,EACrDZ,EAAwB,CAAC,EAGzBa,EAAQ1C,EAAQ,WAAaA,EACnC,GAAI,MAAM,QAAQ0C,CAAK,EACrB,QAAWH,KAAQG,EACjBb,EAAU,KAAK,CACb,GAAIU,EAAK,IAAM,SAAS,KAAK,IAAI,CAAC,GAClC,KAAMA,EAAK,WAAW,MAAM,EAAG,EAAE,GAAKA,EAAK,MAAQ,IAAI,KAAK,EAAE,YAAY,EAAE,MAAM,EAAG,EAAE,EACvF,QAASA,EAAK,UAAYA,EAAK,SAAW,GAC1C,UAAWA,EAAK,WAAaA,EAAK,QAClC,SAAUA,EAAK,UAAYrC,GAAuBqC,EAAK,UAAY,EAAE,EACrE,OAAQA,EAAK,QAAU,SACvB,OAAQ,cACR,OAAQ,cACV,CAAC,EAIL,OAAOV,CACT,MAAQ,CACN,MAAO,CAAC,CACV,CACF,CAKO,SAASc,IAAqC,CACnD,IAAMC,EAAaC,EAAc,EAC3BC,EAAY,GAAGV,EAAc,CAAC,6CAC9BW,EAAgB,GAAGH,CAAU,gBAEnC,GAAI,CAACP,GAAWU,CAAa,EAC3B,MAAO,CAAC,EAGV,GAAI,CACF,IAAMC,EAAmBV,GAAaS,EAAe,OAAO,EACtDE,EAAclD,GAAWiD,CAAgB,EAAE,MAAM,EAAG,EAAE,EAG5D,GAAIX,GAAWS,CAAS,EAAG,CACzB,IAAMI,EAAS,KAAK,MAAMZ,GAAaQ,EAAW,OAAO,CAAC,EAC1D,GAAII,EAAO,gBAAkBD,EAC3B,OAAOC,EAAO,WAAa,CAAC,CAEhC,CAGA,IAAMtB,EAASZ,GAAegC,CAAgB,EACxCnB,EAAYF,GAAqBC,CAAM,EAGvCuB,EAAW,GAAGf,EAAc,CAAC,oBACnC,OAAKC,GAAWc,CAAQ,GACtBC,GAAUD,EAAU,CAAE,UAAW,EAAK,CAAC,EAGzCE,GACEP,EACA,KAAK,UAAU,CAAE,GAAGlB,EAAQ,UAAAC,CAAU,EAAG,KAAM,CAAC,CAClD,EAEOA,CACT,MAAQ,CACN,MAAO,CAAC,CACV,CACF,CAKO,SAASyB,GAAgBzB,EAAmC,CACjE,IAAM0B,EAAO,IAAI,IAEjB,QAAWC,KAAK3B,GAEV,CAAC0B,EAAK,IAAIC,EAAE,EAAE,GAAKA,EAAE,SAAW,cAClCD,EAAK,IAAIC,EAAE,GAAIA,CAAC,EAIpB,OAAO,MAAM,KAAKD,EAAK,OAAO,CAAC,CACjC,CAKA,eAAsBE,IAAmD,CACvE,IAAM5B,EAAwB,CAAC,EACzB6B,EAAkC,CAAC,EAGnCC,EAAmBzB,GAAqB,EAC9CL,EAAU,KAAK,GAAG8B,CAAgB,EAClCD,EAAQ,QAAUC,EAAiB,OAGnC,IAAMC,EAAqBjB,GAAuB,EAClDd,EAAU,KAAK,GAAG+B,CAAkB,EACpCF,EAAQ,UAAYE,EAAmB,OAGvC,IAAMC,EAAiBrB,GAA0B,EACjDX,EAAU,KAAK,GAAGgC,CAAc,EAChCH,EAAQ,aAAeG,EAAe,OAItC,IAAMC,EADkBR,GAAgBzB,CAAS,EACT,KACtC,CAAC,EAAGkC,IAAM,IAAI,KAAKA,EAAE,IAAI,EAAE,QAAQ,EAAI,IAAI,KAAK,EAAE,IAAI,EAAE,QAAQ,CAClE,EAEA,MAAO,CACL,SAAU,CACR,eAAgBD,EAAgB,OAChC,QAAAJ,EACA,eAAgB,IAAI,KAAK,EAAE,YAAY,CACzC,EACA,UAAWI,CACb,CACF,CASO,SAASE,GACdnC,EACAoC,EAAkB,aACU,CAC5B,IAAMC,EAAsC,CAAC,EAE7C,QAAWV,KAAK3B,EAAW,CACzB,IAAIsC,EAEJ,OAAQF,EAAS,CACf,IAAK,aACHE,EAAMX,EAAE,WAAa,UACrB,MACF,IAAK,WACHW,EAAMX,EAAE,SACR,MACF,IAAK,QACHW,EAAMX,EAAE,KAAK,MAAM,EAAG,CAAC,EACvB,MACF,IAAK,iBACHW,EAAMX,EAAE,eAAiB,UACzB,MACF,QACEW,EAAMX,EAAE,WAAa,SACzB,CAEKU,EAAQC,CAAG,IACdD,EAAQC,CAAG,EAAI,CAAC,GAElBD,EAAQC,CAAG,EAAE,KAAKX,CAAC,CACrB,CAEA,OAAOU,CACT,CAKO,SAASE,GAAYvC,EAAuBwC,EAAgB,GAAY,CAC7E,IAAMC,EAAS,GAAGxE,EAAO,IAAI;AAAA;AAAA;AAAA,ofAGsDA,EAAO,KAAK,GAEzFyE,EAAO1C,EAAU,MAAM,EAAGwC,CAAK,EAAE,IAAKb,GAAM,CAChD,IAAMgB,EAAOhB,EAAE,KAAK,MAAM,EAAG,EAAE,EAAE,OAAO,EAAE,EACpCiB,GAASjB,EAAE,WAAa,KAAK,OAAO,CAAC,EACrCkB,EAAUlB,EAAE,QAAQ,MAAM,EAAG,EAAE,EAAE,OAAO,EAAE,EAC1ClD,EAAWkD,EAAE,SAAS,MAAM,EAAG,EAAE,EAAE,OAAO,EAAE,EAElD,MAAO,UAAKgB,CAAI,WAAMC,CAAK,WAAMC,CAAO,WAAMpE,CAAQ,SACxD,CAAC,EAEKqE,EAAS,GAAG7E,EAAO,GAAG,qfAAsFA,EAAO,KAAK,GAExH8E,EAAY/C,EAAU,OAASwC,EAC/BQ,EACJD,EAAY,EAAI;AAAA,EAAK9E,EAAO,GAAG,WAAW8E,CAAS,kBAAkB9E,EAAO,KAAK,GAAK,GAExF,MAAO,GAAGwE,CAAM;AAAA,EAAKC,EAAK,KAAK;AAAA,CAAI,CAAC;AAAA,EAAKI,CAAM,GAAGE,CAAa,EACjE,CAKO,SAASC,GACdjD,EACAoC,EAAkB,aACV,CACR,IAAMC,EAAUF,GAAenC,EAAWoC,CAAO,EAE7Cc,EAAS;AAAA,EAAKjF,EAAO,IAAI,4BAA4BA,EAAO,KAAK;AAAA,EACrEiF,GAAU,SAAI,OAAO,EAAE,EAAI;AAAA;AAAA,EAG3B,IAAMC,EAAe,OAAO,QAAQd,CAAO,EAAE,KAAK,CAACe,EAAGlB,IAAM,CAC1D,IAAMmB,EAAQD,EAAE,CAAC,EAAE,CAAC,GAAG,MAAQ,GAE/B,OADclB,EAAE,CAAC,EAAE,CAAC,GAAG,MAAQ,IAClB,cAAcmB,CAAK,CAClC,CAAC,EAED,OAAW,CAACC,EAAOzC,CAAK,IAAKsC,EAAc,CACzC,IAAMI,EAAQnB,IAAY,aAAe,MAAMkB,CAAK,GAAKA,EACzDJ,GAAU,GAAGjF,EAAO,IAAI,GAAGsF,CAAK,GAAGtF,EAAO,KAAK;AAAA,EAE/C,QAAW0D,KAAKd,EAAM,MAAM,EAAG,CAAC,EAAG,CACjC,IAAM2C,EAAU7B,EAAE,KAAK,MAAM,EAAG,EAAE,EAC5B8B,EAAa9B,EAAE,QAAQ,MAAM,EAAG,EAAE,EAClC+B,EACJ/B,EAAE,SAAW,OAAS1D,EAAO,IAAM0D,EAAE,SAAW,SAAW1D,EAAO,OAASA,EAAO,IAEpFiF,GAAU,wBAASjF,EAAO,GAAG,GAAGuF,CAAO,GAAGvF,EAAO,KAAK,iBAAOwF,CAAU;AAAA,EACvEP,GAAU,cAASQ,CAAW,GAAG/B,EAAE,OAAO,YAAY,CAAC,GAAG1D,EAAO,KAAK,WAAM0D,EAAE,QAAQ;AAAA,CACxF,CAEId,EAAM,OAAS,IACjBqC,GAAU,wBAASjF,EAAO,GAAG,WAAW4C,EAAM,OAAS,CAAC,QAAQ5C,EAAO,KAAK;AAAA,GAE9EiF,GAAU;AAAA,CACZ,CAEA,OAAOA,CACT,CAKO,SAASS,GAAYC,EAAyC,CACnE,GAAM,CAAE,SAAAC,EAAU,UAAA7D,CAAU,EAAI4D,EAG1BE,EAAqC,CAAC,EACtCC,EAAsC,CAAC,EACvCC,EAAW,CAAE,KAAM,EAAG,OAAQ,EAAG,IAAK,CAAE,EACxCC,EAAmC,CAAC,EAE1C,QAAWtC,KAAK3B,EACd8D,EAAWnC,EAAE,QAAQ,GAAKmC,EAAWnC,EAAE,QAAQ,GAAK,GAAK,EACrDA,EAAE,YACJoC,EAAYpC,EAAE,SAAS,GAAKoC,EAAYpC,EAAE,SAAS,GAAK,GAAK,GAE/DqC,EAASrC,EAAE,MAAM,IACjBsC,EAAStC,EAAE,MAAM,GAAKsC,EAAStC,EAAE,MAAM,GAAK,GAAK,EAGnD,MAAO;AAAA,EACP1D,EAAO,IAAI;AAAA;AAAA,4UAE4CA,EAAO,KAAK;AAAA;AAAA,EAEnEA,EAAO,IAAI,WAAWA,EAAO,KAAK;AAAA,qBACf4F,EAAS,cAAc;AAAA,qBACvBA,EAAS,eAAe,MAAM,EAAG,EAAE,CAAC;AAAA;AAAA,EAEvD5F,EAAO,IAAI,YAAYA,EAAO,KAAK;AAAA,EACnC,OAAO,QAAQgG,CAAQ,EACtB,KAAK,CAAC,EAAG/B,IAAMA,EAAE,CAAC,EAAI,EAAE,CAAC,CAAC,EAC1B,IAAI,CAAC,CAACgC,EAAGC,CAAC,IAAM,KAAKD,CAAC,KAAKC,CAAC,EAAE,EAC9B,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA,EAEXlG,EAAO,IAAI,YAAYA,EAAO,KAAK;AAAA,IACjCA,EAAO,GAAG,OAAOA,EAAO,KAAK,KAAK+F,EAAS,IAAI;AAAA,IAC/C/F,EAAO,MAAM,SAASA,EAAO,KAAK,KAAK+F,EAAS,MAAM;AAAA,IACtD/F,EAAO,GAAG,MAAMA,EAAO,KAAK,KAAK+F,EAAS,GAAG;AAAA;AAAA,EAE/C/F,EAAO,IAAI,uBAAuBA,EAAO,KAAK;AAAA,EAC9C,OAAO,QAAQ6F,CAAU,EACxB,KAAK,CAAC,EAAG5B,IAAMA,EAAE,CAAC,EAAI,EAAE,CAAC,CAAC,EAC1B,MAAM,EAAG,EAAE,EACX,IAAI,CAAC,CAACgC,EAAGC,CAAC,IAAM,KAAKD,CAAC,KAAKC,CAAC,EAAE,EAC9B,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA,EAEXlG,EAAO,IAAI,gBAAgBA,EAAO,KAAK;AAAA,EACvC,OAAO,QAAQ8F,CAAW,EACzB,KAAK,CAAC,EAAG7B,IAAMA,EAAE,CAAC,EAAE,cAAc,EAAE,CAAC,CAAC,CAAC,EACvC,MAAM,EAAG,CAAC,EACV,IAAI,CAAC,CAACgC,EAAGC,CAAC,IAAM,KAAKD,CAAC,KAAKC,CAAC,EAAE,EAC9B,KAAK;AAAA,CAAI,CAAC;AAAA,CAEb,CAKO,SAASC,GAAqBC,EAA4B,CAC/D,IAAMX,EACJW,EAAS,SAAW,OAChBpG,EAAO,IACPoG,EAAS,SAAW,SAClBpG,EAAO,OACPA,EAAO,IAEf,MAAO;AAAA,EACPA,EAAO,IAAI;AAAA,YACDoG,EAAS,EAAE;AAAA,4UACkCpG,EAAO,KAAK;AAAA;AAAA,EAEnEA,EAAO,IAAI,UAAUA,EAAO,KAAK;AAAA,EACjCoG,EAAS,OAAO;AAAA;AAAA,EAEhBpG,EAAO,IAAI,UAAUA,EAAO,KAAK;AAAA,oBACfoG,EAAS,IAAI;AAAA,oBACbA,EAAS,QAAQ;AAAA,oBACjBX,CAAW,GAAGW,EAAS,OAAO,YAAY,CAAC,GAAGpG,EAAO,KAAK;AAAA,oBAC1DoG,EAAS,MAAM;AAAA,oBACfA,EAAS,MAAM;AAAA,oBACfA,EAAS,WAAa,KAAK;AAAA,oBAC3BA,EAAS,eAAiB,KAAK;AAAA;AAAA,EAEjDA,EAAS,UAAY,GAAGpG,EAAO,IAAI,YAAYA,EAAO,KAAK;AAAA,EAAKoG,EAAS,SAAS;AAAA,EAAO,EAAE;AAAA,EAC3FA,EAAS,aAAe,GAAGpG,EAAO,IAAI,gBAAgBA,EAAO,KAAK;AAAA,EAAKoG,EAAS,YAAY;AAAA,EAAO,EAAE;AAAA,EACrGA,EAAS,UAAU,OAAS,GAAGpG,EAAO,IAAI,mBAAmBA,EAAO,KAAK;AAAA,EAAKoG,EAAS,SAAS,KAAK,IAAI,CAAC;AAAA,EAAO,EAAE;AAAA,CAErH,CAUA,SAASC,GAAoBhG,EAAciG,EAAoB,GAAY,CACzE,OAAOjG,EACJ,MAAM,EAAGiG,CAAS,EAElB,QAAQ,QAAS,EAAE,EACnB,QAAQ,MAAO,EAAE,EACjB,QAAQ,KAAM,EAAE,EAEhB,QAAQ,QAAS,EAAE,EAEnB,QAAQ,KAAM,GAAG,EAEjB,QAAQ,qBAAsB,EAAE,EAEhC,QAAQ,OAAQ,EAAE,EAElB,QAAQ,OAAQ,GAAG,EACnB,QAAQ,MAAO,GAAG,EAElB,QAAQ,mBAAoB,EAAE,EAC9B,KAAK,CACV,CAKO,SAASC,GACdxE,EACAoC,EAAkB,aACV,CACR,IAAMC,EAAUF,GAAenC,EAAWoC,CAAO,EAE7Cc,EAAS,yBACbA,GAAU;AAAA,EAGV,IAAMC,EAAe,OAAO,QAAQd,CAAO,EAAE,KAAK,CAACe,EAAGlB,IAAM,CAC1D,IAAMmB,EAAQD,EAAE,CAAC,EAAE,CAAC,GAAG,MAAQ,GAE/B,OADclB,EAAE,CAAC,EAAE,CAAC,GAAG,MAAQ,IAClB,cAAcmB,CAAK,CAClC,CAAC,EAED,OAAW,CAACC,EAAOzC,CAAK,IAAKsC,EAAa,MAAM,EAAG,EAAE,EAAG,CAEtD,IAAMI,EAAQnB,IAAY,aAAe,MAAMkB,CAAK,GAAKgB,GAAoBhB,EAAO,EAAE,EACtFJ,GAAU,eAAeK,CAAK;AAAA,EAG9B,IAAMkB,EAAW5D,EACd,OAAQc,GAAMA,EAAE,SAAW,QAAUA,EAAE,SAAW,QAAQ,EAC1D,MAAM,EAAG,CAAC,EAEb,QAAWA,KAAK8C,EAAU,CAExB,IAAM5B,EAAUyB,GAAoB3C,EAAE,QAAS,EAAE,EAC3ClD,EAAW6F,GAAoB3C,EAAE,SAAU,EAAE,EAG/CkB,EAAQ,OAAS,IACnBK,GAAU,WAAWL,CAAO,MAAMpE,CAAQ;AAAA,EAE9C,CACF,CAEA,OAAAyE,GAAU,MACHA,CACT,CAOA,eAAsBwB,GAAsBC,EAAuC,CACjF,GAAI,CAEF,IAAMC,EAAOD,EACV,QAAQ,iBAAkB,EAAE,EAC5B,QAAQ,UAAW,EAAE,EAGlBE,EAAS,OAAO,KAAKD,CAAI,EAAE,SAAS,QAAQ,EAOlD,OAHa,MADI,MAAM,MAAM,2BAA2BC,CAAM,EAAE,GACpC,KAAK,GAGrB,SAAS,MAAM,CAC7B,MAAQ,CAEN,MAAO,EACT,CACF,CAKO,SAASC,GAAwB9E,EAA+B,CACrE,IAAI+E,EAAM;AAAA;AAAA,EACVA,GAAO,cAAc,IAAI,KAAK,EAAE,YAAY,EAAE,MAAM,EAAG,EAAE,CAAC;AAAA;AAAA,EAG1DA,GAAO;AAAA;AAAA,EACPA,GAAOP,GAAcxE,EAAW,YAAY,EAC5C+E,GAAO;AAAA;AAAA,EAGPA,GAAO;AAAA;AAAA,EACPA,GAAOP,GAAcxE,EAAW,UAAU,EAC1C+E,GAAO;AAAA;AAAA,EAGP,IAAMC,EAAQ,CACZ,MAAOhF,EAAU,OACjB,KAAMA,EAAU,OAAQ2B,GAAMA,EAAE,SAAW,MAAM,EAAE,OACnD,WAAY,MAAM,KAAK,IAAI,IAAI3B,EAAU,IAAK2B,GAAMA,EAAE,QAAQ,CAAC,CAAC,EAAE,OAClE,WAAY,MAAM,KAAK,IAAI,IAAI3B,EAAU,IAAK2B,GAAMA,EAAE,SAAS,EAAE,OAAO,OAAO,CAAC,CAAC,EAAE,MACrF,EAEA,OAAAoD,GAAO;AAAA;AAAA,EACPA,GAAO;AAAA,EACPA,GAAO;AAAA,EACPA,GAAO,uBAAuBC,EAAM,KAAK;AAAA,EACzCD,GAAO,mBAAmBC,EAAM,IAAI;AAAA,EACpCD,GAAO,kBAAkBC,EAAM,UAAU;AAAA,EACzCD,GAAO,mBAAmBC,EAAM,UAAU;AAAA,EAEnCD,CACT,CAkBO,SAASE,GACdjF,EACAkF,EACY,CACZ,IAAIC,EAAWnF,EAYf,GAVIkF,EAAQ,YACVC,EAAWA,EAAS,OAAQxD,GAAMA,EAAE,YAAcuD,EAAQ,SAAS,GAGjEA,EAAQ,WACVC,EAAWA,EAAS,OAAQxD,GAC1BA,EAAE,SAAS,YAAY,EAAE,SAASuD,EAAQ,SAAU,YAAY,CAAC,CACnE,GAGEA,EAAQ,KAAM,CAChB,IAAME,EAAS,IAAI,KACnBA,EAAO,QAAQA,EAAO,QAAQ,EAAIF,EAAQ,IAAI,EAC9CC,EAAWA,EAAS,OAAQxD,GAAM,IAAI,KAAKA,EAAE,IAAI,GAAKyD,CAAM,CAC9D,CAEA,OAAIF,EAAQ,SACVC,EAAWA,EAAS,OAAQxD,GAAMA,EAAE,SAAWuD,EAAQ,MAAM,GAG3DA,EAAQ,SACVC,EAAWA,EAAS,OAAQxD,GAAMA,EAAE,SAAWuD,EAAQ,MAAM,GAG3DA,EAAQ,QACVC,EAAWA,EAAS,MAAM,EAAGD,EAAQ,KAAK,GAGrCC,CACT,CAKO,SAASE,GAAgBrF,EAAuBsF,EAA2B,CAChF,IAAMC,EAAaD,EAAM,YAAY,EAErC,OAAOtF,EAAU,OACd2B,GACCA,EAAE,QAAQ,YAAY,EAAE,SAAS4D,CAAU,GAC3C5D,EAAE,WAAW,YAAY,EAAE,SAAS4D,CAAU,GAC9C5D,EAAE,SAAS,YAAY,EAAE,SAAS4D,CAAU,GAC5C5D,EAAE,GAAG,YAAY,EAAE,SAAS4D,CAAU,CAC1C,CACF,CCp4BA,IAAMC,GAA0B,CAE9B,gDACA,gBAGA,yCACA,0CACA,uCACA,yBAGA,mCACA,4BACA,4BAGA,YACA,QACA,UACA,SACA,UACA,UACA,QACA,UACA,WACA,UACA,QACA,YAGA,kDACA,gBAGA,UACA,qBACA,wCACA,uBACA,YACA,OACF,EAKO,SAASC,GAAoBC,EAA8B,CAChE,IAAMC,EAAUD,EAAM,WAAW,SAAW,GAE5CE,EAAQ,yBAA0B,4BAA4BD,EAAQ,MAAM,EAAG,EAAE,CAAC,KAAK,EAGvF,QAAWE,KAAWL,GACpB,GAAIK,EAAQ,KAAKF,CAAO,EACtB,OAAAC,EAAQ,yBAA0B,uCAAuCC,CAAO,EAAE,EAClFC,EAAsB,QAAS,yBAAyBD,CAAO,GAAIH,CAAK,EACjEK,GAAkB,EAK7B,OAAAH,EAAQ,yBAA0B,kCAAkC,EAC7DI,EAAoB,CAC7B,CClEA,OAAS,WAAAC,GAAS,cAAAC,OAAkB,YAKpC,IAAMC,GAAgB,CACpB,eACA,OACA,OACA,QACA,cACA,QACA,MACF,EAKO,SAASC,GAAyBC,EAA8B,CACrE,IAAIC,EAAWD,EAAM,WAAW,WAAa,GACvCE,EAAaC,EAAc,EAUjC,GARAC,EAAQ,8BAA+B,wBAAwBH,CAAQ,EAAE,EAGpEJ,GAAWI,CAAQ,IACtBA,EAAWL,GAAQM,EAAYD,CAAQ,GAIrCA,EAAS,WAAWC,CAAU,EAAG,CAEnC,QAAWG,KAAOP,GAChB,GAAIG,EAAS,SAAS,IAAII,CAAG,GAAG,EAC9B,OAAAD,EAAQ,8BAA+B,gCAAgCC,CAAG,EAAE,EACrEC,EAAoB,EAI/B,OAAAF,EAAQ,8BAA+B,yCAAyC,EAChFG,EAAsB,QAAS,qBAAqBN,CAAQ,GAAID,CAAK,EAC9DQ,GAAkB,CAC3B,CAGA,OAAAJ,EAAQ,8BAA+B,4DAA4D,EAC5FE,EAAoB,CAC7B,CC1CA,OAAS,cAAAG,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAKrB,IAAMC,GAA+B,CACnC,kBACA,SACA,mBACA,gBACA,SACA,WACA,yBACA,gBACA,eACF,EAKA,SAASC,GAAkBC,EAA0B,CACnD,OAAOF,GAAmB,KAAMG,GAAYA,EAAQ,KAAKD,CAAO,CAAC,CACnE,CAKA,SAASE,IAAgC,CACvC,IAAMC,EAAaC,EAAc,EAC3BC,EAAeR,GAAKM,EAAY,UAAW,WAAY,uBAAuB,EAEpF,GAAI,CACF,GAAIR,GAAWU,CAAY,EAEzB,OADa,KAAK,MAAMT,GAAaS,EAAc,MAAM,CAAC,EAC9C,qBAAuB,CAAC,CAExC,MAAQ,CAER,CAEA,MAAO,CAAC,CACV,CAKA,SAASC,GAAkBN,EAA0B,CACnD,IAAMO,EAAWL,GAAoB,EAErC,QAAWD,KAAWM,EACpB,GAAI,CAEF,GADc,IAAI,OAAON,CAAO,EACtB,KAAKD,CAAO,EACpB,MAAO,EAEX,MAAQ,CAER,CAGF,MAAO,EACT,CAKO,SAASQ,GAAgBC,EAA8B,CAC5D,IAAMC,EAAWD,EAAM,UACjBT,EAAUS,EAAM,WAAW,SAAWA,EAAM,WAAW,WAAa,GAK1E,GAHAE,EAAQ,mBAAoB,mCAAmCD,CAAQ,cAAcV,EAAQ,MAAM,EAAG,EAAE,CAAC,KAAK,EAG1GU,IAAa,QAAUV,EAAS,CAElC,GAAID,GAAkBC,CAAO,EAC3B,OAAAW,EAAQ,mBAAoB,8CAA8C,EACnEC,EAAoB,EAI7B,GAAIN,GAAkBN,CAAO,EAC3B,OAAAW,EAAQ,mBAAoB,8CAA8C,EAC1EE,EAAsB,QAAS,wBAAyBJ,CAAK,EACtDK,GAAkB,CAE7B,CAIA,OAAOF,EAAoB,CAC7B,CC5FA,IAAMG,GAA+B,CAEnC,WACA,WACA,WACA,WACA,kBAEA,aACA,QACA,2BACA,6BAEA,iBAEA,cAEA,mBACA,gBAEA,gBACA,cACA,gBACF,EAMMC,GAAmB,6BAMnBC,GAAoB,iCAKnB,SAASC,GAAwBC,EAA8B,CACpE,IAAMC,EAAUD,EAAM,WAAW,SAAW,GAE5C,GAAI,CAACC,EACH,OAAOC,EAAoB,EAI7B,IAAMC,EAAoBC,GAAiBH,CAAO,EAAE,YAAY,EAGhE,QAAWI,KAAWT,GACpB,GAAIO,EAAkB,SAASE,EAAQ,YAAY,CAAC,EAClD,OAAAC,EAAQ,4BAA6B,+BAA+BD,CAAO,EAAE,EAC7EE,EAAsB,OAAQ,sBAAsBF,CAAO,GAAIL,CAAK,EAE7DQ,EACL,sCAAsCH,CAAO;AAAA;AAAA,oEAE/C,EAKJ,GAAIR,GAAiB,KAAKM,CAAiB,EAAG,CAC5C,IAAMM,EAAS,uCACf,OAAAH,EAAQ,4BAA6B,YAAYG,CAAM,EAAE,EACzDF,EAAsB,OAAQE,EAAQT,CAAK,EAEpCQ,EACL,GAAGC,CAAM;AAAA;AAAA,mFAEX,CACF,CAGA,GAAIX,GAAkB,KAAKK,CAAiB,EAAG,CAC7C,IAAMM,EAAS,oDACf,OAAAH,EAAQ,4BAA6B,YAAYG,CAAM,EAAE,EACzDF,EAAsB,OAAQE,EAAQT,CAAK,EAEpCQ,EACL,GAAGC,CAAM;AAAA;AAAA,sEAEX,CACF,CAGA,OAAOP,EAAoB,CAC7B,CClFA,IAAMQ,GAAqB,CAAC,OAAQ,MAAO,WAAY,OAAQ,OAAQ,QAAS,QAAS,OAAQ,KAAM,OAAO,EACxGC,GAAgC,GAMtC,SAASC,GAAqBC,EAAgC,CAC5D,IAAMC,EAAcD,EAAQ,MAAM,uBAAuB,EACzD,GAAIC,EAAa,OAAOA,EAAY,CAAC,EAErC,IAAMC,EAAgBF,EAAQ,MAAM,YAAY,EAChD,OAAIE,EAAsBA,EAAc,CAAC,EAElC,IACT,CAEA,SAASC,GAAqBH,EAAgC,CAC5D,IAAMI,EAAgBJ,EAAQ,MAAM,uBAAuB,EAC3D,GAAII,EAAe,OAAOA,EAAc,CAAC,EAEzC,IAAMC,EAAcL,EAAQ,MAAM,sBAAsB,EACxD,OAAIK,EAAoBA,EAAY,CAAC,EAE9B,IACT,CAMA,SAASC,GAAyBN,EAAiBO,EAA0C,CAC3F,GAAI,CAACC,GAAkBD,CAAa,EAClC,OAAO,KAGT,GAAI,sBAAsB,KAAKP,CAAO,EAAG,CACvC,IAAMS,EAAW,+CAA+CF,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAQ7E,OAAAG,EAAsB,OAAQ,gCAAgCH,CAAa,EAAE,EACtEI,EAAWF,CAAQ,CAC5B,CAEA,OAAOG,EAAkB,wBAAwBL,CAAa,uCAAuC,CACvG,CAEA,SAASM,GAAqBb,EAAoC,CAChE,GAAI,CAAC,kCAAkC,KAAKA,CAAO,EACjD,OAAO,KAGT,IAAMc,EAAaX,GAAqBH,CAAO,EAC/C,GAAI,CAACc,EAAY,OAAO,KAExB,IAAMC,EAAkBC,GAAmBF,CAAU,EACrD,GAAIC,EAAiB,CACnB,IAAME,EAAU,kBAAkBF,CAAe;AAAA;AAAA,+DAGjD,OAAAL,EAAsB,QAAS,2BAA2BI,CAAU,EAAE,EAC/DI,EAAuBD,CAAO,CACvC,CAEA,OAAO,IACT,CAEA,SAASE,GAAsBnB,EAAoC,CACjE,GAAI,CAAC,gBAAgB,KAAKA,CAAO,EAC/B,OAAO,KAGT,GAAI,aAAa,KAAKA,CAAO,EAC3B,OAAOkB,EAAuB;AAAA,SACzBrB,GAAmB,KAAK,IAAI,CAAC;AAAA,yDACmB,EAGvD,IAAMuB,EAAYrB,GAAqBC,CAAO,EAC9C,GAAI,CAACoB,EACH,OAAOF,EAAuB,oDAAoD,EAGpF,IAAMG,EAAexB,GAAmB,KAAK,GAAG,EAC1CyB,EAAsB,IAAI,OAAO,KAAKD,CAAY,wCAAwC,EAC1FE,EAAgB,IAAI,OAAO,KAAKF,CAAY,OAAO,EAEzD,GAAIC,EAAoB,KAAKF,CAAS,GAAKG,EAAc,KAAKH,CAAS,EAAG,CACxE,IAAMI,EAAWJ,EAAU,MAAM;AAAA,CAAI,EAAE,CAAC,EAAE,OAC1C,OAAII,EAAW,GACNN,EAAuB,mBAAmBM,CAAQ,6BAA6B,EAEjF,IACT,CAEA,IAAMf,EAAW,2BAA2BW,CAAS;AAAA;AAAA;AAAA,SAG9CvB,GAAmB,KAAK,IAAI,CAAC;AAAA,8CAGpC,OAAAa,EAAsB,OAAQ,mBAAmBU,CAAS,EAAE,EACrDT,EAAWF,CAAQ,CAC5B,CAEA,SAASgB,GAAqBzB,EAAiB0B,EAAwC,CACrF,GAAI,CAAC,gBAAgB,KAAK1B,CAAO,EAC/B,OAAO,KAIT,IAAM2B,EADSC,GAAaF,CAAU,EACX,MAAM;AAAA,CAAI,EAAE,OAAQG,GAASA,EAAK,KAAK,CAAC,EAAE,OAErE,OAAIF,EAAc7B,GACToB,EAAuB,iBAAiBS,CAAW,kDAAkD,EAGvG,IACT,CAMO,SAASG,GAAaC,EAA8B,CACzD,IAAM/B,EAAU+B,EAAM,WAAW,SAAW,GAE5C,GAAI,CAAC/B,EAAQ,WAAW,KAAK,EAC3B,OAAOgC,EAAoB,EAG7B,IAAMzB,EAAgB0B,GAAgBF,EAAM,WAAW,EAEvDG,EAAQ,gBAAiB,eAAelC,EAAQ,MAAM,EAAG,EAAE,CAAC,KAAK,EAGjE,IAAMmC,EAAmB7B,GAAyBN,EAASO,CAAa,EACxE,GAAI4B,GAAkB,WAAa,GACjC,OAAOA,EAIT,IAAMC,EAAkBjB,GAAsBnB,CAAO,EACrD,GAAIoC,GAAiB,WAAa,GAChC,OAAOA,EAIT,IAAMC,EAAmBxB,GAAqBb,CAAO,EAG/CsC,EAAeb,GAAqBzB,EAAS+B,EAAM,WAAW,EAG9DQ,EAAqB,CAAC,EAe5B,OAbIJ,GAAkB,oBAAoB,mBACxCI,EAAS,KAAKJ,EAAiB,mBAAmB,iBAA2B,EAE3EC,GAAiB,oBAAoB,mBACvCG,EAAS,KAAKH,EAAgB,mBAAmB,iBAA2B,EAE1EC,GAAkB,oBAAoB,mBACxCE,EAAS,KAAKF,EAAiB,mBAAmB,iBAA2B,EAE3EC,GAAc,oBAAoB,mBACpCC,EAAS,KAAKD,EAAa,mBAAmB,iBAA2B,EAGvEC,EAAS,OAAS,EACb3B,EAAkB2B,EAAS,KAAK;AAAA;AAAA,CAAM,CAAC,EAGzCP,EAAoB,CAC7B,CC3LA,IAAMQ,GAAqB,CACzB,WACA,WACA,WACA,WACA,OACA,aACA,YACA,gBACF,EAKA,SAASC,GAAgBC,EAA0B,CACjD,IAAMC,EAAUD,EAAQ,KAAK,EAC7B,GAAI,CAACC,EAAS,MAAO,GAErB,QAAWC,KAAWJ,GACpB,GAAIG,EAAQ,SAASC,CAAO,EAC1B,MAAO,GAIX,MAAO,EACT,CAKA,SAASC,GAAwBC,EAAgC,CAE/D,GAAI,sBAAsB,KAAKA,CAAO,GAAK,sBAAsB,KAAKA,CAAO,EAC3E,MAAO,uDAIT,GAAI,CAACA,EAAQ,SAAS,IAAI,GAAK,CAACA,EAAQ,SAAS,IAAI,GAAK,CAACA,EAAQ,SAAS,GAAG,GAAK,CAACA,EAAQ,SAAS,GAAG,EACvG,OAAO,KAIT,IAAMC,EAAWD,EAAQ,MAAM,cAAc,EAE7C,QAAWJ,KAAWK,EACpB,GAAI,CAACN,GAAgBC,CAAO,EAC1B,OAAOA,EAAQ,KAAK,EAIxB,OAAO,IACT,CAKO,SAASM,GAAyBC,EAA8B,CACrE,IAAMH,EAAUG,EAAM,WAAW,SAAW,GAE5C,GAAI,CAACH,EACH,OAAOI,EAAoB,EAI7B,IAAMC,EAAoBC,GAAiBN,CAAO,EAG5CO,EAAcR,GAAwBM,CAAiB,EAE7D,GAAIE,EAAa,CACf,IAAMC,EAAW;AAAA;AAAA,mBAEFD,CAAW;AAAA;AAAA;AAAA;AAAA,0EAM1B,OAAAE,EAAsB,OAAQ,+BAA+BF,CAAW,GAAIJ,CAAK,EACjFO,EAAQ,6BAA8B,YAAYH,CAAW,EAAE,EAExDI,EAAWH,CAAQ,CAC5B,CAGA,OAAAC,EAAsB,QAAS,mCAAoCN,CAAK,EACjEC,EAAoB,CAC7B,CC7FA,IAAMQ,GAAkB,KAgBjB,SAASC,GAAqBC,EAA8B,CACjE,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCE,EAAUF,EAAM,WAAW,QAC3BG,EAAcH,EAAM,WAAW,YAGrC,GAAI,OAAOE,GAAY,UAAYA,EAAU,EAC3C,MAAO,CAAE,SAAU,GAAM,eAAgB,EAAK,EAIhD,IAAME,EAA2D,CAC/D,QAAAH,EACA,QAASH,EACX,EAEA,OAAIK,GAAe,OAAOA,GAAgB,WACxCC,EAAa,YAAcD,GAG7BE,EAAQ,yBAA0B,4BAA4BP,EAAe,IAAI,EAE1E,CACL,SAAU,GACV,eAAgB,GAChB,mBAAoB,CAClB,cAAe,aACf,mBAAoB,QACpB,aAAAM,CACF,CACF,CACF,CC9CA,OAAS,cAAAE,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAoBrB,SAASC,GAAeC,EAAiC,CACvD,IAAMC,EAAYH,GAAKE,EAAY,UAAW,QAAS,kBAAkB,EAEzE,GAAI,CACF,GAAIJ,GAAWK,CAAS,EAEtB,OADwB,KAAK,MAAMJ,GAAaI,EAAW,MAAM,CAAC,EACtD,OAAS,CAAC,CAE1B,MAAQ,CAER,CAEA,MAAO,CAAC,CACV,CAKA,SAASC,GAAiBC,EAAcC,EAAsB,CAC5D,IAAMC,EAAS,IAAI,IAAIF,EAAK,YAAY,EAAE,MAAM,KAAK,CAAC,EAChDG,EAAS,IAAI,IAAIF,EAAK,YAAY,EAAE,MAAM,KAAK,CAAC,EAElDG,EAAQ,EACZ,QAAWC,KAAQH,EACbC,EAAO,IAAIE,CAAI,GAAKA,EAAK,OAAS,GACpCD,IAIJ,OAAOA,CACT,CAKO,SAASE,GAAmBC,EAA8B,CAC/D,IAAMV,EAAaW,EAAc,EAC3BC,EAAUF,EAAM,WAAW,SAAW,GAE5C,GAAI,CAACE,EACH,OAAOC,EAAoB,EAI7B,IAAMC,EAAQf,GAAeC,CAAU,EACvC,GAAIc,EAAM,SAAW,EACnB,OAAOD,EAAoB,EAG7B,IAAME,EAAkB,CAAC,EAGrB,wCAAwC,KAAKH,CAAO,GACtCE,EAAM,OACnBE,GAAMA,EAAE,OAAS,QAAUA,EAAE,WAAW,SAAS,MAAM,CAC1D,EACY,OAAS,GACnBD,EAAM,KAAK,wEAAwE,EAKnFH,EAAQ,SAAS,eAAe,GACjBE,EAAM,OAAQE,GAAMA,EAAE,MAAM,SAAS,cAAc,CAAC,EACxD,OAAS,GACpBD,EAAM,KAAK,qDAAqD,EAKpE,QAAWE,KAAQH,EAAO,CACxB,GAAI,CAACG,EAAK,UAAYA,EAAK,kBAAoB,GAAK,EAAG,SAEvD,IAAMC,EAAgBD,EAAK,cAAc,QACrCC,GAAiBhB,GAAiBU,EAASM,CAAa,EAAI,IAC9DC,EAAQ,uBAAwB,kBAAkBF,EAAK,SAAS,EAAE,EAC9DA,EAAK,cACPF,EAAM,KAAK,GAAGE,EAAK,SAAS,KAAKA,EAAK,gBAAgB,OAAOA,EAAK,aAAa,EAAE,EAEjFF,EAAM,KAAK,GAAGE,EAAK,SAAS,KAAKA,EAAK,gBAAgB,IAAI,EAGhE,CAGA,GAAIF,EAAM,OAAS,EAAG,CACpB,IAAIK,EAAa,4BAA8BL,EAAM,KAAK,KAAK,EAG/D,OAAIK,EAAW,OAAS,MACtBA,EAAaA,EAAW,MAAM,EAAG,GAAG,EAAI,OAGnCC,EAAkBD,CAAU,CACrC,CAGA,OAAOP,EAAoB,CAC7B,CCtHA,OAAS,YAAAS,OAAgB,qBAKzB,SAASC,GAAsBC,EAAoBC,EAAgC,CACjF,GAAI,CAYF,IAAMC,EAVSJ,GACb,wBAAwBG,CAAY,iCACpC,CACE,IAAKD,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CACF,EAE4B,KAAK,EAAE,MAAM;AAAA,CAAI,EAAE,OAAO,OAAO,EAGvDG,EAAsB,CAAC,EAC7B,QAAWC,KAAQF,EAAa,MAAM,EAAG,EAAE,EAEzC,GAAI,CACqBJ,GACrB,mCAAmCG,CAAY,QAAQG,CAAI,2BAC3D,CACE,IAAKJ,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CACF,EAEmB,KAAK,GACtBG,EAAU,KAAKC,CAAI,CAEvB,MAAQ,CAER,CAGF,OAAOD,CACT,MAAQ,CACN,MAAO,CAAC,CACV,CACF,CAKO,SAASE,GAAkBC,EAA8B,CAC9D,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCN,EAAaQ,EAAc,EAGjC,GAAI,CAAC,4BAA4B,KAAKD,CAAO,EAC3C,OAAOE,EAAoB,EAI7B,IAAIR,EAA8B,KAG5BS,EAAcH,EAAQ,MAAM,8BAA8B,EAUhE,GATIG,IACFT,EAAeS,EAAY,CAAC,GAI1BH,EAAQ,SAAS,UAAU,IAC7BN,EAAe,cAGb,CAACA,EACH,OAAOQ,EAAoB,EAI7B,IAAMN,EAAYJ,GAAsBC,EAAYC,CAAY,EAEhE,GAAIE,EAAU,OAAS,EAAG,CACxB,IAAMQ,EAAU,iCAAiCR,EAAU,MAAM;AAAA,SAC5DA,EAAU,MAAM,EAAG,CAAC,EAAE,KAAK,IAAI,CAAC,GAAGA,EAAU,OAAS,EAAI,MAAQ,EAAE;AAAA;AAAA;AAAA;AAAA,mBAI1DF,CAAY;AAAA,yCAG3B,OAAAW,EAAsB,QAAS,wBAAwBT,EAAU,MAAM,SAAUG,CAAK,EACtFO,EAAQ,qBAAsB,wBAAwBV,EAAU,KAAK,IAAI,CAAC,EAAE,EACrEW,EAAuBH,CAAO,CACvC,CAEA,OAAAC,EAAsB,QAAS,yBAA0BN,CAAK,EACvDG,EAAoB,CAC7B,CClGA,OAAS,YAAAM,OAAgB,qBACzB,OAAS,cAAAC,OAAkB,UAC3B,OAAS,QAAAC,GAAM,YAAAC,GAAU,WAAAC,OAAe,YAKxC,SAASC,GAAiBC,EAAoBC,EAA8B,CAC1E,IAAMC,EAAkB,CAAC,EACnBC,EAAWN,GAASI,CAAU,EAAE,QAAQ,wBAAyB,EAAE,EACnEG,EAAUN,GAAQG,CAAU,EAG5BI,EAAe,CACnB,GAAGD,CAAO,IAAID,CAAQ,WACtB,GAAGC,CAAO,IAAID,CAAQ,YACtB,GAAGC,CAAO,IAAID,CAAQ,WACtB,GAAGC,CAAO,IAAID,CAAQ,YACtB,GAAGC,CAAO,cAAcD,CAAQ,WAChC,GAAGC,CAAO,cAAcD,CAAQ,YAChC,SAASF,EAAW,QAAQ,qBAAsB,UAAU,CAAC,GAC7D,QAAQE,CAAQ,MAChB,cAAcA,CAAQ,KACxB,EAEA,QAAWG,KAAWD,EAAc,CAClC,IAAME,EAAWX,GAAKI,EAAYM,CAAO,EACrCX,GAAWY,CAAQ,GACrBL,EAAM,KAAKI,CAAO,CAEtB,CAEA,OAAOJ,CACT,CAKA,SAASM,GAAgBR,EAA8B,CACrD,GAAI,CAQF,OAPeN,GAAS,4CAA6C,CACnE,IAAKM,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAGE,MAAM;AAAA,CAAI,EACV,OAAQS,GAASA,EAAK,KAAK,CAAC,EAC5B,IAAKA,GAASA,EAAK,MAAM,CAAC,EAAE,KAAK,CAAC,EAClC,OAAQC,GAAS,wBAAwB,KAAKA,CAAI,CAAC,CACxD,MAAQ,CACN,MAAO,CAAC,CACV,CACF,CAKO,SAASC,GAAoBC,EAA8B,CAChE,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCZ,EAAac,EAAc,EAGjC,GAAI,CAAC,qCAAqC,KAAKD,CAAO,EACpD,OAAOE,EAAoB,EAI7B,GAAI,0BAA0B,KAAKF,CAAO,EACxC,OAAOE,EAAoB,EAI7B,IAAMC,EAAeR,GAAgBR,CAAU,EAC/C,GAAIgB,EAAa,SAAW,EAC1B,OAAOD,EAAoB,EAI7B,IAAME,EAAyB,CAAC,EAChC,QAAWP,KAAQM,EAAa,MAAM,EAAG,EAAE,EAAG,CAE5C,IAAMd,EAAQH,GAAiBC,EAAYU,CAAI,EAC/CO,EAAa,KAAK,GAAGf,CAAK,CAC5B,CAGA,IAAMgB,EAAc,CAAC,GAAG,IAAI,IAAID,CAAY,CAAC,EAE7C,GAAIC,EAAY,OAAS,EAAG,CAC1B,IAAMC,EAAU;AAAA,EAClBD,EAAY,MAAM,EAAG,CAAC,EAAE,KAAK;AAAA,CAAI,CAAC,GAAGA,EAAY,OAAS,EAAI;AAAA,KAAU,EAAE;AAAA;AAAA,oCAExCA,EAAY,CAAC,CAAC,GAE9C,OAAAE,EAAsB,QAAS,SAASF,EAAY,MAAM,iBAAkBN,CAAK,EACjFS,EAAQ,wBAAyB,UAAUH,EAAY,KAAK,IAAI,CAAC,EAAE,EAC5DI,EAAuBH,CAAO,CACvC,CAEA,OAAOJ,EAAoB,CAC7B,CCvGA,OAAS,cAAAQ,OAAkB,UAC3B,OAAS,QAAAC,OAAY,YAKrB,SAASC,GAAeC,EAA8B,CACpD,IAAMC,EAAmB,CAAC,EAG1B,OAAIJ,GAAWC,GAAKE,EAAY,cAAc,CAAC,IAC7CC,EAAO,KAAK,cAAc,EAC1BA,EAAO,KAAK,mBAAmB,EAC/BA,EAAO,KAAK,cAAc,GAIxBJ,GAAWC,GAAKE,EAAY,gBAAgB,CAAC,IAC/CC,EAAO,KAAK,cAAc,EAC1BA,EAAO,KAAK,QAAQ,EACpBA,EAAO,KAAK,QAAQ,GAIlBJ,GAAWC,GAAKE,EAAY,QAAQ,CAAC,IACvCC,EAAO,KAAK,cAAc,EAC1BA,EAAO,KAAK,eAAe,GAGtBA,CACT,CAKO,SAASC,GAAaC,EAA8B,CACzD,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCH,EAAaK,EAAc,EAGjC,GAAI,CAAC,aAAa,KAAKD,CAAO,EAC5B,OAAOE,EAAoB,EAI7B,IAAML,EAASF,GAAeC,CAAU,EAExC,GAAIC,EAAO,SAAW,EACpB,OAAOK,EAAoB,EAG7B,IAAMC,EAAU;AAAA,EAChBN,EAAO,MAAM,EAAG,CAAC,EAAE,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA;AAAA,oDAK7B,OAAAO,EAAsB,QAAS,0BAA2BL,CAAK,EAC/DM,EAAQ,gBAAiB,qBAAqBR,EAAO,KAAK,IAAI,CAAC,EAAE,EAC1DS,EAAuBH,CAAO,CACvC,CC5DA,OAAS,cAAAI,OAAkB,UAC3B,OAAS,QAAAC,OAAY,YAKrB,SAASC,GAAmBC,EAA6B,CACvD,OACEH,GAAWC,GAAKE,EAAY,yBAAyB,CAAC,GACtDH,GAAWC,GAAKE,EAAY,wBAAwB,CAAC,CAEzD,CAKA,SAASC,GAAeD,EAA6B,CACnD,OAAOH,GAAWC,GAAKE,EAAY,QAAQ,CAAC,CAC9C,CAKO,SAASE,GAAoBC,EAA8B,CAChE,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCH,EAAaK,EAAc,EAGjC,GAAI,CAAC,eAAe,KAAKD,CAAO,EAC9B,OAAOE,EAAoB,EAI7B,GAAI,cAAc,KAAKF,CAAO,EAAG,CAC/B,IAAMG,EAAU;AAAA;AAAA,uCAIhB,OAAAC,EAAsB,QAAS,2BAA4BL,CAAK,EAChEM,EAAQ,wBAAyB,kBAAkB,EAC5CC,EAAuBH,CAAO,CACvC,CAGA,GAAIR,GAAmBC,CAAU,EAAG,CAClC,IAAMO,EAAU;AAAA;AAAA,0CAIhB,OAAAC,EAAsB,QAAS,0BAA2BL,CAAK,EACxDO,EAAuBH,CAAO,CACvC,CAGA,GAAIN,GAAeD,CAAU,EAAG,CAC9B,IAAMO,EAAU;AAAA,sCAGhB,OAAAC,EAAsB,QAAS,qBAAsBL,CAAK,EACnDO,EAAuBH,CAAO,CACvC,CAEA,OAAOD,EAAoB,CAC7B,CC9DA,OAAS,YAAAK,OAAgB,qBAazB,SAASC,GAAYC,EAAoBC,EAAoC,CAC3E,GAAI,CACF,IAAMC,EAAQD,EAAW,GAAGA,CAAQ,GAAK,GACnCE,EAASL,GACb,cAAcI,CAAK,8EACnB,CACE,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CACF,EAEA,OAAO,KAAK,MAAMG,CAAM,CAC1B,MAAQ,CACN,OAAO,IACT,CACF,CAKO,SAASC,GAAYC,EAA8B,CACxD,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCL,EAAaO,EAAc,EAGjC,GAAI,CAAC,kBAAkB,KAAKD,CAAO,EACjC,OAAOE,EAAoB,EAI7B,IAAMC,EAAUH,EAAQ,MAAM,yBAAyB,EACjDL,EAAWQ,EAAU,SAASA,EAAQ,CAAC,EAAG,EAAE,EAAI,OAGhDC,EAASX,GAAYC,EAAYC,CAAQ,EAE/C,GAAI,CAACS,EAAQ,CACX,IAAMC,EAAU;AAAA;AAAA;AAAA,gCAKhB,OAAAC,EAAsB,QAAS,wBAAyBP,CAAK,EACtDQ,EAAuBF,CAAO,CACvC,CAGA,IAAMG,EAAmB,CAAC,EAkB1B,GAhBIJ,EAAO,QAAU,QACnBI,EAAO,KAAK,aAAaJ,EAAO,KAAK,kBAAkB,EAGpDA,EAAO,WACVI,EAAO,KAAK,wBAAwB,EAGlCJ,EAAO,oBAAsB,WAAaA,EAAO,oBAAsB,WACzEI,EAAO,KAAK,kBAAkBJ,EAAO,iBAAiB,EAAE,EAGtDA,EAAO,iBAAmB,qBAC5BI,EAAO,KAAK,+BAA+B,EAGzCA,EAAO,OAAS,EAAG,CACrB,IAAMH,EAAU,OAAOD,EAAO,MAAM;AAAA,EACtCI,EAAO,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA,+BAIf,OAAAF,EAAsB,QAAS,cAAcE,EAAO,KAAK,IAAI,CAAC,GAAIT,CAAK,EACvEU,EAAQ,gBAAiB,OAAOL,EAAO,MAAM,QAAQI,EAAO,MAAM,SAAS,EACpED,EAAuBF,CAAO,CACvC,CAGA,OAAAC,EAAsB,QAAS,OAAOF,EAAO,MAAM,kBAAmBL,CAAK,EACpEG,EAAoB,CAC7B,CC/FA,OAAS,YAAAQ,OAAgB,qBAKzB,SAASC,GAAiBC,EAAoBC,EAA0B,CACtE,GAAI,CACF,IAAMC,EAAWD,EAAQ,YAAYA,CAAK,IAAM,iBAWhD,OAVeH,GACb,WAAWI,CAAQ,+CACnB,CACE,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CACF,EAEc,MAAM;AAAA,CAAI,EAAE,OAAO,OAAO,CAC1C,MAAQ,CACN,MAAO,CAAC,CACV,CACF,CAKA,SAASG,GAAmBC,EAA6C,CACvE,IAAMC,EAAmC,CACvC,KAAM,CAAC,EACP,IAAK,CAAC,EACN,SAAU,CAAC,EACX,KAAM,CAAC,EACP,KAAM,CAAC,EACP,MAAO,CAAC,EACR,MAAO,CAAC,CACV,EAEA,QAAWC,KAAUF,EAAS,CAC5B,IAAMG,EAAQD,EAAO,MAAM,oDAAoD,EAC/E,GAAIC,EAAO,CACT,IAAMC,EAAOD,EAAM,CAAC,IAAM,QAAUA,EAAM,CAAC,IAAM,MAAQA,EAAM,CAAC,IAAM,QAAU,QAAUA,EAAM,CAAC,EACjGF,EAAOG,CAAI,EAAE,KAAKF,CAAM,CAC1B,MACED,EAAO,MAAM,KAAKC,CAAM,CAE5B,CAEA,OAAOD,CACT,CAKO,SAASI,GAAmBC,EAA8B,CAC/D,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCV,EAAaY,EAAc,EAGjC,GAAI,CAAC,2CAA2C,KAAKD,CAAO,EAC1D,OAAOE,EAAoB,EAI7B,IAAMT,EAAUL,GAAiBC,CAAU,EAE3C,GAAII,EAAQ,SAAW,EACrB,OAAOS,EAAoB,EAI7B,IAAMR,EAASF,GAAmBC,CAAO,EAGnCU,EAAqB,CAAC,EAQ5B,GANIT,EAAO,KAAK,OAAS,GACvBS,EAAS,KAAK;AAAA,EAAiBT,EAAO,KAAK,MAAM,EAAG,CAAC,EAAE,IAAKU,GAAM,KAAKA,CAAC,EAAE,EAAE,KAAK;AAAA,CAAI,CAAC,EAAE,EAEtFV,EAAO,IAAI,OAAS,GACtBS,EAAS,KAAK;AAAA,EAAkBT,EAAO,IAAI,MAAM,EAAG,CAAC,EAAE,IAAKU,GAAM,KAAKA,CAAC,EAAE,EAAE,KAAK;AAAA,CAAI,CAAC,EAAE,EAEtFV,EAAO,SAAS,OAAS,GAAKA,EAAO,MAAM,OAAS,EAAG,CACzD,IAAMW,EAAW,CAAC,GAAGX,EAAO,SAAU,GAAGA,EAAO,KAAK,EACrDS,EAAS,KAAK;AAAA,EAAoBE,EAAS,MAAM,EAAG,CAAC,EAAE,IAAKD,GAAM,KAAKA,CAAC,EAAE,EAAE,KAAK;AAAA,CAAI,CAAC,EAAE,CAC1F,CAEA,GAAID,EAAS,SAAW,EACtB,OAAOD,EAAoB,EAG7B,IAAMI,EAAU;AAAA;AAAA,EAEhBH,EAAS,KAAK;AAAA;AAAA,CAAM,CAAC;AAAA;AAAA,uCAIrB,OAAAI,EAAsB,QAAS,kCAAmCR,CAAK,EACvES,EAAQ,sBAAuB,aAAaL,EAAS,MAAM,WAAW,EAC/DM,EAAuBH,CAAO,CACvC,CCpGA,OAAS,cAAAI,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAUrB,SAASC,GAAsBC,EAAmC,CAChE,IAAMC,EAAWH,GAAKE,EAAY,cAAc,EAChD,GAAI,CACF,GAAIJ,GAAWK,CAAQ,EAErB,OADa,KAAK,MAAMJ,GAAaI,EAAU,MAAM,CAAC,EAC1C,SAAW,IAE3B,MAAQ,CAER,CACA,OAAO,IACT,CAKA,SAASC,GAAoBF,EAAmC,CAC9D,IAAMC,EAAWH,GAAKE,EAAY,gBAAgB,EAClD,GAAI,CACF,GAAIJ,GAAWK,CAAQ,EAAG,CAExB,IAAME,EADUN,GAAaI,EAAU,MAAM,EACvB,MAAM,gCAAgC,EAC5D,OAAOE,EAAQA,EAAM,CAAC,EAAI,IAC5B,CACF,MAAQ,CAER,CACA,OAAO,IACT,CAKA,SAASC,GAAkBJ,EAAqC,CAC9D,IAAMK,EAA2B,CAAC,EAE5BC,EAAaP,GAAsBC,CAAU,EAC/CM,GACFD,EAAQ,KAAK,CAAE,KAAM,eAAgB,QAASC,CAAW,CAAC,EAG5D,IAAMC,EAAYL,GAAoBF,CAAU,EAChD,OAAIO,GACFF,EAAQ,KAAK,CAAE,KAAM,iBAAkB,QAASE,CAAU,CAAC,EAGtDF,CACT,CAKO,SAASG,GAAYC,EAA8B,CACxD,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCT,EAAaW,EAAc,EAGjC,GAAI,CAAC,iCAAiC,KAAKD,CAAO,EAChD,OAAOE,EAAoB,EAI7B,IAAMP,EAAUD,GAAkBJ,CAAU,EAE5C,GAAIK,EAAQ,OAAS,EACnB,OAAOO,EAAoB,EAI7B,IAAMC,EAAWR,EAAQ,IAAKS,GAAMA,EAAE,OAAO,EACvCC,EAAiB,CAAC,GAAG,IAAI,IAAIF,CAAQ,CAAC,EAE5C,GAAIE,EAAe,OAAS,EAAG,CAC7B,IAAMC,EAAU;AAAA,EAClBX,EAAQ,IAAKS,GAAM,GAAGA,EAAE,IAAI,KAAKA,EAAE,OAAO,EAAE,EAAE,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA,6CAItD,OAAAG,EAAsB,QAAS,4BAA6BR,CAAK,EACjES,EAAQ,eAAgB,aAAaL,EAAS,KAAK,IAAI,CAAC,EAAE,EACnDM,EAAuBH,CAAO,CACvC,CAGA,OAAAC,EAAsB,QAAS,qBAAqBF,EAAe,CAAC,CAAC,GAAIN,CAAK,EACvEG,EAAoB,CAC7B,CCjGA,OAAS,cAAAQ,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAKrB,IAAMC,GAAuB,CAC3B,MACA,OACA,OACA,WACA,MACF,EAKA,SAASC,GAAiBC,EAA8B,CACtD,IAAMC,EAAmB,CAAC,EACpBC,EAAWL,GAAKG,EAAY,mBAAmB,EAErD,GAAI,CACF,GAAIL,GAAWO,CAAQ,EAAG,CACxB,IAAMC,EAAUP,GAAaM,EAAU,MAAM,EAE7C,QAAWE,KAAWN,GAChBK,EAAQ,SAAS,eAAeC,CAAO,EAAE,GAC3CH,EAAO,KAAK,SAASG,CAAO,8BAA8B,CAGhE,CACF,MAAQ,CAER,CAEA,OAAOH,CACT,CAKO,SAASI,GAAkBC,EAA8B,CAC9D,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCN,EAAaQ,EAAc,EAGjC,GAAI,CAAC,sDAAsD,KAAKD,CAAO,EACrE,OAAOE,EAAoB,EAI7B,GAAI,6BAA6B,KAAKF,CAAO,EAC3C,OAAOE,EAAoB,EAI7B,IAAMC,EAAWH,EAAQ,MAAM,iEAAiE,EAC1FI,EAAUD,EAAWA,EAAS,CAAC,EAAI,KAEzC,GAAI,CAACC,EACH,OAAOF,EAAoB,EAI7B,IAAMR,EAASF,GAAiBC,CAAU,EAE1C,GAAIC,EAAO,OAAS,EAAG,CACrB,IAAMW,EAAU;AAAA,EAClBX,EAAO,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA,kBAEDU,CAAO;AAAA;AAAA;AAAA,gBAGTA,CAAO,WAEnB,OAAAE,EAAsB,QAAS,6BAA8BP,CAAK,EAClEQ,EAAQ,qBAAsB,aAAaH,CAAO,EAAE,EAC7CI,EAAuBH,CAAO,CACvC,CAGA,IAAMA,EAAU,eAAeD,CAAO;AAAA;AAAA,kBAEtBA,CAAO,WAEvB,OAAAE,EAAsB,QAAS,uBAAuBF,CAAO,GAAIL,CAAK,EAC/DS,EAAuBH,CAAO,CACvC,CCpFA,IAAMI,GAA0C,CAC9C,IAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAkBL,QAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAYT,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAST,EAKA,SAASC,GAAgBC,EAAgC,CACvD,MAAI,6BAA6B,KAAKA,CAAO,EAAU,MACnD,sCAAsC,KAAKA,CAAO,EAAU,UAC5D,8BAA8B,KAAKA,CAAO,EAAU,QACjD,IACT,CAKO,SAASC,GAAqBC,EAA8B,CACjE,IAAMF,EAAUE,EAAM,WAAW,SAAW,GAG5C,GAAI,CAAC,sBAAsB,KAAKF,CAAO,EACrC,OAAOG,EAAoB,EAI7B,GAAI,0BAA0B,KAAKH,CAAO,EACxC,OAAOG,EAAoB,EAI7B,IAAMC,EAAYL,GAAgBC,CAAO,EAEzC,GAAII,GAAaN,GAAgBM,CAAS,EAAG,CAC3C,IAAMC,EAAU,wBAAwBD,CAAS;AAAA;AAAA;AAAA,EAGnDN,GAAgBM,CAAS,EAAE,MAAM,EAAG,GAAG,CAAC;AAAA;AAAA,iEAItC,OAAAE,EAAsB,QAAS,mBAAmBF,CAAS,GAAIF,CAAK,EACpEK,EAAQ,0BAA2B,SAASH,CAAS,EAAE,EAChDI,EAAuBH,CAAO,CACvC,CAGA,IAAMA,EAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oDAQhB,OAAAC,EAAsB,QAAS,0BAA2BJ,CAAK,EACxDM,EAAuBH,CAAO,CACvC,CC/FA,IAAMI,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA,gCAUhB,SAASC,GAAqBC,EAA8B,CACjE,IAAMC,EAAUD,EAAM,WAAW,SAAW,GAG5C,GAAI,CAAC,kCAAkC,KAAKC,CAAO,EACjD,OAAOC,EAAoB,EAQ7B,GAAI,EAHF,iBAAiB,KAAKD,CAAO,GAC7B,eAAe,KAAKA,CAAO,GAG3B,OAAOC,EAAoB,EAG7B,IAAMC,EAAU;AAAA;AAAA,EAEhBL,EAAc;AAAA;AAAA,mDAId,OAAAM,EAAsB,QAAS,wBAAyBJ,CAAK,EAC7DK,EAAQ,yBAA0B,oCAAoC,EAC/DC,EAAuBH,CAAO,CACvC,CCvCA,OAAS,cAAAI,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAKrB,SAASC,GAAuBC,EAA6B,CAC3D,IAAMC,EAASH,GAAKE,EAAY,UAAW,eAAgB,YAAY,EACvE,OAAOJ,GAAWK,CAAM,CAC1B,CAKA,SAASC,GAAqBF,EAA6C,CACzE,IAAMG,EAAeL,GAAKE,EAAY,UAAW,eAAgB,oBAAoB,EAErF,GAAI,CACF,GAAIJ,GAAWO,CAAY,EAEzB,OADa,KAAK,MAAMN,GAAaM,EAAc,MAAM,CAAC,EAC9C,cAAgB,CAAC,CAEjC,MAAQ,CAER,CAEA,MAAO,CAAC,CACV,CAKO,SAASC,GAAyBC,EAA8B,CACrE,IAAMC,EAAUD,EAAM,WAAW,SAAW,GACtCL,EAAaO,EAAc,EAGjC,GAAI,CAAC,qCAAqC,KAAKD,CAAO,EACpD,OAAOE,EAAoB,EAI7B,GAAI,CAACT,GAAuBC,CAAU,EACpC,OAAOQ,EAAoB,EAI7B,IAAMC,EAAQP,GAAqBF,CAAU,EAIvCU,EADgB,CAAC,QAAS,OAAQ,WAAW,EACjB,OAAQC,GAAS,CAACF,EAAME,CAAI,CAAC,EAE/D,GAAID,EAAY,OAAS,EAAG,CAC1B,IAAME,EAAU;AAAA,wBACIF,EAAY,KAAK,IAAI,CAAC;AAAA;AAAA;AAAA,EAG5CA,EAAY,IAAKG,GAAM,aAAaA,CAAC,EAAE,EAAE,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA,oDAIjD,OAAAC,EAAsB,QAAS,yBAAyBJ,EAAY,KAAK,IAAI,CAAC,GAAIL,CAAK,EACvFU,EAAQ,8BAA+B,WAAWL,EAAY,KAAK,IAAI,CAAC,EAAE,EACnEM,EAAuBJ,CAAO,CACvC,CAGA,OAAAE,EAAsB,QAAS,2BAA4BT,CAAK,EACzDG,EAAoB,CAC7B,CClEA,IAAMS,GAAuB,CAC3B,oBACA,uBACA,cACA,cACA,aACA,aAEA,yBACA,+BACA,cACA,aACA,oBACA,uBACA,sBACA,8BACF,EAKMC,GAAoB,CACxB,gBACA,gBACA,iBACA,eACA,iBACF,EAKA,SAASC,GAAWC,EAAgC,CAClD,IAAMC,EAAWD,EAAQ,MAAM,gDAAgD,EAC/E,OAAOC,EAAWA,EAAS,CAAC,EAAI,IAClC,CAKA,SAASC,GAAaC,EAAsB,CAC1C,OAAON,GAAqB,KAAMO,GAAYA,EAAQ,KAAKD,CAAG,CAAC,CACjE,CAKA,SAASE,GAAkBL,EAA0B,CACnD,OAAOF,GAAkB,KAAMM,GAAY,IAAI,OAAOA,EAAS,GAAG,EAAE,KAAKJ,CAAO,CAAC,CACnF,CAKO,SAASM,GAAmBC,EAA8B,CAC/D,IAAMP,EAAUO,EAAM,WAAW,SAAW,GAG5C,GAAI,CAAC,qBAAqB,KAAKP,CAAO,EACpC,OAAOQ,EAAoB,EAI7B,IAAML,EAAMJ,GAAWC,CAAO,EAE9B,GAAIG,GAAOD,GAAaC,CAAG,EACzB,OAAAM,EAAsB,OAAQ,gBAAgBN,CAAG,GAAII,CAAK,EAC1DG,EAAQ,uBAAwB,YAAYP,CAAG,EAAE,EAE1CQ,EACL;AAAA;AAAA,OAECR,CAAG;AAAA;AAAA;AAAA,2DAIN,EAIF,GAAIE,GAAkBL,CAAO,EAAG,CAC9B,IAAMY,EAAU;AAAA,EAClBZ,EAAQ,MAAM,EAAG,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CASnB,OAAAS,EAAsB,QAAS,2BAA4BF,CAAK,EAChEG,EAAQ,uBAAwB,2BAA2B,EACpDG,EAAuBD,CAAO,CACvC,CAGA,OAAAH,EAAsB,QAAS,kCAAmCF,CAAK,EAChEC,EAAoB,CAC7B,CCpGA,OAAS,gBAAAM,GAAc,cAAAC,OAAkB,UACzC,OAAS,WAAAC,GAAS,cAAAC,OAAkB,YAKpC,IAAMC,GAA+B,CACnC,SACA,gBACA,qBACA,qBACA,iBACA,gBACA,SACA,UACA,aACF,EAKMC,GAA4B,CAChC,iBACA,mBACA,iBACF,EAKA,SAASC,GAAgBC,EAAkBC,EAA4B,CACrE,GAAI,CAEF,IAAMC,EAAeN,GAAWI,CAAQ,EACpCA,EACAL,GAAQM,EAAYD,CAAQ,EAGhC,OAAIN,GAAWQ,CAAY,EAClBT,GAAaS,CAAY,EAG3BA,CACT,MAAQ,CACN,OAAOF,CACT,CACF,CAKA,SAASG,GAAYC,EAAiC,CACpD,QAAWC,KAAWR,GACpB,GAAIQ,EAAQ,KAAKD,CAAQ,EACvB,OAAOC,EAGX,OAAO,IACT,CAKA,SAASC,GAAaF,EAA2B,CAC/C,OAAON,GAAgB,KAAMO,GAAYA,EAAQ,KAAKD,CAAQ,CAAC,CACjE,CAKO,SAASG,GAAUC,EAA8B,CACtD,IAAMR,EAAWQ,EAAM,WAAW,WAAa,GACzCP,EAAaQ,EAAc,EAEjC,GAAI,CAACT,EACH,OAAOU,EAAoB,EAG7BC,EAAQ,aAAc,oBAAoBX,CAAQ,EAAE,EAGpD,IAAMI,EAAWL,GAAgBC,EAAUC,CAAU,EACrDU,EAAQ,aAAc,kBAAkBP,CAAQ,EAAE,EAGlD,IAAMQ,EAAiBT,GAAYC,CAAQ,EAE3C,OAAIQ,GACFC,EAAsB,OAAQ,2BAA2Bb,CAAQ,cAAcY,CAAc,IAAKJ,CAAK,EACvGG,EAAQ,aAAc,YAAYX,CAAQ,YAAYY,CAAc,EAAE,EAE/DE,EACL,iCAAiCd,CAAQ;AAAA;AAAA,iBAE9BI,CAAQ;AAAA,mBACNQ,CAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qEAQ7B,IAIEN,GAAaF,CAAQ,IACvBO,EAAQ,aAAc,sCAAsCP,CAAQ,EAAE,EACtES,EAAsB,OAAQ,6BAA6Bb,CAAQ,GAAIQ,CAAK,GAI9EK,EAAsB,QAAS,uBAAuBb,CAAQ,GAAIQ,CAAK,EAChEE,EAAoB,EAC7B,CCtHA,OAAS,cAAAK,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAgBrB,SAASC,GAAsBC,EAA4B,CACzD,OAAOF,GAAKE,EAAY,UAAW,eAAgB,YAAY,CACjE,CAKA,SAASC,GAAsBD,EAA6B,CAC1D,OAAOJ,GAAWE,GAAKE,EAAY,UAAW,cAAc,CAAC,CAC/D,CAOA,SAASE,IAAwB,CAC/B,OAAO,QAAQ,IAAI,mBAAqB,YAAY,QAAQ,GAAG,EACjE,CAKA,SAASC,GAAgBH,EAAoBI,EAAmC,CAC9E,IAAMC,EAASN,GAAsBC,CAAU,EACzCM,EAAaJ,GAAc,EAEjC,GAAI,CACF,GAAI,CAACN,GAAWS,CAAM,EACpB,OAAO,KAIT,IAAME,EADqB,KAAK,MAAMV,GAAaQ,EAAQ,MAAM,CAAC,EAC/C,OAAS,CAAC,EACvBG,EAAM,IAAI,KAAK,EAAE,YAAY,EAUnC,OAPaD,EAAM,KAChB,GACC,EAAE,YAAcH,GAChB,EAAE,cAAgBE,GAClB,EAAE,WAAaE,CACnB,GAEe,IACjB,MAAQ,CACN,OAAO,IACT,CACF,CAKO,SAASC,GAAcC,EAA8B,CAC1D,IAAMN,EAAWM,EAAM,WAAW,WAAa,GACzCV,EAAaW,EAAc,EAC3BC,EAAWF,EAAM,UAEvB,GAAI,CAACN,EACH,OAAOS,EAAoB,EAI7B,GAAI,CAACZ,GAAsBD,CAAU,EACnC,OAAOa,EAAoB,EAI7B,GAAIT,EAAS,SAAS,sBAAsB,EAC1C,OAAOS,EAAoB,EAI7B,IAAMC,EAAiBV,EAAS,WAAWJ,CAAU,EACjDI,EAAS,MAAMJ,EAAW,OAAS,CAAC,EACpCI,EAGEW,EAAeZ,GAAgBH,EAAYc,CAAc,EAE/D,OAAIC,GACFC,EACE,OACA,QAAQZ,CAAQ,cAAcW,EAAa,WAAW,GACtDL,CACF,EACAO,EAAQ,kBAAmB,YAAYb,CAAQ,cAAcW,EAAa,WAAW,EAAE,EAEhFG,EACL,QAAQd,CAAQ,0BAA0BW,EAAa,WAAW;AAAA;AAAA,oBAEpDA,EAAa,WAAW;AAAA,cAC9BA,EAAa,UAAU;AAAA;AAAA;AAAA,wCAIjC,IAIFC,EAAsB,QAAS,yBAAyBZ,CAAQ,GAAIM,CAAK,EACzEO,EAAQ,kBAAmB,sBAAsBb,CAAQ,KAAKQ,CAAQ,GAAG,EAClEC,EAAoB,EAC7B,CCxHA,OAAS,cAAAM,GAAY,gBAAAC,GAAc,iBAAAC,GAAe,aAAAC,OAAiB,UACnE,OAAS,QAAAC,GAAM,WAAAC,OAAe,YAoB9B,SAASC,GAAiBC,EAA4B,CACpD,OAAOC,GAAKD,EAAY,UAAW,eAAgB,YAAY,CACjE,CAKA,SAASE,IAAyB,CAChC,MAAO,QAAQ,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,EAAG,EAAE,CAAC,EACtE,CAOA,SAASC,IAAwB,CAC/B,OAAO,QAAQ,IAAI,mBAAqB,YAAY,QAAQ,GAAG,EACjE,CAKA,SAASC,IAA0B,CAEjC,OADe,IAAI,KAAK,KAAK,IAAI,EAAI,GAAS,EAChC,YAAY,CAC5B,CAKA,SAASC,GAAUC,EAAiC,CAClD,GAAI,CACF,GAAIC,GAAWD,CAAS,EACtB,OAAO,KAAK,MAAME,GAAaF,EAAW,MAAM,CAAC,CAErD,MAAQ,CAER,CACA,MAAO,CAAE,MAAO,CAAC,CAAE,CACrB,CAKA,SAASG,GAAUH,EAAmBI,EAA0B,CAC9D,IAAMC,EAAMC,GAAQN,CAAS,EACxBC,GAAWI,CAAG,GACjBE,GAAUF,EAAK,CAAE,UAAW,EAAK,CAAC,EAEpCG,GAAcR,EAAW,KAAK,UAAUI,EAAM,KAAM,CAAC,CAAC,CACxD,CAKA,SAASK,GACPC,EACAC,EACAC,EACiB,CACjB,IAAMC,EAAM,IAAI,KAAK,EAAE,YAAY,EAEnC,OACEH,EAAM,KACHI,GACCA,EAAE,YAAcH,GAChBG,EAAE,cAAgBF,GAClBE,EAAE,WAAaD,CACnB,GAAK,IAET,CAKA,SAASE,GACPL,EACAC,EACAC,EACiB,CACjB,IAAMC,EAAM,IAAI,KAAK,EAAE,YAAY,EAEnC,OACEH,EAAM,KACHI,GACCA,EAAE,YAAc,aAChBH,EAAS,WAAWG,EAAE,SAAS,GAC/BA,EAAE,cAAgBF,GAClBE,EAAE,WAAaD,CACnB,GAAK,IAET,CAKA,SAASG,GACPZ,EACAO,EACAC,EACAK,EACM,CAENb,EAAK,MAAQA,EAAK,MAAM,OACrBU,GAAM,EAAEA,EAAE,YAAcH,GAAYG,EAAE,cAAgBF,EACzD,EAGA,IAAMC,EAAM,IAAI,KAAK,EAAE,YAAY,EACnCT,EAAK,MAAQA,EAAK,MAAM,OAAQU,GAAMA,EAAE,WAAaD,CAAG,EAGxDT,EAAK,MAAM,KAAK,CACd,QAASR,GAAe,EACxB,UAAWe,EACX,UAAW,kBACX,YAAaC,EACb,YAAaC,EACb,WAAYf,GAAgB,EAC5B,OAAAmB,CACF,CAAC,CACH,CAKO,SAASC,GAAkBC,EAA8B,CAE9D,IAAMC,EAAcC,GAAeF,CAAK,EACxC,GAAIC,EAAa,OAAOA,EAExB,IAAMT,EAAWQ,EAAM,WAAW,WAAa,GACzCzB,EAAa4B,EAAc,EAC3BC,EAAWJ,EAAM,UAEvB,GAAI,CAACR,EACH,OAAOa,EAAoB,EAI7B,IAAMxB,EAAYP,GAAiBC,CAAU,EAGvC+B,EAAc9B,GAAKD,EAAY,WAAW,EAChD,GAAI,CAACO,GAAWN,GAAK8B,EAAa,SAAS,CAAC,EAC1C,OAAAC,EAAQ,sBAAuB,uCAAuC,EAC/DF,EAAoB,EAI7B,IAAMG,EAAiBhB,EAAS,WAAWjB,CAAU,EACjDiB,EAAS,MAAMjB,EAAW,OAAS,CAAC,EACpCiB,EAEEC,EAAaf,GAAc,EAG3BO,EAAOL,GAAUC,CAAS,EAG1B4B,EAAUb,GAAmBX,EAAK,MAAOuB,EAAgBf,CAAU,EACzE,GAAIgB,EACF,OAAAC,EACE,OACA,aAAaD,EAAQ,SAAS,cAAcA,EAAQ,WAAW,GAC/DT,CACF,EACAO,EAAQ,sBAAuB,8BAA8BE,EAAQ,WAAW,EAAE,EAE3EE,EACL,aAAaF,EAAQ,SAAS,0CAA0CA,EAAQ,WAAW;AAAA,uBAE7F,EAIF,IAAMG,EAAWtB,GAAkBL,EAAK,MAAOuB,EAAgBf,CAAU,EACzE,OAAImB,GACFF,EACE,OACA,QAAQF,CAAc,cAAcI,EAAS,WAAW,GACxDZ,CACF,EACAO,EAAQ,sBAAuB,YAAYC,CAAc,cAAcI,EAAS,WAAW,EAAE,EAEtFD,EACL,QAAQH,CAAc,0CAA0CI,EAAS,WAAW;AAAA,uBAEtF,IAIFf,GAAYZ,EAAMuB,EAAgBf,EAAY,iBAAiBW,CAAQ,EAAE,EACzEpB,GAAUH,EAAWI,CAAI,EAEzBsB,EAAQ,sBAAuB,kBAAkBC,CAAc,EAAE,EACjEE,EAAsB,QAAS,qBAAqBF,CAAc,GAAIR,CAAK,EAEpEK,EAAoB,EAC7B,CC5NA,OAAS,cAAAQ,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAUrB,IAAMC,GAA8C,CAClD,YAAa,CAAC,UAAW,aAAc,eAAe,EACtD,gBAAiB,CAAC,cAAc,EAChC,aAAc,CAAC,SAAU,aAAc,kBAAkB,EACzD,iBAAkB,CAAC,gBAAiB,YAAY,EAChD,QAAS,CAAC,CACZ,EAKA,SAASC,GAAgBC,EAA6B,CACpD,OAAW,CAACC,EAAOC,CAAQ,IAAK,OAAO,QAAQJ,EAAc,EAC3D,GAAIG,IAAU,WACVC,EAAS,KAAMC,GAAMA,EAAE,KAAKH,CAAQ,CAAC,EACvC,OAAOC,EAGX,MAAO,SACT,CAKA,SAASG,GAAiBH,EAAkBI,EAA4B,CACtE,IAAMC,EAAcT,GAAKQ,EAAY,UAAW,UAAW,UAAU,EAC/DE,EAAmBV,GAAKS,EAAa,GAAGL,CAAK,OAAO,EAE1D,GAAI,CACF,GAAIN,GAAWY,CAAgB,EAAG,CAChC,IAAMC,EAAUZ,GAAaW,EAAkB,MAAM,EAC/CL,EAAW,KAAK,MAAMM,CAAO,EAC7BC,EAAQ,MAAM,QAAQP,CAAQ,EAAIA,EAAS,OAAS,OAAO,KAAKA,CAAQ,EAAE,OAChF,GAAIO,EAAQ,EACV,MAAO,uBAAuBA,CAAK,EAEvC,CACF,MAAQ,CAER,CAEA,MAAO,EACT,CAKO,SAASC,GAA2BC,EAA8B,CACvE,IAAMX,EAAWW,EAAM,WAAW,WAAa,GACzCN,EAAaM,EAAM,aAAeC,EAAc,EAEtD,GAAI,CAACZ,EACH,OAAOa,EAAoB,EAW7B,IAAMC,EAAcC,GAAiBJ,EAAO,GAPvB,CACnB,YACA,iBACA,WACA,eACA,iBACF,CAC2D,EAC3D,GAAIG,IAAgB,KAClB,OAAOA,EAIT,IAAME,EAAYjB,GAAgBC,CAAQ,EAE1C,GAAIgB,IAAc,UAChB,OAAOH,EAAoB,EAI7B,IAAMI,EAAeb,GAAiBY,EAAWX,CAAU,EAGrDa,EAAY,CAACvB,GAAWK,CAAQ,EAGlCmB,EACJ,OAAID,EACFC,EAAc,OAAOH,CAAS,6EAA6EC,CAAY,GAEvHE,EAAc,aAAaH,CAAS,+DAA+DC,CAAY,GAGjHG,EAAsB,QAAS,yBAAyBpB,CAAQ,KAAKgB,CAAS,IAAKL,CAAK,EACxFU,EAAQ,+BAAgC,gBAAgBrB,CAAQ,WAAWgB,CAAS,GAAG,EAGhFM,EAAkBH,CAAW,CACtC,CCnGA,OAAS,cAAAI,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,GAAe,WAAAC,OAAe,YAGvC,IAAMC,EAAqB,GACrBC,GAAoB,EACpBC,GAAgC,GAKtC,SAASC,GAAWC,EAA0B,CAC5C,OAAOL,GAAQK,CAAQ,EAAE,YAAY,EAAE,QAAQ,IAAK,EAAE,CACxD,CAKA,SAASC,GAAoBC,EAAiBC,EAAuB,CACnE,IAAMC,EAAqB,CAAC,EACtBC,EAAQH,EAAQ,MAAM;AAAA,CAAI,EAEhC,GAAIC,IAAQ,KAAM,CAEhB,IAAIG,EAAa,GACbC,EAAe,GACfC,EAAgB,EAEpB,QAAWC,KAAQJ,EAAO,CACxB,IAAMK,EAAWD,EAAK,MAAM,mDAAmD,EACzEE,EAAaF,EAAK,MAAM,gBAAgB,EAE1CC,GAEEJ,GAAcE,EAAgBZ,GAChCQ,EAAS,KAAK,aAAaG,CAAY,QAAQC,CAAa,gBAAgBZ,CAAkB,GAAG,EAGnGU,EAAa,GACbC,EAAeG,EAAS,CAAC,EACzBF,EAAgB,GACPG,GAELL,GAAcE,EAAgBZ,GAChCQ,EAAS,KAAK,aAAaG,CAAY,QAAQC,CAAa,gBAAgBZ,CAAkB,GAAG,EAEnGU,EAAa,IACJA,GAELG,EAAK,KAAK,GACZD,GAGN,CAGIF,GAAcE,EAAgBZ,GAChCQ,EAAS,KAAK,aAAaG,CAAY,QAAQC,CAAa,gBAAgBZ,CAAkB,GAAG,CAErG,SAAW,CAAC,KAAM,MAAO,KAAM,MAAO,KAAM,OAAQ,IAAI,EAAE,SAASO,CAAG,EAAG,CAEvE,IAAIS,EAAa,EACbJ,EAAgB,EAChBF,EAAa,GACbC,EAAe,GAEnB,QAAWE,KAAQJ,EAAO,CAExB,IAAMQ,EAAYJ,EAAK,MAAM,iDAAiD,EACxEK,EAAiBL,EAAK,MAAM,wDAAwD,EAc1F,GAZII,GACFN,EAAeM,EAAU,CAAC,EAC1BP,EAAa,GACbE,EAAgB,EAChBI,EAAa,GACJE,IACTP,EAAeO,EAAe,CAAC,EAC/BR,EAAa,GACbE,EAAgB,EAChBI,EAAa,GAGXN,EAAY,CAEd,IAAMS,GAAcN,EAAK,MAAM,KAAK,GAAK,CAAC,GAAG,OACvCO,GAAeP,EAAK,MAAM,KAAK,GAAK,CAAC,GAAG,OAC9CG,GAAcG,EAAaC,EAEvBP,EAAK,KAAK,GACZD,IAIEI,GAAc,GAAKJ,EAAgB,IACjCA,EAAgBZ,GAClBQ,EAAS,KAAK,aAAaG,CAAY,QAAQC,CAAa,gBAAgBZ,CAAkB,GAAG,EAEnGU,EAAa,GAEjB,CACF,CACF,CAEA,OAAOF,CACT,CAKA,SAASa,GAAkBf,EAAiBC,EAAuB,CACjE,IAAMC,EAAqB,CAAC,EACtBC,EAAQH,EAAQ,MAAM;AAAA,CAAI,EAC5BgB,EAAW,EAEf,GAAIf,IAAQ,KAEV,QAAWM,KAAQJ,EAAO,CACxB,IAAMc,EAAQV,EAAK,MAAM,6DAA6D,EACtF,GAAIU,EAAO,CACT,IAAMC,EAASD,EAAM,CAAC,EAAE,OAClBE,EAAQ,KAAK,MAAMD,EAAS,CAAC,EAC/BC,EAAQH,IACVA,EAAWG,EAEf,CACF,SACS,CAAC,KAAM,MAAO,KAAM,MAAO,KAAM,OAAQ,IAAI,EAAE,SAASlB,CAAG,EAAG,CAEvE,IAAImB,EAAa,EACjB,QAAWb,KAAQJ,EAAO,CACxB,IAAMU,GAAcN,EAAK,MAAM,KAAK,GAAK,CAAC,GAAG,OACvCO,GAAeP,EAAK,MAAM,KAAK,GAAK,CAAC,GAAG,OAC9Ca,GAAcP,EAAaC,EAGvB,mCAAmC,KAAKP,CAAI,GAC1Ca,EAAaJ,IACfA,EAAWI,EAGjB,CACF,CAEA,OAAIJ,EAAWrB,IACbO,EAAS,KAAK,iCAAiCc,CAAQ,UAAUrB,EAAiB,GAAG,EAGhFO,CACT,CAKA,SAASmB,GAAkBrB,EAA2B,CACpD,IAAME,EAAqB,CAAC,EAEtBoB,GAAWtB,EAAQ,MAAM,wBAAwB,GAAK,CAAC,GAAG,OAC1DuB,GAAevB,EAAQ,MAAM,qBAAqB,GAAK,CAAC,GAAG,OAC3DwB,GAAgBxB,EAAQ,MAAM,WAAW,GAAK,CAAC,GAAG,OAElDyB,EAAoBH,EAAUC,EAAcC,EAG5CE,EAAgB,KAAK,KAAK1B,EAAQ,MAAM,6BAA6B,GAAK,CAAC,GAAG,OAAQ,CAAC,EACvF2B,EAAkB,KAAK,MAAMF,EAAoBC,CAAa,EAEpE,OAAIC,EAAkB/B,IACpBM,EAAS,KAAK,gCAAgCyB,CAAe,+CAA+C,EAGvGzB,CACT,CAKA,SAAS0B,GAAoB9B,EAAkB+B,EAA4B,CACzE,IAAMC,EAAYtC,GAAKqC,EAAY,UAAW,QAAS,kBAAkB,EAEzE,GAAI,CAACvC,GAAWwC,CAAS,EACvB,MAAO,GAGT,GAAI,CACF,IAAMC,EAAQ,KAAK,MAAMxC,GAAauC,EAAW,MAAM,CAAC,EAClDE,EAAWlC,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,GAC9C,OAAOiC,EAAMC,CAAQ,GAAK,EAC5B,MAAQ,CACN,MAAO,EACT,CACF,CAKO,SAASC,GAAgBC,EAA8B,CAC5D,IAAMpC,EAAWoC,EAAM,WAAW,WAAa,GACzClC,EAAUkC,EAAM,WAAW,SAAW,GACtCL,EAAaK,EAAM,aAAeC,EAAc,EAGhDC,EAAcC,GAAUH,EAAOI,EAAgBC,EAAiB,EACtE,GAAIH,IAAgB,KAClB,OAAOA,EAGT,GAAI,CAACtC,GAAY,CAACE,EAChB,OAAOwC,EAAoB,EAG7B,IAAMvC,EAAMJ,GAAWC,CAAQ,EACzB2C,EAAwB,CAAC,EAG/BA,EAAY,KAAK,GAAG1C,GAAoBC,EAASC,CAAG,CAAC,EACrDwC,EAAY,KAAK,GAAG1B,GAAkBf,EAASC,CAAG,CAAC,EACnDwC,EAAY,KAAK,GAAGpB,GAAkBrB,CAAO,CAAC,EAG9C,IAAM0C,EAAad,GAAoB9B,EAAU+B,CAAU,EAM3D,GALIa,GACFD,EAAY,KAAKC,CAAU,EAIzBD,EAAY,OAAS,EAAG,CAC1BE,EAAQ,oBAAqB,wBAAwB7C,CAAQ,KAAK2C,EAAY,KAAK,IAAI,CAAC,EAAE,EAE1F,IAAIG,EAAa,iBAAiBH,EAAY,KAAK,KAAK,CAAC,GAGzD,OAAIG,EAAW,OAAS,MACtBA,EAAaA,EAAW,MAAM,EAAG,GAAG,EAAI,OAGnCC,EAAkBD,CAAU,CACrC,CAEA,OAAAD,EAAQ,oBAAqB,wBAAwB7C,CAAQ,EAAE,EACxD0C,EAAoB,CAC7B,CCtPA,OAAS,WAAAM,OAAe,YAKxB,SAASC,GAAWC,EAA0B,CAC5C,OAAOF,GAAQE,CAAQ,EAAE,YAAY,EAAE,QAAQ,IAAK,EAAE,CACxD,CAKA,SAASC,GAAWD,EAA2B,CAS7C,MARqB,CACnB,QACA,QACA,aACA,aACA,cACA,aACF,EACoB,KAAME,GAAMA,EAAE,KAAKF,CAAQ,CAAC,CAClD,CAKA,SAASG,GAA4BC,EAA2B,CAC9D,IAAMC,EAAoB,CAAC,EACrBC,EAAQF,EAAQ,MAAM;AAAA,CAAI,EAEhC,QAASG,EAAI,EAAGA,EAAID,EAAM,OAAQC,IAAK,CAGrC,IAAMC,EAFOF,EAAMC,CAAC,EAEG,MAAM,qDAAqD,EAElF,GAAIC,EAAW,CACb,IAAMC,EAAWD,EAAU,CAAC,EAGxBE,EAAe,GACnB,QAASC,EAAIJ,EAAI,EAAGI,EAAIL,EAAM,OAAQK,IAAK,CACzC,IAAMC,EAAWN,EAAMK,CAAC,EAAE,KAAK,EAC/B,GAAKC,EAEL,EAAIA,EAAS,WAAW,KAAK,GAAKA,EAAS,WAAW,KAAK,KACzDF,EAAe,IAEjB,MACF,CAEA,GAAI,CAACA,IACHL,EAAQ,KAAKI,CAAQ,EACjBJ,EAAQ,QAAU,GAAG,KAE7B,CACF,CAEA,OAAOA,CACT,CAKA,SAASQ,GAAiBT,EAA2B,CACnD,IAAMC,EAAoB,CAAC,EACrBC,EAAQF,EAAQ,MAAM;AAAA,CAAI,EAE5BU,EAAW,GACf,QAASP,EAAI,EAAGA,EAAID,EAAM,OAAQC,IAAK,CACrC,IAAMQ,EAAOT,EAAMC,CAAC,GACHA,EAAI,EAAID,EAAMC,EAAI,CAAC,EAAE,KAAK,EAAI,IAGlC,SAAS,IAAI,IACxBO,EAAW,IAIb,IAAME,EAAcD,EAAK,MACvB,mGACF,EAEA,GAAIC,EAAa,CACf,IAAMP,EAAWO,EAAY,CAAC,GAAKA,EAAY,CAAC,EAEhD,GAAI,CAACF,IACHT,EAAQ,KAAKI,CAAQ,EACjBJ,EAAQ,QAAU,GAAG,MAE3BS,EAAW,EACb,MAAYC,EAAK,KAAK,EAAE,SAAS,IAAI,IACnCD,EAAW,GAEf,CAEA,OAAOT,CACT,CAKO,SAASY,GAAkBC,EAA8B,CAC9D,IAAMlB,EAAWkB,EAAM,WAAW,WAAa,GACzCd,EAAUc,EAAM,WAAW,SAAW,GAGtCC,EAAcC,GAAUF,EAAOG,EAAgBC,EAAiB,EACtE,GAAIH,IAAgB,KAClB,OAAOA,EAGT,GAAI,CAACnB,GAAY,CAACI,EAChB,OAAOmB,EAAoB,EAI7B,GAAItB,GAAWD,CAAQ,EACrB,OAAOuB,EAAoB,EAG7B,IAAMC,EAAMzB,GAAWC,CAAQ,EAC3ByB,EAA8B,CAAC,EAQnC,GANID,IAAQ,KACVC,EAAoBtB,GAA4BC,CAAO,EAC9C,CAAC,KAAM,MAAO,KAAM,KAAK,EAAE,SAASoB,CAAG,IAChDC,EAAoBZ,GAAiBT,CAAO,GAG1CqB,EAAkB,OAAS,EAAG,CAChC,IAAMC,EAAWD,EAAkB,KAAK,IAAI,EACxCE,EAEJ,OAAIH,IAAQ,KACVG,EAAa,kBAAkBF,EAAkB,MAAM,2CAA2CC,CAAQ,oEAE1GC,EAAa,kBAAkBF,EAAkB,MAAM,wCAAwCC,CAAQ,kEAIrGC,EAAW,OAAS,MAClBH,IAAQ,KACVG,EAAa,kBAAkBF,EAAkB,MAAM,yFAEvDE,EAAa,kBAAkBF,EAAkB,MAAM,iFAI3DG,EAAQ,qBAAsB,mBAAmBH,EAAkB,MAAM,8BAA8BzB,CAAQ,EAAE,EAC1G6B,EAAkBF,CAAU,CACrC,CAGA,OAAAC,EAAQ,qBAAsB,oDAAoD5B,CAAQ,EAAE,EACrFuB,EAAoB,CAC7B,CC9JA,OAAS,YAAAO,OAAgB,YAWzB,IAAMC,GAAuC,CAC3C,CACE,KAAM,sCACN,QAAS,+DACT,SAAU,MACZ,EACA,CACE,KAAM,wCACN,QAAS,4CACT,SAAU,MACZ,EACA,CACE,KAAM,qCACN,QAAS,sBACT,SAAU,MACZ,EACA,CACE,KAAM,sCACN,QAAS,iDACT,SAAU,QACZ,EACA,CACE,KAAM,0CACN,QAAS,0CACT,SAAU,QACZ,EACA,CACE,KAAM,oCACN,QAAS,mDACT,SAAU,QACZ,EACA,CACE,KAAM,8BACN,QAAS,iCACT,SAAU,MACZ,EACA,CACE,KAAM,mCACN,QAAS,sCACT,SAAU,KACZ,CACF,EAKA,SAASC,GAAqBC,EAA2B,CACvD,IAAMC,EAAmB,CAAC,EAE1B,OAAW,CAAE,KAAAC,EAAM,QAAAC,CAAQ,IAAKL,GAC1BK,EAAQ,KAAKH,CAAO,GACtBC,EAAO,KAAKC,CAAI,EAIpB,OAAOD,CACT,CAKO,SAASG,GAAyBC,EAA8B,CACrE,IAAMC,EAAWD,EAAM,WAAW,WAAa,GACzCL,EAAUK,EAAM,WAAW,SAAW,GAGtCE,EAAcC,GAAUH,EAAOI,CAAc,EACnD,GAAIF,IAAgB,KAClB,OAAOA,EAGT,GAAI,CAACD,EACH,OAAOI,EAAoB,EAI7B,IAAMC,EAAiBZ,GAAqBC,CAAO,EAEnD,GAAIW,EAAe,OAAS,EAAG,CAC7BC,EAAQ,6BAA8B,kBAAkBN,CAAQ,MAAMK,EAAe,KAAK,IAAI,CAAC,EAAE,EAGjG,IAAME,EAAa,yBAAyBhB,GAASS,CAAQ,CAAC,KAAKK,EAAe,KAAK,IAAI,CAAC,GAC5F,OAAAG,EAAsB,OAAQ,sBAAsBR,CAAQ,KAAKK,EAAe,KAAK,IAAI,CAAC,GAAIN,CAAK,EAG5FU,EAAkBF,CAAU,CACrC,CAEA,OAAAD,EAAQ,6BAA8B,gBAAgBN,CAAQ,EAAE,EAChEQ,EAAsB,QAAS,yBAAyBR,CAAQ,GAAID,CAAK,EAClEK,EAAoB,CAC7B,CCvGA,OAAS,cAAAM,GAAY,gBAAAC,GAA6B,kBAAAC,GAAgB,YAAAC,GAAU,cAAAC,GAAY,aAAAC,OAAiB,UACzG,OAAS,QAAAC,OAAY,YAErB,IAAMC,GAAe,OAKrB,SAASC,IAA0B,CACjC,IAAMC,EAASC,EAAU,EACzB,OAAOJ,GAAKG,EAAQ,wBAAwB,CAC9C,CAKA,SAASE,GAAkBC,EAAuB,CAChD,GAAI,CACEZ,GAAWY,CAAO,GACNT,GAASS,CAAO,EACpB,KAAOL,IACfH,GAAWQ,EAAS,GAAGA,CAAO,MAAM,CAG1C,MAAQ,CAER,CACF,CAKA,SAASC,GAAsBD,EAAyB,CACtD,GAAI,CAACZ,GAAWY,CAAO,EACrB,MAAO,GAGT,GAAI,CAEF,IAAME,EADUb,GAAaW,EAAS,MAAM,EACtB,KAAK,EAAE,MAAM;AAAA,CAAI,EAAE,OAAO,OAAO,EAEjDG,EAAeD,EAAM,OAC3B,GAAIC,IAAiB,EACnB,MAAO,GAIT,IAAMC,EAAa,IAAI,IACvB,QAAWC,KAAQH,EAAO,CACxB,IAAMI,EAAQD,EAAK,MAAM,kBAAkB,EACvCC,GAASA,EAAM,CAAC,GAAKA,EAAM,CAAC,IAAM,IACpCF,EAAW,IAAIE,EAAM,CAAC,CAAC,CAE3B,CAGA,IAAMC,EAA4B,CAAC,EACnC,QAASC,EAAIN,EAAM,OAAS,EAAGM,GAAK,GAAKD,EAAgB,OAAS,EAAGC,IAAK,CACxE,IAAMF,EAAQJ,EAAMM,CAAC,EAAE,MAAM,kBAAkB,EAC3CF,GAASA,EAAM,CAAC,GAAK,CAACC,EAAgB,SAASD,EAAM,CAAC,CAAC,GACzDC,EAAgB,KAAKD,EAAM,CAAC,CAAC,CAEjC,CAEA,IAAMG,EAAYF,EAAgB,OAAS,EAAIA,EAAgB,KAAK,IAAI,EAAI,OAC5E,MAAO,aAAaJ,CAAY,aAAaC,EAAW,IAAI,uBAAuBK,CAAS,EAC9F,MAAQ,CACN,MAAO,EACT,CACF,CAKO,SAASC,GAAgBC,EAA8B,CAC5D,IAAMC,EAAWD,EAAM,WAAa,GAGpC,GAAI,CAACC,EAAS,WAAW,iBAAiB,EACxC,OAAOC,EAAoB,EAG7B,IAAMC,EAAaH,EAAM,WAAW,WAAwB,GACtDI,EAASJ,EAAM,WAAW,OAAoB,GAG9Cd,EAASC,EAAU,EACzB,GAAI,CACFL,GAAUI,EAAQ,CAAE,UAAW,EAAK,CAAC,CACvC,MAAQ,CAER,CAEA,IAAMmB,EAAepB,GAAgB,EACrCG,GAAkBiB,CAAY,EAI9B,IAAMC,EAAW,GADC,IAAI,KAAK,EAAE,YAAY,CACZ,WAAWL,CAAQ,cAAcE,CAAS,mBAAmBC,EAAM,MAAM;AAAA,EAEtG,GAAI,CACFzB,GAAe0B,EAAcC,CAAQ,CACvC,MAAQ,CAER,CAGA,IAAMC,EAAejB,GAAsBe,CAAY,EAMvD,OAJAG,EAAsB,QAAS,yBAAyBL,CAAS,GAAIH,CAAK,EAC1ES,EAAQ,mBAAoB,UAAUR,CAAQ,YAAYE,CAAS,EAAE,EAGjEI,EACKG,EAAkBH,CAAY,EAGhCL,EAAoB,CAC7B,CC7GA,OAAS,cAAAS,GAAY,aAAAC,GAAW,gBAAAC,GAAc,iBAAAC,GAAe,eAAAC,OAAmB,UAChF,OAAS,QAAAC,OAAY,YAKrB,SAASC,GAAsBC,EAAoBC,EAAkC,CACnF,IAAMC,EAAUJ,GAAKE,EAAY,UAAW,MAAM,EAC9CG,EAAgB,EAEpB,GAAI,CAACV,GAAWS,CAAO,EACrB,MAAO,GAGT,GAAI,CACF,IAAME,EAAQP,GAAYK,CAAO,EACjC,QAAWG,KAAQD,EACjB,GAAIC,EAAK,WAAW,qBAAqB,GAAKA,EAAK,SAAS,OAAO,EAAG,CAEpE,IAAMC,EAAYD,EAAK,QAAQ,sBAAuB,EAAE,EAAE,QAAQ,QAAS,EAAE,EACzEC,IAAcL,GAAoBK,IAAc,WAClDH,GAEJ,CAEJ,MAAQ,CAER,CAEA,OAAOA,CACT,CAKA,SAASI,GAAgBP,EAA0B,CACjD,IAAMQ,EAAO,CACXV,GAAKE,EAAY,UAAW,OAAQ,gBAAgB,EACpDF,GAAKE,EAAY,UAAW,UAAW,SAAS,CAClD,EAEA,QAAWS,KAAOD,EAChB,GAAI,CACFd,GAAUe,EAAK,CAAE,UAAW,EAAK,CAAC,CACpC,MAAQ,CAER,CAEJ,CAKA,SAASC,IAA0C,CAEjD,OAAI,QAAQ,IAAI,aACP,WAEF,OACT,CAKA,SAASC,GAAgBX,EAAoBM,EAAyB,CACpE,IAAMM,EAAkBd,GAAKE,EAAY,UAAW,OAAQ,8BAA8B,EACpFa,EAAM,IAAI,KAAK,EAAE,YAAY,EAEnC,GAAI,CACFnB,GAAUI,GAAKE,EAAY,UAAW,MAAM,EAAG,CAAE,UAAW,EAAK,CAAC,EAElE,IAAIc,EAAmE,CAAC,EAExE,GAAIrB,GAAWmB,CAAe,EAAG,CAC/B,IAAMG,EAAUpB,GAAaiB,EAAiB,MAAM,EAEpDE,EADa,KAAK,MAAMC,CAAO,EACf,UAAY,CAAC,CAC/B,CAEAD,EAASR,CAAS,EAAI,CAAE,OAAQ,GAAM,UAAWO,CAAI,EACrDjB,GAAcgB,EAAiB,KAAK,UAAU,CAAE,SAAAE,CAAS,EAAG,KAAM,CAAC,CAAC,CACtE,MAAQ,CAER,CACF,CAKO,SAASE,GAAiBC,EAA8B,CAC7D,IAAMjB,EAAaiB,EAAM,aAAeC,EAAc,EAChDZ,EAAYW,EAAM,YAAcE,EAAa,EAEnDC,EAAQ,qBAAsB,6CAA6C,EAG3Eb,GAAgBP,CAAU,EAC1BW,GAAgBX,EAAYM,CAAS,EAGrC,IAAMH,EAAgBJ,GAAsBC,EAAYM,CAAS,EAG3De,EAASX,GAAkB,EAEjCU,EAAQ,qBAAsB,mCAAmCC,CAAM,cAAclB,CAAa,EAAE,EAGpG,IAAImB,EAAM,GAeV,OAZInB,EAAgB,IAClBmB,EAAM,4BAA4BnB,CAAa;AAAA,qDAI7CkB,IAAW,WACbD,EAAQ,qBAAsB,+CAA+C,EAE7EA,EAAQ,qBAAsB,kCAAkC,EAI9DE,EACKC,EAAkBD,CAAG,EAIvBE,EAAoB,CAC7B,CCvIO,SAASC,GAAgBC,EAA8B,CAC5D,IAAMC,EAAWD,EAAM,WAAa,GAGpC,GAAI,CAACC,EAAS,WAAW,eAAe,EACtC,OAAOC,EAAoB,EAG7B,OAAQD,EAAU,CAChB,IAAK,+BAAgC,CAEnC,IAAME,EAAcH,EAAM,WAAW,YAC/BI,EAAc,MAAM,QAAQD,CAAW,EAAIA,EAAY,OAAS,EAEtE,GAAIC,EAAc,EAChB,OAAAC,EAAsB,OAAQ,gBAAgBD,CAAW,YAAaJ,CAAK,EAC3EM,EAAQ,mBAAoB,6BAA6BF,CAAW,WAAW,EAGxEG,EAAc,YAAYH,CAAW,gCAAgC,EAE9E,KACF,CAEA,IAAK,gCAAiC,CAEpC,IAAMI,EAAYR,EAAM,WAAW,UAC7BS,EAAgB,MAAM,QAAQD,CAAS,EAAIA,EAAU,OAAS,EAEpE,GAAIC,EAAgB,GAClB,OAAAJ,EAAsB,OAAQ,yBAAyBI,CAAa,aAAcT,CAAK,EACvFM,EAAQ,mBAAoB,+BAA+BG,CAAa,YAAY,EAE7EF,EAAc,YAAYE,CAAa,iCAAiC,EAEjF,KACF,CAEA,IAAK,+BAAgC,CAEnC,IAAMC,EAAWV,EAAM,WAAW,SAClC,GAAI,CAAC,MAAM,QAAQU,CAAQ,EACzB,OAAAL,EAAsB,QAAS,sCAAuCL,CAAK,EACpEE,EAAoB,EAG7B,IAAME,EAAcM,EAAS,OAGvBC,EAAeD,EAAS,OAC3BE,GAA+B,CAACA,EAAE,MAAQA,EAAE,OAAS,IAAM,CAACA,EAAE,YAAcA,EAAE,aAAe,EAChG,EAAE,OAEF,GAAID,EAAe,EACjB,OAAAN,EAAsB,OAAQ,qBAAqBM,CAAY,8BAA+BX,CAAK,EACnGM,EAAQ,mBAAoB,SAASK,CAAY,mCAAmC,EAE7EJ,EAAc,GAAGI,CAAY,sDAAsD,EAG5FN,EAAsB,QAAS,YAAYD,CAAW,kBAAmBJ,CAAK,EAC9E,KACF,CAEA,IAAK,gCAAiC,CAEpC,IAAMQ,EAAYR,EAAM,WAAW,UACnC,GAAI,CAAC,MAAM,QAAQQ,CAAS,EAC1B,OAAAH,EAAsB,QAAS,uCAAwCL,CAAK,EACrEE,EAAoB,EAG7B,IAAMO,EAAgBD,EAAU,OAG1BG,EAAeH,EAAU,OAC5B,GAA+B,CAAC,EAAE,MAAQ,CAAC,EAAE,IAAM,CAAC,EAAE,YACzD,EAAE,OAEF,GAAIG,EAAe,EACjB,OAAAN,EAAsB,OAAQ,sBAAsBM,CAAY,gCAAiCX,CAAK,EACtGM,EAAQ,mBAAoB,SAASK,CAAY,oCAAoC,EAE9EJ,EAAc,GAAGI,CAAY,oCAAoC,EAG1EN,EAAsB,QAAS,YAAYI,CAAa,mBAAoBT,CAAK,EACjF,KACF,CAEA,QAEEK,EAAsB,QAAS,mBAAmBJ,CAAQ,GAAID,CAAK,EACnE,KACJ,CAEA,OAAOE,EAAoB,CAC7B,CCrGA,OAAS,cAAAW,GAAY,kBAAAC,GAAgB,YAAAC,GAAU,cAAAC,GAAY,aAAAC,OAAiB,UAC5E,OAAS,QAAAC,OAAY,YAErB,IAAMC,GAAe,OAKrB,SAASC,IAAyB,CAChC,IAAMC,EAASC,EAAU,EACzB,OAAOJ,GAAKG,EAAQ,yBAAyB,CAC/C,CAKA,SAASE,GAAkBC,EAAuB,CAChD,GAAI,CACEX,GAAWW,CAAO,GACNT,GAASS,CAAO,EACpB,KAAOL,IACfH,GAAWQ,EAAS,GAAGA,CAAO,MAAM,CAG1C,MAAQ,CAER,CACF,CAKO,SAASC,GAAuBC,EAA8B,CAInE,GAAI,EAHaA,EAAM,WAAa,IAGtB,WAAW,4BAA4B,EACnD,OAAOC,EAAoB,EAI7B,IAAMC,EAAWF,EAAM,WAAW,SAAsB,GAClDG,EAAiBH,EAAM,WAAW,eAA4B,EAC9DI,EAAiBJ,EAAM,WAAW,eAA4B,EAC9DK,EAAcL,EAAM,WAAW,mBAAiC,GAChEM,EAAcN,EAAM,WAAW,YAA0B,GAGzDL,EAASC,EAAU,EACzB,GAAI,CACFL,GAAUI,EAAQ,CAAE,UAAW,EAAK,CAAC,CACvC,MAAQ,CAER,CAEA,IAAMY,EAAcb,GAAe,EACnCG,GAAkBU,CAAW,EAI7B,IAAMC,EAAW,GADC,IAAI,KAAK,EAAE,YAAY,CACZ,WAAWL,CAAa,IAAIC,CAAa,eAAeE,CAAU,kBAAkBD,CAAU,qBAAqBH,EAAQ,MAAM;AAAA,EAE9J,GAAI,CACFd,GAAemB,EAAaC,CAAQ,CACtC,MAAQ,CAER,CAGA,OAAIL,IAAkB,GACpBM,EAAsB,QAAS,6BAA6BL,CAAa,uBAAwBJ,CAAK,EACtGU,EAAQ,2BAA4B,mBAAmBN,CAAa,WAAW,GACtEE,GACTG,EAAsB,QAAS,oBAAoBN,CAAa,GAAIH,CAAK,EACzEU,EAAQ,2BAA4B,oBAAoBP,CAAa,EAAE,GAC7DE,GAIVI,EAAsB,QAAS,kBAAkBN,CAAa,IAAIC,CAAa,GAAIJ,CAAK,EACxFU,EAAQ,2BAA4B,QAAQP,CAAa,IAAIC,CAAa,EAAE,IAJ5EK,EAAsB,QAAS,qCAAqCN,CAAa,GAAIH,CAAK,EAC1FU,EAAQ,2BAA4B,qBAAqBP,CAAa,EAAE,GAMnEF,EAAoB,CAC7B,CCzFA,OAAS,cAAAU,OAAkB,UAC3B,OAAS,WAAAC,OAAe,YAKxB,SAASC,IAAyB,CAChC,OAAO,IAAI,KAAK,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,CAC9C,CAKA,SAASC,GAAUC,EAAaC,EAAyB,CACvD,IAAMC,EAAOJ,GAAe,EAE5B,OAAQE,EAAI,YAAY,EAAG,CACzB,IAAK,KACH,MAAO;AAAA,aACAE,CAAI;AAAA;AAAA,EAEfD,CAAO,GAEL,IAAK,KACL,IAAK,KACH,MAAO;AAAA,cACCC,CAAI;AAAA;AAAA,EAEhBD,CAAO,GAEL,IAAK,KAAM,CAET,GAAIA,EAAQ,WAAW,KAAK,EAAG,CAC7B,IAAME,EAAeF,EAAQ,QAAQ;AAAA,CAAI,EACnCG,EAAUH,EAAQ,MAAM,EAAGE,CAAY,EACvCE,EAAOJ,EAAQ,MAAME,EAAe,CAAC,EAC3C,MAAO,GAAGC,CAAO;AAAA;AAAA,aAEZF,CAAI;AAAA;AAAA,EAEfG,CAAI,EACA,CACA,MAAO;AAAA;AAAA,aAEAH,CAAI;AAAA;AAAA,EAEfD,CAAO,EACL,CAEA,IAAK,MACH,MAAO;AAAA,cACCC,CAAI;AAAA;AAAA,EAEhBD,CAAO,GAEL,IAAK,OACL,IAAK,MACH,MAAO,gDAAgDC,CAAI;AAAA;AAAA,EAE/DD,CAAO,GAEL,IAAK,MACL,IAAK,OACL,IAAK,OACH,MAAO,8CAA8CC,CAAI;AAAA;AAAA,EAE7DD,CAAO,GAEL,IAAK,OACL,IAAK,MACH,MAAO;AAAA,aACAC,CAAI;AAAA;AAAA,EAEfD,CAAO,GAEL,IAAK,OAEH,OAAOA,EAET,QAEE,OAAOA,CACX,CACF,CAqBO,SAASK,GAAaC,EAA8B,CACzD,IAAMC,EAAWD,EAAM,WAAa,GAC9BE,EAAWF,EAAM,WAAW,WAAa,GACzCG,EAAUH,EAAM,WAAW,SAAW,GAG5C,GAAIC,IAAa,QACf,OAAOG,EAAoB,EAI7B,GAAIC,GAAWH,CAAQ,EACrB,OAAOE,EAAoB,EAI7B,IAAME,EAAMC,GAAQL,CAAQ,EAAE,QAAQ,IAAK,EAAE,EAG7C,OAAIC,EAAQ,SAAS,YAAY,GAC/BK,EAAQ,gBAAiB,uBAAuBN,CAAQ,kCAAkC,EACnFE,EAAoB,IAINK,GAAUH,EAAKH,CAAO,IACNA,GAGrCK,EAAQ,gBAAiB,mBAAmBN,CAAQ,EAAE,EAKjD,CACL,SAAU,GACV,eAAgB,GAChB,mBAAoB,CAClB,cAAe,aACf,mBAAoB,OACtB,CACF,EACF,CC1IA,OAAS,cAAAQ,GAAY,kBAAAC,GAAgB,aAAAC,OAAiB,UACtD,OAAS,QAAAC,GAAM,WAAAC,GAAS,YAAAC,OAAgB,YAKxC,SAASC,GAAUC,EAAmB,CACpC,GAAI,CACGP,GAAWO,CAAG,GACjBL,GAAUK,EAAK,CAAE,UAAW,EAAK,CAAC,CAEtC,MAAQ,CAER,CACF,CAKA,SAASC,GAAWC,EAAcC,EAAuB,CACvD,GAAI,CACFJ,GAAUF,GAAQK,CAAI,CAAC,EACvBR,GAAeQ,EAAMC,CAAO,CAC9B,MAAQ,CAER,CACF,CAKO,SAASC,GAAaC,EAA8B,CACzD,IAAMC,EAAaD,EAAM,WAAW,OAAoB,GAClDE,EAAaF,EAAM,WAAW,MAAmB,GACjDG,EAAaH,EAAM,aAAeI,EAAc,EAEtD,GAAI,CAACH,EACH,OAAOI,EAAoB,EAG7BC,EAAQ,gBAAiB,qBAAqBL,CAAS,GAAGC,EAAY,WAAWA,CAAS,IAAM,EAAE,EAAE,EAGpG,IAAMK,EAAWhB,GAAKY,EAAY,UAAW,OAAQ,iBAAiB,EAChEK,EAAY,IAAI,KAAK,EAAE,YAAY,EACzCZ,GAAWW,EAAU,GAAGC,CAAS,MAAMP,CAAS,MAAMC,GAAa,SAAS;AAAA,CAAI,EAGhF,IAAMO,EAAelB,GAAKY,EAAY,UAAW,OAAQ,uBAAuB,EAC1EO,EAAiB,KAAK,UAAU,CACpC,MAAOT,EACP,KAAMC,GAAa,GACnB,UAAAM,EACA,QAASf,GAASU,CAAU,EAC5B,MAAO,OACT,CAAC,EACD,OAAAP,GAAWa,EAAcC,EAAiB;AAAA,CAAI,EAE9CJ,EAAQ,gBAAiB,0BAA0BL,CAAS,EAAE,EAGvDI,EAAoB,CAC7B,CCjEO,SAASM,GAAkBC,EAA8B,CAE9D,IAAMC,EAAQC,GAAiBF,CAAK,EACpC,GAAIC,EAAO,OAAOA,EAElB,IAAME,EAAWH,EAAM,WAAW,UAClC,GAAI,CAACG,EAAU,OAAOC,EAAoB,EAG1C,GAAI,CAACD,EAAS,SAAS,OAAO,GAAK,CAACA,EAAS,SAAS,WAAW,EAC/D,OAAOC,EAAoB,EAG7B,IAAMC,EAAWF,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,GACxCG,EAAUH,EAAS,UAAU,EAAGA,EAAS,YAAY,GAAG,CAAC,EACzDI,EAAmB,CAAC,EAG1B,GAAIF,IAAa,cAAe,OAAOD,EAAoB,EAG3D,GAAIE,EAAQ,SAAS,UAAU,GAAKA,EAAQ,SAAS,WAAW,EAAG,CACjE,IAAME,EAAqB,iCACrBC,EAAc,+CAChB,CAACD,EAAmB,KAAKH,CAAQ,GAAK,CAACI,EAAY,KAAKJ,CAAQ,IAClEE,EAAO,KAAK,mDAAmD,EAC/DA,EAAO,KAAK,UAAUF,CAAQ,EAAE,EAChCE,EAAO,KAAK,yDAAyD,EAEzE,CAGA,GAAID,EAAQ,SAAS,WAAW,GAAKA,EAAQ,SAAS,YAAY,EAAG,CACnE,IAAMI,EAAsB,gBACtBD,EAAc,sCAChB,CAACC,EAAoB,KAAKL,CAAQ,GAAK,CAACI,EAAY,KAAKJ,CAAQ,IACnEE,EAAO,KAAK,8DAA8D,EAC1EA,EAAO,KAAK,UAAUF,CAAQ,EAAE,EAChCE,EAAO,KAAK,6CAA6C,EAE7D,CAGA,GAAID,EAAQ,SAAS,eAAe,GAAKA,EAAQ,SAAS,gBAAgB,EAAG,CAC3E,IAAMK,EAAmB,0BACnBF,EAAc,8BAChB,CAACE,EAAiB,KAAKN,CAAQ,GAAK,CAACI,EAAY,KAAKJ,CAAQ,IAChEE,EAAO,KAAK,wEAAwE,EACpFA,EAAO,KAAK,UAAUF,CAAQ,EAAE,EAChCE,EAAO,KAAK,iDAAiD,EAEjE,CAGA,GAAID,EAAQ,SAAS,UAAU,GAAKA,EAAQ,SAAS,WAAW,EAAG,CACjE,IAAMM,EAAqB,sCACrBH,EAAc,mCAChB,CAACG,EAAmB,KAAKP,CAAQ,GAAK,CAACI,EAAY,KAAKJ,CAAQ,IAClEE,EAAO,KAAK,yDAAyD,EACrEA,EAAO,KAAK,UAAUF,CAAQ,EAAE,EAChCE,EAAO,KAAK,gEAAgE,EAEhF,CAGA,GAAID,EAAQ,SAAS,SAAS,GAAKA,EAAQ,SAAS,UAAU,EAAG,CAC/D,IAAMO,EAAoB,2BACpBJ,EAAc,+BAChB,CAACI,EAAkB,KAAKR,CAAQ,GAAK,CAACI,EAAY,KAAKJ,CAAQ,IACjEE,EAAO,KAAK,uDAAuD,EACnEA,EAAO,KAAK,UAAUF,CAAQ,EAAE,EAChCE,EAAO,KAAK,wDAAwD,EAExE,CASA,GANI,uBAAuB,KAAKF,CAAQ,IACtCE,EAAO,KAAK,4DAA4D,EACxEA,EAAO,KAAK,UAAUF,CAAQ,EAAE,GAI9BE,EAAO,OAAS,EAAG,CACrB,IAAMO,EAAS,+BAA+BT,CAAQ,KAAKE,EAAO,CAAC,CAAC,GACpE,OAAAQ,EAAQ,sBAAuB,YAAYD,CAAM,EAAE,EAC5CE,EAAYF,CAAM,CAC3B,CAEA,OAAOV,EAAoB,CAC7B,CCrFA,OAAS,YAAAa,OAAgB,gBACzB,OAAS,gBAAAC,GAAc,cAAAC,OAAkB,KACzC,OAAS,QAAAC,OAAY,OAMrB,IAAMC,GAAoB,IACpBC,GAAkB,MAGlBC,GAAsB,CAC1B,UAAW,QAAS,WAAY,WAAY,cAC5C,gBAAiB,WAAY,YAAa,kBAC1C,iBAAkB,aACpB,EAGMC,GAAe,CACnB,oBAAqB,2BAA4B,wBACjD,mBAAoB,iBAAkB,qBAAsB,iBAC5D,yBAA0B,oBAAqB,gBAC/C,iBAAkB,2BAA4B,0BAChD,EAGMC,GAAqB,CACzB,aAAc,WAAY,WAAY,QAAS,UAAW,SAC1D,UAAW,SAAU,QAAS,UAAW,SACzC,QAAS,MAAO,UAAW,aAAc,SACzC,MAAO,QAAS,WAAY,YAAa,YAAa,WACtD,SAAU,aAAc,YAAa,MAAO,MAC5C,SAAU,OAAQ,SAAU,aAAc,KAC5C,EAGMC,GAAiB,CACrB,oBAAqB,qBAAsB,gBAAiB,qBAC5D,uBAAwB,iBAAkB,OAAQ,eAClD,kBAAmB,gBAAiB,qBACpC,UAAW,cAAe,MAAO,iBACnC,EAGMC,GAA6C,CACjD,CAAC,oBAAqB,qCAAqC,EAC3D,CAAC,iBAAkB,qBAAqB,EACxC,CAAC,uBAAwB,sCAAsC,EAC/D,CAAC,gBAAiB,yBAAyB,EAC3C,CAAC,kBAAmB,iCAAiC,EACrD,CAAC,iBAAkB,kBAAkB,EACrC,CAAC,OAAQ,kCAAkC,EAC3C,CAAC,cAAe,YAAY,CAC9B,EAGMC,GAAkB,CAAC,WAAY,WAAY,WAAY,YAAa,eAAgB,YAAY,EAChGC,GAAoB,CAAC,WAAY,WAAY,UAAW,SAAU,UAAW,KAAK,EAgBpFC,GAAqC,KAEzC,SAASC,IAAuB,CAC9B,GAAI,QAAQ,IAAI,oBAAqB,OAAO,QAAQ,IAAI,oBACxD,GAAI,CAEF,IAAMC,EADSf,GAAS,+BAAgC,CAAE,SAAU,QAAS,QAAS,GAAK,CAAC,EACvE,MAAM,iBAAiB,EAC5C,GAAIe,EAAO,OAAOA,EAAM,CAAC,CAC3B,MAAQ,CAAe,CACvB,MAAO,QACT,CAEA,SAASC,IAA2B,CAClC,GAAIH,GAAqB,OAAOA,GAChC,GAAI,CACF,IAAMI,EAAaC,EAAc,EAC3BC,EAAOhB,GAAKc,EAAY,iBAAkB,aAAa,EAC7D,GAAIf,GAAWiB,CAAI,EAEjB,OAAAN,GADgB,KAAK,MAAMZ,GAAakB,EAAM,OAAO,CAAC,EACvB,SAAsB,UAC9CN,EAEX,MAAQ,CAAe,CACvB,OAAAA,GAAsB,UACfA,EACT,CAMA,SAASO,GAAgBC,EAAiC,CACxD,IAAMC,EAAYD,EAAK,YAAY,EACnC,MAAO,CACL,OAAQ,CAAC,GAAG,IAAI,IAAId,GAAa,OAAOgB,GAAKD,EAAU,SAASC,CAAC,CAAC,CAAC,CAAC,EACpE,aAAc,CAAC,GAAG,IAAI,IAAIf,GAAmB,OAAOgB,GAAKF,EAAU,SAASE,CAAC,CAAC,CAAC,CAAC,EAChF,SAAU,CAAC,GAAG,IAAI,IAAIf,GAAe,OAAOgB,GAAKH,EAAU,SAASG,CAAC,CAAC,CAAC,CAAC,CAC1E,CACF,CAEA,SAASC,GAAmBL,EAAsB,CAChD,IAAMG,EAAIH,EAAK,YAAY,EAC3B,MAAI,6BAA6B,KAAKG,CAAC,EAAU,aAC7C,yBAAyB,KAAKA,CAAC,EAAU,aACzC,qBAAqB,KAAKA,CAAC,EAAU,WACrC,wBAAwB,KAAKA,CAAC,EAAU,iBACrC,YACT,CAMA,SAASG,GAAmBC,EAAyB,CACnD,IAAMC,EAAQD,EAAO,YAAY,EACjC,OAAOtB,GAAoB,KAAKwB,GAAOD,EAAM,SAASC,CAAG,CAAC,CAC5D,CAEA,SAASC,GAAiBH,EAA0B,CAClD,IAAMI,EAAsB,CAAC,EAC7B,QAAWC,KAAa3B,GAAqB,CAC3C,IAAM4B,EAAQ,IAAI,OAAO,UAAUD,CAAS,UAAW,IAAI,EACrDE,EAAUP,EAAO,MAAMM,CAAK,EAClC,GAAIC,EACF,QAAWpB,KAASoB,EAAQ,MAAM,EAAG,CAAC,EAAG,CACvC,IAAMC,EAAUrB,EAAM,KAAK,EAAE,MAAM,EAAG,GAAG,EACrCqB,EAAQ,OAAS,IAAIJ,EAAU,KAAKI,CAAO,CACjD,CAEJ,CACA,MAAO,CAAC,GAAG,IAAI,IAAIJ,CAAS,CAAC,EAAE,MAAM,EAAG,CAAC,CAC3C,CAEA,SAASK,GAAehB,EAAsB,CAC5C,IAAMG,EAAIH,EAAK,MAAM,EAAGhB,EAAe,EAAE,YAAY,EACrD,MAAI,2BAA2B,KAAKmB,CAAC,EAAU,aAC3C,+BAA+B,KAAKA,CAAC,EAAU,WAC/C,+BAA+B,KAAKA,CAAC,EAAU,WAC/C,4BAA4B,KAAKA,CAAC,EAAU,MAC5C,uBAAuB,KAAKA,CAAC,EAAU,iBACvC,0BAA0B,KAAKA,CAAC,EAAU,UAC1C,iCAAiC,KAAKA,CAAC,EAAU,aACjD,qCAAqC,KAAKA,CAAC,EAAU,gBACrD,6BAA6B,KAAKA,CAAC,EAAU,WAC7C,8BAA8B,KAAKA,CAAC,EAAU,QAC9C,8BAA8B,KAAKA,CAAC,EAAU,eAC3C,UACT,CAEA,SAASc,GAAiBjB,EAAyC,CACjE,IAAMG,EAAIH,EAAK,YAAY,EAC3B,OAAIV,GAAgB,KAAK4B,GAAKf,EAAE,SAASe,CAAC,CAAC,EAAU,OACjD3B,GAAkB,KAAK2B,GAAKf,EAAE,SAASe,CAAC,CAAC,EAAU,SAChD,KACT,CAEA,SAASC,GAAoBnB,EAA6B,CACxD,OAAW,CAACoB,EAAMC,CAAO,IAAKhC,GAC5B,GAAIgC,EAAQ,KAAKrB,CAAI,EAAG,OAAOoB,EAEjC,OAAO,IACT,CAMO,SAASE,GAAkBC,EAA8B,CAC9D,IAAMC,EAAaD,EAAc,YAAcA,EAAM,YAAY,OAAS,GACpEE,EAAaF,EAAM,YACnBG,EAAc,OAAOD,GAAe,SACtCA,EACCA,GAAY,SAAYF,EAAc,QAAU,GAErD,GAAI,CAACG,GAAeA,EAAY,OAAS3C,GACvC,OAAO4C,EAAoB,EAG7B,GAAI,CAACrB,GAAmBoB,CAAW,EACjC,OAAOC,EAAoB,EAI7B,IAAMhB,EAAYD,GAAiBgB,CAAW,EACxCE,EAAW7B,GAAgB2B,CAAW,EACtCG,EAAgBD,EAAS,OAAO,OAASA,EAAS,aAAa,OAASA,EAAS,SAAS,OAEhG,GAAIjB,EAAU,SAAW,GAAKkB,IAAkB,EAC9C,OAAOF,EAAoB,EAI7B,IAAMG,EAAkB,CAAC,EACnBC,EAAgBpB,EAAU,CAAC,GAAKe,EAAY,MAAM,EAAG,GAAG,EACxDM,EAAWhB,GAAee,CAAa,EAG7C,GAAIpB,EAAU,OAAS,EAAG,CACxB,IAAMsB,EAAahB,GAAiBc,CAAa,EAC3CG,EAAef,GAAoBY,CAAa,EAChDI,EAAY1C,GAAa,EACzB2C,EAAgBzC,GAAiB,EAEjC0C,EAAoC,CACxC,SAAAL,EACA,OAAQ,oBACR,MAAOR,GAAa,UACpB,WAAYW,EACZ,eAAgBC,EAChB,WAAAH,EACA,UAAW,IAAI,KAAK,EAAE,YAAY,CACpC,EACIC,IAAcG,EAAS,cAAgBH,GAG3C,IAAMI,EAAa,GADAzC,EAAc,CACD,iDAEhCiC,EAAM,KAAK,qBAAqBnB,EAAU,MAAM,yBAAyBqB,CAAQ,iBAAiBC,CAAU;AAAA;AAAA;AAAA,OAGzGK,CAAU,sEAAsE,KAAK,UAAUD,CAAQ,CAAC;AAAA;AAAA,YAEnGN,EAAc,MAAM,EAAG,GAAG,CAAC,MAAM,CAC3C,CAGA,GAAIF,EAAgB,EAAG,CACrB,IAAMU,EAAelC,GAAmBqB,CAAW,EAC7Cc,EAAa,CACjB,GAAGZ,EAAS,OAAO,IAAI1B,IAAM,CAAE,KAAMA,EAAG,WAAY,QAAS,aAAc,CAAC,UAAUA,CAAC,EAAE,CAAE,EAAE,EAC7F,GAAG0B,EAAS,aAAa,IAAIzB,IAAM,CAAE,KAAMA,EAAG,WAAY,aAAc,aAAc,CAAC,SAASA,CAAC,EAAE,CAAE,EAAE,EACvG,GAAGyB,EAAS,SAAS,IAAIxB,IAAM,CAAE,KAAMA,EAAG,WAAY,UAAW,aAAc,CAAC,YAAYA,CAAC,EAAE,CAAE,EAAE,CACrG,EAEA0B,EAAM,KAAK,oBAAoBD,CAAa;AAAA,YACpCD,EAAS,OAAO,MAAM;AAAA,kBAChBA,EAAS,aAAa,MAAM;AAAA,cAChCA,EAAS,SAAS,MAAM;AAAA;AAAA;AAAA,YAG1B,KAAK,UAAUY,EAAW,MAAM,EAAG,CAAC,CAAC,CAAC;AAAA;AAAA,iBAEjCD,CAAY,EAAE,CAC7B,CAEA,MAAO,CACL,SAAU,GACV,cAAeT,EAAM,KAAK;AAAA;AAAA,CAAM,CAClC,CACF,CC3QO,SAASW,GAAsBC,EAA8B,CAElE,IAAMC,EAAQC,GAAiBF,CAAK,EACpC,GAAIC,EAAO,OAAOA,EAElB,IAAME,EAAWH,EAAM,WAAW,UAC5BI,EAAUJ,EAAM,WAAW,SAAYA,EAAc,aAAe,GAE1E,GAAI,CAACG,GAAY,CAACC,EAAS,OAAOC,EAAoB,EAEtD,IAAMC,EAAmB,CAAC,EA0C1B,GAvCIH,EAAS,SAAS,WAAW,IAE3B,gEAAgE,KAAKC,CAAO,GAC9EE,EAAO,KAAK,6DAA6D,EAIvE,2BAA2B,KAAKF,CAAO,GACzCE,EAAO,KAAK,mDAAmD,GAK/DH,EAAS,SAAS,YAAY,IAE5B,qBAAqB,KAAKC,CAAO,GACnCE,EAAO,KAAK,qEAAqE,EAI/E,0CAA0C,KAAKF,CAAO,GACxDE,EAAO,KAAK,sDAAsD,GAKlEH,EAAS,SAAS,gBAAgB,IAEhC,gBAAgB,KAAKC,CAAO,GAC9BE,EAAO,KAAK,iDAAiD,EAI3D,mCAAmC,KAAKF,CAAO,GACjDE,EAAO,KAAK,6DAA6D,GAKzEA,EAAO,OAAS,EAAG,CAErB,IAAMC,EAAS,sBADEJ,EAAS,MAAM,GAAG,EAAE,IAAI,GAAKA,CACD,KAAKG,EAAO,CAAC,CAAC,GAC3D,OAAAE,EAAQ,0BAA2B,YAAYD,CAAM,EAAE,EAChDE,EAAYF,CAAM,CAC3B,CAEA,OAAOF,EAAoB,CAC7B,CCnEA,OAAS,cAAAK,GAAY,kBAAAC,GAAgB,aAAAC,OAA+B,UACpE,OAAS,YAAAC,OAAgB,qBAOlB,SAASC,GAAcC,EAA+B,CAC3D,IAAMC,EAAaC,EAAc,EAC3BC,EAASC,EAAU,EACnBC,EAAU,GAAGF,CAAM,sBACnBG,EAAY,SAAS,QAAQ,IAAI,oBAAsB,KAAM,EAAE,EAGrE,GAAI,CACFC,GAAUJ,EAAQ,CAAE,UAAW,EAAK,CAAC,CACvC,MAAQ,CAER,CAEA,IAAMK,EAAqB,CAAC,EACtBC,EAAY,IAAI,KAAK,EAAE,YAAY,EAAE,QAAQ,IAAK,GAAG,EAAE,MAAM,EAAG,EAAE,EACxED,EAAS,KAAK,IAAIC,CAAS,kBAAkB,EAG7C,IAAMC,EAAe,GAAGT,CAAU,aAC5BU,EAAc,GAAGV,CAAU,gBAEjC,GAAIW,GAAWF,CAAY,GAAKE,GAAWD,CAAW,EACpD,GAAI,CAQF,IAAME,EAPSC,GAAS,iCAAkC,CACxD,IAAKb,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAEwB,MAAM;AAAA,CAAI,EAAE,KAAMc,GAASA,EAAK,SAAS,OAAO,CAAC,EAC1E,GAAIF,EAAW,CACb,IAAMG,EAAQH,EAAU,MAAM,QAAQ,EACtC,GAAIG,EAAO,CACT,IAAMC,EAAW,SAASD,EAAM,CAAC,EAAG,EAAE,EACtCR,EAAS,KAAK,oBAAoBS,CAAQ,GAAG,EACzCA,EAAWX,EACbE,EAAS,KAAK,qBAAqBS,CAAQ,wBAAwBX,CAAS,GAAG,EAE/EE,EAAS,KAAK,0BAA0B,CAE5C,CACF,CACF,MAAQ,CAER,CAIF,IAAMU,EAAc,GAAGjB,CAAU,YACjC,GAAIW,GAAWM,CAAW,EAAG,CAC3B,IAAMC,EAAc,GAAGD,CAAW,yBAC9BN,GAAWO,CAAW,IACxBX,EAAS,KAAK,EAAE,EAChBA,EAAS,KAAK,6CAA6C,EAC3DA,EAAS,KAAK,mDAAmD,EAErE,CAGA,GAAI,CACFY,GAAef,EAASG,EAAS,KAAK;AAAA,CAAI,EAAI;AAAA,CAAI,CACpD,MAAQ,CAER,CAEA,OAAOa,EAAoB,CAC7B,CC3EA,OAAS,cAAAC,GAAY,gBAAAC,OAAoB,UAIzC,IAAMC,GAAiB,CAErB,iCACA,+BACA,yCAEA,gBACA,iBACA,qBACF,EAKA,SAASC,GAAcC,EAAkBC,EAAgC,CACvE,GAAI,CACF,IAAMC,EAAO,KAAK,MAAMD,CAAO,EAG/B,OAAID,EAAS,SAAS,uBAAuB,EACpCE,GAAM,OAAO,OAAO,KAAOA,GAAM,OAAO,YAAY,KAAO,KAIhEF,EAAS,SAAS,eAAe,EAC5BE,GAAM,QAAQ,iBAAmB,KAItCA,GAAM,OAAO,MAAQ,OAChBA,EAAK,MAAM,IAGb,IACT,MAAQ,CACN,OAAO,IACT,CACF,CAKO,SAASC,GAAsBC,EAA+B,CACnE,IAAMC,EAAaC,EAAc,EAC3BC,EAAY,SAAS,QAAQ,IAAI,oBAAsB,KAAM,EAAE,EAGjEC,EAAe,GACfC,EAAkB,GAEtB,QAAWC,KAAQZ,GAAgB,CACjC,IAAMa,EAAW,GAAGN,CAAU,IAAIK,CAAI,GACtC,GAAIE,GAAWD,CAAQ,EAAG,CACxBH,EAAeG,EACf,GAAI,CACFF,EAAkBI,GAAaF,EAAU,MAAM,CACjD,MAAQ,CACN,QACF,CACA,KACF,CACF,CAGA,GAAI,CAACH,GAAgB,CAACC,EACpB,OAAOK,EAAoB,EAI7B,IAAMC,EAAWhB,GAAcS,EAAcC,CAAe,EAC5D,GAAIM,IAAa,KACf,OAAOD,EAAoB,EAK7B,GADoB,KAAK,MAAMC,CAAQ,EACrBR,EAAW,CAC3B,IAAMS,EAAS,qBAAqBD,CAAQ,wBAAwBR,CAAS;AAAA;AAAA,mBAE9DC,CAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAULD,CAAS;AAAA;AAAA;AAAA;AAAA;AAAA,yBAO/B,OAAOU,EAAYD,CAAM,CAC3B,CAEA,OAAOF,EAAoB,CAC7B,CCxGA,OAAS,cAAAI,GAAY,gBAAAC,OAA2C,UAchE,SAASC,GAAWC,EAA2B,CAC7C,MACE,kCAAkC,KAAKA,CAAQ,GAC/C,eAAe,KAAKA,CAAQ,GAC5B,aAAa,KAAKA,CAAQ,CAE9B,CAKA,SAASC,GAAaC,EAAiC,CACrD,GAAI,qBAAqB,KAAKA,CAAQ,EAAG,CACvC,IAAMC,EAAOD,EAAS,QAAQ,WAAY,EAAE,EACtCE,EAAMF,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,KAGnCG,EAAW,CACf,GAAGF,CAAI,SAASC,CAAG,GACnB,GAAGD,CAAI,SAASC,CAAG,GACnB,GAAGD,CAAI,WACP,GAAGA,CAAI,WACT,EAEA,QAAWG,KAAWD,EACpB,GAAIE,GAAWD,CAAO,EAAG,OAAOA,EAIlC,IAAME,EAAMN,EAAS,UAAU,EAAGA,EAAS,YAAY,GAAG,CAAC,EAErDO,GADWP,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,IAChB,QAAQ,WAAY,EAAE,EAE9CQ,EAAkB,CACtB,GAAGF,CAAG,cAAcC,CAAY,SAASL,CAAG,GAC5C,GAAGI,CAAG,cAAcC,CAAY,SAASL,CAAG,EAC9C,EAEA,QAAWE,KAAWI,EACpB,GAAIH,GAAWD,CAAO,EAAG,OAAOA,CAEpC,SAAWJ,EAAS,SAAS,KAAK,EAAG,CACnC,IAAMM,EAAMN,EAAS,UAAU,EAAGA,EAAS,YAAY,GAAG,CAAC,EAErDS,EAAe,QADJT,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,EACT,GAGrC,GAAIK,GAAW,GAAGC,CAAG,IAAIG,CAAY,EAAE,EACrC,MAAO,GAAGH,CAAG,IAAIG,CAAY,GAI/B,IAAMC,EAAYJ,EAAI,UAAU,EAAGA,EAAI,YAAY,GAAG,CAAC,EACvD,GAAID,GAAW,GAAGK,CAAS,UAAUD,CAAY,EAAE,EACjD,MAAO,GAAGC,CAAS,UAAUD,CAAY,GAE3C,GAAIJ,GAAW,GAAGC,CAAG,UAAUG,CAAY,EAAE,EAC3C,MAAO,GAAGH,CAAG,UAAUG,CAAY,EAEvC,CAEA,OAAO,IACT,CAKA,SAASE,GAAqBC,EAAiBd,EAA4B,CACzE,IAAMe,EAAkB,CAAC,EAEzB,GAAI,qBAAqB,KAAKf,CAAQ,EAAG,CAEvC,IAAMgB,EAAUF,EAAQ,MAAM,0EAA0E,EACxG,GAAIE,EACF,QAAWC,KAASD,EAAS,CAC3B,IAAME,EAAOD,EAAM,MAAM,KAAK,EAAE,IAAI,EAChCC,GAAMH,EAAM,KAAKG,CAAI,CAC3B,CAEJ,SAAWlB,EAAS,SAAS,KAAK,EAAG,CAEnC,IAAMmB,EAAQL,EAAQ,MAAM;AAAA,CAAI,EAChC,QAAWM,KAAQD,EAAO,CACxB,IAAMF,EAAQG,EAAK,MAAM,wCAAwC,EAC7DH,GAASA,EAAM,CAAC,GAClBF,EAAM,KAAKE,EAAM,CAAC,CAAC,CAEvB,CACF,CAEA,MAAO,CAAC,GAAG,IAAI,IAAIF,CAAK,CAAC,CAC3B,CAKO,SAASM,GAA2BC,EAA8B,CACvE,IAAMtB,EAAWsB,EAAM,YAAY,WAAa,GAC1CR,EAAUQ,EAAM,YAAY,SAAYA,EAAc,aAAe,GAE3E,GAAI,CAACtB,GAAY,CAACc,EAAS,OAAOS,EAAoB,EAGtD,GAAIxB,GAAWC,CAAQ,EAAG,OAAOuB,EAAoB,EAGrD,GAAI,CAAC,wBAAwB,KAAKvB,CAAQ,EACxC,OAAOuB,EAAoB,EAG7B,IAAMC,EAAmB,CAAC,EACpBC,EAAqB,CAAC,EAGtBC,EAAWzB,GAAaD,CAAQ,EAGhC2B,EAAgBd,GAAqBC,EAASd,CAAQ,EAE5D,GAAI2B,EAAc,OAAS,EACzB,GAAKD,EA0BH,GAAI,CACF,IAAME,EAAcC,GAAaH,EAAU,MAAM,EAC3CI,EAA0B,CAAC,EAEjC,QAAWC,KAAQJ,EAEH,IAAI,OAAO,MAAMI,EAAK,QAAQ,sBAAuB,MAAM,CAAC,KAAK,EACpE,KAAKH,CAAW,GACzBE,EAAc,KAAKC,CAAI,EAI3B,GAAID,EAAc,OAAS,EAAG,CAC5BL,EAAS,KAAK,wCAAwC,EACtDA,EAAS,KAAK,qBAAqBzB,CAAQ,EAAE,EAC7CyB,EAAS,KAAK,gBAAgBC,CAAQ,EAAE,EACxCD,EAAS,KAAK,EAAE,EAChBA,EAAS,KAAK,qBAAqBK,EAAc,MAAM,IAAIH,EAAc,MAAM,IAAI,EACnF,QAAWI,KAAQD,EAAc,MAAM,EAAG,CAAC,EACzCL,EAAS,KAAK,SAASM,CAAI,EAAE,EAE/BN,EAAS,KAAK,EAAE,EAChBA,EAAS,KAAK,+BAA+B,CAC/C,CACF,MAAQ,CAER,KApDa,CAKb,GAJAD,EAAO,KAAK,sDAAsD,EAClEA,EAAO,KAAK,qBAAqBxB,CAAQ,EAAE,EAC3CwB,EAAO,KAAK,uBAAuB,EAE/B,qBAAqB,KAAKxB,CAAQ,EAAG,CACvC,IAAMG,EAAOH,EAAS,QAAQ,WAAY,EAAE,EACtCI,EAAMJ,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,KACnCQ,EAAMR,EAAS,UAAU,EAAGA,EAAS,YAAY,GAAG,CAAC,EACrDgC,EAAWhC,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,GAC9CwB,EAAO,KAAK,SAASrB,CAAI,SAASC,CAAG,EAAE,EACvCoB,EAAO,KAAK,SAAShB,CAAG,cAAcwB,CAAQ,EAAE,CAClD,SAAWhC,EAAS,SAAS,KAAK,EAAG,CACnC,IAAMgC,EAAWhC,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,GACxCQ,EAAMR,EAAS,UAAU,EAAGA,EAAS,YAAY,GAAG,CAAC,EAC3DwB,EAAO,KAAK,SAAShB,CAAG,SAASwB,CAAQ,EAAE,EAC3CR,EAAO,KAAK,SAAShB,EAAI,UAAU,EAAGA,EAAI,YAAY,GAAG,CAAC,CAAC,eAAewB,CAAQ,EAAE,CACtF,CAEAR,EAAO,KAAK,EAAE,EACdA,EAAO,KAAK,WAAWG,EAAc,MAAM,kBAAkB,EAC7D,QAAWI,KAAQJ,EAAc,MAAM,EAAG,CAAC,EACzCH,EAAO,KAAK,SAASO,CAAI,EAAE,CAE/B,CAiCF,GAAIP,EAAO,OAAS,EAClB,OAAOS,EAAY,uCAAuCT,EAAO,CAAC,CAAC,EAAE,EAIvE,GAAIC,EAAS,OAAS,EAAG,CACvB,IAAMS,EAAiBT,EAAS,KAAK;AAAA,CAAI,EACzC,OAAOU,EAAkB;AAAA;AAAA,EAAuCD,CAAc,EAAE,CAClF,CAEA,OAAOX,EAAoB,CAC7B,CCpMO,SAASa,GAAkBC,EAA8B,CAC9D,IAAMC,EAAWD,EAAM,YAAY,WAAa,GAC1CE,EAAUF,EAAM,YAAY,SAAYA,EAAc,aAAe,GAE3E,GAAI,CAACC,GAAY,CAACC,EAAS,OAAOC,EAAoB,EAGtD,GAAI,CAAC,qBAAqB,KAAKF,CAAQ,EACrC,OAAOE,EAAoB,EAI7B,IAAMC,EAAWH,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,GAC9C,GAAI,qCAAqC,KAAKG,CAAQ,EACpD,OAAOD,EAAoB,EAG7B,IAAME,EAAmB,CAAC,EAG1B,GAAI,sCAAsC,KAAKH,CAAO,EAAG,CACvD,IAAMI,EAAQJ,EAAQ,MAAM,iCAAiC,EAC7DG,EAAO,KAAK,yDAAyD,EACrEA,EAAO,KAAK,YAAYC,IAAQ,CAAC,GAAK,WAAW,EAAE,EACnDD,EAAO,KAAK,IAAI,EAChBA,EAAO,KAAK,6BAA6B,EACzCA,EAAO,KAAK,kDAAkD,CAChE,CAEA,GAAI,gDAAgD,KAAKH,CAAO,EAAG,CACjE,IAAMI,EAAQJ,EAAQ,MAAM,2CAA2C,EACvEG,EAAO,KAAK,4DAA4D,EACxEA,EAAO,KAAK,YAAYC,IAAQ,CAAC,GAAK,cAAc,EAAE,EACtDD,EAAO,KAAK,IAAI,EAChBA,EAAO,KAAK,6BAA6B,EACzCA,EAAO,KAAK,qDAAqD,CACnE,CAqCA,GAlCI,+DAA+D,KAAKH,CAAO,IAC7EG,EAAO,KAAK,wDAAwD,EACpEA,EAAO,KAAK,IAAI,EAChBA,EAAO,KAAK,2BAA2B,EACvCA,EAAO,KAAK,qCAAqC,EACjDA,EAAO,KAAK,yBAAyB,EACrCA,EAAO,KAAK,8BAA8B,EAC1CA,EAAO,KAAK,IAAI,EAChBA,EAAO,KAAK,8CAA8C,GAIxD,6BAA6B,KAAKH,CAAO,IACtC,oCAAoC,KAAKA,CAAO,IACnDG,EAAO,KAAK,yCAAyC,EACrDA,EAAO,KAAK,IAAI,EAChBA,EAAO,KAAK,gDAAgD,EAC5DA,EAAO,KAAK,kEAAkE,IAK9E,uCAAuC,KAAKH,CAAO,GACjD,sDAAsD,KAAKA,CAAO,IAC/D,4DAA4D,KAAKA,CAAO,IAC3EG,EAAO,KAAK,sDAAsD,EAClEA,EAAO,KAAK,IAAI,EAChBA,EAAO,KAAK,2DAA2D,EACvEA,EAAO,KAAK,uFAAuF,IAMrG,YAAY,KAAKH,CAAO,EAAG,CAEzB,cAAc,KAAKA,CAAO,IACvB,qBAAqB,KAAKA,CAAO,IACpCG,EAAO,KAAK,6CAA6C,EACzDA,EAAO,KAAK,oCAAoC,EAChDA,EAAO,KAAK,IAAI,EAChBA,EAAO,KAAK,sCAAsC,EAClDA,EAAO,KAAK,6CAA6C,EACzDA,EAAO,KAAK,oCAAoC,IAKpD,IAAME,EAAc,mDACpB,GAAIA,EAAY,KAAKL,CAAO,GACtB,eAAe,KAAKA,CAAO,EAAG,CAEhC,IAAMM,EAAQN,EAAQ,MAAM;AAAA,CAAI,EAChC,QAAWO,KAAQD,EACjB,GAAID,EAAY,KAAKE,CAAI,GAAK,CAACA,EAAK,SAAS,OAAO,EAAG,CACrDJ,EAAO,KAAK,mDAAmD,EAC/DA,EAAO,KAAK,IAAI,EAChBA,EAAO,KAAK,iCAAiC,EAC7CA,EAAO,KAAK,uBAAuB,EACnCA,EAAO,KAAK,4BAA4B,EACxC,KACF,CAEJ,CAEJ,CAGA,GAAIA,EAAO,OAAS,EAAG,CACrBK,EAAQ,sBAAuB,4BAA4BT,CAAQ,EAAE,EACrE,IAAMU,EAAM,qCAAqCV,CAAQ,4BACzD,OAAOW,EAAkBD,CAAG,CAC9B,CAEA,OAAOR,EAAoB,CAC7B,CCxHA,OAAqB,gBAAAU,GAAc,eAAAC,OAA6B,UAShE,SAASC,GAAkBC,EAAiBC,EAA4B,CACtE,IAAMC,EAAuB,CAAC,EAE9B,GAAI,qBAAqB,KAAKD,CAAQ,EAAG,CAEvC,IAAME,EAAUH,EAAQ,MAAM,+EAA+E,EACzGG,GACFD,EAAW,KAAK,GAAGC,CAAO,CAE9B,SAAWF,EAAS,SAAS,KAAK,EAAG,CAEnC,IAAMG,EAAQJ,EAAQ,MAAM;AAAA,CAAI,EAChC,QAAWK,KAAQD,EAAO,CACxB,IAAME,EAAQD,EAAK,MAAM,uCAAuC,EAC5DC,GAAOJ,EAAW,KAAKI,EAAM,CAAC,CAAC,CACrC,CACF,CAEA,MAAO,CAAC,GAAG,IAAI,IAAIJ,CAAU,CAAC,CAChC,CAKA,SAASK,GAAcC,EAAaC,EAA2B,CAC7D,IAAMC,EAAkB,CAAC,EACnBC,EAAa,CAAC,eAAgB,QAAS,OAAQ,cAAe,OAAQ,QAAS,QAAS,MAAM,EAEpG,SAASC,EAAKC,EAA0B,CACtC,GAAI,CACF,IAAMC,EAAUC,GAAYF,EAAY,CAAE,cAAe,EAAK,CAAC,EAC/D,QAAWG,KAASF,EAAS,CAC3B,IAAMG,EAAW,GAAGJ,CAAU,IAAIG,EAAM,IAAI,GACxCA,EAAM,YAAY,EACfL,EAAW,SAASK,EAAM,IAAI,GACjCJ,EAAKK,CAAQ,EAEND,EAAM,OAAO,GAAKP,EAAQ,KAAKO,EAAM,IAAI,GAClDN,EAAM,KAAKO,CAAQ,CAEvB,CACF,MAAQ,CAER,CACF,CAEA,OAAAL,EAAKJ,CAAG,EACDE,CACT,CAKA,SAASQ,GAAuBlB,EAA2B,CACzD,IAAMmB,EAAqB,CAAC,EACtBf,EAAQJ,EAAQ,MAAM;AAAA,CAAI,EAC5BoB,EAAO,GACPC,EAAQ,EACRC,EAAY,EAEhB,QAAS,EAAI,EAAG,EAAIlB,EAAM,OAAQ,IAAK,CACrC,IAAMC,EAAOD,EAAM,CAAC,EAAE,KAAK,EACvBC,GAAQA,IAASe,GACnBC,IACIA,GAAS,GACXF,EAAS,KAAK,QAAQG,CAAS,KAAKF,EAAK,UAAU,EAAG,EAAE,CAAC,EAAE,IAG7DA,EAAOf,EACPgB,EAAQ,EACRC,EAAY,EAAI,EAEpB,CAEA,OAAOH,CACT,CAKA,SAASI,GAAqBvB,EAAiBC,EAA4D,CACzG,IAAMuB,EAAmB,CAAC,EACpBL,EAAqB,CAAC,EAE5B,GAAI,qBAAqB,KAAKlB,CAAQ,EAAG,CAEnC,+BAA+B,KAAKD,CAAO,IAC7CwB,EAAO,KAAK,0CAA0C,EACtDA,EAAO,KAAK,4EAA4E,GAI1F,IAAMC,GAAczB,EAAQ,MAAM,oBAAoB,GAAK,CAAC,GAAG,OAC3DyB,EAAa,IACfN,EAAS,KAAK,2CAA2CM,CAAU,GAAG,EACtEN,EAAS,KAAK,wDAAwD,GAIxE,IAAMO,GAAmB1B,EAAQ,MAAM,8BAA8B,GAAK,CAAC,GAAG,OAC1E0B,EAAkB,IACpBP,EAAS,KAAK,kDAAkDO,CAAe,GAAG,EAClFP,EAAS,KAAK,mDAAmD,EAErE,CAEA,GAAIlB,EAAS,SAAS,KAAK,EAAG,CAE5B,IAAM0B,GAAa3B,EAAQ,MAAM,cAAc,GAAK,CAAC,GAAG,OACpD2B,EAAY,IACdR,EAAS,KAAK,0CAA0CQ,CAAS,GAAG,EACpER,EAAS,KAAK,0DAA0D,GAI1E,IAAMS,GAAY5B,EAAQ,MAAM,yBAAyB,GAAK,CAAC,GAAG,OAC9D4B,EAAW,IACbT,EAAS,KAAK,oDAAoDS,CAAQ,GAAG,EAC7ET,EAAS,KAAK,sDAAsD,EAExE,CAEA,MAAO,CAAE,OAAAK,EAAQ,SAAAL,CAAS,CAC5B,CAKO,SAASU,GAAsBC,EAA8B,CAClE,IAAM7B,EAAW6B,EAAM,YAAY,WAAa,GAC1C9B,EAAU8B,EAAM,YAAY,SAAYA,EAAc,aAAe,GAE3E,GAAI,CAAC7B,GAAY,CAACD,EAAS,OAAO+B,EAAoB,EAGtD,GAAI,CAAC,wBAAwB,KAAK9B,CAAQ,EACxC,OAAO8B,EAAoB,EAG7B,IAAMP,EAAmB,CAAC,EACpBL,EAAqB,CAAC,EAGtBjB,EAAaH,GAAkBC,EAASC,CAAQ,EACtD,GAAIC,EAAW,OAAS,EAAG,CACzB,IAAM8B,EAAcC,EAAY,GAAKC,EAAc,EAC7CC,EAAY5B,GAAcyB,EAAa,uBAAuB,EAEpE,QAAWI,KAAalC,EAAY,CAClC,IAAMmC,EAAOD,EAAU,MAAM,KAAK,EAAE,IAAI,GAAK,GAC7C,GAAKC,GAGL,QAAWC,KAAYH,EACrB,GAAIG,IAAarC,EAEjB,GAAI,CACF,IAAMsC,EAAcC,GAAaF,EAAU,MAAM,EAGjD,GADc,IAAI,OAAO,MAAMD,EAAK,QAAQ,sBAAuB,MAAM,CAAC,KAAK,EACrE,KAAKE,CAAW,GAEpBA,EAAY,SAASH,CAAS,EAAG,CACnC,IAAMK,EAAUH,EAAS,QAAQN,EAAc,IAAK,EAAE,EACtDb,EAAS,KAAK,eAAekB,CAAI,sBAAsB,EACvDlB,EAAS,KAAK,OAAOsB,CAAO,EAAE,EAC9BtB,EAAS,KAAK,aAAa,EAC3BA,EAAS,KAAK,wCAAwC,EACtDA,EAAS,KAAK,qCAAqC,EACnDA,EAAS,KAAK,wDAAwD,EACtE,KACF,CAEJ,MAAQ,CAER,EAEJ,CACF,CAGA,IAAMuB,EAAoBxB,GAAuBlB,CAAO,EACxD,GAAI0C,EAAkB,OAAS,EAAG,CAChCvB,EAAS,KAAK,4CAA4C,EAC1D,QAAWwB,KAAKD,EAAkB,MAAM,EAAG,CAAC,EAC1CvB,EAAS,KAAK,KAAKwB,CAAC,EAAE,EAExBxB,EAAS,KAAK,0CAA0C,CAC1D,CAGA,IAAMyB,EAAerB,GAAqBvB,EAASC,CAAQ,EAK3D,GAJAuB,EAAO,KAAK,GAAGoB,EAAa,MAAM,EAClCzB,EAAS,KAAK,GAAGyB,EAAa,QAAQ,EAGlCpB,EAAO,OAAS,EAAG,CACrB,IAAMqB,EAAM,+BAA+B5C,CAAQ,4BACnD,OAAO6C,EAAkBD,CAAG,CAC9B,CAGA,GAAI1B,EAAS,OAAS,EAAG,CACvB,IAAM0B,EAAM,0CAA0C5C,CAAQ,+BAC9D,OAAO6C,EAAkBD,CAAG,CAC9B,CAEA,OAAOd,EAAoB,CAC7B,CCxNA,OAAS,cAAAgB,GAAY,gBAAAC,GAAc,eAAAC,OAAmB,UAO/C,SAASC,GAAqBC,EAA+B,CAClE,IAAMC,EAAaC,EAAc,EAC3BC,EAAqB,CAAC,EAE5BA,EAAS,KAAK,iCAAiC,EAG/C,IAAMC,EAAkB,GAAGH,CAAU,qBACrC,GAAII,GAAWD,CAAe,EAAG,CAC/BD,EAAS,KAAK,2BAA2B,EACzC,GAAI,CACF,IAAMG,EAAUC,GAAaH,EAAiB,MAAM,EAC9CI,EAAO,KAAK,MAAMF,CAAO,EAE/B,GAAI,OAAOE,GAAS,UAAYA,IAAS,MACvC,OAAW,CAACC,EAAKC,CAAK,IAAK,OAAO,QAAQF,CAAI,EAC5C,GAAI,OAAOE,GAAU,SAAU,CAC7B,IAAMC,EAAY,OAAO,UAAUD,CAAK,EAAIA,EAAM,SAAS,EAAIA,EAAM,QAAQ,CAAC,EAC9EP,EAAS,KAAK,KAAKM,CAAG,KAAKE,CAAS,EAAE,CACxC,EAGN,MAAQ,CAEN,GAAI,CAEF,IAAMC,EADUL,GAAaH,EAAiB,MAAM,EAC9B,MAAM;AAAA,CAAI,EAAE,MAAM,EAAG,EAAE,EAC7CD,EAAS,KAAK,GAAGS,CAAK,CACxB,MAAQ,CACNT,EAAS,KAAK,yBAAyB,CACzC,CACF,CACF,CAGA,IAAMU,EAAc,GAAGZ,CAAU,aACjC,GAAII,GAAWQ,CAAW,EAAG,CAC3BV,EAAS,KAAK,EAAE,EAChBA,EAAS,KAAK,kCAAkC,EAChD,GAAI,CACF,IAAMW,EAAQC,GAAYF,CAAW,EAAE,MAAM,EAAG,CAAC,EACjD,QAAWG,KAAQF,EACjBX,EAAS,KAAK,KAAKa,CAAI,EAAE,CAE7B,MAAQ,CAER,CACF,CAGA,IAAMC,EAAY,GAAGhB,CAAU,sBAC3BI,GAAWY,CAAS,IACtBd,EAAS,KAAK,EAAE,EAChBA,EAAS,KAAK,gCAAgC,GAGhDA,EAAS,KAAK,EAAE,EAChBA,EAAS,KAAK,4CAA4C,EAC1DA,EAAS,KAAK,cAAc,EAG5B,QAAWe,KAAOf,EAChB,QAAQ,OAAO,MAAMe,EAAM;AAAA,CAAI,EAGjC,OAAOC,EAAoB,CAC7B,CCzEA,OAAS,cAAAC,GAAY,kBAAAC,GAAgB,aAAAC,GAAW,eAAAC,OAAmB,UAO5D,SAASC,GAAkBC,EAA+B,CAC/D,IAAMC,EAASC,EAAU,EACnBC,EAAaC,EAAc,EAC3BC,EAAU,GAAGJ,CAAM,0BAGzB,GAAI,CACFK,GAAUL,EAAQ,CAAE,UAAW,EAAK,CAAC,CACvC,MAAQ,CAER,CAEA,IAAMM,EAAY,IAAI,KAAK,EAAE,YAAY,EAAE,QAAQ,IAAK,GAAG,EAAE,MAAM,EAAG,EAAE,EAClEC,EAAqB,CAAC,EAE5BA,EAAS,KAAK,IAAID,CAAS,uBAAuB,EAGlDC,EAAS,KAAK,yBAAyB,EACvC,IAAMC,EAAe,QAAQ,IAAI,kBAC7BA,GACFD,EAAS,KAAK,qBAAqBC,CAAY,EAAE,GAI/CC,GAAW,GAAGP,CAAU,aAAa,GAAKO,GAAW,GAAGP,CAAU,YAAY,IAChFK,EAAS,KAAK,oCAAoC,EAGpD,IAAMG,EAAiB,GAAGR,CAAU,gBACpC,GAAIO,GAAWC,CAAc,EAAG,CAC9BH,EAAS,KAAK,iCAAiC,EAC/C,GAAI,CACF,IAAMI,EAAQC,GAAYF,CAAc,EAAE,MAAM,EAAG,CAAC,EACpD,QAAWG,KAAQF,EACjBJ,EAAS,KAAK,OAAOM,CAAI,EAAE,CAE/B,MAAQ,CAER,CACF,EAGIJ,GAAW,GAAGP,CAAU,YAAY,GAAKO,GAAW,GAAGP,CAAU,WAAW,IAC9EK,EAAS,KAAK,wBAAwB,GAIpCE,GAAW,GAAGP,CAAU,oBAAoB,GAAKO,GAAW,GAAGP,CAAU,qBAAqB,IAChGK,EAAS,KAAK,uBAAuB,EAGvCA,EAAS,KAAK,iCAAiC,EAG/C,GAAI,CACFO,GAAeV,EAASG,EAAS,KAAK;AAAA,CAAI,EAAI;AAAA,CAAI,CACpD,MAAQ,CAER,CAEA,OAAOQ,EAAoB,CAC7B,CC/DA,SAASC,GAASC,EAAiC,CAEjD,OAAIA,EAAS,SAAS,UAAU,EAAU,SACtCA,EAAS,SAAS,OAAO,EAAU,MACnCA,EAAS,SAAS,SAAS,EAAU,QACrCA,EAAS,SAAS,cAAc,GAAK,CAACA,EAAS,SAAS,YAAY,EAAU,aAC9EA,EAAS,SAAS,SAAS,GAAK,CAACA,EAAS,SAAS,YAAY,EAAU,QACzEA,EAAS,SAAS,YAAY,EAAU,WACxCA,EAAS,SAAS,OAAO,GAAKA,EAAS,SAAS,SAAS,EAAU,MAGnEA,EAAS,SAAS,gBAAgB,EAAU,eAC5CA,EAAS,SAAS,YAAY,GAAKA,EAAS,SAAS,KAAK,EAAU,WACpEA,EAAS,SAAS,WAAW,EAAU,UAEpC,IACT,CAKO,SAASC,GAAwBC,EAA8B,CAEpE,IAAMC,EAAQC,EAAeF,CAAK,EAClC,GAAIC,EAAO,OAAOA,EAElB,IAAMH,EAAWE,EAAM,WAAW,WAAa,GACzCG,EAAUH,EAAM,WAAW,SAAYA,EAAc,aAAe,GAE1E,GAAI,CAACF,GAAY,CAACK,EAAS,OAAOC,EAAoB,EAEtD,IAAMC,EAAQR,GAASC,CAAQ,EAC/B,GAAI,CAACO,EAAO,OAAOD,EAAoB,EAEvC,IAAME,EAAmB,CAAC,EAG1B,GAAI,qBAAqB,KAAKR,CAAQ,EACpC,OAAQO,EAAO,CACb,IAAK,SACL,IAAK,MACL,IAAK,QACC,yCAAyC,KAAKF,CAAO,GACvDG,EAAO,KAAK,GAAGD,CAAK,wCAAwC,EAE9D,MAEF,IAAK,aACL,IAAK,QACC,yCAAyC,KAAKF,CAAO,GACvDG,EAAO,KAAK,GAAGD,CAAK,wCAAwC,EAE9D,MAEF,IAAK,WACC,8BAA8B,KAAKF,CAAO,GAC5CG,EAAO,KAAK,mCAAmC,EAEjD,KACJ,CAIF,GAAIR,EAAS,SAAS,KAAK,EACzB,OAAQO,EAAO,CACb,IAAK,eACC,kCAAkC,KAAKF,CAAO,GAChDG,EAAO,KAAK,wDAAwD,EAEtE,MAEF,IAAK,WACC,8BAA8B,KAAKH,CAAO,IACvC,4CAA4C,KAAKA,CAAO,GAC3DG,EAAO,KAAK,uCAAuC,GAGvD,KACJ,CAIF,GAAIA,EAAO,OAAS,EAAG,CAErB,IAAMC,EAAS,iCADET,EAAS,MAAM,GAAG,EAAE,IAAI,GAAKA,CACU,KAAKQ,EAAO,CAAC,CAAC,GACtE,OAAAE,EAAQ,4BAA6B,YAAYD,CAAM,EAAE,EAClDE,EAAYF,CAAM,CAC3B,CAEA,OAAOH,EAAoB,CAC7B,CCjGA,OAAS,cAAAM,GAAY,gBAAAC,OAAoB,UACzC,OAAS,YAAAC,OAAgB,qBAczB,SAASC,IAAyB,CAChC,GAAI,CAOF,OANeC,GAAS,gCAAiC,CACvD,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAGE,MAAM;AAAA,CAAI,EACV,OAAQC,GAASA,EAAK,WAAW,WAAW,CAAC,EAC7C,IAAKA,GAASA,EAAK,QAAQ,YAAa,EAAE,CAAC,CAChD,MAAQ,CACN,MAAO,CAAC,CACV,CACF,CAKA,SAASC,GAAkBC,EAA0B,CACnD,GAAI,CACF,OAAOH,GAAS,kCAAmC,CACjD,IAAKG,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAAE,KAAK,CACV,MAAQ,CACN,MAAO,SACT,CACF,CAKA,SAASC,GAAeD,EAAkBE,EAA0B,CAClE,GAAI,CACF,IAAMC,EAASN,GAAS,uBAAuBK,CAAO,IAAK,CACzD,IAAKF,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EACD,MAAO,aAAa,KAAKG,CAAM,CACjC,MAAQ,CACN,MAAO,EACT,CACF,CAKA,SAASC,GAAoBC,EAAoBC,EAA0D,CACzG,GAAI,CACF,IAAMC,EAAQ,SACZV,GAAS,wBAAwBQ,CAAU,KAAKC,CAAa,GAAI,CAC/D,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAAE,KAAK,EACR,EACF,EACME,EAAS,SACbX,GAAS,wBAAwBS,CAAa,KAAKD,CAAU,GAAI,CAC/D,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAAE,KAAK,EACR,EACF,EACA,MAAO,CAAE,MAAOE,GAAS,EAAG,OAAQC,GAAU,CAAE,CAClD,MAAQ,CACN,MAAO,CAAE,MAAO,EAAG,OAAQ,CAAE,CAC/B,CACF,CAKO,SAASC,GAAuBC,EAA8B,CACnE,IAAMC,EAAWD,EAAM,WAAW,WAAa,GACzCE,EAAUF,EAAM,WAAW,SAAYA,EAAc,aAAe,GAE1E,GAAI,CAACC,GAAY,CAACC,EAAS,OAAOC,EAAoB,EAGtD,IAAMC,EAAYlB,GAAa,EAC/B,GAAIkB,EAAU,SAAW,EAAG,OAAOD,EAAoB,EAEvD,IAAME,EAAqB,CAAC,EACtBC,EAA4B,CAAC,EAE7BC,EAAWC,EAAY,GAAKC,EAAc,EAC1CC,EAAkBH,EAClBf,EAAUS,EAAS,QAAQM,EAAW,IAAK,EAAE,EAAE,QAAQA,EAAU,EAAE,EAGzE,QAAWjB,KAAYc,EAAW,CAChC,GAAId,IAAaoB,EAAiB,SAElC,IAAMC,EAAe,GAAGrB,CAAQ,IAAIE,CAAO,GAC3C,GAAI,CAACoB,GAAWD,CAAY,EAAG,SAE/B,IAAME,EAASxB,GAAkBC,CAAQ,EAGzC,GAAIC,GAAeD,EAAUE,CAAO,EAAG,CACrCc,EAAU,KAAK,CAAE,SAAAhB,EAAU,OAAAuB,EAAQ,OAAQ,UAAW,CAAC,EAGvD,GAAI,CACF,IAAMC,EAAeC,GAAaJ,EAAc,MAAM,EAGhDK,EAAWd,EAAQ,MAAM;AAAA,CAAI,EAC7Be,EAAaH,EAAa,MAAM;AAAA,CAAI,EACpCI,EAAO,KAAK,IAAIF,EAAS,OAASC,EAAW,MAAM,EAErDC,EAAO,KACTb,EAAS,KAAK,mDAAmDa,CAAI,SAAS,EAC9Eb,EAAS,KAAK,aAAaQ,CAAM,EAAE,EACnCR,EAAS,KAAK,+BAA+B,EAEjD,MAAQ,CAER,CACF,CACF,CAGA,IAAMT,EAAgBuB,GAAiB,EACjCxB,EAAayB,GAAiB,EAEpC,GAAIxB,IAAkBD,EAAY,CAChC,GAAM,CAAE,MAAAE,EAAO,OAAAC,CAAO,EAAIJ,GAAoBC,EAAYC,CAAa,EAEnEE,EAAS,KACXO,EAAS,KAAK,iCAAiCP,CAAM,mBAAmBH,CAAU,EAAE,EACpFU,EAAS,KAAK,mDAAmD,EACjEA,EAAS,KAAK,oCAAoC,EAEtD,CAGA,GAAIC,EAAU,OAAS,EAAG,CACxBD,EAAS,QAAQ,wDAAwD,EACzEA,EAAS,QAAQ,EAAE,EACnBA,EAAS,QAAQ,SAASJ,CAAQ,EAAE,EAEpC,QAAWoB,KAAYf,EACrBD,EAAS,KAAK,aAAagB,EAAS,MAAM,EAAE,EAC5ChB,EAAS,KAAK,aAAagB,EAAS,MAAM,EAAE,EAC5ChB,EAAS,KAAK,WAAWgB,EAAS,QAAQ,EAAE,EAG9ChB,EAAS,KAAK,EAAE,EAChBA,EAAS,KAAK,kBAAkB,EAChCA,EAAS,KAAK,8CAA8C,EAC5DA,EAAS,KAAK,yDAAyD,EACvEA,EAAS,KAAK,iCAAiC,CACjD,CAEA,GAAIA,EAAS,OAAS,EAAG,CACvB,IAAMiB,EAAM,yCAAyCrB,CAAQ,+BAE7D,eAAQ,OAAO,MAAMI,EAAS,KAAK;AAAA,CAAI,EAAI;AAAA,CAAI,EACxCkB,EAAkBD,CAAG,CAC9B,CAEA,OAAOnB,EAAoB,CAC7B,CC1LA,OAAS,cAAAqB,GAAY,gBAAAC,OAAoB,UACzC,OAAS,YAAAC,OAAgB,qBAQzB,SAASC,EAAQC,EAAiBC,EAAsB,CACtD,GAAI,CACF,OAAOC,GAASF,EAAS,CACvB,IAAKC,GAAOE,EAAc,EAC1B,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EAAE,KAAK,CACV,MAAQ,CACN,MAAO,EACT,CACF,CAKO,SAASC,GAAsBC,EAA8B,CAClE,IAAML,EAAUK,EAAM,YAAY,SAAW,GAG7C,GAAI,CAAC,kDAAkD,KAAKL,CAAO,EACjE,OAAOM,EAAoB,EAG7B,IAAMC,EAAgBF,EAAM,WAAmB,eAAiB,OAC1DG,EAAgBC,GAAiB,EAEvC,GAAID,IAAkBD,EACpB,eAAQ,OAAO,MAAM,4BAA4BA,CAAY;AAAA,CAAI,EAC1DD,EAAoB,EAG7B,QAAQ,OAAO,MAAM,6BAA6BE,CAAa,OAAOD,CAAY;AAAA;AAAA,CAAM,EAExF,IAAMG,EAAcC,EAAY,GAAKR,EAAc,EAC7CS,EAAmB,CAAC,EACpBC,EAAqB,CAAC,EACtBC,EAAmB,CAAC,EAI1B,GADA,QAAQ,OAAO,MAAM;AAAA,CAA0C,EAC3DC,GAAsB,EAAG,CAC3B,IAAMC,EAASjB,EAAQ,oBAAoB,EAC3Ca,EAAO,KAAK,+BAA+B,EAC3CA,EAAO,KAAKI,EAAO,MAAM;AAAA,CAAI,EAAE,MAAM,EAAG,EAAE,EAAE,KAAK;AAAA,CAAI,CAAC,CACxD,MACEF,EAAO,KAAK,wBAAwB,EAItC,QAAQ,OAAO,MAAM;AAAA,CAAoC,EACzDf,EAAQ,oBAAoBQ,CAAY,EAAE,EAE1C,IAAMU,EAAQ,SAASlB,EAAQ,+BAA+BQ,CAAY,KAAKC,CAAa,EAAE,GAAK,IAAK,EAAE,EACpGU,EAAS,SAASnB,EAAQ,wBAAwBS,CAAa,YAAYD,CAAY,EAAE,GAAK,IAAK,EAAE,EAkB3G,GAhBA,QAAQ,OAAO,MAAM,aAAaU,CAAK,qBAAqBC,CAAM;AAAA,CAAY,EAE1EA,EAAS,IACXN,EAAO,KAAK,kCAAkCL,CAAY,KAAKW,CAAM,WAAW,EAChFN,EAAO,KAAK,mBAAmBL,CAAY,oBAAoB,GACtDW,EAAS,GAClBL,EAAS,KAAK,oBAAoBN,CAAY,OAAOW,CAAM,UAAU,EACrEL,EAAS,KAAK,oCAAoC,GAElDC,EAAO,KAAK,mCAAmCI,CAAM,GAAG,EAI1D,QAAQ,OAAO,MAAM;AAAA,CAAsC,EACvCnB,EAAQ,wCAAwCQ,CAAY,EAAE,EAElE,SAAS,UAAU,EAAG,CACpC,IAAMY,EAAgBpB,EAAQ,sCAAsC,EACpEa,EAAO,KAAK,iCAAiCL,CAAY,GAAG,EAC5D,QAAWa,KAAQD,EAAc,MAAM;AAAA,CAAI,EAAE,MAAM,EAAG,EAAE,EAClDC,GAAMR,EAAO,KAAK,OAAOQ,CAAI,EAAE,EAErCR,EAAO,KAAK,kCAAkC,EAC9Cb,EAAQ,mBAAmB,CAC7B,MACEe,EAAO,KAAK,6BAA6B,EACzCf,EAAQ,mBAAmB,EAI7B,QAAQ,OAAO,MAAM;AAAA,CAAgD,EACrE,IAAMsB,EAAYtB,EAAQ,kBAAkBS,CAAa,WAAWD,CAAY,EAAE,EAClF,GAAIc,EAAW,CAEb,IAAMC,EADevB,EAAQ,wBAAwBsB,CAAS,IAAIb,CAAa,EAAE,EAClD,MAAM;AAAA,CAAI,EAAE,OAAO,OAAO,EAAE,OAC3D,QAAQ,OAAO,MAAM,eAAec,CAAS;AAAA,CAAqB,EAClER,EAAO,KAAK,+BAA+B,CAC7C,MACED,EAAS,KAAK,oDAAoD,EAqBpE,GAjBA,QAAQ,OAAO,MAAM;AAAA,CAA6B,EAC9CU,GAAW,GAAGb,CAAW,eAAe,GACvBc,GAAa,GAAGd,CAAW,gBAAiB,MAAM,EACtD,SAAS,SAAS,GAC/BI,EAAO,KAAK,4BAA4B,GAGxCS,GAAW,GAAGb,CAAW,aAAa,GAAKa,GAAW,GAAGb,CAAW,iBAAiB,IACvFI,EAAO,KAAK,kCAAkC,EAIhD,QAAQ,OAAO,MAAM;AAAA,CAAI,EACzB,QAAQ,OAAO,MAAM,IAAK,OAAO,EAAE,EAAI;AAAA,CAAI,EAC3C,QAAQ,OAAO,MAAM;AAAA;AAAA;AAAA,CAA8B,EACnD,QAAQ,OAAO,MAAM,WAAWN,CAAa,OAAOD,CAAY;AAAA;AAAA,CAAM,EAElEO,EAAO,OAAS,EAAG,CACrB,QAAQ,OAAO,MAAM;AAAA,CAAkB,EACvC,QAAWW,KAAQX,EACjB,QAAQ,OAAO,MAAM,MAAMW,CAAI;AAAA,CAAI,EAErC,QAAQ,OAAO,MAAM;AAAA,CAAI,CAC3B,CAEA,GAAIZ,EAAS,OAAS,EAAG,CACvB,QAAQ,OAAO,MAAM;AAAA,CAAa,EAClC,QAAWa,KAAWb,EACpB,QAAQ,OAAO,MAAM,MAAMa,CAAO;AAAA,CAAI,EAExC,QAAQ,OAAO,MAAM;AAAA,CAAI,CAC3B,CAEA,GAAId,EAAO,OAAS,EAAG,CACrB,QAAQ,OAAO,MAAM;AAAA,CAAa,EAClC,QAAWe,KAASf,EAClB,QAAQ,OAAO,MAAM,MAAMe,CAAK;AAAA,CAAI,EAEtC,eAAQ,OAAO,MAAM;AAAA;AAAA,CAAmD,EACjE,CAAE,SAAU,GAAO,WAAY,qCAAsC,CAC9E,CAEA,OAAId,EAAS,OAAS,GACpB,QAAQ,OAAO,MAAM;AAAA,CAA6B,EAClD,QAAQ,OAAO,MAAM;AAAA,CAAgD,IAErE,QAAQ,OAAO,MAAM;AAAA,CAAoC,EACzD,QAAQ,OAAO,MAAM;AAAA,CAAoC,GAGpDP,EAAoB,CAC7B,CC7JA,OAAS,cAAAsB,GAAY,gBAAAC,OAAoB,UACzC,OAAS,YAAAC,OAAgB,qBAOlB,SAASC,GAAmBC,EAA8B,CAC/D,IAAMC,EAAWD,EAAM,YAAY,WAAa,QAAQ,IAAI,mBAAqB,GAEjF,GAAI,CAACC,EAAU,OAAOC,EAAoB,EAG1C,GAAI,CAACD,EAAS,SAAS,kBAAkB,GAAK,CAACA,EAAS,SAAS,KAAK,EACpE,OAAOC,EAAoB,EAG7B,GAAI,CAACC,GAAWF,CAAQ,EACtB,OAAOC,EAAoB,EAG7B,QAAQ,OAAO,MAAM,kCAAkCD,EAAS,MAAM,GAAG,EAAE,IAAI,CAAC;AAAA,CAAI,EAEpF,IAAMG,EAAmB,CAAC,EACtBC,EAEJ,GAAI,CACFA,EAAUC,GAAaL,EAAU,MAAM,CACzC,MAAQ,CACN,OAAAG,EAAO,KAAK,4BAA4B,EACjCG,EAAkB,mCAAmCN,CAAQ,EAAE,CACxE,CAGKI,EAAQ,SAAS,aAAa,GACjCD,EAAO,KAAK,yCAAyC,EAGlDC,EAAQ,SAAS,eAAe,GACnCD,EAAO,KAAK,2CAA2C,EAIpD,gBAAgB,KAAKC,CAAO,GAC/BD,EAAO,KAAK,kCAAkC,EAIhD,GAAI,CACFI,GAAS,0BAA0BP,CAAQ,IAAK,CAC9C,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,CACH,MAAQ,CACNG,EAAO,KAAK,kCAAkC,CAChD,CAGA,GAAIA,EAAO,OAAS,EAAG,CACrB,QAAQ,OAAO,MAAM;AAAA,CAAwC,EAC7D,QAAWK,KAASL,EAClB,QAAQ,OAAO,MAAM,OAAOK,CAAK;AAAA,CAAI,EAEvC,QAAQ,OAAO,MAAM;AAAA,CAAgB,EAErCC,EAAQ,sBAAuB,YAAYN,EAAO,CAAC,CAAC,EAAE,EACtD,IAAMO,EAAM,mCAAmCV,CAAQ,4BACvD,OAAOM,EAAkBI,CAAG,CAC9B,CAEA,eAAQ,OAAO,MAAM;AAAA,CAA2B,EAChD,QAAQ,OAAO,MAAM;AAAA,CAAgB,EAE9BT,EAAoB,CAC7B,CC7EA,OAAS,cAAAU,OAAgC,UAQlC,SAASC,GAA2BC,EAA8B,CACvE,IAAMC,EAAWD,EAAM,WAAW,WAAa,GACzCE,EAAUF,EAAM,WAAW,SAAYA,EAAc,aAAe,GAE1E,GAAI,CAACC,GAAY,CAACC,EAAS,OAAOC,EAAoB,EAGtD,IAAMC,EAAe,GADDC,EAAY,GAAKC,EAAc,CAChB,uDAGnC,GAAI,CAACC,GAAWH,CAAY,EAC1B,OAAOD,EAAoB,EAG7B,IAAMK,EAAmB,CAAC,EACpBC,EAAqB,CAAC,EAkI5B,GA/HIR,EAAS,SAAS,KAAK,IAAMA,EAAS,SAAS,WAAW,GAAKA,EAAS,SAAS,OAAO,KAEtFA,EAAS,SAAS,WAAW,GAC3B,6BAA6B,KAAKC,CAAO,IAC3CM,EAAO,KAAK,6CAA6C,EACzDA,EAAO,KAAK,4DAA4D,EACxEA,EAAO,KAAK,uCAAuC,GAInDP,EAAS,SAAS,YAAY,GAC5B,wBAAwB,KAAKC,CAAO,IACtCM,EAAO,KAAK,uDAAuD,EACnEA,EAAO,KAAK,+DAA+D,GAK3E,yBAAyB,KAAKN,CAAO,IAClC,uCAAuC,KAAKA,CAAO,GAClD,uBAAuB,KAAKA,CAAO,IACrCM,EAAO,KAAK,iDAAiD,EAC7DA,EAAO,KAAK,0DAA0D,EACtEA,EAAO,KAAK,2DAA2D,IAMzE,kCAAkC,KAAKN,CAAO,IAC5C,eAAe,KAAKA,CAAO,IAC7BM,EAAO,KAAK,iDAAiD,EAC7DA,EAAO,KAAK,0DAA0D,EACtEA,EAAO,KAAK,wDAAwD,GAElE,kBAAkB,KAAKN,CAAO,IAChCM,EAAO,KAAK,sDAAsD,EAClEA,EAAO,KAAK,0DAA0D,EACtEA,EAAO,KAAK,0CAA0C,KAMxD,qBAAqB,KAAKP,CAAQ,IAAMA,EAAS,SAAS,YAAY,GAAKA,EAAS,SAAS,OAAO,KAElG,aAAa,KAAKC,CAAO,IAC3BM,EAAO,KAAK,wDAAwD,EACpEA,EAAO,KAAK,0EAA0E,EACtFA,EAAO,KAAK,sDAAsD,GAIhE,kBAAkB,KAAKN,CAAO,IAC3B,mBAAmB,KAAKA,CAAO,IAClCM,EAAO,KAAK,0CAA0C,EACtDA,EAAO,KAAK,6DAA6D,EACzEA,EAAO,KAAK,mCAAmC,IAK/C,QAAQ,KAAKN,CAAO,IACjB,6CAA6C,KAAKA,CAAO,IAC5DO,EAAS,KAAK,2CAA2C,EACzDA,EAAS,KAAK,4DAA4D,EAC1EA,EAAS,KAAK,kDAAkD,IAKhE,8CAA8C,KAAKP,CAAO,IAC5DM,EAAO,KAAK,gEAAgE,EAC5EA,EAAO,KAAK,gDAAgD,EAC5DA,EAAO,KAAK,qEAAqE,KAKjF,kCAAkC,KAAKP,CAAQ,GAAK,eAAe,KAAKA,CAAQ,KAE7E,8DAA8D,KAAKC,CAAO,IAC7EO,EAAS,KAAK,uCAAuC,EACrDA,EAAS,KAAK,gEAAgE,EAC9EA,EAAS,KAAK,6CAA6C,GAIzD,qBAAqB,KAAKR,CAAQ,GAChC,kCAAkC,KAAKC,CAAO,IAChDM,EAAO,KAAK,mDAAmD,EAC/DA,EAAO,KAAK,gDAAgD,EAC5DA,EAAO,KAAK,oDAAoD,GAKhEP,EAAS,SAAS,KAAK,GACrB,oBAAoB,KAAKC,CAAO,IAClCM,EAAO,KAAK,0DAA0D,EACtEA,EAAO,KAAK,4CAA4C,EACxDA,EAAO,KAAK,gDAAgD,KAM9DP,EAAS,SAAS,OAAO,GAAKA,EAAS,SAAS,MAAM,GAAKA,EAAS,SAAS,SAAS,KAEpF,uCAAuC,KAAKC,CAAO,IACrDM,EAAO,KAAK,sCAAsC,EAClDA,EAAO,KAAK,4DAA4D,EACxEA,EAAO,KAAK,4DAA4D,GAItE,4CAA4C,KAAKN,CAAO,IACrD,mDAAmD,KAAKA,CAAO,IAClEM,EAAO,KAAK,8CAA8C,EAC1DA,EAAO,KAAK,wDAAwD,EACpEA,EAAO,KAAK,2CAA2C,EACvDA,EAAO,KAAK,mDAAmD,KAMjEA,EAAO,OAAS,EAClB,OAAOE,EAAY,8CAA8CT,CAAQ,EAAE,EAI7E,GAAIQ,EAAS,OAAS,EAAG,CACvB,QAAQ,OAAO,MAAM;AAAA,CAAgD,EACrE,QAAQ,OAAO,MAAM,SAASR,CAAQ;AAAA;AAAA,CAAM,EAC5C,QAAWU,KAAWF,EACpB,QAAQ,OAAO,MAAM,KAAKE,CAAO;AAAA,CAAI,CAEzC,CAEA,OAAOR,EAAoB,CAC7B,CClKA,IAAMS,GAAmB,CACvB,sBACA,sBACA,mBACA,0BACF,EAGMC,GAAkB,CACtB,oCACA,iCACF,EAKO,SAASC,GAAcC,EAA8B,CAC1D,IAAMC,EAAcD,EAAc,aAAgBA,EAAc,QAAU,GAE1E,GAAI,CAACC,EAAY,OAAOC,EAAoB,EAG5C,QAAWC,KAAWN,GACpB,GAAIM,EAAQ,KAAKF,CAAU,EAAG,CAC5B,QAAQ,OAAO,MAAM;AAAA,CAAsE,EAC3F,KACF,CAIF,QAAWE,KAAWL,GACpB,GAAIK,EAAQ,KAAKF,CAAU,EAAG,CAC5B,QAAQ,OAAO,MAAM;AAAA,CAAuD,EAC5E,KACF,CAIF,OAAOC,EAAoB,CAC7B,CC3CA,OAAS,kBAAAE,GAAgB,aAAAC,OAAiB,UAOnC,SAASC,GAAuBC,EAA+B,CACpE,IAAMC,EAASC,EAAU,EACnBC,EAAU,GAAGF,CAAM,sBAGzB,GAAI,CACFG,GAAUH,EAAQ,CAAE,UAAW,EAAK,CAAC,CACvC,MAAQ,CAER,CAGA,IAAMI,EAAa,IADD,IAAI,KAAK,EAAE,YAAY,EAAE,QAAQ,IAAK,GAAG,EAAE,MAAM,EAAG,EAAE,CACxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBhC,GAAI,CACFC,GAAeH,EAASE,EAAa;AAAA,CAAI,CAC3C,MAAQ,CAER,CAEA,OAAOE,EAAoB,CAC7B,CC3CA,OAAS,kBAAAC,GAAgB,aAAAC,OAAiB,UAOnC,SAASC,GAAgBC,EAA+B,CAC7D,IAAMC,EAASC,EAAU,EACnBC,EAAU,GAAGF,CAAM,wBAGzB,GAAI,CACFG,GAAUH,EAAQ,CAAE,UAAW,EAAK,CAAC,CACvC,MAAQ,CAER,CAGA,IAAMI,EAAa,IADD,IAAI,KAAK,EAAE,YAAY,EAAE,QAAQ,IAAK,GAAG,EAAE,MAAM,EAAG,EAAE,CACxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAchC,GAAI,CACFC,GAAeH,EAASE,EAAa;AAAA,CAAI,CAC3C,MAAQ,CAER,CAEA,OAAOE,EAAoB,CAC7B,CCrCA,IAAMC,GAAY,EAKX,SAASC,GAA2BC,EAA8B,CAEvE,IAAMC,EAAQC,EAAeF,CAAK,EAClC,GAAIC,EAAO,OAAOA,EAElB,IAAME,EAAWH,EAAM,WAAW,WAAa,GAC/C,GAAI,CAACG,EAAU,OAAOC,EAAoB,EAE1C,IAAMC,EAAmB,CAAC,EACpBC,EAAWH,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,GAG9C,GAAIA,EAAS,SAAS,OAAO,GAAKA,EAAS,SAAS,OAAO,EAAG,CAC5D,IAAII,EAAe,GACfJ,EAAS,SAAS,OAAO,EAC3BI,EAAeJ,EAAS,MAAM,OAAO,EAAE,CAAC,GAAK,GAE7CI,EAAeJ,EAAS,MAAM,OAAO,EAAE,CAAC,GAAK,GAG/C,IAAMK,EAAQD,EAAa,MAAM,GAAG,EAAE,OAAO,OAAO,EAAE,OAClDC,EAAQV,IACVO,EAAO,KAAK,iCAAiCG,CAAK,iBAAiBV,EAAS,GAAG,CAEnF,CA2BA,GAxBI,uBAAuB,KAAKQ,CAAQ,GAClC,CAACH,EAAS,SAAS,OAAO,GAAK,CAAC,gCAAgC,KAAKA,CAAQ,GAC/EE,EAAO,KAAK,+EAA+E,EAK3F,qBAAqB,KAAKF,CAAQ,IAEhC,iCAAiC,KAAKG,CAAQ,IAC3C,0CAA0C,KAAKH,CAAQ,GAC1DE,EAAO,KAAK,wEAAwE,GAKpF,mCAAmC,KAAKC,CAAQ,IAC7C,sBAAsB,KAAKH,CAAQ,GACtCE,EAAO,KAAK,gDAAgD,IAM9DF,EAAS,SAAS,KAAK,EAAG,CAC5B,IAAMM,EAAUN,EAAS,UAAU,EAAGA,EAAS,YAAY,GAAG,CAAC,EAG3D,iCAAiC,KAAKG,CAAQ,GAC5C,CAACG,EAAQ,SAAS,UAAU,GAAK,CAACA,EAAQ,SAAS,SAAS,GAC9DJ,EAAO,KAAK,oDAAoD,EAKhE,gBAAgB,KAAKC,CAAQ,GAC3B,CAACG,EAAQ,SAAS,WAAW,GAAK,CAACA,EAAQ,SAAS,UAAU,GAChEJ,EAAO,KAAK,uDAAuD,EAKnE,0BAA0B,KAAKC,CAAQ,GACrC,CAACG,EAAQ,SAAS,eAAe,GAAK,CAACA,EAAQ,SAAS,cAAc,GACxEJ,EAAO,KAAK,iEAAiE,CAGnF,CAGA,GAAIA,EAAO,OAAS,EAAG,CACrB,IAAMK,EAAS,wBAAwBL,EAAO,CAAC,CAAC,GAChD,OAAAM,EAAQ,+BAAgC,YAAYD,CAAM,EAAE,EACrDE,EAAYF,CAAM,CAC3B,CAEA,OAAON,EAAoB,CAC7B,CCtFA,SAASS,GAAWC,EAA2B,CAM7C,MAJI,qCAAkC,KAAKA,CAAQ,GAG/C,wBAAwB,KAAKA,CAAQ,GACrC,aAAa,KAAKA,CAAQ,EAGhC,CAKO,SAASC,GAAsBC,EAA8B,CAElE,IAAMC,EAAQC,EAAeF,CAAK,EAClC,GAAIC,EAAO,OAAOA,EAElB,IAAMH,EAAWE,EAAM,WAAW,WAAa,GAC/C,GAAI,CAACF,EAAU,OAAOK,EAAoB,EAE1C,IAAMC,EAAWN,EAAS,MAAM,GAAG,EAAE,IAAI,GAAK,GACxCO,EAASR,GAAWC,CAAQ,EAGlC,GAAIO,GACE,CAAC,wCAAwC,KAAKP,CAAQ,EAAG,CAC3D,IAAMQ,EAAS,gEAAgEF,CAAQ,GACvF,OAAAG,EAAQ,0BAA2B,YAAYD,CAAM,EAAE,EAChDE,EAAYF,CAAM,CAC3B,CAIF,GAAI,CAACD,GAAU,iCAAiC,KAAKP,CAAQ,EAAG,CAO9D,IAAMW,EALkB,CACtB,yEACA,iDACF,EAEkC,KAAMC,GAAYA,EAAQ,KAAKN,CAAQ,CAAC,EACpEO,EAAiB,2CAA2C,KAAKb,CAAQ,EAE/E,GAAI,CAACW,GAAa,CAACE,EAAgB,CACjC,IAAML,EAAS,+CAA+CF,CAAQ,GACtE,OAAAG,EAAQ,0BAA2B,YAAYD,CAAM,EAAE,EAChDE,EAAYF,CAAM,CAC3B,CACF,CAGA,GAAI,qBAAqB,KAAKR,CAAQ,GAAK,sBAAsB,KAAKA,CAAQ,EAAG,CAE/E,GAAI,oDAAoD,KAAKM,CAAQ,EACnE,OAAOD,EAAoB,EAI7B,GAAI,CAAC,kCAAkC,KAAKC,CAAQ,EAAG,CACrD,IAAME,EAAS,oDAAoDF,CAAQ,GAC3E,OAAAG,EAAQ,0BAA2B,YAAYD,CAAM,EAAE,EAChDE,EAAYF,CAAM,CAC3B,CACF,CAGA,GAAIR,EAAS,SAAS,KAAK,GAAK,qBAAqB,KAAKA,CAAQ,EAAG,CAEnE,GAAI,6DAA6D,KAAKM,CAAQ,EAC5E,OAAOD,EAAoB,EAI7B,GAAI,CAAC,gBAAgB,KAAKC,CAAQ,GAAK,CAAC,aAAa,KAAKA,CAAQ,EAAG,CACnE,IAAME,EAAS,2DAA2DF,CAAQ,GAClF,OAAAG,EAAQ,0BAA2B,YAAYD,CAAM,EAAE,EAChDE,EAAYF,CAAM,CAC3B,CACF,CAEA,OAAOH,EAAoB,CAC7B,CCpFA,SAASS,GAAWC,EAA2B,CAG7C,MAFI,qCAAkC,KAAKA,CAAQ,GAC/C,wBAAwB,KAAKA,CAAQ,GACrC,aAAa,KAAKA,CAAQ,EAEhC,CAKO,SAASC,GAAqBC,EAA8B,CACjE,IAAMF,EAAWE,EAAM,YAAY,WAAa,GAC1CC,EAAUD,EAAM,YAAY,SAAYA,EAAc,aAAe,GAE3E,GAAI,CAACF,GAAY,CAACG,EAAS,OAAOC,EAAoB,EAGtD,GAAI,CAACL,GAAWC,CAAQ,EAAG,OAAOI,EAAoB,EAEtD,IAAMC,EAAmB,CAAC,EAG1B,GAAI,qBAAqB,KAAKL,CAAQ,EAAG,CAEvC,IAAMM,EAAaH,EAAQ,MAAM,iCAAiC,EAC9DG,GACEA,EAAW,KAAMC,GAAc,0BAA0B,KAAKA,CAAC,CAAC,IAClEF,EAAO,KAAK,yDAAyD,EACrEA,EAAO,KAAK,sCAAsC,EAClDA,EAAO,KAAK,mDAAmD,GAK/D,iCAAiC,KAAKF,CAAO,IAC1C,4CAA4C,KAAKA,CAAO,IAC3DE,EAAO,KAAK,yDAAyD,EACrEA,EAAO,KAAK,wEAAwE,IAKxF,IAAMG,GAAgBL,EAAQ,MAAM,WAAW,GAAK,CAAC,GAAG,OAClDM,GAAcN,EAAQ,MAAM,iBAAiB,GAAK,CAAC,GAAG,QAAU,EAChEO,EAAa,KAAK,MAAMF,EAAeC,CAAU,EAEnDC,EAAa,IACfL,EAAO,KAAK,6BAA6BK,CAAU,aAAa,EAChEL,EAAO,KAAK,kEAAkE,EAC9EA,EAAO,KAAK,uDAAuD,GAIjE,8BAA8B,KAAKF,CAAO,IAC5CE,EAAO,KAAK,iCAAiC,EAC7CA,EAAO,KAAK,iDAAiD,EAC7DA,EAAO,KAAK,iCAAiC,GAI3C,6BAA6B,KAAKF,CAAO,IAC3CE,EAAO,KAAK,yCAAyC,EACrDA,EAAO,KAAK,oCAAoC,GAI9C,6BAA6B,KAAKF,CAAO,IACtC,wCAAwC,KAAKA,CAAO,IACvDE,EAAO,KAAK,oCAAoC,EAChDA,EAAO,KAAK,oDAAoD,EAChEA,EAAO,KAAK,qDAAqD,GAGvE,CAmDA,OAhDIL,EAAS,SAAS,KAAK,IAErB,gBAAgB,KAAKG,CAAO,IAC9BE,EAAO,KAAK,gDAAgD,EAC5DA,EAAO,KAAK,gCAAgC,EAC5CA,EAAO,KAAK,kCAAkC,GAI5C,qDAAqD,KAAKF,CAAO,IACnEE,EAAO,KAAK,yDAAyD,EACrEA,EAAO,KAAK,8BAA8B,EAC1CA,EAAO,KAAK,yDAAyD,GAInE,gBAAgB,KAAKF,CAAO,IAC1B,sBAAsB,KAAKA,CAAO,GAAK,sBAAsB,KAAKA,CAAO,KAC3EE,EAAO,KAAK,wDAAwD,EACpEA,EAAO,KAAK,kDAAkD,EAC9DA,EAAO,KAAK,uDAAuD,GAKnE,eAAe,KAAKF,CAAO,IAC7BE,EAAO,KAAK,6BAA6B,EACzCA,EAAO,KAAK,iDAAiD,EAC7DA,EAAO,KAAK,mDAAmD,IAI7D,0BAA0B,KAAKF,CAAO,GAAK,6BAA6B,KAAKA,CAAO,KACtFE,EAAO,KAAK,mCAAmC,EAC/CA,EAAO,KAAK,2DAA2D,GAIrE,kBAAkB,KAAKF,CAAO,IAC3B,yBAAyB,KAAKA,CAAO,IACxCE,EAAO,KAAK,gDAAgD,EAC5DA,EAAO,KAAK,6BAA6B,EACzCA,EAAO,KAAK,4CAA4C,KAM1DA,EAAO,OAAS,GAClBM,EAAQ,yBAA0B,YAAYN,EAAO,CAAC,CAAC,EAAE,EAClDO,EAAY,uCAAuCZ,CAAQ,EAAE,GAG/DI,EAAoB,CAC7B,CCvIA,OAAS,cAAAS,OAAgC,UACzC,OAAS,YAAAC,OAAgB,qBAOzB,SAASC,GAAgBC,EAAiC,CACxD,IAAIC,EAAMD,EACV,KAAOC,IAAQ,KAAK,CAClB,GAAIC,GAAW,GAAGD,CAAG,eAAe,EAClC,OAAOA,EAETA,EAAMA,EAAI,UAAU,EAAGA,EAAI,YAAY,GAAG,CAAC,CAC7C,CACA,OAAO,IACT,CAKO,SAASE,GAAWC,EAA8B,CACvD,IAAMC,EAAWD,EAAM,YAAY,WAAa,QAAQ,IAAI,mBAAqB,GAGjF,GAAI,CAACC,EAAU,OAAOC,EAAoB,EAG1C,GAAI,cAAc,KAAKD,CAAQ,GAAK,aAAa,KAAKA,CAAQ,EAAG,CAC/D,QAAQ,OAAO,MAAM,sCAAsCA,EAAS,MAAM,GAAG,EAAE,IAAI,CAAC;AAAA,CAAI,EAExF,IAAMJ,EAAMI,EAAS,UAAU,EAAGA,EAAS,YAAY,GAAG,CAAC,EAE3D,GAAI,CAEF,GAAIH,GAAW,GAAGD,CAAG,iBAAiB,EACpC,GAAI,CACFM,GAAS,oBAAqB,CAAE,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAAE,CAAC,EAOjE,IAAMC,EANSD,GAAS,sBAAsBF,CAAQ,kBAAmB,CACvE,IAAKJ,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EACoB,MAAM;AAAA,CAAI,EAAE,MAAM,GAAG,EAC1C,QAAQ,OAAO,MAAMO,EAAM,KAAK;AAAA,CAAI,EAAI;AAAA,CAAI,CAC9C,MAAQ,CAER,CAIF,GAAI,CACFD,GAAS,oBAAqB,CAAE,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAAE,CAAC,EAOjE,IAAMC,EANSD,GAAS,WAAWF,CAAQ,kBAAmB,CAC5D,IAAKJ,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EACoB,MAAM;AAAA,CAAI,EAAE,MAAM,GAAG,EAC1C,QAAQ,OAAO,MAAMO,EAAM,KAAK;AAAA,CAAI,EAAI;AAAA,CAAI,CAC9C,MAAQ,CACN,QAAQ,OAAO,MAAM;AAAA,CAAwC,CAC/D,CACF,OAASC,EAAO,CAEVA,aAAiB,OACnB,QAAQ,OAAO,MAAM,yBAAyBA,EAAM,OAAO;AAAA,CAAI,CAEnE,CAEA,QAAQ,OAAO,MAAM;AAAA,CAAgB,CACvC,CAGA,GAAI,kCAAkC,KAAKJ,CAAQ,EAAG,CACpD,QAAQ,OAAO,MAAM,0CAA0CA,EAAS,MAAM,GAAG,EAAE,IAAI,CAAC;AAAA,CAAI,EAG5F,IAAMK,EAAcX,GAAgBM,EAAS,UAAU,EAAGA,EAAS,YAAY,GAAG,CAAC,CAAC,EAEpF,GAAIK,EACF,GAAI,CACF,IAAMC,EAAcN,EACjB,MAAM,GAAG,EACT,IAAI,GACH,QAAQ,WAAY,EAAE,EACvB,QAAQ,sBAAuB,MAAM,EAQlCG,EANSD,GAAS,kCAAkCI,CAAW,IAAK,CACxE,IAAKD,EACL,SAAU,OACV,QAAS,IACT,MAAO,CAAC,OAAQ,OAAQ,MAAM,CAChC,CAAC,EACoB,MAAM;AAAA,CAAI,EAAE,MAAM,GAAG,EAC1C,QAAQ,OAAO,MAAMF,EAAM,KAAK;AAAA,CAAI,EAAI;AAAA,CAAI,CAC9C,OAASC,EAAO,CAEVA,aAAiB,OACnB,QAAQ,OAAO,MAAM,yBAAyBA,EAAM,OAAO;AAAA,CAAI,CAEnE,CAGF,QAAQ,OAAO,MAAM;AAAA,CAAgB,CACvC,CAEA,OAAOH,EAAoB,CAC7B,CC1GA,IAAMM,GAA0B,CAC9B,YACA,MACA,SACA,QACA,SACA,YACA,aACA,iBACA,UACA,WACA,MACA,UACF,EAKA,SAASC,GAAeC,EAAwB,CAC9C,IAAMC,EAAcD,EAAO,YAAY,EAEvC,MAAI,iCAAiC,KAAKC,CAAW,EAAU,aAC3D,gCAAgC,KAAKA,CAAW,EAAU,iBAC1D,oBAAoB,KAAKA,CAAW,EAAU,UAC9C,+BAA+B,KAAKA,CAAW,EAAU,WACzD,6BAA6B,KAAKA,CAAW,EAAU,MACvD,4BAA4B,KAAKA,CAAW,EAAU,iBACtD,qBAAqB,KAAKA,CAAW,EAAU,UAE5C,SACT,CAKA,SAASC,GAAcC,EAAeC,EAA4B,CAEhE,MAAO,WADaA,EAAW,MAAM,GAAG,EAAE,IAAI,GAAK,SACtB,IAAID,CAAK,EACxC,CAKA,SAASE,GAAgBF,EAAuB,CAC9C,MAAO,UAAUA,CAAK,EACxB,CAKO,SAASG,GAAoBC,EAA8B,CAChE,IAAMP,EAASO,EAAM,QAAU,GACzBH,EAAaG,EAAM,aAAeC,EAAc,EAGtD,GAAIR,EAAO,OAAS,GAClB,OAAOS,EAAoB,EAI7B,IAAMR,EAAcD,EAAO,YAAY,EACnCU,EAAiB,GAErB,QAAWC,KAAWb,GACpB,GAAIG,EAAY,SAASU,CAAO,EAAG,CACjCD,EAAiBC,EACjB,KACF,CAGF,GAAI,CAACD,EACH,OAAOD,EAAoB,EAG7BG,EAAQ,uBAAwB,oCAAoCF,CAAc,EAAE,EAGpF,IAAMG,EAAWd,GAAeC,CAAM,EAChCc,EAAgBZ,GAAc,iBAAkBE,CAAU,EAC1DW,EAAeV,GAAgB,gBAAgB,EAErD,OAAAO,EAAQ,uBAAwB,qCAAqCF,CAAc,eAAeG,CAAQ,GAAG,EAOtG,CACL,SAAU,GACV,cANgB,2CAA2CH,CAAc;AAAA,6CAChCA,CAAc,4CAA4CI,CAAa;AAAA,4BACxFC,CAAY,GAKtC,CACF,CC9FA,OAAS,cAAAC,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAGrB,IAAMC,GAA0B,CAC9B,YACA,MACA,SACA,QACA,SACA,QACA,YACA,MACA,QACA,OACA,SACF,EAGMC,GAAkE,CACtE,CACE,QAAS,oBACT,QACE,mGACJ,EACA,CACE,QAAS,wBACT,QACE,mGACJ,EACA,CACE,QAAS,iCACT,QAAS,oEACX,EACA,CACE,QAAS,eACT,QACE,uFACJ,EACA,CACE,QAAS,8BACT,QAAS,wEACX,EACA,CACE,QAAS,YACT,QAAS,6EACX,EACA,CACE,QAAS,wBACT,QAAS,0EACX,CACF,EAuBA,SAASC,GAAuBC,EAAyB,CACvD,IAAMC,EAAcD,EAAO,YAAY,EAEvC,QAAWE,KAAWL,GACpB,GAAII,EAAY,SAASC,CAAO,EAC9B,MAAO,GAIX,MAAO,EACT,CAKA,SAASC,GAAeH,EAAwB,CAC9C,IAAMC,EAAcD,EAAO,YAAY,EAEvC,MAAI,iCAAiC,KAAKC,CAAW,EAAU,aAC3D,gCAAgC,KAAKA,CAAW,EAAU,iBAC1D,oBAAoB,KAAKA,CAAW,EAAU,UAC9C,+BAA+B,KAAKA,CAAW,EAAU,WACzD,6BAA6B,KAAKA,CAAW,EAAU,MAEpD,SACT,CAKA,SAASG,GAAwBJ,EAAgBK,EAA8B,CAC7E,IAAMJ,EAAcD,EAAO,YAAY,EACjCM,EAAqB,CAAC,EAG5B,OAAW,CAAE,QAAAC,EAAS,QAAAC,CAAQ,IAAKV,GAC7BG,EAAY,SAASM,CAAO,GAC9BD,EAAS,KAAKE,CAAO,EAKzB,IAAMC,EAAeb,GAAKS,EAAY,UAAW,WAAY,uBAAuB,EACpF,GAAIX,GAAWe,CAAY,EACzB,GAAI,CAEF,IAAMC,GADqB,KAAK,MAAMf,GAAac,EAAc,MAAM,CAAC,EAC3C,UAAY,CAAC,GAAG,OAAQE,GAAMA,EAAE,UAAY,QAAQ,EAEjF,QAAWJ,KAAWG,EACpB,GAAIH,EAAQ,KAAM,CAEhB,IAAMK,EADeL,EAAQ,KAAK,YAAY,EACf,MAAM,GAAG,EAAE,CAAC,EACvCK,GAAaX,EAAY,SAASW,CAAS,GAC7CN,EAAS,KAAK,sBAAsBC,EAAQ,IAAI,EAAE,CAEtD,CAEJ,MAAQ,CAER,CAIF,IAAMM,EAAqBjB,GAAK,QAAQ,IAAI,MAAQ,GAAI,UAAW,sBAAsB,EACzF,GAAIF,GAAWmB,CAAkB,EAC/B,GAAI,CACF,IAAMC,EAA2B,KAAK,MAAMnB,GAAakB,EAAoB,MAAM,CAAC,EACpF,OAAW,CAAE,QAAAN,EAAS,QAAAC,CAAQ,IAAKM,EAAK,cAAgB,CAAC,EACnDb,EAAY,SAASM,EAAQ,YAAY,CAAC,GAC5CD,EAAS,KAAK,GAAGC,CAAO,KAAKC,CAAO,EAAE,CAG5C,MAAQ,CAER,CAGF,OAAOF,CACT,CAKA,SAASS,GAAcC,EAAeX,EAA4B,CAEhE,MAAO,WADaA,EAAW,MAAM,GAAG,EAAE,IAAI,GAAK,SACtB,IAAIW,CAAK,EACxC,CAKA,SAASC,GAAoBjB,EAAgBK,EAA4B,CACvE,IAAMa,EAAWf,GAAeH,CAAM,EAChCmB,EAASJ,GAAc,iBAAkBV,CAAU,EAGzD,MAAO;AAAA;AAAA,sCAE6Ba,CAAQ;AAAA;AAAA,gBAE9BlB,EAAO,MAAM,EAAG,EAAE,CAAC,kBAAkBmB,CAAM;AAAA;AAAA;AAAA;AAAA,gBAI3CnB,EAAO,MAAM,EAAG,EAAE,CAAC,kBAAkBmB,CAAM;AAAA;AAAA;AAAA;AAAA,gBAI3CnB,EAAO,MAAM,EAAG,EAAE,CAAC,mFACnC,CAKO,SAASoB,GAAmBC,EAA8B,CAC/D,IAAMrB,EAASqB,EAAM,QAAU,GACzBhB,EAAagB,EAAM,aAAeC,EAAc,EAEtD,GAAI,CAACtB,EACH,OAAOuB,EAAoB,EAI7B,GAAI,CAACxB,GAAuBC,CAAM,EAChC,OAAOuB,EAAoB,EAG7BC,EAAQ,sBAAuB,sCAAsC,EAGrE,IAAMlB,EAAWF,GAAwBJ,EAAQK,CAAU,EAGrDoB,EAAkBR,GAAoBjB,EAAQK,CAAU,EAE9D,GAAIC,EAAS,OAAS,EAAG,CACvBkB,EAAQ,sBAAuB,gCAAgClB,EAAS,KAAK,IAAI,CAAC,EAAE,EAGpF,IAAMoB,EAAiB;AAAA;AAAA;AAAA;AAAA,EAIzBpB,EAAS,IAAKqB,GAAM,KAAKA,CAAC,EAAE,EAAE,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA;AAAA;AAAA,EAIxCF,CAAe,GAEb,OAAOG,EAAoBF,CAAc,CAC3C,CAGA,MAAI,iCAAiC,KAAK1B,EAAO,YAAY,CAAC,EACrD4B,EAAoBH,CAAe,EAGrCF,EAAoB,CAC7B,CC1OA,OAAS,cAAAM,OAAkB,UAC3B,OAAS,QAAAC,OAAY,YAKd,SAASC,GAAgBC,EAA8B,CAC5D,IAAMC,EAASD,EAAM,QAAU,GACzBE,EAAaF,EAAM,aAAeG,EAAc,EAEtDC,EAAQ,mBAAoB,yBAAyBH,EAAO,MAAM,SAAS,EAE3E,IAAMI,EAAyB,CAAC,EAGhC,GAAI,wBAAwB,KAAKJ,CAAM,EAAG,CACxC,IAAMK,EAAeR,GAAKI,EAAY,OAAQ,QAAQ,EAClDL,GAAWS,CAAY,GACzBD,EAAa,KAAK,6CAA6C,CAEnE,CAGA,MAAI,2BAA2B,KAAKJ,EAAO,YAAY,CAAC,GACtDI,EAAa,KAAK,gDAAgD,EAIhE,uCAAuC,KAAKJ,EAAO,YAAY,CAAC,GAClEI,EAAa,KAAK,gDAAgD,EAIhEA,EAAa,OAAS,GACxBD,EAAQ,mBAAoB,kBAAkBC,EAAa,KAAK,GAAG,CAAC,EAAE,EAKjEE,EAAoB,CAC7B,CCxBA,OAAS,cAAAC,GAAY,gBAAAC,GAAc,iBAAAC,GAAe,aAAAC,OAAiB,UACnE,OAAS,QAAAC,OAAqB,YAG9B,IAAMC,GAAkB,GAClBC,GAAmB,IACnBC,GAAuB,EACvBC,GAAsB,GACtBC,GAAsB,EAsB5B,SAASC,GAAsBC,EAA0C,CACvE,GAAI,CAACA,EAAc,MAAO,GAE1B,IAAMC,EAAc,KAAK,IAAI,EACzBC,EAEJ,GAAI,QAAQ,KAAKF,CAAY,EAC3BE,EAAY,SAASF,EAAc,EAAE,UAErCE,EAAY,IAAI,KAAKF,CAAY,EAAE,QAAQ,EACvC,MAAME,CAAS,EAAG,MAAO,GAG/B,IAAMC,GAAcF,EAAcC,IAAc,IAAO,IAEvD,OAAIC,GAAc,EAAU,GACxBA,GAAc,GAAW,EACzBA,GAAc,GAAW,EACzBA,GAAc,GAAW,EACzBA,GAAc,IAAY,EACvB,CACT,CAKA,SAASC,GAAwBC,EAAuB,CACtD,OAAIA,GAAS,GAAW,GACpBA,GAAS,EAAU,EACnBA,GAAS,EAAU,EACnBA,GAAS,EAAU,EACnBA,GAAS,EAAU,EAChB,CACT,CAKA,SAASC,GAAwBC,EAAwBC,EAAkC,CACzF,GAAID,EAAa,SAAW,GAAKC,EAAe,SAAW,EACzD,MAAO,GAGT,IAAMC,EAAU,IAAI,IAAIF,EAAa,IAAKG,GAAMA,EAAE,YAAY,CAAC,CAAC,EAC1DC,EAAY,IAAI,IAAIH,EAAe,IAAKE,GAAMA,EAAE,YAAY,CAAC,CAAC,EAEhEE,EAAU,EACd,QAAWC,KAAWJ,EAChBE,EAAU,IAAIE,CAAO,GACvBD,IAIJ,IAAME,EAAeF,EAAUH,EAAQ,KAEvC,OAAIK,GAAgB,IAAa,GAC7BA,GAAgB,GAAY,EAC5BA,GAAgB,GAAY,EAC5BA,GAAgB,IAAa,EAC7BF,EAAU,EAAU,EACjB,CACT,CAKA,SAASG,GAAsBC,EAA0B,CACvD,IAAMC,EAAY,IAAI,IAAI,CACxB,MACA,MACA,MACA,OACA,OACA,OACA,OACA,OACA,OACA,MACA,SACA,QACA,OACF,CAAC,EAED,OAAOD,EACJ,YAAY,EACZ,MAAM,gBAAgB,GACrB,OAAQE,GAAS,CAACD,EAAU,IAAIC,CAAI,CAAC,EACtC,MAAM,EAAG,EAAE,GAAK,CAAC,CACtB,CAKA,SAASC,IAA2B,CAElC,MAAO,gCADWC,EAAa,CACiB,OAClD,CAKA,SAASC,IAA6B,CACpC,IAAMC,EAAYH,GAAiB,EAEnC,GAAI9B,GAAWiC,CAAS,EACtB,GAAI,CACF,OAAO,KAAK,MAAMhC,GAAagC,EAAW,MAAM,CAAC,CACnD,MAAQ,CAER,CAIF,IAAMC,EAAmB,CACvB,WAFgBH,EAAa,EAG7B,WAAY,IAAI,KAAK,EAAE,YAAY,EACnC,qBAAsB,EACtB,eAAgB,KAChB,MAAO,CAAC,CACV,EAEA,OAAA7B,GAAc+B,EAAW,KAAK,UAAUC,EAAO,KAAM,CAAC,CAAC,EAChDA,CACT,CAKA,SAASC,GAA0BD,EAA0B,CAE3D,IAAME,EAAa,QAAQ,IAAI,6BAC/B,GAAIA,EAAY,CACd,IAAMC,EAAS,WAAWD,CAAU,EACpC,GAAI,CAAC,MAAMC,CAAM,EAAG,OAAOA,CAC7B,CAGA,OAAIH,EAAM,eAAiB,EAClBA,EAAM,qBAAuBA,EAAM,eAGrC,CACT,CAYA,SAASI,GAAoBJ,EAAkBf,EAA4C,CACzF,IAAMoB,EAA+B,CAAC,EAEtC,QAAWC,KAAQN,EAAM,MAAO,CAC9B,IAAMvB,EAAe6B,EAAK,eAAiBA,EAAK,UAC1CC,EAAcD,EAAK,cAAgB,EACnCE,EAAWF,EAAK,MAAQ,CAAC,EAEzBG,EAAejC,GAAsBC,CAAY,EACjDiC,EAAiB7B,GAAwB0B,CAAW,EACpDI,EAAiB5B,GAAwByB,EAAUvB,CAAc,EACjE2B,EAAaH,EAAeC,EAAiBC,EAEnDE,EACE,0BACA,UAAUP,EAAK,EAAE,OAAOG,CAAY,MAAMC,CAAc,MAAMC,CAAc,UAAUC,CAAU,EAClG,EAEIA,GAActC,IAChB+B,EAAW,KAAK,CACd,MAAOO,EACP,SAAUA,GAAcvC,GAAuB,OAAS,MACxD,OAAQiC,EAAK,GACb,OAAQA,EAAK,kBAAoB,GACnC,CAAC,CAEL,CAGA,OAAOD,EAAW,KAAK,CAACS,EAAGC,IAAMD,EAAE,MAAQC,EAAE,KAAK,EAAE,MAAM,EAAGxC,EAAmB,CAClF,CAKA,SAASyC,GAA2BX,EAAsC,CACxE,IAAIY,EAAe,EACbC,EAAkB,CAAC,EAEzB,QAASC,EAAI,EAAGA,EAAId,EAAW,OAAQc,IAAK,CAC1C,GAAM,CAAE,SAAAC,EAAU,OAAAC,EAAQ,MAAAC,EAAO,OAAAC,CAAO,EAAIlB,EAAWc,CAAC,EACxDF,GAAgBM,EAGhB,IAAMC,EAAcH,EAAO,QAAQ,yBAA0B,EAAE,EAC/DH,EAAM,KAAK,KAAKC,EAAI,CAAC,MAAMC,CAAQ,KAAKI,CAAW,YAAYF,CAAK,YAAYC,CAAM,IAAI,CAC5F,CAEA,MAAO;AAAA,EACPL,EAAM,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA,sBAEID,CAAY;AAAA,uDAElC,CAKO,SAASQ,GAAsBC,EAA8B,CAClE,IAAMC,EAAaD,EAAM,aAAeE,EAAc,EAChDnC,EAASiC,EAAM,QAAU,GAGzBG,EAAS3D,GAAKyD,EAAY,MAAM,EACtC,GAAI,CAAC7D,GAAW+D,CAAM,EACpB,GAAI,CACF5D,GAAU4D,EAAQ,CAAE,UAAW,EAAK,CAAC,CACvC,MAAQ,CAER,CAIF,IAAM7B,EAAQF,GAAgB,EAGxBgC,EAAe7B,GAA0BD,CAAK,EAOpD,GANAa,EACE,0BACA,kBAAkBiB,CAAY,wBAAwB3D,EAAe,GACvE,EAGI2D,EAAe3D,GACjB,OAAA0C,EAAQ,0BAA2B,gDAAgD,EAC5EkB,EAAoB,EAI7B,GAAID,GAAgB1D,GAAkB,CACpCyC,EAAQ,0BAA2B,8BAA8BiB,EAAe,GAAG,UAAU,EAC7F,IAAME,EAAc,8BAA8B,KAAK,MAAMF,EAAe,GAAG,CAAC,qGAChF,OAAOG,EAAoBD,CAAW,CACxC,CAGA,GAAI,CAACvC,EACH,OAAAoB,EAAQ,0BAA2B,uDAAuD,EACnFkB,EAAoB,EAG7B,IAAM9C,EAAiBO,GAAsBC,CAAM,EACnDoB,EAAQ,0BAA2B,8BAA8B5B,EAAe,KAAK,IAAI,CAAC,EAAE,EAG5F,IAAMoB,EAAaD,GAAoBJ,EAAOf,CAAc,EAE5D,GAAIoB,EAAW,OAAS,EAAG,CACzB,IAAM6B,EAAUlB,GAA2BX,CAAU,EACrD,OAAAQ,EACE,0BACA,gBAAgBR,EAAW,MAAM,qBACnC,EACO4B,EAAoBC,CAAO,CACpC,CAEA,OAAOH,EAAoB,CAC7B,CCtTA,OAAS,cAAAI,GAAY,gBAAAC,OAAoB,UACzC,OAAS,QAAAC,OAAY,YAGrB,IAAMC,GAA0B,CAC9B,MACA,YACA,SACA,QACA,SACA,WACA,SACA,SACA,MACA,SACA,WACA,SACA,WACA,WACA,YACA,SACA,UACA,UACA,WACA,aACA,aACF,EAGMC,GAAyB,CAC7B,eACA,UACA,YACA,UACA,OACA,aACA,uBACA,qBACF,EAGMC,GAAoB,GAK1B,SAASC,GAAmBC,EAAyB,CACnD,IAAMC,EAAcD,EAAO,YAAY,EAEvC,QAAWE,KAAWN,GACpB,GAAIK,EAAY,SAASC,CAAO,EAC9B,MAAO,GAIX,MAAO,EACT,CAKA,SAASC,GAAgBH,EAAyB,CAChD,IAAMC,EAAcD,EAAO,YAAY,EAEvC,QAAWE,KAAWL,GACpB,GAAI,IAAI,OAAOK,EAAS,GAAG,EAAE,KAAKD,CAAW,EAC3C,MAAO,GAIX,MAAO,EACT,CAKA,SAASG,GAAmBJ,EAAwB,CAClD,IAAMK,EAAY,IAAI,IAAI,CACxB,MACA,IACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,MACA,MACA,OACA,KACA,OACA,QACA,OACA,MACA,MACA,KACA,OACA,MACA,OACA,QACA,QACA,SACA,MACA,MACA,QACA,OACA,QACA,IACA,MACA,KACA,OACA,KACA,OACA,OACA,QACA,QACA,KACA,OACA,MACA,QACA,MACA,MACA,KACA,MACA,KACA,OACA,OACA,OACA,QACA,MACA,OACA,QACA,MACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,SACA,QACF,CAAC,EASD,OAPcL,EACX,YAAY,EACZ,QAAQ,YAAa,GAAG,EACxB,MAAM,KAAK,EACX,OAAQM,GAASA,EAAK,OAAS,GAAK,CAACD,EAAU,IAAIC,CAAI,CAAC,EACxD,MAAM,EAAG,CAAC,EAEA,KAAK,GAAG,CACvB,CAKA,SAASC,GAAcC,EAAeC,EAA4B,CAEhE,MAAO,WADaA,EAAW,MAAM,GAAG,EAAE,IAAI,GAAK,SACtB,IAAID,CAAK,EACxC,CAKA,SAASE,GAAgBD,EAA4B,CAEnD,IAAME,EAAU,QAAQ,IAAI,gBAC5B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",
  "names": ["isBashInput", "input", "isWriteInput", "isEditInput", "isReadInput", "appendFileSync", "existsSync", "statSync", "renameSync", "mkdirSync", "readSync", "execSync", "getLogDir", "getProjectDir", "getPluginRoot", "getSessionId", "getCachedBranch", "projectDir", "branch", "getLogLevel", "shouldLog", "level", "levels", "outputSilentSuccess", "outputSilentAllow", "outputBlock", "reason", "outputWithContext", "ctx", "outputPromptContext", "outputAllowWithContext", "systemMessage", "result", "outputError", "message", "outputWarning", "outputDeny", "LOG_ROTATION_MAX_SIZE", "PERMISSION_LOG_MAX_SIZE", "rotateLogFile", "logFile", "maxSize", "rotated", "ensureDir", "dir", "logHook", "hookName", "logDir", "timestamp", "logPermissionFeedback", "decision", "input", "toolName", "sessionId", "readHookInput", "chunks", "buf", "bytesRead", "fd", "getField", "path", "parts", "value", "part", "normalizeCommand", "command", "escapeRegex", "str", "execSync", "getCurrentBranch", "projectDir", "dir", "getProjectDir", "execSync", "isProtectedBranch", "branch", "currentBranch", "getRepoRoot", "isGitRepo", "getGitStatus", "hasUncommittedChanges", "getDefaultBranch", "extractIssueNumber", "patterns", "pattern", "match", "validateBranchName", "validPrefixes", "prefix", "createGuard", "predicate", "input", "outputSilentSuccess", "guardFileExtension", "extensions", "filePath", "ext", "e", "guardCodeFiles", "guardPythonFiles", "guardTypescriptFiles", "guardTestFiles", "p", "guardSkipInternal", "guardPathPattern", "patterns", "pattern", "guardTool", "tools", "toolName", "guardWriteEdit", "guardBash", "guardNontrivialBash", "command", "guardGitCommand", "guardMultiInstance", "dbPath", "existsSync", "runGuards", "guards", "guard", "result", "THRESHOLDS", "DEFAULT_CONFIG", "existsSync", "readFileSync", "readdirSync", "join", "SIGNAL_WEIGHTS", "NEGATION_PATTERNS", "CONTEXT_BOOST_KEYWORDS", "agentIndex", "agentIndexPath", "getAgentIndex", "agentsDir", "index", "files", "readdirSync", "f", "file", "agentName", "filePath", "join", "frontmatterMatch", "readFileSync", "frontmatter", "descMatch", "description", "activatesMatch", "descPart", "keywords", "phrases", "rawKeywords", "k", "kw", "skillsMatch", "skills", "l", "logHook", "skillIndex", "skillIndexPath", "getSkillIndex", "skillsDir", "dirs", "d", "skillName", "skillFile", "existsSync", "tagsMatch", "t", "descKeywords", "w", "calculateKeywordScore", "promptLower", "score", "matched", "signals", "keyword", "weight", "maxScore", "calculatePhraseScore", "phrase", "calculateContextScore", "history", "continuationWord", "recentHistory", "calculateNegationPenalty", "prompt", "penalty", "pattern", "applyCalibration", "matchedKeywords", "adjustments", "totalAdjustment", "adj", "classifyAgentMatch", "entry", "allSignals", "allMatched", "keywordResult", "phraseResult", "contextResult", "negationResult", "calibrationResult", "THRESHOLDS", "classifySkillMatch", "classifyIntent", "pluginRoot", "getPluginRoot", "agentMatches", "skillMatches", "agentIdx", "match", "skillIdx", "a", "b", "topAgent", "intent", "categorizeIntent", "maxConfidence", "shouldAutoDispatch", "shouldInjectSkills", "agent", "categories", "category", "categoryKeywords", "shouldClassify", "clearCache", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "getStateDir", "getProjectDir", "getStateFile", "sessionId", "getSessionId", "getConfigFile", "ensureStateDir", "dir", "existsSync", "mkdirSync", "logHook", "loadState", "stateFile", "data", "readFileSync", "err", "saveState", "state", "writeFileSync", "updateState", "mutate", "trackDispatchedAgent", "agent", "confidence", "taskId", "dispatched", "a", "updateAgentStatus", "status", "entry", "removeAgent", "getActiveAgent", "isAgentDispatched", "trackInjectedSkill", "skill", "isSkillInjected", "getInjectedSkills", "addToPromptHistory", "prompt", "getPromptHistory", "cacheClassification", "result", "getLastClassification", "DEFAULT_CONFIG_VALUES", "loadConfig", "configFile", "saveConfig", "config", "merged", "clearSessionState", "unlinkSync", "cleanupOldStates", "readdirSync", "statSync", "files", "f", "b", "file", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "getRegistryFile", "sessionId", "getSessionId", "getProjectDir", "ensureDir", "dir", "existsSync", "mkdirSync", "loadRegistry", "file", "readFileSync", "saveRegistry", "registry", "writeFileSync", "err", "logHook", "getActiveFormForAgent", "agent", "description", "action", "shortDesc", "generateTaskCreateInstruction", "confidence", "metadata", "agentTitle", "w", "fullMetadata", "generateTaskUpdateInstruction", "taskId", "status", "blockedBy", "blocks", "instruction", "formatTaskCreateForClaude", "generateTaskDeleteInstruction", "_reason", "formatTaskDeleteForClaude", "reason", "formatTaskUpdateForClaude", "md", "registerTask", "pipelineId", "pipelineStep", "t", "updateTaskStatus", "task", "getTaskByAgent", "getTaskById", "getTasksBlockedBy", "failedTaskId", "getOrphanedTasks", "failedIds", "id", "getPipelineTasks", "a", "b", "registerPipeline", "pipeline", "p", "updatePipeline", "updates", "getActivePipeline", "completePipelineStep", "step", "tasks", "taskStep", "cleanupOldTasks", "maxAgeMs", "cutoff", "DEFAULT_MAX_RETRIES", "DEFAULT_BASE_DELAY_MS", "MAX_DELAY_MS", "ALTERNATIVE_AGENTS", "NON_RETRYABLE_ERRORS", "ALTERNATIVE_SUGGESTING_ERRORS", "calculateBackoffDelay", "attemptNumber", "baseDelayMs", "exponentialDelay", "jitter", "isRetryableError", "error", "pattern", "suggestsAlternative", "getAlternativeAgent", "agent", "triedAgents", "alternatives", "alt", "makeRetryDecision", "maxRetries", "logHook", "alternative", "delayMs", "createAttempt", "taskId", "completeAttempt", "attempt", "outcome", "completedAt", "durationMs", "analyzeAttemptHistory", "attempts", "successRate", "durations", "avgDuration", "b", "errorCounts", "normalized", "commonErrors", "prepareForRetry", "decision", "formatRetryDecision", "message", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "createHash", "MAX_RECORDS", "MIN_SAMPLES_FOR_ADJUSTMENT", "MAX_ADJUSTMENT", "ADJUSTMENT_STEP", "DECAY_FACTOR", "getCalibrationFile", "getProjectDir", "ensureDir", "dir", "existsSync", "mkdirSync", "loadCalibrationData", "file", "readFileSync", "logHook", "saveCalibrationData", "data", "writeFileSync", "err", "hashPrompt", "prompt", "createHash", "recordOutcome", "agent", "matchedKeywords", "confidence", "outcome", "durationMs", "feedback", "record", "getSessionId", "updateAdjustments", "updateStats", "isPositive", "isNegative", "adjustmentDelta", "keyword", "existing", "applyDecay", "now", "dayMs", "adj", "age", "a", "records", "successful", "avgConf", "sum", "r", "agentStats", "stat", "b", "getAdjustments", "getAgentSuccessRate", "agentRecords", "getCalibrationStats", "hasMinimalCalibrationData", "PIPELINES", "detectPipeline", "prompt", "promptLower", "pipeline", "trigger", "logHook", "getPipelineByType", "type", "p", "createPipelineExecution", "pipelineId", "tasks", "taskIds", "i", "step", "taskId", "metadata", "blockedBy", "dep", "registerPipelineExecution", "execution", "registerPipeline", "task", "registerTask", "formatPipelinePlan", "md", "deps", "d", "readFileSync", "writeFileSync", "existsSync", "mkdirSync", "createHash", "COLORS", "hashString", "content", "createHash", "detectDecisionCategory", "text", "lowerText", "categoryPatterns", "category", "pattern", "detectImpact", "sectionType", "highPatterns", "extractCCVersion", "generateDecisionId", "version", "index", "slug", "parseChangelog", "versions", "lines", "versionRegex", "sectionRegex", "currentVersion", "currentSection", "line", "versionMatch", "sectionMatch", "ccVersion", "changelogToDecisions", "parsed", "decisions", "entryIndex", "section", "statusMap", "entry", "loadSessionDecisions", "sessionFile", "getProjectDir", "existsSync", "readFileSync", "item", "loadCoordinationDecisions", "coordFile", "items", "loadChangelogDecisions", "pluginRoot", "getPluginRoot", "cacheFile", "changelogFile", "changelogContent", "currentHash", "cached", "cacheDir", "mkdirSync", "writeFileSync", "deduplicateById", "seen", "d", "aggregateDecisions", "sources", "sessionDecisions", "changelogDecisions", "coordDecisions", "sortedDecisions", "b", "groupDecisions", "groupBy", "grouped", "key", "formatTable", "limit", "header", "rows", "date", "ccVer", "summary", "footer", "remaining", "remainingNote", "formatTimeline", "output", "sortedGroups", "a", "aDate", "group", "label", "dateStr", "summaryStr", "impactColor", "formatStats", "aggregated", "metadata", "byCategory", "byCCVersion", "byImpact", "bySource", "k", "v", "formatDecisionDetail", "decision", "sanitizeMermaidText", "maxLength", "formatMermaid", "topItems", "validateMermaidViaAPI", "mermaidCode", "code", "base64", "generateMermaidDocument", "doc", "stats", "filterDecisions", "options", "filtered", "cutoff", "searchDecisions", "query", "lowerQuery", "SAFE_PATTERNS", "autoApproveSafeBash", "input", "command", "logHook", "pattern", "logPermissionFeedback", "outputSilentAllow", "outputSilentSuccess", "resolve", "isAbsolute", "EXCLUDED_DIRS", "autoApproveProjectWrites", "input", "filePath", "projectDir", "getProjectDir", "logHook", "dir", "outputSilentSuccess", "logPermissionFeedback", "outputSilentAllow", "existsSync", "readFileSync", "join", "SECURITY_BLOCKLIST", "isSecurityBlocked", "command", "pattern", "loadLearnedPatterns", "pluginRoot", "getPluginRoot", "feedbackFile", "shouldAutoApprove", "patterns", "learningTracker", "input", "toolName", "logHook", "outputSilentSuccess", "logPermissionFeedback", "outputSilentAllow", "DANGEROUS_PATTERNS", "PIPE_TO_SHELL_RE", "GIT_FORCE_PUSH_RE", "dangerousCommandBlocker", "input", "command", "outputSilentSuccess", "normalizedCommand", "normalizeCommand", "pattern", "logHook", "logPermissionFeedback", "outputDeny", "reason", "VALID_COMMIT_TYPES", "STAGED_FILE_WARNING_THRESHOLD", "extractCommitMessage", "command", "quotedMatch", "unquotedMatch", "extractNewBranchName", "checkoutMatch", "branchMatch", "validateBranchProtection", "currentBranch", "isProtectedBranch", "errorMsg", "logPermissionFeedback", "outputDeny", "outputWithContext", "validateBranchNaming", "branchName", "validationError", "validateBranchName", "context", "outputAllowWithContext", "validateCommitMessage", "commitMsg", "typesPattern", "conventionalPattern", "simplePattern", "titleLen", "validateAtomicCommit", "projectDir", "stagedCount", "getGitStatus", "line", "gitValidator", "input", "outputSilentSuccess", "getCachedBranch", "logHook", "protectionResult", "commitMsgResult", "branchNameResult", "atomicResult", "contexts", "DANGEROUS_SEGMENTS", "validateSegment", "segment", "trimmed", "pattern", "validateCompoundCommand", "command", "segments", "compoundCommandValidator", "input", "outputSilentSuccess", "normalizedCommand", "normalizeCommand", "blockReason", "errorMsg", "logPermissionFeedback", "logHook", "outputDeny", "DEFAULT_TIMEOUT", "defaultTimeoutSetter", "input", "command", "timeout", "description", "updatedInput", "logHook", "existsSync", "readFileSync", "join", "loadErrorRules", "projectDir", "rulesFile", "countCommonWords", "str1", "str2", "words1", "words2", "count", "word", "errorPatternWarner", "input", "getProjectDir", "command", "outputSilentSuccess", "rules", "hints", "r", "rule", "sampleCommand", "logHook", "contextMsg", "outputWithContext", "execSync", "getPotentialConflicts", "projectDir", "targetBranch", "changedFiles", "conflicts", "file", "conflictPredictor", "input", "command", "getProjectDir", "outputSilentSuccess", "branchMatch", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "execSync", "existsSync", "join", "basename", "dirname", "findRelatedTests", "projectDir", "sourceFile", "tests", "baseName", "dirName", "testPatterns", "pattern", "fullPath", "getChangedFiles", "line", "file", "affectedTestsFinder", "input", "command", "getProjectDir", "outputSilentSuccess", "changedFiles", "relatedTests", "uniqueTests", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "join", "detectCIChecks", "projectDir", "checks", "ciSimulation", "input", "command", "getProjectDir", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "join", "hasPreCommitConfig", "projectDir", "hasHuskyConfig", "preCommitSimulation", "input", "command", "getProjectDir", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "execSync", "getPRStatus", "projectDir", "prNumber", "prArg", "result", "prMergeGate", "input", "command", "getProjectDir", "outputSilentSuccess", "prMatch", "status", "context", "logPermissionFeedback", "outputAllowWithContext", "issues", "logHook", "execSync", "getRecentCommits", "projectDir", "since", "sinceArg", "groupCommitsByType", "commits", "groups", "commit", "match", "type", "changelogGenerator", "input", "command", "getProjectDir", "outputSilentSuccess", "sections", "c", "combined", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "getPackageJsonVersion", "projectDir", "filePath", "getPyprojectVersion", "match", "getVersionSources", "sources", "pkgVersion", "pyVersion", "versionSync", "input", "command", "getProjectDir", "outputSilentSuccess", "versions", "s", "uniqueVersions", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "PROBLEMATIC_LICENSES", "checkNpmLicenses", "projectDir", "issues", "lockFile", "content", "license", "licenseCompliance", "input", "command", "getProjectDir", "outputSilentSuccess", "pkgMatch", "pkgName", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "ISSUE_TEMPLATES", "detectIssueType", "command", "ghIssueCreationGuide", "input", "outputSilentSuccess", "issueType", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "DOCS_CHECKLIST", "issueDocsRequirement", "input", "command", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "isMultiInstanceEnabled", "projectDir", "dbPath", "getQualityGateStatus", "registryPath", "multiInstanceQualityGate", "input", "command", "getProjectDir", "outputSilentSuccess", "gates", "failedGates", "gate", "context", "g", "logPermissionFeedback", "logHook", "outputAllowWithContext", "BLOCKED_URL_PATTERNS", "SENSITIVE_ACTIONS", "extractUrl", "command", "urlMatch", "isBlockedUrl", "url", "pattern", "isSensitiveAction", "agentBrowserSafety", "input", "outputSilentSuccess", "logPermissionFeedback", "logHook", "outputDeny", "context", "outputAllowWithContext", "realpathSync", "existsSync", "resolve", "isAbsolute", "PROTECTED_PATTERNS", "CONFIG_PATTERNS", "resolveRealPath", "filePath", "projectDir", "absolutePath", "isProtected", "realPath", "pattern", "isConfigFile", "fileGuard", "input", "getProjectDir", "outputSilentSuccess", "logHook", "matchedPattern", "logPermissionFeedback", "outputDeny", "existsSync", "readFileSync", "join", "getCoordinationDbPath", "projectDir", "isCoordinationEnabled", "getInstanceId", "isLockedByOther", "filePath", "dbPath", "instanceId", "locks", "now", "fileLockCheck", "input", "getProjectDir", "toolName", "outputSilentSuccess", "normalizedPath", "existingLock", "logPermissionFeedback", "logHook", "outputDeny", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "join", "dirname", "getLocksFilePath", "projectDir", "join", "generateLockId", "getInstanceId", "calculateExpiry", "loadLocks", "locksPath", "existsSync", "readFileSync", "saveLocks", "data", "dir", "dirname", "mkdirSync", "writeFileSync", "checkExistingLock", "locks", "filePath", "instanceId", "now", "l", "checkDirectoryLock", "acquireLock", "reason", "multiInstanceLock", "input", "guardResult", "guardWriteEdit", "getProjectDir", "toolName", "outputSilentSuccess", "instanceDir", "logHook", "normalizedPath", "dirLock", "logPermissionFeedback", "outputDeny", "fileLock", "existsSync", "readFileSync", "join", "LAYER_PATTERNS", "detectArchLayer", "filePath", "layer", "patterns", "p", "loadPatternHints", "projectDir", "patternsDir", "layerPatternFile", "content", "count", "architectureChangeDetector", "input", "getProjectDir", "outputSilentSuccess", "guardResult", "guardPathPattern", "archLayer", "patternHints", "isNewFile", "archContext", "logPermissionFeedback", "logHook", "outputWithContext", "existsSync", "readFileSync", "join", "extname", "MAX_FUNCTION_LINES", "MAX_NESTING_DEPTH", "MAX_CONDITIONALS_PER_FUNCTION", "getFileExt", "filePath", "checkFunctionLength", "content", "ext", "warnings", "lines", "inFunction", "functionName", "functionLines", "line", "defMatch", "classMatch", "braceCount", "funcMatch", "constFuncMatch", "openBraces", "closeBraces", "checkNestingDepth", "maxDepth", "match", "indent", "depth", "braceDepth", "checkConditionals", "ifCount", "switchCount", "ternaryCount", "totalConditionals", "functionCount", "avgConditionals", "getCachedTypeErrors", "projectDir", "cacheFile", "cache", "basename", "codeQualityGate", "input", "getProjectDir", "guardResult", "runGuards", "guardCodeFiles", "guardSkipInternal", "outputSilentSuccess", "allWarnings", "typeErrors", "logHook", "qualityMsg", "outputWithContext", "extname", "getFileExt", "filePath", "isTestFile", "p", "findMissingPythonDocstrings", "content", "missing", "lines", "i", "funcMatch", "funcName", "hasDocstring", "j", "nextLine", "findMissingJSDoc", "hasJSDoc", "line", "exportMatch", "docstringEnforcer", "input", "guardResult", "runGuards", "guardCodeFiles", "guardSkipInternal", "outputSilentSuccess", "ext", "missingDocstrings", "funcList", "contextMsg", "logHook", "outputWithContext", "basename", "SECURITY_PATTERNS", "detectSecurityIssues", "content", "issues", "name", "pattern", "securityPatternValidator", "input", "filePath", "guardResult", "runGuards", "guardCodeFiles", "outputSilentSuccess", "securityIssues", "logHook", "warningMsg", "logPermissionFeedback", "outputWithContext", "existsSync", "readFileSync", "appendFileSync", "statSync", "renameSync", "mkdirSync", "join", "MAX_LOG_SIZE", "getTelemetryLog", "logDir", "getLogDir", "rotateLogIfNeeded", "logFile", "calculateCacheContext", "lines", "totalQueries", "librarySet", "line", "match", "recentLibraries", "i", "recentStr", "context7Tracker", "input", "toolName", "outputSilentSuccess", "libraryId", "query", "telemetryLog", "logEntry", "cacheContext", "logPermissionFeedback", "logHook", "outputWithContext", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "readdirSync", "join", "checkOrphanedSessions", "projectDir", "currentSessionId", "logsDir", "orphanedCount", "files", "file", "sessionId", "initDirectories", "dirs", "dir", "validateMcpHealth", "registerSession", "orphanCheckFile", "now", "sessions", "content", "memoryFabricInit", "input", "getProjectDir", "getSessionId", "logHook", "health", "msg", "outputWithContext", "outputSilentSuccess", "memoryValidator", "input", "toolName", "outputSilentSuccess", "entityNames", "entityCount", "logPermissionFeedback", "logHook", "outputWarning", "relations", "relationCount", "entities", "invalidCount", "e", "existsSync", "appendFileSync", "statSync", "renameSync", "mkdirSync", "join", "MAX_LOG_SIZE", "getThinkingLog", "logDir", "getLogDir", "rotateLogIfNeeded", "logFile", "sequentialThinkingAuto", "input", "outputSilentSuccess", "thought", "thoughtNumber", "totalThoughts", "nextNeeded", "isRevision", "thinkingLog", "logEntry", "logPermissionFeedback", "logHook", "existsSync", "extname", "getCurrentDate", "addHeader", "ext", "content", "date", "firstNewline", "shebang", "rest", "writeHeaders", "input", "toolName", "filePath", "content", "outputSilentSuccess", "existsSync", "ext", "extname", "logHook", "addHeader", "existsSync", "appendFileSync", "mkdirSync", "join", "dirname", "basename", "ensureDir", "dir", "appendSafe", "file", "content", "skillTracker", "input", "skillName", "skillArgs", "projectDir", "getProjectDir", "outputSilentSuccess", "logHook", "usageLog", "timestamp", "analyticsLog", "analyticsEntry", "backendFileNaming", "input", "guard", "guardPythonFiles", "filePath", "outputSilentSuccess", "filename", "dirname", "errors", "validRouterPattern", "utilPattern", "validServicePattern", "validRepoPattern", "validSchemaPattern", "validModelPattern", "reason", "logHook", "outputBlock", "execSync", "readFileSync", "existsSync", "join", "MIN_OUTPUT_LENGTH", "MAX_TEXT_LENGTH", "DECISION_INDICATORS", "KNOWN_AGENTS", "KNOWN_TECHNOLOGIES", "KNOWN_PATTERNS", "BEST_PRACTICE_PATTERNS", "HIGH_IMPORTANCE", "MEDIUM_IMPORTANCE", "cachedPluginVersion", "getCCVersion", "match", "getPluginVersion", "pluginRoot", "getPluginRoot", "path", "extractEntities", "text", "textLower", "a", "t", "p", "detectRelationType", "hasDecisionContent", "output", "lower", "ind", "extractDecisions", "decisions", "indicator", "regex", "matches", "cleaned", "detectCategory", "detectImportance", "k", "extractBestPractice", "name", "pattern", "decisionProcessor", "input", "skillName", "toolResult", "skillOutput", "outputSilentSuccess", "entities", "totalEntities", "parts", "firstDecision", "category", "importance", "bestPractice", "ccVersion", "pluginVersion", "metadata", "scriptPath", "relationType", "entityList", "backendLayerValidator", "input", "guard", "guardPythonFiles", "filePath", "content", "outputSilentSuccess", "errors", "reason", "logHook", "outputBlock", "existsSync", "appendFileSync", "mkdirSync", "execSync", "coverageCheck", "_input", "projectDir", "getProjectDir", "logDir", "getLogDir", "logFile", "threshold", "mkdirSync", "logLines", "timestamp", "coverageFile", "coverageXml", "existsSync", "totalLine", "execSync", "line", "match", "coverage", "coverageDir", "summaryFile", "appendFileSync", "outputSilentSuccess", "existsSync", "readFileSync", "COVERAGE_PATHS", "parseCoverage", "filePath", "content", "data", "coverageThresholdGate", "_input", "projectDir", "getProjectDir", "threshold", "coverageFile", "coverageContent", "path", "fullPath", "existsSync", "readFileSync", "outputSilentSuccess", "coverage", "reason", "outputBlock", "existsSync", "readFileSync", "isTestFile", "filePath", "findTestFile", "implFile", "base", "ext", "patterns", "pattern", "existsSync", "dir", "baseFilename", "testDirPatterns", "testFilename", "parentDir", "extractTestableUnits", "content", "units", "matches", "match", "name", "lines", "line", "crossInstanceTestValidator", "input", "outputSilentSuccess", "errors", "warnings", "testFile", "testableUnits", "testContent", "readFileSync", "untestedUnits", "unit", "filename", "outputBlock", "warningContext", "outputWithContext", "diPatternEnforcer", "input", "filePath", "content", "outputSilentSuccess", "filename", "errors", "match", "syncPattern", "lines", "line", "logHook", "ctx", "outputWithContext", "readFileSync", "readdirSync", "extractSignatures", "content", "filePath", "signatures", "matches", "lines", "line", "match", "findCodeFiles", "dir", "pattern", "files", "ignoreDirs", "walk", "currentDir", "entries", "readdirSync", "entry", "fullPath", "checkCopyPastePatterns", "warnings", "prev", "count", "startLine", "checkUtilityPatterns", "errors", "fetchCount", "validationCount", "jsonCount", "envCount", "duplicateCodeDetector", "input", "outputSilentSuccess", "projectRoot", "getRepoRoot", "getProjectDir", "codeFiles", "signature", "name", "codeFile", "fileContent", "readFileSync", "relPath", "copyPasteWarnings", "w", "utilityCheck", "ctx", "outputWithContext", "existsSync", "readFileSync", "readdirSync", "evalMetricsCollector", "_input", "projectDir", "getProjectDir", "messages", "evalResultsPath", "existsSync", "content", "readFileSync", "data", "key", "value", "formatted", "lines", "deepevalDir", "files", "readdirSync", "file", "ragasPath", "msg", "outputSilentSuccess", "existsSync", "appendFileSync", "mkdirSync", "readdirSync", "evidenceCollector", "_input", "logDir", "getLogDir", "projectDir", "getProjectDir", "logFile", "mkdirSync", "timestamp", "logLines", "lastExitCode", "existsSync", "testResultsDir", "files", "readdirSync", "file", "appendFileSync", "outputSilentSuccess", "getLayer", "filePath", "importDirectionEnforcer", "input", "guard", "guardCodeFiles", "content", "outputSilentSuccess", "layer", "errors", "reason", "logHook", "outputBlock", "existsSync", "readFileSync", "execSync", "getWorktrees", "execSync", "line", "getWorktreeBranch", "worktree", "isFileModified", "relPath", "status", "getBranchDivergence", "baseBranch", "currentBranch", "ahead", "behind", "mergeConflictPredictor", "input", "filePath", "content", "outputSilentSuccess", "worktrees", "warnings", "conflicts", "repoRoot", "getRepoRoot", "getProjectDir", "currentWorktree", "worktreeFile", "existsSync", "branch", "otherContent", "readFileSync", "newLines", "otherLines", "diff", "getCurrentBranch", "getDefaultBranch", "conflict", "ctx", "outputWithContext", "existsSync", "readFileSync", "execSync", "gitExec", "command", "cwd", "execSync", "getProjectDir", "mergeReadinessChecker", "input", "outputSilentSuccess", "targetBranch", "currentBranch", "getCurrentBranch", "projectRoot", "getRepoRoot", "errors", "warnings", "passes", "hasUncommittedChanges", "status", "ahead", "behind", "conflictFiles", "file", "mergeBase", "fileCount", "existsSync", "readFileSync", "pass", "warning", "error", "existsSync", "readFileSync", "execSync", "migrationValidator", "input", "filePath", "outputSilentSuccess", "existsSync", "errors", "content", "readFileSync", "outputWithContext", "execSync", "error", "logHook", "ctx", "existsSync", "patternConsistencyEnforcer", "input", "filePath", "content", "outputSilentSuccess", "patternsFile", "getRepoRoot", "getProjectDir", "existsSync", "errors", "warnings", "outputBlock", "warning", "API_KEY_PATTERNS", "SECRET_PATTERNS", "redactSecrets", "input", "toolOutput", "outputSilentSuccess", "pattern", "appendFileSync", "mkdirSync", "reviewSummaryGenerator", "_input", "logDir", "getLogDir", "logFile", "mkdirSync", "logContent", "appendFileSync", "outputSilentSuccess", "appendFileSync", "mkdirSync", "securitySummary", "_input", "logDir", "getLogDir", "logFile", "mkdirSync", "logContent", "appendFileSync", "outputSilentSuccess", "MAX_DEPTH", "structureLocationValidator", "input", "guard", "guardCodeFiles", "filePath", "outputSilentSuccess", "errors", "filename", "relativePath", "depth", "dirname", "reason", "logHook", "outputBlock", "isTestFile", "filePath", "testLocationValidator", "input", "guard", "guardCodeFiles", "outputSilentSuccess", "filename", "isTest", "reason", "logHook", "outputBlock", "isAllowed", "pattern", "isInAllowedDir", "isTestFile", "filePath", "testPatternValidator", "input", "content", "outputSilentSuccess", "errors", "shortTests", "t", "totalExpects", "totalTests", "avgExpects", "logHook", "outputBlock", "existsSync", "execSync", "findProjectRoot", "startDir", "dir", "existsSync", "testRunner", "input", "filePath", "outputSilentSuccess", "execSync", "lines", "error", "projectRoot", "testPattern", "IMPLEMENTATION_KEYWORDS", "detectCategory", "prompt", "promptLower", "getMem0UserId", "scope", "projectDir", "getGlobalUserId", "antipatternDetector", "input", "getProjectDir", "outputSilentSuccess", "matchedKeyword", "keyword", "logHook", "category", "projectUserId", "globalUserId", "existsSync", "readFileSync", "join", "IMPLEMENTATION_KEYWORDS", "KNOWN_ANTIPATTERNS", "isImplementationPrompt", "prompt", "promptLower", "keyword", "detectCategory", "searchLocalAntipatterns", "projectDir", "warnings", "pattern", "warning", "patternsFile", "failedPatterns", "p", "firstWord", "globalPatternsFile", "data", "getMem0UserId", "scope", "buildMem0SearchHint", "category", "userId", "antipatternWarning", "input", "getProjectDir", "outputSilentSuccess", "logHook", "mem0SearchHints", "warningMessage", "w", "outputPromptContext", "existsSync", "join", "contextInjector", "input", "prompt", "projectDir", "getProjectDir", "logHook", "contextHints", "issueDocsDir", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "join", "CONTEXT_TRIGGER", "CONTEXT_CRITICAL", "PRUNE_THRESHOLD_HIGH", "PRUNE_THRESHOLD_MED", "MAX_RECOMMENDATIONS", "calculateRecencyScore", "lastAccessed", "currentTime", "lastEpoch", "ageMinutes", "calculateFrequencyScore", "count", "calculateRelevanceScore", "itemKeywords", "promptKeywords", "itemSet", "k", "promptSet", "overlap", "keyword", "overlapRatio", "extractPromptKeywords", "prompt", "stopwords", "word", "getStateFilePath", "getSessionId", "loadOrInitState", "stateFile", "state", "getContextUsagePercentage", "envPercent", "parsed", "analyzeAndRecommend", "candidates", "item", "accessCount", "keywords", "recencyScore", "frequencyScore", "relevanceScore", "totalScore", "logHook", "a", "b", "buildRecommendationMessage", "totalSavings", "lines", "i", "priority", "itemId", "score", "tokens", "displayName", "contextPruningAdvisor", "input", "projectDir", "getProjectDir", "logDir", "contextUsage", "outputSilentSuccess", "criticalMsg", "outputPromptContext", "message", "existsSync", "readFileSync", "join", "MEMORY_TRIGGER_KEYWORDS", "GRAPH_TRIGGER_KEYWORDS", "MIN_PROMPT_LENGTH", "shouldSearchMemory", "prompt", "promptLower", "keyword", "hasGraphTrigger", "extractSearchTerms", "stopwords", "word", "getMem0UserId", "scope", "projectDir", "getAgentContext", "agentId", "trackingFile", "memoryContext", "input", "getProjectDir", "isMem0Available", "logHook", "outputSilentSuccess", "useGlobal", "useGraph", "agentContext", "searchTerms", "scopeDesc", "userIdDecisions", "systemMsg", "existsSync", "readFileSync", "writeFileSync", "appendFileSync", "mkdirSync", "join", "dirname", "MIN_PROMPT_LENGTH", "POSITIVE_PATTERNS", "NEGATIVE_PATTERNS", "detectSatisfaction", "prompt", "pattern", "getCounterFilePath", "projectDir", "getAndIncrementCounter", "counterFile", "dir", "counter", "logSatisfaction", "sessionId", "sentiment", "context", "feedbackDir", "logFile", "logEntry", "satisfactionDetector", "input", "getProjectDir", "getSessionId", "sampleRate", "outputSilentSuccess", "logHook", "existsSync", "readFileSync", "join", "MAX_SUGGESTIONS", "MIN_CONFIDENCE", "KEYWORD_MAPPINGS", "findMatchingSkills", "prompt", "promptLower", "skillScores", "keyword", "skill", "confidence", "currentScore", "a", "b", "getSkillDescription", "skillName", "skillsDir", "skillFile", "frontmatterMatch", "descriptionMatch", "buildSuggestionMessage", "matches", "message", "description", "skillAutoSuggest", "input", "pluginRoot", "getPluginRoot", "outputSilentSuccess", "logHook", "m", "suggestionMessage", "outputPromptContext", "COMPLEX_PATTERNS", "LONG_PROMPT_THRESHOLD", "todoEnforcer", "input", "prompt", "promptLength", "logHook", "isComplex", "pattern", "outputSilentSuccess", "MAX_SUGGESTIONS", "buildSuggestionMessage", "matches", "topMatch", "message", "THRESHOLDS", "second", "agentAutoSuggest", "input", "prompt", "shouldClassify", "outputSilentSuccess", "loadConfig", "logHook", "history", "getPromptHistory", "adjustments", "getAdjustments", "classifyIntent", "m", "suggestionMessage", "outputPromptContext", "buildAutoDispatchMessage", "match", "taskMeta", "THRESHOLDS", "buildStrongRecommendMessage", "buildSuggestionMessage", "buildAlternativeNote", "buildOrchestrationMessage", "result", "config", "topMatch", "message", "isAgentDispatched", "logHook", "s", "trackDispatchedAgent", "agentOrchestrator", "input", "prompt", "shouldClassify", "outputSilentSuccess", "loadConfig", "history", "getPromptHistory", "classifyIntent", "cacheClassification", "addToPromptHistory", "a", "outputPromptContext", "existsSync", "readFileSync", "join", "MAX_INJECTION_TOKENS", "CHARS_PER_TOKEN", "MAX_SKILLS_PER_PROMPT", "loadSkillContent", "skillName", "maxTokens", "pluginRoot", "getPluginRoot", "skillFile", "join", "existsSync", "logHook", "content", "readFileSync", "frontmatterMatch", "maxChars", "truncated", "lastParagraph", "err", "estimateTokens", "buildInjectionMessage", "skills", "message", "skill", "skillInjector", "input", "prompt", "shouldClassify", "outputSilentSuccess", "config", "loadConfig", "result", "getLastClassification", "classifyIntent", "eligibleSkills", "s", "THRESHOLDS", "isSkillInjected", "maxTotalTokens", "skillCount", "tokensPerSkill", "loadedSkills", "totalTokens", "match", "remainingTokens", "tokens", "trackInjectedSkill", "outputPromptContext", "MIN_PROMPT_LENGTH", "EXCLUSION_WORDS", "isQuestionNotRequest", "prompt", "promptLower", "exclusion", "isInActivePipeline", "active", "getActivePipeline", "pipelineDetector", "input", "outputSilentSuccess", "loadConfig", "logHook", "pipeline", "detectPipeline", "execution", "tasks", "createPipelineExecution", "registerPipelineExecution", "message", "formatPipelinePlan", "outputPromptContext", "AGENT_DOMAINS", "getAgentDomain", "agentType", "graphMemoryInject", "input", "logHook", "toolInput", "prompt", "knownAgents", "agent", "outputSilentSuccess", "agentId", "domainKeywords", "memoryLoadMsg", "systemMsg", "MAX_MEMORIES", "MEM0_SCOPE_AGENTS", "MEM0_SCOPE_DECISIONS", "AGENT_DOMAINS", "RELATED_AGENTS", "getAgentDomain", "agentType", "getRelatedAgents", "getProjectId", "getProjectDir", "mem0UserId", "scope", "mem0GlobalUserId", "mem0MemoryInject", "input", "logHook", "outputSilentSuccess", "toolInput", "prompt", "knownAgents", "agent", "agentId", "projectId", "agentUserId", "decisionsUserId", "globalUserId", "domainKeywords", "searchQuery", "relatedAgents", "mem0AgentQuery", "mem0DecisionsQuery", "mem0GlobalQuery", "memoryLoadMsg", "relatedAgentsStr", "agentFilters", "a", "crossAgentQuery", "relatedStr", "systemMsg", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "MAX_CONCURRENT_BACKGROUND", "MAX_AGENTS_PER_RESPONSE", "WARNING_THRESHOLD", "EXPENSIVE_TYPES", "getStateFile", "getProjectDir", "getSpawnLog", "initState", "stateFile", "dir", "mkdirSync", "existsSync", "initialState", "writeFileSync", "countActiveBackground", "spawnLog", "recentLines", "readFileSync", "fiveMinutesAgo", "count", "line", "entry", "countCurrentResponseAgents", "twoSecondsAgo", "incrementBlockedCount", "state", "incrementSessionTotal", "contextGate", "input", "toolInput", "subagentType", "description", "runInBackground", "logHook", "activeCount", "responseCount", "outputDeny", "outputWarning", "outputSilentSuccess", "existsSync", "readFileSync", "readdirSync", "getSessionState", "getProjectDir", "getDecisionsFile", "getIssueDir", "extractPendingTasks", "sessionState", "existsSync", "tasksPending", "readFileSync", "count", "summary", "t", "extractRelevantDecisions", "taskDescription", "category", "decisionsFile", "d", "findIssueDoc", "issueNum", "issueDir", "match", "readdirSync", "entry", "subagentContextStager", "input", "toolInput", "subagentType", "logHook", "stagedContext", "pendingCount", "taskSummary", "taskLower", "backendDecisions", "frontendDecisions", "issueMatch", "issueDoc", "systemMessage", "lineCount", "outputSilentSuccess", "existsSync", "readFileSync", "mkdirSync", "appendFileSync", "readdirSync", "BUILTIN_TYPES", "getTrackingLog", "getProjectDir", "getPluginJson", "getAgentsDir", "getClaudeAgentsDir", "getSkillsDir", "getValidAgentTypes", "validTypes", "pluginJson", "existsSync", "agents", "readFileSync", "agent", "agentsDirs", "agentsDir", "files", "readdirSync", "file", "extractAgentSkills", "agentType", "skills", "agentFiles", "agentFile", "lines", "inFrontmatter", "inSkills", "line", "match", "skillName", "validateAgentSkills", "missingSkills", "skillsDir", "skill", "skillPath", "extractAgentTools", "tools", "inTools", "getPermissionProfile", "readOnly", "t", "hasBash", "hasWrite", "riskLevel", "logSpawn", "subagentType", "description", "sessionId", "trackingLog", "dir", "mkdirSync", "entry", "appendFileSync", "subagentValidator", "input", "toolInput", "getSessionId", "logHook", "agentTypeOnly", "missingList", "agentTools", "permissionProfile", "outputWithContext", "outputSilentSuccess", "taskLinker", "input", "agentType", "logHook", "outputSilentSuccess", "task", "getTaskByAgent", "updateTaskStatus", "updateAgentStatus", "updateInstruction", "formatTaskUpdateForClaude", "contextMessage", "outputWithContext", "existsSync", "mkdirSync", "appendFileSync", "unlinkSync", "DECISION_PATTERNS", "MEM0_SCOPE_DECISIONS", "getPatternsLog", "getProjectDir", "getAgentTrackingDir", "getProjectId", "mem0UserId", "scope", "detectPatternCategory", "text", "textLower", "extractPatterns", "output", "patterns", "pattern", "DECISION_PATTERNS", "regex", "matches", "match", "cleaned", "agentMemoryStore", "input", "logHook", "toolInput", "agentType", "rawResult", "agentOutput", "success", "outputSilentSuccess", "agentId", "trackingFile", "existsSync", "unlinkSync", "extractedPatterns", "patternsLog", "logDir", "mkdirSync", "projectId", "timestamp", "decisionsUserId", "MEM0_SCOPE_DECISIONS", "category", "entry", "appendFileSync", "existsSync", "writeFileSync", "mkdirSync", "appendFileSync", "readFileSync", "SENSITIVE_PATTERNS", "getSpawnLog", "logDir", "getProjectDir", "mkdirSync", "getSpawnQueue", "logSpawn", "message", "logFile", "timestamp", "appendFileSync", "containsSensitiveFiles", "output", "lowerOutput", "pattern", "queueSpawn", "agentType", "targetAgent", "triggerReason", "priority", "sessionId", "spawnId", "spawnQueue", "queueDir", "queue", "existsSync", "readFileSync", "request", "writeFileSync", "writeSpawnSuggestion", "handoffDir", "suggestionFile", "suggestion", "checkAutoSpawnConditions", "agentOutput", "error", "autoSpawnQuality", "input", "getSessionId", "outputSilentSuccess", "spawnInfo", "existsSync", "writeFileSync", "mkdirSync", "readFileSync", "getDecisionsFile", "getProjectDir", "getSessionState", "getLogDir", "ensureDir", "dirPath", "mkdirSync", "readJsonFile", "filePath", "defaultValue", "existsSync", "readFileSync", "writeJsonFile", "data", "dir", "writeFileSync", "contextPublisher", "input", "agentName", "timestamp", "output", "summary", "agentKey", "decisionsFile", "decisionsDir", "decisions", "decisionEntry", "sessionStateFile", "sessionDir", "sessionState", "taskEntry", "logDir", "dateStr", "logFile", "logContent", "outputSilentSuccess", "existsSync", "writeFileSync", "mkdirSync", "readFileSync", "appendFileSync", "getDecisionLog", "getProjectDir", "getFeedbackLog", "logDir", "mkdirSync", "logFeedback", "message", "logFile", "timestamp", "appendFileSync", "getDownstreamAgents", "agent", "activePipeline", "getActivePipeline", "pipelineDef", "PIPELINES", "p", "currentStepIdx", "s", "nextAgents", "idx", "getFeedbackCategory", "getInstanceId", "extractFindingsSummary", "output", "summary", "writeDecision", "decisionId", "agentType", "category", "downstreamAgents", "status", "taskId", "decisionLog", "log", "existsSync", "readFileSync", "decisionEntry", "writeFileSync", "createHandoffContext", "sessionId", "handoffDir", "agents", "dateStr", "downstream", "handoffFile", "handoff", "feedbackLoop", "input", "getSessionId", "agentOutput", "error", "outputSilentSuccess", "randomNum", "getTaskByAgent", "updateTaskStatus", "writeFileSync", "mkdirSync", "VALID_AGENTS", "NEXT_AGENT_MAP", "SUGGESTIONS_MAP", "getNextAgent", "agentName", "getSuggestions", "writeHandoffFile", "nextAgent", "timestamp", "summary", "suggestions", "handoffDir", "getProjectDir", "mkdirSync", "dateStr", "handoffFile", "handoff", "writeFileSync", "writeLogFile", "logDir", "logFile", "logContent", "handoffPreparer", "input", "outputSilentSuccess", "agentOutput", "outputLength", "writeFileSync", "mkdirSync", "appendFileSync", "SENSITIVE_PATTERNS", "getLogDir", "logDir", "getProjectDir", "mkdirSync", "logAction", "agentName", "action", "details", "date", "logFile", "timestamp", "appendFileSync", "containsSensitiveFiles", "output", "pattern", "multiClaudeVerifier", "input", "projectDir", "agentOutput", "verificationActions", "v", "queueDir", "dateStr", "queueFile", "verificationsQueue", "writeFileSync", "recommendationMsg", "outputSilentSuccess", "writeFileSync", "mkdirSync", "getLogDir", "logDir", "getProjectDir", "mkdirSync", "outputValidator", "input", "agentName", "timestamp", "output", "validationErrors", "validationWarnings", "outputLength", "jsonMatch", "validationStatus", "systemMessage", "dateStr", "logFile", "logContent", "writeFileSync", "existsSync", "writeFileSync", "readFileSync", "METRICS_FILE", "incrementErrorCount", "existsSync", "metrics", "readFileSync", "writeFileSync", "subagentQualityGate", "input", "agentId", "subagentType", "error", "logHook", "outputWarning", "outputSilentSuccess", "isSuccessfulCompletion", "input", "error", "exitCode", "output", "errorPatterns", "outputSample", "pattern", "logHook", "taskCompleter", "agentType", "outputSilentSuccess", "task", "getTaskByAgent", "removeAgent", "success", "newStatus", "updateTaskStatus", "updateAgentStatus", "contextMessage", "formatTaskUpdateForClaude", "nextStep", "completePipelineStep", "nextTasks", "getPipelineTasks", "t", "orphanedTasks", "getTasksBlockedBy", "orphan", "formatTaskDeleteForClaude", "outputWithContext", "executionHistory", "addToHistory", "agent", "attempt", "history", "getTriedAgents", "tried", "attempts", "a", "detectOutcome", "input", "error", "exitCode", "output", "rejectionPatterns", "pattern", "partialPatterns", "retryHandler", "agentType", "outputSilentSuccess", "outcome", "logHook", "config", "loadConfig", "dispatchedAgent", "loadState", "currentRetryCount", "createAttempt", "completedAttempt", "completeAttempt", "triedAgents", "decision", "makeRetryDecision", "updateAgentStatus", "task", "getTaskByAgent", "updateTaskStatus", "message", "formatRetryDecision", "outputWithContext", "execSync", "basename", "SOUNDS", "escapeForAppleScript", "str", "hasCommand", "command", "execSync", "extractIssueFromBranch", "branch", "match", "getRepoName", "projectDir", "getProjectDir", "basename", "buildSubtitle", "notificationType", "issue", "typeLabel", "truncateMessage", "message", "maxLen", "sendMacNotification", "title", "subtitle", "sound", "t", "s", "m", "sendLinuxNotification", "fullMessage", "desktopNotification", "input", "toolInput", "logHook", "outputSilentSuccess", "repoName", "getCachedBranch", "execSync", "SOUND_MAP", "hasAfplay", "execSync", "playSound", "soundFile", "soundNotification", "input", "notificationType", "logHook", "outputSilentSuccess", "autoRememberContinuity", "input", "logHook", "projectId", "getProjectDir", "mem0Hint", "promptMsg", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "autoSaveContext", "input", "logHook", "sessionDir", "getProjectDir", "sessionState", "existsSync", "mkdirSync", "timestamp", "content", "readFileSync", "state", "updated", "writeFileSync", "error", "outputSilentSuccess", "existsSync", "readFileSync", "execSync", "getInstanceId", "projectDir", "idFile", "existsSync", "readFileSync", "runSqlite", "dbPath", "sql", "execSync", "cleanupInstance", "input", "getProjectDir", "logHook", "outputSilentSuccess", "instanceId", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "MAX_ACTIVE_DECISIONS", "archiveSession", "contextDir", "sessionFile", "existsSync", "logHook", "content", "readFileSync", "session", "sessionId", "archiveDir", "mkdirSync", "archiveFile", "archived", "writeFileSync", "error", "compressOldDecisions", "decisionsFile", "data", "decisions", "now", "toArchive", "writeCompactionManifest", "manifest", "manifestDir", "contextCompressor", "input", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "shouldRunTests", "projectDir", "lastRunFile", "existsSync", "result", "execSync", "logHook", "runTests", "logFile", "exitCode", "readFileSync", "cmd", "fullTestSuite", "input", "getProjectDir", "logDir", "mkdirSync", "outputSilentSuccess", "writeFileSync", "existsSync", "readFileSync", "unlinkSync", "rmdirSync", "execSync", "isGhAvailable", "execSync", "isGitHubRepo", "projectDir", "generateComment", "issueNum", "data", "sessionId", "commits", "commitsSection", "c", "tasksSection", "t", "postComment", "comment", "issueWorkSummary", "input", "logHook", "getProjectDir", "getSessionId", "sessionDir", "progressFile", "existsSync", "outputSilentSuccess", "progressJson", "readFileSync", "issues", "postedCount", "issueData", "unlinkSync", "rmdirSync", "existsSync", "readFileSync", "mkdirSync", "appendFileSync", "writeFileSync", "spawn", "countPendingDecisions", "decisionLog", "syncState", "existsSync", "decisionList", "readFileSync", "syncedIds", "d", "countPendingPatterns", "patternsLog", "content", "patterns", "line", "pending", "p", "getProjectId", "projectDir", "extractSessionInfo", "currentTask", "blockers", "nextSteps", "sessionState", "state", "blockersLog", "b", "mem0PreCompactionSync", "input", "logHook", "outputSilentSuccess", "getProjectDir", "pluginRoot", "getPluginRoot", "decisionCount", "patternCount", "pendingPatterns", "projectId", "logFile", "mkdirSync", "msgParts", "agentSet", "uniqueAgents", "summary", "summaryText", "sessionText", "scriptPath", "mem0ApiKey", "skillMsg", "timestamp", "appendFileSync", "sessionMetadata", "child", "spawn", "err", "errTimestamp", "code", "closeTimestamp", "stderrData", "chunk", "updated", "obj", "writeFileSync", "existsSync", "readFileSync", "unlinkSync", "execSync", "runSqlite", "dbPath", "sql", "execSync", "hasTable", "tableName", "stopHeartbeat", "instanceDir", "pidFile", "existsSync", "pid", "readFileSync", "logHook", "unlinkSync", "releaseLocks", "instanceId", "handleWorkClaims", "updateInstanceStatus", "broadcastShutdown", "messageId", "timestamp", "payload", "cleanupInstanceFiles", "filesToRemove", "file", "filePath", "multiInstanceCleanup", "input", "projectDir", "getProjectDir", "outputSilentSuccess", "idFile", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "readdirSync", "execSync", "runNpmAudit", "projectDir", "resultsDir", "existsSync", "logHook", "execSync", "error", "writeFileSync", "result", "runPipAudit", "parsed", "runSemgrep", "highSeverity", "runBandit", "runSecretScan", "secretPatterns", "secretsFound", "findings", "extensions", "scanDir", "dir", "entries", "readdirSync", "entry", "fullPath", "ext", "content", "readFileSync", "aggregateResults", "results", "totalCritical", "totalHigh", "scansCompleted", "f", "report", "securityScanAggregator", "input", "getProjectDir", "mkdirSync", "outputSilentSuccess", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "extractToolSequence", "metricsFile", "existsSync", "tools", "readFileSync", "a", "b", "tool", "getToolCount", "sum", "count", "detectWorkflowType", "detectDominantLanguage", "initWorkflowProfile", "profilePath", "updateWorkflowProfile", "workflowType", "dominantLang", "toolCount", "toolSequence", "profile", "timestamp", "seqSet", "mkdirSync", "writeFileSync", "initPatternsFile", "patternsPath", "mergePatterns", "projectDir", "queuePath", "logHook", "queue", "queueCount", "existing", "now", "allPatterns", "patternMap", "p", "mergedPatterns", "successes", "failures", "categories", "updated", "sessionPatterns", "input", "getProjectDir", "workflowProfile", "outputSilentSuccess", "existsSync", "readFileSync", "taskCompletionCheck", "input", "logHook", "warnings", "projectDir", "getProjectDir", "sessionId", "getSessionId", "registryFile", "existsSync", "inProgress", "readFileSync", "t", "error", "orphans", "getOrphanedTasks", "orphanInstructions", "orphan", "formatTaskDeleteForClaude", "todosFile", "context", "w", "outputWithContext", "outputSilentSuccess", "MAX_RECORD_AGE_MS", "cleanupOldRecords", "data", "cutoff", "before", "r", "after", "logHook", "generateSummary", "stats", "topAgents", "a", "calibrationPersist", "_input", "loadConfig", "clearSessionState", "cleanupOldStates", "outputSilentSuccess", "loadCalibrationData", "applyDecay", "saveCalibrationData", "summary", "err", "cleanupOldTasks", "existsSync", "mkdirSync", "writeFileSync", "readdirSync", "chmodSync", "execSync", "CURRENT_VERSION", "detectEnvironment", "logHook", "envInfo", "match", "execSync", "validateDependencies", "missing", "warnings", "dep", "warn", "getPresetConfig", "preset", "configs", "applyConfiguration", "pluginRoot", "config", "dirs", "dir", "mkdirSync", "configFile", "existsSync", "writeFileSync", "hooksDir", "makeExecutable", "entries", "readdirSync", "entry", "fullPath", "chmodSync", "createMarker", "now", "hookCount", "skillCount", "agentCount", "countFiles", "pattern", "count", "walk", "d", "marker", "markerFile", "firstRunSetup", "input", "getPluginRoot", "mode", "valid", "ctx", "outputWithContext", "existsSync", "mkdirSync", "writeFileSync", "execSync", "isMem0Available", "mem0AnalyticsDashboard", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "pluginRoot", "getPluginRoot", "analyticsFile", "dashboardFile", "summaryScript", "summaryOutput", "existsSync", "execSync", "summary", "dashboardData", "mkdirSync", "writeFileSync", "error", "mkdirSync", "writeFileSync", "isMem0Available", "mem0BackupSetup", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "backupConfig", "backupSchedule", "backupRetention", "mkdirSync", "config", "writeFileSync", "error", "existsSync", "mkdirSync", "appendFileSync", "execSync", "isMem0Available", "getCutoffDate", "daysAgo", "date", "mem0Cleanup", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "scriptsDir", "getPluginRoot", "batchDeleteScript", "getMemoriesScript", "existsSync", "ageThreshold", "cutoffDate", "logFile", "mkdirSync", "timestamp", "appendFileSync", "memoriesJson", "result", "execSync", "staleIds", "m", "isOld", "isProtected", "idsArray", "error", "existsSync", "readFileSync", "readdirSync", "writeFileSync", "spawn", "CURRENT_VERSION", "getMarkerField", "markerFile", "field", "existsSync", "content", "readFileSync", "parts", "value", "part", "quickValidate", "pluginRoot", "errors", "configFile", "logHook", "hookCount", "countShFiles", "dir", "depth", "count", "entries", "readdirSync", "entry", "fullPath", "markerVersion", "isMaintenanceDue", "lastMaintenance", "lastEpoch", "updateMarker", "writeFileSync", "setupCheck", "input", "outputSilentSuccess", "getPluginRoot", "setupDir", "args", "outputWithContext", "maintenanceScript", "spawn", "repairScript", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "renameSync", "readdirSync", "unlinkSync", "statSync", "chmodSync", "execSync", "CURRENT_VERSION", "tasksCompleted", "getMarkerField", "markerFile", "field", "existsSync", "readFileSync", "updateMarkerField", "value", "content", "writeFileSync", "hoursSince", "timestamp", "lastEpoch", "taskLogRotation", "pluginRoot", "logHook", "logDirs", "rotated", "logDir", "files", "readdirSync", "file", "filePath", "statSync", "rotatedName", "renameSync", "execSync", "rotatedLogs", "f", "oldLog", "unlinkSync", "taskStaleLockCleanup", "coordDb", "cleaned", "lockCount", "walkAndClean", "dir", "depth", "entries", "entry", "fullPath", "stats", "taskSessionCleanup", "sessionDir", "archiveDir", "archived", "mkdirSync", "taskMemoryFabricCleanup", "projectDir", "logsDir", "globalSync", "taskHealthValidation", "issues", "nonExec", "checkExecutable", "chmodSync", "configFile", "taskVersionMigration", "markerVersion", "setupMaintenance", "input", "getPluginRoot", "getProjectDir", "args", "mode", "now", "lastMaintenance", "hours", "runDaily", "runWeekly", "summary", "outputSilentSuccess", "outputWithContext", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "renameSync", "readdirSync", "statSync", "chmodSync", "CURRENT_VERSION", "repairsMade", "repairsFailed", "notifyUser", "repairConfig", "pluginRoot", "configFile", "configDir", "mkdirSync", "existsSync", "readFileSync", "backup", "renameSync", "logHook", "writeFileSync", "repairHookPermissions", "fixed", "fixPermissions", "dir", "depth", "entries", "readdirSync", "entry", "fullPath", "statSync", "chmodSync", "repairDirectories", "dirsCreated", "requiredDirs", "repairMarker", "now", "hookCount", "skillCount", "agentCount", "countFiles", "pattern", "maxDepth", "count", "walk", "d", "marker", "markerFile", "checkCriticalComponents", "criticalMissing", "setupRepair", "input", "getPluginRoot", "repairSummary", "outputWithContext", "outputSilentSuccess", "blockWrites", "input", "toolName", "agentId", "outputDeny", "outputSilentSuccess", "DANGEROUS_PATTERNS", "ciSafetyCheck", "input", "command", "pattern", "outputDeny", "outputWithContext", "outputSilentSuccess", "PRODUCTION_PATTERNS", "deploymentSafetyCheck", "input", "command", "pattern", "outputDeny", "outputWithContext", "outputSilentSuccess", "DANGEROUS_PATTERNS", "migrationSafetyCheck", "input", "outputSilentSuccess", "command", "pattern", "outputDeny", "mkdirSync", "appendFileSync", "securityCommandAudit", "input", "agentId", "toolName", "sessionId", "getSessionId", "projectDir", "getProjectDir", "logFile", "outputSilentSuccess", "command", "timestamp", "mkdirSync", "appendFileSync", "appendFileSync", "existsSync", "mkdirSync", "statSync", "renameSync", "readCountFile", "auditLogger", "input", "toolName", "readFileSync", "writeFileSync", "readCount", "outputSilentSuccess", "projectDir", "auditLog", "logDir", "existsSync", "mkdirSync", "rotateLogFile", "timestamp", "details", "getField", "logEntry", "appendFileSync", "logFile", "maxBytes", "statSync", "rotated", "renameSync", "existsSync", "appendFileSync", "readFileSync", "writeFileSync", "mkdirSync", "statSync", "renameSync", "createHash", "ERROR_PATTERN", "TRIVIAL_COMMANDS", "MAX_CONTEXT_CHARS", "DEDUP_PROMPT_THRESHOLD", "MAX_SKILLS", "MAX_LOG_BYTES", "detectError", "input", "toolOutput", "getField", "toolError", "exitCode", "isError", "errorType", "errorMessage", "errorLines", "line", "rotateLogFile", "logFile", "existsSync", "statSync", "renameSync", "logError", "errorInfo", "projectDir", "getProjectDir", "errorLog", "metricsFile", "mkdirSync", "inputHash", "createHash", "errorRecord", "getSessionId", "appendFileSync", "metrics", "readFileSync", "writeFileSync", "logHook", "matchErrorPattern", "errorText", "solutionsFile", "content", "errorLower", "pattern", "shouldSuggest", "patternId", "errorContext", "dedupFile", "dedup", "suggestionHash", "currentCount", "lastSuggestedAt", "getSkillDescription", "skillName", "skillsDir", "skillFile", "frontmatterMatch", "descMatch", "buildSuggestionMessage", "brief", "steps", "msg", "step", "i", "patternSkills", "categorySkills", "allSkills", "skill", "desc", "unifiedErrorHandler", "toolName", "command", "outputSilentSuccess", "pluginRoot", "getPluginRoot", "matchedPattern", "suggestionMessage", "existsSync", "execSync", "getLanguage", "filePath", "commandExists", "cmd", "execSync", "autoLint", "input", "toolName", "outputSilentSuccess", "getField", "projectDir", "fullPath", "existsSync", "language", "lintIssues", "fixesApplied", "ruffCheck", "biomeOut", "error", "logHook", "basename", "existsSync", "readFileSync", "writeFileSync", "statSync", "mkdirSync", "BUDGET_TOTAL", "COMPRESS_TRIGGER", "COMPRESS_TARGET", "MCP_DEFER_TRIGGER", "estimateTokens", "filePath", "existsSync", "stats", "statSync", "calculateUsage", "contextDir", "getProjectDir", "alwaysLoadedFiles", "total", "file", "getEffectiveContextWindow", "baseWindow", "shouldDeferMcp", "currentTokens", "effectiveWindow", "updateMcpDeferState", "shouldDefer", "stateFile", "getSessionId", "state", "writeFileSync", "logHook", "compressSession", "sessionFile", "content", "readFileSync", "compressed", "archiveOldDecisions", "projectDir", "decisionsFile", "decisions", "archiveDir", "mkdirSync", "date", "archiveFile", "contextBudgetMonitor", "_input", "usageRatio", "usagePercent", "deferMcp", "newTokens", "newRatio", "newPercent", "error", "outputSilentSuccess", "existsSync", "readFileSync", "execSync", "coordinationHeartbeat", "_input", "projectDir", "getProjectDir", "coordLib", "existsSync", "outputSilentSuccess", "instanceEnv", "instanceId", "match", "readFileSync", "execSync", "error", "logHook", "mem0WebhookHandler", "input", "logHook", "toolName", "command", "getField", "outputSilentSuccess", "eventDataStr", "eventData", "eventType", "memoryId", "error", "existsSync", "ENTITY_PATTERNS", "extractEntitiesFromText", "text", "textLower", "entities", "entityType", "pattern", "matches", "match", "entityName", "word", "observation", "extractRelationsFromText", "relations", "entityNames", "e", "entity1", "entity1Lower", "entity2", "entity2Lower", "memoryBridge", "input", "logHook", "memoryText", "getField", "outputSilentSuccess", "memoryAgent", "getPluginRoot", "existsSync", "entityCount", "relationCount", "entityList", "msg", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "IMMEDIATE_KEYWORDS", "BATCHED_KEYWORDS", "MIN_CONTENT_LENGTH", "CONTEXT_EMERGENCY_THRESHOLD", "CONTEXT_CRITICAL_THRESHOLD", "getContextPressure", "pressure", "tokensUsed", "maxTokens", "classifyPriority", "content", "extractDecision", "patterns", "pattern", "match", "sentences", "detectCategory", "contentLower", "initPendingQueue", "pendingFile", "existsSync", "mkdirSync", "writeFileSync", "addToPendingQueue", "category", "data", "readFileSync", "logHook", "getPendingCount", "realtimeSync", "input", "toolName", "outputSilentSuccess", "toolOutput", "getField", "command", "filePath", "priority", "contextPressure", "projectDir", "getProjectDir", "sessionId", "getSessionId", "pendingCount", "decision", "existsSync", "readFileSync", "writeFileSync", "METRICS_FILE", "LOCKFILE", "sessionMetrics", "input", "toolName", "outputSilentSuccess", "metrics", "existsSync", "content", "readFileSync", "currentCount", "writeFileSync", "error", "logHook", "existsSync", "readFileSync", "appendFileSync", "mkdirSync", "PATTERN_DEFINITIONS", "getRecentSkill", "sessionStateFile", "existsSync", "content", "readFileSync", "cutoff", "s", "a", "b", "detectPatterns", "diffContent", "detected", "name", "regex", "logEditPattern", "skillId", "filePath", "patterns", "editPatternsFile", "sessionId", "getSessionId", "entry", "mkdirSync", "appendFileSync", "skillEditTracker", "input", "toolName", "outputSilentSuccess", "getField", "projectDir", "getProjectDir", "editContent", "oldString", "newString", "oldLines", "newLines", "l", "logHook", "extractTaskId", "input", "toolInput", "isTaskStatusUpdate", "statusToOutcome", "status", "calibrationTracker", "outputSilentSuccess", "loadConfig", "taskId", "outcome", "logHook", "task", "getTaskById", "agent", "agentMatch", "getLastClassification", "a", "matchedKeywords", "confidence", "durationMs", "recordOutcome", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "CODE_EXTENSIONS", "getLanguage", "filePath", "detectIndentation", "content", "tabCount", "space2Count", "space4Count", "line", "detectQuoteStyle", "singleCount", "doubleCount", "detectSemicolonStyle", "withSemi", "withoutSemi", "trimmed", "detectTrailingComma", "detectPythonPatterns", "hasTypeHints", "docstringStyle", "loadProfile", "profilePath", "existsSync", "readFileSync", "updateProfile", "profile", "language", "indentation", "quoteStyle", "semiStyle", "trailingComma", "typeHints", "lang", "codeStyleLearner", "input", "toolName", "outputSilentSuccess", "getField", "ext", "projectDir", "getProjectDir", "fullPath", "pyPatterns", "mkdirSync", "writeFileSync", "error", "logHook", "appendFileSync", "mkdirSync", "execSync", "coveragePredictor", "input", "outputSilentSuccess", "filePath", "getField", "projectDir", "getProjectDir", "testPattern", "basename", "testExists", "execSync", "logDir", "mkdirSync", "timestamp", "appendFileSync", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "CODE_EXTENSIONS", "detectCase", "name", "extractPythonIdentifiers", "content", "functions", "m", "classes", "variables", "constants", "extractJsIdentifiers", "interfaces", "types", "countCases", "identifiers", "counts", "caseType", "detectFileNaming", "filePath", "nameWithoutExt", "getLanguage", "loadProfile", "profilePath", "existsSync", "readFileSync", "initLanguageProfile", "namingConventionLearner", "input", "toolName", "outputSilentSuccess", "getField", "ext", "language", "projectDir", "getProjectDir", "fullPath", "fileNaming", "funcCases", "classCases", "varCases", "constCases", "typeCases", "ids", "mkdirSync", "profile", "lang", "writeFileSync", "error", "logHook", "existsSync", "statSync", "appendFileSync", "mkdirSync", "analyzeFileChange", "filePath", "projectDir", "filename", "dirname", "extLower", "existsSync", "pkg", "__require", "fullPath", "readFileSync", "findReadme", "name", "readmeSync", "input", "outputSilentSuccess", "getField", "getProjectDir", "analysis", "readmePath", "contextMsg", "daysOld", "mtime", "statSync", "now", "suggestion", "logDir", "mkdirSync", "timestamp", "appendFileSync", "logHook", "existsSync", "releaseLockOnCommit", "_input", "coordLib", "getProjectDir", "existsSync", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "extractIssueFromBranch", "branch", "match", "extractIssueFromCommit", "message", "getCurrentBranch", "execSync", "getLatestCommit", "sha", "timestamp", "initProgressFile", "progressFile", "sessionId", "existsSync", "mkdirSync", "writeFileSync", "queueCommitProgress", "issueNum", "commit", "data", "readFileSync", "logHook", "issueProgressCommenter", "input", "outputSilentSuccess", "command", "getField", "exitCode", "commitMsg", "getSessionId", "existsSync", "readFileSync", "writeFileSync", "execSync", "extractTaskFromCommit", "message", "task", "normalizeText", "text", "matchesCheckbox", "commitTask", "checkboxText", "normCommit", "normCheckbox", "commitWords", "w", "checkboxWords", "matchingWords", "word", "extractIssueFromBranch", "branch", "match", "extractIssueFromCommit", "getUncheckedTasks", "issueNum", "lines", "execSync", "unchecked", "line", "updateCheckbox", "logHook", "body", "escapedText", "updatedBody", "repo", "bodyJson", "error", "recordTaskCompletion", "taskText", "progressFile", "existsSync", "data", "readFileSync", "writeFileSync", "issueSubtaskUpdater", "input", "outputSilentSuccess", "command", "getField", "exitCode", "commitMsg", "uncheckedTasks", "matched", "getSessionId", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "TECH_PATTERNS", "CATEGORY_PATTERNS", "BEST_PRACTICE_CATEGORIES", "getProjectId", "getProjectDir", "extractPatternInfo", "text", "textLower", "tech", "pattern", "name", "regex", "detectBestPracticeCategory", "category", "queuePattern", "outcome", "source", "patternsQueue", "timestamp", "projectId", "existsSync", "mkdirSync", "writeFileSync", "data", "readFileSync", "logHook", "handleGitCommit", "command", "exitCode", "commitMsg", "msgMatch", "patternText", "handlePrMerge", "prInfo", "prMatch", "handleTestResult", "testFramework", "handleBuildResult", "buildTool", "patternExtractor", "input", "outputSilentSuccess", "getField", "commandLower", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "SKILL_OVERLAPS", "initUsageFile", "usageFile", "existsSync", "mkdirSync", "writeFileSync", "loadUsageData", "readFileSync", "updateUsage", "skill", "sessionId", "data", "timestamp", "logHook", "getSessionSkills", "checkOverlaps", "currentSkill", "sessionSkills", "overlapKey", "suggestion", "skill1", "skill2", "otherSkill", "getUsageStats", "entries", "a", "b", "count", "skillUsageOptimizer", "input", "toolName", "skillName", "getField", "outputSilentSuccess", "getProjectDir", "getSessionId", "overlapSuggestion", "usageStats", "contextMsg", "currentSkillCount", "existsSync", "readFileSync", "execSync", "isMultiInstanceEnabled", "execSync", "dbPath", "getProjectDir", "existsSync", "releaseFileLock", "filePath", "instanceId", "escapedPath", "escapedInstance", "logHook", "error", "getInstanceId", "instanceEnv", "match", "readFileSync", "getSessionId", "fileLockRelease", "input", "toolName", "outputSilentSuccess", "getField", "toolResult", "existsSync", "readFileSync", "getConsentStatus", "projectDir", "consentFile", "existsSync", "status", "readFileSync", "getLastConsentEvent", "consentLog", "log", "shouldShowReminder", "lastTimestamp", "lastDate", "analyticsConsentCheck", "input", "getProjectDir", "logHook", "outputSilentSuccess", "lastEvent", "existsSync", "readFileSync", "writeFileSync", "unlinkSync", "loadInstanceId", "projectDir", "envFile", "existsSync", "match", "readFileSync", "updateHeartbeatStatus", "instanceId", "heartbeatFile", "content", "writeFileSync", "logHook", "err", "unregisterInstance", "dbPath", "cleanupInstanceEnv", "unlinkSync", "coordinationCleanup", "input", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "appendFileSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "getTaskDescription", "projectDir", "stateFile", "existsSync", "readFileSync", "getAgentRole", "generateInstanceId", "sessionId", "getSessionId", "timestamp", "random", "saveInstanceId", "instanceId", "envFile", "mkdirSync", "appendFileSync", "logHook", "err", "initHeartbeat", "taskDesc", "agentRole", "heartbeatsDir", "heartbeat", "writeFileSync", "coordinationInit", "input", "outputSilentSuccess", "getProjectDir", "existsSync", "readFileSync", "writeFileSync", "readdirSync", "unlinkSync", "mkdirSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "getInstanceId", "getSessionId", "loadInstanceIdFromFile", "projectDir", "envFile", "existsSync", "match", "readFileSync", "updateHeartbeat", "instanceId", "heartbeatsDir", "heartbeatFile", "mkdirSync", "heartbeat", "writeFileSync", "logHook", "content", "err", "cleanupStaleInstances", "currentInstanceId", "staleThresholdMs", "now", "cleanedCount", "files", "readdirSync", "f", "file", "filePath", "lastHeartbeat", "unlinkSync", "instanceHeartbeat", "input", "outputSilentSuccess", "getProjectDir", "mkdirSync", "appendFileSync", "isMem0Available", "mem0AnalyticsTracker", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "analyticsFile", "sessionId", "getSessionId", "timestamp", "analyticsEntry", "mkdirSync", "appendFileSync", "err", "existsSync", "readFileSync", "mkdirSync", "renameSync", "getProjectId", "projectDir", "parts", "isMem0Available", "hasValidPendingSync", "filePath", "existsSync", "content", "readFileSync", "parsed", "archivePendingSync", "processedDir", "timestamp", "mkdirSync", "archiveName", "archivePath", "renameSync", "logHook", "err", "mem0ContextRetrieval", "input", "logHook", "projectDir", "getProjectDir", "projectId", "getProjectId", "pendingSyncFile", "pendingSyncGlobal", "pendingFile", "hasValidPendingSync", "content", "readFileSync", "archivePendingSync", "isMem0Available", "outputSilentSuccess", "writeFileSync", "mkdirSync", "isMem0Available", "shouldSkipSlowHooks", "mem0WebhookSetup", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "webhookConfigFile", "webhookName", "webhookEvents", "webhookUrl", "mkdirSync", "writeFileSync", "err", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "isSqlite3Available", "execSync", "generateInstanceId", "projectDir", "worktreeName", "timestamp", "random", "getCurrentBranch", "detectCapabilities", "caps", "existsSync", "createInstanceIdentity", "instanceId", "branch", "capabilities", "now", "identity", "instanceDir", "mkdirSync", "writeFileSync", "logHook", "initDatabase", "coordDir", "dbPath", "schemaPath", "err", "startHeartbeat", "multiInstanceInit", "input", "outputSilentSuccess", "getProjectDir", "idFile", "pidFile", "existingId", "readFileSync", "existsSync", "readFileSync", "writeFileSync", "statSync", "mkdirSync", "MAX_FILE_SIZE_BYTES", "shouldSkipSlowHooks", "isSyncEnabled", "projectDir", "configFile", "existsSync", "readFileSync", "checkFileSize", "filePath", "stats", "statSync", "logHook", "pullGlobalPatterns", "globalPatternsFile", "projectPatternsFile", "globalList", "projectPatterns", "projectList", "existingTexts", "p", "newPatterns", "mergedPatterns", "mkdirSync", "writeFileSync", "err", "patternSyncPull", "input", "outputSilentSuccess", "getProjectDir", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "isSyncEnabled", "projectDir", "configFile", "existsSync", "readFileSync", "pushProjectPatterns", "projectPatternsFile", "home", "globalPatternsFile", "logHook", "projectList", "globalPatterns", "globalList", "existingTexts", "p", "newPatterns", "mergedPatterns", "mkdirSync", "writeFileSync", "err", "patternSyncPush", "input", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "mkdirSync", "readdirSync", "unlinkSync", "copyFileSync", "getTotalTools", "metricsFile", "existsSync", "tools", "readFileSync", "sum", "count", "archiveMetrics", "archiveDir", "totalTools", "logHook", "mkdirSync", "archiveName", "archivePath", "copyFileSync", "err", "cleanupOldArchives", "keepCount", "files", "readdirSync", "f", "toDelete", "file", "unlinkSync", "cleanupRotatedLogs", "logDir", "patterns", "pattern", "prefix", "sessionCleanup", "input", "projectDir", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "isValidJsonFile", "filePath", "existsSync", "readFileSync", "sessionContextLoader", "input", "logHook", "projectDir", "getProjectDir", "contextLoaded", "agentType", "sessionState", "identityFile", "knowledgeIndex", "statusFile", "agentConfig", "compactionManifest", "manifest", "error", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "getCurrentBranch", "projectDir", "execSync", "sessionEnvSetup", "input", "logHook", "getProjectDir", "sessionId", "getSessionId", "metricsFile", "mkdirSync", "agentType", "metrics", "writeFileSync", "err", "sessionState", "existsSync", "state", "readFileSync", "branch", "outputSilentSuccess", "existsSync", "readFileSync", "sessionMetricsSummary", "input", "logHook", "metricsFile", "existsSync", "outputSilentSuccess", "metrics", "readFileSync", "tools", "errors", "totalTools", "sum", "count", "topTools", "b", "tool", "err", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "KNOWN_VULNS", "CACHE_TTL_HOURS", "shouldSkipSlowHooks", "versionLessThan", "current", "target", "currentParts", "p", "targetParts", "i", "c", "t", "versionMatchesVuln", "currentVersion", "vulnPattern", "operator", "vulnVersion", "cleanVersion", "version", "checkPackageVulnerability", "packageName", "cleanedVersion", "pkgLower", "vuln", "getCachedWarnings", "cacheFile", "existsSync", "cache", "readFileSync", "saveCache", "warnings", "mkdirSync", "writeFileSync", "parsePackageJson", "filePath", "criticalCount", "highCount", "pkg", "allDeps", "parseRequirementsTxt", "lines", "line", "trimmed", "match", "dependencyVersionCheck", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "hasPackageJson", "hasRequirementsTxt", "hasPyprojectToml", "hasGoMod", "cached", "outputWithContext", "totalCritical", "totalHigh", "allWarnings", "result", "summary", "fullWarning", "hooks", "autoApproveSafeBash", "autoApproveProjectWrites", "learningTracker", "dangerousCommandBlocker", "gitValidator", "compoundCommandValidator", "defaultTimeoutSetter", "errorPatternWarner", "conflictPredictor", "affectedTestsFinder", "ciSimulation", "preCommitSimulation", "prMergeGate", "changelogGenerator", "versionSync", "licenseCompliance", "ghIssueCreationGuide", "issueDocsRequirement", "multiInstanceQualityGate", "agentBrowserSafety", "fileGuard", "fileLockCheck", "multiInstanceLock", "architectureChangeDetector", "codeQualityGate", "docstringEnforcer", "securityPatternValidator", "context7Tracker", "memoryFabricInit", "memoryValidator", "sequentialThinkingAuto", "writeHeaders", "skillTracker", "antipatternDetector", "antipatternWarning", "contextInjector", "contextPruningAdvisor", "memoryContext", "satisfactionDetector", "skillAutoSuggest", "todoEnforcer", "agentAutoSuggest", "agentOrchestrator", "skillInjector", "pipelineDetector", "graphMemoryInject", "mem0MemoryInject", "contextGate", "subagentContextStager", "subagentValidator", "taskLinker", "agentMemoryStore", "autoSpawnQuality", "contextPublisher", "feedbackLoop", "handoffPreparer", "multiClaudeVerifier", "outputValidator", "subagentQualityGate", "taskCompleter", "retryHandler", "desktopNotification", "soundNotification", "backendFileNaming", "decisionProcessor", "backendLayerValidator", "coverageCheck", "coverageThresholdGate", "crossInstanceTestValidator", "diPatternEnforcer", "duplicateCodeDetector", "evalMetricsCollector", "evidenceCollector", "importDirectionEnforcer", "mergeConflictPredictor", "mergeReadinessChecker", "migrationValidator", "patternConsistencyEnforcer", "redactSecrets", "reviewSummaryGenerator", "securitySummary", "structureLocationValidator", "testLocationValidator", "testPatternValidator", "testRunner", "autoRememberContinuity", "autoSaveContext", "cleanupInstance", "contextCompressor", "fullTestSuite", "issueWorkSummary", "mem0PreCompactionSync", "multiInstanceCleanup", "securityScanAggregator", "sessionPatterns", "taskCompletionCheck", "calibrationPersist", "firstRunSetup", "mem0AnalyticsDashboard", "mem0BackupSetup", "mem0Cleanup", "setupCheck", "setupMaintenance", "setupRepair", "blockWrites", "ciSafetyCheck", "deploymentSafetyCheck", "migrationSafetyCheck", "securityCommandAudit", "auditLogger", "unifiedErrorHandler", "autoLint", "contextBudgetMonitor", "coordinationHeartbeat", "mem0WebhookHandler", "memoryBridge", "realtimeSync", "sessionMetrics", "skillEditTracker", "calibrationTracker", "codeStyleLearner", "coveragePredictor", "namingConventionLearner", "readmeSync", "releaseLockOnCommit", "issueProgressCommenter", "issueSubtaskUpdater", "patternExtractor", "skillUsageOptimizer", "fileLockRelease", "analyticsConsentCheck", "coordinationCleanup", "coordinationInit", "instanceHeartbeat", "mem0AnalyticsTracker", "mem0ContextRetrieval", "mem0WebhookSetup", "multiInstanceInit", "patternSyncPull", "patternSyncPush", "sessionCleanup", "sessionContextLoader", "sessionEnvSetup", "sessionMetricsSummary", "dependencyVersionCheck", "getHook", "name", "listHooks", "runHook", "input", "hook"]
}
