{
  "version": 3,
  "sources": ["../src/types.ts", "../src/lib/common.ts", "../src/notification/desktop.ts", "../src/notification/sound.ts", "../src/notification/unified-dispatcher.ts", "../src/entries/notification.ts"],
  "sourcesContent": ["/**\n * TypeScript type definitions for Claude Code hooks\n * CC 2.1.9 compliant with additionalContext support\n */\n\n/**\n * Hook events supported by Claude Code\n */\nexport type HookEvent =\n  | 'PreToolUse'\n  | 'PostToolUse'\n  | 'PermissionRequest'\n  | 'UserPromptSubmit'\n  | 'SessionStart'\n  | 'SessionEnd'\n  | 'Stop'\n  | 'SubagentStart'\n  | 'SubagentStop'\n  | 'Setup'\n  | 'Notification';\n\n/**\n * Hook input envelope from Claude Code (sent via stdin as JSON)\n */\nexport interface HookInput {\n  /** The hook event type */\n  hook_event?: HookEvent;\n  /** The tool being invoked */\n  tool_name: string;\n  /** Session ID (CC 2.1.9 guarantees availability) */\n  session_id: string;\n  /** Tool-specific input parameters */\n  tool_input: ToolInput;\n  /** Tool output (PostToolUse only) */\n  tool_output?: unknown;\n  /** Tool error message if any */\n  tool_error?: string;\n  /** Tool exit code */\n  exit_code?: number;\n  /** User prompt (UserPromptSubmit only) */\n  prompt?: string;\n  /** Project directory */\n  project_dir?: string;\n\n  // SubagentStart/SubagentStop specific fields\n  /** Agent type for subagent hooks */\n  subagent_type?: string;\n  /** Agent type (alternative field name) */\n  agent_type?: string;\n  /** Agent ID */\n  agent_id?: string;\n  /** Agent output (SubagentStop) */\n  agent_output?: string;\n  /** Output (alternative field name) */\n  output?: string;\n  /** Error from subagent */\n  error?: string;\n  /** Duration in milliseconds */\n  duration_ms?: number;\n  /** Tool result (SubagentStop) */\n  tool_result?: string;\n\n  // Notification specific fields\n  /** Notification message */\n  message?: string;\n  /** Notification type */\n  notification_type?: string;\n}\n\n/**\n * Tool input types - union of all tool inputs\n */\nexport interface ToolInput {\n  /** Bash command (Bash tool) */\n  command?: string;\n  /** Timeout in ms (Bash tool) */\n  timeout?: number;\n  /** File path (Write/Edit/Read tools) */\n  file_path?: string;\n  /** File content (Write tool) */\n  content?: string;\n  /** Old text to replace (Edit tool) */\n  old_string?: string;\n  /** New text (Edit tool) */\n  new_string?: string;\n  /** Pattern (Glob/Grep tools) */\n  pattern?: string;\n  /** Allow additional properties */\n  [key: string]: unknown;\n}\n\n/**\n * Hook-specific output for CC 2.1.9\n */\nexport interface HookSpecificOutput {\n  /** Hook event name for context */\n  hookEventName?: 'PreToolUse' | 'PostToolUse' | 'PermissionRequest' | 'UserPromptSubmit';\n  /** Permission decision (PermissionRequest hooks) */\n  permissionDecision?: 'allow' | 'deny';\n  /** Reason for permission decision */\n  permissionDecisionReason?: string;\n  /** Additional context injected before tool execution (CC 2.1.9) */\n  additionalContext?: string;\n}\n\n/**\n * Hook result - output JSON to stdout\n * CC 2.1.7+ compliant\n */\nexport interface HookResult {\n  /** Whether to continue execution */\n  continue: boolean;\n  /** Suppress hook output from user */\n  suppressOutput?: boolean;\n  /** System message shown to user */\n  systemMessage?: string;\n  /** Reason for stopping (when continue is false) */\n  stopReason?: string;\n  /** Hook-specific output fields */\n  hookSpecificOutput?: HookSpecificOutput;\n}\n\n/**\n * Hook function signature\n */\nexport type HookFn = (input: HookInput) => Promise<HookResult> | HookResult;\n\n/**\n * Hook metadata for auto-discovery and governance\n * Co-export alongside hook functions for single-source-of-truth registration\n */\nexport interface HookMeta {\n  /** Full hook name path (e.g., 'pretool/bash/dangerous-command-blocker') */\n  name: string;\n  /** Human-readable description */\n  description: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher patterns for hooks.json (e.g., 'Bash', 'Write|Edit') */\n  matchers?: string[];\n  /** Run asynchronously (non-blocking) */\n  async?: boolean;\n  /** Only run once per session */\n  once?: boolean;\n  /** Timeout in seconds (async hooks only) */\n  timeout?: number;\n  /** Risk category for prioritization */\n  tier?: 'security-critical' | 'data-loss' | 'quality-gate' | 'standard';\n}\n\n/**\n * Hook overrides configuration for per-project toggle/customization\n * Stored at .claude/hook-overrides.json (gitignored)\n */\nexport interface HookOverrides {\n  /** Hook names to disable entirely */\n  disabled?: string[];\n  /** Per-hook timeout overrides (seconds) */\n  timeouts?: Record<string, number>;\n}\n\n/**\n * Hook registration entry\n */\nexport interface HookRegistration {\n  /** Hook name (e.g., 'permission/auto-approve-readonly') */\n  name: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher (string pattern or regex) */\n  matcher?: string | RegExp;\n  /** Hook implementation function */\n  fn: HookFn;\n}\n\n/**\n * Bash tool input (type guard helper)\n */\nexport interface BashToolInput extends ToolInput {\n  command: string;\n  timeout?: number;\n}\n\n/**\n * Write tool input (type guard helper)\n */\nexport interface WriteToolInput extends ToolInput {\n  file_path: string;\n  content: string;\n}\n\n/**\n * Edit tool input (type guard helper)\n */\nexport interface EditToolInput extends ToolInput {\n  file_path: string;\n  old_string: string;\n  new_string: string;\n}\n\n/**\n * Read tool input (type guard helper)\n */\nexport interface ReadToolInput extends ToolInput {\n  file_path: string;\n  offset?: number;\n  limit?: number;\n}\n\n/**\n * Type guards for tool inputs\n */\nexport function isBashInput(input: ToolInput): input is BashToolInput {\n  return typeof input.command === 'string';\n}\n\nexport function isWriteInput(input: ToolInput): input is WriteToolInput {\n  return typeof input.file_path === 'string' && typeof input.content === 'string';\n}\n\nexport function isEditInput(input: ToolInput): input is EditToolInput {\n  return (\n    typeof input.file_path === 'string' &&\n    typeof input.old_string === 'string' &&\n    typeof input.new_string === 'string'\n  );\n}\n\nexport function isReadInput(input: ToolInput): input is ReadToolInput {\n  return typeof input.file_path === 'string' && input.content === undefined;\n}\n", "/**\n * Common utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh\n */\n\nimport { appendFileSync, existsSync, statSync, renameSync, mkdirSync, readSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookResult, HookInput } from '../types.js';\n\n// -----------------------------------------------------------------------------\n// Environment and Paths\n// All functions read env vars dynamically to support testing\n// -----------------------------------------------------------------------------\n\n/**\n * Get the log directory path\n */\nexport function getLogDir(): string {\n  if (process.env.CLAUDE_PLUGIN_ROOT) {\n    return `${process.env.HOME}/.claude/logs/ork`;\n  }\n  return `${getProjectDir()}/.claude/logs`;\n}\n\n/**\n * Get the project directory\n * Read dynamically to support testing\n */\nexport function getProjectDir(): string {\n  return process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the plugin root directory\n * Read dynamically to support testing\n */\nexport function getPluginRoot(): string {\n  return process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the session ID\n * CC 2.1.9+ should guarantee CLAUDE_SESSION_ID availability, but we add\n * a defensive fallback to prevent hook crashes during edge cases.\n * Read dynamically to support testing.\n */\nexport function getSessionId(): string {\n  return process.env.CLAUDE_SESSION_ID || `fallback-${process.pid}-${Date.now()}`;\n}\n\n/**\n * Get cached git branch (set at session start or first call)\n * Caches result in process.env to avoid repeated execSync calls\n */\nexport function getCachedBranch(projectDir?: string): string {\n  if (process.env.ORCHESTKIT_BRANCH) {\n    return process.env.ORCHESTKIT_BRANCH;\n  }\n\n  try {\n    const branch = execSync('git branch --show-current', {\n      cwd: projectDir || getProjectDir(),\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n    process.env.ORCHESTKIT_BRANCH = branch;\n    return branch;\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Get log level (debug|info|warn|error, default: warn)\n */\nexport function getLogLevel(): string {\n  return process.env.ORCHESTKIT_LOG_LEVEL || 'warn';\n}\n\n/**\n * Check if should log at given level\n */\nexport function shouldLog(level: 'debug' | 'info' | 'warn' | 'error'): boolean {\n  const levels = ['debug', 'info', 'warn', 'error'];\n  return levels.indexOf(level) >= levels.indexOf(getLogLevel());\n}\n\n// -----------------------------------------------------------------------------\n// Output Helpers (CC 2.1.7+ compliant)\n// -----------------------------------------------------------------------------\n\n/**\n * Output silent success - hook completed without errors, no user-visible output\n */\nexport function outputSilentSuccess(): HookResult {\n  return { continue: true, suppressOutput: true };\n}\n\n/**\n * Output silent allow - permission hook approves silently\n */\nexport function outputSilentAllow(): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: { permissionDecision: 'allow' },\n  };\n}\n\n/**\n * Output block - stops the operation with an error\n */\nexport function outputBlock(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with additionalContext - injects context before tool execution (CC 2.1.9)\n * For PostToolUse hooks (hookEventName optional)\n */\nexport function outputWithContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PostToolUse',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with additionalContext for UserPromptSubmit hooks (CC 2.1.9)\n * hookEventName is REQUIRED for UserPromptSubmit\n */\nexport function outputPromptContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output allow with additionalContext - permission hook approves with context (CC 2.1.9)\n */\nexport function outputAllowWithContext(ctx: string, systemMessage?: string): HookResult {\n  const result: HookResult = {\n    continue: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      additionalContext: ctx,\n      permissionDecision: 'allow',\n    },\n  };\n\n  if (systemMessage) {\n    result.systemMessage = systemMessage;\n  } else {\n    result.suppressOutput = true;\n  }\n\n  return result;\n}\n\n/**\n * Output error message - only use when there's an actual problem\n */\nexport function outputError(message: string): HookResult {\n  return { continue: true, systemMessage: message };\n}\n\n/**\n * Output warning message - CC 2.1.7 compliant (no ANSI in JSON)\n */\nexport function outputWarning(message: string): HookResult {\n  return { continue: true, systemMessage: `\\u26a0 ${message}` };\n}\n\n/**\n * Output deny with feedback logging (CC 2.1.7)\n */\nexport function outputDeny(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Logging (with log level guard for performance)\n// -----------------------------------------------------------------------------\n\nconst LOG_ROTATION_MAX_SIZE = 200 * 1024; // 200KB\nconst PERMISSION_LOG_MAX_SIZE = 100 * 1024; // 100KB\n\n/**\n * Rotate log file if it exceeds size limit\n */\nfunction rotateLogFile(logFile: string, maxSize: number): void {\n  if (!existsSync(logFile)) return;\n\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > maxSize) {\n      const rotated = `${logFile}.old.${Date.now()}`;\n      renameSync(logFile, rotated);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n}\n\n/**\n * Log to hook log file with automatic rotation\n * Respects ORCHESTKIT_LOG_LEVEL (default: warn, skips debug logs in production)\n */\nexport function logHook(hookName: string, message: string, level: 'debug' | 'info' | 'warn' | 'error' = 'debug'): void {\n  // Skip if below log level threshold (big perf win - avoids I/O)\n  if (!shouldLog(level)) {\n    return;\n  }\n\n  const logDir = getLogDir();\n  const logFile = `${logDir}/hooks.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, LOG_ROTATION_MAX_SIZE);\n\n    const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n    appendFileSync(logFile, `[${timestamp}] [${level.toUpperCase()}] [${hookName}] ${message}\\n`);\n  } catch {\n    // Ignore logging errors - don't block hook execution\n  }\n}\n\n/**\n * Log permission decision for audit trail (CC 2.1.7 feature)\n * Always logs (security audit trail) - not affected by log level\n */\nexport function logPermissionFeedback(\n  decision: 'allow' | 'deny' | 'warn',\n  reason: string,\n  input?: HookInput | Record<string, unknown>\n): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/permission-feedback.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, PERMISSION_LOG_MAX_SIZE);\n\n    const timestamp = new Date().toISOString();\n    const toolName = (input as HookInput)?.tool_name || process.env.HOOK_TOOL_NAME || 'unknown';\n    const sessionId = (input as HookInput)?.session_id || getSessionId();\n\n    appendFileSync(\n      logFile,\n      `${timestamp} | ${decision} | ${reason} | tool=${toolName} | session=${sessionId}\\n`\n    );\n  } catch {\n    // Ignore logging errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Input Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Read hook input from stdin synchronously\n * Returns parsed JSON or empty object on failure\n */\nexport function readHookInput(): HookInput {\n  try {\n    // Read from stdin synchronously\n    const chunks: Buffer[] = [];\n    const BUFSIZE = 256;\n    const buf = Buffer.allocUnsafe(BUFSIZE);\n\n    let bytesRead: number;\n    const fd = 0; // stdin\n\n    while (true) {\n      try {\n        bytesRead = readSync(fd, buf, 0, BUFSIZE, null);\n        if (bytesRead === 0) break;\n        chunks.push(Buffer.from(buf.subarray(0, bytesRead)));\n      } catch {\n        break;\n      }\n    }\n\n    const input = Buffer.concat(chunks).toString('utf8').trim();\n    if (!input) {\n      return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n    }\n\n    return JSON.parse(input);\n  } catch {\n    return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n  }\n}\n\n/**\n * Get field from hook input using optional chaining\n */\nexport function getField<T>(input: HookInput, path: string): T | undefined {\n  const parts = path.replace(/^\\./, '').split('.');\n  let value: unknown = input;\n\n  for (const part of parts) {\n    if (value === null || value === undefined) return undefined;\n    value = (value as Record<string, unknown>)[part];\n  }\n\n  return value as T;\n}\n\n// -----------------------------------------------------------------------------\n// String Utilities\n// -----------------------------------------------------------------------------\n\n/**\n * Normalize command: remove line continuations and collapse whitespace\n * Prevents bypassing detection with backslash-newline tricks (CC 2.1.6 fix)\n */\nexport function normalizeCommand(command: string): string {\n  return command\n    .replace(/\\\\\\s*[\\r\\n]+/g, ' ') // Remove line continuations\n    .replace(/\\n/g, ' ') // Replace newlines with spaces\n    .replace(/\\s+/g, ' ') // Collapse whitespace\n    .trim();\n}\n\n/**\n * Escape string for use in regex\n */\nexport function escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n", "/**\n * Desktop Notifications - Notification Hook\n * CC 2.1.7 Compliant: Outputs proper JSON with suppressOutput\n *\n * Sends rich desktop notifications with context (repo, branch, task).\n * Uses native osascript title/subtitle/message - no external deps.\n *\n * Version: 2.0.0\n */\n\nimport { execSync } from 'node:child_process';\nimport { basename } from 'node:path';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir, getCachedBranch } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst SOUNDS: Record<string, string> = {\n  permission_prompt: 'Sosumi',  // Attention-grabbing\n  idle_prompt: 'Ping',          // Gentle\n  default: 'Ping',\n};\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction escapeForAppleScript(str: string): string {\n  return str.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n}\n\nfunction hasCommand(command: string): boolean {\n  try {\n    execSync(`command -v ${command}`, { stdio: 'ignore' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Extract issue number from branch name (e.g., feature/235-foo \u2192 #235)\n */\nfunction extractIssueFromBranch(branch: string): string | null {\n  const match = branch.match(/(?:feature|fix|bug|issue)[/-](\\d+)/i);\n  return match ? `#${match[1]}` : null;\n}\n\n/**\n * Get repo name from project directory\n */\nfunction getRepoName(): string {\n  try {\n    const projectDir = getProjectDir();\n    return basename(projectDir);\n  } catch {\n    return 'Claude Code';\n  }\n}\n\n/**\n * Build subtitle with branch and optional issue number\n */\nfunction buildSubtitle(branch: string, notificationType: string): string {\n  const issue = extractIssueFromBranch(branch);\n  const typeLabel = notificationType === 'permission_prompt' ? '\u23F8 Permission needed' : '\uD83D\uDCA4 Waiting';\n\n  if (issue) {\n    return `${typeLabel} \u00B7 ${issue} \u00B7 ${branch}`;\n  }\n  return `${typeLabel} \u00B7 ${branch}`;\n}\n\n/**\n * Truncate message to fit notification (keep it readable)\n */\nfunction truncateMessage(message: string, maxLen = 120): string {\n  if (message.length <= maxLen) return message;\n  return message.substring(0, maxLen - 3) + '...';\n}\n\n/**\n * Send macOS notification with title, subtitle, and message\n */\nfunction sendMacNotification(\n  title: string,\n  subtitle: string,\n  message: string,\n  sound: string\n): boolean {\n  try {\n    const t = escapeForAppleScript(title);\n    const s = escapeForAppleScript(subtitle);\n    const m = escapeForAppleScript(truncateMessage(message));\n\n    execSync(\n      `osascript -e 'display notification \"${m}\" with title \"${t}\" subtitle \"${s}\" sound name \"${sound}\"'`,\n      { stdio: 'ignore', timeout: 5000 }\n    );\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Send Linux notification (simpler, no subtitle support)\n */\nfunction sendLinuxNotification(title: string, subtitle: string, message: string): boolean {\n  try {\n    const fullMessage = `${subtitle}\\n${message}`;\n    execSync(`notify-send -- \"${title}\" \"${fullMessage}\"`, { stdio: 'ignore', timeout: 5000 });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function desktopNotification(input: HookInput): HookResult {\n  const toolInput = input.tool_input || {};\n  const message = (toolInput.message as string) || input.message || '';\n  const notificationType = (toolInput.notification_type as string) || input.notification_type || '';\n\n  logHook('desktop', `Notification: [${notificationType}] ${message.substring(0, 100)}`);\n\n  // Only show for permission prompts and idle prompts\n  if (notificationType !== 'permission_prompt' && notificationType !== 'idle_prompt') {\n    return outputSilentSuccess();\n  }\n\n  // Build rich notification content\n  const repoName = getRepoName();\n  const branch = getCachedBranch();\n  const subtitle = buildSubtitle(branch, notificationType);\n  const sound = SOUNDS[notificationType] || SOUNDS.default;\n\n  // Send platform-appropriate notification\n  if (hasCommand('osascript')) {\n    sendMacNotification(repoName, subtitle, message, sound);\n  } else if (hasCommand('notify-send')) {\n    sendLinuxNotification(repoName, subtitle, message);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Sound Notifications - Notification Hook\n * CC 2.1.7 Compliant: outputs JSON with suppressOutput\n *\n * Plays sounds for task completion.\n *\n * Version: 1.0.0 (TypeScript port)\n */\n\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\n\n// -----------------------------------------------------------------------------\n// Configuration\n// -----------------------------------------------------------------------------\n\nconst SOUND_MAP: Record<string, string> = {\n  permission_prompt: '/System/Library/Sounds/Sosumi.aiff',\n  idle_prompt: '/System/Library/Sounds/Ping.aiff',\n  auth_success: '/System/Library/Sounds/Glass.aiff',\n};\n\n// -----------------------------------------------------------------------------\n// Helper Functions\n// -----------------------------------------------------------------------------\n\nfunction hasAfplay(): boolean {\n  try {\n    execSync('command -v afplay', { stdio: 'ignore' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction playSound(soundFile: string): void {\n  try {\n    // Run in background (non-blocking)\n    execSync(`afplay \"${soundFile}\" &`, { stdio: 'ignore' });\n  } catch {\n    // Ignore errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Hook Implementation\n// -----------------------------------------------------------------------------\n\nexport function soundNotification(input: HookInput): HookResult {\n  const toolInput = input.tool_input || {};\n  const notificationType = (toolInput.notification_type as string) || '';\n\n  logHook('sound', `Sound notification check: [${notificationType}]`);\n\n  // Play sound based on notification_type (macOS only)\n  if (hasAfplay()) {\n    const soundFile = SOUND_MAP[notificationType];\n    if (soundFile) {\n      playSound(soundFile);\n    }\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Unified Notification Dispatcher\n * Issue #235: Hook Architecture Refactor\n *\n * Consolidates 2 async Notification hooks into a single dispatcher.\n * Reduces \"Async hook Notification completed\" messages from 2 to 1.\n *\n * CC 2.1.19 Compliant: Single async hook with internal routing\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\n\n// Import individual hook implementations\nimport { desktopNotification } from './desktop.js';\nimport { soundNotification } from './sound.js';\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype HookFn = (input: HookInput) => HookResult | Promise<HookResult>;\n\ninterface HookConfig {\n  name: string;\n  fn: HookFn;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Registry\n// -----------------------------------------------------------------------------\n\n/**\n * Registry of all async Notification hooks consolidated into dispatcher\n */\nconst HOOKS: HookConfig[] = [\n  { name: 'desktop', fn: desktopNotification },\n  { name: 'sound', fn: soundNotification },\n];\n\n/** Exposed for registry wiring tests */\nexport const registeredHookNames = () => HOOKS.map(h => h.name);\n\n// -----------------------------------------------------------------------------\n// Dispatcher Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Unified dispatcher that runs all Notification hooks in parallel\n */\nexport async function unifiedNotificationDispatcher(input: HookInput): Promise<HookResult> {\n  // Run all hooks in parallel\n  const results = await Promise.allSettled(\n    HOOKS.map(async hook => {\n      try {\n        const result = hook.fn(input);\n        if (result instanceof Promise) {\n          await result;\n        }\n        return { hook: hook.name, status: 'success' };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        logHook('notification-dispatcher', `${hook.name} failed: ${message}`);\n        return { hook: hook.name, status: 'error', message };\n      }\n    })\n  );\n\n  // Log summary for debugging (only errors)\n  const errors = results.filter(\n    r => r.status === 'rejected' || (r.status === 'fulfilled' && r.value.status === 'error')\n  );\n\n  if (errors.length > 0) {\n    logHook('notification-dispatcher', `${errors.length}/${HOOKS.length} hooks had errors`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Notification Hooks Entry Point\n *\n * Hooks that handle notifications (Notification event)\n * Bundle: notification.mjs (~8 KB estimated - smallest bundle)\n */\n\n// Re-export types and utilities\nexport * from '../types.js';\nexport * from '../lib/common.js';\n\n// Notification hooks (2)\nimport { desktopNotification } from '../notification/desktop.js';\nimport { soundNotification } from '../notification/sound.js';\nimport { unifiedNotificationDispatcher } from '../notification/unified-dispatcher.js';\n\nimport type { HookFn } from '../types.js';\n\n/**\n * Notification hooks registry\n */\nexport const hooks: Record<string, HookFn> = {\n  'notification/desktop': desktopNotification,\n  'notification/sound': soundNotification,\n  'notification/unified-dispatcher': unifiedNotificationDispatcher,\n};\n\nexport function getHook(name: string): HookFn | undefined {\n  return hooks[name];\n}\n\nexport function listHooks(): string[] {\n  return Object.keys(hooks);\n}\n"],
  "mappings": "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",
  "names": ["isBashInput", "input", "isWriteInput", "isEditInput", "isReadInput", "appendFileSync", "existsSync", "statSync", "renameSync", "mkdirSync", "readSync", "execSync", "getLogDir", "getProjectDir", "getPluginRoot", "getSessionId", "getCachedBranch", "projectDir", "branch", "getLogLevel", "shouldLog", "level", "levels", "outputSilentSuccess", "outputSilentAllow", "outputBlock", "reason", "outputWithContext", "ctx", "outputPromptContext", "outputAllowWithContext", "systemMessage", "result", "outputError", "message", "outputWarning", "outputDeny", "LOG_ROTATION_MAX_SIZE", "PERMISSION_LOG_MAX_SIZE", "rotateLogFile", "logFile", "maxSize", "rotated", "ensureDir", "dir", "logHook", "hookName", "logDir", "timestamp", "logPermissionFeedback", "decision", "input", "toolName", "sessionId", "readHookInput", "chunks", "buf", "bytesRead", "fd", "getField", "path", "parts", "value", "part", "normalizeCommand", "command", "escapeRegex", "str", "execSync", "basename", "SOUNDS", "escapeForAppleScript", "str", "hasCommand", "command", "execSync", "extractIssueFromBranch", "branch", "match", "getRepoName", "projectDir", "getProjectDir", "basename", "buildSubtitle", "notificationType", "issue", "typeLabel", "truncateMessage", "message", "maxLen", "sendMacNotification", "title", "subtitle", "sound", "t", "s", "m", "sendLinuxNotification", "fullMessage", "desktopNotification", "input", "toolInput", "logHook", "outputSilentSuccess", "repoName", "getCachedBranch", "execSync", "SOUND_MAP", "hasAfplay", "execSync", "playSound", "soundFile", "soundNotification", "input", "notificationType", "logHook", "outputSilentSuccess", "HOOKS", "desktopNotification", "soundNotification", "unifiedNotificationDispatcher", "input", "errors", "HOOKS", "hook", "result", "error", "message", "logHook", "r", "outputSilentSuccess", "hooks", "desktopNotification", "soundNotification", "unifiedNotificationDispatcher", "getHook", "name", "listHooks"]
}
