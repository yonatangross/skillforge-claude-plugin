// OrchestKit Hooks - prompt bundle
// Generated: 2026-01-29T12:02:55.681Z

var Se=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});function zs(e){return typeof e.command=="string"}function Ws(e){return typeof e.file_path=="string"&&typeof e.content=="string"}function Bs(e){return typeof e.file_path=="string"&&typeof e.old_string=="string"&&typeof e.new_string=="string"}function Ks(e){return typeof e.file_path=="string"&&e.content===void 0}import{appendFileSync as we,existsSync as Te,statSync as bn,renameSync as kn,mkdirSync as Sn,readSync as wn}from"node:fs";import{execSync as Tn}from"node:child_process";function _e(){return process.env.CLAUDE_PLUGIN_ROOT?`${process.env.HOME||process.env.USERPROFILE||"/tmp"}/.claude/logs/ork`:`${f()}/.claude/logs`}function f(){return process.env.CLAUDE_PROJECT_DIR||"."}function C(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function h(){return process.env.CLAUDE_SESSION_ID||`fallback-${process.pid}-${Date.now()}`}function Ys(e){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let t=Tn("git branch --show-current",{cwd:e||f(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=t,t}catch{return"unknown"}}function _n(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function xn(e){let t=["debug","info","warn","error"];return t.indexOf(e)>=t.indexOf(_n())}function p(){return{continue:!0,suppressOutput:!0}}function Qs(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function Zs(e){return{continue:!1,stopReason:e,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:e}}}function ea(e){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:e}}}function b(e){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:e}}}function ta(e,t){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:e,permissionDecision:"allow"}};return t?n.systemMessage=t:n.suppressOutput=!0,n}function na(e){return{continue:!0,systemMessage:e}}function ra(e){return{continue:!0,systemMessage:`\u26A0 ${e}`}}function oa(e){return{continue:!1,stopReason:e,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:e}}}var vn=200*1024,In=100*1024;function xe(e,t){if(Te(e))try{if(bn(e).size>t){let r=`${e}.old.${Date.now()}`;kn(e,r)}}catch{}}function ve(e){Te(e)||Sn(e,{recursive:!0})}function c(e,t,n="debug"){if(!xn(n))return;let r=_e(),o=`${r}/hooks.log`;try{ve(r),xe(o,vn);let i=new Date().toISOString().replace("T"," ").slice(0,19);we(o,`[${i}] [${n.toUpperCase()}] [${e}] ${t}
`)}catch{}}function ia(e,t,n){let r=_e(),o=`${r}/permission-feedback.log`;try{ve(r),xe(o,In);let i=new Date().toISOString(),s=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=n?.session_id||h();we(o,`${i} | ${e} | ${t} | tool=${s} | session=${a}
`)}catch{}}function U(e){if(!e)return 0;let r=(e.match(/[{};()=><]/g)||[]).length/e.length>.03?2.8:3.5;return Math.ceil(e.length/r)}function sa(e,t,n,r,o){let i=U(e);return r&&r.isOverBudget(n)?(c(t,`Budget exhausted for ${n}, suppressing ${i}t`),p()):(o&&o.trackTokenUsage(t,n,i),b(e))}function aa(){try{let e=[],n=Buffer.allocUnsafe(256),r,o=0;for(;;)try{if(r=wn(o,n,0,256,null),r===0)break;e.push(Buffer.from(n.subarray(0,r)))}catch{break}let i=Buffer.concat(e).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:h(),tool_input:{}}}catch{return{tool_name:"",session_id:h(),tool_input:{}}}}function ca(e,t){let n=t.replace(/^\./,"").split("."),r=e;for(let o of n){if(r==null)return;r=r[o]}return r}function la(e){return e.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function ua(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var T={AUTO_DISPATCH:85,SKILL_INJECT:80,STRONG_RECOMMEND:70,SUGGEST:50,MINIMUM:40},ga={enableAutoDispatch:!0,enableSkillInjection:!0,maxSkillInjectionTokens:800,enableCalibration:!0,enablePipelines:!0,maxRetries:3,retryDelayBaseMs:1e3};import{existsSync as Rn,readFileSync as Ie,readdirSync as Re}from"node:fs";import{join as W}from"node:path";var G={keyword:30,phrase:25,context:20,cooccurrence:15,negation:10},Pn=[/\b(not|don't|doesn't|won't|can't|shouldn't|avoid|without|except|unlike|instead of)\s+/i,/\b(no|never|neither|nor)\s+/i],Cn=["continue","also","additionally","and","then","next","follow up","after that"],q=null,Z=null;function En(e){if(q&&Z===e)return q;let t=new Map;try{let n=Re(e).filter(r=>r.endsWith(".md"));for(let r of n){let o=r.replace(".md",""),i=W(e,r);try{let a=Ie(i,"utf8").match(/^---\n([\s\S]*?)\n---/);if(!a)continue;let l=a[1],u=l.match(/^description:\s*(.+)$/m);if(!u)continue;let g=u[1].trim(),d=g.match(/Activates for\s+(.+?)\.?$/i),m=d?g.slice(0,g.indexOf("Activates for")).trim():g,y=[],x=[];if(d){let w=d[1].split(/,\s*/).map(k=>k.trim().toLowerCase());for(let k of w)k.includes(" ")||k.includes("-")?x.push(k):k.length>1&&y.push(k)}let R=l.match(/^skills:\s*\n((?:\s+-\s+.+\n?)+)/m),v;R&&(v=R[1].split(`
`).map(S=>S.replace(/^\s*-\s*/,"").trim()).filter(Boolean)),(y.length>0||x.length>0)&&t.set(o,{keywords:y,phrases:x,description:m||g.split(".")[0],skills:v})}catch{}}}catch{c("intent-classifier","Could not read agents directory")}return q=t,Z=e,t}var z=null,ee=null;function An(e){if(z&&ee===e)return z;let t=new Map;try{let n=Re(e,{withFileTypes:!0}).filter(r=>r.isDirectory()).map(r=>r.name);for(let r of n){let o=W(e,r,"SKILL.md");if(Rn(o))try{let s=Ie(o,"utf8").match(/^---\n([\s\S]*?)\n---/);if(!s)continue;let a=s[1],l=a.match(/^description:\s*(.+)$/m),u=l?l[1].trim():"",g=a.match(/^tags:\s*\[([^\]]+)\]/m),d=[];g&&(d=g[1].split(",").map(y=>y.trim().toLowerCase().replace(/["']/g,"")).filter(y=>y.length>1));let m=u.toLowerCase().split(/\s+/).filter(y=>y.length>4).slice(0,5);d=[...new Set([...d,...m])],(d.length>0||u)&&t.set(r,{keywords:d,description:u})}catch{}}}catch{c("intent-classifier","Could not read skills directory")}return z=t,ee=e,t}function $n(e,t){let n=0,r=[],o=[];for(let s of t)if(new RegExp(`\\b${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(e)){let l=s.length>5?25:20;n+=l,r.push(s),o.push({type:"keyword",source:"keyword-match",weight:l,matched:s})}let i=t.length*25;return{score:i>0?Math.min(n/i*100,100):0,matched:r,signals:o}}function Dn(e,t){let n=0,r=[],o=[];for(let s of t)if(e.includes(s)){let a=s.split(/\s+/).length*15;n+=a,r.push(s),o.push({type:"phrase",source:"phrase-match",weight:a,matched:s})}let i=t.length*45;return{score:i>0?Math.min(n/i*100,100):0,matched:r,signals:o}}function On(e,t,n){if(n.length===0)return{score:0,signals:[]};let r=[],o=0;for(let s of Cn)if(e.includes(s)){o+=15,r.push({type:"context",source:"continuation-keyword",weight:15,matched:s});break}let i=n.slice(-3).join(" ").toLowerCase();for(let s of t.slice(0,5))i.includes(s)&&(o+=20,r.push({type:"context",source:"history-keyword",weight:20,matched:s}));return{score:Math.min(o,100),signals:r}}function jn(e){let t=[],n=0;for(let r of Pn)if(r.test(e)){n=25,t.push({type:"negation",source:"negation-detected",weight:-25,matched:e.match(r)?.[0]||"negation"});break}return{penalty:n,signals:t}}function Mn(e,t,n){if(n.length===0)return{adjustment:0,signals:[]};let r=0,o=[];for(let i of n)i.agent===e&&t.includes(i.keyword)&&(r+=i.adjustment,o.push({type:i.adjustment>0?"boost":"penalty",source:"calibration",weight:i.adjustment,matched:`${i.keyword}:${e}`}));return{adjustment:r,signals:o}}function Nn(e,t,n,r,o){let i=[],s=[],a=$n(e,n.keywords);i.push(...a.signals),s.push(...a.matched);let l=Dn(e,n.phrases);i.push(...l.signals),s.push(...l.matched);let u=On(e,n.keywords,r);i.push(...u.signals);let g=jn(e);i.push(...g.signals);let d=Mn(t,s,o);i.push(...d.signals);let m=a.score*(G.keyword/100)+l.score*(G.phrase/100)+u.score*(G.context/100);return m-=g.penalty*(G.negation/100),m+=Math.max(-15,Math.min(15,d.adjustment)),m=Math.max(0,Math.min(100,m)),m<T.MINIMUM?null:{agent:t,confidence:Math.round(m),description:n.description,matchedKeywords:s,signals:i}}function Ln(e,t,n){let r=[],o=[],i=0;for(let s of n.keywords)if(new RegExp(`\\b${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(e)){let l=s.length>5?25:20;i+=l,o.push(s),r.push({type:"keyword",source:"skill-keyword",weight:l,matched:s})}return i=Math.min(i,100),i<T.MINIMUM?null:{skill:t,confidence:Math.round(i),description:n.description,matchedKeywords:o,signals:r}}function D(e,t=[],n=[]){let r=C(),o=W(r,"agents"),i=W(r,"skills"),s=e.toLowerCase(),a=[],l=[],u=[],g=En(o);for(let[S,w]of g){let k=Nn(s,S,w,t,n);k&&(l.push(k),a.push(...k.signals))}let d=An(i);for(let[S,w]of d){let k=Ln(s,S,w);k&&(u.push(k),a.push(...k.signals))}l.sort((S,w)=>w.confidence-S.confidence),u.sort((S,w)=>w.confidence-S.confidence);let m=l[0],y=m?Hn(m.agent,m.matchedKeywords):"general",x=Math.max(m?.confidence||0,u[0]?.confidence||0),R=m!==void 0&&m.confidence>=T.AUTO_DISPATCH,v=u.length>0&&u[0].confidence>=T.SKILL_INJECT;return{agents:l.slice(0,3),skills:u.slice(0,5),intent:y,confidence:x,signals:a,shouldAutoDispatch:R,shouldInjectSkills:v}}function Hn(e,t){let n={"api-design":["api","endpoint","rest","graphql","route"],database:["database","schema","migration","sql","query"],authentication:["auth","login","jwt","oauth","session"],frontend:["react","component","ui","form","state"],testing:["test","coverage","mock","fixture","e2e"],devops:["deploy","ci","cd","release","monitor"],"ai-integration":["llm","rag","embedding","langgraph","agent"],security:["security","owasp","xss","injection","csrf"]};for(let[r,o]of Object.entries(n))for(let i of t)if(o.includes(i))return r;return e.includes("backend")||e.includes("api")?"api-design":e.includes("frontend")||e.includes("ui")?"frontend":e.includes("test")?"testing":e.includes("security")?"security":"general"}function O(e){return!(e.length<10||/what agents|list agents|available agents|what skills/i.test(e)||/^(yes|no|ok|thanks|done|continue|stop)$/i.test(e.trim()))}function ba(){q=null,Z=null,z=null,ee=null}import{existsSync as N,readFileSync as Ce,writeFileSync as Ee,mkdirSync as Fn}from"node:fs";function te(){return`${f()}/.claude/orchestration`}function ne(){let e=h();return`${te()}/session-${e}.json`}function Ae(){return`${f()}/.claude/orchestration/config.json`}function $e(){let e=te();if(!N(e))try{Fn(e,{recursive:!0})}catch{c("orchestration-state",`Failed to create state dir: ${e}`)}}function E(){let e=ne();if(N(e))try{let t=Ce(e,"utf8");return JSON.parse(t)}catch(t){c("orchestration-state",`Failed to load state: ${t}`)}return{sessionId:h(),activeAgents:[],injectedSkills:[],promptHistory:[],maxHistorySize:10,updatedAt:new Date().toISOString()}}function Un(e){$e();let t=ne();e.updatedAt=new Date().toISOString();try{Ee(t,JSON.stringify(e,null,2))}catch(n){c("orchestration-state",`Failed to save state: ${n}`)}}function j(e){let t=E();return e(t),Un(t),t}function De(e,t,n){let r={agent:e,taskId:n,confidence:t,dispatchedAt:new Date().toISOString(),status:"pending",retryCount:0,maxRetries:3};return j(o=>{o.activeAgents=o.activeAgents.filter(i=>i.agent!==e),o.activeAgents.push(r)}),c("orchestration-state",`Tracked dispatched agent: ${e} (conf: ${t})`),r}function Ta(e,t,n){j(r=>{let o=r.activeAgents.find(i=>i.agent===e);o&&(o.status=t,n&&(o.taskId=n),t==="retrying"&&o.retryCount++)}),c("orchestration-state",`Updated agent status: ${e} -> ${t}`)}function _a(e){j(t=>{t.activeAgents=t.activeAgents.filter(n=>n.agent!==e)})}function xa(){return E().activeAgents.find(t=>t.status==="in_progress")}function Oe(e){return E().activeAgents.some(n=>n.agent===e&&(n.status==="pending"||n.status==="in_progress"))}function je(e){j(t=>{t.injectedSkills.includes(e)||t.injectedSkills.push(e)})}function Me(e){return E().injectedSkills.includes(e)}function va(){return E().injectedSkills}function Ne(e){j(t=>{t.promptHistory.push(e),t.promptHistory.length>t.maxHistorySize&&(t.promptHistory=t.promptHistory.slice(-t.maxHistorySize))})}function B(){return E().promptHistory}function Le(e){j(t=>{t.lastClassification=e})}function He(){return E().lastClassification}var Pe={enableAutoDispatch:!0,enableSkillInjection:!0,maxSkillInjectionTokens:800,enableCalibration:!0,enablePipelines:!0,maxRetries:3,retryDelayBaseMs:1e3};function P(){let e=Ae();if(N(e))try{let t=Ce(e,"utf8");return{...Pe,...JSON.parse(t)}}catch{}return Pe}function Ia(e){$e();let t=Ae(),r={...P(),...e};try{Ee(t,JSON.stringify(r,null,2))}catch(o){c("orchestration-state",`Failed to save config: ${o}`)}}function Ra(){let e=ne();try{if(N(e)){let{unlinkSync:t}=Se("node:fs");t(e),c("orchestration-state","Cleared session state")}}catch{}}function Pa(){let e=te();if(N(e))try{let{readdirSync:t,statSync:n,unlinkSync:r}=Se("node:fs"),o=t(e).filter(i=>i.startsWith("session-")&&i.endsWith(".json")).map(i=>({name:i,path:`${e}/${i}`,mtime:n(`${e}/${i}`).mtime.getTime()})).sort((i,s)=>s.mtime-i.mtime);for(let i of o.slice(5))try{r(i.path),c("orchestration-state",`Cleaned up old state: ${i.name}`)}catch{}}catch{}}import{existsSync as Fe,readFileSync as Gn,writeFileSync as qn,mkdirSync as zn}from"node:fs";function Ue(){let e=h();return`${f()}/.claude/orchestration/task-registry-${e}.json`}function Wn(){let e=`${f()}/.claude/orchestration`;if(!Fe(e))try{zn(e,{recursive:!0})}catch{}}function I(){let e=Ue();if(Fe(e))try{return JSON.parse(Gn(e,"utf8"))}catch{}return{schemaVersion:"1.0.0",sessionId:h(),tasks:[],pipelines:[],updatedAt:new Date().toISOString()}}function A(e){Wn();let t=Ue();e.updatedAt=new Date().toISOString();try{qn(t,JSON.stringify(e,null,2))}catch(n){c("task-integration",`Failed to save registry: ${n}`)}}function Bn(e,t){let r={"backend-system-architect":"Designing","frontend-ui-developer":"Building","test-generator":"Writing tests for","security-auditor":"Auditing","workflow-architect":"Architecting","database-engineer":"Implementing database for","llm-integrator":"Integrating LLM for","code-quality-reviewer":"Reviewing","ux-researcher":"Researching UX for","product-strategist":"Strategizing","debug-investigator":"Investigating","performance-engineer":"Optimizing","accessibility-specialist":"Auditing accessibility for","infrastructure-architect":"Designing infrastructure for","data-pipeline-engineer":"Building pipeline for"}[e]||"Working on",o=t.slice(0,40).toLowerCase();return`${r} ${o}`}function $a(e,t,n,r){let o=e.split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),i={source:"orchestration",dispatchedAgent:e,dispatchConfidence:n,...r};return{subject:`${o}: ${t.slice(0,50)}`,description:`Agent dispatched automatically at ${n}% confidence.

${t}`,activeForm:Bn(e,t),metadata:i}}function Da(e,t,n,r){let o={taskId:e,status:t};return n&&n.length>0&&(o.addBlockedBy=n),r&&r.length>0&&(o.addBlocks=r),o}function Oa(e){return`### Create Task for Tracking

\`\`\`
TaskCreate:
  subject: "${e.subject}"
  description: "${e.description}"
  activeForm: "${e.activeForm}"
  metadata:
    source: "${e.metadata.source}"
    dispatchedAgent: "${e.metadata.dispatchedAgent||""}"
    dispatchConfidence: ${e.metadata.dispatchConfidence||0}
\`\`\``}function ja(e,t){return{taskId:e,status:"deleted"}}function Ma(e,t){return`### Delete Orphaned Task

\`\`\`
TaskUpdate:
  taskId: "${e}"
  status: "deleted"
\`\`\`

**Reason**: ${t}`}function Na(e){let t=`### Update Task

\`\`\`
TaskUpdate:
  taskId: "${e.taskId}"`;return e.status&&(t+=`
  status: "${e.status}"`),e.addBlockedBy&&e.addBlockedBy.length>0&&(t+=`
  addBlockedBy: ${JSON.stringify(e.addBlockedBy)}`),e.addBlocks&&e.addBlocks.length>0&&(t+=`
  addBlocks: ${JSON.stringify(e.addBlocks)}`),t+="\n```",t}function Ge(e,t,n,r,o,i,s){let a=I();if(a.tasks.find(u=>u.taskId===e)){c("task-integration",`Task ${e} already registered`);return}a.tasks.push({taskId:e,agent:t,confidence:n,createdAt:new Date().toISOString(),status:"pending",pipelineId:r,pipelineStep:o,blockedBy:i,blocks:s}),A(a),c("task-integration",`Registered task ${e} for agent ${t}`)}function La(e,t){let n=I(),r=n.tasks.find(o=>o.taskId===e);r&&(r.status=t,A(n),c("task-integration",`Updated task ${e} status to ${t}`))}function Ha(e){return I().tasks.find(n=>n.agent===e&&(n.status==="pending"||n.status==="in_progress"))}function Fa(e){return I().tasks.find(n=>n.taskId===e)}function Ua(e){return I().tasks.filter(n=>n.status==="pending"&&n.blockedBy&&n.blockedBy.includes(e))}function Ga(){let e=I(),t=new Set(e.tasks.filter(n=>n.status==="failed").map(n=>n.taskId));return t.size===0?[]:e.tasks.filter(n=>n.status!=="pending"||!n.blockedBy||n.blockedBy.length===0?!1:n.blockedBy.every(r=>t.has(r)))}function Kn(e){return I().tasks.filter(n=>n.pipelineId===e).sort((n,r)=>(n.pipelineStep||0)-(r.pipelineStep||0))}function qe(e){let t=I();if(t.pipelines.find(r=>r.pipelineId===e.pipelineId)){c("task-integration",`Pipeline ${e.pipelineId} already registered`);return}t.pipelines.push(e),A(t),c("task-integration",`Registered pipeline ${e.pipelineId} (${e.type})`)}function qa(e,t){let n=I(),r=n.pipelines.find(o=>o.pipelineId===e);r&&(Object.assign(r,t),A(n),c("task-integration",`Updated pipeline ${e}`))}function ze(){return I().pipelines.find(t=>t.status==="running")}function za(e,t){let n=I(),r=n.pipelines.find(i=>i.pipelineId===e);if(!r)return null;r.completedSteps.includes(t)||(r.completedSteps.push(t),r.completedSteps.sort((i,s)=>i-s));let o=Kn(e);for(let i of o){let s=i.pipelineStep;if(s===void 0||r.completedSteps.includes(s)||i.status!=="pending")continue;if(s===0||r.completedSteps.includes(s-1))return r.currentStep=s,A(n),s}return r.status="completed",A(n),null}function Wa(e=1440*60*1e3){let t=I(),n=Date.now()-e;t.tasks=t.tasks.filter(r=>r.status==="pending"||r.status==="in_progress"?!0:new Date(r.createdAt).getTime()>n),t.pipelines=t.pipelines.filter(r=>r.status==="running"?!0:new Date(r.startedAt).getTime()>n),A(t)}var Jn=3,Vn=1e3,Xn=3e4,Yn={"backend-system-architect":["database-engineer","api-designer"],"frontend-ui-developer":["rapid-ui-designer","accessibility-specialist"],"test-generator":["debug-investigator","code-quality-reviewer"],"security-auditor":["security-layer-auditor"],"workflow-architect":["llm-integrator","data-pipeline-engineer"]},Qn=[/permission denied/i,/access denied/i,/not found.*(?:file|module|package)/i,/(?:file|module|package)\s+not\s+found/i,/missing required/i,/invalid (?:api|token|key)/i,/authentication failed/i,/quota exceeded/i,/rate limit/i],Zn=[/not my specialization/i,/outside my scope/i,/better suited for/i,/consider using/i,/specialized agent/i];function er(e,t=Vn){let n=t*Math.pow(2,e-1),r=Math.random()*.1*n;return Math.min(n+r,Xn)}function tr(e){for(let t of Qn)if(t.test(e))return!1;return!0}function nr(e){for(let t of Zn)if(t.test(e))return!0;return!1}function re(e,t=[]){let n=Yn[e];if(n){for(let r of n)if(!t.includes(r))return r}}function Ja(e,t,n,r=[],o=Jn){if(c("retry-manager",`Evaluating retry for ${e}, attempt ${t}`),t>=o){let s=re(e,r);return{shouldRetry:!1,retryCount:t,maxRetries:o,alternativeAgent:s,reason:`Max retries (${o}) exceeded`+(s?`. Consider trying ${s} instead.`:"")}}if(!tr(n)){let s=re(e,r);return{shouldRetry:!1,retryCount:t,maxRetries:o,alternativeAgent:s,reason:`Non-retryable error detected: ${n.slice(0,100)}`}}if(nr(n)){let s=re(e,r);if(s)return{shouldRetry:!1,retryCount:t,maxRetries:o,alternativeAgent:s,reason:`Error suggests using alternative agent: ${s}`}}let i=er(t);return{shouldRetry:!0,retryCount:t,maxRetries:o,delayMs:i,reason:`Retrying (attempt ${t+1}/${o}) after ${Math.round(i/1e3)}s`}}function Va(e,t,n){return{agent:e,taskId:n,attemptNumber:t,startedAt:new Date().toISOString()}}function Xa(e,t,n){let r=new Date().toISOString(),o=new Date(r).getTime()-new Date(e.startedAt).getTime();return{...e,completedAt:r,outcome:t,error:n,durationMs:o}}function Ya(e){if(e.length===0)return{successRate:0,avgDuration:0,commonErrors:[]};let n=e.filter(a=>a.outcome==="success").length/e.length,r=e.filter(a=>a.durationMs!==void 0).map(a=>a.durationMs),o=r.length>0?r.reduce((a,l)=>a+l,0)/r.length:0,i=new Map;for(let a of e)if(a.error){let l=a.error.slice(0,50).toLowerCase();i.set(l,(i.get(l)||0)+1)}let s=Array.from(i.entries()).sort((a,l)=>l[1]-a[1]).slice(0,3).map(([a])=>a);return{successRate:n,avgDuration:o,commonErrors:s}}function Qa(e,t){return{...e,status:"retrying",retryCount:t.retryCount}}function Za(e,t){if(e.shouldRetry)return`## Retry Scheduled

Agent \`${t}\` will retry after ${Math.round((e.delayMs||0)/1e3)} seconds.

**Attempt:** ${e.retryCount+1} of ${e.maxRetries}
**Reason:** ${e.reason}`;let n=`## Retry Not Recommended

Agent \`${t}\` has ${e.retryCount>=e.maxRetries?"exhausted retries":"encountered a non-retryable error"}.

**Reason:** ${e.reason}`;return e.alternativeAgent&&(n+=`

### Alternative Suggestion

Consider using \`${e.alternativeAgent}\` instead:

\`\`\`
Task tool with subagent_type: "${e.alternativeAgent}"
\`\`\``),n}import{existsSync as Je,readFileSync as rr,writeFileSync as or,mkdirSync as ir}from"node:fs";import{createHash as sr}from"node:crypto";var We=500,oe=3,Be=15,Ke=3,ar=.9;function Ve(){return`${f()}/.claude/feedback/calibration-data.json`}function cr(){let e=`${f()}/.claude/feedback`;if(!Je(e))try{ir(e,{recursive:!0})}catch{}}function L(){let e=Ve();if(Je(e))try{return JSON.parse(rr(e,"utf8"))}catch{c("calibration-engine","Failed to load calibration data, using defaults")}return{schemaVersion:"1.0.0",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),records:[],adjustments:[],stats:{totalDispatches:0,successRate:0,avgConfidence:0,topAgents:[]}}}function lr(e){cr();let t=Ve();e.updatedAt=new Date().toISOString();try{or(t,JSON.stringify(e,null,2)),c("calibration-engine","Saved calibration data")}catch(n){c("calibration-engine",`Failed to save calibration data: ${n}`)}}function ur(e){return sr("sha256").update(e.toLowerCase().trim()).digest("hex").slice(0,16)}function oc(e,t,n,r,o,i,s){let a=L(),l={timestamp:new Date().toISOString(),sessionId:h(),agent:t,promptHash:ur(e),matchedKeywords:n,dispatchConfidence:r,outcome:o,durationMs:i,feedback:s};a.records.push(l),a.records.length>We&&(a.records=a.records.slice(-We)),pr(a,l),gr(a),lr(a),c("calibration-engine",`Recorded outcome: ${t} -> ${o} (conf: ${r})`)}function pr(e,t){let n=t.outcome==="success",r=t.outcome==="failure"||t.outcome==="rejected";if(!n&&!r)return;let o=n?Ke:-Ke;for(let i of t.matchedKeywords){let s=e.adjustments.find(a=>a.keyword===i&&a.agent===t.agent);s?(s.adjustment=Math.max(-Be,Math.min(Be,s.adjustment+o)),s.sampleCount++,s.lastUpdated=new Date().toISOString()):e.adjustments.push({keyword:i,agent:t.agent,adjustment:o,sampleCount:1,lastUpdated:new Date().toISOString()})}}function ic(e){let t=Date.now(),n=1440*60*1e3;for(let r of e.adjustments){let o=t-new Date(r.lastUpdated).getTime();Math.floor(o/n)>7&&(r.adjustment=Math.round(r.adjustment*ar),Math.abs(r.adjustment)<1&&(r.adjustment=0))}e.adjustments=e.adjustments.filter(r=>r.adjustment!==0)}function gr(e){let t=e.records;if(t.length===0)return;e.stats.totalDispatches=t.length;let n=t.filter(i=>i.outcome==="success").length;e.stats.successRate=n/t.length;let r=t.reduce((i,s)=>i+s.dispatchConfidence,0)/t.length;e.stats.avgConfidence=Math.round(r);let o=new Map;for(let i of t){let s=o.get(i.agent)||{count:0,success:0};s.count++,i.outcome==="success"&&s.success++,o.set(i.agent,s)}e.stats.topAgents=Array.from(o.entries()).map(([i,s])=>({agent:i,count:s.count,successRate:s.success/s.count})).sort((i,s)=>s.count-i.count).slice(0,10)}function Xe(){return L().adjustments.filter(t=>t.sampleCount>=oe)}function sc(e){let n=L().records.filter(o=>o.agent===e);return n.length<oe?null:n.filter(o=>o.outcome==="success").length/n.length}function ac(){return L().stats}function cc(){return L().records.length>=oe}var Ye=[{type:"product-thinking",name:"Product Thinking Pipeline",description:"Full product discovery and specification workflow",triggers:["should we build","product decision","feature validation","market research","user research"],steps:[{agent:"market-intelligence",description:"Analyze competitive landscape and market trends",dependsOn:[],skills:["market-research"],estimatedTokens:3e3},{agent:"ux-researcher",description:"Create personas and map user journeys",dependsOn:[0],skills:["user-research"],estimatedTokens:2500},{agent:"product-strategist",description:"Validate value proposition and alignment",dependsOn:[0,1],skills:["product-strategy"],estimatedTokens:2e3},{agent:"prioritization-analyst",description:"Score and prioritize using frameworks",dependsOn:[2],skills:["prioritization"],estimatedTokens:1500},{agent:"business-case-builder",description:"Build ROI and cost-benefit analysis",dependsOn:[2,3],skills:["business-case"],estimatedTokens:2e3},{agent:"requirements-translator",description:"Transform to PRD and user stories",dependsOn:[4],skills:["requirements"],estimatedTokens:2500}],estimatedTotalTokens:13500},{type:"full-stack-feature",name:"Full-Stack Feature Pipeline",description:"End-to-end feature implementation workflow",triggers:["full-stack feature","build a feature","implement end-to-end","create full feature","add complete feature"],steps:[{agent:"backend-system-architect",description:"Design API and database schema",dependsOn:[],skills:["api-design-framework","database-schema-designer"],estimatedTokens:3e3},{agent:"frontend-ui-developer",description:"Build React components and UI",dependsOn:[0],skills:["react-server-components-framework","form-state-patterns"],estimatedTokens:3500},{agent:"test-generator",description:"Create unit and integration tests",dependsOn:[0,1],skills:["integration-testing","msw-mocking"],estimatedTokens:2e3},{agent:"security-auditor",description:"Audit for vulnerabilities",dependsOn:[0,1],skills:["owasp-top-10","auth-patterns"],estimatedTokens:1500}],estimatedTotalTokens:1e4},{type:"ai-integration",name:"AI Integration Pipeline",description:"Add AI/LLM capabilities to application",triggers:["add rag","add llm","ai integration","implement rag","add ai feature","langgraph workflow"],steps:[{agent:"workflow-architect",description:"Design LangGraph workflow and state",dependsOn:[],skills:["langgraph-state","langgraph-routing"],estimatedTokens:2500},{agent:"llm-integrator",description:"Connect LLM APIs with function calling",dependsOn:[0],skills:["function-calling","llm-streaming"],estimatedTokens:2e3},{agent:"data-pipeline-engineer",description:"Build embeddings and data pipeline",dependsOn:[0],skills:["embeddings","rag-retrieval"],estimatedTokens:2500},{agent:"test-generator",description:"Create LLM testing infrastructure",dependsOn:[1,2],skills:["llm-testing","property-based-testing"],estimatedTokens:1500}],estimatedTotalTokens:8500},{type:"security-audit",name:"Security Audit Pipeline",description:"Comprehensive security review workflow",triggers:["security audit","security review","vulnerability scan","security assessment"],steps:[{agent:"security-auditor",description:"Scan for OWASP Top 10 vulnerabilities",dependsOn:[],skills:["owasp-top-10","input-validation"],estimatedTokens:2e3},{agent:"security-layer-auditor",description:"Verify defense-in-depth layers",dependsOn:[0],skills:["defense-in-depth"],estimatedTokens:2e3},{agent:"ai-safety-auditor",description:"Audit AI/LLM security if applicable",dependsOn:[0],skills:["mcp-security-hardening"],estimatedTokens:1500}],estimatedTotalTokens:5500},{type:"frontend-compliance",name:"Frontend 2026 Compliance Pipeline",description:"Modernize frontend to 2026 patterns",triggers:["frontend compliance","modernize frontend","update react","frontend 2026"],steps:[{agent:"frontend-ui-developer",description:"Upgrade to React 19 patterns",dependsOn:[],skills:["react-server-components-framework","zustand-patterns"],estimatedTokens:3e3},{agent:"performance-engineer",description:"Optimize Core Web Vitals",dependsOn:[0],skills:["core-web-vitals","lazy-loading-patterns"],estimatedTokens:2e3},{agent:"accessibility-specialist",description:"Ensure WCAG 2.2 compliance",dependsOn:[0],skills:["a11y-testing","focus-management"],estimatedTokens:1500}],estimatedTotalTokens:6500}];function Qe(e){let t=e.toLowerCase();for(let n of Ye)for(let r of n.triggers)if(t.includes(r))return c("multi-agent-coordinator",`Detected pipeline: ${n.type} (trigger: "${r}")`),n;return null}function gc(e){return Ye.find(t=>t.type===e)||null}function Ze(e){let t=`pipeline-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,n=[],r={};for(let i=0;i<e.steps.length;i++){let s=e.steps[i],a=`task-${t}-${i}`;r[i]=a;let l={source:"pipeline",dispatchedAgent:s.agent,pipelineId:t,pipelineStep:i,relatedSkills:s.skills},u=s.dependsOn.map(g=>r[g]).filter(Boolean);n.push({subject:`[${e.name}] Step ${i+1}: ${s.description}`,description:`Pipeline step: ${s.agent}

${s.description}

Estimated tokens: ${s.estimatedTokens}`,activeForm:`Running ${s.agent}`,metadata:l,blockedBy:u.length>0?u:void 0})}return{execution:{pipelineId:t,type:e.type,startedAt:new Date().toISOString(),taskIds:r,currentStep:0,completedSteps:[],status:"running"},tasks:n}}function et(e,t){qe(e);for(let n=0;n<t.length;n++){let r=t[n],o=e.taskIds[n];o&&r.metadata.dispatchedAgent&&Ge(o,r.metadata.dispatchedAgent,r.metadata.dispatchConfidence||100,e.pipelineId,n)}c("multi-agent-coordinator",`Registered pipeline ${e.pipelineId} with ${t.length} tasks`)}function tt(e,t,n){let r=`## \u{1F504} Pipeline Detected: ${e.name}

${e.description}

**Pipeline ID:** \`${t.pipelineId}\`
**Estimated Total Tokens:** ~${e.estimatedTotalTokens}

### Pipeline Steps

`;for(let o=0;o<e.steps.length;o++){let i=e.steps[o],s=i.dependsOn.length>0?` (after steps: ${i.dependsOn.map(a=>a+1).join(", ")})`:" (can start immediately)";r+=`**${o+1}. ${i.agent}**${s}
   ${i.description}
   Skills: ${i.skills?.join(", ")||"none"}

`}r+=`### Task Creation Instructions

Create these tasks to track the pipeline:

`;for(let o=0;o<n.length;o++){let i=n[o];r+=`**Task ${o+1}:**
\`\`\`
TaskCreate:
  subject: "${i.subject}"
  activeForm: "${i.activeForm}"
${i.blockedBy?`  blockedBy: ${JSON.stringify(i.blockedBy)}`:""}
\`\`\`

`}return r+=`### Start Pipeline

After creating all tasks, spawn the first agent:

\`\`\`
Task tool with subagent_type: "${e.steps[0].agent}"
\`\`\`

The orchestration layer will track progress and suggest next agents as steps complete.`,r}var dr=["implement","add","create","build","set up","configure","pagination","authentication","caching","database","api","endpoint"];function fr(e){let t=e.toLowerCase();return/pagination|cursor|offset|page/i.test(t)?"pagination":/auth|jwt|oauth|login|session/i.test(t)?"authentication":/cache|redis|memo/i.test(t)?"caching":/database|sql|postgres|query/i.test(t)?"database":/api|endpoint|rest|graphql/i.test(t)?"api":/error|exception|handling/i.test(t)?"error-handling":/test|testing|spec/i.test(t)?"testing":"general"}function mr(e,t){return`project:${t.split("/").pop()||"unknown"}:${e}`}function yr(e){return`global:${e}`}function nt(e){let t=e.prompt||"",n=e.project_dir||f();if(t.length<30)return p();let r=t.toLowerCase(),o="";for(let u of dr)if(r.includes(u)){o=u;break}if(!o)return p();c("antipattern-detector",`Implementation keyword detected: ${o}`);let i=fr(t),s=mr("best-practices",n),a=yr("best-practices");return c("antipattern-detector",`Suggesting antipattern check for: ${o} (category: ${i})`),{continue:!0,systemMessage:`[Antipattern Check] Before implementing ${o}, check for known failures:
\`mcp__mem0__search_memories\` with query="${o} failed" and filters={"AND":[{"user_id":"${s}"},{"metadata.outcome":"failed"}]}
Or check global: user_id="${a}"`}}import{existsSync as rt,readFileSync as ot}from"node:fs";import{join as it}from"node:path";var hr=["implement","add","create","build","set up","setup","configure","use","write","make","develop"],br=[{pattern:"offset pagination",warning:"Offset pagination causes performance issues on large tables. Use cursor-based pagination instead."},{pattern:"manual jwt validation",warning:"Manual JWT validation is error-prone. Use established libraries like python-jose or jsonwebtoken."},{pattern:"storing passwords in plaintext",warning:"Never store passwords in plaintext. Use bcrypt, argon2, or scrypt."},{pattern:"global state",warning:"Global mutable state causes testing and concurrency issues. Use dependency injection."},{pattern:"synchronous file operations",warning:"Synchronous file I/O blocks the event loop. Use async file operations."},{pattern:"n+1 query",warning:"N+1 queries cause performance problems. Use eager loading or batch queries."},{pattern:"polling for real-time",warning:"Polling is inefficient for real-time updates. Consider SSE or WebSocket."}];function kr(e){let t=e.toLowerCase();for(let n of hr)if(t.includes(n))return!0;return!1}function Sr(e){let t=e.toLowerCase();return/pagination|cursor|offset|page/i.test(t)?"pagination":/auth|jwt|oauth|login|session/i.test(t)?"authentication":/cache|redis|memo/i.test(t)?"caching":/database|sql|postgres|query/i.test(t)?"database":/api|endpoint|rest|graphql/i.test(t)?"api":"general"}function wr(e,t){let n=e.toLowerCase(),r=[];for(let{pattern:s,warning:a}of br)n.includes(s)&&r.push(a);let o=it(t,".claude","feedback","learned-patterns.json");if(rt(o))try{let a=(JSON.parse(ot(o,"utf8")).patterns||[]).filter(l=>l.outcome==="failed");for(let l of a)if(l.text){let g=l.text.toLowerCase().split(" ")[0];g&&n.includes(g)&&r.push(`Previously failed: ${l.text}`)}}catch{}let i=it(process.env.HOME||process.env.USERPROFILE||"",".claude","global-patterns.json");if(rt(i))try{let s=JSON.parse(ot(i,"utf8"));for(let{pattern:a,warning:l}of s.antipatterns||[])n.includes(a.toLowerCase())&&r.push(`${a}: ${l}`)}catch{}return r}function Tr(e,t){return`project:${t.split("/").pop()||"unknown"}:${e}`}function _r(e,t){let n=Sr(e),r=Tr("best-practices",t);return`Before implementing, search Mem0 for relevant patterns (graph memory enabled):

1. Project anti-patterns (category: ${n}):
   mcp__mem0__search_memories with:
   {"query": "${e.slice(0,50)}", "user_id": "${r}", "filters": {"metadata.outcome": "failed"}}

2. Project best practices:
   mcp__mem0__search_memories with:
   {"query": "${e.slice(0,50)}", "user_id": "${r}", "filters": {"metadata.outcome": "success"}}

3. Cross-project failures:
   mcp__mem0__search_memories with:
   {"query": "${e.slice(0,50)}", "user_id": "global:best-practices", "filters": {"metadata.outcome": "failed"}}`}function st(e){let t=e.prompt||"",n=e.project_dir||f();if(!t)return p();if(!kr(t))return p();c("antipattern-warning","Checking prompt for anti-patterns...");let r=wr(t,n),o=_r(t,n);if(r.length>0){c("antipattern-warning",`Found anti-pattern warnings: ${r.join(", ")}`);let i=`## Anti-Pattern Warning

The following patterns have previously caused issues:

${r.map(s=>`- ${s}`).join(`
`)}

Consider alternative approaches before proceeding.

${o}`;return b(i)}return/implement|build|create|develop/.test(t.toLowerCase())?b(o):p()}import{existsSync as xr}from"node:fs";import{join as vr}from"node:path";function at(e){let t=e.prompt||"",n=e.project_dir||f();c("context-injector",`User prompt received (${t.length} chars)`);let r=[];if(/issue|bug|fix|#[0-9]+/.test(t)){let o=vr(n,"docs","issues");xr(o)&&r.push("Check docs/issues/ for issue documentation.")}return/test|testing|pytest|jest/.test(t.toLowerCase())&&r.push("Remember to use 'tee' for visible test output."),/deploy|ci|cd|pipeline|github.actions/.test(t.toLowerCase())&&r.push("Check .github/workflows/ for CI configuration."),r.length>0&&c("context-injector",`Context hints: ${r.join(" ")}`),p()}import{existsSync as lt,readFileSync as Ir,writeFileSync as Rr,mkdirSync as Pr}from"node:fs";import{join as Cr}from"node:path";var ct=.7,Er=.95,Ar=8,$r=15,Dr=5;function Or(e){if(!e)return 0;let t=Date.now(),n;if(/^\d+$/.test(e))n=parseInt(e,10);else if(n=new Date(e).getTime(),isNaN(n))return 0;let r=(t-n)/(1e3*60);return r<=5?10:r<=15?8:r<=30?6:r<=60?4:r<=120?2:0}function jr(e){return e>=10?10:e>=7?8:e>=4?6:e>=2?4:e>=1?2:0}function Mr(e,t){if(e.length===0||t.length===0)return 2;let n=new Set(e.map(s=>s.toLowerCase())),r=new Set(t.map(s=>s.toLowerCase())),o=0;for(let s of n)r.has(s)&&o++;let i=o/n.size;return i>=.75?10:i>=.5?8:i>=.3?6:i>=.15?4:o>0?2:0}function Nr(e){let t=new Set(["the","and","for","with","from","that","this","have","will","can","should","would","could"]);return e.toLowerCase().match(/\b[a-z]{3,}\b/g)?.filter(n=>!t.has(n)).slice(0,20)||[]}function Lr(){return`/tmp/claude-context-tracking-${h()}.json`}function Hr(){let e=Lr();if(lt(e))try{return JSON.parse(Ir(e,"utf8"))}catch{}let n={session_id:h(),updated_at:new Date().toISOString(),total_context_tokens:0,context_budget:12e3,items:[]};return Rr(e,JSON.stringify(n,null,2)),n}function Fr(e){let t=process.env.CLAUDE_CONTEXT_USAGE_PERCENT;if(t){let n=parseFloat(t);if(!isNaN(n))return n}return e.context_budget>0?e.total_context_tokens/e.context_budget:0}function Ur(e,t){let n=[];for(let r of e.items){let o=r.last_accessed||r.loaded_at,i=r.access_count||0,s=r.tags||[],a=Or(o),l=jr(i),u=Mr(s,t),g=a+l+u;c("context-pruning-advisor",`Scored ${r.id}: R=${a} F=${l} V=${u} Total=${g}`),g<=$r&&n.push({score:g,priority:g<=Ar?"HIGH":"MED",itemId:r.id,tokens:r.estimated_tokens||500})}return n.sort((r,o)=>r.score-o.score).slice(0,Dr)}function Gr(e){let t=0,n=[];for(let r=0;r<e.length;r++){let{priority:o,itemId:i,score:s,tokens:a}=e[r];t+=a;let l=i.replace(/^(skill:|file:|agent:)/,"");n.push(`  ${r+1}. [${o}] ${l} (score: ${s}, saves ~${a}t)`)}return`Context usage >70%. Pruning recommendations:
${n.join(`
`)}

Potential savings: ~${t} tokens
To prune: Archive or unload low-scoring context items.`}function ut(e){let t=e.project_dir||f(),n=e.prompt||"",r=Cr(t,"logs");if(!lt(r))try{Pr(r,{recursive:!0})}catch{}let o=Hr(),i=Fr(o);if(c("context-pruning-advisor",`Context usage: ${i} (trigger threshold: ${ct})`),i<ct)return c("context-pruning-advisor","Context usage within limits, no pruning needed"),p();if(i>=Er){c("context-pruning-advisor",`CRITICAL: Context usage at ${i*100}% (>95%)`);let l=`CRITICAL: Context usage at ${Math.round(i*100)}% (>95%). Use /ork:context-compression immediately or manually archive old decisions and patterns.`;return b(l)}if(!n)return c("context-pruning-advisor","No user prompt found in hook input, skipping analysis"),p();let s=Nr(n);c("context-pruning-advisor",`Extracted prompt keywords: ${s.join(", ")}`);let a=Ur(o,s);if(a.length>0){let l=Gr(a);return c("context-pruning-advisor",`Recommending ${a.length} pruning candidates`),b(l)}return p()}import{existsSync as qr,readFileSync as zr}from"node:fs";import{join as Wr}from"node:path";var Br=["add","implement","create","build","design","refactor","update","modify","fix","change","continue","resume","remember","previous","last time","before","earlier","pattern","decision","how did we","what did we"],Kr=["relationship","related","connected","depends","uses","recommends","what does.*recommend","how does.*work with"],Jr=20;function Vr(e){let t=e.toLowerCase();for(let n of Br)if(t.includes(n))return!0;return!1}function Xr(e){let t=e.toLowerCase();for(let n of Kr)if(new RegExp(n,"i").test(t))return!0;return!1}function Yr(e){let t=new Set(["the","a","an","to","for","in","on","at","is","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","can","may","might","must","shall","i","you","we","they","it","this","that","these","those","my","your","our","their","its","and","or","but","if","then","else","when","where","how","what","which","who","whom","with","from","into","onto","about","after","before","global"]);return e.toLowerCase().replace(/[^a-z\s]/g," ").split(/\s+/).filter(r=>r.length>2&&!t.has(r)).slice(0,5).join(" ")}function Qr(e,t){return`project:${t.split("/").pop()||"unknown"}:${e}`}function Zr(e){let t=process.env.CLAUDE_AGENT_ID;if(t)return t;let n=Wr(e,".claude","session","current-agent-id");if(qr(n))try{return zr(n,"utf8").trim()}catch{}return""}function pt(e){let t=e.prompt||"",n=e.project_dir||f(),r=!1;if(c("memory-context",`Memory context hook starting (graph-first, mem0=${r})`),t.length<Jr)return c("memory-context",`Prompt too short (${t.length} chars), skipping memory search`),p();let o=t.startsWith("@global")||t.includes("cross-project")||t.includes("all projects"),i=Xr(t);o&&c("memory-context","Detected @global prefix - will suggest cross-project search"),i&&c("memory-context","Detected graph-related query");let s=Zr(n);if(s&&c("memory-context",`Agent context detected: ${s}`),!Vr(t))return c("memory-context","No memory trigger keywords found, skipping"),p();let a=Yr(t);if(!a)return c("memory-context","No search terms extracted, skipping"),p();c("memory-context",`Search terms: ${a}`);let l=o?"cross-project":"project",u=Qr("decisions",n),g=`[Memory Context] For relevant past ${l} decisions, use mcp__memory__search_nodes with query="${a}"`;return i&&(g+=" | For relationships: mcp__memory__open_nodes on found entities | Graph traversal available"),r&&u&&(g+=` | [Enhanced] For semantic search: mcp__mem0__search_memories query="${a}" user_id="${u}" enable_graph=true`,o||(g+=' | Cross-project: user_id="global:best-practices"')),s&&(g+=` | Agent context: ${s}`),c("memory-context",`Memory context available for: ${a}`),b(g)}import{existsSync as lo,appendFileSync as uo,mkdirSync as po,readFileSync as Uc}from"node:fs";import{existsSync as eo,readFileSync as to,writeFileSync as Oc,mkdirSync as jc}from"node:fs";import{execSync as gt}from"node:child_process";import{createHash as no}from"node:crypto";import*as dt from"node:os";var ro=".claude/.user_identity.json",oo="orchestkit-user-identity-v1",io={share_with_team:!0,share_globally:!1,share_decisions:!0,share_preferences:!0,share_skill_usage:!1,share_prompts:!1,anonymize_globally:!0},_=null,K=null;function J(e){return no("sha256").update(e+oo).digest("hex").slice(0,16)}function so(){try{return dt.hostname()}catch{return"unknown-machine"}}function ft(e){let t=`${e}/${ro}`;if(!eo(t))return null;try{let n=to(t,"utf8");return JSON.parse(n)}catch(n){return c("user-identity",`Failed to read user config: ${n}`,"warn"),null}}function ao(e){let t={};try{t.email=gt("git config user.email",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{}try{t.name=gt("git config user.name",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{}return t}function co(){return{username:process.env.USER||process.env.USERNAME||process.env.LOGNAME}}function H(e){if(_)return _;let t=e||f(),n=so(),r=ft(t);if(r?.user_id)return _={user_id:r.user_id,display_name:r.display_name||r.user_id,team_id:r.team_id,machine_id:n,source:"config",anonymous_id:J(r.user_id),email:r.user_id.includes("@")?r.user_id:void 0},c("user-identity",`Resolved from config: ${_.user_id}`,"debug"),_;let o=ao(t);if(o.email)return _={user_id:o.email,display_name:o.name||o.email.split("@")[0],team_id:r?.team_id,machine_id:n,source:"git",anonymous_id:J(o.email),email:o.email},c("user-identity",`Resolved from git: ${_.user_id}`,"debug"),_;let i=co();if(i.username){let a=`${i.username}@${n}`;return _={user_id:a,display_name:i.username,team_id:r?.team_id,machine_id:n,source:"env",anonymous_id:J(a)},c("user-identity",`Resolved from env: ${_.user_id}`,"debug"),_}let s=J(n+process.pid);return _={user_id:`anon-${s.slice(0,8)}`,display_name:"Anonymous",team_id:r?.team_id,machine_id:n,source:"anonymous",anonymous_id:s},c("user-identity",`Resolved as anonymous: ${_.user_id}`,"debug"),_}function mt(e){if(K)return K;let t=e||f(),n=ft(t);return K={...io,...n?.privacy},K}function ie(e,t){let n=mt();if(t==="team"&&!n.share_with_team||t==="global"&&!n.share_globally)return!1;switch(e){case"decisions":return n.share_decisions;case"preferences":return n.share_preferences;case"skill_usage":return n.share_skill_usage;case"prompts":return n.share_prompts;default:return!1}}function yt(e){let t=H(),n=mt();return e==="global"&&n.anonymize_globally?t.anonymous_id:t.user_id}function V(){let e=H();return{session_id:h(),user_id:e.user_id,anonymous_id:e.anonymous_id,team_id:e.team_id,machine_id:e.machine_id,identity_source:e.source,timestamp:new Date().toISOString()}}function ht(e){return`${(f().split("/").pop()||"unknown").toLowerCase().replace(/[^a-z0-9-]/g,"-")}-${e}`}function bt(e){return`orchestkit-global-${e}`}var go=/^[a-zA-Z0-9_-]{1,128}$/;function fo(e){return go.test(e)}function St(e,t){let n=e||h(),r=t||f();if(!fo(n))throw new Error("Invalid session ID format");return`${r}/.claude/memory/sessions/${n}`}function mo(e,t){return`${St(e,t)}/events.jsonl`}function yo(e,t){let n=St(e,t);lo(n)||po(n,{recursive:!0})}var kt=0;function ho(){return kt++,`evt-${Date.now()}-${kt}`}function M(e,t,n={}){try{let r={event_id:ho(),event_type:e,identity:V(),payload:{name:t,input:se(n.input),output:se(n.output),duration_ms:n.duration_ms,success:n.success??!0,context:n.context?vt(n.context,500):void 0,confidence:n.confidence}};yo();let o=mo();uo(o,JSON.stringify(r)+`
`),c("session-tracker",`Tracked ${e}: ${t}`,"debug")}catch(r){c("session-tracker",`Failed to track event: ${r}`,"warn")}}function wt(e,t,n){M("decision_made","decision",{context:e,input:t?{rationale:t}:void 0,confidence:n,success:!0})}function Tt(e,t){M("preference_stated","preference",{context:e,confidence:t,success:!0})}function _t(e){M("problem_reported","problem",{context:e,success:!0})}function xt(e){M("communication_style_detected","communication",{input:e,success:!0})}function vt(e,t){return e.length<=t?e:e.slice(0,t-3)+"..."}function se(e){if(!e)return;let t={},n=["password","secret","token","key","credential","auth"];for(let[r,o]of Object.entries(e)){if(n.some(i=>r.toLowerCase().includes(i))){t[r]="[REDACTED]";continue}if(typeof o=="string"&&o.length>500){t[r]=vt(o,500);continue}if(typeof o=="object"&&o!==null&&!Array.isArray(o)){t[r]=se(o);continue}t[r]=o}return t}import{existsSync as ae,readFileSync as bo,writeFileSync as ko,appendFileSync as So,mkdirSync as It}from"node:fs";import{join as ce,dirname as wo}from"node:path";var To=2,_o=[/\bthank/i,/\bgreat\b/i,/\bperfect\b/i,/\bexcellent\b/i,/\bawesome\b/i,/\bworks?\b.*\b(well|great|perfectly)/i,/\bthat('s| is) (exactly|just) what/i,/\bnice\b/i,/\bgood job\b/i,/\bwell done\b/i,/\blooks? good\b/i,/\blgtm\b/i,/\bship it\b/i],xo=[/\bno(t| ).*right/i,/\bwrong\b/i,/\bdoesn't work/i,/\bbroken\b/i,/\bfailed\b/i,/\btry again\b/i,/\bstart over\b/i,/\bundo\b/i,/\brevert\b/i,/\bfrustrat/i,/\bannoy/i,/\bconfus/i,/\bstill (not|doesn't)/i,/\bdidn't (work|help)/i,/\bthat's not/i];function vo(e){for(let t of _o)if(t.test(e))return"positive";for(let t of xo)if(t.test(e))return"negative";return"neutral"}function Io(e){return ce(e,".claude",".satisfaction-counter")}function Ro(e){let t=Io(e),n=wo(t);if(!ae(n))try{It(n,{recursive:!0})}catch{}let r=0;if(ae(t))try{r=parseInt(bo(t,"utf8").trim(),10)||0}catch{}r++;try{ko(t,String(r))}catch{}return r}function Po(e,t,n,r){let o=ce(r,".claude","feedback"),i=ce(o,"satisfaction.log");if(!ae(o))try{It(o,{recursive:!0})}catch{return}let a=`${new Date().toISOString()} | ${e} | ${t} | ${n}
`;try{So(i,a)}catch{}}function Rt(e){let t=e.prompt||"",n=e.project_dir||f(),r=e.session_id||h(),o=parseInt(process.env.SATISFACTION_SAMPLE_RATE||"3",10),i=Ro(n);if(o>1&&i%o!==0)return p();if(c("satisfaction-detector",`Satisfaction detector hook starting (sample ${i})`),!t)return p();if(t.length<To)return p();if(t.startsWith("/"))return p();let s=vo(t);if(s!=="neutral"){let a=t.slice(0,50);t.length>50&&(a+="..."),Po(r,s,a,n);try{M("preference_stated",s,{context:a,success:!0})}catch{}c("satisfaction-detector",`Detected ${s} satisfaction signal`)}return p()}var Co=[/implement/i,/refactor/i,/add feature/i,/create.*component/i,/build.*system/i,/fix.*multiple/i,/update.*across/i,/migrate/i],Eo=500;function Pt(e){let t=e.prompt||"",n=t.length;c("todo-enforcer",`Prompt length: ${n} chars`);let r=!1;for(let o of Co)if(o.test(t)){r=!0;break}return n>Eo&&(r=!0),r&&c("todo-enforcer","Complex task detected - todo tracking recommended"),p()}var Ao=2;function $o(e){if(e.length===0)return"";let t=e[0],n="";if(t.confidence>=T.AUTO_DISPATCH?n=`## \u{1F3AF} AGENT DISPATCH RECOMMENDED

**Agent:** \`${t.agent}\` (${t.confidence}% confidence)

This task strongly matches the agent's specialization. **Spawn this agent:**

\`\`\`
Task tool with subagent_type: "${t.agent}"
\`\`\`

Matched: ${t.matchedKeywords.slice(0,5).join(", ")}`:t.confidence>=T.STRONG_RECOMMEND?n=`## Agent Recommendation

**RECOMMENDED:** \`${t.agent}\` (${t.confidence}% match)
${t.description}

Matched keywords: ${t.matchedKeywords.slice(0,4).join(", ")}

Consider spawning with: \`Task tool, subagent_type: "${t.agent}"\``:t.confidence>=T.SUGGEST&&(n=`## Agent Suggestion

**Consider:** \`${t.agent}\` (${t.confidence}% match)

This agent specializes in: ${t.matchedKeywords.slice(0,3).join(", ")}`),e.length>1&&e[1].confidence>=T.SUGGEST){let r=e[1];n+=`

**Alternative:** \`${r.agent}\` (${r.confidence}% match)`}return n}function Ct(e){let t=e.prompt||"";if(!O(t))return p();if(P().enableAutoDispatch)return c("agent-auto-suggest","Deferring to agent-orchestrator (auto-dispatch enabled)"),p();c("agent-auto-suggest","Analyzing prompt with intent classifier...");let r=B(),o=Xe(),s=D(t,r,o).agents.slice(0,Ao);if(s.length===0)return c("agent-auto-suggest","No agent matches found"),p();c("agent-auto-suggest",`Found matches: ${s.map(l=>`${l.agent}:${l.confidence}`).join(", ")}`);let a=$o(s);return a?(c("agent-auto-suggest",`Suggesting ${s[0].agent} at ${s[0].confidence}%`),b(a)):p()}function Do(e,t){return`## \u{1F3AF} AUTO-DISPATCH: ${e.agent}

**Confidence:** ${e.confidence}% (auto-dispatch threshold: ${T.AUTO_DISPATCH}%)

This task strongly matches the agent's specialization. **IMMEDIATELY spawn this agent:**

\`\`\`
Task tool with subagent_type: "${e.agent}"
\`\`\`

**Matched Keywords:** ${e.matchedKeywords.slice(0,5).join(", ")}

### CC 2.1.16 Task Instruction
Before spawning, create a task to track this work:

\`\`\`json
TaskCreate:
{
  "subject": "${e.agent.replace(/-/g," ")} implementation",
  "description": "Agent dispatched automatically at ${e.confidence}% confidence",
  "activeForm": "Working on ${e.description.toLowerCase()}",
  "metadata": ${JSON.stringify(t)}
}
\`\`\`

After creating the task, spawn the agent with the task ID in the prompt.`}function Oo(e){return`## Agent Recommendation

**RECOMMENDED:** \`${e.agent}\` (${e.confidence}% confidence)

${e.description}

**Matched:** ${e.matchedKeywords.slice(0,4).join(", ")}

**Spawn with:**
\`\`\`
Task tool with subagent_type: "${e.agent}"
\`\`\``}function jo(e){return`## Agent Suggestion

**Consider:** \`${e.agent}\` (${e.confidence}% match)

This agent specializes in: ${e.matchedKeywords.slice(0,3).join(", ")}`}function Mo(e){return`

**Alternative:** \`${e.agent}\` (${e.confidence}% match)`}function No(e,t){if(e.agents.length===0)return"";let n=e.agents[0],r="";if(Oe(n.agent))return c("agent-orchestrator",`Agent ${n.agent} already dispatched, skipping`),"";if(t.enableAutoDispatch&&n.confidence>=T.AUTO_DISPATCH){let o={source:"orchestration",dispatchedAgent:n.agent,dispatchConfidence:n.confidence,relatedSkills:e.skills.slice(0,3).map(i=>i.skill),dispatchSignals:n.signals.slice(0,5)};De(n.agent,n.confidence),r=Do(n,o)}else n.confidence>=T.STRONG_RECOMMEND?r=Oo(n):n.confidence>=T.SUGGEST&&(r=jo(n));return e.agents.length>1&&e.agents[1].confidence>=T.SUGGEST&&(r+=Mo(e.agents[1])),r}function Et(e){let t=e.prompt||"";if(!O(t))return p();c("agent-orchestrator","Classifying intent for orchestration...");let n=P(),r=B(),o=D(t,r);if(Le(o),Ne(t.slice(0,500)),c("agent-orchestrator",`Classification: intent=${o.intent}, agents=[${o.agents.map(s=>`${s.agent}:${s.confidence}`).join(", ")}], autoDispatch=${o.shouldAutoDispatch}`),o.agents.length===0)return c("agent-orchestrator","No agent matches found"),p();let i=No(o,n);return i?b(i):p()}var Lo=15,Ho=["what is","explain","how does","tell me about","describe","list","show me"];function Fo(e){let t=e.toLowerCase();for(let n of Ho)if(t.startsWith(n))return!0;return!!(e.endsWith("?")&&e.length<100)}function Uo(){let e=ze();return e!==void 0&&e.status==="running"}function At(e){let t=e.prompt||"";if(t.length<Lo)return p();if(Fo(t))return p();if(!P().enablePipelines)return p();if(Uo())return c("pipeline-detector","Already in active pipeline, skipping detection"),p();c("pipeline-detector","Checking for pipeline triggers...");let r=Qe(t);if(!r)return c("pipeline-detector","No pipeline triggers detected"),p();c("pipeline-detector",`Detected pipeline: ${r.type}`);let{execution:o,tasks:i}=Ze(r);et(o,i);let s=tt(r,o,i);return c("pipeline-detector",`Created pipeline ${o.pipelineId} with ${i.length} steps`),b(s)}import{existsSync as le,readFileSync as ue}from"node:fs";import{join as pe}from"node:path";var Go=3;var qo=[["api","api-design-framework",80],["endpoint","api-design-framework",70],["rest","api-design-framework",75],["graphql","api-design-framework",75],["route","api-design-framework",60],["fastapi","fastapi-advanced",90],["uvicorn","fastapi-advanced",70],["starlette","fastapi-advanced",60],["middleware","fastapi-advanced",50],["pydantic","fastapi-advanced",60],["database","database-schema-designer",80],["schema","database-schema-designer",70],["table","database-schema-designer",50],["migration","alembic-migrations",85],["alembic","alembic-migrations",95],["sql","database-schema-designer",60],["postgres","database-schema-designer",70],["query","database-schema-designer",40],["index","database-schema-designer",50],["sqlalchemy","sqlalchemy-2-async",85],["async.*database","sqlalchemy-2-async",80],["orm","sqlalchemy-2-async",60],["connection.*pool","connection-pooling",90],["pool","connection-pooling",60],["pgvector","pgvector-search",95],["vector.*search","pgvector-search",85],["embedding","embeddings",80],["auth","auth-patterns",85],["login","auth-patterns",75],["jwt","auth-patterns",80],["oauth","auth-patterns",85],["passkey","auth-patterns",90],["webauthn","auth-patterns",90],["session","auth-patterns",60],["password","auth-patterns",70],["security","owasp-top-10",75],["owasp","owasp-top-10",95],["xss","owasp-top-10",80],["injection","owasp-top-10",80],["csrf","owasp-top-10",80],["validation","input-validation",70],["sanitiz","input-validation",80],["defense.*depth","defense-in-depth",95],["test","integration-testing",60],["unit.*test","pytest-advanced",80],["pytest","pytest-advanced",90],["integration.*test","integration-testing",85],["e2e","e2e-testing",90],["playwright","e2e-testing",80],["mock","msw-mocking",75],["msw","msw-mocking",95],["fixture","test-data-management",80],["test.*data","test-data-management",85],["coverage","pytest-advanced",60],["property.*test","property-based-testing",90],["hypothesis","property-based-testing",95],["contract.*test","contract-testing",95],["pact","contract-testing",95],["golden.*dataset","golden-dataset-validation",90],["performance.*test","performance-testing",90],["load.*test","performance-testing",85],["k6","performance-testing",95],["locust","performance-testing",95],["react","react-server-components-framework",70],["component","react-server-components-framework",50],["server.*component","react-server-components-framework",95],["nextjs","react-server-components-framework",85],["next\\.js","react-server-components-framework",85],["suspense","react-server-components-framework",70],["streaming.*ssr","react-server-components-framework",90],["form","form-state-patterns",70],["react.*hook.*form","form-state-patterns",95],["zod","form-state-patterns",60],["zustand","zustand-patterns",95],["state.*management","zustand-patterns",70],["tanstack","tanstack-query-advanced",90],["react.*query","tanstack-query-advanced",85],["radix","radix-primitives",95],["shadcn","radix-primitives",80],["tailwind","design-system-starter",60],["design.*system","design-system-starter",85],["animation","motion-animation-patterns",80],["framer","motion-animation-patterns",90],["core.*web.*vital","core-web-vitals",95],["lcp","core-web-vitals",80],["cls","core-web-vitals",80],["inp","core-web-vitals",80],["i18n","i18n-date-patterns",90],["internationalization","i18n-date-patterns",95],["locale","i18n-date-patterns",70],["accessibility","a11y-testing",85],["a11y","a11y-testing",95],["wcag","a11y-testing",95],["screen.*reader","focus-management",80],["keyboard.*nav","focus-management",90],["focus","focus-management",60],["aria","focus-management",70],["llm","function-calling",70],["openai","function-calling",60],["anthropic","function-calling",60],["function.*call","function-calling",90],["tool.*use","function-calling",85],["stream","llm-streaming",70],["rag","rag-retrieval",95],["retrieval","rag-retrieval",75],["context","contextual-retrieval",60],["chunk","embeddings",70],["vector","embeddings",75],["semantic.*search","embeddings",85],["langfuse","langfuse-observability",95],["llm.*observ","langfuse-observability",90],["langgraph","langgraph-state",85],["agent","agent-loops",70],["workflow","langgraph-state",60],["supervisor","langgraph-supervisor",90],["human.*in.*loop","langgraph-human-in-loop",95],["checkpoint","langgraph-checkpoints",90],["prompt.*cache","prompt-caching",95],["cache.*llm","semantic-caching",85],["eval","llm-evaluation",70],["llm.*test","llm-testing",85],["ollama","ollama-local",95],["deploy","devops-deployment",75],["ci","devops-deployment",60],["cd","devops-deployment",60],["github.*action","github-operations",85],["release","release-management",80],["changelog","release-management",70],["version","release-management",50],["observ","observability-monitoring",80],["monitor","observability-monitoring",70],["log","observability-monitoring",50],["metric","observability-monitoring",60],["trace","observability-monitoring",70],["alert","observability-monitoring",60],["git","git-workflow",70],["branch","git-workflow",60],["commit","commit",80],["rebase","git-workflow",70],["stacked.*pr","stacked-prs",95],["pr","create-pr",60],["pull.*request","create-pr",75],["recovery","git-recovery-command",80],["reflog","git-recovery-command",95],["milestone","github-operations",80],["issue","github-operations",50],["event.*sourc","event-sourcing",95],["kafka","message-queues",85],["rabbitmq","message-queues",85],["queue","message-queues",75],["pub.*sub","message-queues",80],["outbox","outbox-pattern",95],["saga","event-sourcing",70],["cqrs","event-sourcing",80],["async","asyncio-advanced",70],["asyncio","asyncio-advanced",90],["taskgroup","asyncio-advanced",95],["concurrent","asyncio-advanced",60],["background.*job","background-jobs",90],["celery","background-jobs",95],["worker","background-jobs",60],["distributed.*lock","distributed-locks",95],["redis.*lock","distributed-locks",85],["idempoten","idempotency-patterns",95],["clean.*architecture","clean-architecture",95],["ddd","domain-driven-design",95],["domain.*driven","domain-driven-design",90],["aggregate","aggregate-patterns",90],["adr","architecture-decision-record",95],["decision.*record","architecture-decision-record",85],["lint","biome-linting",70],["biome","biome-linting",95],["eslint","biome-linting",60],["format","biome-linting",50],["code.*review","code-review-playbook",90],["review","code-review-playbook",60],["quality.*gate","quality-gates",90],["error.*handl","error-handling-rfc9457",85],["rfc.*9457","error-handling-rfc9457",95],["problem.*detail","error-handling-rfc9457",90]];function $t(e){let t=e.toLowerCase(),n=new Map;for(let[o,i,s]of qo)if(new RegExp(o,"i").test(t)){let l=n.get(i)||0;s>l&&n.set(i,s)}return Array.from(n.entries()).map(([o,i])=>({skill:o,confidence:i})).sort((o,i)=>i.confidence-o.confidence).slice(0,Go)}var zo=800,Dt=2,Ot=3,jt=80,Mt=70,Wo=50;function Bo(e,t){let n=C(),r=pe(n,"skills",e,"SKILL.md");if(!le(r))return c("skill-resolver","Skill file not found: "+r),null;try{let o=ue(r,"utf8"),i=o.match(/^---\n[\s\S]*?\n---\n/);i&&(o=o.slice(i[0].length)),o=o.replace(/^## References[\s\S]*?(?=^## |\Z)/gm,""),o=o.replace(/```[\s\S]*?```/g,a=>{let l=a.split(`
`);return l.length>12?l.slice(0,7).join(`
`)+"\n# ... truncated\n```":a}),o=o.replace(/\n{3,}/g,`

`),o=o.trim();let s=Math.floor(t*3.5);if(o.length>s){let a=o.slice(0,s),l=a.lastIndexOf(`

`);l>s*.6?o=a.slice(0,l)+`

[... truncated for context budget]`:o=a+`

[... truncated for context budget]`}return o}catch(o){return c("skill-resolver","Failed to load skill: "+String(o)),null}}function Ko(e){let t=C(),n=pe(t,"skills",e,"SKILL.md");if(!le(n))return"";try{let o=ue(n,"utf8").match(/^---\n([\s\S]*?)\n---/);if(o){let i=o[1].match(/^description:\s*(.+)$/m);if(i)return i[1].trim()}}catch{}return""}function Jo(e){let t=C(),n=pe(t,"skills",e,"SKILL.md");if(!le(n))return[];try{let r=ue(n,"utf8"),o=[],i=r.match(/^## .+$/gm)||[];for(let s of i.slice(0,3)){let a=s.replace(/^## /,"").trim();a&&a!=="References"&&a.length<80&&o.push(a)}return o.slice(0,3)}catch{return[]}}function Vo(e){return e.length===0?"":`## Skill Hints

`+e.map(n=>"- **"+n.skill+"** \u2014 Use `/ork:"+n.skill+"` to load").join(`
`)}function Xo(e){if(e.length===0)return"";let t=`## Relevant Skills

`;for(let{skill:n,confidence:r}of e){let o=Ko(n),i=Jo(n);t+="### "+n+" ("+r+`% match)
`,o&&(t+=o+`
`),i.length>0&&(t+=i.map(s=>"- "+s).join(`
`)+`
`),t+="Use `/ork:"+n+`\` to load full content.

`}return t.trim()}function Yo(e){if(e.length===0)return"";let t=`## Skill Knowledge Injected

Auto-loaded based on your prompt:

`;for(let{skill:n,content:r}of e)t+="### "+n+`

`+r+`

---

`;return t.trim()}function Nt(e){let t=e.prompt||"";if(!t||!O(t))return p();let n=P();c("skill-resolver","Analyzing prompt for skill resolution...");let r=He();r||(r=D(t));let o=$t(t),i=Qo(r.skills,o);if(i.length===0)return c("skill-resolver","No skill matches found"),p();c("skill-resolver","Found "+i.length+" skills: "+i.map(d=>d.skill+":"+d.confidence).join(", "));let s=i.filter(d=>d.confidence>=jt),a=i.filter(d=>d.confidence>=Mt&&d.confidence<jt),l=i.filter(d=>d.confidence>=Wo&&d.confidence<Mt),u=[];if(s.length>0&&n.enableSkillInjection){let d=n.maxSkillInjectionTokens||zo,m=Math.min(s.length,Dt),y=Math.floor(d/m),x=[],R=0;for(let v of s.slice(0,Dt)){if(Me(v.skill))continue;let S=d-R;if(S<100)break;let w=Bo(v.skill,Math.min(y,S));if(w){let k=U(w);R+=k,x.push({skill:v.skill,content:w}),je(v.skill),c("skill-resolver","Full inject: "+v.skill+" (~"+k+"t)")}}x.length>0&&u.push(Yo(x))}if(a.length>0){let d=a.slice(0,Ot);u.push(Xo(d)),c("skill-resolver","Summary: "+d.map(m=>m.skill).join(", "))}if(l.length>0){let d=l.slice(0,Ot);u.push(Vo(d)),c("skill-resolver","Hints: "+d.map(m=>m.skill).join(", "))}if(u.length===0)return p();let g=u.join(`

`);return c("skill-resolver","Outputting "+u.length+" tiers (~"+U(g)+"t)"),b(g)}function Qo(e,t){let n=new Map;for(let r of e){let o=n.get(r.skill)||0;r.confidence>o&&n.set(r.skill,r.confidence)}for(let r of t){let o=n.get(r.skill)||0;r.confidence>o&&n.set(r.skill,r.confidence)}return Array.from(n.entries()).map(([r,o])=>({skill:r,confidence:o})).sort((r,o)=>o.confidence-r.confidence)}var Lt={postgresql:{canonical:"postgresql",aliases:["postgres","pg","psql"],category:"database",entityType:"Technology",description:"PostgreSQL relational database"},pgvector:{canonical:"pgvector",aliases:["pg-vector"],category:"database",entityType:"Technology",description:"PostgreSQL vector extension"},redis:{canonical:"redis",aliases:["redis-cache"],category:"database",entityType:"Technology",description:"Redis in-memory data store"},mongodb:{canonical:"mongodb",aliases:["mongo"],category:"database",entityType:"Technology",description:"MongoDB document database"},sqlite:{canonical:"sqlite",aliases:["sqlite3"],category:"database",entityType:"Technology",description:"SQLite embedded database"},mysql:{canonical:"mysql",aliases:["mariadb"],category:"database",entityType:"Technology",description:"MySQL relational database"},dynamodb:{canonical:"dynamodb",aliases:["dynamo"],category:"database",entityType:"Technology",description:"AWS DynamoDB NoSQL database"},fastapi:{canonical:"fastapi",aliases:["fast-api"],category:"backend",entityType:"Technology",description:"FastAPI Python web framework"},django:{canonical:"django",aliases:["django-rest"],category:"backend",entityType:"Technology",description:"Django Python web framework"},flask:{canonical:"flask",aliases:[],category:"backend",entityType:"Technology",description:"Flask Python microframework"},express:{canonical:"express",aliases:["expressjs","express.js"],category:"backend",entityType:"Technology",description:"Express.js Node.js framework"},nextjs:{canonical:"nextjs",aliases:["next.js","next"],category:"backend",entityType:"Technology",description:"Next.js React framework"},nest:{canonical:"nest",aliases:["nestjs","nest.js"],category:"backend",entityType:"Technology",description:"NestJS Node.js framework"},spring:{canonical:"spring",aliases:["spring-boot","springboot"],category:"backend",entityType:"Technology",description:"Spring Java framework"},rails:{canonical:"rails",aliases:["ruby-on-rails","ror"],category:"backend",entityType:"Technology",description:"Ruby on Rails framework"},react:{canonical:"react",aliases:["reactjs","react.js"],category:"frontend",entityType:"Technology",description:"React UI library"},vue:{canonical:"vue",aliases:["vuejs","vue.js"],category:"frontend",entityType:"Technology",description:"Vue.js framework"},angular:{canonical:"angular",aliases:["angularjs"],category:"frontend",entityType:"Technology",description:"Angular framework"},svelte:{canonical:"svelte",aliases:["sveltekit"],category:"frontend",entityType:"Technology",description:"Svelte framework"},solid:{canonical:"solid",aliases:["solidjs","solid.js"],category:"frontend",entityType:"Technology",description:"SolidJS framework"},qwik:{canonical:"qwik",aliases:[],category:"frontend",entityType:"Technology",description:"Qwik framework"},astro:{canonical:"astro",aliases:[],category:"frontend",entityType:"Technology",description:"Astro static site builder"},typescript:{canonical:"typescript",aliases:["ts"],category:"language",entityType:"Technology",description:"TypeScript language"},python:{canonical:"python",aliases:["py","python3"],category:"language",entityType:"Technology",description:"Python language"},javascript:{canonical:"javascript",aliases:["js","ecmascript"],category:"language",entityType:"Technology",description:"JavaScript language"},rust:{canonical:"rust",aliases:["rustlang"],category:"language",entityType:"Technology",description:"Rust language"},go:{canonical:"go",aliases:["golang"],category:"language",entityType:"Technology",description:"Go language"},java:{canonical:"java",aliases:["jdk"],category:"language",entityType:"Technology",description:"Java language"},kotlin:{canonical:"kotlin",aliases:["kt"],category:"language",entityType:"Technology",description:"Kotlin language"},jwt:{canonical:"jwt",aliases:["json-web-token"],category:"auth",entityType:"Technology",description:"JSON Web Tokens"},oauth2:{canonical:"oauth2",aliases:["oauth","oidc"],category:"auth",entityType:"Technology",description:"OAuth 2.0 protocol"},passkeys:{canonical:"passkeys",aliases:["webauthn","fido2"],category:"auth",entityType:"Technology",description:"Passkeys authentication"},saml:{canonical:"saml",aliases:["saml2"],category:"auth",entityType:"Technology",description:"SAML authentication"},langchain:{canonical:"langchain",aliases:["lang-chain"],category:"ai-ml",entityType:"Technology",description:"LangChain LLM framework"},langgraph:{canonical:"langgraph",aliases:["lang-graph"],category:"ai-ml",entityType:"Technology",description:"LangGraph agent framework"},langfuse:{canonical:"langfuse",aliases:["lang-fuse"],category:"ai-ml",entityType:"Technology",description:"Langfuse LLM observability"},openai:{canonical:"openai",aliases:["gpt","chatgpt"],category:"ai-ml",entityType:"Technology",description:"OpenAI GPT models"},anthropic:{canonical:"anthropic",aliases:["claude"],category:"ai-ml",entityType:"Technology",description:"Anthropic Claude models"},llama:{canonical:"llama",aliases:["llama2","llama3"],category:"ai-ml",entityType:"Technology",description:"Meta Llama models"},docker:{canonical:"docker",aliases:["container"],category:"infrastructure",entityType:"Technology",description:"Docker containerization"},kubernetes:{canonical:"kubernetes",aliases:["k8s","kube"],category:"infrastructure",entityType:"Technology",description:"Kubernetes orchestration"},terraform:{canonical:"terraform",aliases:["tf"],category:"infrastructure",entityType:"Technology",description:"Terraform IaC"},aws:{canonical:"aws",aliases:["amazon-web-services"],category:"infrastructure",entityType:"Technology",description:"Amazon Web Services"},gcp:{canonical:"gcp",aliases:["google-cloud","google-cloud-platform"],category:"infrastructure",entityType:"Technology",description:"Google Cloud Platform"},azure:{canonical:"azure",aliases:["microsoft-azure"],category:"infrastructure",entityType:"Technology",description:"Microsoft Azure"},pytest:{canonical:"pytest",aliases:["py-test"],category:"testing",entityType:"Technology",description:"Python testing framework"},jest:{canonical:"jest",aliases:[],category:"testing",entityType:"Technology",description:"JavaScript testing framework"},vitest:{canonical:"vitest",aliases:["vite-test"],category:"testing",entityType:"Technology",description:"Vite-native test framework"},playwright:{canonical:"playwright",aliases:[],category:"testing",entityType:"Technology",description:"Playwright E2E testing"},cypress:{canonical:"cypress",aliases:[],category:"testing",entityType:"Technology",description:"Cypress E2E testing"},msw:{canonical:"msw",aliases:["mock-service-worker"],category:"testing",entityType:"Technology",description:"Mock Service Worker"},webpack:{canonical:"webpack",aliases:[],category:"build-tool",entityType:"Technology",description:"Webpack bundler"},vite:{canonical:"vite",aliases:["vitejs"],category:"build-tool",entityType:"Technology",description:"Vite build tool"},esbuild:{canonical:"esbuild",aliases:[],category:"build-tool",entityType:"Technology",description:"esbuild bundler"},turbopack:{canonical:"turbopack",aliases:[],category:"build-tool",entityType:"Technology",description:"Turbopack bundler"},bun:{canonical:"bun",aliases:["bunjs"],category:"build-tool",entityType:"Technology",description:"Bun runtime"}},Ht={"cursor-pagination":{canonical:"cursor-pagination",variants:["cursor pagination","cursor_pagination"],category:"pagination-pattern",entityType:"Pattern",description:"Cursor-based pagination pattern"},"offset-pagination":{canonical:"offset-pagination",variants:["offset pagination","offset_pagination"],category:"pagination-pattern",entityType:"Pattern",description:"Offset-based pagination pattern"},"keyset-pagination":{canonical:"keyset-pagination",variants:["keyset pagination","keyset_pagination"],category:"pagination-pattern",entityType:"Pattern",description:"Keyset-based pagination pattern"},"repository-pattern":{canonical:"repository-pattern",variants:["repository pattern","repository_pattern"],category:"architecture-pattern",entityType:"Pattern",description:"Repository design pattern"},"service-layer":{canonical:"service-layer",variants:["service layer","service_layer"],category:"architecture-pattern",entityType:"Pattern",description:"Service layer pattern"},"clean-architecture":{canonical:"clean-architecture",variants:["clean architecture","clean_architecture"],category:"architecture-pattern",entityType:"Pattern",description:"Clean architecture pattern"},"dependency-injection":{canonical:"dependency-injection",variants:["dependency injection","di","dependency_injection"],category:"architecture-pattern",entityType:"Pattern",description:"Dependency injection pattern"},"event-sourcing":{canonical:"event-sourcing",variants:["event sourcing","event_sourcing"],category:"architecture-pattern",entityType:"Pattern",description:"Event sourcing pattern"},cqrs:{canonical:"cqrs",variants:["command-query-responsibility-segregation"],category:"architecture-pattern",entityType:"Pattern",description:"CQRS pattern"},"saga-pattern":{canonical:"saga-pattern",variants:["saga pattern","saga_pattern","saga"],category:"workflow-pattern",entityType:"Pattern",description:"Saga pattern for distributed transactions"},"circuit-breaker":{canonical:"circuit-breaker",variants:["circuit breaker","circuit_breaker"],category:"architecture-pattern",entityType:"Pattern",description:"Circuit breaker pattern"},"rate-limiting":{canonical:"rate-limiting",variants:["rate limiting","rate_limiting","throttling"],category:"api-pattern",entityType:"Pattern",description:"Rate limiting pattern"},"retry-pattern":{canonical:"retry-pattern",variants:["retry pattern","retry_pattern","retry"],category:"architecture-pattern",entityType:"Pattern",description:"Retry pattern"},"cache-aside":{canonical:"cache-aside",variants:["cache aside","cache_aside","lazy-loading"],category:"caching-pattern",entityType:"Pattern",description:"Cache-aside pattern"},"write-through":{canonical:"write-through",variants:["write through","write_through"],category:"caching-pattern",entityType:"Pattern",description:"Write-through cache pattern"},"read-through":{canonical:"read-through",variants:["read through","read_through"],category:"caching-pattern",entityType:"Pattern",description:"Read-through cache pattern"},rag:{canonical:"rag",variants:["retrieval-augmented-generation"],category:"workflow-pattern",entityType:"Pattern",description:"Retrieval-Augmented Generation"},"semantic-search":{canonical:"semantic-search",variants:["semantic search","semantic_search"],category:"workflow-pattern",entityType:"Pattern",description:"Semantic search pattern"},"vector-search":{canonical:"vector-search",variants:["vector search","vector_search"],category:"workflow-pattern",entityType:"Pattern",description:"Vector search pattern"},tdd:{canonical:"tdd",variants:["test-driven-development"],category:"workflow-pattern",entityType:"Pattern",description:"Test-Driven Development"},bdd:{canonical:"bdd",variants:["behavior-driven-development"],category:"workflow-pattern",entityType:"Pattern",description:"Behavior-Driven Development"},ddd:{canonical:"ddd",variants:["domain-driven-design"],category:"architecture-pattern",entityType:"Pattern",description:"Domain-Driven Design"},microservices:{canonical:"microservices",variants:["micro-services","micro_services"],category:"architecture-pattern",entityType:"Pattern",description:"Microservices architecture"},monolith:{canonical:"monolith",variants:["monolithic"],category:"architecture-pattern",entityType:"Pattern",description:"Monolithic architecture"},serverless:{canonical:"serverless",variants:["faas","function-as-a-service"],category:"deployment-pattern",entityType:"Pattern",description:"Serverless architecture"},rest:{canonical:"rest",variants:["restful","rest-api"],category:"api-pattern",entityType:"Pattern",description:"REST API pattern"},graphql:{canonical:"graphql",variants:["graph-ql"],category:"api-pattern",entityType:"Pattern",description:"GraphQL API pattern"},grpc:{canonical:"grpc",variants:["g-rpc"],category:"api-pattern",entityType:"Pattern",description:"gRPC protocol"},websocket:{canonical:"websocket",variants:["websockets","web-socket"],category:"api-pattern",entityType:"Pattern",description:"WebSocket protocol"},sse:{canonical:"sse",variants:["server-sent-events"],category:"api-pattern",entityType:"Pattern",description:"Server-Sent Events"}},Ft={grep:{canonical:"grep",aliases:["ripgrep","rg"],category:"cli-tool",entityType:"Tool",description:"Text search utility"},read:{canonical:"read",aliases:[],category:"cli-tool",entityType:"Tool",description:"Claude Code file reader"},write:{canonical:"write",aliases:[],category:"cli-tool",entityType:"Tool",description:"Claude Code file writer"},edit:{canonical:"edit",aliases:[],category:"cli-tool",entityType:"Tool",description:"Claude Code file editor"},glob:{canonical:"glob",aliases:[],category:"cli-tool",entityType:"Tool",description:"Claude Code file finder"},bash:{canonical:"bash",aliases:["shell","sh"],category:"cli-tool",entityType:"Tool",description:"Bash shell"},task:{canonical:"task",aliases:[],category:"cli-tool",entityType:"Tool",description:"Claude Code task management"},git:{canonical:"git",aliases:["git-cli"],category:"cli-tool",entityType:"Tool",description:"Version control system"},gh:{canonical:"gh",aliases:["github-cli"],category:"cli-tool",entityType:"Tool",description:"GitHub command line tool"},npm:{canonical:"npm",aliases:["node-package-manager"],category:"package-manager",entityType:"Tool",description:"Node.js package manager"},yarn:{canonical:"yarn",aliases:[],category:"package-manager",entityType:"Tool",description:"Yarn package manager"},pnpm:{canonical:"pnpm",aliases:[],category:"package-manager",entityType:"Tool",description:"pnpm package manager"},claude:{canonical:"claude",aliases:["claude-code","claude-cli"],category:"cli-tool",entityType:"Tool",description:"Claude Code CLI"},cursor:{canonical:"cursor",aliases:[],category:"cli-tool",entityType:"Tool",description:"Cursor code editor"},vscode:{canonical:"vscode",aliases:["vs-code","visual-studio-code"],category:"cli-tool",entityType:"Tool",description:"Visual Studio Code editor"},vim:{canonical:"vim",aliases:["vi"],category:"cli-tool",entityType:"Tool",description:"Terminal text editor"},neovim:{canonical:"neovim",aliases:["nvim","neo-vim"],category:"cli-tool",entityType:"Tool",description:"Modern vim fork"}};function Ut(e){let t=new Map;for(let n of Object.values(e)){t.set(n.canonical.toLowerCase(),n.canonical);for(let r of n.aliases)t.set(r.toLowerCase(),n.canonical)}return t}function Zo(e){let t=new Map;for(let n of Object.values(e)){t.set(n.canonical.toLowerCase(),n.canonical);for(let r of n.variants)t.set(r.toLowerCase(),n.canonical)}return t}var ei=Ut(Lt),ti=Ut(Ft),ni=Zo(Ht);function Gt(e){let t=e.toLowerCase();return ei.has(t)?"Technology":ni.has(t)?"Pattern":ti.has(t)?"Tool":null}function qt(){let e={};for(let t of Object.values(Lt)){e[t.canonical]=t.canonical;for(let n of t.aliases)e[n]=t.canonical}return e}function zt(){return Object.values(Ht).map(e=>e.canonical)}function Wt(){return Object.values(Ft).map(e=>e.canonical)}var ri=[/\b(let'?s use|let'?s go with|going with|will use|should use)\s+([^.,!?\n]+)/gi,/\b(decided on|decided to use|decided to go with|decided to)\s+([^.,!?\n]+)/gi,/\b(chose|choose|selected|opting for|picked)\s+([^.,!?\n]+)/gi,/\b(using)\s+([^.,!?\n]+)\s+for\s+/gi,/\b(chose|prefer|selected|going with)\s+([\w][\w\s-]*?)\s+over\s+([\w][\w\s-]*)/gi,/\b(chose|prefer|selected|going with)\s+([\w][\w\s-]*?)\s+instead of\s+([\w][\w\s-]*)/gi,/\b(implementing|implement)\s+([^.,!?\n]+?)\s+(?:approach|pattern|solution)/gi,/\b(?:the|our)\s+(?:approach|decision|choice)\s+is\s+([^.,!?\n]+)/gi,/\bI\s+(decided|chose)\s+([^.,!?\n]+)/gi],oi=[/\bi (prefer|like|always use|never use|want|favor)\s+([^.,!?\n]+)/gi,/\bi'd prefer\s+([^.,!?\n]+)/gi,/\b(my preference is|I'd rather|rather use)\s+([^.,!?\n]+)/gi,/\b(style should be|convention is|naming should)\s+([^.,!?\n]+)/gi,/\b(always|never)\s+(use|do|add|include)\s+([^.,!?\n]+)/gi,/\bdon't\s+(use|like|want)\s+([^.,!?\n]+)/gi],ii=[/\b(issue|problem|error|bug|doesn't work|isn't working|can't|failing|broken)\b[^.!?\n]*[.!?]?/gi,/\bthe (\w[\w\s-]*) (is broken|isn't working|fails|errors|crashes)/gi,/\b(getting|seeing|having)\s+(an error|errors|issues|problems)\s+(with|in|when)\s+([^.,!?\n]+)/gi,/\b(fails|failed|failing)\s+(to|when|with)\s+([^.,!?\n]+)/gi,/\b(not working|doesn't work|won't work)\s*([^.,!?\n]*)/gi,/\b(timeout|exception|crash|hang|freeze)\s+(in|with|when|on)\s+([^.,!?\n]+)/gi],si=[/\bhow do I\s+([^?.\n]+)/gi,/\bhow can I\s+([^?.\n]+)/gi,/\bhow to\s+([^?.\n]+)/gi,/\bwhat is\s+([^?.\n]+)/gi,/\bwhat are\s+([^?.\n]+)/gi,/\bwhat does\s+([^?.\n]+)/gi,/\bwhy does\s+([^?.\n]+)/gi,/\bwhy is\s+([^?.\n]+)/gi,/\bwhy do\s+([^?.\n]+)/gi,/\bcan you\s+(explain|show|help)\s+([^?.\n]+)/gi,/\bwhere (is|are|do|does|can)\s+([^?.\n]+)/gi,/\bwhen (should|do|does|can)\s+([^?.\n]+)/gi],ai=[/\bbecause\s+([^.,!?\n]+)/i,/\bsince\s+([^.,!?\n]+)/i,/\bdue to\s+([^.,!?\n]+)/i,/\bto avoid\s+([^.,!?\n]+)/i,/\bfor\s+(?:better|improved|faster|easier|simpler)\s+([^.,!?\n]+)/i,/\bso that\s+([^.,!?\n]+)/i,/\bin order to\s+([^.,!?\n]+)/i,/\bas it\s+([^.,!?\n]+)/i],ci=[/\b(?:must|need to|required|constraint|requirement)\s+([^.,!?\n]+)/gi,/\b(?:have to|has to)\s+([^.,!?\n]+)/gi,/\b(?:mandatory|essential)\s+([^.,!?\n]+)/gi],li=[/\b(?:tradeoff|trade-off|downside|drawback)\s*:?\s+([^.,!?\n]+)/gi,/\bbut\s+([^.,!?\n]+)/gi,/\bhowever\s+([^.,!?\n]+)/gi,/\balthough\s+([^.,!?\n]+)/gi,/\b(?:cost|limitation)\s+is\s+([^.,!?\n]+)/gi],ui=qt(),pi=Object.entries(ui).map(([e,t])=>{let n=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return[new RegExp(`\\b${n}\\b`,"i"),t]}),gi=zt(),di=Wt();function X(e){let t=new Set;for(let[n,r]of pi)n.test(e)&&t.add(r);for(let n of gi){let r=n.replace(/-/g,"[- ]?");new RegExp(`\\b${r}\\b`,"i").test(e)&&t.add(n)}for(let n of di)new RegExp(`\\b${n}\\b`,"i").test(e)&&t.add(n);return[...t]}function fi(e,t){let n=Math.max(0,t-50),r=Math.min(e.length,t+300),o=e.slice(n,r);for(let i of ai){let s=o.match(i);if(s&&s[1])return s[1].trim().slice(0,200)}}function mi(e,t){let n=Math.max(0,t-50),r=Math.min(e.length,t+400),o=e.slice(n,r),i=[];for(let s of ci){s.lastIndex=0;let a=o.matchAll(s);for(let l of a){let u=(l[1]||l[2]||"").trim().slice(0,200);u.length>5&&i.push(u)}}return[...new Set(i)].slice(0,5)}function yi(e,t){let n=Math.max(0,t-50),r=Math.min(e.length,t+400),o=e.slice(n,r),i=[];for(let s of li){s.lastIndex=0;let a=o.matchAll(s);for(let l of a){let u=(l[1]||l[2]||"").trim().slice(0,200);u.length>5&&i.push(u)}}return[...new Set(i)].slice(0,5)}function hi(e,t,n,r){let o=.5;return/\b(decided|chose|selected)\b/i.test(e)&&(o+=.2),t&&(o+=.15),n&&(o+=.1),r>=1&&(o+=.05),r>=2&&(o+=.05),e.length<20&&(o-=.1),Math.min(.99,Math.max(.1,o))}function Bt(e){let t=[];if(!e||e.length<10)return{intents:[],decisions:[],preferences:[],questions:[],problems:[],summary:"No intents detected (prompt too short)"};for(let l of ri){let u=e.matchAll(l);for(let g of u){let d=g[0],m=g.index||0,y="",x;if(g[3]?(y=g[2]?.trim()||"",x=[g[3].trim()]):g[2]&&(y=g[2].trim()),!y||y.length<2)continue;let R=fi(e,m),v=X(d+(R||"")),S=mi(e,m),w=yi(e,m),k=hi(d,!!R,!!x,v.length);t.push({type:"decision",confidence:k,text:d.slice(0,300),entities:v,rationale:R,alternatives:x,...S.length>0?{constraints:S}:{},...w.length>0?{tradeoffs:w}:{},position:m})}}for(let l of oi){let u=e.matchAll(l);for(let g of u){let d=g[0],m=g.index||0,y=X(d);t.push({type:"preference",confidence:y.length>0?.8:.6,text:d.slice(0,300),entities:y,position:m})}}for(let l of ii){let u=e.matchAll(l);for(let g of u){let d=g[0],m=g.index||0,y=X(d);t.push({type:"problem",confidence:.75,text:d.slice(0,300),entities:y,position:m})}}for(let l of si){let u=e.matchAll(l);for(let g of u){let d=g[0],m=g.index||0,y=X(d);t.push({type:"question",confidence:.8,text:d.slice(0,300),entities:y,position:m})}}let n=bi(t),r=n.filter(l=>l.type==="decision"&&l.confidence>=.7),o=n.filter(l=>l.type==="preference"),i=n.filter(l=>l.type==="problem"),s=n.filter(l=>l.type==="question"),a=ki(r,o,i,s);return{intents:n,decisions:r,preferences:o,questions:s,problems:i,summary:a}}function bi(e){if(e.length<=1)return e;let t=[...e].sort((r,o)=>r.position-o.position),n=[];for(let r of t)if(!n.some(i=>{let s=i.position+i.text.length,a=r.position+r.text.length;return r.position>=i.position&&r.position<s||i.position>=r.position&&i.position<a}))n.push(r);else{let i=n.findIndex(s=>{let a=s.position+s.text.length,l=r.position+r.text.length;return s.type===r.type&&(r.position>=s.position&&r.position<a||s.position>=r.position&&s.position<l)});i>=0&&r.confidence>n[i].confidence&&(n[i]=r)}return n}function ki(e,t,n,r){let o=[];return e.length>0&&o.push(`${e.length} decision${e.length>1?"s":""}`),t.length>0&&o.push(`${t.length} preference${t.length>1?"s":""}`),n.length>0&&o.push(`${n.length} problem${n.length>1?"s":""}`),r.length>0&&o.push(`${r.length} question${r.length>1?"s":""}`),o.length===0?"No intents detected":`Detected: ${o.join(", ")}`}import{existsSync as xi,appendFileSync as vi,mkdirSync as Ii}from"node:fs";import{join as de,dirname as Ri}from"node:path";var Yt={enabled:!0,maxRelations:50,scoringStrategy:"frequency",allowSelfLoops:!1};function Si(e,t,n=1){let r=0;return r+=Math.max(0,100-t*5),r+=Math.min(n*10,30),e.length<15&&(r+=5),r}function Kt(e,t={}){let n={...Yt,...t};if(!n.enabled||e.length<2)return[];let r=e.map((s,a)=>({entity:s,score:Si(s,a,1)})).sort((s,a)=>a.score-s.score),o=Math.min(r.length,Math.ceil(Math.sqrt(n.maxRelations))),i=[];for(let s=0;s<o&&i.length<n.maxRelations;s++)for(let a=s+1;a<o&&i.length<n.maxRelations;a++)i.push({from:r[s].entity,to:r[a].entity,relationType:"RELATES_TO"});return i}var Qt={linkPrimaryToPrimary:!0,linkPrimaryToSecondary:!0,linkSecondaryToSecondary:!1,minImportanceScore:70},wi={Decision:100,Pattern:80,Technology:70,Tool:50,Solution:75,Preference:60,Problem:65,Workflow:55};function Ti(e){let t=["postgresql","postgres","redis","mongodb","dynamodb","fastapi","django","flask","nodejs","react","vue","angular","typescript","python","docker","kubernetes","terraform","aws","gcp","azure","caching","pagination","authentication","authorization","saga","cqrs","event-sourcing","event-driven","microservice","monolith"],n=e.toLowerCase();return t.some(r=>n.includes(r))}function _i(e,t,n,r,o=1){let i=0;i+=wi[r]||50,i+=Math.max(0,30-t*2),i+=Math.min(o*5,25),Ti(e)&&(i+=10);let s;return i>=120?s="primary":i>=70?s="secondary":s="tertiary",{entity:e,type:r,importance:s,score:i}}function Jt(e,t=new Map,n={}){let r={...Qt,...n};if(e.length<2)return[];let i=e.map((a,l)=>_i(a,l,e.length,t.get(a)||"Technology",1)).filter(a=>a.score>=r.minImportanceScore),s=[];for(let a=0;a<i.length;a++)for(let l=a+1;l<i.length;l++){let u=i[a],g=i[l],d=!1;(u.importance==="primary"&&g.importance==="primary"&&r.linkPrimaryToPrimary||(u.importance==="primary"||g.importance==="primary")&&u.importance!=="tertiary"&&g.importance!=="tertiary"&&r.linkPrimaryToSecondary||u.importance==="secondary"&&g.importance==="secondary"&&r.linkSecondaryToSecondary)&&(d=!0),d&&s.push({from:u.entity,to:g.entity,relationType:"RELATES_TO"})}return s}function Vt(e){if(e<=5)return 1;if(e<=10)return .8;if(e<=20)return .5;if(e<=50)return .3;if(e<=100)return .15;let t=e*(e-1)/2;return Math.min(.1,750/t)}var ge=class{seed;constructor(t=Date.now()){this.seed=t%2147483647,this.seed<=0&&(this.seed+=2147483646)}next(){return this.seed=this.seed*16807%2147483647,this.seed/2147483647}};function Xt(e,t={}){let n={strategy:"adaptive",absoluteMaxRelations:100,...t};if(e.length<2)return[];let r=new ge(n.seed),o=n.absoluteMaxRelations||100,i=0;switch(n.strategy){case"fixed":i=n.fixedProbability??.5;break;case"adaptive":i=Vt(e.length);break;case"weighted":i=Vt(e.length);break}let s=[];for(let a=0;a<e.length-1&&s.length<o;a++)for(let l=a+1;l<e.length&&s.length<o;l++){let u=!1;if(n.strategy==="weighted"){let g=1-Math.abs(l-a)/e.length*.3,d=i*g;u=r.next()<d}else u=r.next()<i;u&&s.push({from:e[a],to:e[l],relationType:"RELATES_TO"})}return s}function Zt(e,t={}){if(e.length<=10&&e.length>=2){let i=[];for(let s=0;s<e.length-1;s++)for(let a=s+1;a<e.length;a++)i.push({from:e[s],to:e[a],relationType:"RELATES_TO"});return i}let r={primary:"weighted",fallback:"topk",fallbackThreshold:100,primaryConfig:Qt,fallbackConfig:Yt,...t},o=[];switch(r.primary){case"weighted":o=Jt(e,new Map,r.primaryConfig);break;case"topk":o=Kt(e,r.primaryConfig);break;case"probabilistic":o=Xt(e,r.primaryConfig);break}if(r.fallback&&r.fallbackThreshold&&o.length>r.fallbackThreshold)switch(c("relates-to-scaling",`Primary strategy (${r.primary}) generated ${o.length} relations (exceeded threshold ${r.fallbackThreshold}). Applying fallback: ${r.fallback}`,"warn"),r.fallback){case"topk":o=Kt(e,r.fallbackConfig);break;case"probabilistic":o=Xt(e,r.fallbackConfig);break;case"weighted":o=Jt(e,new Map,r.fallbackConfig);break}return o}function Pi(){return de(f(),".claude","memory","decisions.jsonl")}function Ci(){return de(f(),".claude","memory","graph-queue.jsonl")}function Ei(){return de(f(),".claude","memory","mem0-queue.jsonl")}function fe(e,t){try{let n=Ri(e);xi(n)||Ii(n,{recursive:!0});let r=JSON.stringify(t)+`
`;return vi(e,r),!0}catch(n){return c("memory-writer",`Failed to write to ${e}: ${n}`,"warn"),!1}}function Ai(e){return fe(Pi(),e)}function $i(e){let t=[],n=new Date().toISOString(),r={name:e.id,entityType:Oi(e.type),observations:Di(e)},o=e.entities.map(s=>({name:s,entityType:ji(s),observations:[`Mentioned in ${e.type}: ${e.content.what.slice(0,100)}`]}));t.push({type:"create_entities",payload:{entities:[r,...o]},timestamp:n});let i=[];for(let s of e.entities){let a=e.type==="decision"?"CHOSE":e.type==="preference"?"PREFERS":"MENTIONS";i.push({from:e.id,to:s,relationType:a})}if(e.content.alternatives?.length)for(let s of e.content.alternatives)i.push({from:e.content.what,to:s,relationType:"CHOSE_OVER"});if(e.content.constraints?.length)for(let s of e.content.constraints)i.push({from:e.id,to:s,relationType:"CONSTRAINT"});if(e.content.tradeoffs?.length)for(let s of e.content.tradeoffs)i.push({from:e.id,to:s,relationType:"TRADEOFF"});if(e.entities.length>=2){let s=Zt(e.entities);i.push(...s)}for(let s of e.relations)i.push({from:s.from,to:s.to,relationType:s.type});return i.length>0&&t.push({type:"create_relations",payload:{relations:i},timestamp:n}),t}function Di(e){let t=[];return t.push(`What: ${e.content.what}`),e.content.why&&t.push(`Rationale: ${e.content.why}`),e.content.alternatives?.length&&t.push(`Alternatives considered: ${e.content.alternatives.join(", ")}`),e.content.constraints?.length&&t.push(`Constraints: ${e.content.constraints.join("; ")}`),e.content.tradeoffs?.length&&t.push(`Tradeoffs: ${e.content.tradeoffs.join("; ")}`),t.push(`Category: ${e.metadata.category}`),t.push(`Confidence: ${(e.metadata.confidence*100).toFixed(0)}%`),t.push(`Source: ${e.metadata.source}`),t.push(`Project: ${e.metadata.project}`),t.push(`Timestamp: ${e.metadata.timestamp}`),t}function Oi(e){return{decision:"Decision",preference:"Preference","problem-solution":"Solution",pattern:"Pattern",workflow:"Workflow"}[e]||"Decision"}function ji(e){let t=Gt(e);return t||"Technology"}function Mi(e){return fe(Ci(),e)}function en(){return!!process.env.MEM0_API_KEY}function Ni(e){let t=e.metadata.sharing_scope||"team",n=e.metadata.is_generalizable||!1,r;return t==="global"&&n&&ie("decisions","global")?r=bt("best-practices"):ie("decisions","team")?r=ht("decisions"):r=`${yt("local")}-decisions`,{text:`${e.type}: ${e.content.what}${e.content.why?` because ${e.content.why}`:""}`,user_id:r,metadata:{type:e.type,category:e.metadata.category,confidence:e.metadata.confidence,source:e.metadata.source,project:e.metadata.project,timestamp:e.metadata.timestamp,entities:e.entities,has_rationale:!!e.content.why,has_alternatives:!!e.content.alternatives?.length,importance:e.metadata.importance,is_generalizable:n,contributor_id:t==="global"?e.identity.anonymous_id:e.identity.user_id}}}function Li(e){if(!en())return!1;let t=Ni(e);return fe(Ei(),{...t,queued_at:new Date().toISOString()})}async function me(e){let t={local:!1,graph_queued:!1,mem0_queued:!1};t.local=Ai(e);let n=$i(e),r=!0;for(let i of n)Mi(i)||(r=!1);t.graph_queued=r,en()&&(t.mem0_queued=Li(e));let o=[t.local?"local":null,t.graph_queued?"graph":null,t.mem0_queued?"mem0":null].filter(Boolean);return o.length>0&&c("memory-writer",`Stored ${e.type} ${e.id} to: ${o.join(", ")}`,"info"),t}function Hi(e,t,n){if(t<.8||!e.why)return!1;let r=["pagination","caching","authentication","authorization","testing","deployment","security","performance","database","api","architecture"];return n.some(i=>r.some(s=>i.toLowerCase().includes(s)))}function ye(e,t,n,r){let o=new Date().toISOString(),i=Fi(e),s=f().split("/").pop()||"unknown",a=V(),l=r.confidence??.5,u=Hi(t,l,n);return e==="decision"?wt(t.what,t.why,l):e==="preference"&&Tt(t.what,l),{id:i,type:e,content:t,entities:n,relations:[],identity:{user_id:a.user_id,anonymous_id:a.anonymous_id,team_id:a.team_id,machine_id:a.machine_id},metadata:{session_id:r.session_id,timestamp:o,confidence:l,source:r.source,project:s,category:r.category??"general",importance:r.importance,is_generalizable:u,sharing_scope:u?"global":"team"}}}function Fi(e){let t=Date.now().toString(36),n=Math.random().toString(36).slice(2,8);return`${e}-${t}-${n}`}import{existsSync as Ui,appendFileSync as Gi,mkdirSync as qi}from"node:fs";import{join as zi,dirname as Wi}from"node:path";var $="capture-user-intent",Bi=15;function Ki(e){let t=Date.now().toString(36),n=Math.random().toString(36).slice(2,8);return`${e}-${t}-${n}`}function Ji(){return f().split("/").pop()||"unknown"}function Vi(e,t){try{let n=Wi(e);Ui(n)||qi(n,{recursive:!0});let r=JSON.stringify(t)+`
`;return Gi(e,r),!0}catch(n){return c($,`Failed to write to ${e}: ${n}`,"warn"),!1}}function Xi(e,t){if(e.length===0)return 0;let n=f(),r=zi(n,".claude","memory","open-problems.jsonl"),o=Ji(),i=new Date().toISOString(),s=0;for(let a of e){let l={id:Ki("prob"),timestamp:i,session_id:t,type:"problem",text:a.text,confidence:a.confidence,entities:a.entities,project:o,status:"open"};Vi(r,l)&&s++}return s}function tn(e){if(e.length===0)return"general";let t=e.join(" ").toLowerCase(),n=[[["postgresql","postgres","mysql","sqlite","mongodb","redis","database","db"],"database"],[["react","vue","angular","svelte","frontend","css","tailwind","ui"],"frontend"],[["fastapi","django","express","nest","backend","api","rest","graphql"],"backend"],[["docker","kubernetes","k8s","ci","cd","deploy","infrastructure"],"infrastructure"],[["test","jest","vitest","pytest","testing","coverage"],"testing"],[["typescript","python","rust","go","java","language"],"language"],[["auth","security","jwt","oauth","encryption"],"security"],[["cache","caching","performance","optimization"],"performance"],[["architecture","pattern","design","structure"],"architecture"]];for(let[r,o]of n)if(r.some(i=>t.includes(i)))return o;return"general"}function Yi(e,t){try{for(let n of e.decisions){let r=ye("decision",{what:n.text,why:n.rationale,...n.alternatives?.length?{alternatives:n.alternatives}:{},...n.constraints?.length?{constraints:n.constraints}:{},...n.tradeoffs?.length?{tradeoffs:n.tradeoffs}:{}},n.entities,{session_id:t,source:"user_prompt",confidence:n.confidence,category:tn(n.entities)});me(r).catch(o=>{c($,`storeDecision failed for decision: ${o}`,"warn")})}for(let n of e.preferences){let r=ye("preference",{what:n.text},n.entities,{session_id:t,source:"user_prompt",confidence:n.confidence,category:tn(n.entities)});me(r).catch(o=>{c($,`storeDecision failed for preference: ${o}`,"warn")})}for(let n of e.problems)_t(n.text)}catch(n){c($,`Memory pipeline storage failed: ${n}`,"warn")}}function nn(e){let t=e.prompt;if(!t||t.length<Bi)return p();let n=e.session_id||h(),r;try{r=Bt(t)}catch(i){return c($,`Intent detection failed: ${i}`,"warn"),p()}if(r.intents.length===0)return p();Yi(r,n);let o=Xi(r.problems,n);return o>0&&c($,`Captured: ${o} problems`,"info"),(r.decisions.length>0||r.preferences.length>0)&&c($,`Tracked: ${r.decisions.length} decisions, ${r.preferences.length} preferences (to decisions.jsonl + queues)`,"debug"),p()}import{existsSync as Qi,readFileSync as Zi}from"node:fs";import{join as es}from"node:path";var F="memory-context-loader",ts=10,ns=2e3;function rs(e,t){try{return Zi(e,"utf8").trim().split(`
`).filter(o=>o.length>0).slice(-t)}catch{return[]}}function os(e){let t=[];for(let n of e)try{let r=JSON.parse(n);r&&r.content&&r.content.what&&t.push(r)}catch{}return t}function is(e){let t=[];t.push("## Recent Project Decisions"),t.push("");for(let n of e){let o=`- **[${n.type==="preference"?"Preference":"Decision"}]** ${n.content.what}`;if(n.content.why&&(o+=` _(because: ${n.content.why})_`),n.entities.length>0&&(o+=` [${n.entities.join(", ")}]`),t.push(o),t.join(`
`).length>ns){t.pop(),t.push("- _(additional decisions available via mcp__memory__search_nodes)_");break}}return t.push(""),t.push("_For deeper graph traversal: use mcp__memory__search_nodes or mcp__memory__open_nodes_"),t.join(`
`)}function rn(e){try{let t=e.project_dir||f(),n=es(t,".claude","memory","decisions.jsonl");if(!Qi(n))return c(F,"No decisions.jsonl found, skipping"),p();let r=rs(n,ts);if(r.length===0)return c(F,"decisions.jsonl is empty, skipping"),p();let o=os(r);if(o.length===0)return c(F,"No valid decisions found in file"),p();o.reverse();let i=is(o);return c(F,`Loaded ${o.length} recent decisions as context`),b(i)}catch(t){return c(F,`Error loading memory context: ${t}`,"warn"),p()}}import{existsSync as Y,readFileSync as sn,writeFileSync as ss,mkdirSync as as}from"node:fs";import{join as Q,dirname as cs}from"node:path";var he=1;function ls(){return process.env.HOME||process.env.USERPROFILE||"/tmp"}function us(){return Q(ls(),".claude","orchestkit")}function ps(e){let t=e.replace(/[^a-zA-Z0-9@._-]/g,"_");return Q(us(),"users",t)}function an(e){return Q(ps(e),"profile.json")}function gs(e){let t=e.replace(/[^a-zA-Z0-9@._-]/g,"_");return Q(f(),".claude","memory","users",t,"profile.json")}function ds(e){let t=gs(e),n=an(e);if(Y(n))return!1;if(Y(t))try{let r=cs(n);Y(r)||as(r,{recursive:!0});let o=sn(t,"utf8"),i=JSON.parse(o);return ss(n,JSON.stringify(i,null,2)),c("user-profile",`Migrated profile for ${e} to cross-project storage`,"info"),!0}catch(r){return c("user-profile",`Failed to migrate profile: ${r}`,"warn"),!1}return!1}function on(e){let t=H(),n=new Date().toISOString();return{user_id:e,anonymous_id:t.anonymous_id,display_name:t.display_name,team_id:t.team_id,sessions_count:0,first_seen:n,last_seen:n,version:he,skill_usage:{},agent_usage:{},tool_usage:{},decisions:[],preferences:[],workflow_patterns:[],aggregated_sessions:[]}}function cn(e){let t=e||H().user_id;ds(t);let n=an(t);if(!Y(n))return on(t);try{let r=sn(n,"utf8"),o=JSON.parse(r);return o.version<he&&(o.version=he),o}catch(r){return c("user-profile",`Failed to load profile: ${r}`,"warn"),on(t)}}function ln(e,t=5){return Object.entries(e.skill_usage).map(([n,r])=>({skill:n,stats:r})).sort((n,r)=>r.stats.count-n.stats.count).slice(0,t)}function un(e,t=5){return Object.entries(e.agent_usage).map(([n,r])=>({agent:n,stats:r})).sort((n,r)=>r.stats.count-n.stats.count).slice(0,t)}function pn(e,t=10){return e.decisions.slice(0,t)}var be=800,fs=3,ms=3,ys=2,gn=50,hs=2;function bs(e,t=fs){let n=ln(e,t);return n.length===0?"":n.map(r=>r.skill).join(", ")}function ks(e,t=ms){let n=un(e,t);return n.length===0?"":n.map(r=>r.agent).join(", ")}function Ss(e,t=ys){let n=pn(e,t);return n.length===0?"":n.map(r=>r.what).map(r=>r.length>gn?r.slice(0,gn-3)+"...":r).join("; ")}function ws(e,t=hs){return e.preferences.length===0?"":e.preferences.slice(0,t).map(n=>`${n.category}: ${n.preference}`).join(", ")}function Ts(e){return e.sessions_count>0||Object.keys(e.skill_usage).length>0||Object.keys(e.agent_usage).length>0||e.decisions.length>0||e.preferences.length>0}function _s(e){let t=[];t.push(`## User Profile Context
`);let n=e.display_name||"User";e.sessions_count>0?t.push(`Working with **${n}** (${e.sessions_count} sessions)`):t.push(`Working with **${n}**`);let r=bs(e);r&&t.push(`

**Preferred skills:** ${r}`);let o=ks(e);o&&t.push(`

**Frequently used agents:** ${o}`);let i=Ss(e);i&&t.push(`

**Recent decisions:** ${i}`);let s=ws(e);s&&t.push(`

**Preferences:** ${s}`);let a=t.join("");return a.length>be&&(a=a.slice(0,be-3)+"...",c("profile-injector",`Context truncated to ${be} chars`,"debug")),a}function dn(e){c("profile-injector","Loading user profile for session context");try{let t=cn();if(!Ts(t))return c("profile-injector","Empty profile, skipping injection","debug"),p();let n=_s(t);return c("profile-injector",`Injecting profile context for ${t.display_name} (${n.length} chars)`,"info"),b(n)}catch(t){return c("profile-injector",`Error loading profile: ${t}`,"warn"),p()}}import{existsSync as fn,readFileSync as xs,writeFileSync as vs,mkdirSync as Is}from"node:fs";import{join as Rs,dirname as Ps}from"node:path";var ke="communication-style-tracker",Cs=5,Es=30,As=150,$s=[/^(how|what|why|when|where|which|who|can\s+(you|i)|could\s+(you|i)|would\s+(you|i)|is\s+(it|there|this)|are\s+(there|these)|do\s+(you|i)|does|should|will|has|have)\b/i,/\?$/,/\b(explain|tell me|show me|help me understand)\b/i],Ds=[/^(fix|add|create|update|remove|delete|run|build|test|deploy|install|configure|set|get|make|write|read|edit|change|modify|implement|refactor)\b/i,/^(do|just|please|now|quickly)\s+(fix|add|create|update|run|build)/i,/^[a-z]+\s+(it|this|that|the)\b/i],Os=[/^(i think|i believe|maybe|perhaps|i was thinking|let's discuss|what if|consider|i'm wondering|could we|should we|might we)\b/i,/\b(alternatively|on the other hand|however|but|although|pros and cons|trade-?off)\b/i,/\b(in my experience|from what i've seen|generally|typically|usually)\b/i],js=[/\b(what (is|are|does)|how (do|does) .* work|explain|eli5|basics?|beginner|newbie|starter|learning|tutorial)\b/i,/\b(i('m| am) (new|confused|stuck|lost)|don't understand|can you explain)\b/i,/\b(step by step|for dummies|simple|easy)\b/i],Ms=[/\b(idempoten|determin|memoiz|currying|monad|functor|polymorphi|closure|hoisting|prototype chain)\b/i,/\b(HNSW|pgvector|FAISS|embeddings?|RAG|LLM|transformer|attention|tokeniz)\b/i,/\b(sharding|partition|replica|consistency|CAP theorem|ACID|eventual consistency)\b/i,/\b(microservic|kubernetes|k8s|helm|istio|service mesh|container orchestrat)\b/i,/\b(cursor.based pagination|connection pool|deadlock|race condition|mutex|semaphore)\b/i,/\b(dependency injection|inversion of control|SOLID|DRY|KISS|YAGNI)\b/i,/\b(async|await|promise|observable|event.loop|coroutine|generator)\b/i,/\b(O\(n\)|O\(log n\)|O\(1\)|big.?O|time complexity|space complexity)\b/i],Ns=[/\b(API|REST|GraphQL|JWT|OAuth|middleware|endpoint|route|controller)\b/i,/\b(component|hook|state|props|context|redux|store|dispatch)\b/i,/\b(migration|schema|model|ORM|query|index|foreign key)\b/i,/\b(unit test|integration test|e2e|mock|stub|fixture|coverage)\b/i,/\b(git|branch|merge|rebase|commit|PR|pull request)\b/i];function Ls(e){let t=e.trim(),n=t.length,r=(t.match(/[.!?]\s+[A-Z]/g)||[]).length>=2,o=/\b(because|since|so that|in order to|the reason)\b/i.test(t),i=/\b(context|background|currently|previously|before)\b/i.test(t);return n<=Es&&!o?"terse":n>As||r||o||i?"detailed":"moderate"}function mn(e){let t=e.trim();for(let n of Os)if(n.test(t))return"discussion";for(let n of $s)if(n.test(t))return"question";for(let n of Ds)if(n.test(t))return"command";return t.length<50?"command":"discussion"}function Hs(e){let t=e.trim(),n=0,r=0,o=0;for(let i of js)i.test(t)&&(n+=2);for(let i of Ms)i.test(t)&&(o+=2);for(let i of Ns)i.test(t)&&(r+=1);return t.length<40&&!t.includes("?")&&mn(t)==="command"&&(o+=1),n>o&&n>r?"beginner":o>=2||o>0&&r>=2?"expert":(r>=2||o>0,"intermediate")}function Fs(e){return{verbosity:Ls(e),interaction_type:mn(e),technical_level:Hs(e)}}function Us(e){return Rs(e,".claude",".comm-style-counter")}function Gs(e){let t=Us(e),n=Ps(t);if(!fn(n))try{Is(n,{recursive:!0})}catch{}let r=0;if(fn(t))try{r=parseInt(xs(t,"utf8").trim(),10)||0}catch{}r++;try{vs(t,String(r))}catch{}return r}function yn(e){let t=e.prompt||"",n=e.project_dir||f(),r=parseInt(process.env.COMM_STYLE_SAMPLE_RATE||"5",10),o=Gs(n);if(r>1&&o%r!==0)return p();if(c(ke,`Analyzing communication style (sample ${o})`),!t||t.length<Cs)return p();if(t.startsWith("/"))return p();try{let i=Fs(t);xt(i),c(ke,`Detected: verbosity=${i.verbosity}, type=${i.interaction_type}, level=${i.technical_level}`)}catch(i){c(ke,`Error tracking communication style: ${i}`,"warn")}return p()}var hn={"prompt/antipattern-detector":nt,"prompt/antipattern-warning":st,"prompt/context-injector":at,"prompt/context-pruning-advisor":ut,"prompt/memory-context":pt,"prompt/satisfaction-detector":Rt,"prompt/todo-enforcer":Pt,"prompt/agent-auto-suggest":Ct,"prompt/agent-orchestrator":Et,"prompt/pipeline-detector":At,"prompt/skill-resolver":Nt,"prompt/capture-user-intent":nn,"prompt/memory-context-loader":rn,"prompt/profile-injector":dn,"prompt/communication-style-tracker":yn};function Ru(e){return hn[e]}function Pu(){return Object.keys(hn)}export{ga as DEFAULT_CONFIG,Ye as PIPELINES,T as THRESHOLDS,Ne as addToPromptHistory,Ya as analyzeAttemptHistory,ic as applyDecay,Le as cacheClassification,er as calculateBackoffDelay,D as classifyIntent,Pa as cleanupOldStates,Wa as cleanupOldTasks,ba as clearCache,Ra as clearSessionState,Xa as completeAttempt,za as completePipelineStep,Va as createAttempt,Ze as createPipelineExecution,Qe as detectPipeline,ua as escapeRegex,U as estimateTokenCount,tt as formatPipelinePlan,Za as formatRetryDecision,Oa as formatTaskCreateForClaude,Ma as formatTaskDeleteForClaude,Na as formatTaskUpdateForClaude,$a as generateTaskCreateInstruction,ja as generateTaskDeleteInstruction,Da as generateTaskUpdateInstruction,xa as getActiveAgent,ze as getActivePipeline,Xe as getAdjustments,sc as getAgentSuccessRate,re as getAlternativeAgent,Ys as getCachedBranch,ac as getCalibrationStats,ca as getField,Ru as getHook,va as getInjectedSkills,He as getLastClassification,_e as getLogDir,_n as getLogLevel,Ga as getOrphanedTasks,gc as getPipelineByType,Kn as getPipelineTasks,C as getPluginRoot,f as getProjectDir,B as getPromptHistory,h as getSessionId,Ha as getTaskByAgent,Fa as getTaskById,Ua as getTasksBlockedBy,cc as hasMinimalCalibrationData,ur as hashPrompt,hn as hooks,Oe as isAgentDispatched,zs as isBashInput,Bs as isEditInput,Ks as isReadInput,tr as isRetryableError,Me as isSkillInjected,Ws as isWriteInput,Pu as listHooks,L as loadCalibrationData,P as loadConfig,E as loadState,c as logHook,ia as logPermissionFeedback,Ja as makeRetryDecision,la as normalizeCommand,ta as outputAllowWithContext,Zs as outputBlock,oa as outputDeny,na as outputError,b as outputPromptContext,sa as outputPromptContextBudgeted,Qs as outputSilentAllow,p as outputSilentSuccess,ra as outputWarning,ea as outputWithContext,Qa as prepareForRetry,aa as readHookInput,oc as recordOutcome,qe as registerPipeline,et as registerPipelineExecution,Ge as registerTask,_a as removeAgent,lr as saveCalibrationData,Ia as saveConfig,Un as saveState,O as shouldClassify,xn as shouldLog,nr as suggestsAlternative,De as trackDispatchedAgent,je as trackInjectedSkill,Ta as updateAgentStatus,qa as updatePipeline,j as updateState,La as updateTaskStatus};
//# sourceMappingURL=prompt.mjs.map
