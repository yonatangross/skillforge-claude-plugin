// OrchestKit Hooks - agent bundle
// Generated: 2026-01-30T15:14:32.165Z

var O=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function X(t){return typeof t.command=="string"}function Q(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function Y(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function tt(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as h,existsSync as y,statSync as w,renameSync as $,mkdirSync as N,readSync as A}from"node:fs";import{execSync as L}from"node:child_process";import v from"node:os";import l from"node:path";function C(){return process.env.HOME||process.env.USERPROFILE||v.homedir()}function f(){return process.env.CLAUDE_PROJECT_DIR||"."}function k(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function x(){return process.env.CLAUDE_PLUGIN_ROOT?l.join(C(),".claude","logs","ork"):l.join(f(),".claude","logs")}var rt=l.join,it=l.sep;function R(){return x()}function g(){return f()}function at(){return k()}function p(){return process.env.CLAUDE_SESSION_ID||`fallback-${process.pid}-${Date.now()}`}function lt(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=L("git branch --show-current",{cwd:t||g(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function U(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function j(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(U())}function r(){return{continue:!0,suppressOutput:!0}}function dt(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function ft(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function c(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function B(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function gt(t,e){let o={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?o.systemMessage=e:o.suppressOutput=!0,o}function mt(t){return{continue:!0,systemMessage:t}}function kt(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function u(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}var G=200*1024,F=100*1024;function I(t,e){if(y(t))try{if(w(t).size>e){let n=`${t}.old.${Date.now()}`;$(t,n)}}catch{}}function _(t){y(t)||N(t,{recursive:!0})}function M(t,e,o="debug"){if(!j(o))return;let n=R(),i=`${n}/hooks.log`;try{_(n),I(i,G);let s=new Date().toISOString().replace("T"," ").slice(0,19);h(i,`[${s}] [${o.toUpperCase()}] [${t}] ${e}
`)}catch{}}function xt(t,e,o){let n=R(),i=`${n}/permission-feedback.log`;try{_(n),I(i,F);let s=new Date().toISOString(),a=o?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",d=o?.session_id||p();h(i,`${s} | ${t} | ${e} | tool=${a} | session=${d}
`)}catch{}}function W(t){if(!t)return 0;let n=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/n)}function ht(t,e,o,n,i){let s=W(t);return n&&n.isOverBudget(o)?(M(e,`Budget exhausted for ${o}, suppressing ${s}t`),r()):(i&&i.trackTokenUsage(e,o,s),B(t))}function yt(){try{let t=[],o=Buffer.allocUnsafe(256),n,i=0;for(;;)try{if(n=A(i,o,0,256,null),n===0)break;t.push(Buffer.from(o.subarray(0,n)))}catch{break}let s=Buffer.concat(t).toString("utf8").trim();return s?JSON.parse(s):{tool_name:"",session_id:p(),tool_input:{}}}catch{return{tool_name:"",session_id:p(),tool_input:{}}}}function Rt(t,e){let o=e.replace(/^\./,"").split("."),n=t;for(let i of o){if(n==null)return;n=n[i]}return n}function It(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function _t(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Et(t){return e=>t(e)?null:r()}function m(t,...e){let o=t.tool_input.file_path;if(!o)return r();let n=o.split(".").pop()?.toLowerCase()||"";return e.map(s=>s.toLowerCase().replace(/^\./,"")).includes(n)?null:r()}function Tt(t){return m(t,"py","ts","tsx","js","jsx","go","rs","java")}function Dt(t){return m(t,"py")}function Pt(t){return m(t,"ts","tsx","js","jsx")}function bt(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(n=>n.test(e))?null:r():r()}function Ot(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(n=>n.test(e))?r():null}function vt(t,...e){let o=t.tool_input.file_path;if(!o)return r();for(let n of e)if(typeof n=="string"){if(new RegExp(n.replace(/\*/g,".*").replace(/\?/g,".")).test(o))return null}else if(n.test(o))return null;return r()}function H(t,...e){let o=t.tool_name;return o?e.includes(o)?null:r():r()}function Ct(t){return H(t,"Write","Edit")}function wt(t){return H(t,"Bash")}function $t(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(n=>n.test(e))?r():null}function Nt(t){return(t.tool_input.command||"").startsWith("git")?null:r()}function At(t){let o=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:n}=O("node:fs");if(n(o))return null}catch{}return r()}function Lt(t,...e){for(let o of e){let n=o(t);if(n!==null)return n}return null}function S(t){let e=t.tool_name,o=process.env.CLAUDE_AGENT_ID||"unknown";return["Write","Edit","MultiEdit","NotebookEdit"].includes(e)?u(`BLOCKED: Agent '${o}' is read-only. Write/Edit operations are not permitted. This agent investigates and reports - it does not modify code.`):r()}var K=[/force.*push/i,/push.*--force/i,/--force-with-lease/i,/workflow_dispatch/i,/delete.*workflow/i,/gh\s+secret\s+delete/i,/gh\s+variable\s+delete/i,/rm.*-rf.*\.github/i];function E(t){let e=t.tool_input.command||"";for(let o of K)if(o.test(e))return u(`BLOCKED: Potentially destructive CI/CD operation detected. Pattern: '${o.source}'. This requires explicit user approval.`);return/deploy|release|publish/i.test(e)?c("CI/CD Safety: Deployment commands detected. Verify target environment and ensure proper approvals are in place."):r()}var q=[/\bprod\b/i,/production/i,/--env.*prod/i,/ENV=prod/i,/ENVIRONMENT=prod/i,/deploy.*main/i,/deploy.*master/i];function T(t){let e=t.tool_input.command||"";for(let o of q)if(o.test(e))return u(`BLOCKED: Production deployment detected. Pattern: '${o.source}'. Production deployments require explicit user approval and should go through proper release processes.`);return/rollback|revert|downgrade/i.test(e)?c("Deployment Safety: Rollback operation detected. Verify the target version and ensure proper change management procedures are followed."):/terraform|kubectl|helm|docker.*push/i.test(e)?c("Deployment Safety: Infrastructure change detected. Verify changes in staging before production deployment."):r()}var z=[/DROP\s+TABLE/i,/DROP\s+DATABASE/i,/TRUNCATE/i,/DELETE\s+FROM.*WHERE\s+1/i,/DELETE\s+FROM\s+[^W]*$/i,/--force/i,/alembic\s+downgrade/i];function D(t){if(t.tool_name!=="Bash")return r();let o=t.tool_input.command||"";for(let n of z)if(n.test(o))return u(`BLOCKED: Potentially destructive database command detected. Pattern: '${n.source}'. Please confirm this operation is intentional before proceeding.`);return r()}import{mkdirSync as V,appendFileSync as Z}from"node:fs";function P(t){let e=process.env.CLAUDE_AGENT_ID||"unknown",o=t.tool_name,n=t.session_id||p(),i=t.project_dir||g(),s=`${i}/.claude/logs/security-audit.log`;if(o!=="Bash")return r();let a=t.tool_input.command||"",d=new Date().toISOString();if(a)try{V(`${i}/.claude/logs`,{recursive:!0}),Z(s,`[${d}] [${n}] [${e}] CMD: ${a}
`)}catch{}return r()}var b={"agent/block-writes":S,"agent/ci-safety-check":E,"agent/deployment-safety-check":T,"agent/migration-safety-check":D,"agent/security-command-audit":P};function ee(t){return b[t]}function oe(){return Object.keys(b)}export{Et as createGuard,_t as escapeRegex,W as estimateTokenCount,lt as getCachedBranch,Rt as getField,ee as getHook,R as getLogDir,U as getLogLevel,at as getPluginRoot,g as getProjectDir,p as getSessionId,wt as guardBash,Tt as guardCodeFiles,m as guardFileExtension,Nt as guardGitCommand,At as guardMultiInstance,$t as guardNontrivialBash,vt as guardPathPattern,Dt as guardPythonFiles,Ot as guardSkipInternal,bt as guardTestFiles,H as guardTool,Pt as guardTypescriptFiles,Ct as guardWriteEdit,b as hooks,X as isBashInput,Y as isEditInput,tt as isReadInput,Q as isWriteInput,oe as listHooks,M as logHook,xt as logPermissionFeedback,It as normalizeCommand,gt as outputAllowWithContext,ft as outputBlock,u as outputDeny,mt as outputError,B as outputPromptContext,ht as outputPromptContextBudgeted,dt as outputSilentAllow,r as outputSilentSuccess,kt as outputWarning,c as outputWithContext,yt as readHookInput,Lt as runGuards,j as shouldLog};
//# sourceMappingURL=agent.mjs.map
