// OrchestKit Hooks - pretool bundle
// Generated: 2026-01-31T14:53:38.702Z

var ee=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function hr(t){return typeof t.command=="string"}function kr(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function yr(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Sr(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as Q,existsSync as X,statSync as _e,renameSync as $e,mkdirSync as be,readSync as Re}from"node:fs";import{execSync as Ce}from"node:child_process";import oe from"node:os";import P from"node:path";function ne(){return process.env.HOME||process.env.USERPROFILE||oe.homedir()}function L(){return process.env.CLAUDE_PROJECT_DIR||"."}function K(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function V(){return process.env.CLAUDE_PLUGIN_ROOT?P.join(ne(),".claude","logs","ork"):P.join(L(),".claude","logs")}var br=P.join,Rr=P.sep;import{execSync as re}from"node:child_process";import{createHash as ie}from"node:crypto";import{existsSync as J,readFileSync as se,writeFileSync as ce,mkdirSync as ae}from"node:fs";import{join as T,basename as ue}from"node:path";var le=20,pe=15,de=/[^a-z0-9-]/g;function me(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=ue(e);return Z(o,le)}function fe(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let o=re("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),n=Z(o||"detached",pe);return process.env.ORCHESTKIT_SESSION_BRANCH=n,n}catch{return"nobranch"}}function ge(t){let e=t||new Date,o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${o}${n}`}function he(t){let e=t||new Date,o=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${o}${n}`}function ke(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return ie("sha256").update(t).digest("hex").slice(0,4)}function Z(t,e){return t.toLowerCase().replace(de,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function ye(t,e){let o=me(t),n=fe(t),i=ge(e),r=he(e),c=ke();return`${o}-${n}-${i}-${r}-${c}`}function Se(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=T(e,".instance","session-id.json");if(J(o))try{let n=JSON.parse(se(o,"utf8"));if(n.session_id&&n.created_at){let i=Date.now()-new Date(n.created_at).getTime(),r=1440*60*1e3;if(i<r)return n.session_id}}catch{}}function xe(t,e){let o=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=T(o,".instance"),i=T(n,"session-id.json");try{J(n)||ae(n,{recursive:!0}),ce(i,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function b(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=Se(t);if(e)return e;let o=ye(t);return xe(o,t),o}function S(){return V()}function d(){return L()}function He(){return K()}function Tr(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${He()}/.claude/.instance_env`}function w(){return b()}function Y(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=Ce("git branch --show-current",{cwd:t||d(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function Ie(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function Or(t){return t.replace(/\r\n/g,`
`)}function we(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(Ie())}function s(){return{continue:!0,suppressOutput:!0}}function Ar(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function Fr(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function h(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function ve(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function m(t,e){let o={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?o.systemMessage=e:o.suppressOutput=!0,o}function Nr(t){return{continue:!0,systemMessage:t}}function k(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function g(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function D(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var Pe=200*1024,De=100*1024;function tt(t,e){if(X(t))try{if(_e(t).size>e){let n=`${t}.old.${Date.now()}`;$e(t,n)}}catch{}}function et(t){X(t)||be(t,{recursive:!0})}function u(t,e,o="debug"){if(!we(o))return;let n=S(),i=`${n}/hooks.log`;try{et(n),tt(i,Pe);let r=new Date().toISOString().replace("T"," ").slice(0,19);Q(i,`[${r}] [${o.toUpperCase()}] [${t}] ${e}
`)}catch{}}function l(t,e,o){let n=S(),i=`${n}/permission-feedback.log`;try{et(n),tt(i,De);let r=new Date().toISOString(),c=o?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=o?.session_id||w();Q(i,`${r} | ${t} | ${e} | tool=${c} | session=${a}
`)}catch{}}function Ee(t){if(!t)return 0;let n=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/n)}function Gr(t,e,o,n,i){let r=Ee(t);return n&&n.isOverBudget(o)?(u(e,`Budget exhausted for ${o}, suppressing ${r}t`),s()):(i&&i.trackTokenUsage(e,o,r),ve(t))}function Mr(){try{let t=[],o=Buffer.allocUnsafe(256),n,i=0;for(;;)try{if(n=Re(i,o,0,256,null),n===0)break;t.push(Buffer.from(o.subarray(0,n)))}catch{break}let r=Buffer.concat(t).toString("utf8").trim();return r?JSON.parse(r):{tool_name:"",session_id:w(),tool_input:{}}}catch{return{tool_name:"",session_id:w(),tool_input:{}}}}function Br(t,e){let o=e.replace(/^\./,"").split("."),n=t;for(let i of o){if(n==null)return;n=n[i]}return n}function E(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function Wr(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as R}from"node:child_process";function je(t){let e=t||d();try{return R("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function O(t){let e=t||je();return["dev","main","master"].includes(e)}function Kr(t){let e=t||d();try{return R("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function Vr(t){let e=t||d();try{return R("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function A(t){let e=t||d();try{return R("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function Jr(t){return A(t).length>0}function Zr(t){let e=t||d();try{return R("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return R("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function Le(t){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let o of e){let n=t.match(o);if(n)return parseInt(n[1],10)}return null}function ot(t){if(O(t))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(n=>t.startsWith(n))?t.startsWith("issue/")&&!Le(t)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}function Yr(t){return e=>t(e)?null:s()}function F(t,...e){let o=t.tool_input.file_path;if(!o)return s();let n=o.split(".").pop()?.toLowerCase()||"";return e.map(r=>r.toLowerCase().replace(/^\./,"")).includes(n)?null:s()}function C(t){return F(t,"py","ts","tsx","js","jsx","go","rs","java")}function ti(t){return F(t,"py")}function ei(t){return F(t,"ts","tsx","js","jsx")}function oi(t){let e=t.tool_input.file_path;return e?[/test/i,/spec/i,/__tests__/i].some(n=>n.test(e))?null:s():s()}function j(t){let e=t.tool_input.file_path||"";return e&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(n=>n.test(e))?s():null}function nt(t,...e){let o=t.tool_input.file_path;if(!o)return s();for(let n of e)if(typeof n=="string"){if(new RegExp(n.replace(/\*/g,".*").replace(/\?/g,".")).test(o))return null}else if(n.test(o))return null;return s()}function rt(t,...e){let o=t.tool_name;return o?e.includes(o)?null:s():s()}function it(t){return rt(t,"Write","Edit")}function ni(t){return rt(t,"Bash")}function ri(t){let e=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(n=>n.test(e))?s():null}function ii(t){return(t.tool_input.command||"").startsWith("git")?null:s()}function si(t){let o=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:n}=ee("node:fs");if(n(o))return null}catch{}return s()}function H(t,...e){for(let o of e){let n=o(t);if(n!==null)return n}return null}function I(t){return t.permissionMode==="dontAsk"}var Te=["rm -rf /","rm -rf ~","rm -fr /","rm -fr ~","mv /* /dev/null","> /dev/sda","mkfs.","dd if=/dev/zero of=/dev/","dd if=/dev/random of=/dev/","chmod -R 777 /",":(){:|:&};:","git reset --hard","git clean -fd","drop database","drop schema","truncate table"],Oe=/\|\s*(sh|bash|zsh|dash)\b/i,Ae=/git\s+push\s+.*(-f|--force)\b/i;function st(t){let e=t.tool_input.command||"";if(!e)return s();let o=E(e).toLowerCase();for(let n of Te)if(o.includes(n.toLowerCase()))return u("dangerous-command-blocker",`BLOCKED: Dangerous pattern: ${n}`),l("deny",`Dangerous pattern: ${n}`,t),g(`Command matches dangerous pattern: ${n}

This command could cause severe system damage and has been blocked.`);if(Oe.test(o)){let n="Piping to shell interpreter detected";return u("dangerous-command-blocker",`BLOCKED: ${n}`),l("deny",n,t),g(`${n}

Piping untrusted content to a shell interpreter is dangerous and has been blocked.`)}if(Ae.test(o)){let n="Git force-push detected (rewrites remote history)";return u("dangerous-command-blocker",`BLOCKED: ${n}`),l("deny",n,t),g(`${n}

Force-pushing can destroy remote commit history and has been blocked.`)}return s()}var N=["feat","fix","refactor","docs","test","chore","style","perf","ci","build"],Fe=10;function Ne(t){let e=t.match(/-m\s+["']([^"']+)["']/);if(e)return e[1];let o=t.match(/-m\s+(\S+)/);return o?o[1]:null}function Ge(t){let e=t.match(/checkout\s+-b\s+(\S+)/);if(e)return e[1];let o=t.match(/git\s+branch\s+(\S+)/);return o?o[1]:null}function Me(t,e){if(!O(e))return null;if(/git\s+(commit|push)/.test(t)){let o=`BLOCKED: Cannot commit or push directly to '${e}' branch.

Required workflow:
1. git checkout -b issue/<number>-<description>
2. git commit -m "feat(#<number>): Description"
3. git push -u origin issue/<number>-<description>
4. gh pr create --base dev`;return l("deny",`Blocked on protected branch: ${e}`),g(o)}return h(`On protected branch '${e}'. Create feature branch for changes.`)}function Be(t){if(!/git\s+(checkout\s+-b|branch\s+)/.test(t))return null;let e=Ge(t);if(!e)return null;let o=ot(e);if(o){let n=`Branch naming: ${o}

Recommended: issue/123-description, feature/xyz, fix/bug-name`;return l("allow",`Branch naming guidance: ${e}`),m(n)}return null}function We(t){if(!/^git\s+commit/.test(t))return null;if(/<<['"]?EOF/.test(t))return m(`Heredoc commit. Use: type(#issue): description
Types: ${N.join(", ")}
End with: Co-Authored-By: Claude <noreply@anthropic.com>`);let e=Ne(t);if(!e)return m("Interactive commit. Use: type(#issue): description");let o=N.join("|"),n=new RegExp(`^(${o})(\\(#?[0-9]+\\)|(\\([a-z-]+\\)))?: .+`),i=new RegExp(`^(${o}): .+`);if(n.test(e)||i.test(e)){let c=e.split(`
`)[0].length;return c>72?m(`Commit title is ${c} chars (max 72 recommended)`):null}let r=`INVALID COMMIT FORMAT: "${e}"

Required: type(#issue): description
Types: ${N.join(", ")}
Example: feat(#123): Add user authentication`;return l("deny",`Invalid commit: ${e}`),g(r)}function Ue(t,e){if(!/^git\s+commit/.test(t))return null;let n=A(e).split(`
`).filter(i=>i.trim()).length;return n>Fe?m(`Large commit: ${n} files. Consider splitting into smaller commits.`):null}function ct(t){let e=t.tool_input.command||"";if(!e.startsWith("git"))return s();let o=Y(t.project_dir);u("git-validator",`Validating: ${e.slice(0,50)}...`);let n=Me(e,o);if(n?.continue===!1)return n;let i=We(e);if(i?.continue===!1)return i;let r=Be(e),c=Ue(e,t.project_dir),a=[];return n?.hookSpecificOutput?.additionalContext&&a.push(n.hookSpecificOutput.additionalContext),i?.hookSpecificOutput?.additionalContext&&a.push(i.hookSpecificOutput.additionalContext),r?.hookSpecificOutput?.additionalContext&&a.push(r.hookSpecificOutput.additionalContext),c?.hookSpecificOutput?.additionalContext&&a.push(c.hookSpecificOutput.additionalContext),a.length>0?h(a.join(`

`)):s()}var qe=["rm -rf /","rm -rf ~","rm -fr /","rm -fr ~","mkfs","dd if=/dev","> /dev/sd","chmod -R 777 /"];function ze(t){let e=t.trim();if(!e)return!0;for(let o of qe)if(e.includes(o))return!1;return!0}function Ke(t){if(/curl.*\|.*(sh|bash)/.test(t)||/wget.*\|.*(sh|bash)/.test(t))return"pipe-to-shell execution (curl/wget piped to sh/bash)";if(!t.includes("&&")&&!t.includes("||")&&!t.includes("|")&&!t.includes(";"))return null;let e=t.split(/&&|\|\||[|;]/);for(let o of e)if(!ze(o))return o.trim();return null}function at(t){let e=t.tool_input.command||"";if(!e)return s();let o=E(e),n=Ke(o);if(n){let i=`BLOCKED: Dangerous compound command detected.

Blocked segment: ${n}

The command contains a potentially destructive operation.

Please review and modify your command to remove the dangerous operation.`;return l("deny",`Dangerous compound command: ${n}`,t),u("compound-command-validator",`BLOCKED: ${n}`),g(i)}return l("allow","Compound command validated: safe",t),s()}var ut=12e4;function lt(t){let e=t.tool_input.command||"",o=t.tool_input.timeout,n=t.tool_input.description;if(typeof o=="number"&&o>0)return{continue:!0,suppressOutput:!0};let i={command:e,timeout:ut};return n&&typeof n=="string"&&(i.description=n),u("default-timeout-setter",`Setting default timeout: ${ut}ms`),D(i)}import{existsSync as Ve,readFileSync as Je}from"node:fs";import{join as Ze}from"node:path";function Qe(t){let e=Ze(t,".claude","rules","error_rules.json");try{if(Ve(e))return JSON.parse(Je(e,"utf8")).rules||[]}catch{}return[]}function Xe(t,e){let o=new Set(t.toLowerCase().split(/\s+/)),n=new Set(e.toLowerCase().split(/\s+/)),i=0;for(let r of o)n.has(r)&&r.length>2&&i++;return i}function pt(t){let e=d(),o=t.tool_input.command||"";if(!o)return s();let n=Qe(e);if(n.length===0)return s();let i=[];/psql.*-U\s+(postgres|orchestkit|root)/.test(o)&&n.filter(c=>c.tool==="Bash"&&c.signature?.includes("role")).length>0&&i.push("DB role error: use docker exec -it <container> psql -U orchestkit_user"),o.includes("mcp__postgres")&&n.filter(c=>c.tool?.includes("postgres-mcp")).length>0&&i.push("MCP postgres: verify connection to correct database");for(let r of n){if(!r.pattern||(r.occurrence_count||0)<5)continue;let c=r.sample_input?.command;c&&Xe(o,c)>3&&(u("error-pattern-warner",`Pattern match: ${r.signature}`),r.suggested_fix?i.push(`${r.signature} (${r.occurrence_count}x): ${r.suggested_fix}`):i.push(`${r.signature} (${r.occurrence_count}x)`))}if(i.length>0){let r="Learned error patterns | "+i.join(" | ");return r.length>200&&(r=r.slice(0,197)+"..."),h(r)}return s()}import{execSync as dt}from"node:child_process";function Ye(t,e){try{let n=dt(`git diff --name-only ${e}...HEAD 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim().split(`
`).filter(Boolean),i=[];for(let r of n.slice(0,20))try{dt(`git log -1 --pretty=format:"%h" ${e} -- "${r}" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()&&i.push(r)}catch{}return i}catch{return[]}}function mt(t){let e=t.tool_input.command||"",o=d();if(!/git\s+(merge|rebase|pull)/.test(e))return s();let n=null,i=e.match(/git\s+(merge|rebase)\s+(\S+)/);if(i&&(n=i[2]),e.includes("git pull")&&(n="origin/dev"),!n)return s();let r=Ye(o,n);if(r.length>0){let c=`Potential conflicts detected: ${r.length} file(s)
Files: ${r.slice(0,5).join(", ")}${r.length>5?"...":""}

Consider:
1. Review changes in these files before merging
2. Run: git diff ${n}...HEAD -- <file>
3. Prepare conflict resolution strategy`;return l("allow",`Conflict prediction: ${r.length} files`,t),u("conflict-predictor",`Potential conflicts: ${r.join(", ")}`),m(c)}return l("allow","No conflicts predicted",t),s()}import{execSync as to}from"node:child_process";import{existsSync as eo}from"node:fs";import{join as oo,basename as no,dirname as ro}from"node:path";function io(t,e){let o=[],n=no(e).replace(/\.(ts|tsx|js|jsx|py)$/,""),i=ro(e),r=[`${i}/${n}.test.ts`,`${i}/${n}.test.tsx`,`${i}/${n}.spec.ts`,`${i}/${n}.spec.tsx`,`${i}/__tests__/${n}.test.ts`,`${i}/__tests__/${n}.test.tsx`,`tests/${e.replace(/\.(ts|tsx|js|jsx)$/,".test.ts")}`,`test_${n}.py`,`tests/test_${n}.py`];for(let c of r){let a=oo(t,c);eo(a)&&o.push(c)}return o}function so(t){try{return to('git status --short 2>/dev/null || echo ""',{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(o=>o.trim()).map(o=>o.slice(3).trim()).filter(o=>/\.(ts|tsx|js|jsx|py)$/.test(o))}catch{return[]}}function ft(t){let e=t.tool_input.command||"",o=d();if(!/git\s+push|npm\s+run\s+test|pytest/.test(e))return s();if(/npm\s+run\s+test|pytest/.test(e))return s();let n=so(o);if(n.length===0)return s();let i=[];for(let c of n.slice(0,10)){let a=io(o,c);i.push(...a)}let r=[...new Set(i)];if(r.length>0){let c=`Related tests for changed files:
${r.slice(0,5).join(`
`)}${r.length>5?`
...`:""}

Consider running: npm run test -- ${r[0]}`;return l("allow",`Found ${r.length} related tests`,t),u("affected-tests-finder",`Tests: ${r.join(", ")}`),m(c)}return s()}import{existsSync as G}from"node:fs";import{join as M}from"node:path";function co(t){let e=[];return G(M(t,"package.json"))&&(e.push("npm run lint"),e.push("npm run typecheck"),e.push("npm run test")),G(M(t,"pyproject.toml"))&&(e.push("ruff check ."),e.push("mypy ."),e.push("pytest")),G(M(t,"go.mod"))&&(e.push("go vet ./..."),e.push("go test ./...")),e}function gt(t){let e=t.tool_input.command||"",o=d();if(!/git\s+push/.test(e))return s();let n=co(o);if(n.length===0)return s();let i=`Pre-push CI simulation suggested:
${n.slice(0,3).join(`
`)}

Run these locally to catch issues before CI fails.
Or: git push --no-verify to skip (not recommended)`;return l("allow","CI simulation suggested",t),u("ci-simulation",`Suggested checks: ${n.join(", ")}`),m(i)}import{existsSync as B}from"node:fs";import{join as W}from"node:path";function ao(t){return B(W(t,".pre-commit-config.yaml"))||B(W(t,".pre-commit-config.yml"))}function uo(t){return B(W(t,".husky"))}function ht(t){let e=t.tool_input.command||"",o=d();if(!/git\s+commit/.test(e))return s();if(/--no-verify/.test(e)){let n=`WARNING: --no-verify will skip pre-commit hooks.
Consider removing it unless intentional.
Skipped checks may cause CI failures.`;return l("allow","Skip pre-commit detected",t),u("pre-commit-simulation","--no-verify used"),m(n)}if(ao(o)){let n=`Pre-commit hooks will run: .pre-commit-config.yaml
If hooks fail, fix issues and retry.
Run manually: pre-commit run --all-files`;return l("allow","pre-commit config found",t),m(n)}if(uo(o)){let n=`Husky hooks will run: .husky/
If hooks fail, fix issues and retry.`;return l("allow","husky config found",t),m(n)}return s()}import{execSync as lo}from"node:child_process";function po(t,e){try{let o=e?`${e}`:"",n=lo(`gh pr view ${o} --json number,state,mergeable,statusCheckRollup,reviewDecision 2>/dev/null`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]});return JSON.parse(n)}catch{return null}}function kt(t){let e=t.tool_input.command||"",o=d();if(!/gh\s+pr\s+merge/.test(e))return s();let n=e.match(/gh\s+pr\s+merge\s+(\d+)/),i=n?parseInt(n[1],10):void 0,r=po(o,i);if(!r){let a=`Could not fetch PR status. Ensure:
1. gh CLI is installed and authenticated
2. You're in a git repository
3. PR exists and is accessible`;return l("allow","PR status unavailable",t),m(a)}let c=[];if(r.state!=="OPEN"&&c.push(`PR state: ${r.state} (expected OPEN)`),r.mergeable||c.push("PR has merge conflicts"),r.statusCheckRollup!=="SUCCESS"&&r.statusCheckRollup!=="PENDING"&&c.push(`Status checks: ${r.statusCheckRollup}`),r.reviewDecision==="CHANGES_REQUESTED"&&c.push("Changes requested by reviewer"),c.length>0){let a=`PR #${r.number} has issues:
${c.join(`
`)}

Resolve these before merging.`;return l("allow",`PR issues: ${c.join(", ")}`,t),u("pr-merge-gate",`PR #${r.number} has ${c.length} issues`),m(a)}return l("allow",`PR #${r.number} ready to merge`,t),s()}import{execSync as mo}from"node:child_process";function fo(t,e){try{let o=e?`--since="${e}"`:"--max-count=20";return mo(`git log ${o} --pretty=format:"%s" 2>/dev/null || echo ""`,{cwd:t,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(Boolean)}catch{return[]}}function go(t){let e={feat:[],fix:[],refactor:[],docs:[],test:[],chore:[],other:[]};for(let o of t){let n=o.match(/^(feat|fix|refactor|docs|test|chore|perf|ci|build)/);if(n){let i=n[1]==="perf"||n[1]==="ci"||n[1]==="build"?"chore":n[1];e[i].push(o)}else e.other.push(o)}return e}function yt(t){let e=t.tool_input.command||"",o=d();if(!/npm\s+version|poetry\s+version|changelog/.test(e))return s();let n=fo(o);if(n.length===0)return s();let i=go(n),r=[];if(i.feat.length>0&&r.push(`### Features
${i.feat.slice(0,5).map(a=>`- ${a}`).join(`
`)}`),i.fix.length>0&&r.push(`### Bug Fixes
${i.fix.slice(0,5).map(a=>`- ${a}`).join(`
`)}`),i.refactor.length>0||i.chore.length>0){let a=[...i.refactor,...i.chore];r.push(`### Maintenance
${a.slice(0,3).map(p=>`- ${p}`).join(`
`)}`)}if(r.length===0)return s();let c=`Suggested changelog entries:

${r.join(`

`)}

Update CHANGELOG.md before releasing.`;return l("allow","Changelog suggestions generated",t),u("changelog-generator",`Generated ${r.length} sections`),m(c)}import{existsSync as St,readFileSync as xt}from"node:fs";import{join as _t}from"node:path";function ho(t){let e=_t(t,"package.json");try{if(St(e))return JSON.parse(xt(e,"utf8")).version||null}catch{}return null}function ko(t){let e=_t(t,"pyproject.toml");try{if(St(e)){let n=xt(e,"utf8").match(/version\s*=\s*["']([^"']+)["']/);return n?n[1]:null}}catch{}return null}function yo(t){let e=[],o=ho(t);o&&e.push({file:"package.json",version:o});let n=ko(t);return n&&e.push({file:"pyproject.toml",version:n}),e}function $t(t){let e=t.tool_input.command||"",o=d();if(!/npm\s+version|poetry\s+version/.test(e))return s();let n=yo(o);if(n.length<2)return s();let i=n.map(c=>c.version),r=[...new Set(i)];if(r.length>1){let c=`Version mismatch detected:
${n.map(a=>`${a.file}: ${a.version}`).join(`
`)}

Consider syncing versions across all files.`;return l("allow","Version mismatch detected",t),u("version-sync",`Versions: ${i.join(", ")}`),m(c)}return l("allow",`Versions in sync: ${r[0]}`,t),s()}import{existsSync as So,readFileSync as xo}from"node:fs";import{join as _o}from"node:path";var $o=["GPL","AGPL","LGPL","CC-BY-NC","SSPL"];function bo(t){let e=[],o=_o(t,"package-lock.json");try{if(So(o)){let n=xo(o,"utf8");for(let i of $o)n.includes(`"license": "${i}`)&&e.push(`Found ${i} license in npm dependencies`)}}catch{}return e}function bt(t){let e=t.tool_input.command||"",o=d();if(!/npm\s+install|yarn\s+add|pip\s+install|poetry\s+add/.test(e))return s();if(/npm\s+ci|npm\s+install\s*$/.test(e))return s();let n=e.match(/(?:npm\s+install|yarn\s+add|pip\s+install|poetry\s+add)\s+(\S+)/),i=n?n[1]:null;if(!i)return s();let r=bo(o);if(r.length>0){let a=`License compliance check:
${r.join(`
`)}

New dependency: ${i}
Consider checking its license before adding.

Use: npm view ${i} license`;return l("allow","License compliance warning",t),u("license-compliance",`Checking: ${i}`),m(a)}let c=`Installing: ${i}
Verify license compatibility before production use.
Check: npm view ${i} license`;return l("allow",`Installing package: ${i}`,t),m(c)}var Rt={bug:`## Description
<!-- Clear description of the bug -->

## Steps to Reproduce
1.
2.
3.

## Expected Behavior
<!-- What should happen -->

## Actual Behavior
<!-- What actually happens -->

## Environment
- OS:
- Version:`,feature:`## Description
<!-- Clear description of the feature -->

## Motivation
<!-- Why is this feature needed? -->

## Proposed Solution
<!-- How should this be implemented? -->

## Alternatives Considered
<!-- Other approaches considered -->`,chore:`## Description
<!-- What maintenance task needs to be done? -->

## Impact
<!-- What does this affect? -->

## Checklist
- [ ] Task 1
- [ ] Task 2`};function Ro(t){return/--label.*bug|bug\s+report/i.test(t)?"bug":/--label.*feature|feature\s+request/i.test(t)?"feature":/--label.*chore|maintenance/i.test(t)?"chore":null}function Ct(t){let e=t.tool_input.command||"";if(!/gh\s+issue\s+create/.test(e))return s();if(/--body|--body-file|-b\s/.test(e))return s();let o=Ro(e);if(o&&Rt[o]){let i=`Issue type detected: ${o}

Suggested template:
${Rt[o].slice(0,200)}...

Add --body with template or use --web for interactive creation.`;return l("allow",`Issue creation: ${o}`,t),u("gh-issue-creation-guide",`Type: ${o}`),m(i)}let n=`Creating GitHub issue. Consider:
- Clear, descriptive title
- Add appropriate labels (bug, feature, chore)
- Include reproduction steps for bugs
- Reference related issues/PRs

Use --web for interactive creation with templates.`;return l("allow","Issue creation guidance",t),m(n)}var Co=`Documentation checklist for features:
- [ ] Update README.md if public API changes
- [ ] Add/update JSDoc or docstrings
- [ ] Update CHANGELOG.md
- [ ] Add usage examples
- [ ] Update API documentation`;function Ht(t){let e=t.tool_input.command||"";if(!/gh\s+(issue\s+close|pr\s+merge)/.test(e))return s();if(!(/--label.*feat/i.test(e)||/feat|feature/.test(e)))return s();let n=`Feature completion detected. Ensure documentation is updated.

${Co}

Skip with --no-edit if docs are already complete.`;return l("allow","Feature docs reminder",t),u("issue-docs-requirement","Feature completion - docs reminder"),m(n)}import{existsSync as It,readFileSync as Ho}from"node:fs";import{join as wt}from"node:path";function Io(t){let e=wt(t,".claude","coordination",".claude.db");return It(e)}function wo(t){let e=wt(t,".claude","coordination","work-registry.json");try{if(It(e))return JSON.parse(Ho(e,"utf8")).qualityGates||{}}catch{}return{}}function vt(t){let e=t.tool_input.command||"",o=d();if(!/gh\s+pr\s+merge|git\s+merge|deploy/.test(e))return s();if(!Io(o))return s();let n=wo(o),r=["tests","lint","typecheck"].filter(c=>!n[c]);if(r.length>0){let c=`Multi-instance quality gate check:
Failed/missing gates: ${r.join(", ")}

Run these checks before merging:
${r.map(a=>`- npm run ${a}`).join(`
`)}

Quality gates ensure consistency across instances.`;return l("allow",`Quality gates failed: ${r.join(", ")}`,t),u("multi-instance-quality-gate",`Failed: ${r.join(", ")}`),m(c)}return l("allow","All quality gates passed",t),s()}var vo=[/localhost.*admin/i,/127\.0\.0\.1.*admin/i,/internal\./i,/intranet\./i,/\.local\//i,/file:\/\//i,/accounts\.google\.com/i,/login\.microsoftonline\.com/i,/auth0\.com/i,/okta\.com/i,/login\.live\.com/i,/appleid\.apple\.com/i,/github\.com\/login/i,/gitlab\.com\/users\/sign_in/i],Po=["click.*delete","click.*remove","fill.*password","fill.*credit","submit.*payment"];function Do(t){let e=t.match(/(?:navigate|goto|open)\s+["']?([^"'\s]+)["']?/i);return e?e[1]:null}function Eo(t){return vo.some(e=>e.test(t))}function jo(t){return Po.some(e=>new RegExp(e,"i").test(t))}function Pt(t){let e=t.tool_input.command||"";if(!/agent-browser|ab\s/.test(e))return s();let o=Do(e);if(o&&Eo(o))return l("deny",`Blocked URL: ${o}`,t),u("agent-browser-safety",`BLOCKED: ${o}`),g(`agent-browser blocked: URL matches blocked pattern.

URL: ${o}

Blocked patterns include internal, localhost admin, and file:// URLs.
If this is intentional, use direct browser access instead.`);if(jo(e)){let n=`Sensitive browser action detected:
${e.slice(0,100)}...

This may interact with:
- Delete/remove buttons
- Password fields
- Payment forms

Proceed with caution. Verify target elements.`;return l("allow","Sensitive action warning",t),u("agent-browser-safety","Sensitive action detected"),m(n)}return l("allow","agent-browser command validated",t),s()}import{realpathSync as Lo,existsSync as To}from"node:fs";import{resolve as Oo,isAbsolute as Ao}from"node:path";var Fo=[/\.env$/,/\.env\.local$/,/\.env\.production$/,/credentials\.json$/,/secrets\.json$/,/private\.key$/,/\.pem$/,/id_rsa$/,/id_ed25519$/],No=[/package\.json$/,/pyproject\.toml$/,/tsconfig\.json$/];function Go(t,e){try{let o=Ao(t)?t:Oo(e,t);return To(o)?Lo(o):o}catch{return t}}function Mo(t){for(let e of Fo)if(e.test(t))return e;return null}function Bo(t){return No.some(e=>e.test(t))}function Dt(t){let e=t.tool_input.file_path||"",o=d();if(!e)return s();u("file-guard",`File write/edit: ${e}`);let n=Go(e,o);u("file-guard",`Resolved path: ${n}`);let i=Mo(n);return i?(l("deny",`Protected file blocked: ${e} (pattern: ${i})`,t),u("file-guard",`BLOCKED: ${e} matches ${i}`),g(`Cannot modify protected file: ${e}

Resolved path: ${n}
Matched pattern: ${i}

Protected files include:
- Environment files (.env, .env.local, .env.production)
- Credential files (credentials.json, secrets.json)
- Private keys (.pem, id_rsa, id_ed25519)

If you need to modify this file, do it manually outside Claude Code.`)):(Bo(n)&&(u("file-guard",`WARNING: Config file modification: ${n}`),l("warn",`Config file modification: ${e}`,t)),l("allow",`File write allowed: ${e}`,t),s())}import{existsSync as Et,readFileSync as Wo,writeFileSync as Uo}from"node:fs";import{join as jt}from"node:path";function qo(t){return jt(t,".claude","coordination","locks.json")}function zo(t){return Et(jt(t,".claude","coordination"))}function Ko(){return b()}function Vo(t,e){let o=new Date().toISOString(),n=e.locks?.length||0,i=(e.locks||[]).filter(r=>r.expires_at>o);if(i.length<n)try{Uo(t,JSON.stringify({locks:i},null,2)),u("file-lock-check",`Cleaned ${n-i.length} expired locks`)}catch{}return i}function Jo(t,e){let o=qo(t),n=Ko();try{if(!Et(o))return null;let i=JSON.parse(Wo(o,"utf8"));return Vo(o,i).find(a=>a.file_path===e&&a.instance_id!==n)||null}catch{return null}}function Lt(t){let e=t.tool_input.file_path||"",o=d(),n=t.tool_name;if(!e)return s();if(!zo(o))return s();if(e.includes(".claude/coordination"))return s();let i=e.startsWith(o)?e.slice(o.length+1):e,r=Jo(o,i);return r?(l("deny",`File ${e} locked by ${r.instance_id}`,t),u("file-lock-check",`BLOCKED: ${e} locked by ${r.instance_id}`),g(`File ${e} is locked by instance ${r.instance_id}.

Lock acquired at: ${r.acquired_at}
Expires at: ${r.expires_at}

You may want to wait or check the work registry:
.claude/coordination/work-registry.json`)):(l("allow",`Lock check passed for ${e}`,t),u("file-lock-check",`Lock check passed: ${e} (${n})`),s())}import{existsSync as z,readFileSync as Zo,writeFileSync as Qo,mkdirSync as Xo}from"node:fs";import{join as q,dirname as Yo}from"node:path";function tn(t){return q(t,".claude","coordination","locks.json")}function en(){return`lock-${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function on(){return b()}function nn(){return new Date(Date.now()+6e4).toISOString()}function rn(t){try{if(z(t))return JSON.parse(Zo(t,"utf8"))}catch{}return{locks:[]}}function U(t,e){let o=Yo(t);z(o)||Xo(o,{recursive:!0}),Qo(t,JSON.stringify(e,null,2))}function sn(t){let e=new Date().toISOString();return t.locks.filter(o=>o.expires_at>e)}function cn(t,e,o){return t.find(n=>n.file_path===e&&n.instance_id!==o)||null}function an(t,e,o){return t.find(n=>n.lock_type==="directory"&&e.startsWith(n.file_path)&&n.instance_id!==o)||null}function un(t,e,o,n){let i=new Date().toISOString();t.locks=t.locks.filter(r=>!(r.file_path===e&&r.instance_id===o)),t.locks.push({lock_id:en(),file_path:e,lock_type:"exclusive_write",instance_id:o,acquired_at:i,expires_at:nn(),reason:n})}function Tt(t){let e=it(t);if(e)return e;let o=t.tool_input.file_path||"",n=d(),i=t.tool_name;if(!o)return s();let r=tn(n),c=q(n,".instance");if(!z(q(c,"id.json")))return u("multi-instance-lock","No instance identity, passing through"),s();let a=o.startsWith(n)?o.slice(n.length+1):o,p=on(),f=rn(r),_=f.locks.length;f.locks=sn(f),f.locks.length<_&&u("multi-instance-lock",`Cleaned ${_-f.locks.length} expired locks`);let y=an(f.locks,a,p);if(y)return U(r,f),l("deny",`Directory ${y.file_path} locked by ${y.instance_id}`,t),u("multi-instance-lock",`BLOCKED: Directory lock by ${y.instance_id}`),g(`Directory ${y.file_path} is locked by another Claude instance (${y.instance_id}).
Wait for lock release.`);let $=cn(f.locks,a,p);return $?(U(r,f),l("deny",`File ${a} locked by ${$.instance_id}`,t),u("multi-instance-lock",`BLOCKED: ${a} locked by ${$.instance_id}`),g(`File ${a} is locked by another Claude instance (${$.instance_id}).
Wait for lock release.`)):(un(f,a,p,`Modifying via ${i}`),U(r,f),u("multi-instance-lock",`Lock acquired: ${a}`),l("allow",`Lock acquired for ${a}`,t),s())}import{existsSync as At,readFileSync as ln}from"node:fs";import{join as Ot}from"node:path";var pn={"api-layer":[/\/api\//,/\/routes\//,/\/endpoints\//],"service-layer":[/\/services\//],"data-layer":[/\/db\//,/\/models\//,/\/repositories\//],"workflow-layer":[/\/workflows\//,/\/agents\//],unknown:[]};function dn(t){for(let[e,o]of Object.entries(pn))if(e!=="unknown"&&o.some(n=>n.test(t)))return e;return"unknown"}function mn(t,e){let o=Ot(e,".claude","context","patterns"),n=Ot(o,`${t}.json`);try{if(At(n)){let i=ln(n,"utf8"),r=JSON.parse(i),c=Array.isArray(r)?r.length:Object.keys(r).length;if(c>0)return` | Patterns loaded: ${c}`}}catch{}return""}function Ft(t){let e=t.tool_input.file_path||"",o=t.project_dir||d();if(!e)return s();let i=nt(t,...["**/api/**","**/services/**","**/db/**","**/models/**","**/workflows/**"]);if(i!==null)return i;let r=dn(e);if(r==="unknown")return s();let c=mn(r,o),a=!At(e),p;return a?p=`New ${r} file. Follow layer conventions: dependency injection, interface contracts${c}`:p=`Modifying ${r}. Ensure: no breaking API changes, maintain layer boundaries${c}`,l("allow",`Architectural change: ${e} (${r})`,t),u("architecture-change-detector",`ARCH_DETECT: ${e} (layer=${r})`),I(t)?k(`[Quality Gate] ${p}`):h(p)}import{existsSync as fn,readFileSync as gn}from"node:fs";import{join as hn,extname as kn}from"node:path";var x=50,Nt=4,yn=10;function Sn(t){return kn(t).toLowerCase().replace(".","")}function xn(t,e){let o=[],n=t.split(`
`);if(e==="py"){let i=!1,r="",c=0;for(let a of n){let p=a.match(/^(\s*)(?:async\s+)?def\s+([a-zA-Z_][a-zA-Z0-9_]*)/),f=a.match(/^(\s*)class\s+/);p?(i&&c>x&&o.push(`Function '${r}' is ${c} lines (max: ${x})`),i=!0,r=p[2],c=1):f?(i&&c>x&&o.push(`Function '${r}' is ${c} lines (max: ${x})`),i=!1):i&&a.trim()&&c++}i&&c>x&&o.push(`Function '${r}' is ${c} lines (max: ${x})`)}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let i=0,r=0,c=!1,a="";for(let p of n){let f=p.match(/(?:function|func|fn)\s+([a-zA-Z_][a-zA-Z0-9_]*)/),_=p.match(/const\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*=\s*(?:async\s*)?\(/);if(f?(a=f[1],c=!0,r=0,i=0):_&&(a=_[1],c=!0,r=0,i=0),c){let y=(p.match(/\{/g)||[]).length,$=(p.match(/\}/g)||[]).length;i+=y-$,p.trim()&&r++,i<=0&&r>0&&(r>x&&o.push(`Function '${a}' is ${r} lines (max: ${x})`),c=!1)}}}return o}function _n(t,e){let o=[],n=t.split(`
`),i=0;if(e==="py")for(let r of n){let c=r.match(/^(\s*)(if|for|while|with|try|elif|else|except|finally)[\s:]/);if(c){let a=c[1].length,p=Math.floor(a/4);p>i&&(i=p)}}else if(["ts","tsx","js","jsx","go","java","rs"].includes(e)){let r=0;for(let c of n){let a=(c.match(/\{/g)||[]).length,p=(c.match(/\}/g)||[]).length;r+=a-p,/(?:if|for|while|switch|try)\s*\(/.test(c)&&r>i&&(i=r)}}return i>Nt&&o.push(`Deep nesting detected (depth: ${i}, max: ${Nt})`),o}function $n(t){let e=[],o=(t.match(/\b(if|elif|else if)\b/g)||[]).length,n=(t.match(/\b(switch|match)\b/g)||[]).length,i=(t.match(/\?[^:]+:/g)||[]).length,r=o+n+i,c=Math.max((t.match(/\b(def|function|func|fn)\b/g)||[]).length,1),a=Math.floor(r/c);return a>yn&&e.push(`High cyclomatic complexity (~${a} conditionals/function, consider refactoring)`),e}function bn(t,e){let o=hn(e,".claude","cache","type-errors.json");if(!fn(o))return"";try{let n=JSON.parse(gn(o,"utf8")),i=t.split("/").pop()||"";return n[i]||""}catch{return""}}function Gt(t){let e=t.tool_input.file_path||"",o=t.tool_input.content||"",n=t.project_dir||d(),i=H(t,C,j);if(i!==null)return i;if(!e||!o)return s();let r=Sn(e),c=[];c.push(...xn(o,r)),c.push(..._n(o,r)),c.push(...$n(o));let a=bn(e,n);if(a&&c.push(a),c.length>0){u("code-quality-gate",`Quality warnings for ${e}: ${c.join(", ")}`);let p=`Code quality: ${c.join(" | ")}`;return p.length>350&&(p=p.slice(0,347)+"..."),I(t)?k(`[Quality Gate] ${p}`):h(p)}return u("code-quality-gate",`No quality issues in ${e}`),s()}import{extname as Rn}from"node:path";function Cn(t){return Rn(t).toLowerCase().replace(".","")}function Hn(t){return[/test/i,/spec/i,/__tests__/i,/_test\.py$/,/\.test\.ts$/,/\.spec\.ts$/].some(o=>o.test(t))}function In(t){let e=[],o=t.split(`
`);for(let n=0;n<o.length;n++){let r=o[n].match(/^(?:\s*)(?:async\s+)?def\s+([^_][a-zA-Z0-9_]*)\s*\(/);if(r){let c=r[1],a=!1;for(let p=n+1;p<o.length;p++){let f=o[p].trim();if(f){(f.startsWith('"""')||f.startsWith("'''"))&&(a=!0);break}}if(!a&&(e.push(c),e.length>=5))break}}return e}function wn(t){let e=[],o=t.split(`
`),n=!1;for(let i=0;i<o.length;i++){let r=o[i];(i>0?o[i-1].trim():"").endsWith("*/")&&(n=!0);let a=r.match(/^export\s+(?:async\s+)?(?:function\s+([a-zA-Z][a-zA-Z0-9_]*)|const\s+([a-zA-Z][a-zA-Z0-9_]*)\s*=)/);if(a){let p=a[1]||a[2];if(!n&&(e.push(p),e.length>=5))break;n=!1}else r.trim().endsWith("*/")||(n=!1)}return e}function Mt(t){let e=t.tool_input.file_path||"",o=t.tool_input.content||"",n=H(t,C,j);if(n!==null)return n;if(!e||!o)return s();if(Hn(e))return s();let i=Cn(e),r=[];if(i==="py"?r=In(o):["ts","tsx","js","jsx"].includes(i)&&(r=wn(o)),r.length>0){let c=r.join(", "),a;return i==="py"?a=`Documentation: ${r.length} public function(s) missing docstrings: ${c}. Consider adding """docstrings""" for better code documentation.`:a=`Documentation: ${r.length} exported function(s) missing JSDoc: ${c}. Consider adding /** JSDoc */ comments for better IDE support.`,a.length>200&&(i==="py"?a=`Documentation: ${r.length} public function(s) missing docstrings. Add """docstrings""" for better documentation.`:a=`Documentation: ${r.length} exported function(s) missing JSDoc. Add /** JSDoc */ for better IDE support.`),u("docstring-enforcer",`DOCSTRING_WARN: ${r.length} functions missing docs in ${e}`),I(t)?k(`[Quality Gate] ${a}`):h(a)}return u("docstring-enforcer",`DOCSTRING_OK: All public functions documented in ${e}`),s()}import{basename as vn}from"node:path";var Pn=[{name:"Potential hardcoded secret detected",pattern:/(api[_-]?key|password|secret|token)\s*[=:]\s*['"][^'"]+['"]/i,severity:"high"},{name:"Potential SQL injection vulnerability",pattern:/execute\s*\(\s*['"].*\+|f['"].*SELECT.*\{/,severity:"high"},{name:"Dangerous eval/exec usage detected",pattern:/eval\s*\(|exec\s*\(/,severity:"high"},{name:"Subprocess with shell=True detected",pattern:/subprocess\.(run|call|Popen).*shell\s*=\s*True/,severity:"medium"},{name:"Potential XSS vulnerability (innerHTML)",pattern:/\.innerHTML\s*=|dangerouslySetInnerHTML/,severity:"medium"},{name:"Insecure random number generation",pattern:/Math\.random\(\).*(?:password|token|secret|key)/i,severity:"medium"},{name:"Potential command injection",pattern:/os\.system\s*\(|os\.popen\s*\(/,severity:"high"},{name:"Insecure HTTP (should use HTTPS)",pattern:/http:\/\/(?!localhost|127\.0\.0\.1)/,severity:"low"}];function Dn(t){let e=[];for(let{name:o,pattern:n}of Pn)n.test(t)&&e.push(o);return e}function Bt(t){let e=t.tool_input.file_path||"",o=t.tool_input.content||"",n=H(t,C);if(n!==null)return n;if(!e)return s();let i=Dn(o);if(i.length>0){u("security-pattern-validator",`SECURITY_WARN: ${e} - ${i.join(", ")}`);let r=`Security warnings for ${vn(e)}: ${i.join(", ")}`;return l("warn",`Security issues in ${e}: ${i.join(", ")}`,t),h(r)}return u("security-pattern-validator",`SECURITY_OK: ${e}`),l("allow",`No security issues in ${e}`,t),s()}import{existsSync as Wt,readFileSync as En,appendFileSync as jn,statSync as Ln,renameSync as Tn,mkdirSync as On}from"node:fs";import{join as An}from"node:path";var Fn=102400;function Nn(){let t=S();return An(t,"context7-telemetry.log")}function Gn(t){try{Wt(t)&&Ln(t).size>Fn&&Tn(t,`${t}.old`)}catch{}}function Mn(t){if(!Wt(t))return"";try{let o=En(t,"utf8").trim().split(`
`).filter(Boolean),n=o.length;if(n===0)return"";let i=new Set;for(let a of o){let p=a.match(/library=([^| ]+)/);p&&p[1]&&p[1]!==""&&i.add(p[1])}let r=[];for(let a=o.length-1;a>=0&&r.length<3;a--){let p=o[a].match(/library=([^| ]+)/);p&&p[1]&&!r.includes(p[1])&&r.push(p[1])}let c=r.length>0?r.join(", "):"none";return`Context7: ${n} queries, ${i.size} libraries. Recent: ${c}`}catch{return""}}function Ut(t){let e=t.tool_name||"";if(!e.startsWith("mcp__context7__"))return s();let o=t.tool_input.libraryId||"",n=t.tool_input.query||"",i=S();try{On(i,{recursive:!0})}catch{}let r=Nn();Gn(r);let a=`${new Date().toISOString()} | tool=${e} | library=${o} | query_length=${n.length}
`;try{jn(r,a)}catch{}let p=Mn(r);return l("allow",`Documentation lookup: ${o}`,t),u("context7-tracker",`Query: ${e} library=${o}`),p?h(p):s()}import{existsSync as qt,mkdirSync as zt,readFileSync as Bn,writeFileSync as Wn,readdirSync as Un}from"node:fs";import{join as v}from"node:path";function qn(t,e){let o=v(t,".claude","logs"),n=0;if(!qt(o))return 0;try{let i=Un(o);for(let r of i)if(r.startsWith(".mem0-pending-sync-")&&r.endsWith(".json")){let c=r.replace(".mem0-pending-sync-","").replace(".json","");c!==e&&c!=="unknown"&&n++}}catch{}return n}function zn(t){let e=[v(t,".claude","logs","mem0-processed"),v(t,".claude","context","session")];for(let o of e)try{zt(o,{recursive:!0})}catch{}}function Kn(){return process.env.MEM0_API_KEY?"enhanced":"ready"}function Vn(t,e){let o=v(t,".claude","logs",".memory-fabric-sessions.json"),n=new Date().toISOString();try{zt(v(t,".claude","logs"),{recursive:!0});let i={};if(qt(o)){let r=Bn(o,"utf8");i=JSON.parse(r).sessions||{}}i[e]={active:!0,last_seen:n},Wn(o,JSON.stringify({sessions:i},null,2))}catch{}}function Kt(t){let e=t.project_dir||d(),o=t.session_id||w();u("memory-fabric-init","Memory Fabric lazy initialization triggered"),zn(e),Vn(e,o);let n=qn(e,o),i=Kn();u("memory-fabric-init",`Initialization complete: health=${i}, orphaned=${n}`);let r="";return n>0&&(r=`[Memory Fabric] Detected ${n} orphaned session(s) with pending syncs.
Consider running maintenance: claude --maintenance`),i==="enhanced"?u("memory-fabric-init","Memory Fabric ready (enhanced mode with mem0)"):u("memory-fabric-init","Memory Fabric ready (graph mode)"),r?h(r):s()}function Vt(t){let e=t.tool_name||"";if(!e.startsWith("mcp__memory__"))return s();switch(e){case"mcp__memory__delete_entities":{let o=t.tool_input.entityNames,n=Array.isArray(o)?o.length:0;if(n>5)return l("warn",`Bulk delete: ${n} entities`,t),u("memory-validator",`WARN: Bulk entity delete: ${n} entities`),k(`Deleting ${n} entities from knowledge graph`);break}case"mcp__memory__delete_relations":{let o=t.tool_input.relations,n=Array.isArray(o)?o.length:0;if(n>10)return l("warn",`Bulk relation delete: ${n} relations`,t),u("memory-validator",`WARN: Bulk relation delete: ${n} relations`),k(`Deleting ${n} relations from knowledge graph`);break}case"mcp__memory__create_entities":{let o=t.tool_input.entities;if(!Array.isArray(o))return l("allow","Creating entities (non-array input)",t),s();let n=o.length,i=o.filter(r=>!r.name||r.name===""||!r.entityType||r.entityType==="").length;if(i>0)return l("warn",`Invalid entities: ${i} missing name or entityType`,t),u("memory-validator",`WARN: ${i} entities missing required fields`),k(`${i} entities missing required fields (name, entityType)`);l("allow",`Creating ${n} valid entities`,t);break}case"mcp__memory__create_relations":{let o=t.tool_input.relations;if(!Array.isArray(o))return l("allow","Creating relations (non-array input)",t),s();let n=o.length,i=o.filter(r=>!r.from||!r.to||!r.relationType).length;if(i>0)return l("warn",`Invalid relations: ${i} missing from/to/relationType`,t),u("memory-validator",`WARN: ${i} relations missing required fields`),k(`${i} relations missing required fields`);l("allow",`Creating ${n} valid relations`,t);break}default:l("allow",`Read operation: ${e}`,t);break}return s()}import{existsSync as Jn,appendFileSync as Zn,statSync as Qn,renameSync as Xn,mkdirSync as Yn}from"node:fs";import{join as tr}from"node:path";var er=102400;function or(){let t=S();return tr(t,"sequential-thinking.log")}function nr(t){try{Jn(t)&&Qn(t).size>er&&Xn(t,`${t}.old`)}catch{}}function Jt(t){if(!(t.tool_name||"").startsWith("mcp__sequential-thinking__"))return s();let o=t.tool_input.thought||"",n=t.tool_input.thoughtNumber||1,i=t.tool_input.totalThoughts||1,r=t.tool_input.nextThoughtNeeded||!1,c=t.tool_input.isRevision||!1,a=S();try{Yn(a,{recursive:!0})}catch{}let p=or();nr(p);let _=`${new Date().toISOString()} | step=${n}/${i} | revision=${c} | next_needed=${r} | thought_length=${o.length}
`;try{Zn(p,_)}catch{}return n===1?(l("allow",`Starting reasoning chain (${i} estimated thoughts)`,t),u("sequential-thinking-auto",`Starting chain: ${i} thoughts`)):c?(l("allow",`Revision at step ${n}`,t),u("sequential-thinking-auto",`Revision at step ${n}`)):r?(l("allow",`Reasoning step ${n}/${i}`,t),u("sequential-thinking-auto",`Step ${n}/${i}`)):(l("allow",`Completed reasoning chain at step ${n}`,t),u("sequential-thinking-auto",`Completed at step ${n}`)),s()}import{existsSync as rr}from"node:fs";import{extname as ir}from"node:path";function sr(){return new Date().toISOString().split("T")[0]}function cr(t,e){let o=sr();switch(t.toLowerCase()){case"py":return`# Generated by OrchestKit Claude Plugin
# Created: ${o}

${e}`;case"js":case"ts":return`// Generated by OrchestKit Claude Plugin
// Created: ${o}

${e}`;case"sh":{if(e.startsWith("#!/")){let n=e.indexOf(`
`),i=e.slice(0,n),r=e.slice(n+1);return`${i}
# Generated by OrchestKit Claude Plugin
# Created: ${o}

${r}`}return`#!/bin/bash
# Generated by OrchestKit Claude Plugin
# Created: ${o}

${e}`}case"sql":return`-- Generated by OrchestKit Claude Plugin
-- Created: ${o}

${e}`;case"html":case"xml":return`<!-- Generated by OrchestKit Claude Plugin - ${o} -->

${e}`;case"css":case"scss":case"sass":return`/* Generated by OrchestKit Claude Plugin - ${o} */

${e}`;case"yaml":case"yml":return`# Generated by OrchestKit Claude Plugin
# Created: ${o}

${e}`;case"json":return e;default:return e}}function ar(t,e){return D({file_path:t,content:e})}function Zt(t){let e=t.tool_name||"",o=t.tool_input.file_path||"",n=t.tool_input.content||"";if(e!=="Write")return s();if(rr(o))return s();let i=ir(o).replace(".","");if(n.includes("OrchestKit"))return u("write-headers",`Skipping header for ${o} (already has OrchestKit marker)`),s();let r=cr(i,n);return r!==n?(u("write-headers",`Added header to ${o}`),ar(o,r)):s()}import{existsSync as ur,appendFileSync as lr,mkdirSync as pr}from"node:fs";import{join as Qt,dirname as dr,basename as mr}from"node:path";function fr(t){try{ur(t)||pr(t,{recursive:!0})}catch{}}function Xt(t,e){try{fr(dr(t)),lr(t,e)}catch{}}function Yt(t){let e=t.tool_input.skill||"",o=t.tool_input.args||"",n=t.project_dir||d();if(!e)return s();u("skill-tracker",`Skill invocation: ${e}${o?` (args: ${o})`:""}`);let i=Qt(n,".claude","logs","skill-usage.log"),r=new Date().toISOString();Xt(i,`${r} | ${e} | ${o||"no args"}
`);let c=Qt(n,".claude","logs","skill-analytics.jsonl"),a=JSON.stringify({skill:e,args:o||"",timestamp:r,project:mr(n),phase:"start"});return Xt(c,a+`
`),u("skill-tracker",`Skill usage logged for ${e}`),s()}var te={"pretool/bash/dangerous-command-blocker":st,"pretool/bash/git-validator":ct,"pretool/bash/compound-command-validator":at,"pretool/bash/default-timeout-setter":lt,"pretool/bash/error-pattern-warner":pt,"pretool/bash/conflict-predictor":mt,"pretool/bash/affected-tests-finder":ft,"pretool/bash/ci-simulation":gt,"pretool/bash/pre-commit-simulation":ht,"pretool/bash/pr-merge-gate":kt,"pretool/bash/changelog-generator":yt,"pretool/bash/version-sync":$t,"pretool/bash/license-compliance":bt,"pretool/bash/gh-issue-creation-guide":Ct,"pretool/bash/issue-docs-requirement":Ht,"pretool/bash/multi-instance-quality-gate":vt,"pretool/bash/agent-browser-safety":Pt,"pretool/write-edit/file-guard":Dt,"pretool/write-edit/file-lock-check":Lt,"pretool/write-edit/multi-instance-lock":Tt,"pretool/Write/architecture-change-detector":Ft,"pretool/Write/code-quality-gate":Gt,"pretool/Write/docstring-enforcer":Mt,"pretool/Write/security-pattern-validator":Bt,"pretool/mcp/context7-tracker":Ut,"pretool/mcp/memory-fabric-init":Kt,"pretool/mcp/memory-validator":Vt,"pretool/mcp/sequential-thinking-auto":Jt,"pretool/input-mod/write-headers":Zt,"pretool/skill/skill-tracker":Yt};function Mc(t){return te[t]}function Bc(){return Object.keys(te)}export{Yr as createGuard,Wr as escapeRegex,Ee as estimateTokenCount,Le as extractIssueNumber,Y as getCachedBranch,je as getCurrentBranch,Zr as getDefaultBranch,Tr as getEnvFile,Br as getField,A as getGitStatus,Mc as getHook,S as getLogDir,Ie as getLogLevel,He as getPluginRoot,d as getProjectDir,Kr as getRepoRoot,w as getSessionId,ni as guardBash,C as guardCodeFiles,F as guardFileExtension,ii as guardGitCommand,si as guardMultiInstance,ri as guardNontrivialBash,nt as guardPathPattern,ti as guardPythonFiles,j as guardSkipInternal,oi as guardTestFiles,rt as guardTool,ei as guardTypescriptFiles,it as guardWriteEdit,Jr as hasUncommittedChanges,te as hooks,hr as isBashInput,I as isDontAskMode,yr as isEditInput,Vr as isGitRepo,O as isProtectedBranch,Sr as isReadInput,kr as isWriteInput,Bc as listHooks,u as logHook,l as logPermissionFeedback,E as normalizeCommand,Or as normalizeLineEndings,m as outputAllowWithContext,Fr as outputBlock,g as outputDeny,Nr as outputError,ve as outputPromptContext,Gr as outputPromptContextBudgeted,Ar as outputSilentAllow,s as outputSilentSuccess,k as outputWarning,h as outputWithContext,D as outputWithUpdatedInput,Mr as readHookInput,H as runGuards,we as shouldLog,ot as validateBranchName};
//# sourceMappingURL=pretool.mjs.map
