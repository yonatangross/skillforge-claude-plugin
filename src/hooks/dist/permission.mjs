// OrchestKit Hooks - permission bundle
// Generated: 2026-01-30T15:29:44.454Z

var D=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(o,e)=>(typeof require<"u"?require:o)[e]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function rt(t){return typeof t.command=="string"}function st(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function it(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function ut(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as _,existsSync as R,statSync as C,renameSync as A,mkdirSync as L,readSync as U}from"node:fs";import{execSync as B}from"node:child_process";import j from"node:os";import l from"node:path";function $(){return process.env.HOME||process.env.USERPROFILE||j.homedir()}function g(){return process.env.CLAUDE_PROJECT_DIR||"."}function h(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function x(){return process.env.CLAUDE_PLUGIN_ROOT?l.join($(),".claude","logs","ork"):l.join(g(),".claude","logs")}var lt=l.join,gt=l.sep;function I(){return x()}function d(){return g()}function H(){return h()}function f(){return process.env.CLAUDE_SESSION_ID||`fallback-${process.pid}-${Date.now()}`}function ht(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let o=B("git branch --show-current",{cwd:t||d(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=o,o}catch{return"unknown"}}function F(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function G(t){let o=["debug","info","warn","error"];return o.indexOf(t)>=o.indexOf(F())}function r(){return{continue:!0,suppressOutput:!0}}function p(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function xt(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function _t(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function N(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function Rt(t,o){let e={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return o?e.systemMessage=o:e.suppressOutput=!0,e}function It(t){return{continue:!0,systemMessage:t}}function Ht(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function yt(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}var W=200*1024,M=100*1024;function y(t,o){if(R(t))try{if(C(t).size>o){let n=`${t}.old.${Date.now()}`;A(t,n)}}catch{}}function v(t){R(t)||L(t,{recursive:!0})}function u(t,o,e="debug"){if(!G(e))return;let n=I(),s=`${n}/hooks.log`;try{v(n),y(s,W);let i=new Date().toISOString().replace("T"," ").slice(0,19);_(s,`[${i}] [${e.toUpperCase()}] [${t}] ${o}
`)}catch{}}function a(t,o,e){let n=I(),s=`${n}/permission-feedback.log`;try{v(n),y(s,M);let i=new Date().toISOString(),k=e?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",c=e?.session_id||f();_(s,`${i} | ${t} | ${o} | tool=${k} | session=${c}
`)}catch{}}function z(t){if(!t)return 0;let n=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/n)}function vt(t,o,e,n,s){let i=z(t);return n&&n.isOverBudget(e)?(u(o,`Budget exhausted for ${e}, suppressing ${i}t`),r()):(s&&s.trackTokenUsage(o,e,i),N(t))}function St(){try{let t=[],e=Buffer.allocUnsafe(256),n,s=0;for(;;)try{if(n=U(s,e,0,256,null),n===0)break;t.push(Buffer.from(e.subarray(0,n)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:f(),tool_input:{}}}catch{return{tool_name:"",session_id:f(),tool_input:{}}}}function Pt(t,o){let e=o.replace(/^\./,"").split("."),n=t;for(let s of e){if(n==null)return;n=n[s]}return n}function bt(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function wt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ot(t){return o=>t(o)?null:r()}function m(t,...o){let e=t.tool_input.file_path;if(!e)return r();let n=e.split(".").pop()?.toLowerCase()||"";return o.map(i=>i.toLowerCase().replace(/^\./,"")).includes(n)?null:r()}function Dt(t){return m(t,"py","ts","tsx","js","jsx","go","rs","java")}function jt(t){return m(t,"py")}function $t(t){return m(t,"ts","tsx","js","jsx")}function Ct(t){let o=t.tool_input.file_path;return o?[/test/i,/spec/i,/__tests__/i].some(n=>n.test(o))?null:r():r()}function At(t){let o=t.tool_input.file_path||"";return o&&[/\/\.claude\//,/\/node_modules\//,/\/\.git\//,/\/dist\//,/\/build\//,/\/__pycache__\//,/\/\.venv\//,/\/venv\//,/\.lock$/].some(n=>n.test(o))?r():null}function Lt(t,...o){let e=t.tool_input.file_path;if(!e)return r();for(let n of o)if(typeof n=="string"){if(new RegExp(n.replace(/\*/g,".*").replace(/\?/g,".")).test(e))return null}else if(n.test(e))return null;return r()}function S(t,...o){let e=t.tool_name;return e?o.includes(e)?null:r():r()}function Ut(t){return S(t,"Write","Edit")}function Bt(t){return S(t,"Bash")}function Ft(t){let o=t.tool_input.command||"";return[/^echo\s/,/^ls(\s|$)/,/^pwd$/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^date$/,/^whoami$/].some(n=>n.test(o))?r():null}function Gt(t){return(t.tool_input.command||"").startsWith("git")?null:r()}function Nt(t){let e=`${t.project_dir||process.env.CLAUDE_PROJECT_DIR||"."}/.claude/coordination/.claude.db`;try{let{existsSync:n}=D("node:fs");if(n(e))return null}catch{}return r()}function Wt(t,...o){for(let e of o){let n=e(t);if(n!==null)return n}return null}var q=[/^git (status|log|diff|branch|show|fetch|pull)/,/^git checkout/,/^npm (list|ls|outdated|audit|run|test)/,/^pnpm (list|ls|outdated|audit|run|test)/,/^yarn (list|outdated|audit|run|test)/,/^poetry (show|run|env)/,/^docker (ps|images|logs|inspect)/,/^docker-compose (ps|logs)/,/^docker compose (ps|logs)/,/^ls(\s|$)/,/^pwd$/,/^echo\s/,/^cat\s/,/^head\s/,/^tail\s/,/^wc\s/,/^find\s/,/^which\s/,/^type\s/,/^env$/,/^printenv/,/^gh (issue|pr|repo|workflow) (list|view|status)/,/^gh milestone/,/^pytest/,/^poetry run pytest/,/^npm run (test|lint|typecheck|format)/,/^ruff (check|format)/,/^ty check/,/^mypy/];function P(t){let o=t.tool_input.command||"";u("auto-approve-safe-bash",`Evaluating bash command: ${o.slice(0,50)}...`);for(let e of q)if(e.test(o))return u("auto-approve-safe-bash",`Auto-approved: matches safe pattern ${e}`),a("allow",`Matches safe pattern: ${e}`,t),p();return u("auto-approve-safe-bash","Command requires manual approval"),r()}import{resolve as K,isAbsolute as b,relative as J,normalize as w}from"node:path";var Z=["node_modules",".git","dist","build","__pycache__",".venv","venv"];function E(t){let o=t.tool_input.file_path||"",e=d();u("auto-approve-project-writes",`Evaluating write to: ${o}`),b(o)||(o=K(e,o));let n=w(o),s=w(e),i=J(s,n);if(!i.startsWith("..")&&!b(i)){for(let c of Z)if(o.includes(`/${c}/`))return u("auto-approve-project-writes",`Write to excluded directory: ${c}`),r();return u("auto-approve-project-writes","Auto-approved: within project directory"),a("allow",`In-project write: ${o}`,t),p()}return u("auto-approve-project-writes","Write outside project directory - manual approval required"),r()}import{existsSync as X,readFileSync as V}from"node:fs";import{join as Y}from"node:path";var Q=[/rm\s+-rf\s+[/~]/,/sudo\s/,/chmod\s+-R\s+777/,/>\s*\/dev\/sd/,/mkfs\./,/dd\s+if=/,/:.*\(\).*\{.*\|.*&.*\}/,/curl.*\|\s*sh/,/wget.*\|\s*sh/];function tt(t){return Q.some(o=>o.test(t))}function ot(){let t=H(),o=Y(t,".claude","feedback","learned-patterns.json");try{if(X(o))return JSON.parse(V(o,"utf8")).autoApprovePatterns||[]}catch{}return[]}function et(t){let o=ot();for(let e of o)try{if(new RegExp(e).test(t))return!0}catch{}return!1}function T(t){let o=t.tool_name,e=t.tool_input.command||t.tool_input.file_path||"";if(u("learning-tracker",`Processing permission for tool: ${o}, command: ${e.slice(0,50)}...`),o==="Bash"&&e){if(tt(e))return u("learning-tracker","Command matches security blocklist, skipping"),r();if(et(e))return u("learning-tracker","Command matches learned auto-approve pattern"),a("allow","Learned pattern match",t),p()}return r()}var O={"permission/auto-approve-safe-bash":P,"permission/auto-approve-project-writes":E,"permission/learning-tracker":T};function no(t){return O[t]}function ro(){return Object.keys(O)}export{Ot as createGuard,wt as escapeRegex,z as estimateTokenCount,ht as getCachedBranch,Pt as getField,no as getHook,I as getLogDir,F as getLogLevel,H as getPluginRoot,d as getProjectDir,f as getSessionId,Bt as guardBash,Dt as guardCodeFiles,m as guardFileExtension,Gt as guardGitCommand,Nt as guardMultiInstance,Ft as guardNontrivialBash,Lt as guardPathPattern,jt as guardPythonFiles,At as guardSkipInternal,Ct as guardTestFiles,S as guardTool,$t as guardTypescriptFiles,Ut as guardWriteEdit,O as hooks,rt as isBashInput,it as isEditInput,ut as isReadInput,st as isWriteInput,ro as listHooks,u as logHook,a as logPermissionFeedback,bt as normalizeCommand,Rt as outputAllowWithContext,xt as outputBlock,yt as outputDeny,It as outputError,N as outputPromptContext,vt as outputPromptContextBudgeted,p as outputSilentAllow,r as outputSilentSuccess,Ht as outputWarning,_t as outputWithContext,St as readHookInput,Wt as runGuards,G as shouldLog};
//# sourceMappingURL=permission.mjs.map
