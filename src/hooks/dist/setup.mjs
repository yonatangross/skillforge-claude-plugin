// OrchestKit Hooks - setup bundle
// Generated: 2026-01-27T19:46:44.566Z

function $e(t){return typeof t.command=="string"}function Se(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function be(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function ve(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as z,existsSync as G,statSync as $t,renameSync as St,mkdirSync as bt,readSync as vt}from"node:fs";import{execSync as _t}from"node:child_process";function Z(){return process.env.CLAUDE_PLUGIN_ROOT?`${process.env.HOME}/.claude/logs/ork`:`${k()}/.claude/logs`}function k(){return process.env.CLAUDE_PROJECT_DIR||"."}function $(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function j(){return process.env.CLAUDE_SESSION_ID||`fallback-${process.pid}-${Date.now()}`}function Re(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=_t("git branch --show-current",{cwd:t||k(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function Dt(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function It(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(Dt())}function m(){return{continue:!0,suppressOutput:!0}}function Ee(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function xe(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function y(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function Ce(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function Oe(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function we(t){return{continue:!0,systemMessage:t}}function He(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function Te(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}var Rt=200*1024,Et=100*1024;function Y(t,e){if(G(t))try{if($t(t).size>e){let o=`${t}.old.${Date.now()}`;St(t,o)}}catch{}}function X(t){G(t)||bt(t,{recursive:!0})}function s(t,e,n="debug"){if(!It(n))return;let o=Z(),r=`${o}/hooks.log`;try{X(o),Y(r,Rt);let i=new Date().toISOString().replace("T"," ").slice(0,19);z(r,`[${i}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function Me(t,e,n){let o=Z(),r=`${o}/permission-feedback.log`;try{X(o),Y(r,Et);let i=new Date().toISOString(),c=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=n?.session_id||j();z(r,`${i} | ${t} | ${e} | tool=${c} | session=${a}
`)}catch{}}function Pe(){try{let t=[],n=Buffer.allocUnsafe(256),o,r=0;for(;;)try{if(o=vt(r,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let i=Buffer.concat(t).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:j(),tool_input:{}}}catch{return{tool_name:"",session_id:j(),tool_input:{}}}}function Fe(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let r of n){if(o==null)return;o=o[r]}return o}function Ne(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function Ae(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{existsSync as Q,mkdirSync as xt,writeFileSync as tt,readdirSync as U,chmodSync as Ct}from"node:fs";import{execSync as _}from"node:child_process";var L="4.25.0";function Ot(){s("first-run-setup","Phase 1: Detecting environment");let t={os:process.platform};try{let n=_("python3 --version",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}).match(/(\d+\.\d+)/);n&&(t.python=n[1],s("first-run-setup",`Python: ${n[1]}`))}catch{}try{let n=_("node --version",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}).match(/(\d+\.\d+)/);n&&(t.nodejs=n[1],s("first-run-setup",`Node.js: ${n[1]}`))}catch{}try{_("which git",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}),t.git=!0,s("first-run-setup","Git: available")}catch{}try{_("which docker",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}),t.docker=!0,s("first-run-setup","Docker: available")}catch{}try{_("which sqlite3",{encoding:"utf8",stdio:["pipe","pipe","pipe"]}),t.sqlite3=!0,s("first-run-setup","SQLite3: available (multi-instance coordination enabled)")}catch{}return t}function wt(){s("first-run-setup","Phase 2: Validating dependencies");let t=[],e=[];try{_("which jq",{encoding:"utf8",stdio:["pipe","pipe","pipe"]})}catch{t.push("jq (required for JSON processing)")}try{_("which sqlite3",{encoding:"utf8",stdio:["pipe","pipe","pipe"]})}catch{e.push("sqlite3 not found - multi-instance coordination disabled")}try{_('python3 -c "import anthropic"',{encoding:"utf8",stdio:["pipe","pipe","pipe"]}),s("first-run-setup","Anthropic SDK: available (Memory Fabric Agent enabled)")}catch{e.push("anthropic SDK not found - Memory Fabric Agent will use fallback mode"),e.push("  Install with: pip install 'orchestkit[memory]'")}if(t.length>0){s("first-run-setup","ERROR: Missing required dependencies:");for(let n of t)s("first-run-setup",`  - ${n}`)}for(let n of e)s("first-run-setup",`WARN: ${n}`);return{valid:t.length===0,missing:t,warnings:e}}function Ht(t){let e={complete:{preset:"complete",description:"Full AI-assisted development toolkit",features:{skills:!0,agents:!0,hooks:!0,mcp:!0,coordination:!0,statusline:!0},hook_groups:{safety:!0,quality:!0,productivity:!0,observability:!0}},standard:{preset:"standard",description:"Skills and hooks without agent orchestration",features:{skills:!0,agents:!1,hooks:!0,mcp:!0,coordination:!0,statusline:!0},hook_groups:{safety:!0,quality:!0,productivity:!0,observability:!0}},lite:{preset:"lite",description:"Essential skills for constrained environments",features:{skills:!0,agents:!1,hooks:!0,mcp:!1,coordination:!1,statusline:!1},hook_groups:{safety:!0,quality:!0,productivity:!1,observability:!1}},"hooks-only":{preset:"hooks-only",description:"Safety hooks only for pure automation",features:{skills:!1,agents:!1,hooks:!0,mcp:!1,coordination:!1,statusline:!1},hook_groups:{safety:!0,quality:!1,productivity:!1,observability:!1}}};return e[t]||e.complete}function Tt(t,e,n){s("first-run-setup",`Phase 4: Applying configuration (preset: ${t})`);let o=Ht(t),r=[`${n}/.claude/defaults`,`${n}/.claude/context/session`,`${n}/.claude/context/knowledge`,`${n}/.claude/logs`];for(let c of r)try{xt(c,{recursive:!0})}catch{}let i=`${n}/.claude/defaults/config.json`;Q(i)||(tt(i,JSON.stringify(o,null,2)),s("first-run-setup",`Created config file: ${i}`));try{let c=`${n}/hooks`;if(Q(c)){let a=u=>{try{let l=U(u,{withFileTypes:!0});for(let f of l){let p=`${u}/${f.name}`;if(f.isDirectory())a(p);else if(f.name.endsWith(".sh"))try{Ct(p,493)}catch{}}}catch{}};a(c),s("first-run-setup","Made hooks executable")}}catch{}return o}function Mt(t,e,n){s("first-run-setup","Phase 5: Creating marker file");let o=new Date().toISOString(),r=0,i=0,c=0;try{let l=(f,p)=>{let d=0,g=b=>{try{let v=U(b,{withFileTypes:!0});for(let h of v){let O=`${b}/${h.name}`;h.isDirectory()?g(O):p.test(h.name)&&d++}}catch{}};return g(f),d};r=l(`${n}/hooks`,/\.sh$/),i=l(`${n}/skills`,/SKILL\.md$/),c=l(`${n}/agents`,/\.md$/)}catch{}let a={version:L,setup_date:o,preset:t,components:{hooks:{count:r,valid:!0},skills:{count:i,valid:!0},agents:{count:c,valid:!0}},last_health_check:o,last_maintenance:o,environment:e,user_preferences:{onboarding_completed:!0,mcp_configured:!1,statusline_configured:!1}},u=`${n}/.setup-complete`;tt(u,JSON.stringify(a,null,2)),s("first-run-setup",`Marker file created: ${u}`)}function et(t){let e=$(),n=process.argv.includes("--silent")?"silent":"interactive";s("first-run-setup",`First-run setup starting (mode: ${n})`);let o=Ot(),{valid:r,missing:i}=wt();if(!r){s("first-run-setup","ERROR: Dependency validation failed");let p=`OrchestKit setup failed: Missing required dependencies. Install ${i.join(", ")}.`;return y(p)}let c="complete";n==="interactive"?s("first-run-setup","Interactive mode - using complete preset (wizard via Claude conversation)"):s("first-run-setup","Silent mode - using complete preset"),Tt(c,o,e),Mt(c,o,e);let a=0,u=0,l=0;try{let p=(d,g)=>{let b=0,v=h=>{try{let O=U(h,{withFileTypes:!0});for(let A of O){let kt=`${h}/${A.name}`;A.isDirectory()?v(kt):g.test(A.name)&&b++}}catch{}};return v(d),b};a=p(`${e}/hooks`,/\.sh$/),u=p(`${e}/skills`,/SKILL\.md$/),l=p(`${e}/agents`,/\.md$/)}catch{}s("first-run-setup",`Setup complete: ${u} skills, ${l} agents, ${a} hooks`);let f=n==="interactive"?`OrchestKit v${L} setup complete! Loaded ${u} skills, ${l} agents, and ${a} hooks. Use /ork:configure to customize settings.`:`OrchestKit v${L} initialized (silent mode).`;return y(f)}import{existsSync as Pt,mkdirSync as Ft,writeFileSync as Nt}from"node:fs";import{execSync as At}from"node:child_process";function jt(){return!!process.env.MEM0_API_KEY}function nt(t){if(s("mem0-analytics","Mem0 analytics dashboard starting"),!jt())return s("mem0-analytics","Mem0 not available, skipping analytics dashboard"),m();let e=t.project_dir||k(),n=$(),o=`${e}/.claude/logs/mem0-analytics.jsonl`,r=`${e}/.claude/logs/mem0-dashboard.json`,i=`${n}/skills/mem0-memory/scripts/memory-summary.py`,c="{}";if(Pt(i))try{c=At(`python3 "${i}"`,{encoding:"utf8",timeout:3e4,stdio:["pipe","pipe","pipe"]})}catch{s("mem0-analytics","Failed to run summary script")}else return s("mem0-analytics","Summary script not found, skipping dashboard"),m();let a;try{a=JSON.parse(c)}catch{a={}}let l={timestamp:new Date().toISOString(),summary:a,trends:{memory_growth:"tracked",search_frequency:"tracked",graph_utilization:"tracked"}};try{Ft(`${e}/.claude/logs`,{recursive:!0}),Nt(r,JSON.stringify(l,null,2)),s("mem0-analytics","Mem0 analytics dashboard generated")}catch(f){s("mem0-analytics",`Failed to save dashboard: ${f}`)}return m()}import{mkdirSync as Lt,writeFileSync as Ut}from"node:fs";function Wt(){return!!process.env.MEM0_API_KEY}function ot(t){if(s("mem0-backup","Mem0 backup setup starting"),!Wt())return s("mem0-backup","Mem0 not available, skipping backup setup"),m();let e=t.project_dir||k(),n=`${e}/.claude/mem0-backup-config.json`,o=process.env.MEM0_BACKUP_SCHEDULE||"weekly",r=parseInt(process.env.MEM0_BACKUP_RETENTION||"30",10);try{Lt(`${e}/.claude`,{recursive:!0});let i={schedule:o,retention_days:r,enabled:!0,max_backups:parseInt(process.env.MEM0_MAX_BACKUPS||"5",10),rotation_strategy:"count",backup_naming:"timestamp"};Ut(n,JSON.stringify(i,null,2)),s("mem0-backup",`Mem0 backup configured: schedule=${o}, retention=${r} days`)}catch(i){s("mem0-backup",`Failed to create backup config: ${i}`)}return m()}import{existsSync as st,mkdirSync as Kt,appendFileSync as x}from"node:fs";import{execSync as rt}from"node:child_process";function qt(){return!!process.env.MEM0_API_KEY}function Jt(t){let e=new Date;return e.setDate(e.getDate()-t),e.toISOString().split("T")[0]}function it(t){if(s("mem0-cleanup","Mem0 cleanup starting"),!qt())return s("mem0-cleanup","Mem0 not available, skipping cleanup"),m();let e=t.project_dir||k(),o=`${$()}/skills/mem0-memory/scripts`,r=`${o}/batch/batch-delete.py`,i=`${o}/crud/get-memories.py`;if(!st(r))return s("mem0-cleanup",`Batch delete script not found at ${r}, skipping cleanup`),m();if(!st(i))return s("mem0-cleanup",`Get memories script not found at ${i}, skipping cleanup`),m();let c=parseInt(process.env.MEM0_CLEANUP_AGE_DAYS||"90",10),a=Jt(c),u=`${e}/.claude/logs/mem0-cleanup.log`;try{Kt(`${e}/.claude/logs`,{recursive:!0})}catch{}s("mem0-cleanup",`Querying memories older than ${a} (${c} days)`);let l=new Date().toISOString();try{x(u,`[${l}] Cleanup started - threshold: ${a}
`)}catch{}let f;try{let g=rt(`python3 "${i}"`,{encoding:"utf8",timeout:6e4,stdio:["pipe","pipe","pipe"]});f=JSON.parse(g)}catch{s("mem0-cleanup","Failed to get memories");try{x(u,`[${l}] Failed to get memories
`)}catch{}return m()}let d=(f.memories||[]).filter(g=>{let v=(g.created_at?.split("T")[0]||"")<a,h=g.metadata?.protected===!0;return v&&!h}).map(g=>g.id).slice(0,100);if(d.length===0){s("mem0-cleanup",`No stale memories found older than ${a}`);try{x(u,`[${l}] No stale memories found
`)}catch{}return m()}s("mem0-cleanup",`Found ${d.length} stale memories to delete`);try{x(u,`[${l}] Found ${d.length} stale memories
`)}catch{}try{let g=JSON.stringify(d);rt(`python3 "${r}" --memory-ids '${g}'`,{encoding:"utf8",timeout:12e4,stdio:["pipe","pipe","pipe"]}),s("mem0-cleanup",`Successfully deleted ${d.length} stale memories`);try{x(u,`[${l}] Deleted ${d.length} memories successfully
`)}catch{}}catch(g){s("mem0-cleanup",`Batch delete failed: ${g}`);try{x(u,`[${l}] Delete failed: ${g}
`)}catch{}}return s("mem0-cleanup",`Mem0 cleanup complete (age threshold: ${c} days)`),m()}import{existsSync as W,readdirSync as ct}from"node:fs";var Bt=["pnpm-workspace.yaml","lerna.json","nx.json","turbo.json","rush.json"];function Vt(t){let e=0;try{let n=ct(t,{withFileTypes:!0});for(let o of n){if(!o.isDirectory()||o.name.startsWith(".")||o.name==="node_modules")continue;let r=`${t}/${o.name}`;W(`${r}/package.json`)&&e++;try{let i=ct(r,{withFileTypes:!0});for(let c of i)!c.isDirectory()||c.name.startsWith(".")||c.name==="node_modules"||W(`${r}/${c.name}/package.json`)&&e++}catch{}}}catch{}return e}function at(t){if(s("monorepo-detector","Checking for monorepo structure"),process.env.CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD==="1")return s("monorepo-detector","CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD already set, skipping"),m();let e=t.project_dir||k(),n=[];for(let c of Bt)W(`${e}/${c}`)&&n.push(c);let o=Vt(e);if(!(n.length>0||o>=3))return s("monorepo-detector","No monorepo detected"),m();let i=n.length>0?`Detected: ${n.join(", ")}`:`Found ${o} nested packages`;return s("monorepo-detector",`Monorepo detected: ${i}`),y(`**Monorepo Detected** (${i})

CC 2.1.20 supports multi-directory context with \`--add-dir\`. Each service can have its own CLAUDE.md for targeted instructions.

Set \`CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD=1\` to auto-load CLAUDE.md from added directories.`)}import{existsSync as D,readFileSync as q,readdirSync as zt,writeFileSync as Gt}from"node:fs";import{spawn as K}from"node:child_process";var w="4.25.0";function ut(t,e){if(!D(t))return null;try{let n=JSON.parse(q(t,"utf-8")),o=e.split("."),r=n;for(let i of o){if(r==null)return null;r=r[i]}return r}catch{return null}}function Zt(t){let e=0,n=`${t}/.claude/defaults/config.json`;if(D(n))try{JSON.parse(q(n,"utf-8"))}catch{s("setup-check","WARN: config.json is invalid JSON"),e++}let o=0;if(D(`${t}/hooks`))try{let c=(a,u=0)=>{if(u>3)return 0;let l=0;try{let f=zt(a,{withFileTypes:!0});for(let p of f.slice(0,100)){let d=`${a}/${p.name}`;p.isDirectory()&&!p.name.startsWith(".")?l+=c(d,u+1):p.name.endsWith(".sh")&&l++}}catch{}return l};o=c(`${t}/hooks`)}catch{}o<10&&s("setup-check",`WARN: Only ${o} hooks found (expected 50+)`);let r=`${t}/.setup-complete`,i=ut(r,"version");return i&&i!==w?(s("setup-check",`INFO: Version mismatch - marker: ${i}, current: ${w}`),2):e}function Yt(t){let e=ut(t,"last_maintenance");if(!e)return!0;try{let n=new Date(e).getTime();return(Date.now()-n)/(1e3*60*60)>=24}catch{return!0}}function Xt(t,e,n){if(D(t))try{let o=JSON.parse(q(t,"utf-8"));o[e]=n,Gt(t,JSON.stringify(o,null,2))}catch{}}function lt(t){if(process.env.ORCHESTKIT_SKIP_SETUP==="1"||process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1")return m();let e=$(),n=`${e}/.setup-complete`,o=`${e}/hooks/setup`;s("setup-check",`Setup check starting (v${w})`);let r=process.argv;if(r.includes("--init")||r.includes("init"))return s("setup-check","Explicit --init: Running full setup"),{continue:!0,systemMessage:"Running first-run setup..."};if(r.includes("--init-only")||r.includes("init-only"))return s("setup-check","CI/CD mode (--init-only): Running silent setup"),{continue:!0,systemMessage:"Running silent setup..."};if(r.includes("--maintenance")||r.includes("maintenance"))return s("setup-check","Explicit --maintenance: Running maintenance tasks"),{continue:!0,systemMessage:"Running maintenance tasks..."};if(!D(n))return s("setup-check","No marker file found - first run detected"),(t.hook_event||process.env.HOOK_EVENT)==="Setup"?{continue:!0,systemMessage:"First run detected. Running setup..."}:y("OrchestKit setup not complete. Run 'claude --init' to configure the plugin.");switch(s("setup-check","Marker file exists - running quick validation"),Zt(e)){case 0:if(Yt(n)){s("setup-check","Maintenance due - queueing background tasks");let u=`${o}/setup-maintenance.sh`;D(u)&&K(u,["--background"],{detached:!0,stdio:"ignore"}).unref()}return s("setup-check","Setup check passed (fast path)"),m();case 1:s("setup-check","Validation failed - triggering self-healing repair");let c=`${o}/setup-repair.sh`;return D(c)&&K(c,[],{detached:!0,stdio:"ignore"}).unref(),y("OrchestKit setup validation failed. Repair running in background.");case 2:s("setup-check","Version mismatch - running migration");let a=`${o}/setup-maintenance.sh`;return D(a)&&K(a,["--migrate"],{detached:!0,stdio:"ignore"}).unref(),Xt(n,"version",w),y(`OrchestKit upgraded to v${w}.`);default:return m()}}import{existsSync as I,mkdirSync as Qt,readFileSync as J,writeFileSync as te,renameSync as pt,readdirSync as C,unlinkSync as T,statSync as R,chmodSync as ee}from"node:fs";import{execSync as M}from"node:child_process";var H="4.25.0",S=[];function ft(t,e){if(!I(t))return null;try{return JSON.parse(J(t,"utf-8"))[e.replace(/^\./,"")]}catch{return null}}function B(t,e,n){if(I(t))try{let o=JSON.parse(J(t,"utf-8"));o[e.replace(/^\./,"")]=n,te(t,JSON.stringify(o,null,2))}catch{}}function ne(t){if(!t)return 999;try{let e=new Date(t).getTime();return(Date.now()-e)/(1e3*60*60)}catch{return 999}}function oe(t){s("setup-maintenance","Task: Log rotation");let e=[`${t}/.claude/logs`,`${process.env.HOME}/.claude/logs/ork`],n=0;for(let o of e)if(I(o))try{let r=C(o);for(let c of r){if(!c.endsWith(".log"))continue;let a=`${o}/${c}`;try{if(R(a).size>204800){let l=`${a}.old.${Date.now()}`;pt(a,l),n++;try{M(`gzip "${l}"`,{stdio:["pipe","pipe","pipe"]})}catch{}}}catch{}}let i=r.filter(c=>c.includes(".log.old.")).sort().reverse();for(let c of i.slice(5))try{T(`${o}/${c}`)}catch{}}catch{}n>0&&S.push(`Rotated ${n} log files`)}function se(t){s("setup-maintenance","Task: Stale lock cleanup");let e=`${t}/.claude/coordination/.claude.db`,n=0;if(I(e))try{M(`sqlite3 "${e}" "DELETE FROM file_locks WHERE datetime(acquired_at) < datetime('now', '-24 hours');"`,{timeout:5e3,stdio:["pipe","pipe","pipe"]});let o=M(`sqlite3 "${e}" "SELECT COUNT(*) FROM file_locks;"`,{encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();s("setup-maintenance",`Coordination locks remaining: ${o}`),n=1}catch{}try{let o=(r,i=0)=>{if(!(i>3))try{let c=C(r,{withFileTypes:!0});for(let a of c){let u=`${r}/${a.name}`;if(a.isDirectory()&&!a.name.startsWith("."))o(u,i+1);else if(a.name.endsWith(".lock"))try{let l=R(u);(Date.now()-l.mtimeMs)/(1e3*60*60)>24&&(T(u),n++)}catch{}}}catch{}};o(t)}catch{}n>0&&S.push("Cleaned stale locks")}function re(t){s("setup-maintenance","Task: Session cleanup");let e=`${t}/.claude/context/sessions`,n=`${t}/.claude/context/archive`;if(!I(e))return;let o=0;try{Qt(n,{recursive:!0});let r=C(e,{withFileTypes:!0});for(let i of r){if(!i.isDirectory())continue;let c=`${e}/${i.name}`;try{let a=R(c);(Date.now()-a.mtimeMs)/(1e3*60*60*24)>7&&(pt(c,`${n}/${i.name}`),o++)}catch{}}}catch{}try{let r=C("/tmp");for(let i of r){if(!i.startsWith("claude-session-"))continue;let c=`/tmp/${i}`;try{let a=R(c);(Date.now()-a.mtimeMs)/(1e3*60*60*24)>7&&a.isDirectory()&&M(`rm -rf "${c}"`,{stdio:["pipe","pipe","pipe"]})}catch{}}}catch{}o>0&&S.push(`Archived ${o} old sessions`)}function ie(t){s("setup-maintenance","Task: Memory Fabric cleanup");let e=0,n=`${t}/.claude/logs`;if(I(n))try{let r=C(n);for(let i of r){if(!i.startsWith(".mem0-pending-sync-"))continue;let c=`${n}/${i}`;try{let a=R(c);(Date.now()-a.mtimeMs)/(1e3*60*60*24)>7&&(T(c),e++)}catch{}}}catch{}let o=`${process.env.HOME}/.claude/.mem0-pending-sync.json`;if(I(o))try{let r=R(o);(Date.now()-r.mtimeMs)/(1e3*60*60)>24&&(T(o),e++)}catch{}e>0&&S.push(`Cleaned ${e} Memory Fabric files`)}function ce(t,e){s("setup-maintenance","Task: Full health validation");let n=0,o=0,r=(c,a=0)=>{if(!(a>4))try{let u=C(c,{withFileTypes:!0});for(let l of u){let f=`${c}/${l.name}`;if(l.isDirectory()&&!l.name.startsWith("."))r(f,a+1);else if(l.name.endsWith(".sh"))try{R(f).mode&73||(ee(f,493),o++)}catch{}}}catch{}};r(`${t}/hooks`),o>0&&(s("setup-maintenance",`WARN: ${o} hooks were not executable`),n++);let i=`${t}/.claude/defaults/config.json`;if(I(i))try{JSON.parse(J(i,"utf-8"))}catch{s("setup-maintenance","WARN: config.json is invalid"),n++}B(e,"last_health_check",new Date().toISOString()),n===0?S.push("Health validation passed"):S.push(`Health validation found ${n} issues (auto-fixed)`)}function ae(t){s("setup-maintenance","Task: Version migration");let e=ft(t,"version");!e||e===H||(s("setup-maintenance",`Migrating from ${e} to ${H}`),B(t,"version",H),S.push(`Migrated from ${e} to ${H}`))}function mt(t){let e=$(),n=t.project_dir||k(),o=`${e}/.setup-complete`,r=process.argv,i="auto";r.includes("--force")?i="force":r.includes("--migrate")?i="migrate":r.includes("--background")&&(i="background"),s("setup-maintenance",`Maintenance starting (mode: ${i})`);let c=new Date().toISOString(),a=ft(o,"last_maintenance"),u=ne(a),l=!1,f=!1;switch(i){case"force":l=!0,f=!0;break;case"migrate":ae(o);break;case"background":case"auto":u>=24&&(l=!0),u>=168&&(f=!0);break}if(l&&(s("setup-maintenance","Running daily maintenance tasks"),oe(e),se(e),re(e),ie(n)),f&&(s("setup-maintenance","Running weekly maintenance tasks"),ce(e,o)),B(o,"last_maintenance",c),S.length>0){s("setup-maintenance",`Maintenance complete: ${S.length} tasks`);let p=`Completed: ${S.join(", ")}`;return i==="background"?m():y(`Maintenance: ${p}`)}return s("setup-maintenance","No maintenance tasks needed"),m()}import{existsSync as V,mkdirSync as dt,readFileSync as ue,writeFileSync as gt,renameSync as le,readdirSync as F,statSync as pe,chmodSync as fe}from"node:fs";var me="4.25.0",E=[],P=[],N=!1;function de(t){let e=`${t}/.claude/defaults/config.json`,n=`${t}/.claude/defaults`;try{dt(n,{recursive:!0})}catch{}if(V(e))try{JSON.parse(ue(e,"utf-8"));return}catch{let r=`${e}.corrupt.${Date.now()}`;try{le(e,r),s("setup-repair",`Backed up corrupt config to ${r}`),N=!0}catch{}}gt(e,JSON.stringify({preset:"complete",description:"Full AI-assisted development toolkit (restored by repair)",features:{skills:!0,agents:!0,hooks:!0,mcp:!0,coordination:!0,statusline:!0},hook_groups:{safety:!0,quality:!0,productivity:!0,observability:!0}},null,2)),E.push("config.json restored"),s("setup-repair","Restored default config.json")}function ge(t){let e=0,n=(o,r=0)=>{if(!(r>5))try{let i=F(o,{withFileTypes:!0});for(let c of i){let a=`${o}/${c.name}`;if(c.isDirectory()&&!c.name.startsWith("."))n(a,r+1);else if(c.name.endsWith(".sh"))try{pe(a).mode&73||(fe(a,493),e++)}catch{}}}catch{}};n(`${t}/hooks`),e>0&&(E.push(`${e} hook permissions fixed`),s("setup-repair",`Fixed permissions on ${e} hooks`))}function he(t){let e=0,n=[`${t}/.claude/defaults`,`${t}/.claude/context/session`,`${t}/.claude/context/knowledge`,`${t}/.claude/logs`,`${t}/.claude/coordination`];for(let o of n)if(!V(o))try{dt(o,{recursive:!0}),e++}catch{}e>0&&(E.push(`${e} directories created`),s("setup-repair",`Created ${e} missing directories`))}function ye(t){let e=new Date().toISOString(),n=0,o=0,r=0,i=(u,l,f=5)=>{let p=0,d=(g,b)=>{if(!(b>f))try{let v=F(g,{withFileTypes:!0});for(let h of v){let O=`${g}/${h.name}`;h.isDirectory()&&!h.name.startsWith(".")?d(O,b+1):l.test(h.name)&&p++}}catch{}};return d(u,0),p};try{n=i(`${t}/hooks`,/\.sh$/),o=i(`${t}/skills`,/SKILL\.md$/),r=i(`${t}/agents`,/\.md$/)}catch{}let c={version:me,setup_date:e,preset:"complete",repaired_at:e,components:{hooks:{count:n,valid:!0},skills:{count:o,valid:!0},agents:{count:r,valid:!0}},last_health_check:e,last_maintenance:e,environment:{os:process.platform},user_preferences:{onboarding_completed:!0,mcp_configured:!1,statusline_configured:!1}},a=`${t}/.setup-complete`;gt(a,JSON.stringify(c,null,2)),E.push("marker file regenerated"),s("setup-repair","Regenerated marker file")}function ke(t){let e=0,n=0;try{n=(i=>{let c=0,a=(u,l)=>{if(!(l>4))try{let f=F(u,{withFileTypes:!0});for(let p of f){let d=`${u}/${p.name}`;p.isDirectory()&&!p.name.startsWith(".")?a(d,l+1):p.name.endsWith(".sh")&&c++}}catch{}};return a(i,0),c})(`${t}/hooks`)}catch{}n<20&&(s("setup-repair",`CRITICAL: Only ${n} hooks found (expected 50+)`),e++);let o=0;try{o=(i=>{let c=0,a=(u,l)=>{if(!(l>2))try{let f=F(u,{withFileTypes:!0});for(let p of f){let d=`${u}/${p.name}`;p.isDirectory()&&!p.name.startsWith(".")?a(d,l+1):p.name==="SKILL.md"&&c++}}catch{}};return a(i,0),c})(`${t}/skills`)}catch{}return o<50&&(s("setup-repair",`CRITICAL: Only ${o} skills found (expected 100+)`),e++),V(`${t}/hooks/_lib/common.sh`)||(s("setup-repair","CRITICAL: hooks/_lib/common.sh missing"),e++),e>=2?(P.push("Multiple critical components missing - reinstall recommended"),N=!0,!1):!0}function ht(t){let e=$();s("setup-repair","Setup repair starting"),he(e),de(e),ge(e),ke(e)||s("setup-repair","WARN: Critical components missing, repair incomplete"),ye(e);let n="";return E.length>0&&(n=`Repairs: ${E.join(", ")}`),P.length>0&&(n=`${n?n+". ":""}Issues: ${P.join(", ")}`,N=!0),s("setup-repair",`Repair complete: ${E.length} repairs made, ${P.length} issues`),N&&n?y(`OrchestKit auto-repair: ${n}`):m()}var yt={"setup/first-run-setup":et,"setup/mem0-analytics-dashboard":nt,"setup/mem0-backup-setup":ot,"setup/mem0-cleanup":it,"setup/monorepo-detector":at,"setup/setup-check":lt,"setup/setup-maintenance":mt,"setup/setup-repair":ht};function On(t){return yt[t]}function wn(){return Object.keys(yt)}export{Ae as escapeRegex,Re as getCachedBranch,Fe as getField,On as getHook,Z as getLogDir,Dt as getLogLevel,$ as getPluginRoot,k as getProjectDir,j as getSessionId,yt as hooks,$e as isBashInput,be as isEditInput,ve as isReadInput,Se as isWriteInput,wn as listHooks,s as logHook,Me as logPermissionFeedback,Ne as normalizeCommand,Oe as outputAllowWithContext,xe as outputBlock,Te as outputDeny,we as outputError,Ce as outputPromptContext,Ee as outputSilentAllow,m as outputSilentSuccess,He as outputWarning,y as outputWithContext,Pe as readHookInput,It as shouldLog};
//# sourceMappingURL=setup.mjs.map
