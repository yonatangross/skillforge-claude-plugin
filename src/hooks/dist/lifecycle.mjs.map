{
  "version": 3,
  "sources": ["../src/types.ts", "../src/lib/common.ts", "../src/lib/paths.ts", "../src/lib/session-id-generator.ts", "../src/lib/git.ts", "../src/lifecycle/analytics-consent-check.ts", "../src/lifecycle/coordination-cleanup.ts", "../src/lifecycle/coordination-init.ts", "../src/lifecycle/instance-heartbeat.ts", "../src/lifecycle/mem0-analytics-tracker.ts", "../src/lifecycle/mem0-context-retrieval.ts", "../src/lifecycle/mem0-webhook-setup.ts", "../src/lifecycle/multi-instance-init.ts", "../src/lifecycle/pattern-sync-pull.ts", "../src/lifecycle/pattern-sync-push.ts", "../src/lifecycle/pr-status-enricher.ts", "../src/lifecycle/session-cleanup.ts", "../src/lifecycle/session-context-loader.ts", "../src/lifecycle/session-env-setup.ts", "../src/lib/session-tracker.ts", "../src/lib/user-identity.ts", "../src/lifecycle/session-tracking.ts", "../src/lifecycle/session-metrics-summary.ts", "../src/lifecycle/dependency-version-check.ts", "../src/lifecycle/unified-dispatcher.ts", "../src/lifecycle/pre-compact-saver.ts", "../src/entries/lifecycle.ts"],
  "sourcesContent": ["/**\n * TypeScript type definitions for Claude Code hooks\n * CC 2.1.9 compliant with additionalContext support\n */\n\n/**\n * Hook events supported by Claude Code\n */\nexport type HookEvent =\n  | 'PreToolUse'\n  | 'PostToolUse'\n  | 'PostToolUseFailure'\n  | 'PermissionRequest'\n  | 'UserPromptSubmit'\n  | 'SessionStart'\n  | 'SessionEnd'\n  | 'Stop'\n  | 'SubagentStart'\n  | 'SubagentStop'\n  | 'Setup'\n  | 'Notification'\n  | 'PreCompact';\n\n/**\n * Hook input envelope from Claude Code (sent via stdin as JSON)\n */\nexport interface HookInput {\n  /** The hook event type */\n  hook_event?: HookEvent;\n  /** The tool being invoked */\n  tool_name: string;\n  /** Session ID (CC 2.1.9 guarantees availability) */\n  session_id: string;\n  /** Tool-specific input parameters */\n  tool_input: ToolInput;\n  /** Tool output (PostToolUse only) */\n  tool_output?: unknown;\n  /** Tool error message if any */\n  tool_error?: string;\n  /** Tool exit code */\n  exit_code?: number;\n  /** Whether a stop hook is currently active (prevents re-entry) */\n  stop_hook_active?: boolean;\n  /** Permission mode (CC 2.1.25: dontAsk mode makes quality gates warn-only) */\n  permissionMode?: 'default' | 'acceptEdits' | 'dontAsk';\n  /** User prompt (UserPromptSubmit only) */\n  prompt?: string;\n  /** Project directory */\n  project_dir?: string;\n\n  // SubagentStart/SubagentStop specific fields\n  /** Agent type for subagent hooks */\n  subagent_type?: string;\n  /** Agent type (alternative field name) */\n  agent_type?: string;\n  /** Agent ID */\n  agent_id?: string;\n  /** Agent output (SubagentStop) */\n  agent_output?: string;\n  /** Output (alternative field name) */\n  output?: string;\n  /** Error from subagent */\n  error?: string;\n  /** Duration in milliseconds */\n  duration_ms?: number;\n  /** Tool result \u2014 string from most hooks, object from Skill PostToolUse */\n  tool_result?: string | { is_error?: boolean; content?: string };\n\n  // Notification specific fields\n  /** Notification message */\n  message?: string;\n  /** Notification type */\n  notification_type?: string;\n}\n\n/**\n * Tool input types - union of all tool inputs\n */\nexport interface ToolInput {\n  /** Bash command (Bash tool) */\n  command?: string;\n  /** Timeout in ms (Bash tool) */\n  timeout?: number;\n  /** File path (Write/Edit/Read tools) */\n  file_path?: string;\n  /** File content (Write tool) */\n  content?: string;\n  /** Old text to replace (Edit tool) */\n  old_string?: string;\n  /** New text (Edit tool) */\n  new_string?: string;\n  /** Pattern (Glob/Grep tools) */\n  pattern?: string;\n  /** Allow additional properties */\n  [key: string]: unknown;\n}\n\n/**\n * Hook-specific output for CC 2.1.9\n */\nexport interface HookSpecificOutput {\n  /** Hook event name for context */\n  hookEventName?: 'PreToolUse' | 'PostToolUse' | 'PostToolUseFailure' | 'PermissionRequest' | 'UserPromptSubmit';\n  /** Permission decision (PermissionRequest hooks) */\n  permissionDecision?: 'allow' | 'deny';\n  /** Reason for permission decision */\n  permissionDecisionReason?: string;\n  /** Additional context injected before tool execution (CC 2.1.9) */\n  additionalContext?: string;\n  /** Modified tool input (CC 2.1.25: canonical way to modify tool inputs) */\n  updatedInput?: Record<string, unknown>;\n}\n\n/**\n * Hook result - output JSON to stdout\n * CC 2.1.7+ compliant\n */\nexport interface HookResult {\n  /** Whether to continue execution */\n  continue: boolean;\n  /** Suppress hook output from user */\n  suppressOutput?: boolean;\n  /** System message shown to user */\n  systemMessage?: string;\n  /** Reason for stopping (when continue is false) */\n  stopReason?: string;\n  /** Hook-specific output fields */\n  hookSpecificOutput?: HookSpecificOutput;\n}\n\n/**\n * Hook function signature\n */\nexport type HookFn = (input: HookInput) => Promise<HookResult> | HookResult;\n\n/**\n * Hook metadata for auto-discovery and governance\n * Co-export alongside hook functions for single-source-of-truth registration\n */\nexport interface HookMeta {\n  /** Full hook name path (e.g., 'pretool/bash/dangerous-command-blocker') */\n  name: string;\n  /** Human-readable description */\n  description: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher patterns for hooks.json (e.g., 'Bash', 'Write|Edit') */\n  matchers?: string[];\n  /** Run asynchronously (non-blocking) */\n  async?: boolean;\n  /** Only run once per session */\n  once?: boolean;\n  /** Timeout in seconds (async hooks only) */\n  timeout?: number;\n  /** Risk category for prioritization */\n  tier?: 'security-critical' | 'data-loss' | 'quality-gate' | 'standard';\n}\n\n/**\n * Hook overrides configuration for per-project toggle/customization\n * Stored at .claude/hook-overrides.json (gitignored)\n */\nexport interface HookOverrides {\n  /** Hook names to disable entirely */\n  disabled?: string[];\n  /** Per-hook timeout overrides (seconds) */\n  timeouts?: Record<string, number>;\n}\n\n/**\n * Hook registration entry\n */\nexport interface HookRegistration {\n  /** Hook name (e.g., 'permission/auto-approve-readonly') */\n  name: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher (string pattern or regex) */\n  matcher?: string | RegExp;\n  /** Hook implementation function */\n  fn: HookFn;\n}\n\n/**\n * Bash tool input (type guard helper)\n */\nexport interface BashToolInput extends ToolInput {\n  command: string;\n  timeout?: number;\n}\n\n/**\n * Write tool input (type guard helper)\n */\nexport interface WriteToolInput extends ToolInput {\n  file_path: string;\n  content: string;\n}\n\n/**\n * Edit tool input (type guard helper)\n */\nexport interface EditToolInput extends ToolInput {\n  file_path: string;\n  old_string: string;\n  new_string: string;\n}\n\n/**\n * Read tool input (type guard helper)\n */\nexport interface ReadToolInput extends ToolInput {\n  file_path: string;\n  offset?: number;\n  limit?: number;\n}\n\n/**\n * Type guards for tool inputs\n */\nexport function isBashInput(input: ToolInput): input is BashToolInput {\n  return typeof input.command === 'string';\n}\n\nexport function isWriteInput(input: ToolInput): input is WriteToolInput {\n  return typeof input.file_path === 'string' && typeof input.content === 'string';\n}\n\nexport function isEditInput(input: ToolInput): input is EditToolInput {\n  return (\n    typeof input.file_path === 'string' &&\n    typeof input.old_string === 'string' &&\n    typeof input.new_string === 'string'\n  );\n}\n\nexport function isReadInput(input: ToolInput): input is ReadToolInput {\n  return typeof input.file_path === 'string' && input.content === undefined;\n}\n", "/**\n * Common utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh\n */\n\nimport { appendFileSync, existsSync, statSync, renameSync, mkdirSync, readSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookResult, HookInput } from '../types.js';\nimport {\n  getLogDir as getLogDirFromPaths,\n  getProjectDir as getProjectDirFromPaths,\n  getPluginRoot as getPluginRootFromPaths,\n} from './paths.js';\nimport { getOrGenerateSessionId } from './session-id-generator.js';\n\n// -----------------------------------------------------------------------------\n// Environment and Paths\n// All functions read env vars dynamically to support testing\n// Re-export from paths.ts for cross-platform compatibility\n// -----------------------------------------------------------------------------\n\n/**\n * Get the log directory path (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getLogDir(): string {\n  return getLogDirFromPaths();\n}\n\n/**\n * Get the project directory (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getProjectDir(): string {\n  return getProjectDirFromPaths();\n}\n\n/**\n * Get the plugin root directory (cross-platform)\n * Delegates to paths.ts for correct path handling on all platforms\n */\nexport function getPluginRoot(): string {\n  return getPluginRootFromPaths();\n}\n\n/**\n * Get the environment file path (CC 2.1.25: CLAUDE_ENV_FILE support)\n * Falls back to .instance_env for backward compatibility\n */\nexport function getEnvFile(): string {\n  if (process.env.CLAUDE_ENV_FILE) {\n    return process.env.CLAUDE_ENV_FILE;\n  }\n  // Fallback to legacy .instance_env\n  const pluginRoot = getPluginRoot();\n  return `${pluginRoot}/.claude/.instance_env`;\n}\n\n/**\n * Get the session ID\n *\n * Resolution order:\n * 1. CLAUDE_SESSION_ID env var (from CC runtime - preferred)\n * 2. Cached session ID (from .instance/session-id.json)\n * 3. Generate smart session ID: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n *\n * Example smart ID: \"orchestkit-main-0130-1745-a3f2\"\n *\n * The old fallback format \"fallback-{pid}-{timestamp}\" was confusing and unhelpful.\n * Smart IDs are human-readable, showing project, branch, and time context.\n */\nexport function getSessionId(): string {\n  return getOrGenerateSessionId();\n}\n\n/**\n * Get cached git branch (set at session start or first call)\n * Caches result in process.env to avoid repeated execSync calls\n */\nexport function getCachedBranch(projectDir?: string): string {\n  if (process.env.ORCHESTKIT_BRANCH) {\n    return process.env.ORCHESTKIT_BRANCH;\n  }\n\n  try {\n    const branch = execSync('git branch --show-current', {\n      cwd: projectDir || getProjectDir(),\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n    process.env.ORCHESTKIT_BRANCH = branch;\n    return branch;\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Get log level (debug|info|warn|error, default: warn)\n */\nexport function getLogLevel(): string {\n  return process.env.ORCHESTKIT_LOG_LEVEL || 'warn';\n}\n\n/**\n * Normalize line endings from CRLF to LF for cross-platform compatibility.\n * Windows uses \\r\\n (CRLF) while Unix uses \\n (LF).\n * This is critical for parsing YAML frontmatter where we match '---' exactly.\n */\nexport function normalizeLineEndings(content: string): string {\n  return content.replace(/\\r\\n/g, '\\n');\n}\n\n/**\n * Check if should log at given level\n */\nexport function shouldLog(level: 'debug' | 'info' | 'warn' | 'error'): boolean {\n  const levels = ['debug', 'info', 'warn', 'error'];\n  return levels.indexOf(level) >= levels.indexOf(getLogLevel());\n}\n\n// -----------------------------------------------------------------------------\n// Output Helpers (CC 2.1.7+ compliant)\n// -----------------------------------------------------------------------------\n\n/**\n * Output silent success - hook completed without errors, no user-visible output\n */\nexport function outputSilentSuccess(): HookResult {\n  return { continue: true, suppressOutput: true };\n}\n\n/**\n * Output silent allow - permission hook approves silently\n */\nexport function outputSilentAllow(): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: { permissionDecision: 'allow' },\n  };\n}\n\n/**\n * Output block - stops the operation with an error\n */\nexport function outputBlock(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with additionalContext - injects context before tool execution (CC 2.1.9)\n * For PostToolUse hooks (hookEventName optional)\n */\nexport function outputWithContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PostToolUse',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with additionalContext for UserPromptSubmit hooks (CC 2.1.9)\n * hookEventName is REQUIRED for UserPromptSubmit\n */\nexport function outputPromptContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output allow with additionalContext - permission hook approves with context (CC 2.1.9)\n */\nexport function outputAllowWithContext(ctx: string, systemMessage?: string): HookResult {\n  const result: HookResult = {\n    continue: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      additionalContext: ctx,\n      permissionDecision: 'allow',\n    },\n  };\n\n  if (systemMessage) {\n    result.systemMessage = systemMessage;\n  } else {\n    result.suppressOutput = true;\n  }\n\n  return result;\n}\n\n/**\n * Output error message - only use when there's an actual problem\n */\nexport function outputError(message: string): HookResult {\n  return { continue: true, systemMessage: message };\n}\n\n/**\n * Output warning message - CC 2.1.7 compliant (no ANSI in JSON)\n */\nexport function outputWarning(message: string): HookResult {\n  return { continue: true, systemMessage: `\\u26a0 ${message}` };\n}\n\n/**\n * Output deny with feedback logging (CC 2.1.7)\n */\nexport function outputDeny(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with updatedInput - modifies tool input before execution (CC 2.1.25)\n * Canonical way to modify tool inputs from PreToolUse hooks\n */\nexport function outputWithUpdatedInput(updatedInput: Record<string, unknown>): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      updatedInput,\n    },\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Logging (with log level guard for performance)\n// -----------------------------------------------------------------------------\n\nconst LOG_ROTATION_MAX_SIZE = 200 * 1024; // 200KB\nconst PERMISSION_LOG_MAX_SIZE = 100 * 1024; // 100KB\n\n/**\n * Rotate log file if it exceeds size limit\n */\nfunction rotateLogFile(logFile: string, maxSize: number): void {\n  if (!existsSync(logFile)) return;\n\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > maxSize) {\n      const rotated = `${logFile}.old.${Date.now()}`;\n      renameSync(logFile, rotated);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n}\n\n/**\n * Log to hook log file with automatic rotation\n * Respects ORCHESTKIT_LOG_LEVEL (default: warn, skips debug logs in production)\n */\nexport function logHook(hookName: string, message: string, level: 'debug' | 'info' | 'warn' | 'error' = 'debug'): void {\n  // Skip if below log level threshold (big perf win - avoids I/O)\n  if (!shouldLog(level)) {\n    return;\n  }\n\n  const logDir = getLogDir();\n  const logFile = `${logDir}/hooks.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, LOG_ROTATION_MAX_SIZE);\n\n    const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n    appendFileSync(logFile, `[${timestamp}] [${level.toUpperCase()}] [${hookName}] ${message}\\n`);\n  } catch {\n    // Ignore logging errors - don't block hook execution\n  }\n}\n\n/**\n * Log permission decision for audit trail (CC 2.1.7 feature)\n * Always logs (security audit trail) - not affected by log level\n */\nexport function logPermissionFeedback(\n  decision: 'allow' | 'deny' | 'warn',\n  reason: string,\n  input?: HookInput | Record<string, unknown>\n): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/permission-feedback.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, PERMISSION_LOG_MAX_SIZE);\n\n    const timestamp = new Date().toISOString();\n    const toolName = (input as HookInput)?.tool_name || process.env.HOOK_TOOL_NAME || 'unknown';\n    const sessionId = (input as HookInput)?.session_id || getSessionId();\n\n    appendFileSync(\n      logFile,\n      `${timestamp} | ${decision} | ${reason} | tool=${toolName} | session=${sessionId}\\n`\n    );\n  } catch {\n    // Ignore logging errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Token Estimation\n// -----------------------------------------------------------------------------\n\n/**\n * Content-aware token estimation (~80% accuracy without external tokenizer).\n * Code-heavy content averages ~2.8 chars/token; prose ~3.5 chars/token.\n */\nexport function estimateTokenCount(content: string): number {\n  if (!content) return 0;\n  const codeIndicators = (content.match(/[{};()=><]/g) || []).length;\n  const codeRatio = codeIndicators / content.length;\n  const charsPerToken = codeRatio > 0.03 ? 2.8 : 3.5;\n  return Math.ceil(content.length / charsPerToken);\n}\n\n// -----------------------------------------------------------------------------\n// Budgeted Output Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Output prompt context with token budget awareness.\n * Checks if the category is over budget before injecting.\n * Falls back to silent success when budget exhausted.\n *\n * Accepts budget checker and tracker as parameters to avoid circular deps.\n * If not provided, falls back to unchecked injection.\n */\nexport function outputPromptContextBudgeted(\n  ctx: string,\n  hookName: string,\n  category: string,\n  budgetChecker?: { isOverBudget: (cat: string) => boolean },\n  tokenTracker?: { trackTokenUsage: (hook: string, cat: string, tokens: number) => void },\n): HookResult {\n  const tokens = estimateTokenCount(ctx);\n\n  if (budgetChecker && budgetChecker.isOverBudget(category)) {\n    logHook(hookName, `Budget exhausted for ${category}, suppressing ${tokens}t`);\n    return outputSilentSuccess();\n  }\n\n  if (tokenTracker) {\n    tokenTracker.trackTokenUsage(hookName, category, tokens);\n  }\n\n  return outputPromptContext(ctx);\n}\n\n// -----------------------------------------------------------------------------\n// Input Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Read hook input from stdin synchronously\n * Returns parsed JSON or empty object on failure\n */\nexport function readHookInput(): HookInput {\n  try {\n    // Read from stdin synchronously\n    const chunks: Buffer[] = [];\n    const BUFSIZE = 256;\n    const buf = Buffer.allocUnsafe(BUFSIZE);\n\n    let bytesRead: number;\n    const fd = 0; // stdin\n\n    while (true) {\n      try {\n        bytesRead = readSync(fd, buf, 0, BUFSIZE, null);\n        if (bytesRead === 0) break;\n        chunks.push(Buffer.from(buf.subarray(0, bytesRead)));\n      } catch {\n        break;\n      }\n    }\n\n    const input = Buffer.concat(chunks).toString('utf8').trim();\n    if (!input) {\n      return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n    }\n\n    return JSON.parse(input);\n  } catch {\n    return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n  }\n}\n\n/**\n * Get field from hook input using optional chaining\n */\nexport function getField<T>(input: HookInput, path: string): T | undefined {\n  const parts = path.replace(/^\\./, '').split('.');\n  let value: unknown = input;\n\n  for (const part of parts) {\n    if (value === null || value === undefined) return undefined;\n    value = (value as Record<string, unknown>)[part];\n  }\n\n  return value as T;\n}\n\n// -----------------------------------------------------------------------------\n// String Utilities\n// -----------------------------------------------------------------------------\n\n/**\n * Normalize command: remove line continuations and collapse whitespace\n * Prevents bypassing detection with backslash-newline tricks (CC 2.1.6 fix)\n */\nexport function normalizeCommand(command: string): string {\n  return command\n    .replace(/\\\\\\s*[\\r\\n]+/g, ' ') // Remove line continuations\n    .replace(/\\n/g, ' ') // Replace newlines with spaces\n    .replace(/\\s+/g, ' ') // Collapse whitespace\n    .trim();\n}\n\n/**\n * Escape string for use in regex\n */\nexport function escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n", "/**\n * Cross-platform path utilities for TypeScript hooks\n *\n * Provides consistent path handling across Windows, macOS, and Linux.\n * All path construction uses path.join() for correct separators.\n * All temp directories use os.tmpdir() for platform awareness.\n */\n\nimport os from 'node:os';\nimport path from 'node:path';\n\n/**\n * Get the user's home directory (cross-platform)\n * Prefers explicit env vars, falls back to os.homedir()\n */\nexport function getHomeDir(): string {\n  return process.env.HOME || process.env.USERPROFILE || os.homedir();\n}\n\n/**\n * Get the system temp directory (cross-platform)\n * Returns /tmp on Unix, C:\\Users\\X\\AppData\\Local\\Temp on Windows\n */\nexport function getTempDir(): string {\n  return os.tmpdir();\n}\n\n/**\n * Get the project directory from environment\n */\nexport function getProjectDir(): string {\n  return process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the plugin root directory from environment\n */\nexport function getPluginRoot(): string {\n  return process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the log directory path (cross-platform)\n * Uses path.join() for correct separators on all platforms\n */\nexport function getLogDir(): string {\n  if (process.env.CLAUDE_PLUGIN_ROOT) {\n    return path.join(getHomeDir(), '.claude', 'logs', 'ork');\n  }\n  return path.join(getProjectDir(), '.claude', 'logs');\n}\n\n/**\n * Get the memory directory path (cross-platform)\n */\nexport function getMemoryDir(): string {\n  return path.join(getProjectDir(), '.claude', 'memory');\n}\n\n/**\n * Get the coordination directory path (cross-platform)\n */\nexport function getCoordinationDir(): string {\n  return path.join(getProjectDir(), '.claude', 'coordination');\n}\n\n/**\n * Normalize a path for consistent comparison\n * Converts backslashes to forward slashes and removes trailing slashes\n */\nexport function normalizePath(p: string): string {\n  return path.normalize(p).replace(/\\\\/g, '/').replace(/\\/$/, '');\n}\n\n/**\n * Check if a path is absolute\n */\nexport function isAbsolutePath(p: string): boolean {\n  return path.isAbsolute(p);\n}\n\n/**\n * Join path segments (cross-platform)\n * Re-export for convenience\n */\nexport const joinPath = path.join;\n\n/**\n * Get path separator for current platform\n */\nexport const pathSeparator = path.sep;\n", "/**\n * Smart Session ID Generator\n * Generates human-readable session IDs when CLAUDE_SESSION_ID is not available.\n *\n * Format: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n * Example: \"orchestkit-main-0130-1745-a3f2\"\n *\n * Benefits:\n * - Human-readable at a glance\n * - Contains project context\n * - Contains branch info\n * - Chronologically sortable (date-time)\n * - Short unique suffix prevents collisions\n * - Valid file path characters only\n */\n\nimport { execSync } from 'node:child_process';\nimport { createHash } from 'node:crypto';\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join, basename } from 'node:path';\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\n/** Maximum length for project name component */\nconst MAX_PROJECT_LENGTH = 20;\n\n/** Maximum length for branch name component */\nconst MAX_BRANCH_LENGTH = 15;\n\n/** Characters allowed in session ID (safe for file paths) */\nconst SAFE_CHARS = /[^a-z0-9-]/g;\n\n// =============================================================================\n// SESSION ID GENERATION\n// =============================================================================\n\n/**\n * Get project name from directory path\n * Sanitizes to lowercase alphanumeric with dashes\n */\nexport function getProjectName(projectDir?: string): string {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const name = basename(dir);\n  return sanitizeName(name, MAX_PROJECT_LENGTH);\n}\n\n/**\n * Get git branch name (cached for performance)\n * Returns 'nobranch' if git is not available or not in a repo\n */\nexport function getGitBranchForSession(projectDir?: string): string {\n  // Check cache first\n  if (process.env.ORCHESTKIT_SESSION_BRANCH) {\n    return process.env.ORCHESTKIT_SESSION_BRANCH;\n  }\n\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n\n  try {\n    const branch = execSync('git branch --show-current', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 2000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n\n    const sanitized = sanitizeName(branch || 'detached', MAX_BRANCH_LENGTH);\n    process.env.ORCHESTKIT_SESSION_BRANCH = sanitized;\n    return sanitized;\n  } catch {\n    return 'nobranch';\n  }\n}\n\n/**\n * Format current date as MMDD\n */\nexport function formatDateComponent(date?: Date): string {\n  const d = date || new Date();\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${month}${day}`;\n}\n\n/**\n * Format current time as HHMM (24-hour)\n */\nexport function formatTimeComponent(date?: Date): string {\n  const d = date || new Date();\n  const hours = String(d.getHours()).padStart(2, '0');\n  const minutes = String(d.getMinutes()).padStart(2, '0');\n  return `${hours}${minutes}`;\n}\n\n/**\n * Generate short hash for uniqueness (4 hex chars)\n * Uses PID + timestamp + random for entropy\n */\nexport function generateShortHash(): string {\n  const entropy = `${process.pid}-${Date.now()}-${Math.random()}`;\n  return createHash('sha256')\n    .update(entropy)\n    .digest('hex')\n    .slice(0, 4);\n}\n\n/**\n * Sanitize a name for use in session ID\n * - Lowercase\n * - Replace non-alphanumeric with dashes\n * - Collapse multiple dashes\n * - Trim dashes from ends\n * - Truncate to max length\n */\nexport function sanitizeName(name: string, maxLength: number): string {\n  return name\n    .toLowerCase()\n    .replace(SAFE_CHARS, '-')\n    .replace(/-+/g, '-')\n    .replace(/^-|-$/g, '')\n    .slice(0, maxLength);\n}\n\n/**\n * Generate a smart session ID\n *\n * Format: {project}-{branch}-{MMDD}-{HHMM}-{hash4}\n * Example: \"orchestkit-main-0130-1745-a3f2\"\n *\n * @param projectDir - Optional project directory (defaults to env or cwd)\n * @param date - Optional date for testing (defaults to now)\n */\nexport function generateSmartSessionId(projectDir?: string, date?: Date): string {\n  const project = getProjectName(projectDir);\n  const branch = getGitBranchForSession(projectDir);\n  const dateStr = formatDateComponent(date);\n  const timeStr = formatTimeComponent(date);\n  const hash = generateShortHash();\n\n  return `${project}-${branch}-${dateStr}-${timeStr}-${hash}`;\n}\n\n// =============================================================================\n// SESSION ID CACHING\n// =============================================================================\n\n/**\n * Get cached session ID from .instance directory\n * Returns undefined if not cached\n */\nexport function getCachedSessionId(projectDir?: string): string | undefined {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const cachePath = join(dir, '.instance', 'session-id.json');\n\n  if (!existsSync(cachePath)) {\n    return undefined;\n  }\n\n  try {\n    const data = JSON.parse(readFileSync(cachePath, 'utf8'));\n    // Validate the cached ID hasn't expired (24 hours)\n    if (data.session_id && data.created_at) {\n      const age = Date.now() - new Date(data.created_at).getTime();\n      const maxAge = 24 * 60 * 60 * 1000; // 24 hours\n      if (age < maxAge) {\n        return data.session_id;\n      }\n    }\n  } catch {\n    // Ignore read/parse errors\n  }\n\n  return undefined;\n}\n\n/**\n * Cache session ID to .instance directory\n */\nexport function cacheSessionId(sessionId: string, projectDir?: string): void {\n  const dir = projectDir || process.env.CLAUDE_PROJECT_DIR || process.cwd();\n  const instanceDir = join(dir, '.instance');\n  const cachePath = join(instanceDir, 'session-id.json');\n\n  try {\n    if (!existsSync(instanceDir)) {\n      mkdirSync(instanceDir, { recursive: true });\n    }\n\n    writeFileSync(cachePath, JSON.stringify({\n      session_id: sessionId,\n      created_at: new Date().toISOString(),\n    }, null, 2));\n  } catch {\n    // Ignore write errors - caching is optional\n  }\n}\n\n/**\n * Get or generate session ID with caching\n *\n * Priority:\n * 1. CLAUDE_SESSION_ID env var (from CC runtime)\n * 2. Cached session ID (from .instance/session-id.json)\n * 3. Generate new smart session ID (and cache it)\n */\nexport function getOrGenerateSessionId(projectDir?: string): string {\n  // 1. Try CLAUDE_SESSION_ID first (preferred)\n  if (process.env.CLAUDE_SESSION_ID) {\n    return process.env.CLAUDE_SESSION_ID;\n  }\n\n  // 2. Try cached session ID\n  const cached = getCachedSessionId(projectDir);\n  if (cached) {\n    return cached;\n  }\n\n  // 3. Generate new smart session ID\n  const newId = generateSmartSessionId(projectDir);\n  cacheSessionId(newId, projectDir);\n  return newId;\n}\n", "/**\n * Git utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh git functions\n */\n\nimport { execSync } from 'node:child_process';\nimport { getProjectDir } from './common.js';\n\n/**\n * Get the current git branch\n */\nexport function getCurrentBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git branch --show-current', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Check if on a protected branch (dev, main, master)\n */\nexport function isProtectedBranch(branch?: string): boolean {\n  const currentBranch = branch || getCurrentBranch();\n  return ['dev', 'main', 'master'].includes(currentBranch);\n}\n\n/**\n * Get the repository root directory\n */\nexport function getRepoRoot(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git rev-parse --show-toplevel', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return dir;\n  }\n}\n\n/**\n * Check if path is inside a git repository\n */\nexport function isGitRepo(projectDir?: string): boolean {\n  const dir = projectDir || getProjectDir();\n  try {\n    execSync('git rev-parse --git-dir', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get git status (short format)\n */\nexport function getGitStatus(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git status --short', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 10000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Check if there are uncommitted changes\n */\nexport function hasUncommittedChanges(projectDir?: string): boolean {\n  return getGitStatus(projectDir).length > 0;\n}\n\n/**\n * Get the default branch (main or master)\n */\nexport function getDefaultBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    // Check if 'main' exists\n    execSync('git rev-parse --verify main', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return 'main';\n  } catch {\n    try {\n      // Check if 'master' exists\n      execSync('git rev-parse --verify master', {\n        cwd: dir,\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n      return 'master';\n    } catch {\n      return 'main'; // Default to main\n    }\n  }\n}\n\n/**\n * Extract issue number from branch name\n * Supports patterns like: issue/123-description, feature/123, fix-123\n */\nexport function extractIssueNumber(branch: string): number | null {\n  // Match common patterns\n  const patterns = [\n    /issue\\/(\\d+)/i,\n    /feature\\/(\\d+)/i,\n    /fix\\/(\\d+)/i,\n    /bug\\/(\\d+)/i,\n    /feat\\/(\\d+)/i,\n    /^(\\d+)-/,\n    /-(\\d+)$/,\n    /#(\\d+)/,\n  ];\n\n  for (const pattern of patterns) {\n    const match = branch.match(pattern);\n    if (match) {\n      return parseInt(match[1], 10);\n    }\n  }\n\n  return null;\n}\n\n/**\n * Validate branch name format\n * Returns error message if invalid, null if valid\n */\nexport function validateBranchName(branch: string): string | null {\n  // Skip validation for protected branches\n  if (isProtectedBranch(branch)) {\n    return null;\n  }\n\n  // Valid prefixes\n  const validPrefixes = [\n    'issue/',\n    'feature/',\n    'fix/',\n    'bug/',\n    'feat/',\n    'chore/',\n    'docs/',\n    'refactor/',\n    'test/',\n    'ci/',\n    'perf/',\n    'style/',\n    'release/',\n    'hotfix/',\n  ];\n\n  const hasValidPrefix = validPrefixes.some((prefix) => branch.startsWith(prefix));\n  if (!hasValidPrefix) {\n    return `Branch name should start with a valid prefix: ${validPrefixes.join(', ')}`;\n  }\n\n  // Check for issue number in issue/ branches\n  if (branch.startsWith('issue/') && !extractIssueNumber(branch)) {\n    return 'issue/ branches should include an issue number (e.g., issue/123-description)';\n  }\n\n  return null;\n}\n", "/**\n * Analytics Consent Check - Check if user needs to be prompted for analytics consent\n * Part of OrchestKit Claude Plugin (#59)\n *\n * This hook runs on session start to check if user has been asked about analytics.\n * It outputs a gentle reminder or first-time prompt if appropriate.\n *\n * CC 2.1.7 Compliant: uses hookSpecificOutput.additionalContext for context injection\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface ConsentLog {\n  events: Array<{\n    action: string;\n    timestamp: string;\n  }>;\n}\n\ninterface ConsentStatus {\n  consented: boolean;\n  asked: boolean;\n}\n\n/**\n * Read consent status from consent manager config\n */\nfunction getConsentStatus(projectDir: string): ConsentStatus {\n  const consentFile = `${projectDir}/.claude/feedback/consent-status.json`;\n\n  if (!existsSync(consentFile)) {\n    return { consented: false, asked: false };\n  }\n\n  try {\n    const status = JSON.parse(readFileSync(consentFile, 'utf-8'));\n    return {\n      consented: status.consented === true,\n      asked: status.asked === true,\n    };\n  } catch {\n    return { consented: false, asked: false };\n  }\n}\n\n/**\n * Get the last consent event from the log\n */\nfunction getLastConsentEvent(projectDir: string): { action: string; timestamp: string } | null {\n  const consentLog = `${projectDir}/.claude/feedback/consent-log.json`;\n\n  if (!existsSync(consentLog)) {\n    return null;\n  }\n\n  try {\n    const log: ConsentLog = JSON.parse(readFileSync(consentLog, 'utf-8'));\n    if (log.events && log.events.length > 0) {\n      return log.events[log.events.length - 1];\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return null;\n}\n\n/**\n * Check if 30 days have passed since the last decline\n */\nfunction shouldShowReminder(lastTimestamp: string): boolean {\n  try {\n    const lastDate = new Date(lastTimestamp);\n    const now = new Date();\n    const daysSince = Math.floor((now.getTime() - lastDate.getTime()) / (1000 * 60 * 60 * 24));\n    return daysSince >= 30;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Analytics consent check hook\n */\nexport function analyticsConsentCheck(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const status = getConsentStatus(projectDir);\n\n  // Already consented - nothing to do\n  if (status.consented) {\n    logHook('analytics-consent-check', 'User has consented to analytics');\n    return outputSilentSuccess();\n  }\n\n  // Already asked and declined - check if we should show reminder\n  if (status.asked) {\n    const lastEvent = getLastConsentEvent(projectDir);\n\n    if (lastEvent && (lastEvent.action === 'declined' || lastEvent.action === 'revoked')) {\n      if (shouldShowReminder(lastEvent.timestamp)) {\n        // Show gentle reminder (not blocking)\n        logHook('analytics-consent-check', 'Showing 30-day reminder');\n        return {\n          continue: true,\n          systemMessage:\n            'Reminder: Anonymous analytics help improve OrchestKit. Enable with /ork:feedback opt-in',\n        };\n      }\n    }\n\n    // Don't show anything if recently asked\n    logHook('analytics-consent-check', 'User recently declined, not prompting');\n    return outputSilentSuccess();\n  }\n\n  // First time - show a brief notice (not the full prompt, to avoid blocking)\n  logHook('analytics-consent-check', 'First time user, showing brief notice');\n  return {\n    continue: true,\n    systemMessage:\n      'OrchestKit collects local usage metrics. Share anonymously with /ork:feedback opt-in',\n  };\n}\n", "/**\n * Coordination Cleanup - Unregister instance at session end\n * Hook: SessionEnd\n * CC 2.1.6 Compliant: ensures JSON output on all code paths\n */\n\nimport { existsSync, readFileSync, writeFileSync, unlinkSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface HeartbeatFile {\n  status: string;\n  [key: string]: unknown;\n}\n\n/**\n * Load instance ID from environment file\n */\nfunction loadInstanceId(projectDir: string): string | null {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  if (!existsSync(envFile)) {\n    return null;\n  }\n\n  try {\n    const content = readFileSync(envFile, 'utf-8');\n    const match = content.match(/CLAUDE_INSTANCE_ID=([^\\n]+)/);\n    if (match) {\n      return match[1].trim();\n    }\n  } catch {\n    // Ignore read errors\n  }\n\n  return null;\n}\n\n/**\n * Update heartbeat file to stopping status\n */\nfunction updateHeartbeatStatus(projectDir: string, instanceId: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n  const heartbeatFile = `${heartbeatsDir}/${instanceId}.json`;\n\n  if (!existsSync(heartbeatFile)) {\n    return;\n  }\n\n  try {\n    const content: HeartbeatFile = JSON.parse(readFileSync(heartbeatFile, 'utf-8'));\n    content.status = 'stopping';\n    writeFileSync(heartbeatFile, JSON.stringify(content, null, 2));\n    logHook('coordination-cleanup', `Updated heartbeat status to 'stopping' for ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-cleanup', `Failed to update heartbeat: ${err}`);\n  }\n}\n\n/**\n * Unregister instance from coordination database\n */\nfunction unregisterInstance(projectDir: string, instanceId: string): void {\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  if (!existsSync(dbPath)) {\n    logHook('coordination-cleanup', 'No coordination database found');\n    return;\n  }\n\n  // Note: In TypeScript, we would need sqlite3 package for actual DB operations\n  // For now, we log the intent - the actual cleanup is done via bash fallback\n  logHook('coordination-cleanup', `Would unregister instance: ${instanceId}`);\n}\n\n/**\n * Remove instance environment file\n */\nfunction cleanupInstanceEnv(projectDir: string): void {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  try {\n    if (existsSync(envFile)) {\n      unlinkSync(envFile);\n      logHook('coordination-cleanup', 'Removed instance environment file');\n    }\n  } catch (err) {\n    logHook('coordination-cleanup', `Failed to remove instance env: ${err}`);\n  }\n}\n\n/**\n * Coordination cleanup hook\n */\nexport function coordinationCleanup(input: HookInput): HookResult {\n  logHook('coordination-cleanup', 'Starting coordination cleanup');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const instanceId = loadInstanceId(projectDir);\n\n  if (instanceId) {\n    // Update heartbeat to stopping status\n    updateHeartbeatStatus(projectDir, instanceId);\n\n    // Unregister instance (releases all locks)\n    unregisterInstance(projectDir, instanceId);\n  }\n\n  // Clean up instance env file\n  cleanupInstanceEnv(projectDir);\n\n  logHook('coordination-cleanup', 'Coordination cleanup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Coordination Initialization - Register instance at session start\n * Hook: SessionStart\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n * Version: 1.1.0\n * Optimized with timeout to prevent startup hangs\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, getEnvFile, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionState {\n  current_task?: {\n    description?: string;\n  };\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Get task description from session state\n */\nfunction getTaskDescription(projectDir: string): string {\n  const stateFile = `${projectDir}/.claude/context/session/state.json`;\n\n  if (!existsSync(stateFile)) {\n    return 'General development';\n  }\n\n  try {\n    const state: SessionState = JSON.parse(readFileSync(stateFile, 'utf-8'));\n    return state.current_task?.description || 'General development';\n  } catch {\n    return 'General development';\n  }\n}\n\n/**\n * Get agent role from environment\n */\nfunction getAgentRole(): string {\n  return process.env.CLAUDE_SUBAGENT_ROLE || 'main';\n}\n\n/**\n * Generate unique instance ID\n */\nfunction generateInstanceId(): string {\n  const sessionId = getSessionId();\n  const timestamp = new Date().toISOString().replace(/[-:T.Z]/g, '').slice(0, 14);\n  const random = Math.random().toString(36).substring(2, 8);\n  return `${sessionId.slice(0, 8)}-${timestamp}-${random}`;\n}\n\n/**\n * Save instance ID to environment file\n * Uses CLAUDE_ENV_FILE (CC 2.1.25) with .instance_env fallback\n */\nfunction saveInstanceId(projectDir: string, instanceId: string): void {\n  const envFile = getEnvFile();\n\n  try {\n    mkdirSync(`${projectDir}/.claude`, { recursive: true });\n    appendFileSync(envFile, `CLAUDE_INSTANCE_ID=${instanceId}\\n`);\n    logHook('coordination-init', `Saved instance ID: ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-init', `Failed to save instance ID: ${err}`);\n  }\n}\n\n/**\n * Initialize heartbeat for this instance\n */\nfunction initHeartbeat(projectDir: string, instanceId: string, taskDesc: string, agentRole: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n\n  try {\n    mkdirSync(heartbeatsDir, { recursive: true });\n\n    const heartbeat = {\n      instance_id: instanceId,\n      task: taskDesc,\n      role: agentRole,\n      status: 'active',\n      started_at: new Date().toISOString(),\n      last_heartbeat: new Date().toISOString(),\n    };\n\n    writeFileSync(`${heartbeatsDir}/${instanceId}.json`, JSON.stringify(heartbeat, null, 2));\n    logHook('coordination-init', `Initialized heartbeat for ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-init', `Failed to initialize heartbeat: ${err}`);\n  }\n}\n\n/**\n * Coordination initialization hook\n */\nexport function coordinationInit(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    logHook('coordination-init', 'Multi-instance not enabled, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('coordination-init', 'Skipping coordination init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('coordination-init', 'Starting coordination initialization');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const taskDesc = getTaskDescription(projectDir);\n  const agentRole = getAgentRole();\n\n  // Generate and save instance ID\n  const instanceId = generateInstanceId();\n\n  // Store instance ID for other hooks\n  process.env.CLAUDE_INSTANCE_ID = instanceId;\n  saveInstanceId(projectDir, instanceId);\n\n  // Initial heartbeat\n  initHeartbeat(projectDir, instanceId, taskDesc, agentRole);\n\n  logHook('coordination-init', `Coordination initialized: ${instanceId}`);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Instance Heartbeat - Lifecycle Hook\n * Updates heartbeat timestamp and cleans up stale instances\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n *\n * Runs periodically to:\n * 1. Update this instance's heartbeat\n * 2. Clean up stale instances (no heartbeat > 5 min)\n * 3. Release orphaned locks\n *\n * Version: 1.1.0\n * Part of Multi-Worktree Coordination System\n */\n\nimport { existsSync, readFileSync, writeFileSync, readdirSync, unlinkSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface HeartbeatInfo {\n  instance_id: string;\n  status: string;\n  last_heartbeat: string;\n  [key: string]: unknown;\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Get instance ID from environment\n */\nfunction getInstanceId(): string {\n  return process.env.CLAUDE_INSTANCE_ID || getSessionId();\n}\n\n/**\n * Load instance ID from environment file\n */\nfunction loadInstanceIdFromFile(projectDir: string): string | null {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  if (!existsSync(envFile)) {\n    return null;\n  }\n\n  try {\n    const content = readFileSync(envFile, 'utf-8');\n    const match = content.match(/CLAUDE_INSTANCE_ID=([^\\n]+)/);\n    if (match) {\n      return match[1].trim();\n    }\n  } catch {\n    // Ignore read errors\n  }\n\n  return null;\n}\n\n/**\n * Update heartbeat timestamp\n */\nfunction updateHeartbeat(projectDir: string, instanceId: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n  const heartbeatFile = `${heartbeatsDir}/${instanceId}.json`;\n\n  if (!existsSync(heartbeatFile)) {\n    // Create new heartbeat if doesn't exist\n    mkdirSync(heartbeatsDir, { recursive: true });\n    const heartbeat: HeartbeatInfo = {\n      instance_id: instanceId,\n      status: 'active',\n      last_heartbeat: new Date().toISOString(),\n    };\n    writeFileSync(heartbeatFile, JSON.stringify(heartbeat, null, 2));\n    logHook('instance-heartbeat', `Created heartbeat for ${instanceId}`);\n    return;\n  }\n\n  try {\n    const content: HeartbeatInfo = JSON.parse(readFileSync(heartbeatFile, 'utf-8'));\n    content.last_heartbeat = new Date().toISOString();\n    content.status = 'active';\n    writeFileSync(heartbeatFile, JSON.stringify(content, null, 2));\n    logHook('instance-heartbeat', `Updated heartbeat for ${instanceId}`);\n  } catch (err) {\n    logHook('instance-heartbeat', `Failed to update heartbeat: ${err}`);\n  }\n}\n\n/**\n * Clean up stale instances (no heartbeat > 5 min)\n */\nfunction cleanupStaleInstances(projectDir: string, currentInstanceId: string): number {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n\n  if (!existsSync(heartbeatsDir)) {\n    return 0;\n  }\n\n  const staleThresholdMs = 5 * 60 * 1000; // 5 minutes\n  const now = Date.now();\n  let cleanedCount = 0;\n\n  try {\n    const files = readdirSync(heartbeatsDir).filter((f) => f.endsWith('.json'));\n\n    for (const file of files) {\n      const filePath = `${heartbeatsDir}/${file}`;\n\n      try {\n        const content: HeartbeatInfo = JSON.parse(readFileSync(filePath, 'utf-8'));\n\n        // Skip current instance\n        if (content.instance_id === currentInstanceId) {\n          continue;\n        }\n\n        // Check if stale\n        const lastHeartbeat = new Date(content.last_heartbeat).getTime();\n        const age = now - lastHeartbeat;\n\n        if (age > staleThresholdMs) {\n          unlinkSync(filePath);\n          cleanedCount++;\n          logHook('instance-heartbeat', `Cleaned up stale instance: ${content.instance_id}`);\n        }\n      } catch {\n        // Skip files that can't be read\n      }\n    }\n  } catch (err) {\n    logHook('instance-heartbeat', `Failed to scan heartbeats: ${err}`);\n  }\n\n  return cleanedCount;\n}\n\n/**\n * Instance heartbeat hook\n */\nexport function instanceHeartbeat(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('instance-heartbeat', 'Skipping instance heartbeat (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Get instance ID from environment or file\n  let instanceId = getInstanceId();\n  if (!instanceId || instanceId === 'unknown') {\n    instanceId = loadInstanceIdFromFile(projectDir) || instanceId;\n  }\n\n  if (!instanceId) {\n    logHook('instance-heartbeat', 'No instance ID available');\n    return outputSilentSuccess();\n  }\n\n  // Update heartbeat\n  updateHeartbeat(projectDir, instanceId);\n\n  // Clean up stale instances\n  const cleanedCount = cleanupStaleInstances(projectDir, instanceId);\n  if (cleanedCount > 0) {\n    logHook('instance-heartbeat', `Cleaned up ${cleanedCount} stale instance(s)`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Analytics Tracker - Monitor usage patterns continuously\n * Hook: SessionStart / UserPromptSubmit\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Tracks mem0 usage patterns\n * - Monitors feature utilization\n * - Identifies underutilized features\n *\n * Version: 1.0.0\n */\n\nimport { existsSync, mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  // Check for MEM0_API_KEY environment variable\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Mem0 analytics tracker hook\n */\nexport function mem0AnalyticsTracker(input: HookInput): HookResult {\n  logHook('mem0-analytics-tracker', 'Mem0 analytics tracker starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-analytics-tracker', 'Mem0 not available, skipping analytics');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const analyticsFile = `${projectDir}/.claude/logs/mem0-analytics.jsonl`;\n  const sessionId = input.session_id || getSessionId();\n  const timestamp = new Date().toISOString();\n\n  // Create analytics entry\n  const analyticsEntry = JSON.stringify({\n    session_id: sessionId,\n    timestamp: timestamp,\n    event: 'session_start',\n  });\n\n  // Append to analytics log\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n    appendFileSync(analyticsFile, analyticsEntry + '\\n');\n    logHook('mem0-analytics-tracker', 'Mem0 analytics tracked');\n  } catch (err) {\n    logHook('mem0-analytics-tracker', `Failed to write analytics: ${err}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Context Retrieval - Auto-loads memories at session start (Graph-First Architecture)\n * Hook: SessionStart\n * CC 2.1.7 Compliant - Works across any repository\n * CC 2.1.9 Compatible - Uses additionalContext for context injection\n *\n * Graph-First Architecture (v2.1):\n * - Knowledge graph (mcp__memory__*) is PRIMARY - always available, zero-config\n * - Mem0 cloud (mcp__mem0__*) is OPTIONAL enhancement for semantic search\n *\n * Version: 2.1.0 - Graph-first architecture\n * Part of Memory Fabric v2.1\n */\n\nimport { existsSync, readFileSync, mkdirSync, renameSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\nimport { getHomeDir } from '../lib/paths.js';\n\ninterface PendingSyncFile {\n  memories?: unknown[];\n  scope?: string;\n  project_id?: string;\n}\n\ninterface Memory {\n  text: string;\n  metadata?: {\n    has_blockers?: boolean;\n    has_next_steps?: boolean;\n  };\n}\n\n/**\n * Get project ID for user_id hint\n */\nfunction getProjectId(projectDir: string): string {\n  const parts = projectDir.split('/');\n  const basename = parts[parts.length - 1] || 'unknown';\n  return basename.toLowerCase().replace(/\\s+/g, '-');\n}\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Check if pending sync file has valid JSON content\n */\nfunction hasValidPendingSync(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return false;\n  }\n\n  try {\n    const content = readFileSync(filePath, 'utf-8');\n    const parsed = JSON.parse(content);\n\n    // Check if it has meaningful content\n    if (!parsed || Object.keys(parsed).length === 0) {\n      return false;\n    }\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Archive pending sync file\n */\nfunction archivePendingSync(filePath: string, projectDir: string): void {\n  const processedDir = `${projectDir}/.claude/logs/mem0-processed`;\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n\n  try {\n    mkdirSync(processedDir, { recursive: true });\n\n    const basename = filePath.split('/').pop() || 'pending-sync';\n    const archiveName = basename.replace('.json', `.processed-${timestamp}.json`);\n    const archivePath = `${processedDir}/${archiveName}`;\n\n    renameSync(filePath, archivePath);\n    logHook('mem0-context-retrieval', `Archived pending sync to ${archivePath}`);\n  } catch (err) {\n    logHook('mem0-context-retrieval', `Warning: Could not archive ${filePath}: ${err}`);\n  }\n}\n\n/**\n * Check if memory-fabric skill exists\n */\nfunction hasMemoryFabricSkill(): boolean {\n  const pluginRoot = process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n  return existsSync(`${pluginRoot}/skills/memory-fabric/SKILL.md`);\n}\n\n/**\n * Memory context retrieval hook\n */\nexport function mem0ContextRetrieval(input: HookInput): HookResult {\n  logHook('mem0-context-retrieval', 'Mem0 context retrieval starting');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const projectId = getProjectId(projectDir);\n\n  // Pending sync file locations\n  const pendingSyncFile = `${projectDir}/.mem0-pending-sync.json`;\n  const pendingSyncGlobal = `${getHomeDir()}/.claude/.mem0-pending-sync.json`;\n\n  // Determine which pending sync file to check\n  let pendingFile: string | null = null;\n\n  if (hasValidPendingSync(pendingSyncFile)) {\n    pendingFile = pendingSyncFile;\n    logHook('mem0-context-retrieval', `Found pending sync in project: ${pendingSyncFile}`);\n  } else if (hasValidPendingSync(pendingSyncGlobal)) {\n    // Check if global file is for this project\n    try {\n      const content: PendingSyncFile = JSON.parse(readFileSync(pendingSyncGlobal, 'utf-8'));\n      if (content.project_id === projectId) {\n        pendingFile = pendingSyncGlobal;\n        logHook('mem0-context-retrieval', 'Found pending sync in global location for this project');\n      } else {\n        logHook('mem0-context-retrieval', `Global pending sync exists but for different project: ${content.project_id}`);\n      }\n    } catch {\n      // Ignore parse errors\n    }\n  }\n\n  // Archive pending sync if found\n  if (pendingFile) {\n    logHook('mem0-context-retrieval', 'Found pending sync, archiving for processing');\n    archivePendingSync(pendingFile, projectDir);\n    logHook('mem0-context-retrieval', 'Pending sync archived - will be processed on next memory operation');\n  }\n\n  // Log memory availability status\n  if (isMem0Available()) {\n    logHook('mem0-context-retrieval', 'Graph + mem0 available for this session');\n  } else {\n    logHook('mem0-context-retrieval', 'Graph available (mem0 not configured) for this session');\n  }\n\n  // Note: SessionStart hooks must use simple success output (no hookSpecificOutput.additionalContext)\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Webhook Setup - Auto-configure webhooks on first mem0 usage\n * Hook: SessionStart\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Checks if webhooks exist for mem0 automation\n * - Creates webhooks if missing\n * - Configures webhook URL endpoint\n * - Sets up event types: memory.created, memory.updated, memory.deleted\n *\n * Version: 1.0.0\n */\n\nimport { existsSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface WebhookConfig {\n  webhook_name: string;\n  events: string[];\n  url: string;\n}\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Mem0 webhook setup hook\n */\nexport function mem0WebhookSetup(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('mem0-webhook-setup', 'Skipping mem0 webhook setup (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('mem0-webhook-setup', 'Mem0 webhook setup starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-webhook-setup', 'Mem0 not available, skipping webhook setup');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const webhookConfigFile = `${projectDir}/.claude/mem0-webhooks.json`;\n\n  // Webhook configuration\n  const webhookName = 'orchestkit-auto-sync';\n  const webhookEvents = ['memory.created', 'memory.updated', 'memory.deleted'];\n  const webhookUrl = process.env.MEM0_WEBHOOK_URL || 'https://example.com/webhook/mem0';\n\n  logHook('mem0-webhook-setup', 'Checking for existing webhooks');\n\n  // Note: Actual webhook creation would require mem0 API calls\n  // For now, we just save the config for reference\n  if (!process.env.MEM0_WEBHOOK_URL) {\n    logHook('mem0-webhook-setup', 'Webhook URL not configured (set MEM0_WEBHOOK_URL), skipping creation');\n  }\n\n  // Save webhook config\n  try {\n    mkdirSync(`${projectDir}/.claude`, { recursive: true });\n\n    const config: WebhookConfig = {\n      webhook_name: webhookName,\n      events: webhookEvents,\n      url: webhookUrl,\n    };\n\n    writeFileSync(webhookConfigFile, JSON.stringify(config, null, 2));\n    logHook('mem0-webhook-setup', 'Webhook config saved');\n  } catch (err) {\n    logHook('mem0-webhook-setup', `Failed to save webhook config: ${err}`);\n  }\n\n  logHook('mem0-webhook-setup', 'Webhook setup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Multi-Instance Coordination Initialization Hook\n * Runs on session start to register this Claude Code instance\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n * Version: 1.1.0\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface InstanceIdentity {\n  instance_id: string;\n  worktree_name: string;\n  worktree_path: string;\n  branch: string;\n  capabilities: string[];\n  agent_type: string | null;\n  model: string;\n  priority: number;\n  created_at: string;\n  status: string;\n  heartbeat_interval_ms: number;\n  last_heartbeat: string;\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Check if sqlite3 is available\n */\nfunction isSqlite3Available(): boolean {\n  try {\n    execSync('which sqlite3', { encoding: 'utf-8', stdio: 'pipe' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Generate unique instance ID\n */\nfunction generateInstanceId(projectDir: string): string {\n  const worktreeName = projectDir.split('/').pop() || 'unknown';\n  const timestamp = new Date().toISOString().replace(/[-:T.Z]/g, '').slice(0, 14);\n  const random = Math.random().toString(16).substring(2, 10);\n  return `${worktreeName}-${timestamp}-${random}`;\n}\n\n/**\n * Get current git branch\n */\nfunction getCurrentBranch(projectDir: string): string {\n  try {\n    return execSync('git branch --show-current', {\n      cwd: projectDir,\n      encoding: 'utf-8',\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Detect capabilities based on directory structure\n */\nfunction detectCapabilities(projectDir: string): string[] {\n  const caps: string[] = [];\n\n  // Check for backend files\n  if (existsSync(`${projectDir}/backend`) || existsSync(`${projectDir}/src/backend`)) {\n    caps.push('backend');\n  }\n\n  // Check for frontend files\n  if (existsSync(`${projectDir}/frontend`) || existsSync(`${projectDir}/src/frontend`) || existsSync(`${projectDir}/package.json`)) {\n    caps.push('frontend');\n  }\n\n  // Check for test files\n  if (existsSync(`${projectDir}/tests`) || existsSync(`${projectDir}/__tests__`)) {\n    caps.push('testing');\n  }\n\n  // Check for infrastructure files\n  if (existsSync(`${projectDir}/infrastructure`) || existsSync(`${projectDir}/docker-compose.yml`) || existsSync(`${projectDir}/Dockerfile`)) {\n    caps.push('devops');\n  }\n\n  return caps;\n}\n\n/**\n * Create instance identity file\n */\nfunction createInstanceIdentity(projectDir: string, instanceId: string): InstanceIdentity {\n  const branch = getCurrentBranch(projectDir);\n  const capabilities = detectCapabilities(projectDir);\n  const now = new Date().toISOString();\n\n  const identity: InstanceIdentity = {\n    instance_id: instanceId,\n    worktree_name: projectDir.split('/').pop() || 'unknown',\n    worktree_path: projectDir,\n    branch,\n    capabilities,\n    agent_type: null,\n    model: 'claude-opus-4-5-20251101',\n    priority: 1,\n    created_at: now,\n    status: 'active',\n    heartbeat_interval_ms: 5000,\n    last_heartbeat: now,\n  };\n\n  const instanceDir = `${projectDir}/.instance`;\n  mkdirSync(instanceDir, { recursive: true });\n  writeFileSync(`${instanceDir}/id.json`, JSON.stringify(identity, null, 2));\n\n  logHook('multi-instance-init', `Instance identity created: ${instanceId}`);\n\n  return identity;\n}\n\n/**\n * Initialize coordination database\n */\nfunction initDatabase(projectDir: string): boolean {\n  const coordDir = `${projectDir}/.claude/coordination`;\n  const dbPath = `${coordDir}/.claude.db`;\n  const schemaPath = `${coordDir}/schema.sql`;\n\n  if (existsSync(dbPath)) {\n    return true;\n  }\n\n  if (!existsSync(schemaPath)) {\n    logHook('multi-instance-init', `WARNING: Schema file not found at ${schemaPath}`);\n    return false;\n  }\n\n  try {\n    mkdirSync(coordDir, { recursive: true });\n    execSync(`sqlite3 \"${dbPath}\" < \"${schemaPath}\"`, {\n      encoding: 'utf-8',\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    logHook('multi-instance-init', 'Database initialized from schema');\n    return true;\n  } catch (err) {\n    logHook('multi-instance-init', `Failed to initialize database: ${err}`);\n    return false;\n  }\n}\n\n/**\n * Start heartbeat process (note: in TypeScript, we can't easily start background processes)\n * Instead, heartbeat is handled by the instance-heartbeat hook\n */\nfunction startHeartbeat(projectDir: string, instanceId: string): void {\n  // Write PID file to indicate heartbeat should be active\n  const instanceDir = `${projectDir}/.instance`;\n  writeFileSync(`${instanceDir}/heartbeat.pid`, String(process.pid));\n  logHook('multi-instance-init', `Heartbeat marker created for ${instanceId}`);\n}\n\n/**\n * Multi-instance init hook\n */\nexport function multiInstanceInit(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    return outputSilentSuccess();\n  }\n\n  // Check for sqlite3\n  if (!isSqlite3Available()) {\n    logHook('multi-instance-init', 'sqlite3 not available, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('multi-instance-init', 'Skipping multi-instance init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('multi-instance-init', 'Starting multi-instance coordination initialization...');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const instanceDir = `${projectDir}/.instance`;\n  const coordDir = `${projectDir}/.claude/coordination`;\n\n  // Ensure directories exist\n  mkdirSync(`${coordDir}/locks`, { recursive: true });\n  mkdirSync(instanceDir, { recursive: true });\n\n  // Initialize database\n  if (!initDatabase(projectDir)) {\n    logHook('multi-instance-init', 'ERROR: Failed to initialize database');\n    return outputSilentSuccess();\n  }\n\n  // Check if we already have an instance running\n  const idFile = `${instanceDir}/id.json`;\n  const pidFile = `${instanceDir}/heartbeat.pid`;\n\n  if (existsSync(idFile) && existsSync(pidFile)) {\n    try {\n      const existingId = JSON.parse(readFileSync(idFile, 'utf-8'));\n      logHook('multi-instance-init', `Reusing existing instance: ${existingId.instance_id}`);\n      return outputSilentSuccess();\n    } catch {\n      // Fall through to create new instance\n    }\n  }\n\n  // Generate new instance ID\n  const instanceId = generateInstanceId(projectDir);\n\n  // Create identity and register\n  createInstanceIdentity(projectDir, instanceId);\n\n  // Start heartbeat marker\n  startHeartbeat(projectDir, instanceId);\n\n  logHook('multi-instance-init', 'Multi-instance coordination initialized successfully');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Pattern Sync Pull - SessionStart Hook\n * CC 2.1.7 Compliant: silent on success with suppressOutput\n * Pulls global patterns into project on session start\n *\n * Part of Cross-Project Patterns (#48)\n * Optimized with timeout and file size checks to prevent startup hangs\n */\n\nimport { existsSync, readFileSync, writeFileSync, statSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\nimport { getHomeDir } from '../lib/paths.js';\n\ninterface PatternFile {\n  version?: string;\n  patterns?: unknown[];\n  sync_enabled?: boolean;\n}\n\nconst MAX_FILE_SIZE_BYTES = 1 * 1024 * 1024; // 1MB\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Check if sync is enabled\n */\nfunction isSyncEnabled(projectDir: string): boolean {\n  const configFile = `${projectDir}/.claude/feedback/sync-config.json`;\n\n  if (!existsSync(configFile)) {\n    return true; // Default to enabled\n  }\n\n  try {\n    const config = JSON.parse(readFileSync(configFile, 'utf-8'));\n    return config.sync_enabled !== false;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Check if file size is within limits\n */\nfunction checkFileSize(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return true; // File doesn't exist, that's fine\n  }\n\n  try {\n    const stats = statSync(filePath);\n    if (stats.size > MAX_FILE_SIZE_BYTES) {\n      logHook('pattern-sync-pull', `WARN: Skipping - file too large: ${filePath} (${stats.size} bytes)`);\n      return false;\n    }\n    return true;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Pull global patterns into project\n */\nfunction pullGlobalPatterns(projectDir: string): void {\n  const home = getHomeDir();\n  const globalPatternsFile = `${home}/.claude/global-patterns.json`;\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n\n  if (!existsSync(globalPatternsFile)) {\n    logHook('pattern-sync-pull', 'No global patterns file found');\n    return;\n  }\n\n  try {\n    const globalPatterns: PatternFile = JSON.parse(readFileSync(globalPatternsFile, 'utf-8'));\n    const globalList = globalPatterns.patterns || [];\n\n    if (globalList.length === 0) {\n      logHook('pattern-sync-pull', 'No global patterns to pull');\n      return;\n    }\n\n    // Load existing project patterns\n    let projectPatterns: PatternFile = { version: '1.0', patterns: [] };\n    if (existsSync(projectPatternsFile)) {\n      try {\n        projectPatterns = JSON.parse(readFileSync(projectPatternsFile, 'utf-8'));\n      } catch {\n        // Use default if parse fails\n      }\n    }\n\n    const projectList = projectPatterns.patterns || [];\n\n    // Merge patterns (avoid duplicates by text)\n    const existingTexts = new Set((projectList as Array<{ text?: string }>).map((p) => p.text));\n    const newPatterns = (globalList as Array<{ text?: string }>).filter((p) => !existingTexts.has(p.text));\n\n    if (newPatterns.length === 0) {\n      logHook('pattern-sync-pull', 'All global patterns already in project');\n      return;\n    }\n\n    // Add new patterns\n    const mergedPatterns = [...projectList, ...newPatterns];\n    projectPatterns.patterns = mergedPatterns;\n\n    // Ensure directory exists\n    mkdirSync(`${projectDir}/.claude/feedback`, { recursive: true });\n\n    // Write updated patterns\n    writeFileSync(projectPatternsFile, JSON.stringify(projectPatterns, null, 2));\n    logHook('pattern-sync-pull', `Pulled ${newPatterns.length} new patterns from global`);\n  } catch (err) {\n    logHook('pattern-sync-pull', `Failed to pull global patterns: ${err}`);\n  }\n}\n\n/**\n * Pattern sync pull hook\n */\nexport function patternSyncPull(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('pattern-sync-pull', 'Skipping pattern sync (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Check if sync is enabled\n  if (!isSyncEnabled(projectDir)) {\n    logHook('pattern-sync-pull', 'Global sync disabled, skipping pull');\n    return outputSilentSuccess();\n  }\n\n  // Check file sizes\n  const home2 = process.env.HOME || process.env.USERPROFILE || '/tmp';\n  const globalPatternsFile = `${home2}/.claude/global-patterns.json`;\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n\n  if (!checkFileSize(globalPatternsFile) || !checkFileSize(projectPatternsFile)) {\n    logHook('pattern-sync-pull', 'Skipping pattern sync due to large files');\n    return outputSilentSuccess();\n  }\n\n  // Pull global patterns\n  logHook('pattern-sync-pull', 'Pulling global patterns...');\n  pullGlobalPatterns(projectDir);\n  logHook('pattern-sync-pull', 'Global patterns pulled successfully');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Pattern Sync Push - SessionEnd Hook\n * CC 2.1.7 Compliant: silent on success with suppressOutput\n * Pushes project patterns to global on session end\n *\n * Part of Cross-Project Patterns (#48)\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\nimport { getHomeDir } from '../lib/paths.js';\n\ninterface PatternFile {\n  version?: string;\n  patterns?: unknown[];\n  sync_enabled?: boolean;\n  updated?: string;\n}\n\n/**\n * Check if sync is enabled\n */\nfunction isSyncEnabled(projectDir: string): boolean {\n  const configFile = `${projectDir}/.claude/feedback/sync-config.json`;\n\n  if (!existsSync(configFile)) {\n    return true; // Default to enabled\n  }\n\n  try {\n    const config = JSON.parse(readFileSync(configFile, 'utf-8'));\n    return config.sync_enabled !== false;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Push project patterns to global\n */\nfunction pushProjectPatterns(projectDir: string): void {\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n  const home = getHomeDir();\n  const globalPatternsFile = `${home}/.claude/global-patterns.json`;\n\n  if (!existsSync(projectPatternsFile)) {\n    logHook('pattern-sync-push', 'No project patterns file found');\n    return;\n  }\n\n  try {\n    const projectPatterns: PatternFile = JSON.parse(readFileSync(projectPatternsFile, 'utf-8'));\n    const projectList = projectPatterns.patterns || [];\n\n    if (projectList.length === 0) {\n      logHook('pattern-sync-push', 'No project patterns to push');\n      return;\n    }\n\n    // Load existing global patterns\n    let globalPatterns: PatternFile = { version: '1.0', patterns: [], updated: '' };\n    if (existsSync(globalPatternsFile)) {\n      try {\n        globalPatterns = JSON.parse(readFileSync(globalPatternsFile, 'utf-8'));\n      } catch {\n        // Use default if parse fails\n      }\n    }\n\n    const globalList = globalPatterns.patterns || [];\n\n    // Merge patterns (avoid duplicates by text)\n    const existingTexts = new Set((globalList as Array<{ text?: string }>).map((p) => p.text));\n    const newPatterns = (projectList as Array<{ text?: string }>).filter((p) => !existingTexts.has(p.text));\n\n    if (newPatterns.length === 0) {\n      logHook('pattern-sync-push', 'All project patterns already in global');\n      return;\n    }\n\n    // Add new patterns\n    const mergedPatterns = [...globalList, ...newPatterns];\n    globalPatterns.patterns = mergedPatterns;\n    globalPatterns.updated = new Date().toISOString();\n\n    // Ensure directory exists\n    mkdirSync(`${home}/.claude`, { recursive: true });\n\n    // Write updated patterns\n    writeFileSync(globalPatternsFile, JSON.stringify(globalPatterns, null, 2));\n    logHook('pattern-sync-push', `Pushed ${newPatterns.length} new patterns to global`);\n  } catch (err) {\n    logHook('pattern-sync-push', `Failed to push project patterns: ${err}`);\n  }\n}\n\n/**\n * Pattern sync push hook\n */\nexport function patternSyncPush(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Check if sync is enabled\n  if (!isSyncEnabled(projectDir)) {\n    logHook('pattern-sync-push', 'Global sync disabled, skipping push');\n    return outputSilentSuccess();\n  }\n\n  // Push project patterns to global\n  logHook('pattern-sync-push', 'Pushing project patterns to global...');\n  pushProjectPatterns(projectDir);\n\n  return outputSilentSuccess();\n}\n", "/**\n * PR Status Enricher - SessionStart Hook\n * CC 2.1.20: Detects open PRs on current branch and sets env vars\n *\n * Runs at session start to provide PR context. Sets:\n * - ORCHESTKIT_PR_URL\n * - ORCHESTKIT_PR_STATE\n */\n\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getCachedBranch, outputSilentSuccess } from '../lib/common.js';\n\n// Branches to skip PR detection\nconst SKIP_BRANCHES = new Set(['main', 'master', 'dev', 'develop']);\n\n/**\n * PR status enricher hook\n */\nexport function prStatusEnricher(input: HookInput): HookResult {\n  logHook('pr-status-enricher', 'Checking for open PR on current branch');\n\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Get current branch\n  let branch: string;\n  try {\n    branch = getCachedBranch(projectDir);\n  } catch {\n    logHook('pr-status-enricher', 'Could not determine branch, skipping');\n    return outputSilentSuccess();\n  }\n\n  if (!branch || SKIP_BRANCHES.has(branch)) {\n    logHook('pr-status-enricher', `Branch \"${branch}\" skipped for PR detection`);\n    return outputSilentSuccess();\n  }\n\n  // Check for open PR using gh CLI\n  try {\n    const prJson = execSync(\n      'gh pr view --json state,reviewDecision,url,title,isDraft',\n      { cwd: projectDir, timeout: 10000, encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] }\n    ).trim();\n\n    const pr = JSON.parse(prJson);\n    if (!pr.url) {\n      logHook('pr-status-enricher', 'No PR found for current branch');\n      return outputSilentSuccess();\n    }\n\n    // Set env vars for downstream hooks\n    process.env.ORCHESTKIT_PR_URL = pr.url;\n    process.env.ORCHESTKIT_PR_STATE = pr.state;\n\n    // Get unresolved comment count\n    let unresolvedCount = 0;\n    try {\n      const threadsJson = execSync(\n        'gh pr view --json reviewThreads',\n        { cwd: projectDir, timeout: 10000, encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] }\n      ).trim();\n      const threads = JSON.parse(threadsJson);\n      unresolvedCount = (threads.reviewThreads || []).filter(\n        (t: { isResolved: boolean }) => !t.isResolved\n      ).length;\n    } catch {\n      // Non-critical, ignore\n    }\n\n    const draftLabel = pr.isDraft ? ' (DRAFT)' : '';\n    const reviewLabel = pr.reviewDecision ? ` | Review: ${pr.reviewDecision}` : '';\n    const unresolvedLabel = unresolvedCount > 0 ? ` | ${unresolvedCount} unresolved` : '';\n\n    logHook('pr-status-enricher', `PR: ${pr.title}${draftLabel} [${pr.state}${reviewLabel}${unresolvedLabel}]`);\n    logHook('pr-status-enricher', `URL: ${pr.url}`);\n  } catch {\n    logHook('pr-status-enricher', 'No PR found or gh CLI unavailable');\n  }\n\n  // Note: SessionStart hooks don't support hookSpecificOutput.additionalContext (line 90 of session-context-loader.ts)\n  return outputSilentSuccess();\n}\n", "/**\n * Session Cleanup - Cleans up temporary files at session end\n * Hook: SessionEnd\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync, readdirSync, unlinkSync, copyFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionMetrics {\n  tools?: Record<string, number>;\n}\n\n/**\n * Get total tool invocations from metrics\n */\nfunction getTotalTools(metricsFile: string): number {\n  if (!existsSync(metricsFile)) {\n    return 0;\n  }\n\n  try {\n    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));\n    const tools = metrics.tools || {};\n    return Object.values(tools).reduce((sum, count) => sum + count, 0);\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Archive session metrics if significant\n */\nfunction archiveMetrics(metricsFile: string, archiveDir: string): void {\n  if (!existsSync(metricsFile)) {\n    return;\n  }\n\n  const totalTools = getTotalTools(metricsFile);\n\n  // Only archive if there were more than 5 tool calls\n  if (totalTools <= 5) {\n    logHook('session-cleanup', `Session had only ${totalTools} tool calls, not archiving`);\n    return;\n  }\n\n  try {\n    mkdirSync(archiveDir, { recursive: true });\n\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const archiveName = `session-${timestamp}.json`;\n    const archivePath = `${archiveDir}/${archiveName}`;\n\n    copyFileSync(metricsFile, archivePath);\n    logHook('session-cleanup', `Archived session metrics to ${archiveName}`);\n  } catch (err) {\n    logHook('session-cleanup', `Failed to archive metrics: ${err}`);\n  }\n}\n\n/**\n * Clean up old session archives (keep last 20)\n */\nfunction cleanupOldArchives(archiveDir: string, keepCount: number = 20): void {\n  if (!existsSync(archiveDir)) {\n    return;\n  }\n\n  try {\n    const files = readdirSync(archiveDir)\n      .filter((f) => f.startsWith('session-') && f.endsWith('.json'))\n      .sort()\n      .reverse(); // Most recent first\n\n    if (files.length <= keepCount) {\n      return;\n    }\n\n    const toDelete = files.slice(keepCount);\n    for (const file of toDelete) {\n      try {\n        unlinkSync(`${archiveDir}/${file}`);\n        logHook('session-cleanup', `Deleted old archive: ${file}`);\n      } catch {\n        // Ignore deletion errors\n      }\n    }\n  } catch (err) {\n    logHook('session-cleanup', `Failed to cleanup old archives: ${err}`);\n  }\n}\n\n/**\n * Clean up old rotated log files (keep last 5)\n */\nfunction cleanupRotatedLogs(logDir: string): void {\n  if (!existsSync(logDir)) {\n    return;\n  }\n\n  const patterns = ['hooks.log.old*', 'audit.log.old*'];\n\n  for (const pattern of patterns) {\n    try {\n      const prefix = pattern.replace('*', '');\n      const files = readdirSync(logDir)\n        .filter((f) => f.startsWith(prefix))\n        .sort()\n        .reverse(); // Most recent first\n\n      if (files.length <= 5) {\n        continue;\n      }\n\n      const toDelete = files.slice(5);\n      for (const file of toDelete) {\n        try {\n          unlinkSync(`${logDir}/${file}`);\n        } catch {\n          // Ignore deletion errors\n        }\n      }\n    } catch {\n      // Ignore scan errors\n    }\n  }\n}\n\n/**\n * Session cleanup hook\n */\nexport function sessionCleanup(input: HookInput): HookResult {\n  logHook('session-cleanup', 'Session cleanup starting');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const metricsFile = '/tmp/claude-session-metrics.json';\n  const archiveDir = `${projectDir}/.claude/logs/sessions`;\n  const logDir = `${projectDir}/.claude/logs`;\n\n  // Archive metrics if significant\n  archiveMetrics(metricsFile, archiveDir);\n\n  // Clean up old session archives (keep last 20)\n  cleanupOldArchives(archiveDir, 20);\n\n  // Clean up old rotated log files (keep last 5)\n  cleanupRotatedLogs(logDir);\n\n  logHook('session-cleanup', 'Session cleanup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Context Loader - Loads session context at session start\n * Hook: SessionStart\n * CC 2.1.7 Compliant - Context Protocol 2.0\n * Supports agent_type for context-aware initialization\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Validate JSON file\n */\nfunction isValidJsonFile(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return false;\n  }\n\n  try {\n    JSON.parse(readFileSync(filePath, 'utf-8'));\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Session context loader hook\n */\nexport function sessionContextLoader(input: HookInput): HookResult {\n  logHook('session-context-loader', 'Session starting - loading context (Protocol 2.0)');\n\n  const projectDir = input.project_dir || getProjectDir();\n  let contextLoaded = 0;\n\n  // Extract agent_type from environment (set by startup-dispatcher)\n  const agentType = process.env.AGENT_TYPE || '';\n\n  // Context Protocol 2.0 paths\n  const sessionState = `${projectDir}/.claude/context/session/state.json`;\n  const identityFile = `${projectDir}/.claude/context/identity.json`;\n  const knowledgeIndex = `${projectDir}/.claude/context/knowledge/index.json`;\n\n  // Load session state\n  if (isValidJsonFile(sessionState)) {\n    logHook('session-context-loader', 'Session state loaded');\n    contextLoaded++;\n  }\n\n  // Load identity\n  if (isValidJsonFile(identityFile)) {\n    logHook('session-context-loader', 'Identity loaded');\n    contextLoaded++;\n  }\n\n  // Check knowledge index\n  if (isValidJsonFile(knowledgeIndex)) {\n    logHook('session-context-loader', 'Knowledge index available');\n    contextLoaded++;\n  }\n\n  // Load current status docs if they exist\n  const statusFile = `${projectDir}/docs/CURRENT_STATUS.md`;\n  if (existsSync(statusFile)) {\n    logHook('session-context-loader', 'Current status document exists');\n  }\n\n  // Agent-type aware context loading (CC 2.1.6 feature)\n  if (agentType) {\n    logHook('session-context-loader', `Agent-type aware initialization: ${agentType}`);\n\n    // Check if there's agent-specific configuration\n    const agentConfig = `${projectDir}/.claude/agents/${agentType}.md`;\n    if (existsSync(agentConfig)) {\n      logHook('session-context-loader', `Agent configuration found: ${agentConfig}`);\n      contextLoaded++;\n    }\n  }\n\n  // CC 2.1.20: Load compaction manifest from previous session\n  const compactionManifest = `${projectDir}/.claude/context/session/compaction-manifest.json`;\n  if (isValidJsonFile(compactionManifest)) {\n    try {\n      const manifest = JSON.parse(readFileSync(compactionManifest, 'utf-8'));\n      logHook('session-context-loader', `Compaction manifest loaded: session=${manifest.sessionId}, decisions=${(manifest.keyDecisions || []).length}, files=${(manifest.filesTouched || []).length}`);\n      process.env.ORCHESTKIT_LAST_SESSION = manifest.sessionId || '';\n      process.env.ORCHESTKIT_LAST_DECISIONS = JSON.stringify(manifest.keyDecisions || []);\n      contextLoaded++;\n    } catch (error) {\n      logHook('session-context-loader', `Error loading compaction manifest: ${error}`);\n    }\n  }\n\n  // Log summary\n  if (contextLoaded > 0) {\n    if (agentType) {\n      logHook('session-context-loader', `Session context loaded (Protocol 2.0) - Agent: ${agentType}`);\n    } else {\n      logHook('session-context-loader', 'Session context loaded (Protocol 2.0)');\n    }\n  }\n\n  // Note: SessionStart hooks don't support hookSpecificOutput.additionalContext\n  return outputSilentSuccess();\n}\n", "/**\n * Session Environment Setup - Initializes session environment\n * Hook: SessionStart\n * CC 2.1.6 Compliant - Supports agent_type field\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionState {\n  agent_type?: string;\n  session_id?: string;\n  last_activity?: string;\n  [key: string]: unknown;\n}\n\ninterface SessionMetrics {\n  session_id: string;\n  started_at: string;\n  agent_type: string;\n  tools: Record<string, number>;\n  errors: number;\n  warnings: number;\n}\n\n/**\n * Get current git branch\n */\nfunction getCurrentBranch(projectDir: string): string {\n  try {\n    return execSync('git branch --show-current', {\n      cwd: projectDir,\n      encoding: 'utf-8',\n      timeout: 500,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Session environment setup hook\n */\nexport function sessionEnvSetup(input: HookInput): HookResult {\n  logHook('session-env-setup', 'Setting up session environment');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionId = input.session_id || getSessionId();\n  const metricsFile = '/tmp/claude-session-metrics.json';\n\n  // Create logs directory if needed\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n  } catch {\n    // Ignore mkdir errors\n  }\n\n  // Extract agent_type from environment or hook input\n  let agentType = process.env.AGENT_TYPE || '';\n  if (!agentType && input.agent_type) {\n    agentType = input.agent_type;\n  }\n\n  // Initialize session metrics\n  const metrics: SessionMetrics = {\n    session_id: sessionId,\n    started_at: new Date().toISOString(),\n    agent_type: agentType,\n    tools: {},\n    errors: 0,\n    warnings: 0,\n  };\n\n  try {\n    writeFileSync(metricsFile, JSON.stringify(metrics, null, 2));\n    logHook('session-env-setup', 'Initialized session metrics');\n  } catch (err) {\n    logHook('session-env-setup', `Failed to initialize metrics: ${err}`);\n  }\n\n  // Update session state with agent_type (CC 2.1.6 feature)\n  const sessionState = `${projectDir}/.claude/context/session/state.json`;\n  if (existsSync(sessionState) && agentType) {\n    try {\n      const state: SessionState = JSON.parse(readFileSync(sessionState, 'utf-8'));\n      state.agent_type = agentType;\n      state.session_id = sessionId;\n      state.last_activity = new Date().toISOString();\n      writeFileSync(sessionState, JSON.stringify(state, null, 2));\n      logHook('session-env-setup', `Updated session state with agent_type: ${agentType}`);\n    } catch (err) {\n      logHook('session-env-setup', `Failed to update session state: ${err}`);\n    }\n  }\n\n  // Check git status with timeout\n  const branch = getCurrentBranch(projectDir);\n  if (branch) {\n    logHook('session-env-setup', `Git branch: ${branch}`);\n  }\n\n  // Log agent type if present\n  if (agentType) {\n    logHook('session-env-setup', `Agent type: ${agentType}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Event Tracker\n * Logs all session events (skills, agents, hooks, decisions) with user identity.\n *\n * Events are stored per-session in JSONL format for later aggregation.\n * This enables learning user patterns across sessions.\n *\n * Storage: .claude/memory/sessions/{session_id}/events.jsonl\n */\n\nimport { existsSync, appendFileSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\nimport { getProjectDir, getSessionId, logHook } from './common.js';\nimport { getIdentityContext, type IdentityContext } from './user-identity.js';\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\n/**\n * Event types that can be tracked\n */\nexport type SessionEventType =\n  | 'skill_invoked'\n  | 'agent_spawned'\n  | 'hook_triggered'\n  | 'decision_made'\n  | 'preference_stated'\n  | 'problem_reported'\n  | 'solution_found'\n  | 'tool_used'\n  | 'session_start'\n  | 'session_end'\n  | 'communication_style_detected';\n\n/**\n * A single session event\n */\nexport interface SessionEvent {\n  /** Unique event ID */\n  event_id: string;\n  /** Event type */\n  event_type: SessionEventType;\n  /** Identity context (user, session, machine) */\n  identity: IdentityContext;\n  /** Event-specific payload */\n  payload: {\n    /** Name of skill/agent/hook/tool */\n    name: string;\n    /** Input data (optional, may be truncated for privacy) */\n    input?: Record<string, unknown>;\n    /** Output/result (optional, may be truncated) */\n    output?: Record<string, unknown>;\n    /** Duration in milliseconds */\n    duration_ms?: number;\n    /** Whether the event succeeded */\n    success: boolean;\n    /** Additional context */\n    context?: string;\n    /** Confidence score (for decisions) */\n    confidence?: number;\n  };\n}\n\n/**\n * Session summary (aggregated at session end)\n */\nexport interface SessionSummary {\n  session_id: string;\n  user_id: string;\n  anonymous_id: string;\n  team_id?: string;\n  start_time?: string;\n  end_time?: string;\n  duration_ms?: number;\n  event_counts: Record<SessionEventType, number>;\n  skills_used: string[];\n  agents_spawned: string[];\n  hooks_triggered: string[];\n  decisions_made: number;\n  problems_reported: number;\n  solutions_found: number;\n}\n\n// =============================================================================\n// PATHS\n// =============================================================================\n\n/** Session ID validation regex - alphanumeric, dashes, underscores only (SEC-002) */\nconst SESSION_ID_PATTERN = /^[a-zA-Z0-9_-]{1,128}$/;\n\n/**\n * Validate session ID to prevent path traversal attacks.\n * Defense-in-depth: trusted sources, but we validate at boundary anyway.\n */\nfunction isValidSessionId(sessionId: string): boolean {\n  return SESSION_ID_PATTERN.test(sessionId);\n}\n\n/**\n * Get session storage directory\n * @param sessionId - Optional session ID (defaults to env var)\n * @param projectDir - Optional project directory (defaults to env var)\n */\nfunction getSessionDir(sessionId?: string, projectDir?: string): string {\n  const sid = sessionId || getSessionId();\n  const pDir = projectDir || getProjectDir();\n  // Validate session ID to prevent path traversal (SEC-002)\n  if (!isValidSessionId(sid)) {\n    throw new Error(`Invalid session ID format`);\n  }\n  return `${pDir}/.claude/memory/sessions/${sid}`;\n}\n\n/**\n * Get events file path for a session\n */\nfunction getEventsPath(sessionId?: string, projectDir?: string): string {\n  return `${getSessionDir(sessionId, projectDir)}/events.jsonl`;\n}\n\n/**\n * Ensure session directory exists\n */\nfunction ensureSessionDir(sessionId?: string, projectDir?: string): void {\n  const dir = getSessionDir(sessionId, projectDir);\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n}\n\n// =============================================================================\n// EVENT GENERATION (Persistent Counter - Issue #245)\n// =============================================================================\n\n/** In-memory event counter */\nlet eventCounter = 0;\n\n/** Counter persistence state */\nlet counterLoaded = false;\nlet counterDirty = false;\nlet lastPersistTime = 0;\n\n/** Batch persist interval (ms) - write at most every 5 seconds */\nconst PERSIST_INTERVAL = 5000;\n\n/**\n * Get counter file path for current session\n */\nfunction getCounterPath(sessionId?: string, projectDir?: string): string {\n  const dir = getSessionDir(sessionId, projectDir);\n  return `${dir}/counter.json`;\n}\n\n/**\n * Load persisted counter value\n * Called once at first event generation\n */\nfunction loadPersistedCounter(sessionId?: string, projectDir?: string): void {\n  if (counterLoaded) return;\n  counterLoaded = true;\n\n  try {\n    const counterPath = getCounterPath(sessionId, projectDir);\n    if (existsSync(counterPath)) {\n      const data = JSON.parse(readFileSync(counterPath, 'utf8'));\n      if (typeof data.counter === 'number' && data.counter > 0) {\n        eventCounter = data.counter;\n        logHook('session-tracker', `Loaded event counter: ${eventCounter}`, 'debug');\n      }\n    }\n  } catch {\n    // Ignore load errors - start fresh\n  }\n}\n\n/**\n * Persist counter to disk (batched)\n * Only writes if counter changed and interval elapsed\n */\nfunction persistCounter(sessionId?: string, projectDir?: string): void {\n  if (!counterDirty) return;\n\n  const now = Date.now();\n  if (now - lastPersistTime < PERSIST_INTERVAL) return;\n\n  try {\n    ensureSessionDir(sessionId, projectDir);\n    const counterPath = getCounterPath(sessionId, projectDir);\n    writeFileSync(counterPath, JSON.stringify({\n      counter: eventCounter,\n      updated_at: new Date().toISOString(),\n    }));\n    counterDirty = false;\n    lastPersistTime = now;\n  } catch {\n    // Ignore persist errors - non-critical\n  }\n}\n\n/**\n * Generate unique event ID with persistent counter\n *\n * Format: evt-{timestamp}-{counter}\n * Counter persists across process restarts to prevent ID collisions.\n */\nfunction generateEventId(): string {\n  // Load persisted counter on first call\n  loadPersistedCounter();\n\n  eventCounter++;\n  counterDirty = true;\n\n  // Attempt batched persist\n  persistCounter();\n\n  return `evt-${Date.now()}-${eventCounter}`;\n}\n\n/**\n * Force persist counter (call at session end)\n * Exported for use by stop hooks\n */\nexport function flushEventCounter(): void {\n  if (counterDirty) {\n    try {\n      ensureSessionDir();\n      const counterPath = getCounterPath();\n      writeFileSync(counterPath, JSON.stringify({\n        counter: eventCounter,\n        updated_at: new Date().toISOString(),\n      }));\n      counterDirty = false;\n      logHook('session-tracker', `Flushed event counter: ${eventCounter}`, 'debug');\n    } catch {\n      // Ignore\n    }\n  }\n}\n\n/**\n * Reset counter state (for testing only)\n */\nexport function resetEventCounter(): void {\n  eventCounter = 0;\n  counterLoaded = false;\n  counterDirty = false;\n  lastPersistTime = 0;\n}\n\n// =============================================================================\n// EVENT TRACKING\n// =============================================================================\n\n/**\n * Track a session event\n *\n * @param eventType - Type of event\n * @param name - Name of skill/agent/hook/tool\n * @param options - Additional event options\n */\nexport function trackEvent(\n  eventType: SessionEventType,\n  name: string,\n  options: {\n    input?: Record<string, unknown>;\n    output?: Record<string, unknown>;\n    duration_ms?: number;\n    success?: boolean;\n    context?: string;\n    confidence?: number;\n  } = {}\n): void {\n  try {\n    const event: SessionEvent = {\n      event_id: generateEventId(),\n      event_type: eventType,\n      identity: getIdentityContext(),\n      payload: {\n        name,\n        input: sanitizeForStorage(options.input),\n        output: sanitizeForStorage(options.output),\n        duration_ms: options.duration_ms,\n        success: options.success ?? true,\n        context: options.context ? truncate(options.context, 500) : undefined,\n        confidence: options.confidence,\n      },\n    };\n\n    ensureSessionDir();\n    const eventsPath = getEventsPath();\n    appendFileSync(eventsPath, JSON.stringify(event) + '\\n');\n\n    logHook('session-tracker', `Tracked ${eventType}: ${name}`, 'debug');\n  } catch (error) {\n    logHook('session-tracker', `Failed to track event: ${error}`, 'warn');\n  }\n}\n\n/**\n * Track skill invocation\n */\nexport function trackSkillInvoked(\n  skillName: string,\n  args?: string,\n  success: boolean = true,\n  durationMs?: number\n): void {\n  trackEvent('skill_invoked', skillName, {\n    input: args ? { args } : undefined,\n    success,\n    duration_ms: durationMs,\n  });\n}\n\n/**\n * Track agent spawn\n */\nexport function trackAgentSpawned(\n  agentType: string,\n  prompt?: string,\n  success: boolean = true\n): void {\n  trackEvent('agent_spawned', agentType, {\n    input: prompt ? { prompt: truncate(prompt, 200) } : undefined,\n    success,\n  });\n}\n\n/**\n * Track hook triggered\n */\nexport function trackHookTriggered(\n  hookName: string,\n  success: boolean = true,\n  durationMs?: number\n): void {\n  trackEvent('hook_triggered', hookName, {\n    success,\n    duration_ms: durationMs,\n  });\n}\n\n/**\n * Track decision made\n */\nexport function trackDecisionMade(\n  decision: string,\n  rationale?: string,\n  confidence?: number\n): void {\n  trackEvent('decision_made', 'decision', {\n    context: decision,\n    input: rationale ? { rationale } : undefined,\n    confidence,\n    success: true,\n  });\n}\n\n/**\n * Track preference stated\n */\nexport function trackPreferenceStated(\n  preference: string,\n  confidence?: number\n): void {\n  trackEvent('preference_stated', 'preference', {\n    context: preference,\n    confidence,\n    success: true,\n  });\n}\n\n/**\n * Track problem reported\n */\nexport function trackProblemReported(problem: string): void {\n  trackEvent('problem_reported', 'problem', {\n    context: problem,\n    success: true,\n  });\n}\n\n/**\n * Track solution found\n */\nexport function trackSolutionFound(\n  solution: string,\n  problemId?: string,\n  confidence?: number\n): void {\n  trackEvent('solution_found', 'solution', {\n    context: solution,\n    input: problemId ? { problem_id: problemId } : undefined,\n    confidence,\n    success: true,\n  });\n}\n\n/**\n * Track tool usage\n *\n * @param toolName - Name of the tool (e.g., 'Grep', 'Read')\n * @param success - Whether the tool call succeeded\n * @param durationMs - Duration of the tool call in milliseconds\n * @param category - Tool category (e.g., 'search', 'file_read') for preference tracking\n */\nexport function trackToolUsed(\n  toolName: string,\n  success: boolean = true,\n  durationMs?: number,\n  category?: string\n): void {\n  trackEvent('tool_used', toolName, {\n    success,\n    duration_ms: durationMs,\n    input: category ? { category } : undefined,\n  });\n}\n\n/**\n * Session context captured at session start\n * Issue #245 Phase 5: Session Lifecycle Tracking\n */\nexport interface SessionContext {\n  /** Project directory path */\n  project_dir?: string;\n  /** Current git branch */\n  git_branch?: string;\n  /** Time of day category */\n  time_of_day?: 'morning' | 'afternoon' | 'evening' | 'night';\n  /** Timestamp */\n  started_at: string;\n}\n\n/**\n * Get time of day category from hour\n */\nfunction getTimeOfDay(hour: number): 'morning' | 'afternoon' | 'evening' | 'night' {\n  if (hour >= 5 && hour < 12) return 'morning';\n  if (hour >= 12 && hour < 17) return 'afternoon';\n  if (hour >= 17 && hour < 21) return 'evening';\n  return 'night';\n}\n\n/**\n * Track session start with context\n * Issue #245 Phase 5: Session Lifecycle Tracking\n *\n * @param context - Optional session context (project, branch, time)\n */\nexport function trackSessionStart(context?: Partial<SessionContext>): void {\n  const now = new Date();\n  const sessionContext: SessionContext = {\n    project_dir: context?.project_dir,\n    git_branch: context?.git_branch,\n    time_of_day: context?.time_of_day || getTimeOfDay(now.getHours()),\n    started_at: now.toISOString(),\n  };\n\n  trackEvent('session_start', 'session', {\n    success: true,\n    input: sessionContext as unknown as Record<string, unknown>,\n  });\n}\n\n/**\n * Track session end with timestamp\n * Issue #245 Phase 5: Session Lifecycle Tracking\n */\nexport function trackSessionEnd(): void {\n  trackEvent('session_end', 'session', {\n    success: true,\n    input: { ended_at: new Date().toISOString() },\n  });\n}\n\n/**\n * Track user communication style\n */\nexport function trackCommunicationStyle(\n  style: {\n    verbosity: 'terse' | 'moderate' | 'detailed';\n    interaction_type: 'question' | 'command' | 'discussion';\n    technical_level: 'beginner' | 'intermediate' | 'expert';\n  }\n): void {\n  trackEvent('communication_style_detected', 'communication', {\n    input: style as unknown as Record<string, unknown>,\n    success: true,\n  });\n}\n\n\n// =============================================================================\n// SESSION SUMMARY\n// =============================================================================\n\n/**\n * Load all events for a session\n */\nexport function loadSessionEvents(sessionId?: string): SessionEvent[] {\n  const eventsPath = getEventsPath(sessionId);\n\n  if (!existsSync(eventsPath)) {\n    return [];\n  }\n\n  try {\n    const content = readFileSync(eventsPath, 'utf8');\n    const lines = content.trim().split('\\n').filter(Boolean);\n    return lines.map(line => JSON.parse(line));\n  } catch (error) {\n    logHook('session-tracker', `Failed to load session events: ${error}`, 'warn');\n    return [];\n  }\n}\n\n/**\n * Generate session summary from events\n */\nexport function generateSessionSummary(sessionId?: string): SessionSummary {\n  const events = loadSessionEvents(sessionId);\n  const identity = getIdentityContext();\n\n  const eventCounts: Record<SessionEventType, number> = {\n    skill_invoked: 0,\n    agent_spawned: 0,\n    hook_triggered: 0,\n    decision_made: 0,\n    preference_stated: 0,\n    problem_reported: 0,\n    solution_found: 0,\n    tool_used: 0,\n    session_start: 0,\n    session_end: 0,\n    communication_style_detected: 0,\n  };\n\n  const skillsUsed = new Set<string>();\n  const agentsSpawned = new Set<string>();\n  const hooksTriggered = new Set<string>();\n\n  let startTime: string | undefined;\n  let endTime: string | undefined;\n\n  for (const event of events) {\n    eventCounts[event.event_type]++;\n\n    switch (event.event_type) {\n      case 'skill_invoked':\n        skillsUsed.add(event.payload.name);\n        break;\n      case 'agent_spawned':\n        agentsSpawned.add(event.payload.name);\n        break;\n      case 'hook_triggered':\n        hooksTriggered.add(event.payload.name);\n        break;\n      case 'session_start':\n        startTime = event.identity.timestamp;\n        break;\n      case 'session_end':\n        endTime = event.identity.timestamp;\n        break;\n    }\n  }\n\n  const durationMs =\n    startTime && endTime\n      ? new Date(endTime).getTime() - new Date(startTime).getTime()\n      : undefined;\n\n  return {\n    session_id: sessionId || identity.session_id,\n    user_id: identity.user_id,\n    anonymous_id: identity.anonymous_id,\n    team_id: identity.team_id,\n    start_time: startTime,\n    end_time: endTime,\n    duration_ms: durationMs,\n    event_counts: eventCounts,\n    skills_used: [...skillsUsed],\n    agents_spawned: [...agentsSpawned],\n    hooks_triggered: [...hooksTriggered],\n    decisions_made: eventCounts.decision_made,\n    problems_reported: eventCounts.problem_reported,\n    solutions_found: eventCounts.solution_found,\n  };\n}\n\n// =============================================================================\n// CROSS-SESSION QUERIES\n// =============================================================================\n// GAP-008/009 FIX: Removed listSessionIds() and getRecentUserSessions()\n// These functions were exported but never called by production code.\n// Cross-session queries should be handled by profile-injector if needed.\n// =============================================================================\n\n// =============================================================================\n// UTILITIES\n// =============================================================================\n\n/**\n * Truncate string to max length\n */\nfunction truncate(str: string, maxLen: number): string {\n  if (str.length <= maxLen) return str;\n  return str.slice(0, maxLen - 3) + '...';\n}\n\n/**\n * Sanitize object for storage (remove sensitive data, truncate)\n */\nfunction sanitizeForStorage(\n  obj: Record<string, unknown> | undefined\n): Record<string, unknown> | undefined {\n  if (!obj) return undefined;\n\n  const sanitized: Record<string, unknown> = {};\n  const sensitiveKeys = ['password', 'secret', 'token', 'key', 'credential', 'auth'];\n\n  for (const [key, value] of Object.entries(obj)) {\n    // Skip sensitive keys\n    if (sensitiveKeys.some(s => key.toLowerCase().includes(s))) {\n      sanitized[key] = '[REDACTED]';\n      continue;\n    }\n\n    // Truncate long strings\n    if (typeof value === 'string' && value.length > 500) {\n      sanitized[key] = truncate(value, 500);\n      continue;\n    }\n\n    // Recursively sanitize objects\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      sanitized[key] = sanitizeForStorage(value as Record<string, unknown>);\n      continue;\n    }\n\n    sanitized[key] = value;\n  }\n\n  return sanitized;\n}\n", "/**\n * User Identity System\n * Resolves and manages user identity across sessions for multi-user decision capture.\n *\n * Identity Resolution Order:\n * 1. Explicit config (.claude/.user_identity.json)\n * 2. Git config (user.email, user.name)\n * 3. Environment variables (USER, USERNAME)\n * 4. Anonymous (machine-based hash)\n *\n * Privacy: User controls what gets shared via privacy settings.\n * Storage: User profiles stored locally in .claude/memory/users/\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport { createHash } from 'node:crypto';\nimport { getProjectDir, getSessionId, logHook } from './common.js';\nimport * as os from 'node:os';\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\n/**\n * User identity source - where the identity was resolved from\n */\nexport type IdentitySource = 'config' | 'git' | 'env' | 'anonymous';\n\n/**\n * Resolved user identity\n */\nexport interface UserIdentity {\n  /** Unique user identifier (email, username, or anonymous hash) */\n  user_id: string;\n  /** Human-readable display name */\n  display_name: string;\n  /** Optional team/org identifier */\n  team_id?: string;\n  /** Machine identifier (hostname) */\n  machine_id: string;\n  /** How the identity was resolved */\n  source: IdentitySource;\n  /** Anonymous hash for global sharing (privacy-preserving) */\n  anonymous_id: string;\n  /** Email if available */\n  email?: string;\n}\n\n/**\n * User privacy settings - controls what gets shared\n */\nexport interface PrivacySettings {\n  /** Share patterns with team (same project) */\n  share_with_team: boolean;\n  /** Share patterns globally (anonymized) */\n  share_globally: boolean;\n  /** Share decisions */\n  share_decisions: boolean;\n  /** Share preferences */\n  share_preferences: boolean;\n  /** Share skill usage statistics */\n  share_skill_usage: boolean;\n  /** Share prompt content (usually false for privacy) */\n  share_prompts: boolean;\n  /** Anonymize user_id when sharing globally */\n  anonymize_globally: boolean;\n}\n\n/**\n * User identity configuration file format\n */\nexport interface UserIdentityConfig {\n  /** Explicit user ID */\n  user_id?: string;\n  /** Display name */\n  display_name?: string;\n  /** Team identifier */\n  team_id?: string;\n  /** Privacy settings */\n  privacy?: Partial<PrivacySettings>;\n}\n\n// =============================================================================\n// CONSTANTS\n// =============================================================================\n\nconst IDENTITY_CONFIG_FILE = '.claude/.user_identity.json';\nconst SALT = 'orchestkit-user-identity-v1';\n\n/** Default privacy settings (conservative) */\nconst DEFAULT_PRIVACY: PrivacySettings = {\n  share_with_team: true,\n  share_globally: false, // Opt-in\n  share_decisions: true,\n  share_preferences: true,\n  share_skill_usage: false, // Might reveal workflow\n  share_prompts: false, // Privacy sensitive\n  anonymize_globally: true,\n};\n\n// =============================================================================\n// CACHING\n// =============================================================================\n\nlet cachedIdentity: UserIdentity | null = null;\nlet cachedPrivacy: PrivacySettings | null = null;\n\n/**\n * Clear cached identity (for testing)\n */\nexport function clearIdentityCache(): void {\n  cachedIdentity = null;\n  cachedPrivacy = null;\n}\n\n// =============================================================================\n// IDENTITY RESOLUTION\n// =============================================================================\n\n/**\n * Generate anonymous hash from input\n */\nfunction generateAnonymousId(input: string): string {\n  // Use 32 hex chars (128 bits) for proper collision resistance\n  return createHash('sha256')\n    .update(input + SALT)\n    .digest('hex')\n    .slice(0, 32);\n}\n\n/**\n * Get machine identifier\n */\nfunction getMachineId(): string {\n  try {\n    return os.hostname();\n  } catch {\n    return 'unknown-machine';\n  }\n}\n\n/**\n * Try to read explicit user config\n */\nfunction readUserConfig(projectDir: string): UserIdentityConfig | null {\n  const configPath = `${projectDir}/${IDENTITY_CONFIG_FILE}`;\n\n  if (!existsSync(configPath)) {\n    return null;\n  }\n\n  try {\n    const content = readFileSync(configPath, 'utf8');\n    return JSON.parse(content);\n  } catch (error) {\n    logHook('user-identity', `Failed to read user config: ${error}`, 'warn');\n    return null;\n  }\n}\n\n/**\n * Try to get identity from git config\n */\nfunction getGitIdentity(projectDir: string): { email?: string; name?: string } {\n  const result: { email?: string; name?: string } = {};\n\n  try {\n    result.email = execSync('git config user.email', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 2000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    // Git email not configured\n  }\n\n  try {\n    result.name = execSync('git config user.name', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 2000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    // Git name not configured\n  }\n\n  return result;\n}\n\n/**\n * Get identity from environment variables\n */\nfunction getEnvIdentity(): { username?: string } {\n  const username = process.env.USER || process.env.USERNAME || process.env.LOGNAME;\n  return { username };\n}\n\n/**\n * Resolve user identity using fallback chain\n *\n * Resolution order:\n * 1. Explicit config file\n * 2. Git config\n * 3. Environment username\n * 4. Anonymous (machine-based)\n */\nexport function resolveUserIdentity(projectDir?: string): UserIdentity {\n  // Return cached if available\n  if (cachedIdentity) {\n    return cachedIdentity;\n  }\n\n  const dir = projectDir || getProjectDir();\n  const machineId = getMachineId();\n\n  // 1. Try explicit config\n  const config = readUserConfig(dir);\n  if (config?.user_id) {\n    cachedIdentity = {\n      user_id: config.user_id,\n      display_name: config.display_name || config.user_id,\n      team_id: config.team_id,\n      machine_id: machineId,\n      source: 'config',\n      anonymous_id: generateAnonymousId(config.user_id),\n      email: config.user_id.includes('@') ? config.user_id : undefined,\n    };\n    logHook('user-identity', `Resolved from config: ${cachedIdentity.anonymous_id}`, 'debug');\n    return cachedIdentity;\n  }\n\n  // 2. Try git config\n  const git = getGitIdentity(dir);\n  if (git.email) {\n    cachedIdentity = {\n      user_id: git.email,\n      display_name: git.name || git.email.split('@')[0],\n      team_id: config?.team_id,\n      machine_id: machineId,\n      source: 'git',\n      anonymous_id: generateAnonymousId(git.email),\n      email: git.email,\n    };\n    logHook('user-identity', `Resolved from git: ${cachedIdentity.anonymous_id}`, 'debug');\n    return cachedIdentity;\n  }\n\n  // 3. Try environment\n  const env = getEnvIdentity();\n  if (env.username) {\n    const userId = `${env.username}@${machineId}`;\n    cachedIdentity = {\n      user_id: userId,\n      display_name: env.username,\n      team_id: config?.team_id,\n      machine_id: machineId,\n      source: 'env',\n      anonymous_id: generateAnonymousId(userId),\n    };\n    logHook('user-identity', `Resolved from env: ${cachedIdentity.anonymous_id}`, 'debug');\n    return cachedIdentity;\n  }\n\n  // 4. Anonymous fallback\n  const anonId = generateAnonymousId(machineId + process.pid);\n  cachedIdentity = {\n    user_id: `anon-${anonId.slice(0, 8)}`,\n    display_name: 'Anonymous',\n    team_id: config?.team_id,\n    machine_id: machineId,\n    source: 'anonymous',\n    anonymous_id: anonId,\n  };\n  logHook('user-identity', `Resolved as anonymous: ${cachedIdentity.anonymous_id}`, 'debug');\n  return cachedIdentity;\n}\n\n// =============================================================================\n// PRIVACY SETTINGS\n// =============================================================================\n\n/**\n * Get user's privacy settings\n */\nexport function getPrivacySettings(projectDir?: string): PrivacySettings {\n  if (cachedPrivacy) {\n    return cachedPrivacy;\n  }\n\n  const dir = projectDir || getProjectDir();\n  const config = readUserConfig(dir);\n\n  cachedPrivacy = {\n    ...DEFAULT_PRIVACY,\n    ...config?.privacy,\n  };\n\n  return cachedPrivacy;\n}\n\n/**\n * Check if user allows sharing a specific type of data\n */\nexport function canShare(\n  dataType: 'decisions' | 'preferences' | 'skill_usage' | 'prompts',\n  scope: 'team' | 'global'\n): boolean {\n  const privacy = getPrivacySettings();\n\n  // Check scope permission first\n  if (scope === 'team' && !privacy.share_with_team) return false;\n  if (scope === 'global' && !privacy.share_globally) return false;\n\n  // Check data type permission\n  switch (dataType) {\n    case 'decisions':\n      return privacy.share_decisions;\n    case 'preferences':\n      return privacy.share_preferences;\n    case 'skill_usage':\n      return privacy.share_skill_usage;\n    case 'prompts':\n      return privacy.share_prompts;\n    default:\n      return false;\n  }\n}\n\n/**\n * Get user ID for sharing (applies anonymization if needed)\n */\nexport function getUserIdForScope(scope: 'local' | 'team' | 'global'): string {\n  const identity = resolveUserIdentity();\n  const privacy = getPrivacySettings();\n\n  if (scope === 'global' && privacy.anonymize_globally) {\n    return identity.anonymous_id;\n  }\n\n  return identity.user_id;\n}\n\n// =============================================================================\n// IDENTITY PERSISTENCE\n// =============================================================================\n\n/**\n * Save user identity config (creates or updates)\n */\nexport function saveUserIdentityConfig(\n  config: UserIdentityConfig,\n  projectDir?: string\n): boolean {\n  const dir = projectDir || getProjectDir();\n  const configPath = `${dir}/${IDENTITY_CONFIG_FILE}`;\n  const configDir = `${dir}/.claude`;\n\n  try {\n    if (!existsSync(configDir)) {\n      mkdirSync(configDir, { recursive: true });\n    }\n\n    writeFileSync(configPath, JSON.stringify(config, null, 2));\n\n    // Clear cache to pick up new config\n    clearIdentityCache();\n\n    logHook('user-identity', `Saved identity config to ${configPath}`, 'info');\n    return true;\n  } catch (error) {\n    logHook('user-identity', `Failed to save identity config: ${error}`, 'error');\n    return false;\n  }\n}\n\n// =============================================================================\n// CONTEXT HELPERS\n// =============================================================================\n\n/**\n * Get full identity context for session events\n */\nexport interface IdentityContext {\n  session_id: string;\n  user_id: string;\n  anonymous_id: string;\n  team_id?: string;\n  machine_id: string;\n  identity_source: IdentitySource;\n  timestamp: string;\n}\n\n/**\n * Get identity context for tagging events\n */\nexport function getIdentityContext(): IdentityContext {\n  const identity = resolveUserIdentity();\n\n  return {\n    session_id: getSessionId(),\n    user_id: identity.user_id,\n    anonymous_id: identity.anonymous_id,\n    team_id: identity.team_id,\n    machine_id: identity.machine_id,\n    identity_source: identity.source,\n    timestamp: new Date().toISOString(),\n  };\n}\n\n/**\n * Get project-scoped user ID for mem0 storage\n * Format: {project}-{scope} (e.g., \"my-app-decisions\")\n */\nexport function getProjectUserId(scope: string): string {\n  const projectDir = getProjectDir();\n  const projectName = projectDir.split('/').pop() || 'unknown';\n  const sanitized = projectName.toLowerCase().replace(/[^a-z0-9-]/g, '-');\n  return `${sanitized}-${scope}`;\n}\n\n/**\n * Get user-scoped ID for mem0 storage\n * Format: {user_id}-{scope} (e.g., \"alice@company.com-preferences\")\n */\nexport function getUserScopedId(scope: string): string {\n  const identity = resolveUserIdentity();\n  const sanitizedUserId = identity.user_id.toLowerCase().replace(/[^a-z0-9@.-]/g, '-');\n  return `${sanitizedUserId}-${scope}`;\n}\n\n/**\n * Get global scope ID (for cross-project best practices)\n */\nexport function getGlobalScopeId(scope: string): string {\n  return `orchestkit-global-${scope}`;\n}\n", "/**\n * Session Tracking Hook\n * Issue #245: Multi-User Intelligent Decision Capture System\n * Phase 5: Session Lifecycle Tracking\n *\n * Tracks session start event with context (project, branch, time).\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getProjectDir } from '../lib/common.js';\nimport { trackSessionStart } from '../lib/session-tracker.js';\nimport { execSync } from 'node:child_process';\n\n/**\n * Get current git branch name\n */\nfunction getGitBranch(projectDir: string): string | undefined {\n  try {\n    const branch = execSync('git rev-parse --abbrev-ref HEAD', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n    return branch || undefined;\n  } catch {\n    return undefined;\n  }\n}\n\n/**\n * Track session start event with context\n */\nexport function sessionTracking(input: HookInput): HookResult {\n  try {\n    const projectDir = input.project_dir || getProjectDir();\n    const gitBranch = getGitBranch(projectDir);\n\n    trackSessionStart({\n      project_dir: projectDir,\n      git_branch: gitBranch,\n    });\n\n    logHook('session-tracking', `Tracked session start: branch=${gitBranch || 'unknown'}`, 'debug');\n    return outputSilentSuccess();\n  } catch (error) {\n    logHook('session-tracking', `Error: ${error}`, 'warn');\n    return outputSilentSuccess();\n  }\n}\n", "/**\n * Session Metrics Summary - Shows summary at session end\n * Hook: SessionEnd\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionMetrics {\n  tools?: Record<string, number>;\n  errors?: number;\n}\n\n/**\n * Session metrics summary hook\n */\nexport function sessionMetricsSummary(input: HookInput): HookResult {\n  logHook('session-metrics-summary', 'Session ending - generating summary');\n\n  const metricsFile = '/tmp/claude-session-metrics.json';\n\n  if (!existsSync(metricsFile)) {\n    logHook('session-metrics-summary', 'No metrics file found');\n    return outputSilentSuccess();\n  }\n\n  try {\n    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));\n    const tools = metrics.tools || {};\n    const errors = metrics.errors || 0;\n\n    // Calculate total tool calls\n    const totalTools = Object.values(tools).reduce((sum, count) => sum + count, 0);\n\n    // Get top 3 tools\n    const topTools = Object.entries(tools)\n      .sort(([, a], [, b]) => b - a)\n      .slice(0, 3)\n      .map(([tool, count]) => `${tool}: ${count}`)\n      .join(', ');\n\n    logHook('session-metrics-summary', `Session stats: ${totalTools} tool calls, ${errors} errors`);\n\n    if (totalTools > 0) {\n      // Note: We return silently since SessionEnd hooks typically don't need system messages\n      // The logging is sufficient for audit purposes\n      logHook('session-metrics-summary', `Top tools: ${topTools}`);\n    }\n  } catch (err) {\n    logHook('session-metrics-summary', `Failed to read metrics: ${err}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Dependency Version Check - Check for outdated dependencies at session start\n * Hook: SessionStart (#136)\n * CC 2.1.7 Compliant\n * Optimized with timeout, caching, and fast-exit to prevent startup hangs\n *\n * Parses:\n * - package.json (Node.js)\n * - requirements.txt, pyproject.toml (Python)\n * - go.mod (Go)\n *\n * Warns about:\n * - Known security vulnerabilities (CVE database)\n * - Severely outdated packages\n * - Deprecated packages\n *\n * Uses additionalContext to inject warnings into session context\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\ninterface KnownVuln {\n  package: string;\n  pattern: string;\n  severity: string;\n  cve: string;\n  description: string;\n}\n\ninterface DependencyCache {\n  warnings: string;\n  timestamp: number;\n}\n\ninterface PackageJson {\n  dependencies?: Record<string, string>;\n  devDependencies?: Record<string, string>;\n}\n\n// Known vulnerabilities database (static for offline operation)\nconst KNOWN_VULNS: KnownVuln[] = [\n  { package: 'lodash', pattern: '<4.17.21', severity: 'high', cve: 'CVE-2021-23337', description: 'Prototype pollution' },\n  { package: 'minimist', pattern: '<1.2.6', severity: 'critical', cve: 'CVE-2021-44906', description: 'Prototype pollution' },\n  { package: 'node-fetch', pattern: '<2.6.7', severity: 'high', cve: 'CVE-2022-0235', description: 'Information exposure' },\n  { package: 'axios', pattern: '<0.21.2', severity: 'high', cve: 'CVE-2021-3749', description: 'ReDoS vulnerability' },\n  { package: 'jsonwebtoken', pattern: '<9.0.0', severity: 'critical', cve: 'CVE-2022-23529', description: 'Insecure token verification' },\n  { package: 'express', pattern: '<4.17.3', severity: 'medium', cve: 'CVE-2022-24999', description: 'Open redirect' },\n  { package: 'tar', pattern: '<6.1.11', severity: 'critical', cve: 'CVE-2021-37701', description: 'Arbitrary file overwrite' },\n  { package: 'path-parse', pattern: '<1.0.7', severity: 'medium', cve: 'CVE-2021-23343', description: 'ReDoS vulnerability' },\n  { package: 'django', pattern: '<3.2.14', severity: 'high', cve: 'CVE-2022-34265', description: 'SQL injection' },\n  { package: 'flask', pattern: '<2.0.2', severity: 'medium', cve: 'CVE-2021-28091', description: 'Path traversal' },\n  { package: 'requests', pattern: '<2.28.0', severity: 'medium', cve: 'CVE-2023-32681', description: 'Information disclosure' },\n  { package: 'urllib3', pattern: '<1.26.5', severity: 'high', cve: 'CVE-2021-33503', description: 'ReDoS vulnerability' },\n  { package: 'pillow', pattern: '<9.0.0', severity: 'high', cve: 'CVE-2022-22817', description: 'Buffer overflow' },\n  { package: 'pyyaml', pattern: '<5.4', severity: 'critical', cve: 'CVE-2020-14343', description: 'Arbitrary code execution' },\n  { package: 'jinja2', pattern: '<3.0.3', severity: 'medium', cve: 'CVE-2020-28493', description: 'XSS vulnerability' },\n  { package: 'sqlalchemy', pattern: '<1.4.46', severity: 'medium', cve: 'CVE-2023-30533', description: 'SQL injection' },\n];\n\nconst CACHE_TTL_HOURS = 24;\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Compare semantic versions (simplified)\n */\nfunction versionLessThan(current: string, target: string): boolean {\n  const currentParts = current.split('.').map((p) => parseInt(p, 10) || 0);\n  const targetParts = target.split('.').map((p) => parseInt(p, 10) || 0);\n\n  for (let i = 0; i < Math.max(currentParts.length, targetParts.length); i++) {\n    const c = currentParts[i] || 0;\n    const t = targetParts[i] || 0;\n    if (c < t) return true;\n    if (c > t) return false;\n  }\n  return false;\n}\n\n/**\n * Check if version matches vulnerability pattern\n */\nfunction versionMatchesVuln(currentVersion: string, vulnPattern: string): boolean {\n  const operator = vulnPattern.charAt(0);\n  const vulnVersion = vulnPattern.substring(1);\n\n  if (operator === '<') {\n    return versionLessThan(currentVersion, vulnVersion);\n  } else if (operator === '=') {\n    return currentVersion === vulnVersion;\n  }\n\n  return false;\n}\n\n/**\n * Clean version string (remove ^, ~, etc.)\n */\nfunction cleanVersion(version: string): string {\n  return version\n    .replace(/^[^~>=<]/, '')\n    .replace(/,.*$/, '')\n    .trim();\n}\n\n/**\n * Check a package against known vulnerabilities\n */\nfunction checkPackageVulnerability(packageName: string, version: string): KnownVuln | null {\n  const cleanedVersion = cleanVersion(version);\n  const pkgLower = packageName.toLowerCase();\n\n  for (const vuln of KNOWN_VULNS) {\n    if (pkgLower === vuln.package) {\n      if (versionMatchesVuln(cleanedVersion, vuln.pattern)) {\n        return vuln;\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Check if cache is valid\n */\nfunction getCachedWarnings(cacheFile: string): string | null {\n  if (!existsSync(cacheFile)) {\n    return null;\n  }\n\n  try {\n    const cache: DependencyCache = JSON.parse(readFileSync(cacheFile, 'utf-8'));\n    const cacheAge = (Date.now() - cache.timestamp) / (1000 * 60 * 60);\n\n    if (cacheAge < CACHE_TTL_HOURS) {\n      return cache.warnings;\n    }\n  } catch {\n    // Cache invalid\n  }\n\n  return null;\n}\n\n/**\n * Save warnings to cache\n */\nfunction saveCache(cacheFile: string, warnings: string): void {\n  try {\n    mkdirSync(cacheFile.replace(/\\/[^/]+$/, ''), { recursive: true });\n\n    const cache: DependencyCache = {\n      warnings,\n      timestamp: Date.now(),\n    };\n\n    writeFileSync(cacheFile, JSON.stringify(cache, null, 2));\n  } catch {\n    // Ignore cache write errors\n  }\n}\n\n/**\n * Parse package.json for vulnerabilities\n */\nfunction parsePackageJson(filePath: string): { criticalCount: number; highCount: number; warnings: string } {\n  let criticalCount = 0;\n  let highCount = 0;\n  let warnings = '';\n\n  if (!existsSync(filePath)) {\n    return { criticalCount, highCount, warnings };\n  }\n\n  try {\n    const pkg: PackageJson = JSON.parse(readFileSync(filePath, 'utf-8'));\n    const allDeps = { ...pkg.dependencies, ...pkg.devDependencies };\n\n    for (const [packageName, version] of Object.entries(allDeps)) {\n      const vuln = checkPackageVulnerability(packageName, version);\n      if (vuln) {\n        if (vuln.severity === 'critical') criticalCount++;\n        if (vuln.severity === 'high') highCount++;\n        warnings += `\\n- ${packageName}@${version}: ${vuln.description} (${vuln.cve}, ${vuln.severity}) - upgrade to ${vuln.pattern}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return { criticalCount, highCount, warnings };\n}\n\n/**\n * Parse requirements.txt for vulnerabilities\n */\nfunction parseRequirementsTxt(filePath: string): { criticalCount: number; highCount: number; warnings: string } {\n  let criticalCount = 0;\n  let highCount = 0;\n  let warnings = '';\n\n  if (!existsSync(filePath)) {\n    return { criticalCount, highCount, warnings };\n  }\n\n  try {\n    const content = readFileSync(filePath, 'utf-8');\n    const lines = content.split('\\n');\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (!trimmed || trimmed.startsWith('#')) continue;\n\n      // Parse package==version or package>=version\n      const match = trimmed.match(/^([a-zA-Z0-9_-]+)(?:==|>=|~=|!=|<|>)\\s*([0-9.]+)/);\n      if (!match) continue;\n\n      const [, packageName, version] = match;\n      const vuln = checkPackageVulnerability(packageName, version);\n      if (vuln) {\n        if (vuln.severity === 'critical') criticalCount++;\n        if (vuln.severity === 'high') highCount++;\n        warnings += `\\n- ${packageName}==${version}: ${vuln.description} (${vuln.cve}, ${vuln.severity}) - upgrade to ${vuln.pattern}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return { criticalCount, highCount, warnings };\n}\n\n/**\n * Dependency version check hook\n */\nexport function dependencyVersionCheck(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('dependency-version-check', 'Skipping dependency check (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('dependency-version-check', 'Starting dependency version check');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const cacheFile = `${projectDir}/.claude/feedback/dependency-check-cache.json`;\n\n  // Fast exit: Check if any package files exist\n  const hasPackageJson = existsSync(`${projectDir}/package.json`);\n  const hasRequirementsTxt = existsSync(`${projectDir}/requirements.txt`);\n  const hasPyprojectToml = existsSync(`${projectDir}/pyproject.toml`);\n  const hasGoMod = existsSync(`${projectDir}/go.mod`);\n\n  if (!hasPackageJson && !hasRequirementsTxt && !hasPyprojectToml && !hasGoMod) {\n    logHook('dependency-version-check', 'No package files found, skipping check');\n    saveCache(cacheFile, 'none');\n    return outputSilentSuccess();\n  }\n\n  // Check cache first\n  const cached = getCachedWarnings(cacheFile);\n  if (cached !== null) {\n    logHook('dependency-version-check', 'Using cached dependency warnings');\n    if (cached !== 'none') {\n      return outputWithContext(`DEPENDENCY SECURITY CHECK (cached): ${cached}`);\n    }\n    return outputSilentSuccess();\n  }\n\n  let totalCritical = 0;\n  let totalHigh = 0;\n  let allWarnings = '';\n\n  // Check package.json\n  if (hasPackageJson) {\n    const result = parsePackageJson(`${projectDir}/package.json`);\n    totalCritical += result.criticalCount;\n    totalHigh += result.highCount;\n    if (result.warnings) {\n      allWarnings += `\\n\\nNode.js (package.json):${result.warnings}`;\n    }\n  }\n\n  // Check requirements.txt\n  if (hasRequirementsTxt) {\n    const result = parseRequirementsTxt(`${projectDir}/requirements.txt`);\n    totalCritical += result.criticalCount;\n    totalHigh += result.highCount;\n    if (result.warnings) {\n      allWarnings += `\\n\\nPython (requirements.txt):${result.warnings}`;\n    }\n  }\n\n  // Generate output\n  if (allWarnings) {\n    const summary = `Found ${totalCritical} critical and ${totalHigh} high severity vulnerabilities`;\n    const fullWarning = `DEPENDENCY SECURITY CHECK: ${summary}${allWarnings}\\n\\nRun 'npm audit' or 'pip-audit' for full details.`;\n\n    saveCache(cacheFile, fullWarning);\n    logHook('dependency-version-check', summary);\n\n    // Only show warning if there are critical or high severity issues\n    if (totalCritical > 0 || totalHigh > 0) {\n      return outputWithContext(fullWarning);\n    }\n  } else {\n    saveCache(cacheFile, 'none');\n    logHook('dependency-version-check', 'No known vulnerabilities found');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Unified SessionStart Dispatcher\n * Issue #235: Hook Architecture Refactor\n * Issue #239: Move initialization hooks to Setup event\n *\n * Consolidates session-specific async hooks into a single dispatcher.\n * Reduces \"Async hook SessionStart completed\" messages.\n *\n * Note: One-time initialization hooks (dependency-version-check,\n * mem0-webhook-setup, coordination-init) moved to Setup dispatcher\n * in Issue #239 - they only need to run once at plugin load.\n *\n * CC 2.1.19 Compliant: Single async hook with internal routing\n *\n * NOTE: Async hooks are fire-and-forget by design. They can only return\n * { async: true, asyncTimeout } - fields like systemMessage, continue,\n * decision are NOT processed by Claude Code for async hooks.\n * Failures are logged to file but not surfaced to users.\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook } from '../lib/common.js';\n\n// Import session-specific hook implementations\n// Note: dependency-version-check, mem0-webhook-setup, coordination-init\n// moved to setup/unified-dispatcher.ts (Issue #239)\nimport { mem0ContextRetrieval } from './mem0-context-retrieval.js';\nimport { mem0AnalyticsTracker } from './mem0-analytics-tracker.js';\nimport { patternSyncPull } from './pattern-sync-pull.js';\nimport { multiInstanceInit } from './multi-instance-init.js';\nimport { instanceHeartbeat } from './instance-heartbeat.js';\nimport { sessionEnvSetup } from './session-env-setup.js';\nimport { sessionTracking } from './session-tracking.js';\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\ntype HookFn = (input: HookInput) => HookResult | Promise<HookResult>;\n\ninterface HookConfig {\n  name: string;\n  fn: HookFn;\n}\n\n// -----------------------------------------------------------------------------\n// Hook Registry\n// -----------------------------------------------------------------------------\n\n/**\n * Registry of session-specific async SessionStart hooks\n * One-time initialization hooks moved to Setup dispatcher (Issue #239)\n */\nconst HOOKS: HookConfig[] = [\n  { name: 'mem0-context-retrieval', fn: mem0ContextRetrieval },\n  { name: 'mem0-analytics-tracker', fn: mem0AnalyticsTracker },\n  { name: 'pattern-sync-pull', fn: patternSyncPull },\n  { name: 'multi-instance-init', fn: multiInstanceInit },\n  { name: 'instance-heartbeat', fn: instanceHeartbeat },\n  { name: 'session-env-setup', fn: sessionEnvSetup },\n  { name: 'session-tracking', fn: sessionTracking },\n];\n\n/** Exposed for registry wiring tests */\nexport const registeredHookNames = () => HOOKS.map(h => h.name);\n\n// -----------------------------------------------------------------------------\n// Dispatcher Implementation\n// -----------------------------------------------------------------------------\n\n/**\n * Unified dispatcher that runs all SessionStart hooks in parallel\n */\nexport async function unifiedSessionStartDispatcher(input: HookInput): Promise<HookResult> {\n  // Run all hooks in parallel\n  const results = await Promise.allSettled(\n    HOOKS.map(async hook => {\n      try {\n        const result = hook.fn(input);\n        if (result instanceof Promise) {\n          await result;\n        }\n        return { hook: hook.name, status: 'success' };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        logHook('session-start-dispatcher', `${hook.name} failed: ${message}`);\n        return { hook: hook.name, status: 'error', message };\n      }\n    })\n  );\n\n  // Count failures for logging (async hooks can't report to users)\n  const failures: string[] = [];\n\n  for (const result of results) {\n    if (result.status === 'rejected') {\n      failures.push('unknown');\n    } else if (result.value.status === 'error') {\n      failures.push(result.value.hook);\n    }\n  }\n\n  // Log failures (async hooks are fire-and-forget - can't surface to users)\n  if (failures.length > 0) {\n    logHook('session-start-dispatcher', `${failures.length}/${HOOKS.length} hooks failed: ${failures.join(', ')}`);\n  }\n\n  // Async hooks always return silent success - CC ignores other fields\n  return outputSilentSuccess();\n}\n", "/**\n * PreCompact Saver\n * CC 2.1.25: Saves session context before context compaction\n *\n * When CC compacts the conversation context, this hook preserves\n * critical session state (active tasks, current branch, working files)\n * to the session state file so it survives compaction.\n */\n\nimport { writeFileSync, existsSync, readFileSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess, logHook, getLogDir, getSessionId } from '../lib/common.js';\n\ninterface SessionState {\n  lastCompaction?: string;\n  compactionCount?: number;\n  preservedContext?: {\n    branch?: string;\n    activeFiles?: string[];\n    sessionNotes?: string;\n  };\n}\n\nfunction getSessionStateFile(): string {\n  const logDir = getLogDir();\n  const stateDir = join(logDir, 'sessions');\n  if (!existsSync(stateDir)) {\n    mkdirSync(stateDir, { recursive: true });\n  }\n  return join(stateDir, `${getSessionId()}-state.json`);\n}\n\nfunction loadSessionState(stateFile: string): SessionState {\n  try {\n    if (existsSync(stateFile)) {\n      return JSON.parse(readFileSync(stateFile, 'utf8'));\n    }\n  } catch {\n    // Ignore parse errors\n  }\n  return {};\n}\n\nexport function preCompactSaver(input: HookInput): HookResult {\n  try {\n    const stateFile = getSessionStateFile();\n    const state = loadSessionState(stateFile);\n\n    // Update compaction metadata\n    state.lastCompaction = new Date().toISOString();\n    state.compactionCount = (state.compactionCount || 0) + 1;\n\n    // Preserve context from current session\n    state.preservedContext = {\n      branch: process.env.ORCHESTKIT_BRANCH || undefined,\n      sessionNotes: `Compaction #${state.compactionCount} at ${state.lastCompaction}`,\n    };\n\n    writeFileSync(stateFile, JSON.stringify(state, null, 2));\n\n    logHook('pre-compact-saver', `Saved state before compaction #${state.compactionCount}`);\n  } catch (error) {\n    const msg = error instanceof Error ? error.message : String(error);\n    logHook('pre-compact-saver', `Failed to save state: ${msg}`, 'warn');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Lifecycle Hooks Entry Point\n *\n * Hooks that run on session start/end (SessionStart, SessionEnd)\n * Bundle: lifecycle.mjs (~30 KB estimated)\n */\n\n// Re-export types and utilities\nexport * from '../types.js';\nexport * from '../lib/common.js';\nexport * from '../lib/git.js';\n\n// Lifecycle hooks (18) - SessionStart/SessionEnd\nimport { analyticsConsentCheck } from '../lifecycle/analytics-consent-check.js';\nimport { coordinationCleanup } from '../lifecycle/coordination-cleanup.js';\nimport { coordinationInit } from '../lifecycle/coordination-init.js';\nimport { instanceHeartbeat } from '../lifecycle/instance-heartbeat.js';\nimport { mem0AnalyticsTracker } from '../lifecycle/mem0-analytics-tracker.js';\nimport { mem0ContextRetrieval } from '../lifecycle/mem0-context-retrieval.js';\nimport { mem0WebhookSetup } from '../lifecycle/mem0-webhook-setup.js';\nimport { multiInstanceInit } from '../lifecycle/multi-instance-init.js';\nimport { patternSyncPull } from '../lifecycle/pattern-sync-pull.js';\nimport { patternSyncPush } from '../lifecycle/pattern-sync-push.js';\nimport { prStatusEnricher } from '../lifecycle/pr-status-enricher.js';\nimport { sessionCleanup } from '../lifecycle/session-cleanup.js';\nimport { sessionContextLoader } from '../lifecycle/session-context-loader.js';\nimport { sessionEnvSetup } from '../lifecycle/session-env-setup.js';\nimport { sessionTracking } from '../lifecycle/session-tracking.js';\nimport { sessionMetricsSummary } from '../lifecycle/session-metrics-summary.js';\nimport { dependencyVersionCheck } from '../lifecycle/dependency-version-check.js';\nimport { unifiedSessionStartDispatcher } from '../lifecycle/unified-dispatcher.js';\nimport { preCompactSaver } from '../lifecycle/pre-compact-saver.js';\n\nimport type { HookFn } from '../types.js';\n\n/**\n * Lifecycle hooks registry\n */\nexport const hooks: Record<string, HookFn> = {\n  'lifecycle/analytics-consent-check': analyticsConsentCheck,\n  'lifecycle/coordination-cleanup': coordinationCleanup,\n  'lifecycle/coordination-init': coordinationInit,\n  'lifecycle/instance-heartbeat': instanceHeartbeat,\n  'lifecycle/mem0-analytics-tracker': mem0AnalyticsTracker,\n  'lifecycle/mem0-context-retrieval': mem0ContextRetrieval,\n  'lifecycle/mem0-webhook-setup': mem0WebhookSetup,\n  'lifecycle/multi-instance-init': multiInstanceInit,\n  'lifecycle/pattern-sync-pull': patternSyncPull,\n  'lifecycle/pattern-sync-push': patternSyncPush,\n  'lifecycle/pr-status-enricher': prStatusEnricher,\n  'lifecycle/session-cleanup': sessionCleanup,\n  'lifecycle/session-context-loader': sessionContextLoader,\n  'lifecycle/session-env-setup': sessionEnvSetup,\n  'lifecycle/session-tracking': sessionTracking,\n  'lifecycle/session-metrics-summary': sessionMetricsSummary,\n  'lifecycle/dependency-version-check': dependencyVersionCheck,\n  'lifecycle/unified-dispatcher': unifiedSessionStartDispatcher,\n  'lifecycle/pre-compact-saver': preCompactSaver,\n};\n\nexport function getHook(name: string): HookFn | undefined {\n  return hooks[name];\n}\n\nexport function listHooks(): string[] {\n  return Object.keys(hooks);\n}\n"],
  "mappings": "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",
  "names": ["isBashInput", "input", "isWriteInput", "isEditInput", "isReadInput", "appendFileSync", "existsSync", "statSync", "renameSync", "mkdirSync", "readSync", "execSync", "os", "path", "getHomeDir", "getProjectDir", "getPluginRoot", "getLogDir", "path", "getHomeDir", "joinPath", "path", "pathSeparator", "execSync", "createHash", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "join", "basename", "MAX_PROJECT_LENGTH", "MAX_BRANCH_LENGTH", "SAFE_CHARS", "getProjectName", "projectDir", "dir", "name", "sanitizeName", "getGitBranchForSession", "branch", "sanitized", "formatDateComponent", "date", "d", "month", "day", "formatTimeComponent", "hours", "minutes", "generateShortHash", "entropy", "maxLength", "generateSmartSessionId", "project", "dateStr", "timeStr", "hash", "getCachedSessionId", "cachePath", "data", "age", "maxAge", "cacheSessionId", "sessionId", "instanceDir", "getOrGenerateSessionId", "cached", "newId", "getLogDir", "getProjectDir", "getPluginRoot", "getEnvFile", "getSessionId", "getOrGenerateSessionId", "getCachedBranch", "projectDir", "branch", "execSync", "getLogLevel", "normalizeLineEndings", "content", "shouldLog", "level", "levels", "outputSilentSuccess", "outputSilentAllow", "outputBlock", "reason", "outputWithContext", "ctx", "outputPromptContext", "outputAllowWithContext", "systemMessage", "result", "outputError", "message", "outputWarning", "outputDeny", "outputWithUpdatedInput", "updatedInput", "LOG_ROTATION_MAX_SIZE", "PERMISSION_LOG_MAX_SIZE", "rotateLogFile", "logFile", "maxSize", "existsSync", "statSync", "rotated", "renameSync", "ensureDir", "dir", "mkdirSync", "logHook", "hookName", "logDir", "timestamp", "appendFileSync", "logPermissionFeedback", "decision", "input", "toolName", "sessionId", "estimateTokenCount", "charsPerToken", "outputPromptContextBudgeted", "category", "budgetChecker", "tokenTracker", "tokens", "readHookInput", "chunks", "buf", "bytesRead", "fd", "readSync", "getField", "path", "parts", "value", "part", "normalizeCommand", "command", "escapeRegex", "str", "execSync", "getCurrentBranch", "projectDir", "dir", "getProjectDir", "execSync", "isProtectedBranch", "branch", "currentBranch", "getRepoRoot", "isGitRepo", "getGitStatus", "hasUncommittedChanges", "getDefaultBranch", "extractIssueNumber", "patterns", "pattern", "match", "validateBranchName", "validPrefixes", "prefix", "existsSync", "readFileSync", "getConsentStatus", "projectDir", "consentFile", "existsSync", "status", "readFileSync", "getLastConsentEvent", "consentLog", "log", "shouldShowReminder", "lastTimestamp", "lastDate", "analyticsConsentCheck", "input", "getProjectDir", "logHook", "outputSilentSuccess", "lastEvent", "existsSync", "readFileSync", "writeFileSync", "unlinkSync", "loadInstanceId", "projectDir", "envFile", "existsSync", "match", "readFileSync", "updateHeartbeatStatus", "instanceId", "heartbeatFile", "content", "writeFileSync", "logHook", "err", "unregisterInstance", "dbPath", "cleanupInstanceEnv", "unlinkSync", "coordinationCleanup", "input", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "appendFileSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "getTaskDescription", "projectDir", "stateFile", "existsSync", "readFileSync", "getAgentRole", "generateInstanceId", "sessionId", "getSessionId", "timestamp", "random", "saveInstanceId", "instanceId", "envFile", "getEnvFile", "mkdirSync", "appendFileSync", "logHook", "err", "initHeartbeat", "taskDesc", "agentRole", "heartbeatsDir", "heartbeat", "writeFileSync", "coordinationInit", "input", "outputSilentSuccess", "getProjectDir", "existsSync", "readFileSync", "writeFileSync", "readdirSync", "unlinkSync", "mkdirSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "getInstanceId", "getSessionId", "loadInstanceIdFromFile", "projectDir", "envFile", "existsSync", "match", "readFileSync", "updateHeartbeat", "instanceId", "heartbeatsDir", "heartbeatFile", "mkdirSync", "heartbeat", "writeFileSync", "logHook", "content", "err", "cleanupStaleInstances", "currentInstanceId", "staleThresholdMs", "now", "cleanedCount", "files", "readdirSync", "f", "file", "filePath", "lastHeartbeat", "unlinkSync", "instanceHeartbeat", "input", "outputSilentSuccess", "getProjectDir", "mkdirSync", "appendFileSync", "isMem0Available", "mem0AnalyticsTracker", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "analyticsFile", "sessionId", "getSessionId", "timestamp", "analyticsEntry", "mkdirSync", "appendFileSync", "err", "existsSync", "readFileSync", "mkdirSync", "renameSync", "getProjectId", "projectDir", "parts", "isMem0Available", "hasValidPendingSync", "filePath", "existsSync", "content", "readFileSync", "parsed", "archivePendingSync", "processedDir", "timestamp", "mkdirSync", "archiveName", "archivePath", "renameSync", "logHook", "err", "mem0ContextRetrieval", "input", "logHook", "projectDir", "getProjectDir", "projectId", "getProjectId", "pendingSyncFile", "pendingSyncGlobal", "getHomeDir", "pendingFile", "hasValidPendingSync", "content", "readFileSync", "archivePendingSync", "isMem0Available", "outputSilentSuccess", "writeFileSync", "mkdirSync", "isMem0Available", "shouldSkipSlowHooks", "mem0WebhookSetup", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "webhookConfigFile", "webhookName", "webhookEvents", "webhookUrl", "mkdirSync", "writeFileSync", "err", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "isSqlite3Available", "execSync", "generateInstanceId", "projectDir", "worktreeName", "timestamp", "random", "getCurrentBranch", "detectCapabilities", "caps", "existsSync", "createInstanceIdentity", "instanceId", "branch", "capabilities", "now", "identity", "instanceDir", "mkdirSync", "writeFileSync", "logHook", "initDatabase", "coordDir", "dbPath", "schemaPath", "err", "startHeartbeat", "multiInstanceInit", "input", "outputSilentSuccess", "getProjectDir", "idFile", "pidFile", "existingId", "readFileSync", "existsSync", "readFileSync", "writeFileSync", "statSync", "mkdirSync", "MAX_FILE_SIZE_BYTES", "shouldSkipSlowHooks", "isSyncEnabled", "projectDir", "configFile", "existsSync", "readFileSync", "checkFileSize", "filePath", "stats", "statSync", "logHook", "pullGlobalPatterns", "globalPatternsFile", "getHomeDir", "projectPatternsFile", "globalList", "projectPatterns", "projectList", "existingTexts", "p", "newPatterns", "mergedPatterns", "mkdirSync", "writeFileSync", "err", "patternSyncPull", "input", "outputSilentSuccess", "getProjectDir", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "isSyncEnabled", "projectDir", "configFile", "existsSync", "readFileSync", "pushProjectPatterns", "projectPatternsFile", "home", "getHomeDir", "globalPatternsFile", "logHook", "projectList", "globalPatterns", "globalList", "existingTexts", "p", "newPatterns", "mergedPatterns", "mkdirSync", "writeFileSync", "err", "patternSyncPush", "input", "getProjectDir", "outputSilentSuccess", "execSync", "SKIP_BRANCHES", "prStatusEnricher", "input", "logHook", "projectDir", "getProjectDir", "branch", "getCachedBranch", "outputSilentSuccess", "prJson", "execSync", "pr", "unresolvedCount", "threadsJson", "t", "draftLabel", "reviewLabel", "unresolvedLabel", "existsSync", "readFileSync", "mkdirSync", "readdirSync", "unlinkSync", "copyFileSync", "getTotalTools", "metricsFile", "existsSync", "tools", "readFileSync", "sum", "count", "archiveMetrics", "archiveDir", "totalTools", "logHook", "mkdirSync", "archiveName", "archivePath", "copyFileSync", "err", "cleanupOldArchives", "keepCount", "files", "readdirSync", "f", "toDelete", "file", "unlinkSync", "cleanupRotatedLogs", "logDir", "patterns", "pattern", "prefix", "sessionCleanup", "input", "projectDir", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "isValidJsonFile", "filePath", "existsSync", "readFileSync", "sessionContextLoader", "input", "logHook", "projectDir", "getProjectDir", "contextLoaded", "agentType", "sessionState", "identityFile", "knowledgeIndex", "statusFile", "agentConfig", "compactionManifest", "manifest", "error", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "getCurrentBranch", "projectDir", "execSync", "sessionEnvSetup", "input", "logHook", "getProjectDir", "sessionId", "getSessionId", "metricsFile", "mkdirSync", "agentType", "metrics", "writeFileSync", "err", "sessionState", "existsSync", "state", "readFileSync", "branch", "outputSilentSuccess", "existsSync", "appendFileSync", "mkdirSync", "readFileSync", "writeFileSync", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "createHash", "os", "IDENTITY_CONFIG_FILE", "SALT", "cachedIdentity", "generateAnonymousId", "input", "createHash", "SALT", "getMachineId", "readUserConfig", "projectDir", "configPath", "IDENTITY_CONFIG_FILE", "existsSync", "content", "readFileSync", "error", "logHook", "getGitIdentity", "result", "execSync", "getEnvIdentity", "resolveUserIdentity", "cachedIdentity", "dir", "getProjectDir", "machineId", "config", "git", "env", "userId", "anonId", "getIdentityContext", "identity", "resolveUserIdentity", "getSessionId", "SESSION_ID_PATTERN", "isValidSessionId", "sessionId", "getSessionDir", "projectDir", "sid", "getSessionId", "pDir", "getProjectDir", "getEventsPath", "ensureSessionDir", "dir", "existsSync", "mkdirSync", "eventCounter", "counterLoaded", "counterDirty", "lastPersistTime", "PERSIST_INTERVAL", "getCounterPath", "loadPersistedCounter", "counterPath", "data", "readFileSync", "logHook", "persistCounter", "now", "writeFileSync", "generateEventId", "trackEvent", "eventType", "name", "options", "event", "generateEventId", "getIdentityContext", "sanitizeForStorage", "truncate", "ensureSessionDir", "eventsPath", "getEventsPath", "appendFileSync", "logHook", "error", "getTimeOfDay", "hour", "trackSessionStart", "context", "now", "sessionContext", "trackEvent", "truncate", "str", "maxLen", "sanitizeForStorage", "obj", "sanitized", "sensitiveKeys", "key", "value", "execSync", "getGitBranch", "projectDir", "sessionTracking", "input", "getProjectDir", "gitBranch", "trackSessionStart", "logHook", "outputSilentSuccess", "error", "existsSync", "readFileSync", "sessionMetricsSummary", "input", "logHook", "metricsFile", "existsSync", "outputSilentSuccess", "metrics", "readFileSync", "tools", "errors", "totalTools", "sum", "count", "topTools", "a", "b", "tool", "err", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "KNOWN_VULNS", "CACHE_TTL_HOURS", "shouldSkipSlowHooks", "versionLessThan", "current", "target", "currentParts", "p", "targetParts", "c", "t", "versionMatchesVuln", "currentVersion", "vulnPattern", "operator", "vulnVersion", "cleanVersion", "version", "checkPackageVulnerability", "packageName", "cleanedVersion", "pkgLower", "vuln", "getCachedWarnings", "cacheFile", "existsSync", "cache", "readFileSync", "saveCache", "warnings", "mkdirSync", "writeFileSync", "parsePackageJson", "filePath", "criticalCount", "highCount", "pkg", "allDeps", "parseRequirementsTxt", "lines", "line", "trimmed", "match", "dependencyVersionCheck", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "hasPackageJson", "hasRequirementsTxt", "hasPyprojectToml", "hasGoMod", "cached", "outputWithContext", "totalCritical", "totalHigh", "allWarnings", "result", "summary", "fullWarning", "HOOKS", "mem0ContextRetrieval", "mem0AnalyticsTracker", "patternSyncPull", "multiInstanceInit", "instanceHeartbeat", "sessionEnvSetup", "sessionTracking", "unifiedSessionStartDispatcher", "input", "results", "HOOKS", "hook", "result", "error", "message", "logHook", "failures", "outputSilentSuccess", "writeFileSync", "existsSync", "readFileSync", "mkdirSync", "join", "getSessionStateFile", "logDir", "getLogDir", "stateDir", "join", "existsSync", "mkdirSync", "getSessionId", "loadSessionState", "stateFile", "readFileSync", "preCompactSaver", "input", "state", "writeFileSync", "logHook", "error", "msg", "outputSilentSuccess", "hooks", "analyticsConsentCheck", "coordinationCleanup", "coordinationInit", "instanceHeartbeat", "mem0AnalyticsTracker", "mem0ContextRetrieval", "mem0WebhookSetup", "multiInstanceInit", "patternSyncPull", "patternSyncPush", "prStatusEnricher", "sessionCleanup", "sessionContextLoader", "sessionEnvSetup", "sessionTracking", "sessionMetricsSummary", "dependencyVersionCheck", "unifiedSessionStartDispatcher", "preCompactSaver", "getHook", "name", "listHooks"]
}
