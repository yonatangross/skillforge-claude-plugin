// OrchestKit Hooks - lifecycle bundle
// Generated: 2026-01-31T14:53:38.738Z

function Bo(t){return typeof t.command=="string"}function Wo(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function zo(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function Vo(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as rt,existsSync as it,statSync as fe,renameSync as ye,mkdirSync as he,readSync as Se}from"node:fs";import{execSync as ke}from"node:child_process";import Zt from"node:os";import b from"node:path";function S(){return process.env.HOME||process.env.USERPROFILE||Zt.homedir()}function F(){return process.env.CLAUDE_PROJECT_DIR||"."}function Q(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function tt(){return process.env.CLAUDE_PLUGIN_ROOT?b.join(S(),".claude","logs","ork"):b.join(F(),".claude","logs")}var Zo=b.join,Xo=b.sep;import{execSync as Xt}from"node:child_process";import{createHash as Qt}from"node:crypto";import{existsSync as et,readFileSync as te,writeFileSync as ee,mkdirSync as ne}from"node:fs";import{join as A,basename as oe}from"node:path";var re=20,ie=15,se=/[^a-z0-9-]/g;function ce(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=oe(e);return nt(n,re)}function ae(t){if(process.env.ORCHESTKIT_SESSION_BRANCH)return process.env.ORCHESTKIT_SESSION_BRANCH;let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd();try{let n=Xt("git branch --show-current",{cwd:e,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim(),o=nt(n||"detached",ie);return process.env.ORCHESTKIT_SESSION_BRANCH=o,o}catch{return"nobranch"}}function ue(t){let e=t||new Date,n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}${o}`}function le(t){let e=t||new Date,n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}${o}`}function pe(){let t=`${process.pid}-${Date.now()}-${Math.random()}`;return Qt("sha256").update(t).digest("hex").slice(0,4)}function nt(t,e){return t.toLowerCase().replace(se,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").slice(0,e)}function de(t,e){let n=ce(t),o=ae(t),i=ue(e),s=le(e),a=pe();return`${n}-${o}-${i}-${s}-${a}`}function ge(t){let e=t||process.env.CLAUDE_PROJECT_DIR||process.cwd(),n=A(e,".instance","session-id.json");if(et(n))try{let o=JSON.parse(te(n,"utf8"));if(o.session_id&&o.created_at){let i=Date.now()-new Date(o.created_at).getTime(),s=1440*60*1e3;if(i<s)return o.session_id}}catch{}}function me(t,e){let n=e||process.env.CLAUDE_PROJECT_DIR||process.cwd(),o=A(n,".instance"),i=A(o,"session-id.json");try{et(o)||ne(o,{recursive:!0}),ee(i,JSON.stringify({session_id:t,created_at:new Date().toISOString()},null,2))}catch{}}function ot(t){if(process.env.CLAUDE_SESSION_ID)return process.env.CLAUDE_SESSION_ID;let e=ge(t);if(e)return e;let n=de(t);return me(n,t),n}function I(){return tt()}function u(){return F()}function _e(){return Q()}function st(){return process.env.CLAUDE_ENV_FILE?process.env.CLAUDE_ENV_FILE:`${_e()}/.claude/.instance_env`}function m(){return ot()}function ct(t){if(process.env.ORCHESTKIT_BRANCH)return process.env.ORCHESTKIT_BRANCH;try{let e=ke("git branch --show-current",{cwd:t||u(),encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim();return process.env.ORCHESTKIT_BRANCH=e,e}catch{return"unknown"}}function ve(){return process.env.ORCHESTKIT_LOG_LEVEL||"warn"}function ur(t){return t.replace(/\r\n/g,`
`)}function be(t){let e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(ve())}function c(){return{continue:!0,suppressOutput:!0}}function lr(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function pr(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function L(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function Ie(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function dr(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function gr(t){return{continue:!0,systemMessage:t}}function mr(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function fr(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}function yr(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PreToolUse",updatedInput:t}}}var xe=200*1024,$e=100*1024;function at(t,e){if(it(t))try{if(fe(t).size>e){let o=`${t}.old.${Date.now()}`;ye(t,o)}}catch{}}function ut(t){it(t)||he(t,{recursive:!0})}function r(t,e,n="debug"){if(!be(n))return;let o=I(),i=`${o}/hooks.log`;try{ut(o),at(i,xe);let s=new Date().toISOString().replace("T"," ").slice(0,19);rt(i,`[${s}] [${n.toUpperCase()}] [${t}] ${e}
`)}catch{}}function hr(t,e,n){let o=I(),i=`${o}/permission-feedback.log`;try{ut(o),at(i,$e);let s=new Date().toISOString(),a=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",p=n?.session_id||m();rt(i,`${s} | ${t} | ${e} | tool=${a} | session=${p}
`)}catch{}}function we(t){if(!t)return 0;let o=(t.match(/[{};()=><]/g)||[]).length/t.length>.03?2.8:3.5;return Math.ceil(t.length/o)}function Sr(t,e,n,o,i){let s=we(t);return o&&o.isOverBudget(n)?(r(e,`Budget exhausted for ${n}, suppressing ${s}t`),c()):(i&&i.trackTokenUsage(e,n,s),Ie(t))}function kr(){try{let t=[],n=Buffer.allocUnsafe(256),o,i=0;for(;;)try{if(o=Se(i,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let s=Buffer.concat(t).toString("utf8").trim();return s?JSON.parse(s):{tool_name:"",session_id:m(),tool_input:{}}}catch{return{tool_name:"",session_id:m(),tool_input:{}}}}function _r(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let i of n){if(o==null)return;o=o[i]}return o}function vr(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function br(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as _}from"node:child_process";function He(t){let e=t||u();try{return _("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function Ce(t){let e=t||He();return["dev","main","master"].includes(e)}function wr(t){let e=t||u();try{return _("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function Hr(t){let e=t||u();try{return _("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function Re(t){let e=t||u();try{return _("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function Cr(t){return Re(t).length>0}function Rr(t){let e=t||u();try{return _("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return _("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function Oe(t){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let n of e){let o=t.match(n);if(o)return parseInt(o[1],10)}return null}function Or(t){if(Ce(t))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(o=>t.startsWith(o))?t.startsWith("issue/")&&!Oe(t)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}import{existsSync as lt,readFileSync as pt}from"node:fs";function Ee(t){let e=`${t}/.claude/feedback/consent-status.json`;if(!lt(e))return{consented:!1,asked:!1};try{let n=JSON.parse(pt(e,"utf-8"));return{consented:n.consented===!0,asked:n.asked===!0}}catch{return{consented:!1,asked:!1}}}function De(t){let e=`${t}/.claude/feedback/consent-log.json`;if(!lt(e))return null;try{let n=JSON.parse(pt(e,"utf-8"));if(n.events&&n.events.length>0)return n.events[n.events.length-1]}catch{}return null}function Te(t){try{let e=new Date(t);return Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60*24))>=30}catch{return!1}}function dt(t){let e=t.project_dir||u(),n=Ee(e);if(n.consented)return r("analytics-consent-check","User has consented to analytics"),c();if(n.asked){let o=De(e);return o&&(o.action==="declined"||o.action==="revoked")&&Te(o.timestamp)?(r("analytics-consent-check","Showing 30-day reminder"),{continue:!0,systemMessage:"Reminder: Anonymous analytics help improve OrchestKit. Enable with /ork:feedback opt-in"}):(r("analytics-consent-check","User recently declined, not prompting"),c())}return r("analytics-consent-check","First time user, showing brief notice"),{continue:!0,systemMessage:"OrchestKit collects local usage metrics. Share anonymously with /ork:feedback opt-in"}}import{existsSync as x,readFileSync as gt,writeFileSync as Pe,unlinkSync as je}from"node:fs";function Ne(t){let e=`${t}/.claude/.instance_env`;if(!x(e))return null;try{let o=gt(e,"utf-8").match(/CLAUDE_INSTANCE_ID=([^\n]+)/);if(o)return o[1].trim()}catch{}return null}function Fe(t,e){let o=`${`${t}/.claude/coordination/heartbeats`}/${e}.json`;if(x(o))try{let i=JSON.parse(gt(o,"utf-8"));i.status="stopping",Pe(o,JSON.stringify(i,null,2)),r("coordination-cleanup",`Updated heartbeat status to 'stopping' for ${e}`)}catch(i){r("coordination-cleanup",`Failed to update heartbeat: ${i}`)}}function Ae(t,e){let n=`${t}/.claude/coordination/.claude.db`;if(!x(n)){r("coordination-cleanup","No coordination database found");return}r("coordination-cleanup",`Would unregister instance: ${e}`)}function Le(t){let e=`${t}/.claude/.instance_env`;try{x(e)&&(je(e),r("coordination-cleanup","Removed instance environment file"))}catch(n){r("coordination-cleanup",`Failed to remove instance env: ${n}`)}}function mt(t){r("coordination-cleanup","Starting coordination cleanup");let e=t.project_dir||u(),n=Ne(e);return n&&(Fe(e,n),Ae(e,n)),Le(e),r("coordination-cleanup","Coordination cleanup complete"),c()}import{existsSync as Ue,readFileSync as Me,writeFileSync as Ke,mkdirSync as ft,appendFileSync as Je}from"node:fs";function Be(){return process.env.CLAUDE_MULTI_INSTANCE==="1"}function We(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function ze(t){let e=`${t}/.claude/context/session/state.json`;if(!Ue(e))return"General development";try{return JSON.parse(Me(e,"utf-8")).current_task?.description||"General development"}catch{return"General development"}}function Ve(){return process.env.CLAUDE_SUBAGENT_ROLE||"main"}function Ge(){let t=m(),e=new Date().toISOString().replace(/[-:T.Z]/g,"").slice(0,14),n=Math.random().toString(36).substring(2,8);return`${t.slice(0,8)}-${e}-${n}`}function qe(t,e){let n=st();try{ft(`${t}/.claude`,{recursive:!0}),Je(n,`CLAUDE_INSTANCE_ID=${e}
`),r("coordination-init",`Saved instance ID: ${e}`)}catch(o){r("coordination-init",`Failed to save instance ID: ${o}`)}}function Ye(t,e,n,o){let i=`${t}/.claude/coordination/heartbeats`;try{ft(i,{recursive:!0});let s={instance_id:e,task:n,role:o,status:"active",started_at:new Date().toISOString(),last_heartbeat:new Date().toISOString()};Ke(`${i}/${e}.json`,JSON.stringify(s,null,2)),r("coordination-init",`Initialized heartbeat for ${e}`)}catch(s){r("coordination-init",`Failed to initialize heartbeat: ${s}`)}}function yt(t){if(!Be())return r("coordination-init","Multi-instance not enabled, skipping"),c();if(We())return r("coordination-init","Skipping coordination init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),c();r("coordination-init","Starting coordination initialization");let e=t.project_dir||u(),n=ze(e),o=Ve(),i=Ge();return process.env.CLAUDE_INSTANCE_ID=i,qe(e,i),Ye(e,i,n,o),r("coordination-init",`Coordination initialized: ${i}`),c()}import{existsSync as U,readFileSync as M,writeFileSync as ht,readdirSync as Ze,unlinkSync as Xe,mkdirSync as Qe}from"node:fs";function tn(){return process.env.CLAUDE_MULTI_INSTANCE==="1"}function en(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function nn(){return process.env.CLAUDE_INSTANCE_ID||m()}function on(t){let e=`${t}/.claude/.instance_env`;if(!U(e))return null;try{let o=M(e,"utf-8").match(/CLAUDE_INSTANCE_ID=([^\n]+)/);if(o)return o[1].trim()}catch{}return null}function rn(t,e){let n=`${t}/.claude/coordination/heartbeats`,o=`${n}/${e}.json`;if(!U(o)){Qe(n,{recursive:!0});let i={instance_id:e,status:"active",last_heartbeat:new Date().toISOString()};ht(o,JSON.stringify(i,null,2)),r("instance-heartbeat",`Created heartbeat for ${e}`);return}try{let i=JSON.parse(M(o,"utf-8"));i.last_heartbeat=new Date().toISOString(),i.status="active",ht(o,JSON.stringify(i,null,2)),r("instance-heartbeat",`Updated heartbeat for ${e}`)}catch(i){r("instance-heartbeat",`Failed to update heartbeat: ${i}`)}}function sn(t,e){let n=`${t}/.claude/coordination/heartbeats`;if(!U(n))return 0;let o=300*1e3,i=Date.now(),s=0;try{let a=Ze(n).filter(p=>p.endsWith(".json"));for(let p of a){let l=`${n}/${p}`;try{let d=JSON.parse(M(l,"utf-8"));if(d.instance_id===e)continue;let f=new Date(d.last_heartbeat).getTime();i-f>o&&(Xe(l),s++,r("instance-heartbeat",`Cleaned up stale instance: ${d.instance_id}`))}catch{}}}catch(a){r("instance-heartbeat",`Failed to scan heartbeats: ${a}`)}return s}function $(t){if(!tn())return c();if(en())return r("instance-heartbeat","Skipping instance heartbeat (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),c();let e=t.project_dir||u(),n=nn();if((!n||n==="unknown")&&(n=on(e)||n),!n)return r("instance-heartbeat","No instance ID available"),c();rn(e,n);let o=sn(e,n);return o>0&&r("instance-heartbeat",`Cleaned up ${o} stale instance(s)`),c()}import{mkdirSync as cn,appendFileSync as an}from"node:fs";function un(){return!!process.env.MEM0_API_KEY}function w(t){if(r("mem0-analytics-tracker","Mem0 analytics tracker starting"),!un())return r("mem0-analytics-tracker","Mem0 not available, skipping analytics"),c();let e=t.project_dir||u(),n=`${e}/.claude/logs/mem0-analytics.jsonl`,o=t.session_id||m(),i=new Date().toISOString(),s=JSON.stringify({session_id:o,timestamp:i,event:"session_start"});try{cn(`${e}/.claude/logs`,{recursive:!0}),an(n,s+`
`),r("mem0-analytics-tracker","Mem0 analytics tracked")}catch(a){r("mem0-analytics-tracker",`Failed to write analytics: ${a}`)}return c()}import{existsSync as ln,readFileSync as kt,mkdirSync as pn,renameSync as dn}from"node:fs";function gn(t){let e=t.split("/");return(e[e.length-1]||"unknown").toLowerCase().replace(/\s+/g,"-")}function mn(){return!!process.env.MEM0_API_KEY}function St(t){if(!ln(t))return!1;try{let e=kt(t,"utf-8"),n=JSON.parse(e);return!(!n||Object.keys(n).length===0)}catch{return!1}}function fn(t,e){let n=`${e}/.claude/logs/mem0-processed`,o=new Date().toISOString().replace(/[:.]/g,"-");try{pn(n,{recursive:!0});let s=(t.split("/").pop()||"pending-sync").replace(".json",`.processed-${o}.json`),a=`${n}/${s}`;dn(t,a),r("mem0-context-retrieval",`Archived pending sync to ${a}`)}catch(i){r("mem0-context-retrieval",`Warning: Could not archive ${t}: ${i}`)}}function H(t){r("mem0-context-retrieval","Mem0 context retrieval starting");let e=t.project_dir||u(),n=gn(e),o=`${e}/.mem0-pending-sync.json`,i=`${S()}/.claude/.mem0-pending-sync.json`,s=null;if(St(o))s=o,r("mem0-context-retrieval",`Found pending sync in project: ${o}`);else if(St(i))try{let a=JSON.parse(kt(i,"utf-8"));a.project_id===n?(s=i,r("mem0-context-retrieval","Found pending sync in global location for this project")):r("mem0-context-retrieval",`Global pending sync exists but for different project: ${a.project_id}`)}catch{}return s&&(r("mem0-context-retrieval","Found pending sync, archiving for processing"),fn(s,e),r("mem0-context-retrieval","Pending sync archived - will be processed on next memory operation")),mn()?r("mem0-context-retrieval","Graph + mem0 available for this session"):r("mem0-context-retrieval","Graph available (mem0 not configured) for this session"),c()}import{writeFileSync as yn,mkdirSync as hn}from"node:fs";function Sn(){return!!process.env.MEM0_API_KEY}function kn(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function _t(t){if(kn())return r("mem0-webhook-setup","Skipping mem0 webhook setup (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),c();if(r("mem0-webhook-setup","Mem0 webhook setup starting"),!Sn())return r("mem0-webhook-setup","Mem0 not available, skipping webhook setup"),c();let e=t.project_dir||u(),n=`${e}/.claude/mem0-webhooks.json`,o="orchestkit-auto-sync",i=["memory.created","memory.updated","memory.deleted"],s=process.env.MEM0_WEBHOOK_URL||"https://example.com/webhook/mem0";r("mem0-webhook-setup","Checking for existing webhooks"),process.env.MEM0_WEBHOOK_URL||r("mem0-webhook-setup","Webhook URL not configured (set MEM0_WEBHOOK_URL), skipping creation");try{hn(`${e}/.claude`,{recursive:!0}),yn(n,JSON.stringify({webhook_name:o,events:i,url:s},null,2)),r("mem0-webhook-setup","Webhook config saved")}catch(a){r("mem0-webhook-setup",`Failed to save webhook config: ${a}`)}return r("mem0-webhook-setup","Webhook setup complete"),c()}import{existsSync as y,readFileSync as _n,writeFileSync as vt,mkdirSync as C}from"node:fs";import{execSync as K}from"node:child_process";function vn(){return process.env.CLAUDE_MULTI_INSTANCE==="1"}function bn(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function In(){try{return K("which sqlite3",{encoding:"utf-8",stdio:"pipe"}),!0}catch{return!1}}function xn(t){let e=t.split("/").pop()||"unknown",n=new Date().toISOString().replace(/[-:T.Z]/g,"").slice(0,14),o=Math.random().toString(16).substring(2,10);return`${e}-${n}-${o}`}function $n(t){try{return K("git branch --show-current",{cwd:t,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function wn(t){let e=[];return(y(`${t}/backend`)||y(`${t}/src/backend`))&&e.push("backend"),(y(`${t}/frontend`)||y(`${t}/src/frontend`)||y(`${t}/package.json`))&&e.push("frontend"),(y(`${t}/tests`)||y(`${t}/__tests__`))&&e.push("testing"),(y(`${t}/infrastructure`)||y(`${t}/docker-compose.yml`)||y(`${t}/Dockerfile`))&&e.push("devops"),e}function Hn(t,e){let n=$n(t),o=wn(t),i=new Date().toISOString(),s={instance_id:e,worktree_name:t.split("/").pop()||"unknown",worktree_path:t,branch:n,capabilities:o,agent_type:null,model:"claude-opus-4-5-20251101",priority:1,created_at:i,status:"active",heartbeat_interval_ms:5e3,last_heartbeat:i},a=`${t}/.instance`;return C(a,{recursive:!0}),vt(`${a}/id.json`,JSON.stringify(s,null,2)),r("multi-instance-init",`Instance identity created: ${e}`),s}function Cn(t){let e=`${t}/.claude/coordination`,n=`${e}/.claude.db`,o=`${e}/schema.sql`;if(y(n))return!0;if(!y(o))return r("multi-instance-init",`WARNING: Schema file not found at ${o}`),!1;try{return C(e,{recursive:!0}),K(`sqlite3 "${n}" < "${o}"`,{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}),r("multi-instance-init","Database initialized from schema"),!0}catch(i){return r("multi-instance-init",`Failed to initialize database: ${i}`),!1}}function Rn(t,e){let n=`${t}/.instance`;vt(`${n}/heartbeat.pid`,String(process.pid)),r("multi-instance-init",`Heartbeat marker created for ${e}`)}function R(t){if(!vn())return c();if(!In())return r("multi-instance-init","sqlite3 not available, skipping"),c();if(bn())return r("multi-instance-init","Skipping multi-instance init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),c();r("multi-instance-init","Starting multi-instance coordination initialization...");let e=t.project_dir||u(),n=`${e}/.instance`,o=`${e}/.claude/coordination`;if(C(`${o}/locks`,{recursive:!0}),C(n,{recursive:!0}),!Cn(e))return r("multi-instance-init","ERROR: Failed to initialize database"),c();let i=`${n}/id.json`,s=`${n}/heartbeat.pid`;if(y(i)&&y(s))try{let p=JSON.parse(_n(i,"utf-8"));return r("multi-instance-init",`Reusing existing instance: ${p.instance_id}`),c()}catch{}let a=xn(e);return Hn(e,a),Rn(e,a),r("multi-instance-init","Multi-instance coordination initialized successfully"),c()}import{existsSync as O,readFileSync as J,writeFileSync as On,statSync as En,mkdirSync as Dn}from"node:fs";var Tn=1*1024*1024;function Pn(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function jn(t){let e=`${t}/.claude/feedback/sync-config.json`;if(!O(e))return!0;try{return JSON.parse(J(e,"utf-8")).sync_enabled!==!1}catch{return!0}}function bt(t){if(!O(t))return!0;try{let e=En(t);return e.size>Tn?(r("pattern-sync-pull",`WARN: Skipping - file too large: ${t} (${e.size} bytes)`),!1):!0}catch{return!0}}function Nn(t){let n=`${S()}/.claude/global-patterns.json`,o=`${t}/.claude/feedback/learned-patterns.json`;if(!O(n)){r("pattern-sync-pull","No global patterns file found");return}try{let s=JSON.parse(J(n,"utf-8")).patterns||[];if(s.length===0){r("pattern-sync-pull","No global patterns to pull");return}let a={version:"1.0",patterns:[]};if(O(o))try{a=JSON.parse(J(o,"utf-8"))}catch{}let p=a.patterns||[],l=new Set(p.map(g=>g.text)),d=s.filter(g=>!l.has(g.text));if(d.length===0){r("pattern-sync-pull","All global patterns already in project");return}let f=[...p,...d];a.patterns=f,Dn(`${t}/.claude/feedback`,{recursive:!0}),On(o,JSON.stringify(a,null,2)),r("pattern-sync-pull",`Pulled ${d.length} new patterns from global`)}catch(i){r("pattern-sync-pull",`Failed to pull global patterns: ${i}`)}}function E(t){if(Pn())return r("pattern-sync-pull","Skipping pattern sync (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),c();let e=t.project_dir||u();if(!jn(e))return r("pattern-sync-pull","Global sync disabled, skipping pull"),c();let o=`${process.env.HOME||process.env.USERPROFILE||"/tmp"}/.claude/global-patterns.json`,i=`${e}/.claude/feedback/learned-patterns.json`;return!bt(o)||!bt(i)?(r("pattern-sync-pull","Skipping pattern sync due to large files"),c()):(r("pattern-sync-pull","Pulling global patterns..."),Nn(e),r("pattern-sync-pull","Global patterns pulled successfully"),c())}import{existsSync as B,readFileSync as W,writeFileSync as Fn,mkdirSync as An}from"node:fs";function Ln(t){let e=`${t}/.claude/feedback/sync-config.json`;if(!B(e))return!0;try{return JSON.parse(W(e,"utf-8")).sync_enabled!==!1}catch{return!0}}function Un(t){let e=`${t}/.claude/feedback/learned-patterns.json`,n=S(),o=`${n}/.claude/global-patterns.json`;if(!B(e)){r("pattern-sync-push","No project patterns file found");return}try{let s=JSON.parse(W(e,"utf-8")).patterns||[];if(s.length===0){r("pattern-sync-push","No project patterns to push");return}let a={version:"1.0",patterns:[],updated:""};if(B(o))try{a=JSON.parse(W(o,"utf-8"))}catch{}let p=a.patterns||[],l=new Set(p.map(g=>g.text)),d=s.filter(g=>!l.has(g.text));if(d.length===0){r("pattern-sync-push","All project patterns already in global");return}let f=[...p,...d];a.patterns=f,a.updated=new Date().toISOString(),An(`${n}/.claude`,{recursive:!0}),Fn(o,JSON.stringify(a,null,2)),r("pattern-sync-push",`Pushed ${d.length} new patterns to global`)}catch(i){r("pattern-sync-push",`Failed to push project patterns: ${i}`)}}function It(t){let e=t.project_dir||u();return Ln(e)?(r("pattern-sync-push","Pushing project patterns to global..."),Un(e),c()):(r("pattern-sync-push","Global sync disabled, skipping push"),c())}import{execSync as xt}from"node:child_process";var Mn=new Set(["main","master","dev","develop"]);function $t(t){r("pr-status-enricher","Checking for open PR on current branch");let e=t.project_dir||u(),n;try{n=ct(e)}catch{return r("pr-status-enricher","Could not determine branch, skipping"),c()}if(!n||Mn.has(n))return r("pr-status-enricher",`Branch "${n}" skipped for PR detection`),c();try{let o=xt("gh pr view --json state,reviewDecision,url,title,isDraft",{cwd:e,timeout:1e4,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim(),i=JSON.parse(o);if(!i.url)return r("pr-status-enricher","No PR found for current branch"),c();process.env.ORCHESTKIT_PR_URL=i.url,process.env.ORCHESTKIT_PR_STATE=i.state;let s=0;try{let d=xt("gh pr view --json reviewThreads",{cwd:e,timeout:1e4,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();s=(JSON.parse(d).reviewThreads||[]).filter(g=>!g.isResolved).length}catch{}let a=i.isDraft?" (DRAFT)":"",p=i.reviewDecision?` | Review: ${i.reviewDecision}`:"",l=s>0?` | ${s} unresolved`:"";r("pr-status-enricher",`PR: ${i.title}${a} [${i.state}${p}${l}]`),r("pr-status-enricher",`URL: ${i.url}`)}catch{r("pr-status-enricher","No PR found or gh CLI unavailable")}return c()}import{existsSync as D,readFileSync as Kn,mkdirSync as Jn,readdirSync as wt,unlinkSync as Ht,copyFileSync as Bn}from"node:fs";function Wn(t){if(!D(t))return 0;try{let n=JSON.parse(Kn(t,"utf-8")).tools||{};return Object.values(n).reduce((o,i)=>o+i,0)}catch{return 0}}function zn(t,e){if(!D(t))return;let n=Wn(t);if(n<=5){r("session-cleanup",`Session had only ${n} tool calls, not archiving`);return}try{Jn(e,{recursive:!0});let i=`session-${new Date().toISOString().replace(/[:.]/g,"-")}.json`,s=`${e}/${i}`;Bn(t,s),r("session-cleanup",`Archived session metrics to ${i}`)}catch(o){r("session-cleanup",`Failed to archive metrics: ${o}`)}}function Vn(t,e=20){if(D(t))try{let n=wt(t).filter(i=>i.startsWith("session-")&&i.endsWith(".json")).sort().reverse();if(n.length<=e)return;let o=n.slice(e);for(let i of o)try{Ht(`${t}/${i}`),r("session-cleanup",`Deleted old archive: ${i}`)}catch{}}catch(n){r("session-cleanup",`Failed to cleanup old archives: ${n}`)}}function Gn(t){if(!D(t))return;let e=["hooks.log.old*","audit.log.old*"];for(let n of e)try{let o=n.replace("*",""),i=wt(t).filter(a=>a.startsWith(o)).sort().reverse();if(i.length<=5)continue;let s=i.slice(5);for(let a of s)try{Ht(`${t}/${a}`)}catch{}}catch{}}function Ct(t){r("session-cleanup","Session cleanup starting");let e=t.project_dir||u(),n="/tmp/claude-session-metrics.json",o=`${e}/.claude/logs/sessions`,i=`${e}/.claude/logs`;return zn(n,o),Vn(o,20),Gn(i),r("session-cleanup","Session cleanup complete"),c()}import{existsSync as z,readFileSync as Rt}from"node:fs";function T(t){if(!z(t))return!1;try{return JSON.parse(Rt(t,"utf-8")),!0}catch{return!1}}function Ot(t){r("session-context-loader","Session starting - loading context (Protocol 2.0)");let e=t.project_dir||u(),n=0,o=process.env.AGENT_TYPE||"",i=`${e}/.claude/context/session/state.json`,s=`${e}/.claude/context/identity.json`,a=`${e}/.claude/context/knowledge/index.json`;T(i)&&(r("session-context-loader","Session state loaded"),n++),T(s)&&(r("session-context-loader","Identity loaded"),n++),T(a)&&(r("session-context-loader","Knowledge index available"),n++);let p=`${e}/docs/CURRENT_STATUS.md`;if(z(p)&&r("session-context-loader","Current status document exists"),o){r("session-context-loader",`Agent-type aware initialization: ${o}`);let d=`${e}/.claude/agents/${o}.md`;z(d)&&(r("session-context-loader",`Agent configuration found: ${d}`),n++)}let l=`${e}/.claude/context/session/compaction-manifest.json`;if(T(l))try{let d=JSON.parse(Rt(l,"utf-8"));r("session-context-loader",`Compaction manifest loaded: session=${d.sessionId}, decisions=${(d.keyDecisions||[]).length}, files=${(d.filesTouched||[]).length}`),process.env.ORCHESTKIT_LAST_SESSION=d.sessionId||"",process.env.ORCHESTKIT_LAST_DECISIONS=JSON.stringify(d.keyDecisions||[]),n++}catch(d){r("session-context-loader",`Error loading compaction manifest: ${d}`)}return n>0&&(o?r("session-context-loader",`Session context loaded (Protocol 2.0) - Agent: ${o}`):r("session-context-loader","Session context loaded (Protocol 2.0)")),c()}import{existsSync as qn,readFileSync as Yn,writeFileSync as Et,mkdirSync as Zn}from"node:fs";import{execSync as Xn}from"node:child_process";function Qn(t){try{return Xn("git branch --show-current",{cwd:t,encoding:"utf-8",timeout:500,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function P(t){r("session-env-setup","Setting up session environment");let e=t.project_dir||u(),n=t.session_id||m(),o="/tmp/claude-session-metrics.json";try{Zn(`${e}/.claude/logs`,{recursive:!0})}catch{}let i=process.env.AGENT_TYPE||"";!i&&t.agent_type&&(i=t.agent_type);let s={session_id:n,started_at:new Date().toISOString(),agent_type:i,tools:{},errors:0,warnings:0};try{Et(o,JSON.stringify(s,null,2)),r("session-env-setup","Initialized session metrics")}catch(l){r("session-env-setup",`Failed to initialize metrics: ${l}`)}let a=`${e}/.claude/context/session/state.json`;if(qn(a)&&i)try{let l=JSON.parse(Yn(a,"utf-8"));l.agent_type=i,l.session_id=n,l.last_activity=new Date().toISOString(),Et(a,JSON.stringify(l,null,2)),r("session-env-setup",`Updated session state with agent_type: ${i}`)}catch(l){r("session-env-setup",`Failed to update session state: ${l}`)}let p=Qn(e);return p&&r("session-env-setup",`Git branch: ${p}`),i&&r("session-env-setup",`Agent type: ${i}`),c()}import{existsSync as Ft,appendFileSync as lo,mkdirSync as po,readFileSync as go,writeFileSync as mo}from"node:fs";import{existsSync as to,readFileSync as eo,writeFileSync as Oi,mkdirSync as Ei}from"node:fs";import{execSync as Dt}from"node:child_process";import{createHash as no}from"node:crypto";import*as Tt from"node:os";var oo=".claude/.user_identity.json",ro="orchestkit-user-identity-v1";var h=null;function j(t){return no("sha256").update(t+ro).digest("hex").slice(0,32)}function io(){try{return Tt.hostname()}catch{return"unknown-machine"}}function so(t){let e=`${t}/${oo}`;if(!to(e))return null;try{let n=eo(e,"utf8");return JSON.parse(n)}catch(n){return r("user-identity",`Failed to read user config: ${n}`,"warn"),null}}function co(t){let e={};try{e.email=Dt("git config user.email",{cwd:t,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{}try{e.name=Dt("git config user.name",{cwd:t,encoding:"utf8",timeout:2e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{}return e}function ao(){return{username:process.env.USER||process.env.USERNAME||process.env.LOGNAME}}function uo(t){if(h)return h;let e=t||u(),n=io(),o=so(e);if(o?.user_id)return h={user_id:o.user_id,display_name:o.display_name||o.user_id,team_id:o.team_id,machine_id:n,source:"config",anonymous_id:j(o.user_id),email:o.user_id.includes("@")?o.user_id:void 0},r("user-identity",`Resolved from config: ${h.anonymous_id}`,"debug"),h;let i=co(e);if(i.email)return h={user_id:i.email,display_name:i.name||i.email.split("@")[0],team_id:o?.team_id,machine_id:n,source:"git",anonymous_id:j(i.email),email:i.email},r("user-identity",`Resolved from git: ${h.anonymous_id}`,"debug"),h;let s=ao();if(s.username){let p=`${s.username}@${n}`;return h={user_id:p,display_name:s.username,team_id:o?.team_id,machine_id:n,source:"env",anonymous_id:j(p)},r("user-identity",`Resolved from env: ${h.anonymous_id}`,"debug"),h}let a=j(n+process.pid);return h={user_id:`anon-${a.slice(0,8)}`,display_name:"Anonymous",team_id:o?.team_id,machine_id:n,source:"anonymous",anonymous_id:a},r("user-identity",`Resolved as anonymous: ${h.anonymous_id}`,"debug"),h}function Pt(){let t=uo();return{session_id:m(),user_id:t.user_id,anonymous_id:t.anonymous_id,team_id:t.team_id,machine_id:t.machine_id,identity_source:t.source,timestamp:new Date().toISOString()}}var fo=/^[a-zA-Z0-9_-]{1,128}$/;function yo(t){return fo.test(t)}function q(t,e){let n=t||m(),o=e||u();if(!yo(n))throw new Error("Invalid session ID format");return`${o}/.claude/memory/sessions/${n}`}function ho(t,e){return`${q(t,e)}/events.jsonl`}function At(t,e){let n=q(t,e);Ft(n)||po(n,{recursive:!0})}var v=0,jt=!1,V=!1,Nt=0,So=5e3;function Lt(t,e){return`${q(t,e)}/counter.json`}function ko(t,e){if(!jt){jt=!0;try{let n=Lt(t,e);if(Ft(n)){let o=JSON.parse(go(n,"utf8"));typeof o.counter=="number"&&o.counter>0&&(v=o.counter,r("session-tracker",`Loaded event counter: ${v}`,"debug"))}}catch{}}}function _o(t,e){if(!V)return;let n=Date.now();if(!(n-Nt<So))try{At(t,e);let o=Lt(t,e);mo(o,JSON.stringify({counter:v,updated_at:new Date().toISOString()})),V=!1,Nt=n}catch{}}function vo(){return ko(),v++,V=!0,_o(),`evt-${Date.now()}-${v}`}function bo(t,e,n={}){try{let o={event_id:vo(),event_type:t,identity:Pt(),payload:{name:e,input:G(n.input),output:G(n.output),duration_ms:n.duration_ms,success:n.success??!0,context:n.context?Mt(n.context,500):void 0,confidence:n.confidence}};At();let i=ho();lo(i,JSON.stringify(o)+`
`),r("session-tracker",`Tracked ${t}: ${e}`,"debug")}catch(o){r("session-tracker",`Failed to track event: ${o}`,"warn")}}function Io(t){return t>=5&&t<12?"morning":t>=12&&t<17?"afternoon":t>=17&&t<21?"evening":"night"}function Ut(t){let e=new Date,n={project_dir:t?.project_dir,git_branch:t?.git_branch,time_of_day:t?.time_of_day||Io(e.getHours()),started_at:e.toISOString()};bo("session_start","session",{success:!0,input:n})}function Mt(t,e){return t.length<=e?t:t.slice(0,e-3)+"..."}function G(t){if(!t)return;let e={},n=["password","secret","token","key","credential","auth"];for(let[o,i]of Object.entries(t)){if(n.some(s=>o.toLowerCase().includes(s))){e[o]="[REDACTED]";continue}if(typeof i=="string"&&i.length>500){e[o]=Mt(i,500);continue}if(typeof i=="object"&&i!==null&&!Array.isArray(i)){e[o]=G(i);continue}e[o]=i}return e}import{execSync as xo}from"node:child_process";function $o(t){try{return xo("git rev-parse --abbrev-ref HEAD",{cwd:t,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()||void 0}catch{return}}function N(t){try{let e=t.project_dir||u(),n=$o(e);return Ut({project_dir:e,git_branch:n}),r("session-tracking",`Tracked session start: branch=${n||"unknown"}`,"debug"),c()}catch(e){return r("session-tracking",`Error: ${e}`,"warn"),c()}}import{existsSync as wo,readFileSync as Ho}from"node:fs";function Kt(t){r("session-metrics-summary","Session ending - generating summary");let e="/tmp/claude-session-metrics.json";if(!wo(e))return r("session-metrics-summary","No metrics file found"),c();try{let n=JSON.parse(Ho(e,"utf-8")),o=n.tools||{},i=n.errors||0,s=Object.values(o).reduce((p,l)=>p+l,0),a=Object.entries(o).sort(([,p],[,l])=>l-p).slice(0,3).map(([p,l])=>`${p}: ${l}`).join(", ");r("session-metrics-summary",`Session stats: ${s} tool calls, ${i} errors`),s>0&&r("session-metrics-summary",`Top tools: ${a}`)}catch(n){r("session-metrics-summary",`Failed to read metrics: ${n}`)}return c()}import{existsSync as k,readFileSync as Z,writeFileSync as Co,mkdirSync as Ro}from"node:fs";var Oo=[{package:"lodash",pattern:"<4.17.21",severity:"high",cve:"CVE-2021-23337",description:"Prototype pollution"},{package:"minimist",pattern:"<1.2.6",severity:"critical",cve:"CVE-2021-44906",description:"Prototype pollution"},{package:"node-fetch",pattern:"<2.6.7",severity:"high",cve:"CVE-2022-0235",description:"Information exposure"},{package:"axios",pattern:"<0.21.2",severity:"high",cve:"CVE-2021-3749",description:"ReDoS vulnerability"},{package:"jsonwebtoken",pattern:"<9.0.0",severity:"critical",cve:"CVE-2022-23529",description:"Insecure token verification"},{package:"express",pattern:"<4.17.3",severity:"medium",cve:"CVE-2022-24999",description:"Open redirect"},{package:"tar",pattern:"<6.1.11",severity:"critical",cve:"CVE-2021-37701",description:"Arbitrary file overwrite"},{package:"path-parse",pattern:"<1.0.7",severity:"medium",cve:"CVE-2021-23343",description:"ReDoS vulnerability"},{package:"django",pattern:"<3.2.14",severity:"high",cve:"CVE-2022-34265",description:"SQL injection"},{package:"flask",pattern:"<2.0.2",severity:"medium",cve:"CVE-2021-28091",description:"Path traversal"},{package:"requests",pattern:"<2.28.0",severity:"medium",cve:"CVE-2023-32681",description:"Information disclosure"},{package:"urllib3",pattern:"<1.26.5",severity:"high",cve:"CVE-2021-33503",description:"ReDoS vulnerability"},{package:"pillow",pattern:"<9.0.0",severity:"high",cve:"CVE-2022-22817",description:"Buffer overflow"},{package:"pyyaml",pattern:"<5.4",severity:"critical",cve:"CVE-2020-14343",description:"Arbitrary code execution"},{package:"jinja2",pattern:"<3.0.3",severity:"medium",cve:"CVE-2020-28493",description:"XSS vulnerability"},{package:"sqlalchemy",pattern:"<1.4.46",severity:"medium",cve:"CVE-2023-30533",description:"SQL injection"}],Eo=24;function Do(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function To(t,e){let n=t.split(".").map(i=>parseInt(i,10)||0),o=e.split(".").map(i=>parseInt(i,10)||0);for(let i=0;i<Math.max(n.length,o.length);i++){let s=n[i]||0,a=o[i]||0;if(s<a)return!0;if(s>a)return!1}return!1}function Po(t,e){let n=e.charAt(0),o=e.substring(1);return n==="<"?To(t,o):n==="="?t===o:!1}function jo(t){return t.replace(/^[^~>=<]/,"").replace(/,.*$/,"").trim()}function Jt(t,e){let n=jo(e),o=t.toLowerCase();for(let i of Oo)if(o===i.package&&Po(n,i.pattern))return i;return null}function No(t){if(!k(t))return null;try{let e=JSON.parse(Z(t,"utf-8"));if((Date.now()-e.timestamp)/(1e3*60*60)<Eo)return e.warnings}catch{}return null}function Y(t,e){try{Ro(t.replace(/\/[^/]+$/,""),{recursive:!0});let n={warnings:e,timestamp:Date.now()};Co(t,JSON.stringify(n,null,2))}catch{}}function Fo(t){let e=0,n=0,o="";if(!k(t))return{criticalCount:e,highCount:n,warnings:o};try{let i=JSON.parse(Z(t,"utf-8")),s={...i.dependencies,...i.devDependencies};for(let[a,p]of Object.entries(s)){let l=Jt(a,p);l&&(l.severity==="critical"&&e++,l.severity==="high"&&n++,o+=`
- ${a}@${p}: ${l.description} (${l.cve}, ${l.severity}) - upgrade to ${l.pattern}`)}}catch{}return{criticalCount:e,highCount:n,warnings:o}}function Ao(t){let e=0,n=0,o="";if(!k(t))return{criticalCount:e,highCount:n,warnings:o};try{let s=Z(t,"utf-8").split(`
`);for(let a of s){let p=a.trim();if(!p||p.startsWith("#"))continue;let l=p.match(/^([a-zA-Z0-9_-]+)(?:==|>=|~=|!=|<|>)\s*([0-9.]+)/);if(!l)continue;let[,d,f]=l,g=Jt(d,f);g&&(g.severity==="critical"&&e++,g.severity==="high"&&n++,o+=`
- ${d}==${f}: ${g.description} (${g.cve}, ${g.severity}) - upgrade to ${g.pattern}`)}}catch{}return{criticalCount:e,highCount:n,warnings:o}}function Bt(t){if(Do())return r("dependency-version-check","Skipping dependency check (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),c();r("dependency-version-check","Starting dependency version check");let e=t.project_dir||u(),n=`${e}/.claude/feedback/dependency-check-cache.json`,o=k(`${e}/package.json`),i=k(`${e}/requirements.txt`),s=k(`${e}/pyproject.toml`),a=k(`${e}/go.mod`);if(!o&&!i&&!s&&!a)return r("dependency-version-check","No package files found, skipping check"),Y(n,"none"),c();let p=No(n);if(p!==null)return r("dependency-version-check","Using cached dependency warnings"),p!=="none"?L(`DEPENDENCY SECURITY CHECK (cached): ${p}`):c();let l=0,d=0,f="";if(o){let g=Fo(`${e}/package.json`);l+=g.criticalCount,d+=g.highCount,g.warnings&&(f+=`

Node.js (package.json):${g.warnings}`)}if(i){let g=Ao(`${e}/requirements.txt`);l+=g.criticalCount,d+=g.highCount,g.warnings&&(f+=`

Python (requirements.txt):${g.warnings}`)}if(f){let g=`Found ${l} critical and ${d} high severity vulnerabilities`,X=`DEPENDENCY SECURITY CHECK: ${g}${f}

Run 'npm audit' or 'pip-audit' for full details.`;if(Y(n,X),r("dependency-version-check",g),l>0||d>0)return L(X)}else Y(n,"none"),r("dependency-version-check","No known vulnerabilities found");return c()}var Wt=[{name:"mem0-context-retrieval",fn:H},{name:"mem0-analytics-tracker",fn:w},{name:"pattern-sync-pull",fn:E},{name:"multi-instance-init",fn:R},{name:"instance-heartbeat",fn:$},{name:"session-env-setup",fn:P},{name:"session-tracking",fn:N}];async function zt(t){let e=await Promise.allSettled(Wt.map(async o=>{try{let i=o.fn(t);return i instanceof Promise&&await i,{hook:o.name,status:"success"}}catch(i){let s=i instanceof Error?i.message:String(i);return r("session-start-dispatcher",`${o.name} failed: ${s}`),{hook:o.name,status:"error",message:s}}})),n=[];for(let o of e)o.status==="rejected"?n.push("unknown"):o.value.status==="error"&&n.push(o.value.hook);return n.length>0&&r("session-start-dispatcher",`${n.length}/${Wt.length} hooks failed: ${n.join(", ")}`),c()}import{writeFileSync as Lo,existsSync as Gt,readFileSync as Uo,mkdirSync as Mo}from"node:fs";import{join as Vt}from"node:path";function Ko(){let t=I(),e=Vt(t,"sessions");return Gt(e)||Mo(e,{recursive:!0}),Vt(e,`${m()}-state.json`)}function Jo(t){try{if(Gt(t))return JSON.parse(Uo(t,"utf8"))}catch{}return{}}function qt(t){try{let e=Ko(),n=Jo(e);n.lastCompaction=new Date().toISOString(),n.compactionCount=(n.compactionCount||0)+1,n.preservedContext={branch:process.env.ORCHESTKIT_BRANCH||void 0,sessionNotes:`Compaction #${n.compactionCount} at ${n.lastCompaction}`},Lo(e,JSON.stringify(n,null,2)),r("pre-compact-saver",`Saved state before compaction #${n.compactionCount}`)}catch(e){let n=e instanceof Error?e.message:String(e);r("pre-compact-saver",`Failed to save state: ${n}`,"warn")}return c()}var Yt={"lifecycle/analytics-consent-check":dt,"lifecycle/coordination-cleanup":mt,"lifecycle/coordination-init":yt,"lifecycle/instance-heartbeat":$,"lifecycle/mem0-analytics-tracker":w,"lifecycle/mem0-context-retrieval":H,"lifecycle/mem0-webhook-setup":_t,"lifecycle/multi-instance-init":R,"lifecycle/pattern-sync-pull":E,"lifecycle/pattern-sync-push":It,"lifecycle/pr-status-enricher":$t,"lifecycle/session-cleanup":Ct,"lifecycle/session-context-loader":Ot,"lifecycle/session-env-setup":P,"lifecycle/session-tracking":N,"lifecycle/session-metrics-summary":Kt,"lifecycle/dependency-version-check":Bt,"lifecycle/unified-dispatcher":zt,"lifecycle/pre-compact-saver":qt};function Cs(t){return Yt[t]}function Rs(){return Object.keys(Yt)}export{br as escapeRegex,we as estimateTokenCount,Oe as extractIssueNumber,ct as getCachedBranch,He as getCurrentBranch,Rr as getDefaultBranch,st as getEnvFile,_r as getField,Re as getGitStatus,Cs as getHook,I as getLogDir,ve as getLogLevel,_e as getPluginRoot,u as getProjectDir,wr as getRepoRoot,m as getSessionId,Cr as hasUncommittedChanges,Yt as hooks,Bo as isBashInput,zo as isEditInput,Hr as isGitRepo,Ce as isProtectedBranch,Vo as isReadInput,Wo as isWriteInput,Rs as listHooks,r as logHook,hr as logPermissionFeedback,vr as normalizeCommand,ur as normalizeLineEndings,dr as outputAllowWithContext,pr as outputBlock,fr as outputDeny,gr as outputError,Ie as outputPromptContext,Sr as outputPromptContextBudgeted,lr as outputSilentAllow,c as outputSilentSuccess,mr as outputWarning,L as outputWithContext,yr as outputWithUpdatedInput,kr as readHookInput,be as shouldLog,Or as validateBranchName};
//# sourceMappingURL=lifecycle.mjs.map
