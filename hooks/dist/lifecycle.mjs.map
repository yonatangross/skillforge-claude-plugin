{
  "version": 3,
  "sources": ["../src/types.ts", "../src/lib/common.ts", "../src/lib/git.ts", "../src/lifecycle/analytics-consent-check.ts", "../src/lifecycle/coordination-cleanup.ts", "../src/lifecycle/coordination-init.ts", "../src/lifecycle/decision-sync-pull.ts", "../src/lifecycle/decision-sync-push.ts", "../src/lifecycle/instance-heartbeat.ts", "../src/lifecycle/mem0-analytics-tracker.ts", "../src/lifecycle/mem0-context-retrieval.ts", "../src/lifecycle/mem0-webhook-setup.ts", "../src/lifecycle/multi-instance-init.ts", "../src/lifecycle/pattern-sync-pull.ts", "../src/lifecycle/pattern-sync-push.ts", "../src/lifecycle/session-cleanup.ts", "../src/lifecycle/session-context-loader.ts", "../src/lifecycle/session-env-setup.ts", "../src/lifecycle/session-metrics-summary.ts", "../src/lifecycle/dependency-version-check.ts", "../src/entries/lifecycle.ts"],
  "sourcesContent": ["/**\n * TypeScript type definitions for Claude Code hooks\n * CC 2.1.9 compliant with additionalContext support\n */\n\n/**\n * Hook events supported by Claude Code\n */\nexport type HookEvent =\n  | 'PreToolUse'\n  | 'PostToolUse'\n  | 'PermissionRequest'\n  | 'UserPromptSubmit'\n  | 'SessionStart'\n  | 'SessionEnd'\n  | 'Stop'\n  | 'SubagentStart'\n  | 'SubagentStop'\n  | 'Setup'\n  | 'Notification';\n\n/**\n * Hook input envelope from Claude Code (sent via stdin as JSON)\n */\nexport interface HookInput {\n  /** The hook event type */\n  hook_event?: HookEvent;\n  /** The tool being invoked */\n  tool_name: string;\n  /** Session ID (CC 2.1.9 guarantees availability) */\n  session_id: string;\n  /** Tool-specific input parameters */\n  tool_input: ToolInput;\n  /** Tool output (PostToolUse only) */\n  tool_output?: unknown;\n  /** Tool error message if any */\n  tool_error?: string;\n  /** Tool exit code */\n  exit_code?: number;\n  /** User prompt (UserPromptSubmit only) */\n  prompt?: string;\n  /** Project directory */\n  project_dir?: string;\n\n  // SubagentStart/SubagentStop specific fields\n  /** Agent type for subagent hooks */\n  subagent_type?: string;\n  /** Agent type (alternative field name) */\n  agent_type?: string;\n  /** Agent ID */\n  agent_id?: string;\n  /** Agent output (SubagentStop) */\n  agent_output?: string;\n  /** Output (alternative field name) */\n  output?: string;\n  /** Error from subagent */\n  error?: string;\n  /** Duration in milliseconds */\n  duration_ms?: number;\n  /** Tool result (SubagentStop) */\n  tool_result?: string;\n\n  // Notification specific fields\n  /** Notification message */\n  message?: string;\n  /** Notification type */\n  notification_type?: string;\n}\n\n/**\n * Tool input types - union of all tool inputs\n */\nexport interface ToolInput {\n  /** Bash command (Bash tool) */\n  command?: string;\n  /** Timeout in ms (Bash tool) */\n  timeout?: number;\n  /** File path (Write/Edit/Read tools) */\n  file_path?: string;\n  /** File content (Write tool) */\n  content?: string;\n  /** Old text to replace (Edit tool) */\n  old_string?: string;\n  /** New text (Edit tool) */\n  new_string?: string;\n  /** Pattern (Glob/Grep tools) */\n  pattern?: string;\n  /** Allow additional properties */\n  [key: string]: unknown;\n}\n\n/**\n * Hook-specific output for CC 2.1.9\n */\nexport interface HookSpecificOutput {\n  /** Hook event name for context */\n  hookEventName?: 'PreToolUse' | 'PostToolUse' | 'PermissionRequest' | 'UserPromptSubmit';\n  /** Permission decision (PermissionRequest hooks) */\n  permissionDecision?: 'allow' | 'deny';\n  /** Reason for permission decision */\n  permissionDecisionReason?: string;\n  /** Additional context injected before tool execution (CC 2.1.9) */\n  additionalContext?: string;\n}\n\n/**\n * Hook result - output JSON to stdout\n * CC 2.1.7+ compliant\n */\nexport interface HookResult {\n  /** Whether to continue execution */\n  continue: boolean;\n  /** Suppress hook output from user */\n  suppressOutput?: boolean;\n  /** System message shown to user */\n  systemMessage?: string;\n  /** Reason for stopping (when continue is false) */\n  stopReason?: string;\n  /** Hook-specific output fields */\n  hookSpecificOutput?: HookSpecificOutput;\n}\n\n/**\n * Hook function signature\n */\nexport type HookFn = (input: HookInput) => Promise<HookResult> | HookResult;\n\n/**\n * Hook registration entry\n */\nexport interface HookRegistration {\n  /** Hook name (e.g., 'permission/auto-approve-readonly') */\n  name: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher (string pattern or regex) */\n  matcher?: string | RegExp;\n  /** Hook implementation function */\n  fn: HookFn;\n}\n\n/**\n * Bash tool input (type guard helper)\n */\nexport interface BashToolInput extends ToolInput {\n  command: string;\n  timeout?: number;\n}\n\n/**\n * Write tool input (type guard helper)\n */\nexport interface WriteToolInput extends ToolInput {\n  file_path: string;\n  content: string;\n}\n\n/**\n * Edit tool input (type guard helper)\n */\nexport interface EditToolInput extends ToolInput {\n  file_path: string;\n  old_string: string;\n  new_string: string;\n}\n\n/**\n * Read tool input (type guard helper)\n */\nexport interface ReadToolInput extends ToolInput {\n  file_path: string;\n  offset?: number;\n  limit?: number;\n}\n\n/**\n * Type guards for tool inputs\n */\nexport function isBashInput(input: ToolInput): input is BashToolInput {\n  return typeof input.command === 'string';\n}\n\nexport function isWriteInput(input: ToolInput): input is WriteToolInput {\n  return typeof input.file_path === 'string' && typeof input.content === 'string';\n}\n\nexport function isEditInput(input: ToolInput): input is EditToolInput {\n  return (\n    typeof input.file_path === 'string' &&\n    typeof input.old_string === 'string' &&\n    typeof input.new_string === 'string'\n  );\n}\n\nexport function isReadInput(input: ToolInput): input is ReadToolInput {\n  return typeof input.file_path === 'string' && input.content === undefined;\n}\n", "/**\n * Common utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh\n */\n\nimport { appendFileSync, existsSync, statSync, renameSync, mkdirSync } from 'node:fs';\nimport type { HookResult, HookInput } from '../types.js';\n\n// -----------------------------------------------------------------------------\n// Environment and Paths\n// All functions read env vars dynamically to support testing\n// -----------------------------------------------------------------------------\n\n/**\n * Get the log directory path\n */\nexport function getLogDir(): string {\n  if (process.env.CLAUDE_PLUGIN_ROOT) {\n    return `${process.env.HOME}/.claude/logs/ork`;\n  }\n  return `${getProjectDir()}/.claude/logs`;\n}\n\n/**\n * Get the project directory\n * Read dynamically to support testing\n */\nexport function getProjectDir(): string {\n  return process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the plugin root directory\n * Read dynamically to support testing\n */\nexport function getPluginRoot(): string {\n  return process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the session ID\n * CC 2.1.9+ should guarantee CLAUDE_SESSION_ID availability, but we add\n * a defensive fallback to prevent hook crashes during edge cases.\n * Read dynamically to support testing.\n */\nexport function getSessionId(): string {\n  return process.env.CLAUDE_SESSION_ID || `fallback-${process.pid}-${Date.now()}`;\n}\n\n// -----------------------------------------------------------------------------\n// Output Helpers (CC 2.1.7+ compliant)\n// -----------------------------------------------------------------------------\n\n/**\n * Output silent success - hook completed without errors, no user-visible output\n */\nexport function outputSilentSuccess(): HookResult {\n  return { continue: true, suppressOutput: true };\n}\n\n/**\n * Output silent allow - permission hook approves silently\n */\nexport function outputSilentAllow(): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: { permissionDecision: 'allow' },\n  };\n}\n\n/**\n * Output block - stops the operation with an error\n */\nexport function outputBlock(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with additionalContext - injects context before tool execution (CC 2.1.9)\n * For PostToolUse hooks (hookEventName optional)\n */\nexport function outputWithContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PostToolUse',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with additionalContext for UserPromptSubmit hooks (CC 2.1.9)\n * hookEventName is REQUIRED for UserPromptSubmit\n */\nexport function outputPromptContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output allow with additionalContext - permission hook approves with context (CC 2.1.9)\n */\nexport function outputAllowWithContext(ctx: string, systemMessage?: string): HookResult {\n  const result: HookResult = {\n    continue: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      additionalContext: ctx,\n      permissionDecision: 'allow',\n    },\n  };\n\n  if (systemMessage) {\n    result.systemMessage = systemMessage;\n  } else {\n    result.suppressOutput = true;\n  }\n\n  return result;\n}\n\n/**\n * Output error message - only use when there's an actual problem\n */\nexport function outputError(message: string): HookResult {\n  return { continue: true, systemMessage: message };\n}\n\n/**\n * Output warning message - CC 2.1.7 compliant (no ANSI in JSON)\n */\nexport function outputWarning(message: string): HookResult {\n  return { continue: true, systemMessage: `\\u26a0 ${message}` };\n}\n\n/**\n * Output deny with feedback logging (CC 2.1.7)\n */\nexport function outputDeny(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Logging\n// -----------------------------------------------------------------------------\n\nconst LOG_ROTATION_MAX_SIZE = 200 * 1024; // 200KB\nconst PERMISSION_LOG_MAX_SIZE = 100 * 1024; // 100KB\n\n/**\n * Rotate log file if it exceeds size limit\n */\nfunction rotateLogFile(logFile: string, maxSize: number): void {\n  if (!existsSync(logFile)) return;\n\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > maxSize) {\n      const rotated = `${logFile}.old.${Date.now()}`;\n      renameSync(logFile, rotated);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n}\n\n/**\n * Log to hook log file with automatic rotation\n */\nexport function logHook(hookName: string, message: string): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/hooks.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, LOG_ROTATION_MAX_SIZE);\n\n    const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n    appendFileSync(logFile, `[${timestamp}] [${hookName}] ${message}\\n`);\n  } catch {\n    // Ignore logging errors - don't block hook execution\n  }\n}\n\n/**\n * Log permission decision for audit trail (CC 2.1.7 feature)\n */\nexport function logPermissionFeedback(\n  decision: 'allow' | 'deny' | 'warn',\n  reason: string,\n  input?: HookInput\n): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/permission-feedback.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, PERMISSION_LOG_MAX_SIZE);\n\n    const timestamp = new Date().toISOString();\n    const toolName = input?.tool_name || process.env.HOOK_TOOL_NAME || 'unknown';\n    const sessionId = input?.session_id || getSessionId();\n\n    appendFileSync(\n      logFile,\n      `${timestamp} | ${decision} | ${reason} | tool=${toolName} | session=${sessionId}\\n`\n    );\n  } catch {\n    // Ignore logging errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Input Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Read hook input from stdin synchronously\n * Returns parsed JSON or empty object on failure\n */\nexport function readHookInput(): HookInput {\n  try {\n    // Read from stdin synchronously\n    const chunks: Buffer[] = [];\n    const BUFSIZE = 256;\n    const buf = Buffer.allocUnsafe(BUFSIZE);\n\n    let bytesRead: number;\n    const fd = 0; // stdin\n\n    // Use fs.readSync for synchronous stdin reading\n    const { readSync } = require('node:fs');\n    while (true) {\n      try {\n        bytesRead = readSync(fd, buf, 0, BUFSIZE, null);\n        if (bytesRead === 0) break;\n        chunks.push(Buffer.from(buf.subarray(0, bytesRead)));\n      } catch {\n        break;\n      }\n    }\n\n    const input = Buffer.concat(chunks).toString('utf8').trim();\n    if (!input) {\n      return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n    }\n\n    return JSON.parse(input);\n  } catch {\n    return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n  }\n}\n\n/**\n * Get field from hook input using optional chaining\n */\nexport function getField<T>(input: HookInput, path: string): T | undefined {\n  const parts = path.replace(/^\\./, '').split('.');\n  let value: unknown = input;\n\n  for (const part of parts) {\n    if (value === null || value === undefined) return undefined;\n    value = (value as Record<string, unknown>)[part];\n  }\n\n  return value as T;\n}\n\n// -----------------------------------------------------------------------------\n// String Utilities\n// -----------------------------------------------------------------------------\n\n/**\n * Normalize command: remove line continuations and collapse whitespace\n * Prevents bypassing detection with backslash-newline tricks (CC 2.1.6 fix)\n */\nexport function normalizeCommand(command: string): string {\n  return command\n    .replace(/\\\\\\s*[\\r\\n]+/g, ' ') // Remove line continuations\n    .replace(/\\n/g, ' ') // Replace newlines with spaces\n    .replace(/\\s+/g, ' ') // Collapse whitespace\n    .trim();\n}\n\n/**\n * Escape string for use in regex\n */\nexport function escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n", "/**\n * Git utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh git functions\n */\n\nimport { execSync } from 'node:child_process';\nimport { getProjectDir } from './common.js';\n\n/**\n * Get the current git branch\n */\nexport function getCurrentBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git branch --show-current', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Check if on a protected branch (dev, main, master)\n */\nexport function isProtectedBranch(branch?: string): boolean {\n  const currentBranch = branch || getCurrentBranch();\n  return ['dev', 'main', 'master'].includes(currentBranch);\n}\n\n/**\n * Get the repository root directory\n */\nexport function getRepoRoot(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git rev-parse --show-toplevel', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return dir;\n  }\n}\n\n/**\n * Check if path is inside a git repository\n */\nexport function isGitRepo(projectDir?: string): boolean {\n  const dir = projectDir || getProjectDir();\n  try {\n    execSync('git rev-parse --git-dir', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get git status (short format)\n */\nexport function getGitStatus(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git status --short', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 10000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Check if there are uncommitted changes\n */\nexport function hasUncommittedChanges(projectDir?: string): boolean {\n  return getGitStatus(projectDir).length > 0;\n}\n\n/**\n * Get the default branch (main or master)\n */\nexport function getDefaultBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    // Check if 'main' exists\n    execSync('git rev-parse --verify main', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return 'main';\n  } catch {\n    try {\n      // Check if 'master' exists\n      execSync('git rev-parse --verify master', {\n        cwd: dir,\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n      return 'master';\n    } catch {\n      return 'main'; // Default to main\n    }\n  }\n}\n\n/**\n * Extract issue number from branch name\n * Supports patterns like: issue/123-description, feature/123, fix-123\n */\nexport function extractIssueNumber(branch: string): number | null {\n  // Match common patterns\n  const patterns = [\n    /issue\\/(\\d+)/i,\n    /feature\\/(\\d+)/i,\n    /fix\\/(\\d+)/i,\n    /bug\\/(\\d+)/i,\n    /feat\\/(\\d+)/i,\n    /^(\\d+)-/,\n    /-(\\d+)$/,\n    /#(\\d+)/,\n  ];\n\n  for (const pattern of patterns) {\n    const match = branch.match(pattern);\n    if (match) {\n      return parseInt(match[1], 10);\n    }\n  }\n\n  return null;\n}\n\n/**\n * Validate branch name format\n * Returns error message if invalid, null if valid\n */\nexport function validateBranchName(branch: string): string | null {\n  // Skip validation for protected branches\n  if (isProtectedBranch(branch)) {\n    return null;\n  }\n\n  // Valid prefixes\n  const validPrefixes = [\n    'issue/',\n    'feature/',\n    'fix/',\n    'bug/',\n    'feat/',\n    'chore/',\n    'docs/',\n    'refactor/',\n    'test/',\n    'ci/',\n    'perf/',\n    'style/',\n    'release/',\n    'hotfix/',\n  ];\n\n  const hasValidPrefix = validPrefixes.some((prefix) => branch.startsWith(prefix));\n  if (!hasValidPrefix) {\n    return `Branch name should start with a valid prefix: ${validPrefixes.join(', ')}`;\n  }\n\n  // Check for issue number in issue/ branches\n  if (branch.startsWith('issue/') && !extractIssueNumber(branch)) {\n    return 'issue/ branches should include an issue number (e.g., issue/123-description)';\n  }\n\n  return null;\n}\n", "/**\n * Analytics Consent Check - Check if user needs to be prompted for analytics consent\n * Part of OrchestKit Claude Plugin (#59)\n *\n * This hook runs on session start to check if user has been asked about analytics.\n * It outputs a gentle reminder or first-time prompt if appropriate.\n *\n * CC 2.1.7 Compliant: uses hookSpecificOutput.additionalContext for context injection\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface ConsentLog {\n  events: Array<{\n    action: string;\n    timestamp: string;\n  }>;\n}\n\ninterface ConsentStatus {\n  consented: boolean;\n  asked: boolean;\n}\n\n/**\n * Read consent status from consent manager config\n */\nfunction getConsentStatus(projectDir: string): ConsentStatus {\n  const consentFile = `${projectDir}/.claude/feedback/consent-status.json`;\n\n  if (!existsSync(consentFile)) {\n    return { consented: false, asked: false };\n  }\n\n  try {\n    const status = JSON.parse(readFileSync(consentFile, 'utf-8'));\n    return {\n      consented: status.consented === true,\n      asked: status.asked === true,\n    };\n  } catch {\n    return { consented: false, asked: false };\n  }\n}\n\n/**\n * Get the last consent event from the log\n */\nfunction getLastConsentEvent(projectDir: string): { action: string; timestamp: string } | null {\n  const consentLog = `${projectDir}/.claude/feedback/consent-log.json`;\n\n  if (!existsSync(consentLog)) {\n    return null;\n  }\n\n  try {\n    const log: ConsentLog = JSON.parse(readFileSync(consentLog, 'utf-8'));\n    if (log.events && log.events.length > 0) {\n      return log.events[log.events.length - 1];\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return null;\n}\n\n/**\n * Check if 30 days have passed since the last decline\n */\nfunction shouldShowReminder(lastTimestamp: string): boolean {\n  try {\n    const lastDate = new Date(lastTimestamp);\n    const now = new Date();\n    const daysSince = Math.floor((now.getTime() - lastDate.getTime()) / (1000 * 60 * 60 * 24));\n    return daysSince >= 30;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Analytics consent check hook\n */\nexport function analyticsConsentCheck(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const status = getConsentStatus(projectDir);\n\n  // Already consented - nothing to do\n  if (status.consented) {\n    logHook('analytics-consent-check', 'User has consented to analytics');\n    return outputSilentSuccess();\n  }\n\n  // Already asked and declined - check if we should show reminder\n  if (status.asked) {\n    const lastEvent = getLastConsentEvent(projectDir);\n\n    if (lastEvent && (lastEvent.action === 'declined' || lastEvent.action === 'revoked')) {\n      if (shouldShowReminder(lastEvent.timestamp)) {\n        // Show gentle reminder (not blocking)\n        logHook('analytics-consent-check', 'Showing 30-day reminder');\n        return {\n          continue: true,\n          systemMessage:\n            'Reminder: Anonymous analytics help improve OrchestKit. Enable with /ork:feedback opt-in',\n        };\n      }\n    }\n\n    // Don't show anything if recently asked\n    logHook('analytics-consent-check', 'User recently declined, not prompting');\n    return outputSilentSuccess();\n  }\n\n  // First time - show a brief notice (not the full prompt, to avoid blocking)\n  logHook('analytics-consent-check', 'First time user, showing brief notice');\n  return {\n    continue: true,\n    systemMessage:\n      'OrchestKit collects local usage metrics. Share anonymously with /ork:feedback opt-in',\n  };\n}\n", "/**\n * Coordination Cleanup - Unregister instance at session end\n * Hook: SessionEnd\n * CC 2.1.6 Compliant: ensures JSON output on all code paths\n */\n\nimport { existsSync, readFileSync, writeFileSync, unlinkSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface HeartbeatFile {\n  status: string;\n  [key: string]: unknown;\n}\n\n/**\n * Load instance ID from environment file\n */\nfunction loadInstanceId(projectDir: string): string | null {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  if (!existsSync(envFile)) {\n    return null;\n  }\n\n  try {\n    const content = readFileSync(envFile, 'utf-8');\n    const match = content.match(/CLAUDE_INSTANCE_ID=([^\\n]+)/);\n    if (match) {\n      return match[1].trim();\n    }\n  } catch {\n    // Ignore read errors\n  }\n\n  return null;\n}\n\n/**\n * Update heartbeat file to stopping status\n */\nfunction updateHeartbeatStatus(projectDir: string, instanceId: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n  const heartbeatFile = `${heartbeatsDir}/${instanceId}.json`;\n\n  if (!existsSync(heartbeatFile)) {\n    return;\n  }\n\n  try {\n    const content: HeartbeatFile = JSON.parse(readFileSync(heartbeatFile, 'utf-8'));\n    content.status = 'stopping';\n    writeFileSync(heartbeatFile, JSON.stringify(content, null, 2));\n    logHook('coordination-cleanup', `Updated heartbeat status to 'stopping' for ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-cleanup', `Failed to update heartbeat: ${err}`);\n  }\n}\n\n/**\n * Unregister instance from coordination database\n */\nfunction unregisterInstance(projectDir: string, instanceId: string): void {\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  if (!existsSync(dbPath)) {\n    logHook('coordination-cleanup', 'No coordination database found');\n    return;\n  }\n\n  // Note: In TypeScript, we would need sqlite3 package for actual DB operations\n  // For now, we log the intent - the actual cleanup is done via bash fallback\n  logHook('coordination-cleanup', `Would unregister instance: ${instanceId}`);\n}\n\n/**\n * Remove instance environment file\n */\nfunction cleanupInstanceEnv(projectDir: string): void {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  try {\n    if (existsSync(envFile)) {\n      unlinkSync(envFile);\n      logHook('coordination-cleanup', 'Removed instance environment file');\n    }\n  } catch (err) {\n    logHook('coordination-cleanup', `Failed to remove instance env: ${err}`);\n  }\n}\n\n/**\n * Coordination cleanup hook\n */\nexport function coordinationCleanup(input: HookInput): HookResult {\n  logHook('coordination-cleanup', 'Starting coordination cleanup');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const instanceId = loadInstanceId(projectDir);\n\n  if (instanceId) {\n    // Update heartbeat to stopping status\n    updateHeartbeatStatus(projectDir, instanceId);\n\n    // Unregister instance (releases all locks)\n    unregisterInstance(projectDir, instanceId);\n  }\n\n  // Clean up instance env file\n  cleanupInstanceEnv(projectDir);\n\n  logHook('coordination-cleanup', 'Coordination cleanup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Coordination Initialization - Register instance at session start\n * Hook: SessionStart\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n * Version: 1.1.0\n * Optimized with timeout to prevent startup hangs\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionState {\n  current_task?: {\n    description?: string;\n  };\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Get task description from session state\n */\nfunction getTaskDescription(projectDir: string): string {\n  const stateFile = `${projectDir}/.claude/context/session/state.json`;\n\n  if (!existsSync(stateFile)) {\n    return 'General development';\n  }\n\n  try {\n    const state: SessionState = JSON.parse(readFileSync(stateFile, 'utf-8'));\n    return state.current_task?.description || 'General development';\n  } catch {\n    return 'General development';\n  }\n}\n\n/**\n * Get agent role from environment\n */\nfunction getAgentRole(): string {\n  return process.env.CLAUDE_SUBAGENT_ROLE || 'main';\n}\n\n/**\n * Generate unique instance ID\n */\nfunction generateInstanceId(): string {\n  const sessionId = getSessionId();\n  const timestamp = new Date().toISOString().replace(/[-:T.Z]/g, '').slice(0, 14);\n  const random = Math.random().toString(36).substring(2, 8);\n  return `${sessionId.slice(0, 8)}-${timestamp}-${random}`;\n}\n\n/**\n * Save instance ID to environment file\n */\nfunction saveInstanceId(projectDir: string, instanceId: string): void {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  try {\n    mkdirSync(`${projectDir}/.claude`, { recursive: true });\n    appendFileSync(envFile, `CLAUDE_INSTANCE_ID=${instanceId}\\n`);\n    logHook('coordination-init', `Saved instance ID: ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-init', `Failed to save instance ID: ${err}`);\n  }\n}\n\n/**\n * Initialize heartbeat for this instance\n */\nfunction initHeartbeat(projectDir: string, instanceId: string, taskDesc: string, agentRole: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n\n  try {\n    mkdirSync(heartbeatsDir, { recursive: true });\n\n    const heartbeat = {\n      instance_id: instanceId,\n      task: taskDesc,\n      role: agentRole,\n      status: 'active',\n      started_at: new Date().toISOString(),\n      last_heartbeat: new Date().toISOString(),\n    };\n\n    writeFileSync(`${heartbeatsDir}/${instanceId}.json`, JSON.stringify(heartbeat, null, 2));\n    logHook('coordination-init', `Initialized heartbeat for ${instanceId}`);\n  } catch (err) {\n    logHook('coordination-init', `Failed to initialize heartbeat: ${err}`);\n  }\n}\n\n/**\n * Coordination initialization hook\n */\nexport function coordinationInit(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    logHook('coordination-init', 'Multi-instance not enabled, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('coordination-init', 'Skipping coordination init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('coordination-init', 'Starting coordination initialization');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const taskDesc = getTaskDescription(projectDir);\n  const agentRole = getAgentRole();\n\n  // Generate and save instance ID\n  const instanceId = generateInstanceId();\n\n  // Store instance ID for other hooks\n  process.env.CLAUDE_INSTANCE_ID = instanceId;\n  saveInstanceId(projectDir, instanceId);\n\n  // Initial heartbeat\n  initHeartbeat(projectDir, instanceId, taskDesc, agentRole);\n\n  logHook('coordination-init', `Coordination initialized: ${instanceId}`);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Decision Sync Pull - SessionStart Hook\n * CC 2.1.7 Compliant: uses hookSpecificOutput.additionalContext\n * Reminds about retrieving past decisions from mem0 on session start\n *\n * Part of mem0 Semantic Memory Integration (#47)\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Get project ID for user_id hint\n */\nfunction getProjectId(projectDir: string): string {\n  const parts = projectDir.split('/');\n  const basename = parts[parts.length - 1] || 'unknown';\n  return basename.toLowerCase().replace(/\\s+/g, '-');\n}\n\n/**\n * Decision sync pull hook\n */\nexport function decisionSyncPull(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const projectId = getProjectId(projectDir);\n  const userId = `${projectId}-decisions`;\n\n  logHook('decision-sync-pull', `Session starting - decision recall available with user_id: ${userId}`);\n\n  // Note: SessionStart hooks don't support hookSpecificOutput.additionalContext\n  // Context injection happens via session-context-loader instead\n  logHook('decision-sync-pull', `Decision memory available: user_id='${userId}' for ${projectId}`);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Decision Sync Push - SessionEnd Hook\n * CC 2.1.7 Compliant: outputs JSON with correct field names\n * Pushes pending decisions to mem0 on session end\n *\n * Part of mem0 Semantic Memory Integration (#47)\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getPluginRoot, outputSilentSuccess } from '../lib/common.js';\n\ninterface PendingDecisions {\n  count?: number;\n  decisions?: unknown[];\n}\n\n/**\n * Get pending decisions count\n */\nfunction getPendingCount(projectDir: string, pluginRoot: string): number {\n  const syncScript = `${projectDir}/.claude/scripts/decision-sync.sh`;\n  const fallbackScript = `${pluginRoot}/.claude/scripts/decision-sync.sh`;\n\n  const scriptPath = existsSync(syncScript) ? syncScript : existsSync(fallbackScript) ? fallbackScript : null;\n\n  if (!scriptPath) {\n    return 0;\n  }\n\n  try {\n    const output = execSync(`\"${scriptPath}\" pending 2>/dev/null || echo \"0\"`, {\n      encoding: 'utf-8',\n      timeout: 2000,\n    });\n\n    // Parse count from output like \"Pending Decisions (84)\"\n    const match = output.match(/Pending Decisions \\((\\d+)\\)/);\n    if (match) {\n      return parseInt(match[1], 10);\n    }\n  } catch {\n    // Ignore execution errors\n  }\n\n  return 0;\n}\n\n/**\n * Decision sync push hook\n */\nexport function decisionSyncPush(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const pluginRoot = getPluginRoot();\n\n  const pendingCount = getPendingCount(projectDir, pluginRoot);\n\n  if (pendingCount === 0) {\n    logHook('decision-sync-push', 'No pending decisions to sync');\n    return outputSilentSuccess();\n  }\n\n  logHook('decision-sync-push', `Found ${pendingCount} pending decisions to sync`);\n\n  // Output sync instructions for Claude to process\n  return {\n    continue: true,\n    systemMessage: `Session ending with ${pendingCount} pending decisions. To sync to mem0, run: decision-sync.sh sync`,\n  };\n}\n", "/**\n * Instance Heartbeat - Lifecycle Hook\n * Updates heartbeat timestamp and cleans up stale instances\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n *\n * Runs periodically to:\n * 1. Update this instance's heartbeat\n * 2. Clean up stale instances (no heartbeat > 5 min)\n * 3. Release orphaned locks\n *\n * Version: 1.1.0\n * Part of Multi-Worktree Coordination System\n */\n\nimport { existsSync, readFileSync, writeFileSync, readdirSync, unlinkSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface HeartbeatInfo {\n  instance_id: string;\n  status: string;\n  last_heartbeat: string;\n  [key: string]: unknown;\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Get instance ID from environment\n */\nfunction getInstanceId(): string {\n  return process.env.CLAUDE_INSTANCE_ID || getSessionId();\n}\n\n/**\n * Load instance ID from environment file\n */\nfunction loadInstanceIdFromFile(projectDir: string): string | null {\n  const envFile = `${projectDir}/.claude/.instance_env`;\n\n  if (!existsSync(envFile)) {\n    return null;\n  }\n\n  try {\n    const content = readFileSync(envFile, 'utf-8');\n    const match = content.match(/CLAUDE_INSTANCE_ID=([^\\n]+)/);\n    if (match) {\n      return match[1].trim();\n    }\n  } catch {\n    // Ignore read errors\n  }\n\n  return null;\n}\n\n/**\n * Update heartbeat timestamp\n */\nfunction updateHeartbeat(projectDir: string, instanceId: string): void {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n  const heartbeatFile = `${heartbeatsDir}/${instanceId}.json`;\n\n  if (!existsSync(heartbeatFile)) {\n    // Create new heartbeat if doesn't exist\n    mkdirSync(heartbeatsDir, { recursive: true });\n    const heartbeat: HeartbeatInfo = {\n      instance_id: instanceId,\n      status: 'active',\n      last_heartbeat: new Date().toISOString(),\n    };\n    writeFileSync(heartbeatFile, JSON.stringify(heartbeat, null, 2));\n    logHook('instance-heartbeat', `Created heartbeat for ${instanceId}`);\n    return;\n  }\n\n  try {\n    const content: HeartbeatInfo = JSON.parse(readFileSync(heartbeatFile, 'utf-8'));\n    content.last_heartbeat = new Date().toISOString();\n    content.status = 'active';\n    writeFileSync(heartbeatFile, JSON.stringify(content, null, 2));\n    logHook('instance-heartbeat', `Updated heartbeat for ${instanceId}`);\n  } catch (err) {\n    logHook('instance-heartbeat', `Failed to update heartbeat: ${err}`);\n  }\n}\n\n/**\n * Clean up stale instances (no heartbeat > 5 min)\n */\nfunction cleanupStaleInstances(projectDir: string, currentInstanceId: string): number {\n  const heartbeatsDir = `${projectDir}/.claude/coordination/heartbeats`;\n\n  if (!existsSync(heartbeatsDir)) {\n    return 0;\n  }\n\n  const staleThresholdMs = 5 * 60 * 1000; // 5 minutes\n  const now = Date.now();\n  let cleanedCount = 0;\n\n  try {\n    const files = readdirSync(heartbeatsDir).filter((f) => f.endsWith('.json'));\n\n    for (const file of files) {\n      const filePath = `${heartbeatsDir}/${file}`;\n\n      try {\n        const content: HeartbeatInfo = JSON.parse(readFileSync(filePath, 'utf-8'));\n\n        // Skip current instance\n        if (content.instance_id === currentInstanceId) {\n          continue;\n        }\n\n        // Check if stale\n        const lastHeartbeat = new Date(content.last_heartbeat).getTime();\n        const age = now - lastHeartbeat;\n\n        if (age > staleThresholdMs) {\n          unlinkSync(filePath);\n          cleanedCount++;\n          logHook('instance-heartbeat', `Cleaned up stale instance: ${content.instance_id}`);\n        }\n      } catch {\n        // Skip files that can't be read\n      }\n    }\n  } catch (err) {\n    logHook('instance-heartbeat', `Failed to scan heartbeats: ${err}`);\n  }\n\n  return cleanedCount;\n}\n\n/**\n * Instance heartbeat hook\n */\nexport function instanceHeartbeat(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('instance-heartbeat', 'Skipping instance heartbeat (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Get instance ID from environment or file\n  let instanceId = getInstanceId();\n  if (!instanceId || instanceId === 'unknown') {\n    instanceId = loadInstanceIdFromFile(projectDir) || instanceId;\n  }\n\n  if (!instanceId) {\n    logHook('instance-heartbeat', 'No instance ID available');\n    return outputSilentSuccess();\n  }\n\n  // Update heartbeat\n  updateHeartbeat(projectDir, instanceId);\n\n  // Clean up stale instances\n  const cleanedCount = cleanupStaleInstances(projectDir, instanceId);\n  if (cleanedCount > 0) {\n    logHook('instance-heartbeat', `Cleaned up ${cleanedCount} stale instance(s)`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Analytics Tracker - Monitor usage patterns continuously\n * Hook: SessionStart / UserPromptSubmit\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Tracks mem0 usage patterns\n * - Monitors feature utilization\n * - Identifies underutilized features\n *\n * Version: 1.0.0\n */\n\nimport { existsSync, mkdirSync, appendFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  // Check for MEM0_API_KEY environment variable\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Mem0 analytics tracker hook\n */\nexport function mem0AnalyticsTracker(input: HookInput): HookResult {\n  logHook('mem0-analytics-tracker', 'Mem0 analytics tracker starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-analytics-tracker', 'Mem0 not available, skipping analytics');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const analyticsFile = `${projectDir}/.claude/logs/mem0-analytics.jsonl`;\n  const sessionId = input.session_id || getSessionId();\n  const timestamp = new Date().toISOString();\n\n  // Create analytics entry\n  const analyticsEntry = JSON.stringify({\n    session_id: sessionId,\n    timestamp: timestamp,\n    event: 'session_start',\n  });\n\n  // Append to analytics log\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n    appendFileSync(analyticsFile, analyticsEntry + '\\n');\n    logHook('mem0-analytics-tracker', 'Mem0 analytics tracked');\n  } catch (err) {\n    logHook('mem0-analytics-tracker', `Failed to write analytics: ${err}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Context Retrieval - Auto-loads memories at session start (Graph-First Architecture)\n * Hook: SessionStart\n * CC 2.1.7 Compliant - Works across any repository\n * CC 2.1.9 Compatible - Uses additionalContext for context injection\n *\n * Graph-First Architecture (v2.1):\n * - Knowledge graph (mcp__memory__*) is PRIMARY - always available, zero-config\n * - Mem0 cloud (mcp__mem0__*) is OPTIONAL enhancement for semantic search\n *\n * Version: 2.1.0 - Graph-first architecture\n * Part of Memory Fabric v2.1\n */\n\nimport { existsSync, readFileSync, mkdirSync, renameSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface PendingSyncFile {\n  memories?: unknown[];\n  scope?: string;\n  project_id?: string;\n}\n\ninterface Memory {\n  text: string;\n  metadata?: {\n    has_blockers?: boolean;\n    has_next_steps?: boolean;\n  };\n}\n\n/**\n * Get project ID for user_id hint\n */\nfunction getProjectId(projectDir: string): string {\n  const parts = projectDir.split('/');\n  const basename = parts[parts.length - 1] || 'unknown';\n  return basename.toLowerCase().replace(/\\s+/g, '-');\n}\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Check if pending sync file has valid JSON content\n */\nfunction hasValidPendingSync(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return false;\n  }\n\n  try {\n    const content = readFileSync(filePath, 'utf-8');\n    const parsed = JSON.parse(content);\n\n    // Check if it has meaningful content\n    if (!parsed || Object.keys(parsed).length === 0) {\n      return false;\n    }\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Archive pending sync file\n */\nfunction archivePendingSync(filePath: string, projectDir: string): void {\n  const processedDir = `${projectDir}/.claude/logs/mem0-processed`;\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n\n  try {\n    mkdirSync(processedDir, { recursive: true });\n\n    const basename = filePath.split('/').pop() || 'pending-sync';\n    const archiveName = basename.replace('.json', `.processed-${timestamp}.json`);\n    const archivePath = `${processedDir}/${archiveName}`;\n\n    renameSync(filePath, archivePath);\n    logHook('mem0-context-retrieval', `Archived pending sync to ${archivePath}`);\n  } catch (err) {\n    logHook('mem0-context-retrieval', `Warning: Could not archive ${filePath}: ${err}`);\n  }\n}\n\n/**\n * Check if memory-fabric skill exists\n */\nfunction hasMemoryFabricSkill(): boolean {\n  const pluginRoot = process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n  return existsSync(`${pluginRoot}/skills/memory-fabric/SKILL.md`);\n}\n\n/**\n * Memory context retrieval hook\n */\nexport function mem0ContextRetrieval(input: HookInput): HookResult {\n  logHook('mem0-context-retrieval', 'Mem0 context retrieval starting');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const projectId = getProjectId(projectDir);\n\n  // Pending sync file locations\n  const pendingSyncFile = `${projectDir}/.mem0-pending-sync.json`;\n  const pendingSyncGlobal = `${process.env.HOME}/.claude/.mem0-pending-sync.json`;\n\n  // Determine which pending sync file to check\n  let pendingFile: string | null = null;\n\n  if (hasValidPendingSync(pendingSyncFile)) {\n    pendingFile = pendingSyncFile;\n    logHook('mem0-context-retrieval', `Found pending sync in project: ${pendingSyncFile}`);\n  } else if (hasValidPendingSync(pendingSyncGlobal)) {\n    // Check if global file is for this project\n    try {\n      const content: PendingSyncFile = JSON.parse(readFileSync(pendingSyncGlobal, 'utf-8'));\n      if (content.project_id === projectId) {\n        pendingFile = pendingSyncGlobal;\n        logHook('mem0-context-retrieval', 'Found pending sync in global location for this project');\n      } else {\n        logHook('mem0-context-retrieval', `Global pending sync exists but for different project: ${content.project_id}`);\n      }\n    } catch {\n      // Ignore parse errors\n    }\n  }\n\n  // Archive pending sync if found\n  if (pendingFile) {\n    logHook('mem0-context-retrieval', 'Found pending sync, archiving for processing');\n    archivePendingSync(pendingFile, projectDir);\n    logHook('mem0-context-retrieval', 'Pending sync archived - will be processed on next memory operation');\n  }\n\n  // Log memory availability status\n  if (isMem0Available()) {\n    logHook('mem0-context-retrieval', 'Graph + mem0 available for this session');\n  } else {\n    logHook('mem0-context-retrieval', 'Graph available (mem0 not configured) for this session');\n  }\n\n  // Note: SessionStart hooks must use simple success output (no hookSpecificOutput.additionalContext)\n  return outputSilentSuccess();\n}\n", "/**\n * Mem0 Webhook Setup - Auto-configure webhooks on first mem0 usage\n * Hook: SessionStart\n * CC 2.1.7 Compliant\n *\n * Features:\n * - Checks if webhooks exist for mem0 automation\n * - Creates webhooks if missing\n * - Configures webhook URL endpoint\n * - Sets up event types: memory.created, memory.updated, memory.deleted\n *\n * Version: 1.0.0\n */\n\nimport { existsSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface WebhookConfig {\n  webhook_name: string;\n  events: string[];\n  url: string;\n}\n\n/**\n * Check if mem0 is available\n */\nfunction isMem0Available(): boolean {\n  return !!process.env.MEM0_API_KEY;\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Mem0 webhook setup hook\n */\nexport function mem0WebhookSetup(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('mem0-webhook-setup', 'Skipping mem0 webhook setup (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('mem0-webhook-setup', 'Mem0 webhook setup starting');\n\n  // Check if mem0 is available\n  if (!isMem0Available()) {\n    logHook('mem0-webhook-setup', 'Mem0 not available, skipping webhook setup');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n  const webhookConfigFile = `${projectDir}/.claude/mem0-webhooks.json`;\n\n  // Webhook configuration\n  const webhookName = 'orchestkit-auto-sync';\n  const webhookEvents = ['memory.created', 'memory.updated', 'memory.deleted'];\n  const webhookUrl = process.env.MEM0_WEBHOOK_URL || 'https://example.com/webhook/mem0';\n\n  logHook('mem0-webhook-setup', 'Checking for existing webhooks');\n\n  // Note: Actual webhook creation would require mem0 API calls\n  // For now, we just save the config for reference\n  if (!process.env.MEM0_WEBHOOK_URL) {\n    logHook('mem0-webhook-setup', 'Webhook URL not configured (set MEM0_WEBHOOK_URL), skipping creation');\n  }\n\n  // Save webhook config\n  try {\n    mkdirSync(`${projectDir}/.claude`, { recursive: true });\n\n    const config: WebhookConfig = {\n      webhook_name: webhookName,\n      events: webhookEvents,\n      url: webhookUrl,\n    };\n\n    writeFileSync(webhookConfigFile, JSON.stringify(config, null, 2));\n    logHook('mem0-webhook-setup', 'Webhook config saved');\n  } catch (err) {\n    logHook('mem0-webhook-setup', `Failed to save webhook config: ${err}`);\n  }\n\n  logHook('mem0-webhook-setup', 'Webhook setup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Multi-Instance Coordination Initialization Hook\n * Runs on session start to register this Claude Code instance\n * CC 2.1.7 Compliant: Self-guarding - only runs when CLAUDE_MULTI_INSTANCE=1\n * Version: 1.1.0\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface InstanceIdentity {\n  instance_id: string;\n  worktree_name: string;\n  worktree_path: string;\n  branch: string;\n  capabilities: string[];\n  agent_type: string | null;\n  model: string;\n  priority: number;\n  created_at: string;\n  status: string;\n  heartbeat_interval_ms: number;\n  last_heartbeat: string;\n}\n\n/**\n * Check if multi-instance mode is enabled\n */\nfunction isMultiInstanceEnabled(): boolean {\n  return process.env.CLAUDE_MULTI_INSTANCE === '1';\n}\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Check if sqlite3 is available\n */\nfunction isSqlite3Available(): boolean {\n  try {\n    execSync('which sqlite3', { encoding: 'utf-8', stdio: 'pipe' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Generate unique instance ID\n */\nfunction generateInstanceId(projectDir: string): string {\n  const worktreeName = projectDir.split('/').pop() || 'unknown';\n  const timestamp = new Date().toISOString().replace(/[-:T.Z]/g, '').slice(0, 14);\n  const random = Math.random().toString(16).substring(2, 10);\n  return `${worktreeName}-${timestamp}-${random}`;\n}\n\n/**\n * Get current git branch\n */\nfunction getCurrentBranch(projectDir: string): string {\n  try {\n    return execSync('git branch --show-current', {\n      cwd: projectDir,\n      encoding: 'utf-8',\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Detect capabilities based on directory structure\n */\nfunction detectCapabilities(projectDir: string): string[] {\n  const caps: string[] = [];\n\n  // Check for backend files\n  if (existsSync(`${projectDir}/backend`) || existsSync(`${projectDir}/src/backend`)) {\n    caps.push('backend');\n  }\n\n  // Check for frontend files\n  if (existsSync(`${projectDir}/frontend`) || existsSync(`${projectDir}/src/frontend`) || existsSync(`${projectDir}/package.json`)) {\n    caps.push('frontend');\n  }\n\n  // Check for test files\n  if (existsSync(`${projectDir}/tests`) || existsSync(`${projectDir}/__tests__`)) {\n    caps.push('testing');\n  }\n\n  // Check for infrastructure files\n  if (existsSync(`${projectDir}/infrastructure`) || existsSync(`${projectDir}/docker-compose.yml`) || existsSync(`${projectDir}/Dockerfile`)) {\n    caps.push('devops');\n  }\n\n  return caps;\n}\n\n/**\n * Create instance identity file\n */\nfunction createInstanceIdentity(projectDir: string, instanceId: string): InstanceIdentity {\n  const branch = getCurrentBranch(projectDir);\n  const capabilities = detectCapabilities(projectDir);\n  const now = new Date().toISOString();\n\n  const identity: InstanceIdentity = {\n    instance_id: instanceId,\n    worktree_name: projectDir.split('/').pop() || 'unknown',\n    worktree_path: projectDir,\n    branch,\n    capabilities,\n    agent_type: null,\n    model: 'claude-opus-4-5-20251101',\n    priority: 1,\n    created_at: now,\n    status: 'active',\n    heartbeat_interval_ms: 5000,\n    last_heartbeat: now,\n  };\n\n  const instanceDir = `${projectDir}/.instance`;\n  mkdirSync(instanceDir, { recursive: true });\n  writeFileSync(`${instanceDir}/id.json`, JSON.stringify(identity, null, 2));\n\n  logHook('multi-instance-init', `Instance identity created: ${instanceId}`);\n\n  return identity;\n}\n\n/**\n * Initialize coordination database\n */\nfunction initDatabase(projectDir: string): boolean {\n  const coordDir = `${projectDir}/.claude/coordination`;\n  const dbPath = `${coordDir}/.claude.db`;\n  const schemaPath = `${coordDir}/schema.sql`;\n\n  if (existsSync(dbPath)) {\n    return true;\n  }\n\n  if (!existsSync(schemaPath)) {\n    logHook('multi-instance-init', `WARNING: Schema file not found at ${schemaPath}`);\n    return false;\n  }\n\n  try {\n    mkdirSync(coordDir, { recursive: true });\n    execSync(`sqlite3 \"${dbPath}\" < \"${schemaPath}\"`, {\n      encoding: 'utf-8',\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    logHook('multi-instance-init', 'Database initialized from schema');\n    return true;\n  } catch (err) {\n    logHook('multi-instance-init', `Failed to initialize database: ${err}`);\n    return false;\n  }\n}\n\n/**\n * Start heartbeat process (note: in TypeScript, we can't easily start background processes)\n * Instead, heartbeat is handled by the instance-heartbeat hook\n */\nfunction startHeartbeat(projectDir: string, instanceId: string): void {\n  // Write PID file to indicate heartbeat should be active\n  const instanceDir = `${projectDir}/.instance`;\n  writeFileSync(`${instanceDir}/heartbeat.pid`, String(process.pid));\n  logHook('multi-instance-init', `Heartbeat marker created for ${instanceId}`);\n}\n\n/**\n * Multi-instance init hook\n */\nexport function multiInstanceInit(input: HookInput): HookResult {\n  // Self-guard: Only run when multi-instance mode is enabled\n  if (!isMultiInstanceEnabled()) {\n    return outputSilentSuccess();\n  }\n\n  // Check for sqlite3\n  if (!isSqlite3Available()) {\n    logHook('multi-instance-init', 'sqlite3 not available, skipping');\n    return outputSilentSuccess();\n  }\n\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('multi-instance-init', 'Skipping multi-instance init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('multi-instance-init', 'Starting multi-instance coordination initialization...');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const instanceDir = `${projectDir}/.instance`;\n  const coordDir = `${projectDir}/.claude/coordination`;\n\n  // Ensure directories exist\n  mkdirSync(`${coordDir}/locks`, { recursive: true });\n  mkdirSync(instanceDir, { recursive: true });\n\n  // Initialize database\n  if (!initDatabase(projectDir)) {\n    logHook('multi-instance-init', 'ERROR: Failed to initialize database');\n    return outputSilentSuccess();\n  }\n\n  // Check if we already have an instance running\n  const idFile = `${instanceDir}/id.json`;\n  const pidFile = `${instanceDir}/heartbeat.pid`;\n\n  if (existsSync(idFile) && existsSync(pidFile)) {\n    try {\n      const existingId = JSON.parse(readFileSync(idFile, 'utf-8'));\n      logHook('multi-instance-init', `Reusing existing instance: ${existingId.instance_id}`);\n      return outputSilentSuccess();\n    } catch {\n      // Fall through to create new instance\n    }\n  }\n\n  // Generate new instance ID\n  const instanceId = generateInstanceId(projectDir);\n\n  // Create identity and register\n  createInstanceIdentity(projectDir, instanceId);\n\n  // Start heartbeat marker\n  startHeartbeat(projectDir, instanceId);\n\n  logHook('multi-instance-init', 'Multi-instance coordination initialized successfully');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Pattern Sync Pull - SessionStart Hook\n * CC 2.1.7 Compliant: silent on success with suppressOutput\n * Pulls global patterns into project on session start\n *\n * Part of Cross-Project Patterns (#48)\n * Optimized with timeout and file size checks to prevent startup hangs\n */\n\nimport { existsSync, readFileSync, writeFileSync, statSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface PatternFile {\n  version?: string;\n  patterns?: unknown[];\n  sync_enabled?: boolean;\n}\n\nconst MAX_FILE_SIZE_BYTES = 1 * 1024 * 1024; // 1MB\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Check if sync is enabled\n */\nfunction isSyncEnabled(projectDir: string): boolean {\n  const configFile = `${projectDir}/.claude/feedback/sync-config.json`;\n\n  if (!existsSync(configFile)) {\n    return true; // Default to enabled\n  }\n\n  try {\n    const config = JSON.parse(readFileSync(configFile, 'utf-8'));\n    return config.sync_enabled !== false;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Check if file size is within limits\n */\nfunction checkFileSize(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return true; // File doesn't exist, that's fine\n  }\n\n  try {\n    const stats = statSync(filePath);\n    if (stats.size > MAX_FILE_SIZE_BYTES) {\n      logHook('pattern-sync-pull', `WARN: Skipping - file too large: ${filePath} (${stats.size} bytes)`);\n      return false;\n    }\n    return true;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Pull global patterns into project\n */\nfunction pullGlobalPatterns(projectDir: string): void {\n  const globalPatternsFile = `${process.env.HOME}/.claude/global-patterns.json`;\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n\n  if (!existsSync(globalPatternsFile)) {\n    logHook('pattern-sync-pull', 'No global patterns file found');\n    return;\n  }\n\n  try {\n    const globalPatterns: PatternFile = JSON.parse(readFileSync(globalPatternsFile, 'utf-8'));\n    const globalList = globalPatterns.patterns || [];\n\n    if (globalList.length === 0) {\n      logHook('pattern-sync-pull', 'No global patterns to pull');\n      return;\n    }\n\n    // Load existing project patterns\n    let projectPatterns: PatternFile = { version: '1.0', patterns: [] };\n    if (existsSync(projectPatternsFile)) {\n      try {\n        projectPatterns = JSON.parse(readFileSync(projectPatternsFile, 'utf-8'));\n      } catch {\n        // Use default if parse fails\n      }\n    }\n\n    const projectList = projectPatterns.patterns || [];\n\n    // Merge patterns (avoid duplicates by text)\n    const existingTexts = new Set((projectList as Array<{ text?: string }>).map((p) => p.text));\n    const newPatterns = (globalList as Array<{ text?: string }>).filter((p) => !existingTexts.has(p.text));\n\n    if (newPatterns.length === 0) {\n      logHook('pattern-sync-pull', 'All global patterns already in project');\n      return;\n    }\n\n    // Add new patterns\n    const mergedPatterns = [...projectList, ...newPatterns];\n    projectPatterns.patterns = mergedPatterns;\n\n    // Ensure directory exists\n    mkdirSync(`${projectDir}/.claude/feedback`, { recursive: true });\n\n    // Write updated patterns\n    writeFileSync(projectPatternsFile, JSON.stringify(projectPatterns, null, 2));\n    logHook('pattern-sync-pull', `Pulled ${newPatterns.length} new patterns from global`);\n  } catch (err) {\n    logHook('pattern-sync-pull', `Failed to pull global patterns: ${err}`);\n  }\n}\n\n/**\n * Pattern sync pull hook\n */\nexport function patternSyncPull(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('pattern-sync-pull', 'Skipping pattern sync (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Check if sync is enabled\n  if (!isSyncEnabled(projectDir)) {\n    logHook('pattern-sync-pull', 'Global sync disabled, skipping pull');\n    return outputSilentSuccess();\n  }\n\n  // Check file sizes\n  const globalPatternsFile = `${process.env.HOME}/.claude/global-patterns.json`;\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n\n  if (!checkFileSize(globalPatternsFile) || !checkFileSize(projectPatternsFile)) {\n    logHook('pattern-sync-pull', 'Skipping pattern sync due to large files');\n    return outputSilentSuccess();\n  }\n\n  // Pull global patterns\n  logHook('pattern-sync-pull', 'Pulling global patterns...');\n  pullGlobalPatterns(projectDir);\n  logHook('pattern-sync-pull', 'Global patterns pulled successfully');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Pattern Sync Push - SessionEnd Hook\n * CC 2.1.7 Compliant: silent on success with suppressOutput\n * Pushes project patterns to global on session end\n *\n * Part of Cross-Project Patterns (#48)\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface PatternFile {\n  version?: string;\n  patterns?: unknown[];\n  sync_enabled?: boolean;\n  updated?: string;\n}\n\n/**\n * Check if sync is enabled\n */\nfunction isSyncEnabled(projectDir: string): boolean {\n  const configFile = `${projectDir}/.claude/feedback/sync-config.json`;\n\n  if (!existsSync(configFile)) {\n    return true; // Default to enabled\n  }\n\n  try {\n    const config = JSON.parse(readFileSync(configFile, 'utf-8'));\n    return config.sync_enabled !== false;\n  } catch {\n    return true;\n  }\n}\n\n/**\n * Push project patterns to global\n */\nfunction pushProjectPatterns(projectDir: string): void {\n  const projectPatternsFile = `${projectDir}/.claude/feedback/learned-patterns.json`;\n  const globalPatternsFile = `${process.env.HOME}/.claude/global-patterns.json`;\n\n  if (!existsSync(projectPatternsFile)) {\n    logHook('pattern-sync-push', 'No project patterns file found');\n    return;\n  }\n\n  try {\n    const projectPatterns: PatternFile = JSON.parse(readFileSync(projectPatternsFile, 'utf-8'));\n    const projectList = projectPatterns.patterns || [];\n\n    if (projectList.length === 0) {\n      logHook('pattern-sync-push', 'No project patterns to push');\n      return;\n    }\n\n    // Load existing global patterns\n    let globalPatterns: PatternFile = { version: '1.0', patterns: [], updated: '' };\n    if (existsSync(globalPatternsFile)) {\n      try {\n        globalPatterns = JSON.parse(readFileSync(globalPatternsFile, 'utf-8'));\n      } catch {\n        // Use default if parse fails\n      }\n    }\n\n    const globalList = globalPatterns.patterns || [];\n\n    // Merge patterns (avoid duplicates by text)\n    const existingTexts = new Set((globalList as Array<{ text?: string }>).map((p) => p.text));\n    const newPatterns = (projectList as Array<{ text?: string }>).filter((p) => !existingTexts.has(p.text));\n\n    if (newPatterns.length === 0) {\n      logHook('pattern-sync-push', 'All project patterns already in global');\n      return;\n    }\n\n    // Add new patterns\n    const mergedPatterns = [...globalList, ...newPatterns];\n    globalPatterns.patterns = mergedPatterns;\n    globalPatterns.updated = new Date().toISOString();\n\n    // Ensure directory exists\n    mkdirSync(`${process.env.HOME}/.claude`, { recursive: true });\n\n    // Write updated patterns\n    writeFileSync(globalPatternsFile, JSON.stringify(globalPatterns, null, 2));\n    logHook('pattern-sync-push', `Pushed ${newPatterns.length} new patterns to global`);\n  } catch (err) {\n    logHook('pattern-sync-push', `Failed to push project patterns: ${err}`);\n  }\n}\n\n/**\n * Pattern sync push hook\n */\nexport function patternSyncPush(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Check if sync is enabled\n  if (!isSyncEnabled(projectDir)) {\n    logHook('pattern-sync-push', 'Global sync disabled, skipping push');\n    return outputSilentSuccess();\n  }\n\n  // Push project patterns to global\n  logHook('pattern-sync-push', 'Pushing project patterns to global...');\n  pushProjectPatterns(projectDir);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Cleanup - Cleans up temporary files at session end\n * Hook: SessionEnd\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync, readdirSync, unlinkSync, copyFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionMetrics {\n  tools?: Record<string, number>;\n}\n\n/**\n * Get total tool invocations from metrics\n */\nfunction getTotalTools(metricsFile: string): number {\n  if (!existsSync(metricsFile)) {\n    return 0;\n  }\n\n  try {\n    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));\n    const tools = metrics.tools || {};\n    return Object.values(tools).reduce((sum, count) => sum + count, 0);\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Archive session metrics if significant\n */\nfunction archiveMetrics(metricsFile: string, archiveDir: string): void {\n  if (!existsSync(metricsFile)) {\n    return;\n  }\n\n  const totalTools = getTotalTools(metricsFile);\n\n  // Only archive if there were more than 5 tool calls\n  if (totalTools <= 5) {\n    logHook('session-cleanup', `Session had only ${totalTools} tool calls, not archiving`);\n    return;\n  }\n\n  try {\n    mkdirSync(archiveDir, { recursive: true });\n\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const archiveName = `session-${timestamp}.json`;\n    const archivePath = `${archiveDir}/${archiveName}`;\n\n    copyFileSync(metricsFile, archivePath);\n    logHook('session-cleanup', `Archived session metrics to ${archiveName}`);\n  } catch (err) {\n    logHook('session-cleanup', `Failed to archive metrics: ${err}`);\n  }\n}\n\n/**\n * Clean up old session archives (keep last 20)\n */\nfunction cleanupOldArchives(archiveDir: string, keepCount: number = 20): void {\n  if (!existsSync(archiveDir)) {\n    return;\n  }\n\n  try {\n    const files = readdirSync(archiveDir)\n      .filter((f) => f.startsWith('session-') && f.endsWith('.json'))\n      .sort()\n      .reverse(); // Most recent first\n\n    if (files.length <= keepCount) {\n      return;\n    }\n\n    const toDelete = files.slice(keepCount);\n    for (const file of toDelete) {\n      try {\n        unlinkSync(`${archiveDir}/${file}`);\n        logHook('session-cleanup', `Deleted old archive: ${file}`);\n      } catch {\n        // Ignore deletion errors\n      }\n    }\n  } catch (err) {\n    logHook('session-cleanup', `Failed to cleanup old archives: ${err}`);\n  }\n}\n\n/**\n * Clean up old rotated log files (keep last 5)\n */\nfunction cleanupRotatedLogs(logDir: string): void {\n  if (!existsSync(logDir)) {\n    return;\n  }\n\n  const patterns = ['hooks.log.old*', 'audit.log.old*'];\n\n  for (const pattern of patterns) {\n    try {\n      const prefix = pattern.replace('*', '');\n      const files = readdirSync(logDir)\n        .filter((f) => f.startsWith(prefix))\n        .sort()\n        .reverse(); // Most recent first\n\n      if (files.length <= 5) {\n        continue;\n      }\n\n      const toDelete = files.slice(5);\n      for (const file of toDelete) {\n        try {\n          unlinkSync(`${logDir}/${file}`);\n        } catch {\n          // Ignore deletion errors\n        }\n      }\n    } catch {\n      // Ignore scan errors\n    }\n  }\n}\n\n/**\n * Session cleanup hook\n */\nexport function sessionCleanup(input: HookInput): HookResult {\n  logHook('session-cleanup', 'Session cleanup starting');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const metricsFile = '/tmp/claude-session-metrics.json';\n  const archiveDir = `${projectDir}/.claude/logs/sessions`;\n  const logDir = `${projectDir}/.claude/logs`;\n\n  // Archive metrics if significant\n  archiveMetrics(metricsFile, archiveDir);\n\n  // Clean up old session archives (keep last 20)\n  cleanupOldArchives(archiveDir, 20);\n\n  // Clean up old rotated log files (keep last 5)\n  cleanupRotatedLogs(logDir);\n\n  logHook('session-cleanup', 'Session cleanup complete');\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Context Loader - Loads session context at session start\n * Hook: SessionStart\n * CC 2.1.7 Compliant - Context Protocol 2.0\n * Supports agent_type for context-aware initialization\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess } from '../lib/common.js';\n\n/**\n * Validate JSON file\n */\nfunction isValidJsonFile(filePath: string): boolean {\n  if (!existsSync(filePath)) {\n    return false;\n  }\n\n  try {\n    JSON.parse(readFileSync(filePath, 'utf-8'));\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Session context loader hook\n */\nexport function sessionContextLoader(input: HookInput): HookResult {\n  logHook('session-context-loader', 'Session starting - loading context (Protocol 2.0)');\n\n  const projectDir = input.project_dir || getProjectDir();\n  let contextLoaded = 0;\n\n  // Extract agent_type from environment (set by startup-dispatcher)\n  const agentType = process.env.AGENT_TYPE || '';\n\n  // Context Protocol 2.0 paths\n  const sessionState = `${projectDir}/.claude/context/session/state.json`;\n  const identityFile = `${projectDir}/.claude/context/identity.json`;\n  const knowledgeIndex = `${projectDir}/.claude/context/knowledge/index.json`;\n\n  // Load session state\n  if (isValidJsonFile(sessionState)) {\n    logHook('session-context-loader', 'Session state loaded');\n    contextLoaded++;\n  }\n\n  // Load identity\n  if (isValidJsonFile(identityFile)) {\n    logHook('session-context-loader', 'Identity loaded');\n    contextLoaded++;\n  }\n\n  // Check knowledge index\n  if (isValidJsonFile(knowledgeIndex)) {\n    logHook('session-context-loader', 'Knowledge index available');\n    contextLoaded++;\n  }\n\n  // Load current status docs if they exist\n  const statusFile = `${projectDir}/docs/CURRENT_STATUS.md`;\n  if (existsSync(statusFile)) {\n    logHook('session-context-loader', 'Current status document exists');\n  }\n\n  // Agent-type aware context loading (CC 2.1.6 feature)\n  if (agentType) {\n    logHook('session-context-loader', `Agent-type aware initialization: ${agentType}`);\n\n    // Check if there's agent-specific configuration\n    const agentConfig = `${projectDir}/.claude/agents/${agentType}.md`;\n    if (existsSync(agentConfig)) {\n      logHook('session-context-loader', `Agent configuration found: ${agentConfig}`);\n      contextLoaded++;\n    }\n  }\n\n  // Log summary\n  if (contextLoaded > 0) {\n    if (agentType) {\n      logHook('session-context-loader', `Session context loaded (Protocol 2.0) - Agent: ${agentType}`);\n    } else {\n      logHook('session-context-loader', 'Session context loaded (Protocol 2.0)');\n    }\n  }\n\n  // Note: SessionStart hooks don't support hookSpecificOutput.additionalContext\n  return outputSilentSuccess();\n}\n", "/**\n * Session Environment Setup - Initializes session environment\n * Hook: SessionStart\n * CC 2.1.6 Compliant - Supports agent_type field\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { execSync } from 'node:child_process';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, getSessionId, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionState {\n  agent_type?: string;\n  session_id?: string;\n  last_activity?: string;\n  [key: string]: unknown;\n}\n\ninterface SessionMetrics {\n  session_id: string;\n  started_at: string;\n  agent_type: string;\n  tools: Record<string, number>;\n  errors: number;\n  warnings: number;\n}\n\n/**\n * Get current git branch\n */\nfunction getCurrentBranch(projectDir: string): string {\n  try {\n    return execSync('git branch --show-current', {\n      cwd: projectDir,\n      encoding: 'utf-8',\n      timeout: 500,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Session environment setup hook\n */\nexport function sessionEnvSetup(input: HookInput): HookResult {\n  logHook('session-env-setup', 'Setting up session environment');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionId = input.session_id || getSessionId();\n  const metricsFile = '/tmp/claude-session-metrics.json';\n\n  // Create logs directory if needed\n  try {\n    mkdirSync(`${projectDir}/.claude/logs`, { recursive: true });\n  } catch {\n    // Ignore mkdir errors\n  }\n\n  // Extract agent_type from environment or hook input\n  let agentType = process.env.AGENT_TYPE || '';\n  if (!agentType && input.agent_type) {\n    agentType = input.agent_type;\n  }\n\n  // Initialize session metrics\n  const metrics: SessionMetrics = {\n    session_id: sessionId,\n    started_at: new Date().toISOString(),\n    agent_type: agentType,\n    tools: {},\n    errors: 0,\n    warnings: 0,\n  };\n\n  try {\n    writeFileSync(metricsFile, JSON.stringify(metrics, null, 2));\n    logHook('session-env-setup', 'Initialized session metrics');\n  } catch (err) {\n    logHook('session-env-setup', `Failed to initialize metrics: ${err}`);\n  }\n\n  // Update session state with agent_type (CC 2.1.6 feature)\n  const sessionState = `${projectDir}/.claude/context/session/state.json`;\n  if (existsSync(sessionState) && agentType) {\n    try {\n      const state: SessionState = JSON.parse(readFileSync(sessionState, 'utf-8'));\n      state.agent_type = agentType;\n      state.session_id = sessionId;\n      state.last_activity = new Date().toISOString();\n      writeFileSync(sessionState, JSON.stringify(state, null, 2));\n      logHook('session-env-setup', `Updated session state with agent_type: ${agentType}`);\n    } catch (err) {\n      logHook('session-env-setup', `Failed to update session state: ${err}`);\n    }\n  }\n\n  // Check git status with timeout\n  const branch = getCurrentBranch(projectDir);\n  if (branch) {\n    logHook('session-env-setup', `Git branch: ${branch}`);\n  }\n\n  // Log agent type if present\n  if (agentType) {\n    logHook('session-env-setup', `Agent type: ${agentType}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Session Metrics Summary - Shows summary at session end\n * Hook: SessionEnd\n */\n\nimport { existsSync, readFileSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, outputSilentSuccess } from '../lib/common.js';\n\ninterface SessionMetrics {\n  tools?: Record<string, number>;\n  errors?: number;\n}\n\n/**\n * Session metrics summary hook\n */\nexport function sessionMetricsSummary(input: HookInput): HookResult {\n  logHook('session-metrics-summary', 'Session ending - generating summary');\n\n  const metricsFile = '/tmp/claude-session-metrics.json';\n\n  if (!existsSync(metricsFile)) {\n    logHook('session-metrics-summary', 'No metrics file found');\n    return outputSilentSuccess();\n  }\n\n  try {\n    const metrics: SessionMetrics = JSON.parse(readFileSync(metricsFile, 'utf-8'));\n    const tools = metrics.tools || {};\n    const errors = metrics.errors || 0;\n\n    // Calculate total tool calls\n    const totalTools = Object.values(tools).reduce((sum, count) => sum + count, 0);\n\n    // Get top 3 tools\n    const topTools = Object.entries(tools)\n      .sort(([, a], [, b]) => b - a)\n      .slice(0, 3)\n      .map(([tool, count]) => `${tool}: ${count}`)\n      .join(', ');\n\n    logHook('session-metrics-summary', `Session stats: ${totalTools} tool calls, ${errors} errors`);\n\n    if (totalTools > 0) {\n      // Note: We return silently since SessionEnd hooks typically don't need system messages\n      // The logging is sufficient for audit purposes\n      logHook('session-metrics-summary', `Top tools: ${topTools}`);\n    }\n  } catch (err) {\n    logHook('session-metrics-summary', `Failed to read metrics: ${err}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Dependency Version Check - Check for outdated dependencies at session start\n * Hook: SessionStart (#136)\n * CC 2.1.7 Compliant\n * Optimized with timeout, caching, and fast-exit to prevent startup hangs\n *\n * Parses:\n * - package.json (Node.js)\n * - requirements.txt, pyproject.toml (Python)\n * - go.mod (Go)\n *\n * Warns about:\n * - Known security vulnerabilities (CVE database)\n * - Severely outdated packages\n * - Deprecated packages\n *\n * Uses additionalContext to inject warnings into session context\n */\n\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport type { HookInput, HookResult } from '../types.js';\nimport { logHook, getProjectDir, outputSilentSuccess, outputWithContext } from '../lib/common.js';\n\ninterface KnownVuln {\n  package: string;\n  pattern: string;\n  severity: string;\n  cve: string;\n  description: string;\n}\n\ninterface DependencyCache {\n  warnings: string;\n  timestamp: number;\n}\n\ninterface PackageJson {\n  dependencies?: Record<string, string>;\n  devDependencies?: Record<string, string>;\n}\n\n// Known vulnerabilities database (static for offline operation)\nconst KNOWN_VULNS: KnownVuln[] = [\n  { package: 'lodash', pattern: '<4.17.21', severity: 'high', cve: 'CVE-2021-23337', description: 'Prototype pollution' },\n  { package: 'minimist', pattern: '<1.2.6', severity: 'critical', cve: 'CVE-2021-44906', description: 'Prototype pollution' },\n  { package: 'node-fetch', pattern: '<2.6.7', severity: 'high', cve: 'CVE-2022-0235', description: 'Information exposure' },\n  { package: 'axios', pattern: '<0.21.2', severity: 'high', cve: 'CVE-2021-3749', description: 'ReDoS vulnerability' },\n  { package: 'jsonwebtoken', pattern: '<9.0.0', severity: 'critical', cve: 'CVE-2022-23529', description: 'Insecure token verification' },\n  { package: 'express', pattern: '<4.17.3', severity: 'medium', cve: 'CVE-2022-24999', description: 'Open redirect' },\n  { package: 'tar', pattern: '<6.1.11', severity: 'critical', cve: 'CVE-2021-37701', description: 'Arbitrary file overwrite' },\n  { package: 'path-parse', pattern: '<1.0.7', severity: 'medium', cve: 'CVE-2021-23343', description: 'ReDoS vulnerability' },\n  { package: 'django', pattern: '<3.2.14', severity: 'high', cve: 'CVE-2022-34265', description: 'SQL injection' },\n  { package: 'flask', pattern: '<2.0.2', severity: 'medium', cve: 'CVE-2021-28091', description: 'Path traversal' },\n  { package: 'requests', pattern: '<2.28.0', severity: 'medium', cve: 'CVE-2023-32681', description: 'Information disclosure' },\n  { package: 'urllib3', pattern: '<1.26.5', severity: 'high', cve: 'CVE-2021-33503', description: 'ReDoS vulnerability' },\n  { package: 'pillow', pattern: '<9.0.0', severity: 'high', cve: 'CVE-2022-22817', description: 'Buffer overflow' },\n  { package: 'pyyaml', pattern: '<5.4', severity: 'critical', cve: 'CVE-2020-14343', description: 'Arbitrary code execution' },\n  { package: 'jinja2', pattern: '<3.0.3', severity: 'medium', cve: 'CVE-2020-28493', description: 'XSS vulnerability' },\n  { package: 'sqlalchemy', pattern: '<1.4.46', severity: 'medium', cve: 'CVE-2023-30533', description: 'SQL injection' },\n];\n\nconst CACHE_TTL_HOURS = 24;\n\n/**\n * Check if slow hooks should be skipped\n */\nfunction shouldSkipSlowHooks(): boolean {\n  return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS === '1';\n}\n\n/**\n * Compare semantic versions (simplified)\n */\nfunction versionLessThan(current: string, target: string): boolean {\n  const currentParts = current.split('.').map((p) => parseInt(p, 10) || 0);\n  const targetParts = target.split('.').map((p) => parseInt(p, 10) || 0);\n\n  for (let i = 0; i < Math.max(currentParts.length, targetParts.length); i++) {\n    const c = currentParts[i] || 0;\n    const t = targetParts[i] || 0;\n    if (c < t) return true;\n    if (c > t) return false;\n  }\n  return false;\n}\n\n/**\n * Check if version matches vulnerability pattern\n */\nfunction versionMatchesVuln(currentVersion: string, vulnPattern: string): boolean {\n  const operator = vulnPattern.charAt(0);\n  const vulnVersion = vulnPattern.substring(1);\n\n  if (operator === '<') {\n    return versionLessThan(currentVersion, vulnVersion);\n  } else if (operator === '=') {\n    return currentVersion === vulnVersion;\n  }\n\n  return false;\n}\n\n/**\n * Clean version string (remove ^, ~, etc.)\n */\nfunction cleanVersion(version: string): string {\n  return version\n    .replace(/^[^~>=<]/, '')\n    .replace(/,.*$/, '')\n    .trim();\n}\n\n/**\n * Check a package against known vulnerabilities\n */\nfunction checkPackageVulnerability(packageName: string, version: string): KnownVuln | null {\n  const cleanedVersion = cleanVersion(version);\n  const pkgLower = packageName.toLowerCase();\n\n  for (const vuln of KNOWN_VULNS) {\n    if (pkgLower === vuln.package) {\n      if (versionMatchesVuln(cleanedVersion, vuln.pattern)) {\n        return vuln;\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Check if cache is valid\n */\nfunction getCachedWarnings(cacheFile: string): string | null {\n  if (!existsSync(cacheFile)) {\n    return null;\n  }\n\n  try {\n    const cache: DependencyCache = JSON.parse(readFileSync(cacheFile, 'utf-8'));\n    const cacheAge = (Date.now() - cache.timestamp) / (1000 * 60 * 60);\n\n    if (cacheAge < CACHE_TTL_HOURS) {\n      return cache.warnings;\n    }\n  } catch {\n    // Cache invalid\n  }\n\n  return null;\n}\n\n/**\n * Save warnings to cache\n */\nfunction saveCache(cacheFile: string, warnings: string): void {\n  try {\n    mkdirSync(cacheFile.replace(/\\/[^/]+$/, ''), { recursive: true });\n\n    const cache: DependencyCache = {\n      warnings,\n      timestamp: Date.now(),\n    };\n\n    writeFileSync(cacheFile, JSON.stringify(cache, null, 2));\n  } catch {\n    // Ignore cache write errors\n  }\n}\n\n/**\n * Parse package.json for vulnerabilities\n */\nfunction parsePackageJson(filePath: string): { criticalCount: number; highCount: number; warnings: string } {\n  let criticalCount = 0;\n  let highCount = 0;\n  let warnings = '';\n\n  if (!existsSync(filePath)) {\n    return { criticalCount, highCount, warnings };\n  }\n\n  try {\n    const pkg: PackageJson = JSON.parse(readFileSync(filePath, 'utf-8'));\n    const allDeps = { ...pkg.dependencies, ...pkg.devDependencies };\n\n    for (const [packageName, version] of Object.entries(allDeps)) {\n      const vuln = checkPackageVulnerability(packageName, version);\n      if (vuln) {\n        if (vuln.severity === 'critical') criticalCount++;\n        if (vuln.severity === 'high') highCount++;\n        warnings += `\\n- ${packageName}@${version}: ${vuln.description} (${vuln.cve}, ${vuln.severity}) - upgrade to ${vuln.pattern}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return { criticalCount, highCount, warnings };\n}\n\n/**\n * Parse requirements.txt for vulnerabilities\n */\nfunction parseRequirementsTxt(filePath: string): { criticalCount: number; highCount: number; warnings: string } {\n  let criticalCount = 0;\n  let highCount = 0;\n  let warnings = '';\n\n  if (!existsSync(filePath)) {\n    return { criticalCount, highCount, warnings };\n  }\n\n  try {\n    const content = readFileSync(filePath, 'utf-8');\n    const lines = content.split('\\n');\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (!trimmed || trimmed.startsWith('#')) continue;\n\n      // Parse package==version or package>=version\n      const match = trimmed.match(/^([a-zA-Z0-9_-]+)(?:==|>=|~=|!=|<|>)\\s*([0-9.]+)/);\n      if (!match) continue;\n\n      const [, packageName, version] = match;\n      const vuln = checkPackageVulnerability(packageName, version);\n      if (vuln) {\n        if (vuln.severity === 'critical') criticalCount++;\n        if (vuln.severity === 'high') highCount++;\n        warnings += `\\n- ${packageName}==${version}: ${vuln.description} (${vuln.cve}, ${vuln.severity}) - upgrade to ${vuln.pattern}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return { criticalCount, highCount, warnings };\n}\n\n/**\n * Dependency version check hook\n */\nexport function dependencyVersionCheck(input: HookInput): HookResult {\n  // Bypass if slow hooks are disabled\n  if (shouldSkipSlowHooks()) {\n    logHook('dependency-version-check', 'Skipping dependency check (ORCHESTKIT_SKIP_SLOW_HOOKS=1)');\n    return outputSilentSuccess();\n  }\n\n  logHook('dependency-version-check', 'Starting dependency version check');\n\n  const projectDir = input.project_dir || getProjectDir();\n  const cacheFile = `${projectDir}/.claude/feedback/dependency-check-cache.json`;\n\n  // Fast exit: Check if any package files exist\n  const hasPackageJson = existsSync(`${projectDir}/package.json`);\n  const hasRequirementsTxt = existsSync(`${projectDir}/requirements.txt`);\n  const hasPyprojectToml = existsSync(`${projectDir}/pyproject.toml`);\n  const hasGoMod = existsSync(`${projectDir}/go.mod`);\n\n  if (!hasPackageJson && !hasRequirementsTxt && !hasPyprojectToml && !hasGoMod) {\n    logHook('dependency-version-check', 'No package files found, skipping check');\n    saveCache(cacheFile, 'none');\n    return outputSilentSuccess();\n  }\n\n  // Check cache first\n  const cached = getCachedWarnings(cacheFile);\n  if (cached !== null) {\n    logHook('dependency-version-check', 'Using cached dependency warnings');\n    if (cached !== 'none') {\n      return outputWithContext(`DEPENDENCY SECURITY CHECK (cached): ${cached}`);\n    }\n    return outputSilentSuccess();\n  }\n\n  let totalCritical = 0;\n  let totalHigh = 0;\n  let allWarnings = '';\n\n  // Check package.json\n  if (hasPackageJson) {\n    const result = parsePackageJson(`${projectDir}/package.json`);\n    totalCritical += result.criticalCount;\n    totalHigh += result.highCount;\n    if (result.warnings) {\n      allWarnings += `\\n\\nNode.js (package.json):${result.warnings}`;\n    }\n  }\n\n  // Check requirements.txt\n  if (hasRequirementsTxt) {\n    const result = parseRequirementsTxt(`${projectDir}/requirements.txt`);\n    totalCritical += result.criticalCount;\n    totalHigh += result.highCount;\n    if (result.warnings) {\n      allWarnings += `\\n\\nPython (requirements.txt):${result.warnings}`;\n    }\n  }\n\n  // Generate output\n  if (allWarnings) {\n    const summary = `Found ${totalCritical} critical and ${totalHigh} high severity vulnerabilities`;\n    const fullWarning = `DEPENDENCY SECURITY CHECK: ${summary}${allWarnings}\\n\\nRun 'npm audit' or 'pip-audit' for full details.`;\n\n    saveCache(cacheFile, fullWarning);\n    logHook('dependency-version-check', summary);\n\n    // Only show warning if there are critical or high severity issues\n    if (totalCritical > 0 || totalHigh > 0) {\n      return outputWithContext(fullWarning);\n    }\n  } else {\n    saveCache(cacheFile, 'none');\n    logHook('dependency-version-check', 'No known vulnerabilities found');\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Lifecycle Hooks Entry Point\n *\n * Hooks that run on session start/end (SessionStart, SessionEnd)\n * Bundle: lifecycle.mjs (~30 KB estimated)\n */\n\n// Re-export types and utilities\nexport * from '../types.js';\nexport * from '../lib/common.js';\nexport * from '../lib/git.js';\n\n// Lifecycle hooks (17) - SessionStart/SessionEnd\nimport { analyticsConsentCheck } from '../lifecycle/analytics-consent-check.js';\nimport { coordinationCleanup } from '../lifecycle/coordination-cleanup.js';\nimport { coordinationInit } from '../lifecycle/coordination-init.js';\nimport { decisionSyncPull } from '../lifecycle/decision-sync-pull.js';\nimport { decisionSyncPush } from '../lifecycle/decision-sync-push.js';\nimport { instanceHeartbeat } from '../lifecycle/instance-heartbeat.js';\nimport { mem0AnalyticsTracker } from '../lifecycle/mem0-analytics-tracker.js';\nimport { mem0ContextRetrieval } from '../lifecycle/mem0-context-retrieval.js';\nimport { mem0WebhookSetup } from '../lifecycle/mem0-webhook-setup.js';\nimport { multiInstanceInit } from '../lifecycle/multi-instance-init.js';\nimport { patternSyncPull } from '../lifecycle/pattern-sync-pull.js';\nimport { patternSyncPush } from '../lifecycle/pattern-sync-push.js';\nimport { sessionCleanup } from '../lifecycle/session-cleanup.js';\nimport { sessionContextLoader } from '../lifecycle/session-context-loader.js';\nimport { sessionEnvSetup } from '../lifecycle/session-env-setup.js';\nimport { sessionMetricsSummary } from '../lifecycle/session-metrics-summary.js';\nimport { dependencyVersionCheck } from '../lifecycle/dependency-version-check.js';\n\nimport type { HookFn } from '../types.js';\n\n/**\n * Lifecycle hooks registry\n */\nexport const hooks: Record<string, HookFn> = {\n  'lifecycle/analytics-consent-check': analyticsConsentCheck,\n  'lifecycle/coordination-cleanup': coordinationCleanup,\n  'lifecycle/coordination-init': coordinationInit,\n  'lifecycle/decision-sync-pull': decisionSyncPull,\n  'lifecycle/decision-sync-push': decisionSyncPush,\n  'lifecycle/instance-heartbeat': instanceHeartbeat,\n  'lifecycle/mem0-analytics-tracker': mem0AnalyticsTracker,\n  'lifecycle/mem0-context-retrieval': mem0ContextRetrieval,\n  'lifecycle/mem0-webhook-setup': mem0WebhookSetup,\n  'lifecycle/multi-instance-init': multiInstanceInit,\n  'lifecycle/pattern-sync-pull': patternSyncPull,\n  'lifecycle/pattern-sync-push': patternSyncPush,\n  'lifecycle/session-cleanup': sessionCleanup,\n  'lifecycle/session-context-loader': sessionContextLoader,\n  'lifecycle/session-env-setup': sessionEnvSetup,\n  'lifecycle/session-metrics-summary': sessionMetricsSummary,\n  'lifecycle/dependency-version-check': dependencyVersionCheck,\n};\n\nexport function getHook(name: string): HookFn | undefined {\n  return hooks[name];\n}\n\nexport function listHooks(): string[] {\n  return Object.keys(hooks);\n}\n"],
  "mappings": "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",
  "names": ["isBashInput", "input", "isWriteInput", "isEditInput", "isReadInput", "appendFileSync", "existsSync", "statSync", "renameSync", "mkdirSync", "getLogDir", "getProjectDir", "getPluginRoot", "getSessionId", "outputSilentSuccess", "outputSilentAllow", "outputBlock", "reason", "outputWithContext", "ctx", "outputPromptContext", "outputAllowWithContext", "systemMessage", "result", "outputError", "message", "outputWarning", "outputDeny", "LOG_ROTATION_MAX_SIZE", "PERMISSION_LOG_MAX_SIZE", "rotateLogFile", "logFile", "maxSize", "rotated", "ensureDir", "dir", "logHook", "hookName", "logDir", "timestamp", "logPermissionFeedback", "decision", "input", "toolName", "sessionId", "readHookInput", "chunks", "buf", "bytesRead", "fd", "readSync", "getField", "path", "parts", "value", "part", "normalizeCommand", "command", "escapeRegex", "str", "execSync", "getCurrentBranch", "projectDir", "dir", "getProjectDir", "execSync", "isProtectedBranch", "branch", "currentBranch", "getRepoRoot", "isGitRepo", "getGitStatus", "hasUncommittedChanges", "getDefaultBranch", "extractIssueNumber", "patterns", "pattern", "match", "validateBranchName", "validPrefixes", "prefix", "existsSync", "readFileSync", "getConsentStatus", "projectDir", "consentFile", "existsSync", "status", "readFileSync", "getLastConsentEvent", "consentLog", "log", "shouldShowReminder", "lastTimestamp", "lastDate", "analyticsConsentCheck", "input", "getProjectDir", "logHook", "outputSilentSuccess", "lastEvent", "existsSync", "readFileSync", "writeFileSync", "unlinkSync", "loadInstanceId", "projectDir", "envFile", "existsSync", "match", "readFileSync", "updateHeartbeatStatus", "instanceId", "heartbeatFile", "content", "writeFileSync", "logHook", "err", "unregisterInstance", "dbPath", "cleanupInstanceEnv", "unlinkSync", "coordinationCleanup", "input", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "appendFileSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "getTaskDescription", "projectDir", "stateFile", "existsSync", "readFileSync", "getAgentRole", "generateInstanceId", "sessionId", "getSessionId", "timestamp", "random", "saveInstanceId", "instanceId", "envFile", "mkdirSync", "appendFileSync", "logHook", "err", "initHeartbeat", "taskDesc", "agentRole", "heartbeatsDir", "heartbeat", "writeFileSync", "coordinationInit", "input", "outputSilentSuccess", "getProjectDir", "getProjectId", "projectDir", "parts", "decisionSyncPull", "input", "getProjectDir", "projectId", "userId", "logHook", "outputSilentSuccess", "existsSync", "execSync", "getPendingCount", "projectDir", "pluginRoot", "syncScript", "fallbackScript", "scriptPath", "existsSync", "match", "execSync", "decisionSyncPush", "input", "getProjectDir", "getPluginRoot", "pendingCount", "logHook", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "readdirSync", "unlinkSync", "mkdirSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "getInstanceId", "getSessionId", "loadInstanceIdFromFile", "projectDir", "envFile", "existsSync", "match", "readFileSync", "updateHeartbeat", "instanceId", "heartbeatsDir", "heartbeatFile", "mkdirSync", "heartbeat", "writeFileSync", "logHook", "content", "err", "cleanupStaleInstances", "currentInstanceId", "staleThresholdMs", "now", "cleanedCount", "files", "readdirSync", "f", "file", "filePath", "lastHeartbeat", "unlinkSync", "instanceHeartbeat", "input", "outputSilentSuccess", "getProjectDir", "mkdirSync", "appendFileSync", "isMem0Available", "mem0AnalyticsTracker", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "analyticsFile", "sessionId", "getSessionId", "timestamp", "analyticsEntry", "mkdirSync", "appendFileSync", "err", "existsSync", "readFileSync", "mkdirSync", "renameSync", "getProjectId", "projectDir", "parts", "isMem0Available", "hasValidPendingSync", "filePath", "existsSync", "content", "readFileSync", "parsed", "archivePendingSync", "processedDir", "timestamp", "mkdirSync", "archiveName", "archivePath", "renameSync", "logHook", "err", "mem0ContextRetrieval", "input", "logHook", "projectDir", "getProjectDir", "projectId", "getProjectId", "pendingSyncFile", "pendingSyncGlobal", "pendingFile", "hasValidPendingSync", "content", "readFileSync", "archivePendingSync", "isMem0Available", "outputSilentSuccess", "writeFileSync", "mkdirSync", "isMem0Available", "shouldSkipSlowHooks", "mem0WebhookSetup", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "webhookConfigFile", "webhookName", "webhookEvents", "webhookUrl", "mkdirSync", "writeFileSync", "err", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "isMultiInstanceEnabled", "shouldSkipSlowHooks", "isSqlite3Available", "execSync", "generateInstanceId", "projectDir", "worktreeName", "timestamp", "random", "getCurrentBranch", "detectCapabilities", "caps", "existsSync", "createInstanceIdentity", "instanceId", "branch", "capabilities", "now", "identity", "instanceDir", "mkdirSync", "writeFileSync", "logHook", "initDatabase", "coordDir", "dbPath", "schemaPath", "err", "startHeartbeat", "multiInstanceInit", "input", "outputSilentSuccess", "getProjectDir", "idFile", "pidFile", "existingId", "readFileSync", "existsSync", "readFileSync", "writeFileSync", "statSync", "mkdirSync", "MAX_FILE_SIZE_BYTES", "shouldSkipSlowHooks", "isSyncEnabled", "projectDir", "configFile", "existsSync", "readFileSync", "checkFileSize", "filePath", "stats", "statSync", "logHook", "pullGlobalPatterns", "globalPatternsFile", "projectPatternsFile", "globalList", "projectPatterns", "projectList", "existingTexts", "p", "newPatterns", "mergedPatterns", "mkdirSync", "writeFileSync", "err", "patternSyncPull", "input", "outputSilentSuccess", "getProjectDir", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "isSyncEnabled", "projectDir", "configFile", "existsSync", "readFileSync", "pushProjectPatterns", "projectPatternsFile", "globalPatternsFile", "logHook", "projectList", "globalPatterns", "globalList", "existingTexts", "p", "newPatterns", "mergedPatterns", "mkdirSync", "writeFileSync", "err", "patternSyncPush", "input", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "mkdirSync", "readdirSync", "unlinkSync", "copyFileSync", "getTotalTools", "metricsFile", "existsSync", "tools", "readFileSync", "sum", "count", "archiveMetrics", "archiveDir", "totalTools", "logHook", "mkdirSync", "archiveName", "archivePath", "copyFileSync", "err", "cleanupOldArchives", "keepCount", "files", "readdirSync", "f", "toDelete", "file", "unlinkSync", "cleanupRotatedLogs", "logDir", "patterns", "pattern", "prefix", "sessionCleanup", "input", "projectDir", "getProjectDir", "outputSilentSuccess", "existsSync", "readFileSync", "isValidJsonFile", "filePath", "existsSync", "readFileSync", "sessionContextLoader", "input", "logHook", "projectDir", "getProjectDir", "contextLoaded", "agentType", "sessionState", "identityFile", "knowledgeIndex", "statusFile", "agentConfig", "outputSilentSuccess", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "execSync", "getCurrentBranch", "projectDir", "execSync", "sessionEnvSetup", "input", "logHook", "getProjectDir", "sessionId", "getSessionId", "metricsFile", "mkdirSync", "agentType", "metrics", "writeFileSync", "err", "sessionState", "existsSync", "state", "readFileSync", "branch", "outputSilentSuccess", "existsSync", "readFileSync", "sessionMetricsSummary", "input", "logHook", "metricsFile", "existsSync", "outputSilentSuccess", "metrics", "readFileSync", "tools", "errors", "totalTools", "sum", "count", "topTools", "a", "b", "tool", "err", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "KNOWN_VULNS", "CACHE_TTL_HOURS", "shouldSkipSlowHooks", "versionLessThan", "current", "target", "currentParts", "p", "targetParts", "c", "t", "versionMatchesVuln", "currentVersion", "vulnPattern", "operator", "vulnVersion", "cleanVersion", "version", "checkPackageVulnerability", "packageName", "cleanedVersion", "pkgLower", "vuln", "getCachedWarnings", "cacheFile", "existsSync", "cache", "readFileSync", "saveCache", "warnings", "mkdirSync", "writeFileSync", "parsePackageJson", "filePath", "criticalCount", "highCount", "pkg", "allDeps", "parseRequirementsTxt", "lines", "line", "trimmed", "match", "dependencyVersionCheck", "input", "logHook", "outputSilentSuccess", "projectDir", "getProjectDir", "hasPackageJson", "hasRequirementsTxt", "hasPyprojectToml", "hasGoMod", "cached", "outputWithContext", "totalCritical", "totalHigh", "allWarnings", "result", "summary", "fullWarning", "hooks", "analyticsConsentCheck", "coordinationCleanup", "coordinationInit", "decisionSyncPull", "decisionSyncPush", "instanceHeartbeat", "mem0AnalyticsTracker", "mem0ContextRetrieval", "mem0WebhookSetup", "multiInstanceInit", "patternSyncPull", "patternSyncPush", "sessionCleanup", "sessionContextLoader", "sessionEnvSetup", "sessionMetricsSummary", "dependencyVersionCheck", "getHook", "name", "listHooks"]
}
