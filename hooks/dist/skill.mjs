// OrchestKit Hooks - skill bundle
// Generated: 2026-01-23T16:55:06.814Z

var $t=(s=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(s,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):s)(function(s){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+s+'" is not supported')});function qe(s){return typeof s.command=="string"}function Ke(s){return typeof s.file_path=="string"&&typeof s.content=="string"}function Ye(s){return typeof s.file_path=="string"&&typeof s.old_string=="string"&&typeof s.new_string=="string"}function Je(s){return typeof s.file_path=="string"&&s.content===void 0}import{appendFileSync as U,existsSync as B,statSync as St,renameSync as Rt,mkdirSync as bt}from"node:fs";function k(){return process.env.CLAUDE_PLUGIN_ROOT?`${process.env.HOME}/.claude/logs/ork`:`${d()}/.claude/logs`}function d(){return process.env.CLAUDE_PROJECT_DIR||"."}function O(){return process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||"."}function j(){return process.env.CLAUDE_SESSION_ID||`fallback-${process.pid}-${Date.now()}`}function c(){return{continue:!0,suppressOutput:!0}}function ts(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function m(s){return{continue:!1,stopReason:s,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:s}}}function _(s){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:s}}}function es(s){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:s}}}function ss(s,e){let t={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:s,permissionDecision:"allow"}};return e?t.systemMessage=e:t.suppressOutput=!0,t}function os(s){return{continue:!0,systemMessage:s}}function ns(s){return{continue:!0,systemMessage:`\u26A0 ${s}`}}function rs(s){return{continue:!1,stopReason:s,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:s}}}var wt=200*1024,It=100*1024;function G(s,e){if(B(s))try{if(St(s).size>e){let o=`${s}.old.${Date.now()}`;Rt(s,o)}}catch{}}function M(s){B(s)||bt(s,{recursive:!0})}function g(s,e){let t=k(),o=`${t}/hooks.log`;try{M(t),G(o,wt);let n=new Date().toISOString().replace("T"," ").slice(0,19);U(o,`[${n}] [${s}] ${e}
`)}catch{}}function is(s,e,t){let o=k(),n=`${o}/permission-feedback.log`;try{M(o),G(n,It);let r=new Date().toISOString(),i=t?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",a=t?.session_id||j();U(n,`${r} | ${s} | ${e} | tool=${i} | session=${a}
`)}catch{}}function cs(){try{let s=[],t=Buffer.allocUnsafe(256),o,n=0,{readSync:r}=$t("node:fs");for(;;)try{if(o=r(n,t,0,256,null),o===0)break;s.push(Buffer.from(t.subarray(0,o)))}catch{break}let i=Buffer.concat(s).toString("utf8").trim();return i?JSON.parse(i):{tool_name:"",session_id:j(),tool_input:{}}}catch{return{tool_name:"",session_id:j(),tool_input:{}}}}function as(s,e){let t=e.replace(/^\./,"").split("."),o=s;for(let n of t){if(o==null)return;o=o[n]}return o}function us(s){return s.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function ps(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as R}from"node:child_process";function E(s){let e=s||d();try{return R("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function Et(s){let e=s||E();return["dev","main","master"].includes(e)}function $(s){let e=s||d();try{return R("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function ms(s){let e=s||d();try{return R("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function Tt(s){let e=s||d();try{return R("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function W(s){return Tt(s).length>0}function z(s){let e=s||d();try{return R("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return R("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function Ht(s){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let t of e){let o=s.match(t);if(o)return parseInt(o[1],10)}return null}function gs(s){if(Et(s))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(o=>s.startsWith(o))?s.startsWith("issue/")&&!Ht(s)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}function Z(s,...e){let t=s.tool_input.file_path;if(!t)return c();let o=t.split(".").pop()?.toLowerCase()||"";return e.map(r=>r.toLowerCase().replace(/^\./,"")).includes(o)?null:c()}function b(s){return Z(s,"py","ts","tsx","js","jsx","go","rs","java")}function A(s){return Z(s,"py")}function V(s){let e=A(s);if(e)return e;let t=s.tool_input.file_path;if(!t)return c();if(!t.includes("/app/")&&!t.includes("/backend/"))return c();let o=t.split("/").pop()||"",n=t.substring(0,t.lastIndexOf("/")),r=[];if(o==="__init__.py")return c();if(n.endsWith("/routers")||n.includes("/routers/")){let i=/^(router_|routes_|api_).*\.py$/,a=/^(deps|dependencies|utils|helpers|base)\.py$/;!i.test(o)&&!a.test(o)&&(r.push("ROUTER NAMING: Files in routers/ must be prefixed"),r.push(`  Got: ${o}`),r.push("  Expected: router_*.py, routes_*.py, api_*.py, deps.py"))}if(n.endsWith("/services")||n.includes("/services/")){let i=/_service\.py$/,a=/^(base|utils|helpers|abstract)\.py$/;!i.test(o)&&!a.test(o)&&(r.push("SERVICE NAMING: Files in services/ must end with _service.py"),r.push(`  Got: ${o}`),r.push("  Expected: *_service.py, base.py, utils.py"))}if(n.endsWith("/repositories")||n.includes("/repositories/")){let i=/_(repository|repo)\.py$/,a=/^(base|abstract|utils)\.py$/;!i.test(o)&&!a.test(o)&&(r.push("REPOSITORY NAMING: Files in repositories/ must end with _repository.py"),r.push(`  Got: ${o}`),r.push("  Expected: *_repository.py, *_repo.py, base.py"))}if(n.endsWith("/schemas")||n.includes("/schemas/")){let i=/_(schema|dto|request|response)\.py$/,a=/^(base|common|shared|utils)\.py$/;!i.test(o)&&!a.test(o)&&(r.push("SCHEMA NAMING: Files in schemas/ must use proper suffix"),r.push(`  Got: ${o}`),r.push("  Expected: *_schema.py, *_dto.py, *_request.py, *_response.py"))}if(n.endsWith("/models")||n.includes("/models/")){let i=/_(model|entity|orm)\.py$/,a=/^(base|abstract|mixins)\.py$/;!i.test(o)&&!a.test(o)&&(r.push("MODEL NAMING: Files in models/ must use proper suffix"),r.push(`  Got: ${o}`),r.push("  Expected: *_model.py, *_entity.py, *_orm.py, base.py"))}if(/^[A-Z][a-zA-Z]+\.py$/.test(o)&&(r.push("NAMING: Python files should use snake_case, not PascalCase"),r.push(`  Got: ${o}`)),r.length>0){let i=`Backend naming violation in ${o}: ${r[0]}`;return g("backend-file-naming",`BLOCKED: ${i}`),m(i)}return c()}function q(s){let e=A(s);if(e)return e;let t=s.tool_input.file_path,o=s.tool_input.content||s.tool_result||"";if(!t||!o)return c();let n=[];if(t.includes("/routers/")&&(/db\.(add|delete|commit|flush|rollback|refresh|execute|scalar)/.test(o)&&n.push("DATABASE: Direct database operations not allowed in routers"),/^from sqlalchemy import/m.test(o)&&n.push("IMPORT: SQLAlchemy imports not allowed in routers")),t.includes("/services/")&&(/HTTPException\s*\(/.test(o)&&n.push("HTTP: HTTPException not allowed in services - use domain exceptions"),/from fastapi import.*(Request|Response)/.test(o)&&n.push("HTTP: Request/Response types not allowed in services")),t.includes("/repositories/")&&(/HTTPException/.test(o)&&n.push("HTTP: HTTPException not allowed in repositories"),/from.*(services|routers).*import/.test(o)&&n.push("IMPORT: Repositories cannot import from services or routers")),n.length>0){let i=`Layer violation in ${t.split("/").pop()||t}: ${n[0]}`;return g("backend-layer-validator",`BLOCKED: ${i}`),m(i)}return c()}import{existsSync as D,appendFileSync as Ct,mkdirSync as At}from"node:fs";import{execSync as Dt}from"node:child_process";function K(s){let e=d(),t=k(),o=`${t}/coverage-check.log`,n=parseInt(process.env.COVERAGE_THRESHOLD||"80",10);try{At(t,{recursive:!0})}catch{}let r=[],i=new Date().toISOString().replace("T"," ").slice(0,19);r.push(`[${i}] Coverage Check`);let a=`${e}/.coverage`,u=`${e}/coverage.xml`;if(D(a)||D(u))try{let f=Dt("coverage report --fail-under=0",{cwd:e,encoding:"utf8",timeout:3e4,stdio:["pipe","pipe","pipe"]}).split(`
`).find(l=>l.includes("TOTAL"));if(f){let l=f.match(/(\d+)%/);if(l){let y=parseInt(l[1],10);r.push(`Python coverage: ${y}%`),y<n?r.push(`WARNING: Coverage ${y}% is below threshold ${n}%`):r.push("Coverage meets threshold")}}}catch{}let p=`${e}/coverage`;if(D(p)){let h=`${p}/coverage-summary.json`;D(h)&&(r.push(""),r.push("JavaScript/TypeScript coverage report found"),r.push("Check coverage/lcov-report/index.html for details"))}try{Ct(o,r.join(`
`)+`
`)}catch{}return c()}import{existsSync as Pt,readFileSync as jt}from"node:fs";var Ot=["coverage/coverage-summary.json","coverage/coverage-final.json",".vitest/coverage/coverage-summary.json","coverage.json",".coverage.json","htmlcov/status.json"];function Nt(s,e){try{let t=JSON.parse(e);return s.includes("coverage-summary.json")?t?.total?.lines?.pct??t?.total?.statements?.pct??null:s.includes("coverage.json")?t?.totals?.percent_covered??null:t?.total?.pct!==void 0?t.total.pct:null}catch{return null}}function Y(s){let e=d(),t=parseInt(process.env.COVERAGE_THRESHOLD||"80",10),o="",n="";for(let a of Ot){let u=`${e}/${a}`;if(Pt(u)){o=u;try{n=jt(u,"utf8")}catch{continue}break}}if(!o||!n)return c();let r=Nt(o,n);if(r===null)return c();if(Math.floor(r)<t){let a=`BLOCKED: Coverage ${r}% is below threshold ${t}%

Coverage report: ${o}

Actions required:
  1. Identify uncovered code paths
  2. Add tests for critical business logic
  3. Re-run tests with coverage:

     TypeScript: npm test -- --coverage
     Python:     pytest --cov=app --cov-report=term-missing

  4. Ensure coverage >= ${t}% before proceeding

Tip: Focus on testing:
  - Business logic (services, utils)
  - Edge cases and error handling
  - Critical user flows`;return m(a)}return c()}import{existsSync as T,readFileSync as Lt}from"node:fs";function Ft(s){return/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(s)||/test_.*\.py$/.test(s)||/_test\.py$/.test(s)}function Ut(s){if(/\.(ts|tsx|js|jsx)$/.test(s)){let e=s.replace(/\.[^.]+$/,""),t=s.split(".").pop()||"ts",o=[`${e}.test.${t}`,`${e}.spec.${t}`,`${e}.test.ts`,`${e}.test.tsx`];for(let u of o)if(T(u))return u;let n=s.substring(0,s.lastIndexOf("/")),i=(s.split("/").pop()||"").replace(/\.[^.]+$/,""),a=[`${n}/__tests__/${i}.test.${t}`,`${n}/__tests__/${i}.spec.${t}`];for(let u of a)if(T(u))return u}else if(s.endsWith(".py")){let e=s.substring(0,s.lastIndexOf("/")),o=`test_${s.split("/").pop()||""}`;if(T(`${e}/${o}`))return`${e}/${o}`;let n=e.substring(0,e.lastIndexOf("/"));if(T(`${n}/tests/${o}`))return`${n}/tests/${o}`;if(T(`${e}/tests/${o}`))return`${e}/tests/${o}`}return null}function Bt(s,e){let t=[];if(/\.(ts|tsx|js|jsx)$/.test(e)){let o=s.match(/export (function|class|const|async function)\s+([A-Za-z_][A-Za-z0-9_]*)/g);if(o)for(let n of o){let r=n.split(/\s+/).pop();r&&t.push(r)}}else if(e.endsWith(".py")){let o=s.split(`
`);for(let n of o){let r=n.match(/^(def|class)\s+([A-Za-z][A-Za-z0-9_]*)/);r&&r[2]&&t.push(r[2])}}return[...new Set(t)]}function J(s){let e=s.tool_input?.file_path||"",t=s.tool_input?.content||s.tool_result||"";if(!e||!t)return c();if(Ft(e))return c();if(!/\.(ts|tsx|js|jsx|py)$/.test(e))return c();let o=[],n=[],r=Ut(e),i=Bt(t,e);if(i.length>0)if(r)try{let a=Lt(r,"utf8"),u=[];for(let p of i)new RegExp(`\\b${p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`).test(a)||u.push(p);if(u.length>0){n.push("TEST COVERAGE: New units without tests"),n.push(`  Implementation: ${e}`),n.push(`  Test file: ${r}`),n.push(""),n.push(`  Untested units (${u.length}/${i.length}):`);for(let p of u.slice(0,5))n.push(`    - ${p}`);n.push(""),n.push("  Add tests before committing")}}catch{}else{if(o.push("TEST COVERAGE: No test file found for implementation"),o.push(`  Implementation: ${e}`),o.push("  Expected test file:"),/\.(ts|tsx|js|jsx)$/.test(e)){let a=e.replace(/\.[^.]+$/,""),u=e.split(".").pop()||"ts",p=e.substring(0,e.lastIndexOf("/")),h=e.split("/").pop()||"";o.push(`    - ${a}.test.${u}`),o.push(`    - ${p}/__tests__/${h}`)}else if(e.endsWith(".py")){let a=e.split("/").pop()||"",u=e.substring(0,e.lastIndexOf("/"));o.push(`    - ${u}/test_${a}`),o.push(`    - ${u.substring(0,u.lastIndexOf("/"))}/tests/test_${a}`)}o.push(""),o.push(`  Found ${i.length} testable units:`);for(let a of i.slice(0,5))o.push(`    - ${a}`)}if(o.length>0)return m(`Missing test coverage for new code: ${o[0]}`);if(n.length>0){let a=n.join(`
`);return _(`Test coverage warnings detected:

${a}`)}return c()}var Gt=["database-engineer","backend-system-architect","frontend-ui-developer","security-auditor","test-generator","workflow-architect","llm-integrator","data-pipeline-engineer","metrics-architect","ux-researcher","code-quality-reviewer","requirements-translator","prioritization-analyst","rapid-ui-designer","market-intelligence","ci-cd-engineer","infrastructure-architect","accessibility-specialist","deployment-manager","git-operations-engineer"],Mt=["postgresql","postgres","pgvector","redis","mongodb","sqlite","fastapi","django","flask","express","nestjs","react","vue","angular","nextjs","remix","svelte","python","typescript","javascript","rust","go","jwt","oauth","oauth2","passkeys","webauthn","langchain","langgraph","openai","anthropic","ollama","langfuse","docker","kubernetes","terraform","aws","gcp","azure","pytest","jest","vitest","playwright","msw"],Wt=["cursor-pagination","cursor-based-pagination","keyset-pagination","offset-pagination","repository-pattern","service-layer","clean-architecture","dependency-injection","di-pattern","event-sourcing","cqrs","saga-pattern","circuit-breaker","retry-pattern","bulkhead","rate-limiting","throttling","optimistic-locking","pessimistic-locking","caching","cache-aside","write-through","rag","semantic-search","vector-search"],zt=50;function Zt(s){let e=s.toLowerCase(),t=Gt.filter(r=>e.includes(r)),o=Mt.filter(r=>e.includes(r)),n=Wt.filter(r=>e.includes(r));return{agents:[...new Set(t)],technologies:[...new Set(o)],patterns:[...new Set(n)]}}function Vt(s){let e=s.toLowerCase();return/recommend|suggests|advises/.test(e)?"RECOMMENDS":/chose|selected|decided/.test(e)?"CHOSEN_FOR":/replace|instead of|rather than/.test(e)?"REPLACES":/conflict|incompatible|anti-pattern/.test(e)?"CONFLICTS_WITH":"RELATES_TO"}function qt(s,e,t){let o=[];for(let n of s)o.push({name:n,entityType:"Agent",observations:[`OrchestKit agent: ${n}`]});for(let n of e)o.push({name:n,entityType:"Technology",observations:[`Technology choice: ${n}`]});for(let n of t)o.push({name:n,entityType:"Pattern",observations:[`Design pattern: ${n}`]});return o}function Kt(s,e,t,o){let n=[];for(let r of s){for(let i of e)n.push({from:r,to:i,relationType:o});for(let i of t)n.push({from:r,to:i,relationType:o})}return n}function X(s){let e=s.skill_name||s.tool_input.skill||"",t=s.tool_result||s.output||"";if(!t||t.length<zt)return c();let{agents:o,technologies:n,patterns:r}=Zt(t),i=o.length+n.length+r.length;if(i===0)return c();let a=Vt(t),u=qt(o,n,r),p=Kt(o,n,r,a);return{continue:!0,systemMessage:`[Entity Extraction] Found ${i} entities from ${e||"skill"}:
- Agents: ${o.length}
- Technologies: ${n.length}
- Patterns: ${r.length}
- Relations: ${p.length} (${a})

To create knowledge graph, use:

1. mcp__memory__create_entities with:
   entities: ${JSON.stringify(u,null,2)}

2. mcp__memory__create_relations with:
   relations: ${JSON.stringify(p,null,2)}

Note: Graph memory is enabled by default (v1.2.0). Entities will be automatically linked when stored via mcp__mem0__add_memory.`}}import{appendFileSync as Yt,mkdirSync as Jt}from"node:fs";function Q(s){let e=k(),t=`${e}/design-decision.log`;try{Jt(e,{recursive:!0})}catch{}let n=`[${new Date().toISOString().replace("T"," ").slice(0,19)}] Brainstorming Complete
Recommended next steps:
  1. Save key decisions to knowledge/decisions/active.json
  2. Create ADR if architectural decision was made
  3. Break down into implementation tasks

Consider using these skills next:
  - /architecture-decision-record (document decisions)
  - /api-design-framework (if API was designed)
  - /database-schema-designer (if schema was designed)
`;try{Yt(t,n+`
`)}catch{}return c()}function tt(s){let e=s.tool_input?.file_path||"",t=s.tool_input?.content||s.tool_result||"";if(!e||!t)return c();if(!/\/routers\/.*\.py$/.test(e))return c();let o=e.split("/").pop()||"";if(/^(deps|dependencies|__init__)\.py$/.test(o))return c();let n=[];if(/=\s*[A-Z][a-zA-Z]*Service\s*\(\s*\)/.test(t)){let r=t.match(/[A-Z][a-zA-Z]*Service\s*\(\s*\)/);n.push("INSTANTIATION: Direct service instantiation not allowed"),n.push(`  Found: ${r?.[0]||"Service()"}`),n.push("  "),n.push("  Use dependency injection:"),n.push("    service: MyService = Depends(get_my_service)")}if(/=\s*[A-Z][a-zA-Z]*(Repository|Repo)\s*\(\s*\)/.test(t)){let r=t.match(/[A-Z][a-zA-Z]*(Repository|Repo)\s*\(\s*\)/);n.push("INSTANTIATION: Direct repository instantiation not allowed"),n.push(`  Found: ${r?.[0]||"Repository()"}`),n.push("  "),n.push("  Use dependency injection:"),n.push("    repo: MyRepository = Depends(get_my_repository)")}if(/^[a-z_]+\s*=\s*[A-Z][a-zA-Z]*(Service|Repository|Repo)\s*\(/m.test(t)&&(n.push("GLOBAL: Global service/repository instance not allowed"),n.push("  "),n.push("  Global instances cause:"),n.push("    - Shared state between requests"),n.push("    - Difficult testing"),n.push("    - Connection pool issues"),n.push("  "),n.push("  Use Depends() for request-scoped instances")),/:\s*(Async)?Session[^=]*\)/.test(t)&&(/:\s*(Async)?Session\s*=\s*Depends/.test(t)||(n.push("DI: Database session must use Depends()"),n.push("  "),n.push("  BAD:  async def get_users(db: AsyncSession):"),n.push("  GOOD: async def get_users(db: AsyncSession = Depends(get_db)):"))),/@router\.(get|post|put|patch|delete)/.test(t)&&/:\s*[A-Z][a-zA-Z]*(Service|Repository|Repo)[^=)]*\)/.test(t)&&(/:\s*[A-Z][a-zA-Z]*(Service|Repository|Repo)\s*=\s*Depends/.test(t)||(n.push("DI: Service/Repository parameters must use Depends()"),n.push("  "),n.push("  BAD:  async def create_user(user_service: UserService):"),n.push("  GOOD: async def create_user(user_service: UserService = Depends(get_user_service)):"))),/async def/.test(t)){/db\.query\(/.test(t)&&(/await.*db\.query\(/.test(t)||(n.push("ASYNC: Sync database call in async function"),n.push("  Found: db.query() (sync pattern)"),n.push("  "),n.push("  Use async SQLAlchemy 2.0 patterns:"),n.push("    result = await db.execute(select(User))"),n.push("    users = result.scalars().all()")));let r=/db\.(add|delete|commit|flush|rollback|refresh)\(/;if(r.test(t)&&/AsyncSession/.test(t)){let i=t.split(`
`);for(let a of i)if(r.test(a)&&!a.includes("await")){n.push("ASYNC: Missing await for async database operation"),n.push("  "),n.push("  With AsyncSession, use await:"),n.push("    await db.commit()"),n.push("    await db.refresh(user)");break}}}if(n.length>0){g("di-pattern-enforcer",`BLOCKED: DI violation in ${e}`);let r=`Dependency injection violation in ${e}. See stderr for details.`;return _(r)}return c()}import{readFileSync as Xt,readdirSync as Qt}from"node:fs";function te(s,e){let t=[];if(/\.(ts|tsx|js|jsx)$/.test(e)){let o=s.match(/(function|class|const|export function|export class)\s+[A-Za-z_][A-Za-z0-9_]*/g);o&&t.push(...o)}else if(e.endsWith(".py")){let o=s.split(`
`);for(let n of o){let r=n.match(/^(def|class)\s+[A-Za-z_][A-Za-z0-9_]*/);r&&t.push(r[0])}}return[...new Set(t)]}function ee(s,e){let t=[],o=["node_modules",".venv","venv","__pycache__","dist","build",".next",".git"];function n(r){try{let i=Qt(r,{withFileTypes:!0});for(let a of i){let u=`${r}/${a.name}`;a.isDirectory()?o.includes(a.name)||n(u):a.isFile()&&e.test(a.name)&&t.push(u)}}catch{}}return n(s),t}function se(s){let e=[],t=s.split(`
`),o="",n=0,r=0;for(let i=0;i<t.length;i++){let a=t[i].trim();a&&a===o?(n++,n>=3&&e.push(`Line ${r}: ${o.substring(0,50)}`)):(o=a,n=1,r=i+1)}return e}function oe(s,e){let t=[],o=[];if(/\.(ts|tsx|js|jsx)$/.test(e)){/new Date.*toLocaleDateString/.test(s)&&(t.push("UTILITY: Direct date formatting detected"),t.push("  Use centralized date utilities: import { formatDate } from '@/lib/dates'"));let n=(s.match(/fetch\s*\(\s*['"]/g)||[]).length;n>2&&(o.push(`UTILITY: Multiple fetch calls detected (${n})`),o.push("  Consider using centralized API client or custom hook"));let r=(s.match(/if\s*\([^)]*\.test\([^)]*\)/g)||[]).length;r>3&&(o.push(`UTILITY: Multiple inline validations detected (${r})`),o.push("  Use Zod schemas: const schema = z.object({...})"))}if(e.endsWith(".py")){let n=(s.match(/json\.loads/g)||[]).length;n>3&&(o.push(`UTILITY: Multiple json.loads detected (${n})`),o.push("  Consider centralized JSON handling with error recovery"));let r=(s.match(/os\.getenv|os\.environ/g)||[]).length;r>5&&(o.push(`UTILITY: Multiple environment variable accesses (${r})`),o.push("  Use Settings/Config class with Pydantic validation"))}return{errors:t,warnings:o}}function et(s){let e=s.tool_input?.file_path||"",t=s.tool_input?.content||s.tool_result||"";if(!e||!t)return c();if(!/\.(ts|tsx|js|jsx|py)$/.test(e))return c();let o=[],n=[],r=te(t,e);if(r.length>0){let u=$()||d(),p=ee(u,/\.(ts|tsx|js|jsx|py)$/);for(let h of r){let f=h.split(/\s+/).pop()||"";if(f){for(let l of p)if(l!==e)try{let y=Xt(l,"utf8");if(new RegExp(`\\b${f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`).test(y)&&y.includes(h)){let x=l.replace(u+"/","");n.push(`DUPLICATE: '${f}' already exists in:`),n.push(`  - ${x}`),n.push("  Consider:"),n.push("    1. Reusing existing implementation"),n.push("    2. Extracting to shared utility"),n.push("    3. Using different name if intentionally different");break}}catch{}}}}let i=se(t);if(i.length>0){n.push("COPY-PASTE: Repeated code blocks detected:");for(let u of i.slice(0,5))n.push(`  ${u}`);n.push("  Refactor repeated logic into functions")}let a=oe(t,e);if(o.push(...a.errors),n.push(...a.warnings),o.length>0){let u=`Duplicate code violation in ${e}. See stderr for details.`;return _(u)}if(n.length>0){let u=`Potential code duplication detected in ${e}. Review warnings on stderr.`;return _(u)}return c()}import{existsSync as N,readFileSync as st,readdirSync as ne}from"node:fs";function ot(s){let e=d(),t=[];t.push("::group::LLM Evaluation Summary");let o=`${e}/eval_results.json`;if(N(o)){t.push("Evaluation results found:");try{let i=st(o,"utf8"),a=JSON.parse(i);if(typeof a=="object"&&a!==null){for(let[u,p]of Object.entries(a))if(typeof p=="number"){let h=Number.isInteger(p)?p.toString():p.toFixed(2);t.push(`  ${u}: ${h}`)}}}catch{try{let a=st(o,"utf8").split(`
`).slice(0,20);t.push(...a)}catch{t.push("  (Unable to read file)")}}}let n=`${e}/.deepeval`;if(N(n)){t.push(""),t.push("DeepEval results directory found");try{let i=ne(n).slice(0,5);for(let a of i)t.push(`  ${a}`)}catch{}}let r=`${e}/ragas_results.json`;N(r)&&(t.push(""),t.push("RAGAS evaluation results found")),t.push(""),t.push("Evaluation complete - review metrics above"),t.push("::endgroup::");for(let i of t)process.stderr.write(i+`
`);return c()}import{existsSync as S,appendFileSync as re,mkdirSync as ie,readdirSync as ce}from"node:fs";function nt(s){let e=k(),t=d(),o=`${e}/evidence-collector.log`;try{ie(e,{recursive:!0})}catch{}let n=new Date().toISOString().replace("T"," ").slice(0,19),r=[];r.push(`[${n}] Evidence Collection`),r.push("Recent command results:");let i=process.env.CC_LAST_EXIT_CODE;i&&r.push(`  Last exit code: ${i}`),(S(`${t}/pytest.xml`)||S(`${t}/junit.xml`))&&r.push("  Test results: Found (XML format)");let a=`${t}/test-results`;if(S(a)){r.push("  Test results directory: Found");try{let u=ce(a).slice(0,5);for(let p of u)r.push(`    ${p}`)}catch{}}(S(`${t}/.coverage`)||S(`${t}/coverage`))&&r.push("  Coverage data: Found"),(S(`${t}/lint-results.json`)||S(`${t}/eslint-report.json`))&&r.push("  Lint results: Found"),r.push("Evidence verification complete.");try{re(o,r.join(`
`)+`
`)}catch{}return c()}function ae(s){return s.includes("/shared/")?"shared":s.includes("/lib/")?"lib":s.includes("/utils/")?"utils":s.includes("/components/")&&!s.includes("/features/")?"components":s.includes("/hooks/")&&!s.includes("/features/")?"hooks":s.includes("/features/")?"features":s.includes("/app/")||s.includes("/pages/")?"app":s.includes("/repositories/")?"repositories":s.includes("/services/")&&s.endsWith(".py")?"services":s.includes("/routers/")?"routers":null}function rt(s){let e=b(s);if(e)return e;let t=s.tool_input.file_path||"",o=s.tool_input.content||s.tool_result||"";if(!t||!o)return c();let n=ae(t);if(!n)return c();let r=[];if(/\.(ts|tsx|js|jsx)$/.test(t))switch(n){case"shared":case"lib":case"utils":/from ['"](@\/|\.\.\/)*(features|app)\//.test(o)&&r.push(`${n}/ cannot import from features/ or app/`);break;case"components":case"hooks":/from ['"](@\/|\.\.\/)*(features|app)\//.test(o)&&r.push(`${n}/ cannot import from features/ or app/`);break;case"features":/from ['"](@\/|\.\.\/)*app\//.test(o)&&r.push("features/ cannot import from app/");break}if(t.endsWith(".py"))switch(n){case"repositories":/from (app\.)?(services|routers)/.test(o)&&r.push("repositories/ cannot import from services/ or routers/");break;case"services":/from (app\.)?routers\.[a-z]/.test(o)&&(/from (app\.)?routers\.(deps|dependencies)/.test(o)||r.push("services/ cannot import from routers/"));break}if(r.length>0){let a=`Import direction violation in ${t.split("/").pop()||t}: ${r[0]}`;return g("import-direction-enforcer",`BLOCKED: ${a}`),m(a)}return c()}import{execSync as ue}from"child_process";import{readFileSync as pe,existsSync as le}from"fs";import{join as fe}from"path";var it=["decided","chose","selected","will use","implemented","architecture:","pattern:","approach:","recommendation:","best practice:","conclusion:"],de=100,me=10240,ge={"cursor-pagination":/cursor[- ]?(based)?[- ]?pagination/i,"jwt-validation":/jwt|json web token/i,"dependency-injection":/dependency injection|di pattern|ioc/i,"async-io":/async|await|asyncio|aiofiles/i,"eager-loading":/eager[- ]?load|prefetch|join.*load/i,"rate-limiting":/rate[- ]?limit|throttl/i,"circuit-breaker":/circuit[- ]?breaker|resilience/i,"event-sourcing":/event[- ]?sourc/i,cqrs:/cqrs|command.*query.*separation/i,webhook:/webhook|callback.*url/i,idempotency:/idempoten/i,"optimistic-locking":/optimistic[- ]?lock|version.*field/i,"attention-aware-positioning":/start.*position|end.*position|attention/i,"progressive-loading":/progressive[- ]?load|lazy[- ]?load|on[- ]?demand/i},he=["critical","security","breaking","migration","architecture","performance","scalability","production","deploy","release"],ye=["refactor","optimize","improve","update","enhance","fix"],L=null;function ke(){try{if(process.env.CLAUDE_CODE_VERSION)return process.env.CLAUDE_CODE_VERSION;let e=ue("claude --version 2>/dev/null",{encoding:"utf-8",timeout:2e3}).match(/(\d+\.\d+\.\d+)/);if(e)return e[1]}catch{}return"2.1.16"}function _e(){if(L!==null)return L;let s="unknown";try{let e=O(),t=fe(e,".claude-plugin","plugin.json");if(le(t)){let o=pe(t,"utf-8");s=JSON.parse(o).version||"unknown"}}catch{}return L=s,s}function ve(s){let e=s.toLowerCase();for(let t of he)if(e.includes(t))return"high";for(let t of ye)if(e.includes(t))return"medium";return"low"}function xe(s){for(let[e,t]of Object.entries(ge))if(t.test(s))return e;return null}function $e(s){let e=s.slice(0,me).toLowerCase();return/pagination|cursor|offset/.test(e)?"pagination":/security|vulnerability|exploit|injection|xss|csrf|owasp|safety|guardrail/.test(e)?"security":/database|sql|postgres|schema|migration/.test(e)?"database":/api|endpoint|rest|graphql/.test(e)?"api":/auth|login|jwt|oauth/.test(e)?"authentication":/test|testing|pytest|jest|vitest|coverage|mock|fixture|spec/.test(e)?"testing":/deploy|ci|cd|pipeline|docker|kubernetes|helm|terraform/.test(e)?"deployment":/observability|monitoring|logging|tracing|metrics|prometheus|grafana|langfuse/.test(e)?"observability":/react|component|frontend|ui|tailwind/.test(e)?"frontend":/performance|optimization|cache|index/.test(e)?"performance":/llm|rag|embedding|vector|semantic|ai|ml|langchain|langgraph|mem0|openai|anthropic/.test(e)?"ai-ml":/etl|data.*pipeline|streaming|batch.*processing|dataflow|spark/.test(e)?"data-pipeline":/architecture|design|structure|pattern/.test(e)?"architecture":"decision"}function Se(s){let e=s.toLowerCase();return it.some(t=>e.includes(t))}function Re(s){let e=[];for(let t of it){let o=new RegExp(`[^\\n]*${t}[^\\n]*`,"gi"),n=s.match(o);if(n)for(let r of n.slice(0,3)){let i=r.trim().slice(0,300);i.length>30&&e.push(i)}}return[...new Set(e)].slice(0,5)}function be(s){let e=[],t=s.toLowerCase();return/postgres|database|db/.test(t)&&e.push("PostgreSQL"),/fastapi|api/.test(t)&&e.push("FastAPI"),/react|frontend/.test(t)&&e.push("React"),/langchain|langgraph/.test(t)&&e.push("LangGraph"),e.join(", ")||"none detected"}function ct(s){let e=s.skill_name||s.tool_input?.skill||"",t=s.tool_result||s.output||"";if(!t||t.length<de)return c();if(!Se(t))return c();let o=Re(t);if(o.length===0)return c();let n="orchestkit:all-agents",r=o[0],i=$e(r),a=be(r),u=o.length,h=`${O()}/skills/mem0-memory/scripts/crud/add-memory.py`,f=process.env.CLAUDE_AGENT_ID||s.subagent_type||s.agent_type||"",l=ke(),y=_e(),w=ve(r),x=xe(r),I={category:i,source:"orchestkit-plugin",skill:e||"unknown",shared:!1,cc_version:l,plugin_version:y,importance:w,timestamp:new Date().toISOString()};return f&&(I.agent_name=f),x&&(I.best_practice=x),{continue:!0,systemMessage:`[Decision Extraction] Found ${u} decisions from ${e||"skill"} (category: ${i})

To persist these decisions, execute:
bash ${h} --text "<decision content>" --user-id "${n}" --metadata '${JSON.stringify(I)}' --enable-graph

Note: Graph memory enabled by default (v1.2.0) - entities extracted: ${a}
Metadata: CC ${l}, Plugin ${y}, Importance: ${w}${x?`, Best Practice: ${x}`:""}

Example decision: "${r.slice(0,100)}..."`}}import{existsSync as we,readFileSync as Ie}from"node:fs";import{execSync as H}from"node:child_process";function Ee(){try{return H("git worktree list --porcelain",{encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).split(`
`).filter(e=>e.startsWith("worktree ")).map(e=>e.replace("worktree ",""))}catch{return[]}}function Te(s){try{return H("git rev-parse --abbrev-ref HEAD",{cwd:s,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function He(s,e){try{let t=H(`git status --short "${e}"`,{cwd:s,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]});return/^.M|^M.|^A/.test(t)}catch{return!1}}function Ce(s,e){try{let t=parseInt(H(`git rev-list --count ${s}..${e}`,{encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim(),10),o=parseInt(H(`git rev-list --count ${e}..${s}`,{encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim(),10);return{ahead:t||0,behind:o||0}}catch{return{ahead:0,behind:0}}}function at(s){let e=s.tool_input.file_path||"",t=s.tool_input.content||s.tool_result||"";if(!e||!t)return c();let o=Ee();if(o.length===0)return c();let n=[],r=[],i=$()||d(),a=i,u=e.replace(i+"/","").replace(i,"");for(let f of o){if(f===a)continue;let l=`${f}/${u}`;if(!we(l))continue;let y=Te(f);if(He(f,u)){r.push({worktree:f,branch:y,status:"modified"});try{let w=Ie(l,"utf8"),x=t.split(`
`),I=w.split(`
`),P=Math.abs(x.length-I.length);P>10&&(n.push(`OVERLAP: Significant changes in both branches (~${P} lines)`),n.push(`  Branch: ${y}`),n.push("  High risk of merge conflict"))}catch{}}}let p=E(),h=z();if(p!==h){let{ahead:f,behind:l}=Ce(h,p);l>10&&(n.push(`DIVERGENCE: Current branch is ${l} commits behind ${h}`),n.push("  Consider rebasing before continuing development"),n.push("  This reduces merge conflict risk"))}if(r.length>0){n.unshift("MERGE CONFLICT RISK: Concurrent modifications detected"),n.unshift(""),n.unshift(`File: ${e}`);for(let f of r)n.push(`  Branch: ${f.branch}`),n.push(`  Status: ${f.status}`),n.push(`  Path: ${f.worktree}`);n.push(""),n.push("Recommendations:"),n.push("  1. Coordinate changes with other instances"),n.push("  2. Consider splitting work to avoid overlapping files"),n.push("  3. Communicate before merging")}if(n.length>0){let f=`Potential merge conflicts detected in ${e}. Review warnings on stderr.`;return process.stderr.write(n.join(`
`)+`
`),_(f)}return c()}import{existsSync as F,readFileSync as Ae}from"node:fs";import{execSync as De}from"node:child_process";function v(s,e){try{return De(s,{cwd:e||d(),encoding:"utf8",timeout:3e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function ut(s){let e=s.tool_input?.command||"";if(!/\b(gh\s+pr\s+merge|git\s+merge|git\s+rebase)\b/i.test(e))return c();let t=s.tool_input.target_branch||"main",o=E();if(o===t)return process.stderr.write(`Already on target branch ${t}
`),c();process.stderr.write(`Checking merge readiness: ${o} -> ${t}

`);let n=$()||d(),r=[],i=[],a=[];if(process.stderr.write(`1. Checking for uncommitted changes...
`),W()){let l=v("git status --short");r.push("Uncommitted changes detected:"),r.push(l.split(`
`).slice(0,10).join(`
`))}else a.push("No uncommitted changes");process.stderr.write(`2. Checking branch divergence...
`),v(`git fetch origin ${t}`);let u=parseInt(v(`git rev-list --count origin/${t}..${o}`)||"0",10),p=parseInt(v(`git rev-list --count ${o}..origin/${t}`)||"0",10);if(process.stderr.write(`   Ahead: ${u} commits, Behind: ${p} commits
`),p>20?(r.push(`Branch is significantly behind ${t} (${p} commits)`),r.push(`Rebase or merge ${t} before proceeding`)):p>5?(i.push(`Branch is behind ${t} by ${p} commits`),i.push("Consider rebasing for easier merge")):a.push(`Branch is up to date (behind by ${p})`),process.stderr.write(`3. Checking for merge conflicts...
`),v(`git merge --no-commit --no-ff origin/${t}`).includes("CONFLICT")){let l=v("git diff --name-only --diff-filter=U");r.push(`Merge conflicts detected with ${t}:`);for(let y of l.split(`
`).slice(0,10))y&&r.push(`  - ${y}`);r.push("Resolve conflicts before merging"),v("git merge --abort")}else a.push("No merge conflicts detected"),v("git merge --abort");process.stderr.write(`4. Running quality gates on changed files...
`);let f=v(`git merge-base ${o} origin/${t}`);if(f){let y=v(`git diff --name-only ${f} ${o}`).split(`
`).filter(Boolean).length;process.stderr.write(`   Checking ${y} changed files...
`),a.push("Quality gates check performed")}else i.push("Cannot determine merge base - skipping file checks");if(process.stderr.write(`5. Checking test suite...
`),F(`${n}/package.json`)&&Ae(`${n}/package.json`,"utf8").includes('"test":')&&a.push("Frontend test script found"),(F(`${n}/pytest.ini`)||F(`${n}/pyproject.toml`))&&a.push("Backend test configuration found"),process.stderr.write(`
`),process.stderr.write("=".repeat(60)+`
`),process.stderr.write(`
MERGE READINESS REPORT

`),process.stderr.write(`Branch: ${o} -> ${t}

`),a.length>0){process.stderr.write(`PASSED CHECKS:
`);for(let l of a)process.stderr.write(`   ${l}
`);process.stderr.write(`
`)}if(i.length>0){process.stderr.write(`WARNINGS:
`);for(let l of i)process.stderr.write(`   ${l}
`);process.stderr.write(`
`)}if(r.length>0){process.stderr.write(`BLOCKERS:
`);for(let l of r)process.stderr.write(`   ${l}
`);return process.stderr.write(`
MERGE NOT READY - Fix blockers before merging
`),{continue:!1,stopReason:"Merge not ready - blockers detected"}}return i.length>0?(process.stderr.write(`MERGE READY WITH WARNINGS
`),process.stderr.write(`Review warnings before proceeding with merge
`)):(process.stderr.write(`MERGE READY - All checks passed!
`),process.stderr.write(`You can safely merge this branch
`)),c()}import{existsSync as Pe,readFileSync as je}from"node:fs";import{execSync as Oe}from"node:child_process";function pt(s){let e=s.tool_input?.file_path||process.env.CC_TOOL_FILE_PATH||"";if(!e)return c();if(!e.includes("alembic/versions")||!e.endsWith(".py"))return c();if(!Pe(e))return c();process.stderr.write(`::group::Migration Validation: ${e.split("/").pop()}
`);let t=[],o;try{o=je(e,"utf8")}catch{return t.push("Cannot read migration file"),_(`Migration validation failed for ${e}`)}o.includes("def upgrade")||t.push("Missing upgrade() function in migration"),o.includes("def downgrade")||t.push("Missing downgrade() function in migration"),/^revision = /m.test(o)||t.push("Missing revision ID in migration");try{Oe(`python3 -m py_compile "${e}"`,{encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]})}catch{t.push("Python syntax error in migration")}if(t.length>0){process.stderr.write(`::error::Migration validation failed
`);for(let r of t)process.stderr.write(`  - ${r}
`);process.stderr.write(`::endgroup::
`),g("migration-validator",`BLOCKED: ${t[0]}`);let n=`Migration validation failed for ${e}. See stderr for details.`;return _(n)}return process.stderr.write(`Migration file is valid
`),process.stderr.write(`::endgroup::
`),c()}import{existsSync as Ne}from"node:fs";function lt(s){let e=s.tool_input.file_path||"",t=s.tool_input.content||s.tool_result||"";if(!e||!t)return c();let n=`${$()||d()}/.claude/context/knowledge/patterns/established.json`;if(!Ne(n))return c();let r=[],i=[];if(e.endsWith(".py")&&(e.includes("/backend/")||e.includes("/api/"))&&(e.includes("/routers/")&&/from.*repositories.*import/.test(t)&&(r.push("PATTERN: Router imports repository directly"),r.push("  Established pattern: routers -> services -> repositories"),r.push("  Import from services/ layer instead")),e.includes("/services/")&&/from.*routers.*import/.test(t)&&(r.push("PATTERN: Service imports router (circular dependency)"),r.push("  Established pattern: Services are independent of HTTP layer")),/from sqlalchemy import/.test(t)&&(/from sqlalchemy\.ext\.asyncio import/.test(t)||/Session|sessionmaker/.test(t)&&(r.push("PATTERN: Using sync SQLAlchemy instead of async"),r.push("  Established pattern: All DB operations use async/await"),r.push("  Import: from sqlalchemy.ext.asyncio import AsyncSession"))),/from pydantic import.*BaseModel/.test(t)&&(/@validator\(/.test(t)&&(r.push("PATTERN: Using Pydantic v1 @validator decorator"),r.push("  Established pattern: Pydantic v2 with @field_validator"),r.push("  Update: @field_validator('field_name', mode='after')")),/@root_validator/.test(t)&&(r.push("PATTERN: Using Pydantic v1 @root_validator decorator"),r.push("  Established pattern: Pydantic v2 with @model_validator"),r.push("  Update: @model_validator(mode='after')")))),/\.(ts|tsx|js|jsx)$/.test(e)&&(e.includes("/frontend/")||e.includes("/src/"))&&(/React\.FC</.test(t)&&(r.push("PATTERN: Using React.FC instead of explicit Props type"),r.push("  Established pattern: function Component(props: Props): React.ReactNode"),r.push("  Remove React.FC, use explicit function declaration")),/fetch\(|axios\./.test(t)&&(/from ['"]zod['"]/.test(t)||(r.push("PATTERN: API call without Zod validation"),r.push("  Established pattern: All API responses validated with Zod"),r.push("  Import: import { z } from 'zod'"))),/<form/.test(t)&&(/useFormStatus|useActionState|useOptimistic/.test(t)||(i.push("PATTERN: Form without React 19 form hooks"),i.push("  Established pattern: Use useFormStatus for pending state"),i.push("  Consider: useOptimistic for optimistic updates"))),/new Date.*toLocaleDateString|toLocaleString/.test(t)&&(r.push("PATTERN: Direct date formatting instead of centralized utility"),r.push("  Established pattern: Use @/lib/dates helpers"),r.push("  Import: import { formatDate, formatDateShort } from '@/lib/dates'"))),(/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(e)||/test_.*\.py$/.test(e))&&(/\/\/ Arrange|\/\/ Act|\/\/ Assert|# Arrange|# Act|# Assert/i.test(t)||(i.push("PATTERN: AAA pattern comments missing"),i.push("  Established pattern: Structure tests with Arrange-Act-Assert"),i.push("  Add comments for clarity in complex tests")),/\.(ts|tsx|js|jsx)$/.test(e)&&/jest\.mock.*fetch|global\.fetch/.test(t)&&(r.push("PATTERN: Using jest.mock for fetch instead of MSW"),r.push("  Established pattern: Use MSW for API mocking"),r.push("  Import: import { http, HttpResponse } from 'msw'")),e.endsWith(".py")&&/class Test.*setUp/.test(t)&&(r.push("PATTERN: Using unittest setUp instead of pytest fixtures"),r.push("  Established pattern: Use pytest fixtures"),r.push("  Convert: @pytest.fixture\\ndef setup_data():"))),(e.includes("/llm/")||e.includes("/ai/")||e.includes("/agent/"))&&(/prompt.*\{.*id.*\}|f".*\{.*\.id\}.*"/.test(t)&&(r.push("PATTERN: Database IDs in LLM prompts"),r.push("  Established pattern: IDs flow around LLM, not through it"),r.push("  Pass IDs via metadata, join results after LLM processing")),/await.*openai|await.*anthropic|await.*llm/.test(t)&&(/asyncio\.timeout|asyncio\.wait_for|Promise\.race/.test(t)||(r.push("PATTERN: LLM call without timeout protection"),r.push("  Established pattern: Wrap all LLM calls with timeout"),r.push("  Python: async with asyncio.timeout(30):"),r.push("  TypeScript: await Promise.race([call, timeout])")))),r.length>0)return m(`Pattern consistency violations detected in ${e}`);if(i.length>0){process.stderr.write(`WARNING: Pattern consistency issues detected
`),process.stderr.write(`File: ${e}

`);for(let a of i)process.stderr.write(`  ${a}
`)}return c()}var Le=[/sk-[a-zA-Z0-9]{20,}/,/ghp_[a-zA-Z0-9]{36}/,/AKIA[A-Z0-9]{16}/,/xox[baprs]-[a-zA-Z0-9-]+/],Fe=[/password\s*[:=]\s*['"][^'"]+['"]/i,/secret\s*[:=]\s*['"][^'"]+['"]/i];function ft(s){let e=s.tool_result||s.output||"";if(!e)return c();for(let t of Le)if(t.test(e)){process.stderr.write(`::warning::Potential API key detected in output - verify redaction
`);break}for(let t of Fe)if(t.test(e)){process.stderr.write(`::warning::Potential hardcoded credential in output
`);break}return c()}import{appendFileSync as Ue,mkdirSync as Be}from"node:fs";function dt(s){let e=k(),t=`${e}/review-summary.log`;try{Be(e,{recursive:!0})}catch{}let n=`[${new Date().toISOString().replace("T"," ").slice(0,19)}] Code Review Summary
Review checklist:
  [ ] All blocking issues addressed
  [ ] Non-blocking suggestions noted
  [ ] Tests pass
  [ ] No security concerns
  [ ] Documentation updated if needed

Conventional comment prefixes used:
  - blocking: Must fix before merge
  - suggestion: Consider this improvement
  - nitpick: Minor style issue
  - question: Needs clarification
  - praise: Good work!
`;try{Ue(t,n+`
`)}catch{}return c()}import{appendFileSync as Ge,mkdirSync as Me}from"node:fs";function mt(s){let e=k(),t=`${e}/security-summary.log`;try{Me(e,{recursive:!0})}catch{}let n=`[${new Date().toISOString().replace("T"," ").slice(0,19)}] Security Scan Complete
Review findings for:
  - Critical/High vulnerabilities (fix immediately)
  - Dependency CVEs (update packages)
  - Hardcoded secrets (move to env vars)
  - OWASP Top 10 violations

Next steps:
  1. Triage findings by severity
  2. Create issues for critical/high
  3. Update dependencies with CVEs
`;try{Ge(t,n+`
`)}catch{}return c()}var gt=4;function ht(s){let e=b(s);if(e)return e;let t=s.tool_input.file_path||"";if(!t)return c();let o=[],n=t.split("/").pop()||"";if(t.includes("/src/")||t.includes("/app/")){let r="";t.includes("/src/")?r=t.split("/src/")[1]||"":r=t.split("/app/")[1]||"";let i=r.split("/").filter(Boolean).length;i>gt&&o.push(`NESTING: Max depth exceeded - ${i} levels (max: ${gt})`)}if(/^index\.(ts|tsx|js)$/.test(n)&&!t.includes("/app/")&&!/\/(node_modules|dist|build)\//.test(t)&&o.push("BARREL: Barrel files (index.ts) are discouraged - import directly from source"),/\.(tsx|ts|jsx|js)$/.test(t)&&(/^[A-Z][a-zA-Z0-9]*\.(tsx|jsx)$/.test(n)&&(/(components\/|features\/|app\/|pages\/)/.test(t)||o.push("COMPONENT: React components must be in components/, features/, or app/")),/^use[A-Z][a-zA-Z0-9]*\.(ts|tsx)$/.test(n)&&(/(hooks\/|\/hooks\/)/.test(t)||o.push("HOOK: Custom hooks must be in hooks/ directory"))),t.endsWith(".py")){let r=t.substring(0,t.lastIndexOf("/"));/^(router_|routes_|api_).*\.py$/.test(n)&&!r.endsWith("/routers")&&!r.endsWith("routers")&&o.push("ROUTER: Router files must be in routers/ directory"),/_service\.py$/.test(n)&&!r.endsWith("/services")&&!r.endsWith("services")&&o.push("SERVICE: Service files must be in services/ directory"),/_(repository|repo)\.py$/.test(n)&&!r.endsWith("/repositories")&&!r.endsWith("repositories")&&o.push("REPOSITORY: Repository files must be in repositories/ directory")}if(o.length>0){let r=`Structure violation: ${o[0]}`;return g("structure-location-validator",`BLOCKED: ${r}`),m(r)}return c()}function We(s){return!!(/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(s)||/(^|\/)test_[^/]*\.py$/.test(s)||/_test\.py$/.test(s))}function yt(s){let e=b(s);if(e)return e;let t=s.tool_input.file_path||"";if(!t)return c();let o=t.split("/").pop()||"",n=We(t);if(n&&!/(tests\/|__tests__\/|\/test\/|test\/)/.test(t)){let r=`Test file must be in tests/, __tests__/, or test/ directory: ${o}`;return g("test-location-validator",`BLOCKED: ${r}`),m(r)}if(!n&&/(tests\/|__tests__\/|\/test\/)/.test(t)){let i=[/^(conftest|fixtures|factories|mocks|__init__|setup|helpers|utils)\.py$/,/^(setup|helpers|utils|mocks|fixtures)\.(ts|js)$/].some(u=>u.test(o)),a=/\/(fixtures|mocks|factories|__mocks__)\//.test(t);if(!i&&!a){let u=`Source files cannot be in test directories: ${o}`;return g("test-location-validator",`BLOCKED: ${u}`),m(u)}}if(/\.(ts|tsx|js|jsx)$/.test(t)&&/(tests\/|__tests__)/.test(t)){if(/^(setup|jest|vitest|config|helpers|utils|mocks)\./.test(o))return c();if(!/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(o)){let r=`Test files must use .test.ts or .spec.ts suffix: ${o}`;return g("test-location-validator",`BLOCKED: ${r}`),m(r)}}if(t.endsWith(".py")&&/(tests\/|\/test\/)/.test(t)){if(/^(conftest|__init__|fixtures|factories|mocks|helpers)\.py$/.test(o))return c();if(!/^test_.*\.py$/.test(o)&&!/_test\.py$/.test(o)){let r=`Python test files must be named test_*.py or *_test.py: ${o}`;return g("test-location-validator",`BLOCKED: ${r}`),m(r)}}return c()}function ze(s){return!!(/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(s)||/(^|\/)test_[^/]*\.py$/.test(s)||/_test\.py$/.test(s))}function kt(s){let e=s.tool_input?.file_path||"",t=s.tool_input?.content||s.tool_result||"";if(!e||!t)return c();if(!ze(e))return c();let o=[];if(/\.(ts|tsx|js|jsx)$/.test(e)){let n=t.match(/(test|it)\(['"][^'"]{1,10}['"]/g);n&&n.some(u=>/test[0-9]|works|^test$/i.test(u))&&(o.push("Test names too short or generic. Use descriptive names:"),o.push("  BAD:  test('test1'), test('works')"),o.push("  GOOD: test('should return user when ID exists')")),/^let [a-zA-Z_][a-zA-Z0-9_]* =/m.test(t)&&(/beforeEach\s*\(\s*(async\s*)?\(\s*\)\s*=>/.test(t)||(o.push("Shared mutable state detected without beforeEach reset:"),o.push("  Add beforeEach(() => { /* reset state */ }) to ensure test isolation")));let r=(t.match(/expect\(/g)||[]).length,i=(t.match(/(test|it)\s*\(/g)||[]).length||1,a=Math.floor(r/i);a>5&&(o.push(`High assertion count (avg ${a} per test):`),o.push("  Consider splitting into focused tests with 1-3 assertions each"),o.push("  Or add AAA comments (// Arrange, // Act, // Assert)")),/console\.(log|warn|error)\(/.test(t)&&(o.push("console.log found in test file:"),o.push("  Remove debugging statements before committing"),o.push("  Use proper assertions instead")),/(test|it|describe)\.only\(/.test(t)&&(o.push(".only() found - this skips other tests:"),o.push("  Remove .only() before committing")),/(test|it|describe)\.skip\(/.test(t)&&(/TODO|FIXME|skip.*because|temporarily/i.test(t)||(o.push(".skip() found without explanation:"),o.push("  Add a comment explaining why the test is skipped"),o.push("  Example: test.skip('reason: waiting for API fix')")))}return e.endsWith(".py")&&(/def test[A-Z]/.test(t)&&(o.push("Test names must use snake_case, not camelCase:"),o.push("  BAD:  def testUserCreation()"),o.push("  GOOD: def test_user_creation()")),/def (setUp|tearDown|setUpClass|tearDownClass)\s*\(/.test(t)&&(o.push("Use pytest fixtures instead of unittest setUp/tearDown:"),o.push("  BAD:  def setUp(self): ..."),o.push("  GOOD: @pytest.fixture\\n        def setup_data(): ...")),/class Test.*:/.test(t)&&(/^\s+[a-z_]+ = \[\]/m.test(t)||/^\s+[a-z_]+ = \{\}/m.test(t))&&(o.push("Class-level mutable defaults can cause test pollution:"),o.push("  BAD:  class TestUser:\\n            items = []"),o.push("  GOOD: Use @pytest.fixture to create fresh instances")),/^\s+print\(/m.test(t)&&(o.push("print() found in test file:"),o.push("  Remove debugging statements before committing"),o.push("  Use proper assertions or pytest's capfd fixture")),(/@pytest\.mark\.skip\s*$/.test(t)||/@pytest\.mark\.skip\(\s*\)/.test(t))&&(o.push("@pytest.mark.skip without reason:"),o.push("  Add reason: @pytest.mark.skip(reason='waiting for fix')")),/async def test_/.test(t)&&(/@pytest\.mark\.asyncio/.test(t)||(o.push("Async test found without @pytest.mark.asyncio:"),o.push("  Add: @pytest.mark.asyncio"),o.push("  Or set asyncio_mode = auto in pytest.ini")))),o.length>0?(g("test-pattern-validator",`BLOCKED: ${o[0]}`),m(`Test pattern violations detected in ${e}`)):c()}import{existsSync as _t}from"node:fs";import{execSync as C}from"node:child_process";function Ze(s){let e=s;for(;e!=="/";){if(_t(`${e}/package.json`))return e;e=e.substring(0,e.lastIndexOf("/"))}return null}function vt(s){let e=s.tool_input?.file_path||process.env.CC_TOOL_FILE_PATH||"";if(!e)return c();if(/test.*\.py$/.test(e)||/_test\.py$/.test(e)){process.stderr.write(`::group::Auto-running Python test: ${e.split("/").pop()}
`);let t=e.substring(0,e.lastIndexOf("/"));try{if(_t(`${t}/pyproject.toml`))try{C("command -v poetry",{stdio:["pipe","pipe","pipe"]});let n=C(`poetry run pytest "${e}" -v --tb=short`,{cwd:t,encoding:"utf8",timeout:6e4,stdio:["pipe","pipe","pipe"]}).split(`
`).slice(-30);process.stderr.write(n.join(`
`)+`
`)}catch{}try{C("command -v pytest",{stdio:["pipe","pipe","pipe"]});let n=C(`pytest "${e}" -v --tb=short`,{cwd:t,encoding:"utf8",timeout:6e4,stdio:["pipe","pipe","pipe"]}).split(`
`).slice(-30);process.stderr.write(n.join(`
`)+`
`)}catch{process.stderr.write(`pytest not found - skipping auto-run
`)}}catch(o){o instanceof Error&&process.stderr.write(`Test execution error: ${o.message}
`)}process.stderr.write(`::endgroup::
`)}if(/\.(test|spec)\.(ts|tsx|js|jsx)$/.test(e)){process.stderr.write(`::group::Auto-running TypeScript test: ${e.split("/").pop()}
`);let t=Ze(e.substring(0,e.lastIndexOf("/")));if(t)try{let o=e.split("/").pop()?.replace(/\.[^.]+$/,"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=C(`npm test -- --testPathPattern="${o}"`,{cwd:t,encoding:"utf8",timeout:6e4,stdio:["pipe","pipe","pipe"]}).split(`
`).slice(-30);process.stderr.write(r.join(`
`)+`
`)}catch(o){o instanceof Error&&process.stderr.write(`Test execution error: ${o.message}
`)}process.stderr.write(`::endgroup::
`)}return c()}var xt={"skill/backend-file-naming":V,"skill/backend-layer-validator":q,"skill/coverage-check":K,"skill/coverage-threshold-gate":Y,"skill/cross-instance-test-validator":J,"skill/decision-entity-extractor":X,"skill/design-decision-saver":Q,"skill/di-pattern-enforcer":tt,"skill/duplicate-code-detector":et,"skill/eval-metrics-collector":ot,"skill/evidence-collector":nt,"skill/import-direction-enforcer":rt,"skill/mem0-decision-saver":ct,"skill/merge-conflict-predictor":at,"skill/merge-readiness-checker":ut,"skill/migration-validator":pt,"skill/pattern-consistency-enforcer":lt,"skill/redact-secrets":ft,"skill/review-summary-generator":dt,"skill/security-summary":mt,"skill/structure-location-validator":ht,"skill/test-location-validator":yt,"skill/test-pattern-validator":kt,"skill/test-runner":vt};function wn(s){return xt[s]}function In(){return Object.keys(xt)}export{ps as escapeRegex,Ht as extractIssueNumber,E as getCurrentBranch,z as getDefaultBranch,as as getField,Tt as getGitStatus,wn as getHook,k as getLogDir,O as getPluginRoot,d as getProjectDir,$ as getRepoRoot,j as getSessionId,W as hasUncommittedChanges,xt as hooks,qe as isBashInput,Ye as isEditInput,ms as isGitRepo,Et as isProtectedBranch,Je as isReadInput,Ke as isWriteInput,In as listHooks,g as logHook,is as logPermissionFeedback,us as normalizeCommand,ss as outputAllowWithContext,m as outputBlock,rs as outputDeny,os as outputError,es as outputPromptContext,ts as outputSilentAllow,c as outputSilentSuccess,ns as outputWarning,_ as outputWithContext,cs as readHookInput,gs as validateBranchName};
//# sourceMappingURL=skill.mjs.map
