{
  "version": 3,
  "sources": ["../src/types.ts", "../src/lib/common.ts", "../src/lib/git.ts", "../src/lib/guards.ts", "../src/pretool/bash/dangerous-command-blocker.ts", "../src/pretool/bash/git-branch-protection.ts", "../src/pretool/bash/git-commit-message-validator.ts", "../src/pretool/bash/git-branch-naming-validator.ts", "../src/pretool/bash/git-atomic-commit-checker.ts", "../src/pretool/bash/compound-command-validator.ts", "../src/pretool/bash/default-timeout-setter.ts", "../src/pretool/bash/error-pattern-warner.ts", "../src/pretool/bash/conflict-predictor.ts", "../src/pretool/bash/affected-tests-finder.ts", "../src/pretool/bash/ci-simulation.ts", "../src/pretool/bash/pre-commit-simulation.ts", "../src/pretool/bash/pr-merge-gate.ts", "../src/pretool/bash/changelog-generator.ts", "../src/pretool/bash/version-sync.ts", "../src/pretool/bash/license-compliance.ts", "../src/pretool/bash/gh-issue-creation-guide.ts", "../src/pretool/bash/issue-docs-requirement.ts", "../src/pretool/bash/multi-instance-quality-gate.ts", "../src/pretool/bash/agent-browser-safety.ts", "../src/pretool/write-edit/file-guard.ts", "../src/pretool/write-edit/file-lock-check.ts", "../src/pretool/write-edit/multi-instance-lock.ts", "../src/pretool/Write/architecture-change-detector.ts", "../src/pretool/Write/code-quality-gate.ts", "../src/pretool/Write/docstring-enforcer.ts", "../src/pretool/Write/security-pattern-validator.ts", "../src/pretool/mcp/context7-tracker.ts", "../src/pretool/mcp/memory-fabric-init.ts", "../src/pretool/mcp/memory-validator.ts", "../src/pretool/mcp/sequential-thinking-auto.ts", "../src/pretool/input-mod/write-headers.ts", "../src/pretool/skill/skill-tracker.ts", "../src/entries/pretool.ts"],
  "sourcesContent": ["/**\n * TypeScript type definitions for Claude Code hooks\n * CC 2.1.9 compliant with additionalContext support\n */\n\n/**\n * Hook events supported by Claude Code\n */\nexport type HookEvent =\n  | 'PreToolUse'\n  | 'PostToolUse'\n  | 'PermissionRequest'\n  | 'UserPromptSubmit'\n  | 'SessionStart'\n  | 'SessionEnd'\n  | 'Stop'\n  | 'SubagentStart'\n  | 'SubagentStop'\n  | 'Setup'\n  | 'Notification';\n\n/**\n * Hook input envelope from Claude Code (sent via stdin as JSON)\n */\nexport interface HookInput {\n  /** The hook event type */\n  hook_event?: HookEvent;\n  /** The tool being invoked */\n  tool_name: string;\n  /** Session ID (CC 2.1.9 guarantees availability) */\n  session_id: string;\n  /** Tool-specific input parameters */\n  tool_input: ToolInput;\n  /** Tool output (PostToolUse only) */\n  tool_output?: unknown;\n  /** Tool error message if any */\n  tool_error?: string;\n  /** Tool exit code */\n  exit_code?: number;\n  /** User prompt (UserPromptSubmit only) */\n  prompt?: string;\n  /** Project directory */\n  project_dir?: string;\n\n  // SubagentStart/SubagentStop specific fields\n  /** Agent type for subagent hooks */\n  subagent_type?: string;\n  /** Agent type (alternative field name) */\n  agent_type?: string;\n  /** Agent ID */\n  agent_id?: string;\n  /** Agent output (SubagentStop) */\n  agent_output?: string;\n  /** Output (alternative field name) */\n  output?: string;\n  /** Error from subagent */\n  error?: string;\n  /** Duration in milliseconds */\n  duration_ms?: number;\n  /** Tool result (SubagentStop) */\n  tool_result?: string;\n\n  // Notification specific fields\n  /** Notification message */\n  message?: string;\n  /** Notification type */\n  notification_type?: string;\n}\n\n/**\n * Tool input types - union of all tool inputs\n */\nexport interface ToolInput {\n  /** Bash command (Bash tool) */\n  command?: string;\n  /** Timeout in ms (Bash tool) */\n  timeout?: number;\n  /** File path (Write/Edit/Read tools) */\n  file_path?: string;\n  /** File content (Write tool) */\n  content?: string;\n  /** Old text to replace (Edit tool) */\n  old_string?: string;\n  /** New text (Edit tool) */\n  new_string?: string;\n  /** Pattern (Glob/Grep tools) */\n  pattern?: string;\n  /** Allow additional properties */\n  [key: string]: unknown;\n}\n\n/**\n * Hook-specific output for CC 2.1.9\n */\nexport interface HookSpecificOutput {\n  /** Hook event name for context */\n  hookEventName?: 'PreToolUse' | 'PostToolUse' | 'PermissionRequest' | 'UserPromptSubmit';\n  /** Permission decision (PermissionRequest hooks) */\n  permissionDecision?: 'allow' | 'deny';\n  /** Reason for permission decision */\n  permissionDecisionReason?: string;\n  /** Additional context injected before tool execution (CC 2.1.9) */\n  additionalContext?: string;\n}\n\n/**\n * Hook result - output JSON to stdout\n * CC 2.1.7+ compliant\n */\nexport interface HookResult {\n  /** Whether to continue execution */\n  continue: boolean;\n  /** Suppress hook output from user */\n  suppressOutput?: boolean;\n  /** System message shown to user */\n  systemMessage?: string;\n  /** Reason for stopping (when continue is false) */\n  stopReason?: string;\n  /** Hook-specific output fields */\n  hookSpecificOutput?: HookSpecificOutput;\n}\n\n/**\n * Hook function signature\n */\nexport type HookFn = (input: HookInput) => Promise<HookResult> | HookResult;\n\n/**\n * Hook registration entry\n */\nexport interface HookRegistration {\n  /** Hook name (e.g., 'permission/auto-approve-readonly') */\n  name: string;\n  /** Hook event type */\n  event: HookEvent;\n  /** Tool matcher (string pattern or regex) */\n  matcher?: string | RegExp;\n  /** Hook implementation function */\n  fn: HookFn;\n}\n\n/**\n * Bash tool input (type guard helper)\n */\nexport interface BashToolInput extends ToolInput {\n  command: string;\n  timeout?: number;\n}\n\n/**\n * Write tool input (type guard helper)\n */\nexport interface WriteToolInput extends ToolInput {\n  file_path: string;\n  content: string;\n}\n\n/**\n * Edit tool input (type guard helper)\n */\nexport interface EditToolInput extends ToolInput {\n  file_path: string;\n  old_string: string;\n  new_string: string;\n}\n\n/**\n * Read tool input (type guard helper)\n */\nexport interface ReadToolInput extends ToolInput {\n  file_path: string;\n  offset?: number;\n  limit?: number;\n}\n\n/**\n * Type guards for tool inputs\n */\nexport function isBashInput(input: ToolInput): input is BashToolInput {\n  return typeof input.command === 'string';\n}\n\nexport function isWriteInput(input: ToolInput): input is WriteToolInput {\n  return typeof input.file_path === 'string' && typeof input.content === 'string';\n}\n\nexport function isEditInput(input: ToolInput): input is EditToolInput {\n  return (\n    typeof input.file_path === 'string' &&\n    typeof input.old_string === 'string' &&\n    typeof input.new_string === 'string'\n  );\n}\n\nexport function isReadInput(input: ToolInput): input is ReadToolInput {\n  return typeof input.file_path === 'string' && input.content === undefined;\n}\n", "/**\n * Common utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh\n */\n\nimport { appendFileSync, existsSync, statSync, renameSync, mkdirSync } from 'node:fs';\nimport type { HookResult, HookInput } from '../types.js';\n\n// -----------------------------------------------------------------------------\n// Environment and Paths\n// All functions read env vars dynamically to support testing\n// -----------------------------------------------------------------------------\n\n/**\n * Get the log directory path\n */\nexport function getLogDir(): string {\n  if (process.env.CLAUDE_PLUGIN_ROOT) {\n    return `${process.env.HOME}/.claude/logs/ork`;\n  }\n  return `${getProjectDir()}/.claude/logs`;\n}\n\n/**\n * Get the project directory\n * Read dynamically to support testing\n */\nexport function getProjectDir(): string {\n  return process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the plugin root directory\n * Read dynamically to support testing\n */\nexport function getPluginRoot(): string {\n  return process.env.CLAUDE_PLUGIN_ROOT || process.env.CLAUDE_PROJECT_DIR || '.';\n}\n\n/**\n * Get the session ID\n * CC 2.1.9+ should guarantee CLAUDE_SESSION_ID availability, but we add\n * a defensive fallback to prevent hook crashes during edge cases.\n * Read dynamically to support testing.\n */\nexport function getSessionId(): string {\n  return process.env.CLAUDE_SESSION_ID || `fallback-${process.pid}-${Date.now()}`;\n}\n\n// -----------------------------------------------------------------------------\n// Output Helpers (CC 2.1.7+ compliant)\n// -----------------------------------------------------------------------------\n\n/**\n * Output silent success - hook completed without errors, no user-visible output\n */\nexport function outputSilentSuccess(): HookResult {\n  return { continue: true, suppressOutput: true };\n}\n\n/**\n * Output silent allow - permission hook approves silently\n */\nexport function outputSilentAllow(): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: { permissionDecision: 'allow' },\n  };\n}\n\n/**\n * Output block - stops the operation with an error\n */\nexport function outputBlock(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n/**\n * Output with additionalContext - injects context before tool execution (CC 2.1.9)\n * For PostToolUse hooks (hookEventName optional)\n */\nexport function outputWithContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PostToolUse',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output with additionalContext for UserPromptSubmit hooks (CC 2.1.9)\n * hookEventName is REQUIRED for UserPromptSubmit\n */\nexport function outputPromptContext(ctx: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'UserPromptSubmit',\n      additionalContext: ctx,\n    },\n  };\n}\n\n/**\n * Output allow with additionalContext - permission hook approves with context (CC 2.1.9)\n */\nexport function outputAllowWithContext(ctx: string, systemMessage?: string): HookResult {\n  const result: HookResult = {\n    continue: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      additionalContext: ctx,\n      permissionDecision: 'allow',\n    },\n  };\n\n  if (systemMessage) {\n    result.systemMessage = systemMessage;\n  } else {\n    result.suppressOutput = true;\n  }\n\n  return result;\n}\n\n/**\n * Output error message - only use when there's an actual problem\n */\nexport function outputError(message: string): HookResult {\n  return { continue: true, systemMessage: message };\n}\n\n/**\n * Output warning message - CC 2.1.7 compliant (no ANSI in JSON)\n */\nexport function outputWarning(message: string): HookResult {\n  return { continue: true, systemMessage: `\\u26a0 ${message}` };\n}\n\n/**\n * Output deny with feedback logging (CC 2.1.7)\n */\nexport function outputDeny(reason: string): HookResult {\n  return {\n    continue: false,\n    stopReason: reason,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'deny',\n      permissionDecisionReason: reason,\n    },\n  };\n}\n\n// -----------------------------------------------------------------------------\n// Logging\n// -----------------------------------------------------------------------------\n\nconst LOG_ROTATION_MAX_SIZE = 200 * 1024; // 200KB\nconst PERMISSION_LOG_MAX_SIZE = 100 * 1024; // 100KB\n\n/**\n * Rotate log file if it exceeds size limit\n */\nfunction rotateLogFile(logFile: string, maxSize: number): void {\n  if (!existsSync(logFile)) return;\n\n  try {\n    const stats = statSync(logFile);\n    if (stats.size > maxSize) {\n      const rotated = `${logFile}.old.${Date.now()}`;\n      renameSync(logFile, rotated);\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n}\n\n/**\n * Log to hook log file with automatic rotation\n */\nexport function logHook(hookName: string, message: string): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/hooks.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, LOG_ROTATION_MAX_SIZE);\n\n    const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);\n    appendFileSync(logFile, `[${timestamp}] [${hookName}] ${message}\\n`);\n  } catch {\n    // Ignore logging errors - don't block hook execution\n  }\n}\n\n/**\n * Log permission decision for audit trail (CC 2.1.7 feature)\n */\nexport function logPermissionFeedback(\n  decision: 'allow' | 'deny' | 'warn',\n  reason: string,\n  input?: HookInput\n): void {\n  const logDir = getLogDir();\n  const logFile = `${logDir}/permission-feedback.log`;\n\n  try {\n    ensureDir(logDir);\n    rotateLogFile(logFile, PERMISSION_LOG_MAX_SIZE);\n\n    const timestamp = new Date().toISOString();\n    const toolName = input?.tool_name || process.env.HOOK_TOOL_NAME || 'unknown';\n    const sessionId = input?.session_id || getSessionId();\n\n    appendFileSync(\n      logFile,\n      `${timestamp} | ${decision} | ${reason} | tool=${toolName} | session=${sessionId}\\n`\n    );\n  } catch {\n    // Ignore logging errors\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Input Helpers\n// -----------------------------------------------------------------------------\n\n/**\n * Read hook input from stdin synchronously\n * Returns parsed JSON or empty object on failure\n */\nexport function readHookInput(): HookInput {\n  try {\n    // Read from stdin synchronously\n    const chunks: Buffer[] = [];\n    const BUFSIZE = 256;\n    const buf = Buffer.allocUnsafe(BUFSIZE);\n\n    let bytesRead: number;\n    const fd = 0; // stdin\n\n    // Use fs.readSync for synchronous stdin reading\n    const { readSync } = require('node:fs');\n    while (true) {\n      try {\n        bytesRead = readSync(fd, buf, 0, BUFSIZE, null);\n        if (bytesRead === 0) break;\n        chunks.push(Buffer.from(buf.subarray(0, bytesRead)));\n      } catch {\n        break;\n      }\n    }\n\n    const input = Buffer.concat(chunks).toString('utf8').trim();\n    if (!input) {\n      return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n    }\n\n    return JSON.parse(input);\n  } catch {\n    return { tool_name: '', session_id: getSessionId(), tool_input: {} };\n  }\n}\n\n/**\n * Get field from hook input using optional chaining\n */\nexport function getField<T>(input: HookInput, path: string): T | undefined {\n  const parts = path.replace(/^\\./, '').split('.');\n  let value: unknown = input;\n\n  for (const part of parts) {\n    if (value === null || value === undefined) return undefined;\n    value = (value as Record<string, unknown>)[part];\n  }\n\n  return value as T;\n}\n\n// -----------------------------------------------------------------------------\n// String Utilities\n// -----------------------------------------------------------------------------\n\n/**\n * Normalize command: remove line continuations and collapse whitespace\n * Prevents bypassing detection with backslash-newline tricks (CC 2.1.6 fix)\n */\nexport function normalizeCommand(command: string): string {\n  return command\n    .replace(/\\\\\\s*[\\r\\n]+/g, ' ') // Remove line continuations\n    .replace(/\\n/g, ' ') // Replace newlines with spaces\n    .replace(/\\s+/g, ' ') // Collapse whitespace\n    .trim();\n}\n\n/**\n * Escape string for use in regex\n */\nexport function escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n", "/**\n * Git utilities for TypeScript hooks\n * Ported from hooks/_lib/common.sh git functions\n */\n\nimport { execSync } from 'node:child_process';\nimport { getProjectDir } from './common.js';\n\n/**\n * Get the current git branch\n */\nexport function getCurrentBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git branch --show-current', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return 'unknown';\n  }\n}\n\n/**\n * Check if on a protected branch (dev, main, master)\n */\nexport function isProtectedBranch(branch?: string): boolean {\n  const currentBranch = branch || getCurrentBranch();\n  return ['dev', 'main', 'master'].includes(currentBranch);\n}\n\n/**\n * Get the repository root directory\n */\nexport function getRepoRoot(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git rev-parse --show-toplevel', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return dir;\n  }\n}\n\n/**\n * Check if path is inside a git repository\n */\nexport function isGitRepo(projectDir?: string): boolean {\n  const dir = projectDir || getProjectDir();\n  try {\n    execSync('git rev-parse --git-dir', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get git status (short format)\n */\nexport function getGitStatus(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    return execSync('git status --short', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 10000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    }).trim();\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Check if there are uncommitted changes\n */\nexport function hasUncommittedChanges(projectDir?: string): boolean {\n  return getGitStatus(projectDir).length > 0;\n}\n\n/**\n * Get the default branch (main or master)\n */\nexport function getDefaultBranch(projectDir?: string): string {\n  const dir = projectDir || getProjectDir();\n  try {\n    // Check if 'main' exists\n    execSync('git rev-parse --verify main', {\n      cwd: dir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n    return 'main';\n  } catch {\n    try {\n      // Check if 'master' exists\n      execSync('git rev-parse --verify master', {\n        cwd: dir,\n        encoding: 'utf8',\n        timeout: 5000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      });\n      return 'master';\n    } catch {\n      return 'main'; // Default to main\n    }\n  }\n}\n\n/**\n * Extract issue number from branch name\n * Supports patterns like: issue/123-description, feature/123, fix-123\n */\nexport function extractIssueNumber(branch: string): number | null {\n  // Match common patterns\n  const patterns = [\n    /issue\\/(\\d+)/i,\n    /feature\\/(\\d+)/i,\n    /fix\\/(\\d+)/i,\n    /bug\\/(\\d+)/i,\n    /feat\\/(\\d+)/i,\n    /^(\\d+)-/,\n    /-(\\d+)$/,\n    /#(\\d+)/,\n  ];\n\n  for (const pattern of patterns) {\n    const match = branch.match(pattern);\n    if (match) {\n      return parseInt(match[1], 10);\n    }\n  }\n\n  return null;\n}\n\n/**\n * Validate branch name format\n * Returns error message if invalid, null if valid\n */\nexport function validateBranchName(branch: string): string | null {\n  // Skip validation for protected branches\n  if (isProtectedBranch(branch)) {\n    return null;\n  }\n\n  // Valid prefixes\n  const validPrefixes = [\n    'issue/',\n    'feature/',\n    'fix/',\n    'bug/',\n    'feat/',\n    'chore/',\n    'docs/',\n    'refactor/',\n    'test/',\n    'ci/',\n    'perf/',\n    'style/',\n    'release/',\n    'hotfix/',\n  ];\n\n  const hasValidPrefix = validPrefixes.some((prefix) => branch.startsWith(prefix));\n  if (!hasValidPrefix) {\n    return `Branch name should start with a valid prefix: ${validPrefixes.join(', ')}`;\n  }\n\n  // Check for issue number in issue/ branches\n  if (branch.startsWith('issue/') && !extractIssueNumber(branch)) {\n    return 'issue/ branches should include an issue number (e.g., issue/123-description)';\n  }\n\n  return null;\n}\n", "/**\n * Self-guard helpers for TypeScript hooks\n * Ported from hooks/_lib/common.sh guard functions\n *\n * Guards are predicates that determine if a hook should run.\n * They return `true` to run the hook, `false` to skip it.\n */\n\nimport type { HookInput, HookResult } from '../types.js';\nimport { outputSilentSuccess } from './common.js';\n\n/**\n * Guard result type - either continue (null) or skip with result\n */\nexport type GuardResult = HookResult | null;\n\n/**\n * Create a guard that returns silent success if predicate fails\n */\nexport function createGuard(\n  predicate: (input: HookInput) => boolean\n): (input: HookInput) => GuardResult {\n  return (input: HookInput) => (predicate(input) ? null : outputSilentSuccess());\n}\n\n// -----------------------------------------------------------------------------\n// File Extension Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for specific file extensions\n */\nexport function guardFileExtension(\n  input: HookInput,\n  ...extensions: string[]\n): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  const ext = filePath.split('.').pop()?.toLowerCase() || '';\n  const normalizedExtensions = extensions.map((e) => e.toLowerCase().replace(/^\\./, ''));\n\n  if (normalizedExtensions.includes(ext)) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Only run for code files\n */\nexport function guardCodeFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'py', 'ts', 'tsx', 'js', 'jsx', 'go', 'rs', 'java');\n}\n\n/**\n * Guard: Only run for Python files\n */\nexport function guardPythonFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'py');\n}\n\n/**\n * Guard: Only run for TypeScript/JavaScript files\n */\nexport function guardTypescriptFiles(input: HookInput): GuardResult {\n  return guardFileExtension(input, 'ts', 'tsx', 'js', 'jsx');\n}\n\n// -----------------------------------------------------------------------------\n// Path Pattern Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for test files\n */\nexport function guardTestFiles(input: HookInput): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  const testPatterns = [/test/i, /spec/i, /__tests__/i];\n  if (testPatterns.some((p) => p.test(filePath))) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Skip internal/generated files\n */\nexport function guardSkipInternal(input: HookInput): GuardResult {\n  const filePath = input.tool_input.file_path || '';\n  if (!filePath) return null; // No file path, continue\n\n  // Skip these directories/patterns\n  const skipPatterns = [\n    /\\/\\.claude\\//,\n    /\\/node_modules\\//,\n    /\\/\\.git\\//,\n    /\\/dist\\//,\n    /\\/build\\//,\n    /\\/__pycache__\\//,\n    /\\/\\.venv\\//,\n    /\\/venv\\//,\n    /\\.lock$/,\n  ];\n\n  if (skipPatterns.some((p) => p.test(filePath))) {\n    return outputSilentSuccess();\n  }\n\n  return null; // Continue with hook\n}\n\n/**\n * Guard: Only run for files matching path patterns\n */\nexport function guardPathPattern(input: HookInput, ...patterns: (string | RegExp)[]): GuardResult {\n  const filePath = input.tool_input.file_path;\n  if (!filePath) return outputSilentSuccess();\n\n  for (const pattern of patterns) {\n    if (typeof pattern === 'string') {\n      // Simple glob-like matching\n      const regex = new RegExp(pattern.replace(/\\*/g, '.*').replace(/\\?/g, '.'));\n      if (regex.test(filePath)) return null;\n    } else {\n      if (pattern.test(filePath)) return null;\n    }\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Tool Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for specific tool names\n */\nexport function guardTool(input: HookInput, ...tools: string[]): GuardResult {\n  const toolName = input.tool_name;\n  if (!toolName) return outputSilentSuccess();\n\n  if (tools.includes(toolName)) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n/**\n * Guard: Only run for Write or Edit tools\n */\nexport function guardWriteEdit(input: HookInput): GuardResult {\n  return guardTool(input, 'Write', 'Edit');\n}\n\n/**\n * Guard: Only run for Bash tool\n */\nexport function guardBash(input: HookInput): GuardResult {\n  return guardTool(input, 'Bash');\n}\n\n// -----------------------------------------------------------------------------\n// Command Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run for non-trivial bash commands\n */\nexport function guardNontrivialBash(input: HookInput): GuardResult {\n  const command = input.tool_input.command || '';\n\n  // Skip trivial commands\n  const trivialPatterns = [\n    /^echo\\s/,\n    /^ls(\\s|$)/,\n    /^pwd$/,\n    /^cat\\s/,\n    /^head\\s/,\n    /^tail\\s/,\n    /^wc\\s/,\n    /^date$/,\n    /^whoami$/,\n  ];\n\n  if (trivialPatterns.some((p) => p.test(command))) {\n    return outputSilentSuccess();\n  }\n\n  return null; // Continue with hook\n}\n\n/**\n * Guard: Only run for git commands\n */\nexport function guardGitCommand(input: HookInput): GuardResult {\n  const command = input.tool_input.command || '';\n\n  if (command.startsWith('git')) {\n    return null; // Continue with hook\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Environment Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Guard: Only run if multi-instance coordination is enabled\n */\nexport function guardMultiInstance(input: HookInput): GuardResult {\n  const projectDir = input.project_dir || process.env.CLAUDE_PROJECT_DIR || '.';\n  const dbPath = `${projectDir}/.claude/coordination/.claude.db`;\n\n  try {\n    const { existsSync } = require('node:fs');\n    if (existsSync(dbPath)) {\n      return null; // Continue with hook\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return outputSilentSuccess();\n}\n\n// -----------------------------------------------------------------------------\n// Composite Guards\n// -----------------------------------------------------------------------------\n\n/**\n * Run multiple guards in sequence, return first skip result or null to continue\n */\nexport function runGuards(input: HookInput, ...guards: ((input: HookInput) => GuardResult)[]): GuardResult {\n  for (const guard of guards) {\n    const result = guard(input);\n    if (result !== null) {\n      return result; // Skip with this result\n    }\n  }\n  return null; // All guards passed, continue\n}\n", "/**\n * Dangerous Command Blocker - Blocks commands matching dangerous patterns\n * Hook: PreToolUse (Bash)\n * CC 2.1.7 Compliant: outputs JSON with continue field\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  normalizeCommand,\n} from '../../lib/common.js';\n\n/**\n * Dangerous patterns - commands that can cause catastrophic system damage\n */\nconst DANGEROUS_PATTERNS: string[] = [\n  'rm -rf /',\n  'rm -rf ~',\n  'rm -fr /',\n  'rm -fr ~',\n  '> /dev/sda',\n  'mkfs.',\n  'chmod -R 777 /',\n  'dd if=/dev/zero of=/dev/',\n  'dd if=/dev/random of=/dev/',\n  ':(){:|:&};:', // Fork bomb\n  'mv /* /dev/null',\n  'wget.*|.*sh',\n  'curl.*|.*sh',\n];\n\n/**\n * Block dangerous commands\n */\nexport function dangerousCommandBlocker(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Normalize: remove line continuations and collapse whitespace\n  const normalizedCommand = normalizeCommand(command);\n\n  // Check command against each dangerous pattern\n  for (const pattern of DANGEROUS_PATTERNS) {\n    if (normalizedCommand.includes(pattern)) {\n      logHook('dangerous-command-blocker', `BLOCKED: Dangerous pattern: ${pattern}`);\n      logPermissionFeedback('deny', `Dangerous pattern: ${pattern}`, input);\n\n      return outputDeny(\n        `Command matches dangerous pattern: ${pattern}\\n\\n` +\n          'This command could cause severe system damage and has been blocked.'\n      );\n    }\n  }\n\n  // Command is safe, allow it silently\n  return outputSilentSuccess();\n}\n", "/**\n * Git Branch Protection Hook\n * Prevents commits and pushes to dev/main branches\n * CC 2.1.9 Enhanced: injects additionalContext before git commands\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\nimport { getCurrentBranch, isProtectedBranch } from '../../lib/git.js';\n\n/**\n * Protect dev/main/master branches from direct commits/pushes\n */\nexport function gitBranchProtection(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Check if this is a git command\n  if (!command.startsWith('git')) {\n    return outputSilentSuccess();\n  }\n\n  // Get current branch\n  const currentBranch = getCurrentBranch(input.project_dir);\n\n  // Check if on a protected branch\n  if (isProtectedBranch(currentBranch)) {\n    // Check if command is commit or push\n    if (/git\\s+commit/.test(command) || /git\\s+push/.test(command)) {\n      const errorMsg = `BLOCKED: Cannot commit or push directly to '${currentBranch}' branch.\n\nYou are currently on branch: ${currentBranch}\n\nRequired workflow:\n1. Create a feature branch:\n   git checkout -b issue/<number>-<description>\n\n2. Make your changes and commit:\n   git add .\n   git commit -m \"feat(#<number>): Description\"\n\n3. Push the feature branch:\n   git push -u origin issue/<number>-<description>\n\n4. Create a pull request:\n   gh pr create --base dev\n\nAborting command to protect ${currentBranch} branch.`;\n\n      logPermissionFeedback('deny', `Blocked ${command} on protected branch ${currentBranch}`, input);\n      logHook('git-branch-protection', `BLOCKED: ${command} on ${currentBranch}`);\n\n      return outputDeny(errorMsg);\n    }\n\n    // CC 2.1.9: On protected branch but not commit/push - inject warning context\n    const branchContext = `Branch: ${currentBranch} (PROTECTED). Direct commits blocked. Create feature branch for changes: git checkout -b issue/<number>-<desc>`;\n    logPermissionFeedback('allow', `Git command on protected branch: ${command}`, input);\n    return outputWithContext(branchContext);\n  }\n\n  // CC 2.1.9: On feature branch with commit/push/merge - inject helpful context\n  if (/git\\s+(commit|push|merge)/.test(command)) {\n    const branchContext = `Branch: ${currentBranch}. Protected: dev, main, master. PR workflow: push to feature branch, then gh pr create --base dev`;\n    logPermissionFeedback('allow', `Git command allowed: ${command}`, input);\n    return outputWithContext(branchContext);\n  }\n\n  // Allow other git operations (fetch, pull, status, etc.) without context injection\n  logPermissionFeedback('allow', `Git command allowed: ${command}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Git Commit Message Validator Hook\n * Enforces conventional commit format: type(#issue): description\n * CC 2.1.9: Injects guidance via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Valid conventional commit types\n */\nconst VALID_TYPES = ['feat', 'fix', 'refactor', 'docs', 'test', 'chore', 'style', 'perf', 'ci', 'build'];\n\n/**\n * Extract commit message from git commit command\n */\nfunction extractCommitMessage(command: string): string | null {\n  // Pattern: git commit -m \"msg\" or git commit -m 'msg'\n  const quotedMatch = command.match(/-m\\s+[\"']([^\"']+)[\"']/);\n  if (quotedMatch) {\n    return quotedMatch[1];\n  }\n\n  // Pattern: git commit -m msg (unquoted single word)\n  const unquotedMatch = command.match(/-m\\s+(\\S+)/);\n  if (unquotedMatch) {\n    return unquotedMatch[1];\n  }\n\n  return null;\n}\n\n/**\n * Validate commit message follows conventional commit format\n */\nexport function gitCommitMessageValidator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process git commit commands\n  if (!/^git\\s+commit/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check for heredoc pattern\n  if (/<<['\"]?EOF/.test(command)) {\n    const context = `Commit via heredoc detected. Ensure format: type(#issue): description\n\nAllowed types: ${VALID_TYPES.join(', ')}\nExample: feat(#123): Add user authentication\n\nCommit MUST end with:\nCo-Authored-By: Claude <noreply@anthropic.com>`;\n\n    logPermissionFeedback('allow', 'Heredoc commit - injecting format guidance', input);\n    return outputAllowWithContext(context);\n  }\n\n  // Extract commit message\n  const commitMsg = extractCommitMessage(command);\n\n  // No message found (probably interactive commit) - allow with guidance\n  if (!commitMsg) {\n    const context = `Interactive commit detected. Use conventional format:\ntype(#issue): description\n\nTypes: ${VALID_TYPES.join('|')}`;\n\n    logPermissionFeedback('allow', 'Interactive commit - injecting guidance', input);\n    return outputAllowWithContext(context);\n  }\n\n  // Validate commit message format\n  // Pattern: type(#issue): description OR type: description OR type(scope): description\n  const typesPattern = VALID_TYPES.join('|');\n  const conventionalPattern = new RegExp(`^(${typesPattern})(\\\\(#?[0-9]+\\\\)|(\\\\([a-z-]+\\\\)))?: .+`);\n  const simplePattern = new RegExp(`^(${typesPattern}): .+`);\n\n  if (conventionalPattern.test(commitMsg) || simplePattern.test(commitMsg)) {\n    // Valid format - check title length\n    const titleLine = commitMsg.split('\\n')[0];\n    const titleLen = titleLine.length;\n\n    if (titleLen > 72) {\n      const context = `Commit message title is ${titleLen} chars (recommended: <72).\nConsider shortening: ${titleLine.slice(0, 50)}...`;\n      logPermissionFeedback('allow', `Valid commit but long title (${titleLen} chars)`, input);\n      return outputAllowWithContext(context);\n    }\n\n    // All good\n    logPermissionFeedback('allow', `Valid conventional commit: ${commitMsg}`, input);\n    logHook('git-commit-message-validator', `Valid: ${commitMsg}`);\n    return outputSilentSuccess();\n  }\n\n  // Invalid format - BLOCK with guidance\n  const errorMsg = `INVALID COMMIT MESSAGE FORMAT\n\nYour message: \"${commitMsg}\"\n\nRequired format: type(#issue): description\n\nAllowed types:\n  feat     - New feature\n  fix      - Bug fix\n  refactor - Code restructuring\n  docs     - Documentation only\n  test     - Adding/updating tests\n  chore    - Build process, deps\n  style    - Formatting, whitespace\n  perf     - Performance improvement\n  ci       - CI/CD changes\n  build    - Build system changes\n\nExamples:\n  feat(#123): Add user authentication\n  fix(#456): Resolve login redirect loop\n  refactor: Extract validation helpers\n  docs: Update API documentation\n\nPlease update your commit message to follow conventional format.`;\n\n  logPermissionFeedback('deny', `Invalid commit format: ${commitMsg}`, input);\n  logHook('git-commit-message-validator', `Invalid: ${commitMsg}`);\n\n  return outputDeny(errorMsg);\n}\n", "/**\n * Git Branch Naming Validator Hook\n * Validates branch names follow conventions (issue/123-description)\n * CC 2.1.9: Injects guidance via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\nimport { validateBranchName } from '../../lib/git.js';\n\n/**\n * Validate branch names on checkout -b commands\n */\nexport function gitBranchNamingValidator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process git checkout -b or git branch commands\n  if (!/git\\s+(checkout\\s+-b|branch\\s+)/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract branch name\n  let branchName: string | null = null;\n\n  // git checkout -b <branch>\n  const checkoutMatch = command.match(/checkout\\s+-b\\s+(\\S+)/);\n  if (checkoutMatch) {\n    branchName = checkoutMatch[1];\n  }\n\n  // git branch <branch>\n  const branchMatch = command.match(/git\\s+branch\\s+(\\S+)/);\n  if (branchMatch && !branchName) {\n    branchName = branchMatch[1];\n  }\n\n  if (!branchName) {\n    return outputSilentSuccess();\n  }\n\n  // Validate branch name\n  const validationError = validateBranchName(branchName);\n\n  if (validationError) {\n    const context = `Branch naming: ${validationError}\n\nRecommended formats:\n  issue/123-description\n  feature/user-auth\n  fix/login-bug\n  chore/update-deps\n\nExample: git checkout -b issue/123-add-user-auth`;\n\n    logPermissionFeedback('allow', `Branch naming guidance: ${branchName}`, input);\n    logHook('git-branch-naming-validator', `Guidance for: ${branchName}`);\n    return outputAllowWithContext(context);\n  }\n\n  // Valid branch name\n  logPermissionFeedback('allow', `Valid branch name: ${branchName}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Git Atomic Commit Checker Hook\n * Warns when committing too many changes in a single commit\n * CC 2.1.9: Injects guidance via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\nimport { getGitStatus } from '../../lib/git.js';\n\n/**\n * Thresholds for atomic commit warnings\n */\nconst STAGED_FILE_WARNING_THRESHOLD = 10;\nconst CHANGED_LINE_WARNING_THRESHOLD = 500;\n\n/**\n * Check for atomic commits (not too many changes)\n */\nexport function gitAtomicCommitChecker(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process git commit commands\n  if (!/^git\\s+commit/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get git status\n  const status = getGitStatus(input.project_dir);\n  const stagedFiles = status.split('\\n').filter((line) => line.trim().length > 0);\n  const stagedCount = stagedFiles.length;\n\n  if (stagedCount > STAGED_FILE_WARNING_THRESHOLD) {\n    const context = `Large commit detected: ${stagedCount} files staged.\n\nAtomic commits are easier to review, revert, and understand.\nConsider splitting into smaller, focused commits:\n  - Group related changes together\n  - One feature/fix per commit\n  - Max 5-10 files per commit recommended\n\nContinue if this is intentional (refactoring, deps update, etc.)`;\n\n    logPermissionFeedback('allow', `Large commit: ${stagedCount} files`, input);\n    logHook('git-atomic-commit-checker', `Warning: ${stagedCount} files`);\n    return outputAllowWithContext(context);\n  }\n\n  // Small commit, all good\n  logPermissionFeedback('allow', 'Atomic commit check passed', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Compound Command Validator Hook\n * Validates multi-command sequences for security\n * CC 2.1.7: Detects dangerous patterns in compound commands (&&, ||, |, ;)\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  normalizeCommand,\n} from '../../lib/common.js';\n\n/**\n * Dangerous segment patterns\n */\nconst DANGEROUS_SEGMENTS = [\n  'rm -rf /',\n  'rm -rf ~',\n  'rm -fr /',\n  'rm -fr ~',\n  'mkfs',\n  'dd if=/dev',\n  '> /dev/sd',\n  'chmod -R 777 /',\n];\n\n/**\n * Validate a single segment of a compound command\n */\nfunction validateSegment(segment: string): boolean {\n  const trimmed = segment.trim();\n  if (!trimmed) return true;\n\n  for (const pattern of DANGEROUS_SEGMENTS) {\n    if (trimmed.includes(pattern)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Validate compound command and return blocking reason if dangerous\n */\nfunction validateCompoundCommand(command: string): string | null {\n  // Check for pipe-to-shell patterns BEFORE splitting\n  if (/curl.*\\|.*(sh|bash)/.test(command) || /wget.*\\|.*(sh|bash)/.test(command)) {\n    return 'pipe-to-shell execution (curl/wget piped to sh/bash)';\n  }\n\n  // Check if command contains compound operators\n  if (!command.includes('&&') && !command.includes('||') && !command.includes('|') && !command.includes(';')) {\n    return null; // Not a compound command\n  }\n\n  // Split on operators and check each segment\n  const segments = command.split(/&&|\\|\\||[|;]/);\n\n  for (const segment of segments) {\n    if (!validateSegment(segment)) {\n      return segment.trim();\n    }\n  }\n\n  return null;\n}\n\n/**\n * Validate compound commands for dangerous patterns\n */\nexport function compoundCommandValidator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Normalize command: remove line continuations\n  const normalizedCommand = normalizeCommand(command);\n\n  // Validate\n  const blockReason = validateCompoundCommand(normalizedCommand);\n\n  if (blockReason) {\n    const errorMsg = `BLOCKED: Dangerous compound command detected.\n\nBlocked segment: ${blockReason}\n\nThe command contains a potentially destructive operation.\n\nPlease review and modify your command to remove the dangerous operation.`;\n\n    logPermissionFeedback('deny', `Dangerous compound command: ${blockReason}`, input);\n    logHook('compound-command-validator', `BLOCKED: ${blockReason}`);\n\n    return outputDeny(errorMsg);\n  }\n\n  // Safe compound command - allow execution\n  logPermissionFeedback('allow', 'Compound command validated: safe', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Default Timeout Setter Hook\n * Sets default timeout of 120000ms (2 minutes) if not specified\n * CC 2.1.7 Compliant: outputs JSON with updatedInput to modify tool params\n */\n\nimport type { HookInput, HookResult, HookSpecificOutput } from '../../types.js';\nimport { logHook } from '../../lib/common.js';\n\n/**\n * Default timeout: 2 minutes (120000ms)\n */\nconst DEFAULT_TIMEOUT = 120000;\n\n/**\n * Extended hook specific output with updatedInput\n */\ninterface ExtendedHookSpecificOutput extends HookSpecificOutput {\n  updatedInput?: {\n    command: string;\n    timeout: number;\n    description?: string;\n  };\n}\n\n/**\n * Set default timeout if not specified\n */\nexport function defaultTimeoutSetter(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const timeout = input.tool_input.timeout;\n  const description = input.tool_input.description;\n\n  // If timeout is already set, don't modify\n  if (typeof timeout === 'number' && timeout > 0) {\n    return { continue: true, suppressOutput: true };\n  }\n\n  // Build updatedInput with default timeout\n  const updatedInput: ExtendedHookSpecificOutput['updatedInput'] = {\n    command,\n    timeout: DEFAULT_TIMEOUT,\n  };\n\n  if (description && typeof description === 'string') {\n    updatedInput.description = description;\n  }\n\n  logHook('default-timeout-setter', `Setting default timeout: ${DEFAULT_TIMEOUT}ms`);\n\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'allow',\n      updatedInput,\n    } as ExtendedHookSpecificOutput,\n  };\n}\n", "/**\n * Error Pattern Warner Hook\n * Warns before executing commands matching known bad patterns\n * CC 2.1.9 Enhanced: injects additionalContext with learned error patterns\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\ninterface ErrorRule {\n  tool: string;\n  signature: string;\n  pattern?: string;\n  occurrence_count?: number;\n  suggested_fix?: string;\n  sample_input?: {\n    command?: string;\n  };\n}\n\ninterface RulesFile {\n  rules: ErrorRule[];\n}\n\n/**\n * Load error rules from file\n */\nfunction loadErrorRules(projectDir: string): ErrorRule[] {\n  const rulesFile = join(projectDir, '.claude', 'rules', 'error_rules.json');\n\n  try {\n    if (existsSync(rulesFile)) {\n      const data: RulesFile = JSON.parse(readFileSync(rulesFile, 'utf8'));\n      return data.rules || [];\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return [];\n}\n\n/**\n * Count common words between two strings\n */\nfunction countCommonWords(str1: string, str2: string): number {\n  const words1 = new Set(str1.toLowerCase().split(/\\s+/));\n  const words2 = new Set(str2.toLowerCase().split(/\\s+/));\n\n  let count = 0;\n  for (const word of words1) {\n    if (words2.has(word) && word.length > 2) {\n      count++;\n    }\n  }\n\n  return count;\n}\n\n/**\n * Warn about commands matching known error patterns\n */\nexport function errorPatternWarner(input: HookInput): HookResult {\n  const projectDir = getProjectDir();\n  const command = input.tool_input.command || '';\n\n  if (!command) {\n    return outputSilentSuccess();\n  }\n\n  // Load error rules\n  const rules = loadErrorRules(projectDir);\n  if (rules.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const hints: string[] = [];\n\n  // Check for common database connection patterns that often fail\n  if (/psql.*-U\\s+(postgres|orchestkit|root)/.test(command)) {\n    const dbRules = rules.filter(\n      (r) => r.tool === 'Bash' && r.signature?.includes('role')\n    );\n    if (dbRules.length > 0) {\n      hints.push('DB role error: use docker exec -it <container> psql -U orchestkit_user');\n    }\n  }\n\n  // Check for MCP postgres tool issues\n  if (command.includes('mcp__postgres')) {\n    const mcpRules = rules.filter((r) => r.tool?.includes('postgres-mcp'));\n    if (mcpRules.length > 0) {\n      hints.push('MCP postgres: verify connection to correct database');\n    }\n  }\n\n  // Check against high-occurrence error patterns\n  for (const rule of rules) {\n    if (!rule.pattern || (rule.occurrence_count || 0) < 5) continue;\n\n    const sampleCommand = rule.sample_input?.command;\n    if (sampleCommand && countCommonWords(command, sampleCommand) > 3) {\n      logHook('error-pattern-warner', `Pattern match: ${rule.signature}`);\n      if (rule.suggested_fix) {\n        hints.push(`${rule.signature} (${rule.occurrence_count}x): ${rule.suggested_fix}`);\n      } else {\n        hints.push(`${rule.signature} (${rule.occurrence_count}x)`);\n      }\n    }\n  }\n\n  // CC 2.1.9: Inject additionalContext if we have pattern hints\n  if (hints.length > 0) {\n    let contextMsg = 'Learned error patterns | ' + hints.join(' | ');\n\n    // Truncate if too long (keep under 200 chars for context budget)\n    if (contextMsg.length > 200) {\n      contextMsg = contextMsg.slice(0, 197) + '...';\n    }\n\n    return outputWithContext(contextMsg);\n  }\n\n  // No relevant patterns found\n  return outputSilentSuccess();\n}\n", "/**\n * Conflict Predictor Hook\n * Predicts potential merge conflicts before git operations\n * CC 2.1.9: Injects warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\n\n/**\n * Get files that might conflict on merge/rebase\n */\nfunction getPotentialConflicts(projectDir: string, targetBranch: string): string[] {\n  try {\n    // Get files changed in current branch since diverging from target\n    const result = execSync(\n      `git diff --name-only ${targetBranch}...HEAD 2>/dev/null || echo \"\"`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    const changedFiles = result.trim().split('\\n').filter(Boolean);\n\n    // Check which of these files have also been modified in target branch\n    const conflicts: string[] = [];\n    for (const file of changedFiles.slice(0, 20)) {\n      // Limit to first 20 files\n      try {\n        const targetModified = execSync(\n          `git log -1 --pretty=format:\"%h\" ${targetBranch} -- \"${file}\" 2>/dev/null || echo \"\"`,\n          {\n            cwd: projectDir,\n            encoding: 'utf8',\n            timeout: 5000,\n            stdio: ['pipe', 'pipe', 'pipe'],\n          }\n        );\n\n        if (targetModified.trim()) {\n          conflicts.push(file);\n        }\n      } catch {\n        // Ignore individual file check errors\n      }\n    }\n\n    return conflicts;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Predict conflicts before merge/rebase operations\n */\nexport function conflictPredictor(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git merge or rebase commands\n  if (!/git\\s+(merge|rebase|pull)/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract target branch\n  let targetBranch: string | null = null;\n\n  // git merge <branch>, git rebase <branch>\n  const branchMatch = command.match(/git\\s+(merge|rebase)\\s+(\\S+)/);\n  if (branchMatch) {\n    targetBranch = branchMatch[2];\n  }\n\n  // git pull (uses remote tracking branch)\n  if (command.includes('git pull')) {\n    targetBranch = 'origin/dev'; // Assume dev as base\n  }\n\n  if (!targetBranch) {\n    return outputSilentSuccess();\n  }\n\n  // Check for potential conflicts\n  const conflicts = getPotentialConflicts(projectDir, targetBranch);\n\n  if (conflicts.length > 0) {\n    const context = `Potential conflicts detected: ${conflicts.length} file(s)\nFiles: ${conflicts.slice(0, 5).join(', ')}${conflicts.length > 5 ? '...' : ''}\n\nConsider:\n1. Review changes in these files before merging\n2. Run: git diff ${targetBranch}...HEAD -- <file>\n3. Prepare conflict resolution strategy`;\n\n    logPermissionFeedback('allow', `Conflict prediction: ${conflicts.length} files`, input);\n    logHook('conflict-predictor', `Potential conflicts: ${conflicts.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  logPermissionFeedback('allow', 'No conflicts predicted', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Affected Tests Finder Hook\n * Suggests running tests related to changed files\n * CC 2.1.9: Injects test suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\nimport { existsSync } from 'node:fs';\nimport { join, basename, dirname } from 'node:path';\n\n/**\n * Find test files related to a source file\n */\nfunction findRelatedTests(projectDir: string, sourceFile: string): string[] {\n  const tests: string[] = [];\n  const baseName = basename(sourceFile).replace(/\\.(ts|tsx|js|jsx|py)$/, '');\n  const dirName = dirname(sourceFile);\n\n  // Common test file patterns\n  const testPatterns = [\n    `${dirName}/${baseName}.test.ts`,\n    `${dirName}/${baseName}.test.tsx`,\n    `${dirName}/${baseName}.spec.ts`,\n    `${dirName}/${baseName}.spec.tsx`,\n    `${dirName}/__tests__/${baseName}.test.ts`,\n    `${dirName}/__tests__/${baseName}.test.tsx`,\n    `tests/${sourceFile.replace(/\\.(ts|tsx|js|jsx)$/, '.test.ts')}`,\n    `test_${baseName}.py`,\n    `tests/test_${baseName}.py`,\n  ];\n\n  for (const pattern of testPatterns) {\n    const fullPath = join(projectDir, pattern);\n    if (existsSync(fullPath)) {\n      tests.push(pattern);\n    }\n  }\n\n  return tests;\n}\n\n/**\n * Get changed files from git status\n */\nfunction getChangedFiles(projectDir: string): string[] {\n  try {\n    const result = execSync('git status --short 2>/dev/null || echo \"\"', {\n      cwd: projectDir,\n      encoding: 'utf8',\n      timeout: 5000,\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    return result\n      .split('\\n')\n      .filter((line) => line.trim())\n      .map((line) => line.slice(3).trim())\n      .filter((file) => /\\.(ts|tsx|js|jsx|py)$/.test(file));\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Suggest running affected tests before push/commit\n */\nexport function affectedTestsFinder(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git push or npm test commands\n  if (!/git\\s+push|npm\\s+run\\s+test|pytest/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip if already running tests\n  if (/npm\\s+run\\s+test|pytest/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get changed files\n  const changedFiles = getChangedFiles(projectDir);\n  if (changedFiles.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Find related tests\n  const relatedTests: string[] = [];\n  for (const file of changedFiles.slice(0, 10)) {\n    // Limit to first 10 files\n    const tests = findRelatedTests(projectDir, file);\n    relatedTests.push(...tests);\n  }\n\n  // Remove duplicates\n  const uniqueTests = [...new Set(relatedTests)];\n\n  if (uniqueTests.length > 0) {\n    const context = `Related tests for changed files:\n${uniqueTests.slice(0, 5).join('\\n')}${uniqueTests.length > 5 ? '\\n...' : ''}\n\nConsider running: npm run test -- ${uniqueTests[0]}`;\n\n    logPermissionFeedback('allow', `Found ${uniqueTests.length} related tests`, input);\n    logHook('affected-tests-finder', `Tests: ${uniqueTests.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * CI Simulation Hook\n * Suggests running CI-like checks locally before push\n * CC 2.1.9: Injects CI suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Detect available CI checks based on project files\n */\nfunction detectCIChecks(projectDir: string): string[] {\n  const checks: string[] = [];\n\n  // Node.js project\n  if (existsSync(join(projectDir, 'package.json'))) {\n    checks.push('npm run lint');\n    checks.push('npm run typecheck');\n    checks.push('npm run test');\n  }\n\n  // Python project\n  if (existsSync(join(projectDir, 'pyproject.toml'))) {\n    checks.push('ruff check .');\n    checks.push('mypy .');\n    checks.push('pytest');\n  }\n\n  // Go project\n  if (existsSync(join(projectDir, 'go.mod'))) {\n    checks.push('go vet ./...');\n    checks.push('go test ./...');\n  }\n\n  return checks;\n}\n\n/**\n * Suggest CI checks before git push\n */\nexport function ciSimulation(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git push commands\n  if (!/git\\s+push/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Detect available checks\n  const checks = detectCIChecks(projectDir);\n\n  if (checks.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Pre-push CI simulation suggested:\n${checks.slice(0, 3).join('\\n')}\n\nRun these locally to catch issues before CI fails.\nOr: git push --no-verify to skip (not recommended)`;\n\n  logPermissionFeedback('allow', 'CI simulation suggested', input);\n  logHook('ci-simulation', `Suggested checks: ${checks.join(', ')}`);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Pre-Commit Simulation Hook\n * Suggests running pre-commit hooks locally\n * CC 2.1.9: Injects pre-commit suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check if pre-commit is configured\n */\nfunction hasPreCommitConfig(projectDir: string): boolean {\n  return (\n    existsSync(join(projectDir, '.pre-commit-config.yaml')) ||\n    existsSync(join(projectDir, '.pre-commit-config.yml'))\n  );\n}\n\n/**\n * Check if husky is configured\n */\nfunction hasHuskyConfig(projectDir: string): boolean {\n  return existsSync(join(projectDir, '.husky'));\n}\n\n/**\n * Suggest pre-commit checks before commit\n */\nexport function preCommitSimulation(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process git commit commands\n  if (!/git\\s+commit/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if using --no-verify (skip hooks)\n  if (/--no-verify/.test(command)) {\n    const context = `WARNING: --no-verify will skip pre-commit hooks.\nConsider removing it unless intentional.\nSkipped checks may cause CI failures.`;\n\n    logPermissionFeedback('allow', 'Skip pre-commit detected', input);\n    logHook('pre-commit-simulation', '--no-verify used');\n    return outputAllowWithContext(context);\n  }\n\n  // Check for pre-commit configuration\n  if (hasPreCommitConfig(projectDir)) {\n    const context = `Pre-commit hooks will run: .pre-commit-config.yaml\nIf hooks fail, fix issues and retry.\nRun manually: pre-commit run --all-files`;\n\n    logPermissionFeedback('allow', 'pre-commit config found', input);\n    return outputAllowWithContext(context);\n  }\n\n  // Check for husky\n  if (hasHuskyConfig(projectDir)) {\n    const context = `Husky hooks will run: .husky/\nIf hooks fail, fix issues and retry.`;\n\n    logPermissionFeedback('allow', 'husky config found', input);\n    return outputAllowWithContext(context);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * PR Merge Gate Hook\n * Checks PR status before merge commands\n * CC 2.1.9: Injects PR status via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\n\ninterface PRStatus {\n  number: number;\n  state: string;\n  mergeable: boolean;\n  statusCheckRollup: string;\n  reviewDecision: string;\n}\n\n/**\n * Get PR status from GitHub CLI\n */\nfunction getPRStatus(projectDir: string, prNumber?: number): PRStatus | null {\n  try {\n    const prArg = prNumber ? `${prNumber}` : '';\n    const result = execSync(\n      `gh pr view ${prArg} --json number,state,mergeable,statusCheckRollup,reviewDecision 2>/dev/null`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    return JSON.parse(result) as PRStatus;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check PR status before merge\n */\nexport function prMergeGate(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process gh pr merge commands\n  if (!/gh\\s+pr\\s+merge/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract PR number if specified\n  const prMatch = command.match(/gh\\s+pr\\s+merge\\s+(\\d+)/);\n  const prNumber = prMatch ? parseInt(prMatch[1], 10) : undefined;\n\n  // Get PR status\n  const status = getPRStatus(projectDir, prNumber);\n\n  if (!status) {\n    const context = `Could not fetch PR status. Ensure:\n1. gh CLI is installed and authenticated\n2. You're in a git repository\n3. PR exists and is accessible`;\n\n    logPermissionFeedback('allow', 'PR status unavailable', input);\n    return outputAllowWithContext(context);\n  }\n\n  // Check if PR is mergeable\n  const issues: string[] = [];\n\n  if (status.state !== 'OPEN') {\n    issues.push(`PR state: ${status.state} (expected OPEN)`);\n  }\n\n  if (!status.mergeable) {\n    issues.push('PR has merge conflicts');\n  }\n\n  if (status.statusCheckRollup !== 'SUCCESS' && status.statusCheckRollup !== 'PENDING') {\n    issues.push(`Status checks: ${status.statusCheckRollup}`);\n  }\n\n  if (status.reviewDecision === 'CHANGES_REQUESTED') {\n    issues.push('Changes requested by reviewer');\n  }\n\n  if (issues.length > 0) {\n    const context = `PR #${status.number} has issues:\n${issues.join('\\n')}\n\nResolve these before merging.`;\n\n    logPermissionFeedback('allow', `PR issues: ${issues.join(', ')}`, input);\n    logHook('pr-merge-gate', `PR #${status.number} has ${issues.length} issues`);\n    return outputAllowWithContext(context);\n  }\n\n  // PR looks good\n  logPermissionFeedback('allow', `PR #${status.number} ready to merge`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Changelog Generator Hook\n * Suggests changelog entries for version bumps\n * CC 2.1.9: Injects changelog suggestions via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { execSync } from 'node:child_process';\n\n/**\n * Get recent commits for changelog\n */\nfunction getRecentCommits(projectDir: string, since?: string): string[] {\n  try {\n    const sinceArg = since ? `--since=\"${since}\"` : '--max-count=20';\n    const result = execSync(\n      `git log ${sinceArg} --pretty=format:\"%s\" 2>/dev/null || echo \"\"`,\n      {\n        cwd: projectDir,\n        encoding: 'utf8',\n        timeout: 10000,\n        stdio: ['pipe', 'pipe', 'pipe'],\n      }\n    );\n\n    return result.split('\\n').filter(Boolean);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Group commits by type for changelog\n */\nfunction groupCommitsByType(commits: string[]): Record<string, string[]> {\n  const groups: Record<string, string[]> = {\n    feat: [],\n    fix: [],\n    refactor: [],\n    docs: [],\n    test: [],\n    chore: [],\n    other: [],\n  };\n\n  for (const commit of commits) {\n    const match = commit.match(/^(feat|fix|refactor|docs|test|chore|perf|ci|build)/);\n    if (match) {\n      const type = match[1] === 'perf' || match[1] === 'ci' || match[1] === 'build' ? 'chore' : match[1];\n      groups[type].push(commit);\n    } else {\n      groups.other.push(commit);\n    }\n  }\n\n  return groups;\n}\n\n/**\n * Suggest changelog entries for version commands\n */\nexport function changelogGenerator(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm version, poetry version, or changelog commands\n  if (!/npm\\s+version|poetry\\s+version|changelog/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get recent commits\n  const commits = getRecentCommits(projectDir);\n\n  if (commits.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  // Group by type\n  const groups = groupCommitsByType(commits);\n\n  // Build changelog suggestion\n  const sections: string[] = [];\n\n  if (groups.feat.length > 0) {\n    sections.push(`### Features\\n${groups.feat.slice(0, 5).map((c) => `- ${c}`).join('\\n')}`);\n  }\n  if (groups.fix.length > 0) {\n    sections.push(`### Bug Fixes\\n${groups.fix.slice(0, 5).map((c) => `- ${c}`).join('\\n')}`);\n  }\n  if (groups.refactor.length > 0 || groups.chore.length > 0) {\n    const combined = [...groups.refactor, ...groups.chore];\n    sections.push(`### Maintenance\\n${combined.slice(0, 3).map((c) => `- ${c}`).join('\\n')}`);\n  }\n\n  if (sections.length === 0) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Suggested changelog entries:\n\n${sections.join('\\n\\n')}\n\nUpdate CHANGELOG.md before releasing.`;\n\n  logPermissionFeedback('allow', 'Changelog suggestions generated', input);\n  logHook('changelog-generator', `Generated ${sections.length} sections`);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Version Sync Hook\n * Checks version consistency across files\n * CC 2.1.9: Injects version warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\ninterface VersionSource {\n  file: string;\n  version: string | null;\n}\n\n/**\n * Extract version from package.json\n */\nfunction getPackageJsonVersion(projectDir: string): string | null {\n  const filePath = join(projectDir, 'package.json');\n  try {\n    if (existsSync(filePath)) {\n      const data = JSON.parse(readFileSync(filePath, 'utf8'));\n      return data.version || null;\n    }\n  } catch {\n    // Ignore\n  }\n  return null;\n}\n\n/**\n * Extract version from pyproject.toml\n */\nfunction getPyprojectVersion(projectDir: string): string | null {\n  const filePath = join(projectDir, 'pyproject.toml');\n  try {\n    if (existsSync(filePath)) {\n      const content = readFileSync(filePath, 'utf8');\n      const match = content.match(/version\\s*=\\s*[\"']([^\"']+)[\"']/);\n      return match ? match[1] : null;\n    }\n  } catch {\n    // Ignore\n  }\n  return null;\n}\n\n/**\n * Get all version sources\n */\nfunction getVersionSources(projectDir: string): VersionSource[] {\n  const sources: VersionSource[] = [];\n\n  const pkgVersion = getPackageJsonVersion(projectDir);\n  if (pkgVersion) {\n    sources.push({ file: 'package.json', version: pkgVersion });\n  }\n\n  const pyVersion = getPyprojectVersion(projectDir);\n  if (pyVersion) {\n    sources.push({ file: 'pyproject.toml', version: pyVersion });\n  }\n\n  return sources;\n}\n\n/**\n * Check version sync on version bump commands\n */\nexport function versionSync(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm version or poetry version commands\n  if (!/npm\\s+version|poetry\\s+version/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Get all version sources\n  const sources = getVersionSources(projectDir);\n\n  if (sources.length < 2) {\n    return outputSilentSuccess();\n  }\n\n  // Check if versions are in sync\n  const versions = sources.map((s) => s.version);\n  const uniqueVersions = [...new Set(versions)];\n\n  if (uniqueVersions.length > 1) {\n    const context = `Version mismatch detected:\n${sources.map((s) => `${s.file}: ${s.version}`).join('\\n')}\n\nConsider syncing versions across all files.`;\n\n    logPermissionFeedback('allow', 'Version mismatch detected', input);\n    logHook('version-sync', `Versions: ${versions.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  // All in sync\n  logPermissionFeedback('allow', `Versions in sync: ${uniqueVersions[0]}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * License Compliance Hook\n * Checks for license compliance issues in dependencies\n * CC 2.1.9: Injects license warnings via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Problematic license patterns\n */\nconst PROBLEMATIC_LICENSES = [\n  'GPL', // Copyleft\n  'AGPL', // Strong copyleft\n  'LGPL', // Weaker copyleft but still restrictive\n  'CC-BY-NC', // Non-commercial\n  'SSPL', // Server Side Public License\n];\n\n/**\n * Check package.json dependencies for license issues\n */\nfunction checkNpmLicenses(projectDir: string): string[] {\n  const issues: string[] = [];\n  const lockFile = join(projectDir, 'package-lock.json');\n\n  try {\n    if (existsSync(lockFile)) {\n      const content = readFileSync(lockFile, 'utf8');\n\n      for (const license of PROBLEMATIC_LICENSES) {\n        if (content.includes(`\"license\": \"${license}`)) {\n          issues.push(`Found ${license} license in npm dependencies`);\n        }\n      }\n    }\n  } catch {\n    // Ignore\n  }\n\n  return issues;\n}\n\n/**\n * Check for license compliance on install commands\n */\nexport function licenseCompliance(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process npm install, yarn add, or pip install commands\n  if (!/npm\\s+install|yarn\\s+add|pip\\s+install|poetry\\s+add/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip if just installing from lock file\n  if (/npm\\s+ci|npm\\s+install\\s*$/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract package name\n  const pkgMatch = command.match(/(?:npm\\s+install|yarn\\s+add|pip\\s+install|poetry\\s+add)\\s+(\\S+)/);\n  const pkgName = pkgMatch ? pkgMatch[1] : null;\n\n  if (!pkgName) {\n    return outputSilentSuccess();\n  }\n\n  // Check existing licenses\n  const issues = checkNpmLicenses(projectDir);\n\n  if (issues.length > 0) {\n    const context = `License compliance check:\n${issues.join('\\n')}\n\nNew dependency: ${pkgName}\nConsider checking its license before adding.\n\nUse: npm view ${pkgName} license`;\n\n    logPermissionFeedback('allow', 'License compliance warning', input);\n    logHook('license-compliance', `Checking: ${pkgName}`);\n    return outputAllowWithContext(context);\n  }\n\n  // Suggest checking license\n  const context = `Installing: ${pkgName}\nVerify license compatibility before production use.\nCheck: npm view ${pkgName} license`;\n\n  logPermissionFeedback('allow', `Installing package: ${pkgName}`, input);\n  return outputAllowWithContext(context);\n}\n", "/**\n * GitHub Issue Creation Guide Hook\n * Provides guidance for creating GitHub issues\n * CC 2.1.9: Injects issue creation context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Issue templates based on type\n */\nconst ISSUE_TEMPLATES: Record<string, string> = {\n  bug: `## Description\n<!-- Clear description of the bug -->\n\n## Steps to Reproduce\n1.\n2.\n3.\n\n## Expected Behavior\n<!-- What should happen -->\n\n## Actual Behavior\n<!-- What actually happens -->\n\n## Environment\n- OS:\n- Version:`,\n\n  feature: `## Description\n<!-- Clear description of the feature -->\n\n## Motivation\n<!-- Why is this feature needed? -->\n\n## Proposed Solution\n<!-- How should this be implemented? -->\n\n## Alternatives Considered\n<!-- Other approaches considered -->`,\n\n  chore: `## Description\n<!-- What maintenance task needs to be done? -->\n\n## Impact\n<!-- What does this affect? -->\n\n## Checklist\n- [ ] Task 1\n- [ ] Task 2`,\n};\n\n/**\n * Detect issue type from command\n */\nfunction detectIssueType(command: string): string | null {\n  if (/--label.*bug|bug\\s+report/i.test(command)) return 'bug';\n  if (/--label.*feature|feature\\s+request/i.test(command)) return 'feature';\n  if (/--label.*chore|maintenance/i.test(command)) return 'chore';\n  return null;\n}\n\n/**\n * Provide guidance for GitHub issue creation\n */\nexport function ghIssueCreationGuide(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process gh issue create commands\n  if (!/gh\\s+issue\\s+create/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if already has body/template\n  if (/--body|--body-file|-b\\s/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Detect issue type\n  const issueType = detectIssueType(command);\n\n  if (issueType && ISSUE_TEMPLATES[issueType]) {\n    const context = `Issue type detected: ${issueType}\n\nSuggested template:\n${ISSUE_TEMPLATES[issueType].slice(0, 200)}...\n\nAdd --body with template or use --web for interactive creation.`;\n\n    logPermissionFeedback('allow', `Issue creation: ${issueType}`, input);\n    logHook('gh-issue-creation-guide', `Type: ${issueType}`);\n    return outputAllowWithContext(context);\n  }\n\n  // Generic guidance\n  const context = `Creating GitHub issue. Consider:\n- Clear, descriptive title\n- Add appropriate labels (bug, feature, chore)\n- Include reproduction steps for bugs\n- Reference related issues/PRs\n\nUse --web for interactive creation with templates.`;\n\n  logPermissionFeedback('allow', 'Issue creation guidance', input);\n  return outputAllowWithContext(context);\n}\n", "/**\n * Issue Docs Requirement Hook\n * Reminds to update documentation for feature issues\n * CC 2.1.9: Injects documentation reminders via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Documentation checklist for features\n */\nconst DOCS_CHECKLIST = `Documentation checklist for features:\n- [ ] Update README.md if public API changes\n- [ ] Add/update JSDoc or docstrings\n- [ ] Update CHANGELOG.md\n- [ ] Add usage examples\n- [ ] Update API documentation`;\n\n/**\n * Remind about documentation for feature branches/issues\n */\nexport function issueDocsRequirement(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process gh issue close or gh pr merge for feature issues\n  if (!/gh\\s+(issue\\s+close|pr\\s+merge)/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if this is a feature (look for feat/feature labels or branch names)\n  const isFeature =\n    /--label.*feat/i.test(command) ||\n    /feat|feature/.test(command);\n\n  if (!isFeature) {\n    return outputSilentSuccess();\n  }\n\n  const context = `Feature completion detected. Ensure documentation is updated.\n\n${DOCS_CHECKLIST}\n\nSkip with --no-edit if docs are already complete.`;\n\n  logPermissionFeedback('allow', 'Feature docs reminder', input);\n  logHook('issue-docs-requirement', 'Feature completion - docs reminder');\n  return outputAllowWithContext(context);\n}\n", "/**\n * Multi-Instance Quality Gate Hook\n * Enforces quality checks in multi-instance scenarios\n * CC 2.1.9: Injects quality gate context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check if multi-instance coordination is enabled\n */\nfunction isMultiInstanceEnabled(projectDir: string): boolean {\n  const dbPath = join(projectDir, '.claude', 'coordination', '.claude.db');\n  return existsSync(dbPath);\n}\n\n/**\n * Get quality gate status from work registry\n */\nfunction getQualityGateStatus(projectDir: string): Record<string, boolean> {\n  const registryPath = join(projectDir, '.claude', 'coordination', 'work-registry.json');\n\n  try {\n    if (existsSync(registryPath)) {\n      const data = JSON.parse(readFileSync(registryPath, 'utf8'));\n      return data.qualityGates || {};\n    }\n  } catch {\n    // Ignore\n  }\n\n  return {};\n}\n\n/**\n * Enforce quality gates before merge/deploy in multi-instance mode\n */\nexport function multiInstanceQualityGate(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n  const projectDir = getProjectDir();\n\n  // Only process merge/deploy commands\n  if (!/gh\\s+pr\\s+merge|git\\s+merge|deploy/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Check if multi-instance is enabled\n  if (!isMultiInstanceEnabled(projectDir)) {\n    return outputSilentSuccess();\n  }\n\n  // Get quality gate status\n  const gates = getQualityGateStatus(projectDir);\n\n  // Check required gates\n  const requiredGates = ['tests', 'lint', 'typecheck'];\n  const failedGates = requiredGates.filter((gate) => !gates[gate]);\n\n  if (failedGates.length > 0) {\n    const context = `Multi-instance quality gate check:\nFailed/missing gates: ${failedGates.join(', ')}\n\nRun these checks before merging:\n${failedGates.map((g) => `- npm run ${g}`).join('\\n')}\n\nQuality gates ensure consistency across instances.`;\n\n    logPermissionFeedback('allow', `Quality gates failed: ${failedGates.join(', ')}`, input);\n    logHook('multi-instance-quality-gate', `Failed: ${failedGates.join(', ')}`);\n    return outputAllowWithContext(context);\n  }\n\n  // All gates passed\n  logPermissionFeedback('allow', 'All quality gates passed', input);\n  return outputSilentSuccess();\n}\n", "/**\n * Agent Browser Safety Hook\n * Validates agent-browser CLI commands for safety\n * CC 2.1.9: Injects safety context via additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  outputAllowWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Blocked URL patterns for agent-browser\n */\nconst BLOCKED_URL_PATTERNS = [\n  /localhost.*admin/i,\n  /127\\.0\\.0\\.1.*admin/i,\n  /internal\\./i,\n  /intranet\\./i,\n  /\\.local\\//i,\n  /file:\\/\\//i,\n];\n\n/**\n * Sensitive action patterns\n */\nconst SENSITIVE_ACTIONS = [\n  'click.*delete',\n  'click.*remove',\n  'fill.*password',\n  'fill.*credit',\n  'submit.*payment',\n];\n\n/**\n * Extract URL from agent-browser command\n */\nfunction extractUrl(command: string): string | null {\n  const urlMatch = command.match(/(?:navigate|goto|open)\\s+[\"']?([^\"'\\s]+)[\"']?/i);\n  return urlMatch ? urlMatch[1] : null;\n}\n\n/**\n * Check if URL is blocked\n */\nfunction isBlockedUrl(url: string): boolean {\n  return BLOCKED_URL_PATTERNS.some((pattern) => pattern.test(url));\n}\n\n/**\n * Check if action is sensitive\n */\nfunction isSensitiveAction(command: string): boolean {\n  return SENSITIVE_ACTIONS.some((pattern) => new RegExp(pattern, 'i').test(command));\n}\n\n/**\n * Validate agent-browser commands for safety\n */\nexport function agentBrowserSafety(input: HookInput): HookResult {\n  const command = input.tool_input.command || '';\n\n  // Only process agent-browser commands\n  if (!/agent-browser|ab\\s/.test(command)) {\n    return outputSilentSuccess();\n  }\n\n  // Extract and check URL\n  const url = extractUrl(command);\n\n  if (url && isBlockedUrl(url)) {\n    logPermissionFeedback('deny', `Blocked URL: ${url}`, input);\n    logHook('agent-browser-safety', `BLOCKED: ${url}`);\n\n    return outputDeny(\n      `agent-browser blocked: URL matches blocked pattern.\n\nURL: ${url}\n\nBlocked patterns include internal, localhost admin, and file:// URLs.\nIf this is intentional, use direct browser access instead.`\n    );\n  }\n\n  // Check for sensitive actions\n  if (isSensitiveAction(command)) {\n    const context = `Sensitive browser action detected:\n${command.slice(0, 100)}...\n\nThis may interact with:\n- Delete/remove buttons\n- Password fields\n- Payment forms\n\nProceed with caution. Verify target elements.`;\n\n    logPermissionFeedback('allow', 'Sensitive action warning', input);\n    logHook('agent-browser-safety', 'Sensitive action detected');\n    return outputAllowWithContext(context);\n  }\n\n  // Safe command\n  logPermissionFeedback('allow', 'agent-browser command validated', input);\n  return outputSilentSuccess();\n}\n", "/**\n * File Guard Hook\n * Protects sensitive files from modification\n * CC 2.1.7 Compliant\n *\n * SECURITY: Resolves symlinks before checking patterns (ME-001 fix)\n * to prevent symlink-based bypasses of file protection.\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { realpathSync, existsSync } from 'node:fs';\nimport { resolve, isAbsolute } from 'node:path';\n\n/**\n * Protected file patterns - files that should NEVER be modified\n */\nconst PROTECTED_PATTERNS: RegExp[] = [\n  /\\.env$/,\n  /\\.env\\.local$/,\n  /\\.env\\.production$/,\n  /credentials\\.json$/,\n  /secrets\\.json$/,\n  /private\\.key$/,\n  /\\.pem$/,\n  /id_rsa$/,\n  /id_ed25519$/,\n];\n\n/**\n * Config patterns - files to warn about but allow\n */\nconst CONFIG_PATTERNS: RegExp[] = [\n  /package\\.json$/,\n  /pyproject\\.toml$/,\n  /tsconfig\\.json$/,\n];\n\n/**\n * Resolve file path, following symlinks\n */\nfunction resolveRealPath(filePath: string, projectDir: string): string {\n  try {\n    // Make absolute if relative\n    const absolutePath = isAbsolute(filePath)\n      ? filePath\n      : resolve(projectDir, filePath);\n\n    // Follow symlinks if file exists\n    if (existsSync(absolutePath)) {\n      return realpathSync(absolutePath);\n    }\n\n    return absolutePath;\n  } catch {\n    return filePath;\n  }\n}\n\n/**\n * Check if file matches protected patterns\n */\nfunction isProtected(realPath: string): RegExp | null {\n  for (const pattern of PROTECTED_PATTERNS) {\n    if (pattern.test(realPath)) {\n      return pattern;\n    }\n  }\n  return null;\n}\n\n/**\n * Check if file is a config file\n */\nfunction isConfigFile(realPath: string): boolean {\n  return CONFIG_PATTERNS.some((pattern) => pattern.test(realPath));\n}\n\n/**\n * Guard against modifying sensitive files\n */\nexport function fileGuard(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = getProjectDir();\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  logHook('file-guard', `File write/edit: ${filePath}`);\n\n  // Resolve symlinks to prevent bypass attacks (ME-001 fix)\n  const realPath = resolveRealPath(filePath, projectDir);\n  logHook('file-guard', `Resolved path: ${realPath}`);\n\n  // Check if file matches protected patterns\n  const matchedPattern = isProtected(realPath);\n\n  if (matchedPattern) {\n    logPermissionFeedback('deny', `Protected file blocked: ${filePath} (pattern: ${matchedPattern})`, input);\n    logHook('file-guard', `BLOCKED: ${filePath} matches ${matchedPattern}`);\n\n    return outputDeny(\n      `Cannot modify protected file: ${filePath}\n\nResolved path: ${realPath}\nMatched pattern: ${matchedPattern}\n\nProtected files include:\n- Environment files (.env, .env.local, .env.production)\n- Credential files (credentials.json, secrets.json)\n- Private keys (.pem, id_rsa, id_ed25519)\n\nIf you need to modify this file, do it manually outside Claude Code.`\n    );\n  }\n\n  // Warn on config files (but allow)\n  if (isConfigFile(realPath)) {\n    logHook('file-guard', `WARNING: Config file modification: ${realPath}`);\n    logPermissionFeedback('warn', `Config file modification: ${filePath}`, input);\n  }\n\n  // Allow the write\n  logPermissionFeedback('allow', `File write allowed: ${filePath}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * File Lock Check Hook\n * Check/acquire locks before Write/Edit operations\n * CC 2.1.7 Compliant: ensures JSON output on all code paths\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\ninterface FileLock {\n  instance_id: string;\n  file_path: string;\n  acquired_at: string;\n  expires_at: string;\n}\n\ninterface LockDatabase {\n  locks?: FileLock[];\n}\n\n/**\n * Get coordination database path\n */\nfunction getCoordinationDbPath(projectDir: string): string {\n  return join(projectDir, '.claude', 'coordination', 'locks.json');\n}\n\n/**\n * Check if coordination is enabled\n */\nfunction isCoordinationEnabled(projectDir: string): boolean {\n  return existsSync(join(projectDir, '.claude', 'coordination'));\n}\n\n/**\n * Get current instance ID\n * CC 2.1.9+ guarantees CLAUDE_SESSION_ID availability\n */\nfunction getInstanceId(): string {\n  return process.env.CLAUDE_SESSION_ID!;\n}\n\n/**\n * Check if file is locked by another instance\n */\nfunction isLockedByOther(projectDir: string, filePath: string): FileLock | null {\n  const dbPath = getCoordinationDbPath(projectDir);\n  const instanceId = getInstanceId();\n\n  try {\n    if (!existsSync(dbPath)) {\n      return null;\n    }\n\n    const data: LockDatabase = JSON.parse(readFileSync(dbPath, 'utf8'));\n    const locks = data.locks || [];\n    const now = new Date().toISOString();\n\n    // Find active lock by another instance\n    const lock = locks.find(\n      (l) =>\n        l.file_path === filePath &&\n        l.instance_id !== instanceId &&\n        l.expires_at > now\n    );\n\n    return lock || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Check file locks before Write/Edit\n */\nexport function fileLockCheck(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = getProjectDir();\n  const toolName = input.tool_name;\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Check if coordination is enabled\n  if (!isCoordinationEnabled(projectDir)) {\n    return outputSilentSuccess();\n  }\n\n  // Skip coordination directory itself\n  if (filePath.includes('.claude/coordination')) {\n    return outputSilentSuccess();\n  }\n\n  // Normalize path\n  const normalizedPath = filePath.startsWith(projectDir)\n    ? filePath.slice(projectDir.length + 1)\n    : filePath;\n\n  // Check for existing lock\n  const existingLock = isLockedByOther(projectDir, normalizedPath);\n\n  if (existingLock) {\n    logPermissionFeedback(\n      'deny',\n      `File ${filePath} locked by ${existingLock.instance_id}`,\n      input\n    );\n    logHook('file-lock-check', `BLOCKED: ${filePath} locked by ${existingLock.instance_id}`);\n\n    return outputDeny(\n      `File ${filePath} is locked by instance ${existingLock.instance_id}.\n\nLock acquired at: ${existingLock.acquired_at}\nExpires at: ${existingLock.expires_at}\n\nYou may want to wait or check the work registry:\n.claude/coordination/work-registry.json`\n    );\n  }\n\n  // No conflicts\n  logPermissionFeedback('allow', `Lock check passed for ${filePath}`, input);\n  logHook('file-lock-check', `Lock check passed: ${filePath} (${toolName})`);\n  return outputSilentSuccess();\n}\n", "/**\n * Multi-Instance File Lock Hook\n * Acquires file locks before Write/Edit operations to prevent conflicts\n * CC 2.1.7 Compliant: Self-contained hook with proper block format\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputDeny,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join, dirname } from 'node:path';\nimport { guardWriteEdit } from '../../lib/guards.js';\n\ninterface FileLock {\n  lock_id: string;\n  file_path: string;\n  lock_type: string;\n  instance_id: string;\n  acquired_at: string;\n  expires_at: string;\n  reason?: string;\n}\n\ninterface LockDatabase {\n  locks: FileLock[];\n}\n\n/**\n * Get locks file path\n */\nfunction getLocksFilePath(projectDir: string): string {\n  return join(projectDir, '.claude', 'coordination', 'locks.json');\n}\n\n/**\n * Generate unique lock ID\n */\nfunction generateLockId(): string {\n  return `lock-${Date.now()}-${Math.random().toString(36).slice(2, 10)}`;\n}\n\n/**\n * Get current instance ID\n * CC 2.1.9+ guarantees CLAUDE_SESSION_ID availability\n */\nfunction getInstanceId(): string {\n  return process.env.CLAUDE_SESSION_ID!;\n}\n\n/**\n * Calculate lock expiry (60 seconds from now)\n */\nfunction calculateExpiry(): string {\n  const expiry = new Date(Date.now() + 60 * 1000);\n  return expiry.toISOString();\n}\n\n/**\n * Load locks database\n */\nfunction loadLocks(locksPath: string): LockDatabase {\n  try {\n    if (existsSync(locksPath)) {\n      return JSON.parse(readFileSync(locksPath, 'utf8'));\n    }\n  } catch {\n    // Ignore\n  }\n  return { locks: [] };\n}\n\n/**\n * Save locks database\n */\nfunction saveLocks(locksPath: string, data: LockDatabase): void {\n  const dir = dirname(locksPath);\n  if (!existsSync(dir)) {\n    mkdirSync(dir, { recursive: true });\n  }\n  writeFileSync(locksPath, JSON.stringify(data, null, 2));\n}\n\n/**\n * Check for existing lock by another instance\n */\nfunction checkExistingLock(\n  locks: FileLock[],\n  filePath: string,\n  instanceId: string\n): FileLock | null {\n  const now = new Date().toISOString();\n\n  return (\n    locks.find(\n      (l) =>\n        l.file_path === filePath &&\n        l.instance_id !== instanceId &&\n        l.expires_at > now\n    ) || null\n  );\n}\n\n/**\n * Check for directory lock that covers this file\n */\nfunction checkDirectoryLock(\n  locks: FileLock[],\n  filePath: string,\n  instanceId: string\n): FileLock | null {\n  const now = new Date().toISOString();\n\n  return (\n    locks.find(\n      (l) =>\n        l.lock_type === 'directory' &&\n        filePath.startsWith(l.file_path) &&\n        l.instance_id !== instanceId &&\n        l.expires_at > now\n    ) || null\n  );\n}\n\n/**\n * Acquire or refresh a file lock\n */\nfunction acquireLock(\n  data: LockDatabase,\n  filePath: string,\n  instanceId: string,\n  reason: string\n): void {\n  // Remove any existing lock for this file by this instance\n  data.locks = data.locks.filter(\n    (l) => !(l.file_path === filePath && l.instance_id === instanceId)\n  );\n\n  // Clean expired locks\n  const now = new Date().toISOString();\n  data.locks = data.locks.filter((l) => l.expires_at > now);\n\n  // Add new lock\n  data.locks.push({\n    lock_id: generateLockId(),\n    file_path: filePath,\n    lock_type: 'exclusive_write',\n    instance_id: instanceId,\n    acquired_at: now,\n    expires_at: calculateExpiry(),\n    reason,\n  });\n}\n\n/**\n * Multi-instance file lock acquisition\n */\nexport function multiInstanceLock(input: HookInput): HookResult {\n  // Only process Write and Edit tools\n  const guardResult = guardWriteEdit(input);\n  if (guardResult) return guardResult;\n\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = getProjectDir();\n  const toolName = input.tool_name;\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Get locks file path\n  const locksPath = getLocksFilePath(projectDir);\n\n  // Check if instance identity exists\n  const instanceDir = join(projectDir, '.instance');\n  if (!existsSync(join(instanceDir, 'id.json'))) {\n    logHook('multi-instance-lock', 'No instance identity, passing through');\n    return outputSilentSuccess();\n  }\n\n  // Normalize path\n  const normalizedPath = filePath.startsWith(projectDir)\n    ? filePath.slice(projectDir.length + 1)\n    : filePath;\n\n  const instanceId = getInstanceId();\n\n  // Load locks\n  const data = loadLocks(locksPath);\n\n  // Check for directory lock\n  const dirLock = checkDirectoryLock(data.locks, normalizedPath, instanceId);\n  if (dirLock) {\n    logPermissionFeedback(\n      'deny',\n      `Directory ${dirLock.file_path} locked by ${dirLock.instance_id}`,\n      input\n    );\n    logHook('multi-instance-lock', `BLOCKED: Directory lock by ${dirLock.instance_id}`);\n\n    return outputDeny(\n      `Directory ${dirLock.file_path} is locked by another Claude instance (${dirLock.instance_id}).\nWait for lock release.`\n    );\n  }\n\n  // Check for file lock\n  const fileLock = checkExistingLock(data.locks, normalizedPath, instanceId);\n  if (fileLock) {\n    logPermissionFeedback(\n      'deny',\n      `File ${normalizedPath} locked by ${fileLock.instance_id}`,\n      input\n    );\n    logHook('multi-instance-lock', `BLOCKED: ${normalizedPath} locked by ${fileLock.instance_id}`);\n\n    return outputDeny(\n      `File ${normalizedPath} is locked by another Claude instance (${fileLock.instance_id}).\nWait for lock release.`\n    );\n  }\n\n  // Acquire lock\n  acquireLock(data, normalizedPath, instanceId, `Modifying via ${toolName}`);\n  saveLocks(locksPath, data);\n\n  logHook('multi-instance-lock', `Lock acquired: ${normalizedPath}`);\n  logPermissionFeedback('allow', `Lock acquired for ${normalizedPath}`, input);\n\n  return outputSilentSuccess();\n}\n", "/**\n * Architecture Change Detector Hook\n * Detects breaking architectural changes and injects guidelines\n * CC 2.1.9 Enhanced: Injects architectural guidelines as additionalContext\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { guardPathPattern } from '../../lib/guards.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Architectural layer definitions\n */\ntype ArchLayer = 'api-layer' | 'service-layer' | 'data-layer' | 'workflow-layer' | 'unknown';\n\n/**\n * Path patterns for architectural layers\n */\nconst LAYER_PATTERNS: Record<ArchLayer, RegExp[]> = {\n  'api-layer': [/\\/api\\//, /\\/routes\\//, /\\/endpoints\\//],\n  'service-layer': [/\\/services\\//],\n  'data-layer': [/\\/db\\//, /\\/models\\//, /\\/repositories\\//],\n  'workflow-layer': [/\\/workflows\\//, /\\/agents\\//],\n  unknown: [],\n};\n\n/**\n * Determine architectural layer from file path\n */\nfunction detectArchLayer(filePath: string): ArchLayer {\n  for (const [layer, patterns] of Object.entries(LAYER_PATTERNS)) {\n    if (layer === 'unknown') continue;\n    if (patterns.some((p) => p.test(filePath))) {\n      return layer as ArchLayer;\n    }\n  }\n  return 'unknown';\n}\n\n/**\n * Load pattern hints from project patterns directory\n */\nfunction loadPatternHints(layer: ArchLayer, projectDir: string): string {\n  const patternsDir = join(projectDir, '.claude', 'context', 'patterns');\n  const layerPatternFile = join(patternsDir, `${layer}.json`);\n\n  try {\n    if (existsSync(layerPatternFile)) {\n      const content = readFileSync(layerPatternFile, 'utf8');\n      const patterns = JSON.parse(content);\n      const count = Array.isArray(patterns) ? patterns.length : Object.keys(patterns).length;\n      if (count > 0) {\n        return ` | Patterns loaded: ${count}`;\n      }\n    }\n  } catch {\n    // Ignore parse errors\n  }\n\n  return '';\n}\n\n/**\n * Detect architectural changes and inject context\n */\nexport function architectureChangeDetector(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Self-guard: Only run for architectural paths\n  const archPatterns = [\n    '**/api/**',\n    '**/services/**',\n    '**/db/**',\n    '**/models/**',\n    '**/workflows/**',\n  ];\n  const guardResult = guardPathPattern(input, ...archPatterns);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  // Determine architectural layer\n  const archLayer = detectArchLayer(filePath);\n\n  if (archLayer === 'unknown') {\n    return outputSilentSuccess();\n  }\n\n  // Load pattern hints\n  const patternHints = loadPatternHints(archLayer, projectDir);\n\n  // Check if file exists (new file vs modification)\n  const isNewFile = !existsSync(filePath);\n\n  // Build architecture context\n  let archContext: string;\n  if (isNewFile) {\n    archContext = `New ${archLayer} file. Follow layer conventions: dependency injection, interface contracts${patternHints}`;\n  } else {\n    archContext = `Modifying ${archLayer}. Ensure: no breaking API changes, maintain layer boundaries${patternHints}`;\n  }\n\n  logPermissionFeedback('allow', `Architectural change: ${filePath} (${archLayer})`, input);\n  logHook('architecture-change-detector', `ARCH_DETECT: ${filePath} (layer=${archLayer})`);\n\n  // CC 2.1.9: Inject context\n  return outputWithContext(archContext);\n}\n", "/**\n * Code Quality Gate Hook\n * Unified code quality checks before write\n * Consolidates: complexity-gate.sh + type-check-on-save.sh\n *\n * Analyzes code quality BEFORE allowing write:\n * - Checks function length (>50 lines = warning)\n * - Checks cyclomatic complexity patterns (nested if/loops)\n * - Checks for existing type errors in the file being modified (cached results)\n *\n * CC 2.1.9 Compliant: Uses additionalContext for quality warnings\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { guardCodeFiles, guardSkipInternal, runGuards } from '../../lib/guards.js';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join, dirname, extname } from 'node:path';\n\n// Thresholds\nconst MAX_FUNCTION_LINES = 50;\nconst MAX_NESTING_DEPTH = 4;\nconst MAX_CONDITIONALS_PER_FUNCTION = 10;\n\n/**\n * Get file extension in lowercase\n */\nfunction getFileExt(filePath: string): string {\n  return extname(filePath).toLowerCase().replace('.', '');\n}\n\n/**\n * Check for long functions in the content\n */\nfunction checkFunctionLength(content: string, ext: string): string[] {\n  const warnings: string[] = [];\n  const lines = content.split('\\n');\n\n  if (ext === 'py') {\n    // Python: Track function definitions and line counts\n    let inFunction = false;\n    let functionName = '';\n    let functionLines = 0;\n\n    for (const line of lines) {\n      const defMatch = line.match(/^(\\s*)(?:async\\s+)?def\\s+([a-zA-Z_][a-zA-Z0-9_]*)/);\n      const classMatch = line.match(/^(\\s*)class\\s+/);\n\n      if (defMatch) {\n        // Check previous function if too long\n        if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n          warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n        }\n\n        inFunction = true;\n        functionName = defMatch[2];\n        functionLines = 1;\n      } else if (classMatch) {\n        // Class definition resets function tracking\n        if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n          warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n        }\n        inFunction = false;\n      } else if (inFunction) {\n        // Count non-empty lines in function\n        if (line.trim()) {\n          functionLines++;\n        }\n      }\n    }\n\n    // Check last function\n    if (inFunction && functionLines > MAX_FUNCTION_LINES) {\n      warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n    }\n  } else if (['ts', 'tsx', 'js', 'jsx', 'go', 'java', 'rs'].includes(ext)) {\n    // Brace-based languages: Count lines between braces\n    let braceCount = 0;\n    let functionLines = 0;\n    let inFunction = false;\n    let functionName = '';\n\n    for (const line of lines) {\n      // Function detection\n      const funcMatch = line.match(/(?:function|func|fn)\\s+([a-zA-Z_][a-zA-Z0-9_]*)/);\n      const constFuncMatch = line.match(/const\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*(?:async\\s*)?\\(/);\n\n      if (funcMatch) {\n        functionName = funcMatch[1];\n        inFunction = true;\n        functionLines = 0;\n        braceCount = 0;\n      } else if (constFuncMatch) {\n        functionName = constFuncMatch[1];\n        inFunction = true;\n        functionLines = 0;\n        braceCount = 0;\n      }\n\n      if (inFunction) {\n        // Count braces\n        const openBraces = (line.match(/\\{/g) || []).length;\n        const closeBraces = (line.match(/\\}/g) || []).length;\n        braceCount += openBraces - closeBraces;\n\n        if (line.trim()) {\n          functionLines++;\n        }\n\n        // Function ended\n        if (braceCount <= 0 && functionLines > 0) {\n          if (functionLines > MAX_FUNCTION_LINES) {\n            warnings.push(`Function '${functionName}' is ${functionLines} lines (max: ${MAX_FUNCTION_LINES})`);\n          }\n          inFunction = false;\n        }\n      }\n    }\n  }\n\n  return warnings;\n}\n\n/**\n * Check for deep nesting (cyclomatic complexity indicator)\n */\nfunction checkNestingDepth(content: string, ext: string): string[] {\n  const warnings: string[] = [];\n  const lines = content.split('\\n');\n  let maxDepth = 0;\n\n  if (ext === 'py') {\n    // Python: Count indent levels at control structures\n    for (const line of lines) {\n      const match = line.match(/^(\\s*)(if|for|while|with|try|elif|else|except|finally)[\\s:]/);\n      if (match) {\n        const indent = match[1].length;\n        const depth = Math.floor(indent / 4); // Assume 4-space indent\n        if (depth > maxDepth) {\n          maxDepth = depth;\n        }\n      }\n    }\n  } else if (['ts', 'tsx', 'js', 'jsx', 'go', 'java', 'rs'].includes(ext)) {\n    // Brace-based: Count brace depth at control structures\n    let braceDepth = 0;\n    for (const line of lines) {\n      const openBraces = (line.match(/\\{/g) || []).length;\n      const closeBraces = (line.match(/\\}/g) || []).length;\n      braceDepth += openBraces - closeBraces;\n\n      // Check if this line has a control structure\n      if (/(?:if|for|while|switch|try)\\s*\\(/.test(line)) {\n        if (braceDepth > maxDepth) {\n          maxDepth = braceDepth;\n        }\n      }\n    }\n  }\n\n  if (maxDepth > MAX_NESTING_DEPTH) {\n    warnings.push(`Deep nesting detected (depth: ${maxDepth}, max: ${MAX_NESTING_DEPTH})`);\n  }\n\n  return warnings;\n}\n\n/**\n * Count conditionals (cyclomatic complexity heuristic)\n */\nfunction checkConditionals(content: string): string[] {\n  const warnings: string[] = [];\n\n  const ifCount = (content.match(/\\b(if|elif|else if)\\b/g) || []).length;\n  const switchCount = (content.match(/\\b(switch|match)\\b/g) || []).length;\n  const ternaryCount = (content.match(/\\?[^:]+:/g) || []).length;\n\n  const totalConditionals = ifCount + switchCount + ternaryCount;\n\n  // Estimate functions\n  const functionCount = Math.max((content.match(/\\b(def|function|func|fn)\\b/g) || []).length, 1);\n  const avgConditionals = Math.floor(totalConditionals / functionCount);\n\n  if (avgConditionals > MAX_CONDITIONALS_PER_FUNCTION) {\n    warnings.push(`High cyclomatic complexity (~${avgConditionals} conditionals/function, consider refactoring)`);\n  }\n\n  return warnings;\n}\n\n/**\n * Get cached type errors for a file\n */\nfunction getCachedTypeErrors(filePath: string, projectDir: string): string {\n  const cacheFile = join(projectDir, '.claude', 'cache', 'type-errors.json');\n\n  if (!existsSync(cacheFile)) {\n    return '';\n  }\n\n  try {\n    const cache = JSON.parse(readFileSync(cacheFile, 'utf8'));\n    const basename = filePath.split('/').pop() || '';\n    return cache[basename] || '';\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Code quality gate - analyzes quality before allowing write\n */\nexport function codeQualityGate(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles, guardSkipInternal);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath || !content) {\n    return outputSilentSuccess();\n  }\n\n  const ext = getFileExt(filePath);\n  const allWarnings: string[] = [];\n\n  // Run complexity checks\n  allWarnings.push(...checkFunctionLength(content, ext));\n  allWarnings.push(...checkNestingDepth(content, ext));\n  allWarnings.push(...checkConditionals(content));\n\n  // Check cached type errors\n  const typeErrors = getCachedTypeErrors(filePath, projectDir);\n  if (typeErrors) {\n    allWarnings.push(typeErrors);\n  }\n\n  // Build quality message\n  if (allWarnings.length > 0) {\n    logHook('code-quality-gate', `Quality warnings for ${filePath}: ${allWarnings.join(', ')}`);\n\n    let qualityMsg = `Code quality: ${allWarnings.join(' | ')}`;\n\n    // Truncate if too long\n    if (qualityMsg.length > 350) {\n      qualityMsg = qualityMsg.slice(0, 347) + '...';\n    }\n\n    return outputWithContext(qualityMsg);\n  }\n\n  logHook('code-quality-gate', `No quality issues in ${filePath}`);\n  return outputSilentSuccess();\n}\n", "/**\n * Docstring Enforcer Hook\n * Checks if public functions have docstrings\n * For Python: checks for triple-quote docstrings\n * For TypeScript: checks for JSDoc comments\n *\n * CC 2.1.9 Enhanced: Uses additionalContext for warnings (does not block)\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n} from '../../lib/common.js';\nimport { guardCodeFiles, guardSkipInternal, runGuards } from '../../lib/guards.js';\nimport { extname } from 'node:path';\n\n/**\n * Get file extension in lowercase\n */\nfunction getFileExt(filePath: string): string {\n  return extname(filePath).toLowerCase().replace('.', '');\n}\n\n/**\n * Check if file is a test file\n */\nfunction isTestFile(filePath: string): boolean {\n  const testPatterns = [\n    /test/i,\n    /spec/i,\n    /__tests__/i,\n    /_test\\.py$/,\n    /\\.test\\.ts$/,\n    /\\.spec\\.ts$/,\n  ];\n  return testPatterns.some((p) => p.test(filePath));\n}\n\n/**\n * Find Python functions missing docstrings\n */\nfunction findMissingPythonDocstrings(content: string): string[] {\n  const missing: string[] = [];\n  const lines = content.split('\\n');\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    // Match public function definitions (not starting with _)\n    const funcMatch = line.match(/^(?:\\s*)(?:async\\s+)?def\\s+([^_][a-zA-Z0-9_]*)\\s*\\(/);\n\n    if (funcMatch) {\n      const funcName = funcMatch[1];\n\n      // Look for docstring on next non-empty line\n      let hasDocstring = false;\n      for (let j = i + 1; j < lines.length; j++) {\n        const nextLine = lines[j].trim();\n        if (!nextLine) continue; // Skip empty lines\n\n        if (nextLine.startsWith('\"\"\"') || nextLine.startsWith(\"'''\")) {\n          hasDocstring = true;\n        }\n        break;\n      }\n\n      if (!hasDocstring) {\n        missing.push(funcName);\n        if (missing.length >= 5) break; // Limit to 5\n      }\n    }\n  }\n\n  return missing;\n}\n\n/**\n * Find TypeScript/JavaScript exported functions missing JSDoc\n */\nfunction findMissingJSDoc(content: string): string[] {\n  const missing: string[] = [];\n  const lines = content.split('\\n');\n\n  let hasJSDoc = false;\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const prevLine = i > 0 ? lines[i - 1].trim() : '';\n\n    // Check if previous line ends JSDoc\n    if (prevLine.endsWith('*/')) {\n      hasJSDoc = true;\n    }\n\n    // Check for exported function\n    const exportMatch = line.match(\n      /^export\\s+(?:async\\s+)?(?:function\\s+([a-zA-Z][a-zA-Z0-9_]*)|const\\s+([a-zA-Z][a-zA-Z0-9_]*)\\s*=)/\n    );\n\n    if (exportMatch) {\n      const funcName = exportMatch[1] || exportMatch[2];\n\n      if (!hasJSDoc) {\n        missing.push(funcName);\n        if (missing.length >= 5) break; // Limit to 5\n      }\n      hasJSDoc = false;\n    } else if (!line.trim().endsWith('*/')) {\n      hasJSDoc = false;\n    }\n  }\n\n  return missing;\n}\n\n/**\n * Docstring enforcer - warns about missing documentation\n */\nexport function docstringEnforcer(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles, guardSkipInternal);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath || !content) {\n    return outputSilentSuccess();\n  }\n\n  // Skip test files - docstrings are less critical\n  if (isTestFile(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  const ext = getFileExt(filePath);\n  let missingDocstrings: string[] = [];\n\n  if (ext === 'py') {\n    missingDocstrings = findMissingPythonDocstrings(content);\n  } else if (['ts', 'tsx', 'js', 'jsx'].includes(ext)) {\n    missingDocstrings = findMissingJSDoc(content);\n  }\n\n  if (missingDocstrings.length > 0) {\n    const funcList = missingDocstrings.join(', ');\n    let contextMsg: string;\n\n    if (ext === 'py') {\n      contextMsg = `Documentation: ${missingDocstrings.length} public function(s) missing docstrings: ${funcList}. Consider adding \"\"\"docstrings\"\"\" for better code documentation.`;\n    } else {\n      contextMsg = `Documentation: ${missingDocstrings.length} exported function(s) missing JSDoc: ${funcList}. Consider adding /** JSDoc */ comments for better IDE support.`;\n    }\n\n    // Truncate if too long\n    if (contextMsg.length > 200) {\n      if (ext === 'py') {\n        contextMsg = `Documentation: ${missingDocstrings.length} public function(s) missing docstrings. Add \"\"\"docstrings\"\"\" for better documentation.`;\n      } else {\n        contextMsg = `Documentation: ${missingDocstrings.length} exported function(s) missing JSDoc. Add /** JSDoc */ for better IDE support.`;\n      }\n    }\n\n    logHook('docstring-enforcer', `DOCSTRING_WARN: ${missingDocstrings.length} functions missing docs in ${filePath}`);\n    return outputWithContext(contextMsg);\n  }\n\n  // All public functions documented - allow silently\n  logHook('docstring-enforcer', `DOCSTRING_OK: All public functions documented in ${filePath}`);\n  return outputSilentSuccess();\n}\n", "/**\n * Security Pattern Validator Hook\n * Detects security anti-patterns before write\n * CC 2.1.7 Compliant: Self-contained hook with stdin reading and self-guard\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\nimport { guardCodeFiles, runGuards } from '../../lib/guards.js';\nimport { basename } from 'node:path';\n\n/**\n * Security patterns to detect\n */\ninterface SecurityPattern {\n  name: string;\n  pattern: RegExp;\n  severity: 'high' | 'medium' | 'low';\n}\n\nconst SECURITY_PATTERNS: SecurityPattern[] = [\n  {\n    name: 'Potential hardcoded secret detected',\n    pattern: /(api[_-]?key|password|secret|token)\\s*[=:]\\s*['\"][^'\"]+['\"]/i,\n    severity: 'high',\n  },\n  {\n    name: 'Potential SQL injection vulnerability',\n    pattern: /execute\\s*\\(\\s*['\"].*\\+|f['\"].*SELECT.*\\{/,\n    severity: 'high',\n  },\n  {\n    name: 'Dangerous eval/exec usage detected',\n    pattern: /eval\\s*\\(|exec\\s*\\(/,\n    severity: 'high',\n  },\n  {\n    name: 'Subprocess with shell=True detected',\n    pattern: /subprocess\\.(run|call|Popen).*shell\\s*=\\s*True/,\n    severity: 'medium',\n  },\n  {\n    name: 'Potential XSS vulnerability (innerHTML)',\n    pattern: /\\.innerHTML\\s*=|dangerouslySetInnerHTML/,\n    severity: 'medium',\n  },\n  {\n    name: 'Insecure random number generation',\n    pattern: /Math\\.random\\(\\).*(?:password|token|secret|key)/i,\n    severity: 'medium',\n  },\n  {\n    name: 'Potential command injection',\n    pattern: /os\\.system\\s*\\(|os\\.popen\\s*\\(/,\n    severity: 'high',\n  },\n  {\n    name: 'Insecure HTTP (should use HTTPS)',\n    pattern: /http:\\/\\/(?!localhost|127\\.0\\.0\\.1)/,\n    severity: 'low',\n  },\n];\n\n/**\n * Detect security issues in content\n */\nfunction detectSecurityIssues(content: string): string[] {\n  const issues: string[] = [];\n\n  for (const { name, pattern } of SECURITY_PATTERNS) {\n    if (pattern.test(content)) {\n      issues.push(name);\n    }\n  }\n\n  return issues;\n}\n\n/**\n * Security pattern validator - detects anti-patterns before write\n */\nexport function securityPatternValidator(input: HookInput): HookResult {\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Apply guards\n  const guardResult = runGuards(input, guardCodeFiles);\n  if (guardResult !== null) {\n    return guardResult;\n  }\n\n  if (!filePath) {\n    return outputSilentSuccess();\n  }\n\n  // Detect security issues\n  const securityIssues = detectSecurityIssues(content);\n\n  if (securityIssues.length > 0) {\n    logHook('security-pattern-validator', `SECURITY_WARN: ${filePath} - ${securityIssues.join(', ')}`);\n\n    // Build warning message\n    const warningMsg = `Security warnings for ${basename(filePath)}: ${securityIssues.join(', ')}`;\n    logPermissionFeedback('warn', `Security issues in ${filePath}: ${securityIssues.join(', ')}`, input);\n\n    // CC 2.1.9: Use additionalContext for warnings\n    return outputWithContext(warningMsg);\n  }\n\n  logHook('security-pattern-validator', `SECURITY_OK: ${filePath}`);\n  logPermissionFeedback('allow', `No security issues in ${filePath}`, input);\n  return outputSilentSuccess();\n}\n", "/**\n * Context7 Documentation Tracker Hook\n * Tracks context7 library lookups and injects cache state as additionalContext\n * CC 2.1.9 Enhanced\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  logPermissionFeedback,\n  getLogDir,\n} from '../../lib/common.js';\nimport { existsSync, readFileSync, writeFileSync, appendFileSync, statSync, renameSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\n\nconst MAX_LOG_SIZE = 102400; // 100KB\n\n/**\n * Get telemetry log path\n */\nfunction getTelemetryLog(): string {\n  const logDir = getLogDir();\n  return join(logDir, 'context7-telemetry.log');\n}\n\n/**\n * Rotate log file if needed\n */\nfunction rotateLogIfNeeded(logFile: string): void {\n  try {\n    if (existsSync(logFile)) {\n      const stats = statSync(logFile);\n      if (stats.size > MAX_LOG_SIZE) {\n        renameSync(logFile, `${logFile}.old`);\n      }\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Calculate cache context from telemetry\n */\nfunction calculateCacheContext(logFile: string): string {\n  if (!existsSync(logFile)) {\n    return '';\n  }\n\n  try {\n    const content = readFileSync(logFile, 'utf8');\n    const lines = content.trim().split('\\n').filter(Boolean);\n\n    const totalQueries = lines.length;\n    if (totalQueries === 0) {\n      return '';\n    }\n\n    // Extract unique libraries\n    const librarySet = new Set<string>();\n    for (const line of lines) {\n      const match = line.match(/library=([^| ]+)/);\n      if (match && match[1] && match[1] !== '') {\n        librarySet.add(match[1]);\n      }\n    }\n\n    // Get recent unique libraries (last 3)\n    const recentLibraries: string[] = [];\n    for (let i = lines.length - 1; i >= 0 && recentLibraries.length < 3; i--) {\n      const match = lines[i].match(/library=([^| ]+)/);\n      if (match && match[1] && !recentLibraries.includes(match[1])) {\n        recentLibraries.push(match[1]);\n      }\n    }\n\n    const recentStr = recentLibraries.length > 0 ? recentLibraries.join(', ') : 'none';\n    return `Context7: ${totalQueries} queries, ${librarySet.size} libraries. Recent: ${recentStr}`;\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Context7 tracker - tracks library lookups and injects cache state\n */\nexport function context7Tracker(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process context7 MCP calls\n  if (!toolName.startsWith('mcp__context7__')) {\n    return outputSilentSuccess();\n  }\n\n  const libraryId = (input.tool_input.libraryId as string) || '';\n  const query = (input.tool_input.query as string) || '';\n\n  // Get log file path\n  const logDir = getLogDir();\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore mkdir errors\n  }\n\n  const telemetryLog = getTelemetryLog();\n  rotateLogIfNeeded(telemetryLog);\n\n  // Log the query\n  const timestamp = new Date().toISOString();\n  const logEntry = `${timestamp} | tool=${toolName} | library=${libraryId} | query_length=${query.length}\\n`;\n\n  try {\n    appendFileSync(telemetryLog, logEntry);\n  } catch {\n    // Ignore log errors\n  }\n\n  // Calculate cache context\n  const cacheContext = calculateCacheContext(telemetryLog);\n\n  logPermissionFeedback('allow', `Documentation lookup: ${libraryId}`, input);\n  logHook('context7-tracker', `Query: ${toolName} library=${libraryId}`);\n\n  // CC 2.1.9: Inject cache context if available\n  if (cacheContext) {\n    return outputWithContext(cacheContext);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Fabric Lazy Initialization Hook\n * Triggered once on first memory MCP call (CC 2.1.0 once:true)\n *\n * Graph-First Architecture (v2.1):\n * - Knowledge graph is ALWAYS ready (no configuration needed)\n * - Mem0 is optional enhancement (only if MEM0_API_KEY set)\n * - No warnings for missing mem0 - it's an enhancement, not a requirement\n *\n * Purpose: Perform one-time setup when memory is first used, rather than at session start.\n * This avoids overhead for sessions that never use memory operations.\n *\n * CC 2.1.9: Uses additionalContext for initialization message\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWithContext,\n  logHook,\n  getProjectDir,\n  getSessionId,\n} from '../../lib/common.js';\nimport { existsSync, mkdirSync, readFileSync, writeFileSync, readdirSync } from 'node:fs';\nimport { join } from 'node:path';\n\n/**\n * Check for orphaned sessions that might have pending syncs\n */\nfunction checkOrphanedSessions(projectDir: string, currentSessionId: string): number {\n  const logsDir = join(projectDir, '.claude', 'logs');\n  let orphanedCount = 0;\n\n  if (!existsSync(logsDir)) {\n    return 0;\n  }\n\n  try {\n    const files = readdirSync(logsDir);\n    for (const file of files) {\n      if (file.startsWith('.mem0-pending-sync-') && file.endsWith('.json')) {\n        // Extract session ID from filename\n        const sessionId = file.replace('.mem0-pending-sync-', '').replace('.json', '');\n        if (sessionId !== currentSessionId && sessionId !== 'unknown') {\n          orphanedCount++;\n        }\n      }\n    }\n  } catch {\n    // Ignore errors\n  }\n\n  return orphanedCount;\n}\n\n/**\n * Initialize memory directories if needed\n */\nfunction initDirectories(projectDir: string): void {\n  const dirs = [\n    join(projectDir, '.claude', 'logs', 'mem0-processed'),\n    join(projectDir, '.claude', 'context', 'session'),\n  ];\n\n  for (const dir of dirs) {\n    try {\n      mkdirSync(dir, { recursive: true });\n    } catch {\n      // Ignore mkdir errors\n    }\n  }\n}\n\n/**\n * Validate MCP health (Graph-First architecture)\n */\nfunction validateMcpHealth(): 'enhanced' | 'ready' {\n  // Graph-First: graph is always ready, mem0 is optional enhancement\n  if (process.env.MEM0_API_KEY) {\n    return 'enhanced'; // Both graph and mem0 available\n  }\n  return 'ready'; // Graph-only mode (default, fully functional)\n}\n\n/**\n * Register this session as active\n */\nfunction registerSession(projectDir: string, sessionId: string): void {\n  const orphanCheckFile = join(projectDir, '.claude', 'logs', '.memory-fabric-sessions.json');\n  const now = new Date().toISOString();\n\n  try {\n    mkdirSync(join(projectDir, '.claude', 'logs'), { recursive: true });\n\n    let sessions: Record<string, { active: boolean; last_seen: string }> = {};\n\n    if (existsSync(orphanCheckFile)) {\n      const content = readFileSync(orphanCheckFile, 'utf8');\n      const data = JSON.parse(content);\n      sessions = data.sessions || {};\n    }\n\n    sessions[sessionId] = { active: true, last_seen: now };\n    writeFileSync(orphanCheckFile, JSON.stringify({ sessions }, null, 2));\n  } catch {\n    // Ignore registration errors\n  }\n}\n\n/**\n * Memory Fabric lazy initialization\n */\nexport function memoryFabricInit(input: HookInput): HookResult {\n  const projectDir = input.project_dir || getProjectDir();\n  const sessionId = input.session_id || getSessionId();\n\n  logHook('memory-fabric-init', 'Memory Fabric lazy initialization triggered');\n\n  // Run initialization tasks\n  initDirectories(projectDir);\n  registerSession(projectDir, sessionId);\n\n  // Check for orphaned sessions\n  const orphanedCount = checkOrphanedSessions(projectDir, sessionId);\n\n  // Validate MCP health\n  const health = validateMcpHealth();\n\n  logHook('memory-fabric-init', `Initialization complete: health=${health}, orphaned=${orphanedCount}`);\n\n  // Build initialization message (only for issues)\n  let msg = '';\n\n  // Only warn about orphaned sessions (actual issue that needs attention)\n  if (orphanedCount > 0) {\n    msg = `[Memory Fabric] Detected ${orphanedCount} orphaned session(s) with pending syncs.\\nConsider running maintenance: claude --maintenance`;\n  }\n\n  // Graph-First: Log positive status\n  if (health === 'enhanced') {\n    logHook('memory-fabric-init', 'Memory Fabric ready (enhanced mode with mem0)');\n  } else {\n    logHook('memory-fabric-init', 'Memory Fabric ready (graph mode)');\n  }\n\n  // If there's something to report (only orphaned sessions), output it\n  if (msg) {\n    return outputWithContext(msg);\n  }\n\n  // Silent success - Memory Fabric ready (no issues to report)\n  return outputSilentSuccess();\n}\n", "/**\n * Memory Knowledge Graph Validator Hook\n * Validates memory operations to prevent accidental data loss\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  outputWarning,\n  logHook,\n  logPermissionFeedback,\n} from '../../lib/common.js';\n\n/**\n * Memory validator - validates memory operations\n */\nexport function memoryValidator(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process memory MCP calls\n  if (!toolName.startsWith('mcp__memory__')) {\n    return outputSilentSuccess();\n  }\n\n  switch (toolName) {\n    case 'mcp__memory__delete_entities': {\n      // Check for bulk deletion\n      const entityNames = input.tool_input.entityNames;\n      const entityCount = Array.isArray(entityNames) ? entityNames.length : 0;\n\n      if (entityCount > 5) {\n        logPermissionFeedback('warn', `Bulk delete: ${entityCount} entities`, input);\n        logHook('memory-validator', `WARN: Bulk entity delete: ${entityCount} entities`);\n\n        // Warn but allow - let user confirm\n        return outputWarning(`Deleting ${entityCount} entities from knowledge graph`);\n      }\n      break;\n    }\n\n    case 'mcp__memory__delete_relations': {\n      // Check for bulk relation deletion\n      const relations = input.tool_input.relations;\n      const relationCount = Array.isArray(relations) ? relations.length : 0;\n\n      if (relationCount > 10) {\n        logPermissionFeedback('warn', `Bulk relation delete: ${relationCount} relations`, input);\n        logHook('memory-validator', `WARN: Bulk relation delete: ${relationCount} relations`);\n\n        return outputWarning(`Deleting ${relationCount} relations from knowledge graph`);\n      }\n      break;\n    }\n\n    case 'mcp__memory__create_entities': {\n      // Validate entity structure\n      const entities = input.tool_input.entities;\n      if (!Array.isArray(entities)) {\n        logPermissionFeedback('allow', 'Creating entities (non-array input)', input);\n        return outputSilentSuccess();\n      }\n\n      const entityCount = entities.length;\n\n      // Check each entity has required fields\n      const invalidCount = entities.filter(\n        (e: Record<string, unknown>) => !e.name || e.name === '' || !e.entityType || e.entityType === ''\n      ).length;\n\n      if (invalidCount > 0) {\n        logPermissionFeedback('warn', `Invalid entities: ${invalidCount} missing name or entityType`, input);\n        logHook('memory-validator', `WARN: ${invalidCount} entities missing required fields`);\n\n        return outputWarning(`${invalidCount} entities missing required fields (name, entityType)`);\n      }\n\n      logPermissionFeedback('allow', `Creating ${entityCount} valid entities`, input);\n      break;\n    }\n\n    case 'mcp__memory__create_relations': {\n      // Validate relation structure\n      const relations = input.tool_input.relations;\n      if (!Array.isArray(relations)) {\n        logPermissionFeedback('allow', 'Creating relations (non-array input)', input);\n        return outputSilentSuccess();\n      }\n\n      const relationCount = relations.length;\n\n      // Check each relation has required fields\n      const invalidCount = relations.filter(\n        (r: Record<string, unknown>) => !r.from || !r.to || !r.relationType\n      ).length;\n\n      if (invalidCount > 0) {\n        logPermissionFeedback('warn', `Invalid relations: ${invalidCount} missing from/to/relationType`, input);\n        logHook('memory-validator', `WARN: ${invalidCount} relations missing required fields`);\n\n        return outputWarning(`${invalidCount} relations missing required fields`);\n      }\n\n      logPermissionFeedback('allow', `Creating ${relationCount} valid relations`, input);\n      break;\n    }\n\n    default:\n      // Read operations - always allow\n      logPermissionFeedback('allow', `Read operation: ${toolName}`, input);\n      break;\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Sequential Thinking Auto-Tracker Hook\n * Tracks sequential thinking usage for complex reasoning tasks\n * CC 2.1.7 Compliant\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  logHook,\n  logPermissionFeedback,\n  getLogDir,\n} from '../../lib/common.js';\nimport { existsSync, appendFileSync, statSync, renameSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\n\nconst MAX_LOG_SIZE = 102400; // 100KB\n\n/**\n * Get thinking log path\n */\nfunction getThinkingLog(): string {\n  const logDir = getLogDir();\n  return join(logDir, 'sequential-thinking.log');\n}\n\n/**\n * Rotate log file if needed\n */\nfunction rotateLogIfNeeded(logFile: string): void {\n  try {\n    if (existsSync(logFile)) {\n      const stats = statSync(logFile);\n      if (stats.size > MAX_LOG_SIZE) {\n        renameSync(logFile, `${logFile}.old`);\n      }\n    }\n  } catch {\n    // Ignore rotation errors\n  }\n}\n\n/**\n * Sequential thinking tracker - tracks reasoning chain progress\n */\nexport function sequentialThinkingAuto(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n\n  // Only process sequential-thinking MCP calls\n  if (!toolName.startsWith('mcp__sequential-thinking__')) {\n    return outputSilentSuccess();\n  }\n\n  // Extract thinking details\n  const thought = (input.tool_input.thought as string) || '';\n  const thoughtNumber = (input.tool_input.thoughtNumber as number) || 1;\n  const totalThoughts = (input.tool_input.totalThoughts as number) || 1;\n  const nextNeeded = (input.tool_input.nextThoughtNeeded as boolean) || false;\n  const isRevision = (input.tool_input.isRevision as boolean) || false;\n\n  // Get log file path\n  const logDir = getLogDir();\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Ignore mkdir errors\n  }\n\n  const thinkingLog = getThinkingLog();\n  rotateLogIfNeeded(thinkingLog);\n\n  // Log the thinking step\n  const timestamp = new Date().toISOString();\n  const logEntry = `${timestamp} | step=${thoughtNumber}/${totalThoughts} | revision=${isRevision} | next_needed=${nextNeeded} | thought_length=${thought.length}\\n`;\n\n  try {\n    appendFileSync(thinkingLog, logEntry);\n  } catch {\n    // Ignore log errors\n  }\n\n  // Track reasoning chain progress\n  if (thoughtNumber === 1) {\n    logPermissionFeedback('allow', `Starting reasoning chain (${totalThoughts} estimated thoughts)`, input);\n    logHook('sequential-thinking-auto', `Starting chain: ${totalThoughts} thoughts`);\n  } else if (isRevision) {\n    logPermissionFeedback('allow', `Revision at step ${thoughtNumber}`, input);\n    logHook('sequential-thinking-auto', `Revision at step ${thoughtNumber}`);\n  } else if (!nextNeeded) {\n    logPermissionFeedback('allow', `Completed reasoning chain at step ${thoughtNumber}`, input);\n    logHook('sequential-thinking-auto', `Completed at step ${thoughtNumber}`);\n  } else {\n    logPermissionFeedback('allow', `Reasoning step ${thoughtNumber}/${totalThoughts}`, input);\n    logHook('sequential-thinking-auto', `Step ${thoughtNumber}/${totalThoughts}`);\n  }\n\n  return outputSilentSuccess();\n}\n", "/**\n * Write Headers Hook\n * Adds standard headers to new files being created\n * Part of OrchestKit Claude Plugin\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport { outputSilentSuccess, logHook } from '../../lib/common.js';\nimport { existsSync } from 'node:fs';\nimport { extname } from 'node:path';\n\n/**\n * Get current date in YYYY-MM-DD format\n */\nfunction getCurrentDate(): string {\n  return new Date().toISOString().split('T')[0];\n}\n\n/**\n * Add header based on file type\n */\nfunction addHeader(ext: string, content: string): string {\n  const date = getCurrentDate();\n\n  switch (ext.toLowerCase()) {\n    case 'py':\n      return `# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n\n    case 'js':\n    case 'ts':\n      return `// Generated by OrchestKit Claude Plugin\n// Created: ${date}\n\n${content}`;\n\n    case 'sh': {\n      // For shell scripts, add after shebang if present\n      if (content.startsWith('#!/')) {\n        const firstNewline = content.indexOf('\\n');\n        const shebang = content.slice(0, firstNewline);\n        const rest = content.slice(firstNewline + 1);\n        return `${shebang}\n# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${rest}`;\n      }\n      return `#!/bin/bash\n# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n    }\n\n    case 'sql':\n      return `-- Generated by OrchestKit Claude Plugin\n-- Created: ${date}\n\n${content}`;\n\n    case 'html':\n    case 'xml':\n      return `<!-- Generated by OrchestKit Claude Plugin - ${date} -->\n\n${content}`;\n\n    case 'css':\n    case 'scss':\n    case 'sass':\n      return `/* Generated by OrchestKit Claude Plugin - ${date} */\n\n${content}`;\n\n    case 'yaml':\n    case 'yml':\n      return `# Generated by OrchestKit Claude Plugin\n# Created: ${date}\n\n${content}`;\n\n    case 'json':\n      // Don't add header for JSON (would break JSON format)\n      return content;\n\n    default:\n      // No header for unknown file types\n      return content;\n  }\n}\n\n/**\n * Create result with updated input\n */\nfunction createUpdatedInputResult(filePath: string, content: string): HookResult {\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'allow',\n      // Note: updatedInput is not in the HookSpecificOutput type\n      // but is used by CC for input modification\n    },\n  } as HookResult;\n}\n\n/**\n * Write headers hook - adds headers to new files\n */\nexport function writeHeaders(input: HookInput): HookResult {\n  const toolName = input.tool_name || '';\n  const filePath = input.tool_input.file_path || '';\n  const content = input.tool_input.content || '';\n\n  // Only process Write tool (not Edit - those are existing files)\n  if (toolName !== 'Write') {\n    return outputSilentSuccess();\n  }\n\n  // Check if file already exists (skip header if it does)\n  if (existsSync(filePath)) {\n    return outputSilentSuccess();\n  }\n\n  // Get file extension\n  const ext = extname(filePath).replace('.', '');\n\n  // Skip if content already contains OrchestKit header\n  if (content.includes('OrchestKit')) {\n    logHook('write-headers', `Skipping header for ${filePath} (already has OrchestKit marker)`);\n    return outputSilentSuccess();\n  }\n\n  // Add header\n  const updatedContent = addHeader(ext, content);\n  const headerAdded = updatedContent !== content;\n\n  if (headerAdded) {\n    logHook('write-headers', `Added header to ${filePath}`);\n  }\n\n  // Return result with updated input\n  // Note: This uses the CC input modification pattern\n  return {\n    continue: true,\n    suppressOutput: true,\n    hookSpecificOutput: {\n      hookEventName: 'PreToolUse',\n      permissionDecision: 'allow',\n    },\n  };\n}\n", "/**\n * Skill Tracker Hook\n * Logs Skill tool invocations with analytics\n * CC 2.1.6 Compliant: includes continue field in all outputs\n *\n * Enhanced for Phase 4: Skill Usage Analytics (#56)\n * - Tracks skill usage patterns over time\n * - Enables context efficiency optimization\n */\n\nimport type { HookInput, HookResult } from '../../types.js';\nimport {\n  outputSilentSuccess,\n  logHook,\n  getProjectDir,\n} from '../../lib/common.js';\nimport { existsSync, appendFileSync, mkdirSync } from 'node:fs';\nimport { join, dirname, basename } from 'node:path';\n\n/**\n * Ensure directory exists\n */\nfunction ensureDir(dir: string): void {\n  try {\n    if (!existsSync(dir)) {\n      mkdirSync(dir, { recursive: true });\n    }\n  } catch {\n    // Ignore mkdir errors\n  }\n}\n\n/**\n * Append to file safely\n */\nfunction appendSafe(file: string, content: string): void {\n  try {\n    ensureDir(dirname(file));\n    appendFileSync(file, content);\n  } catch {\n    // Ignore append errors\n  }\n}\n\n/**\n * Skill tracker - logs skill invocations with analytics\n */\nexport function skillTracker(input: HookInput): HookResult {\n  const skillName = (input.tool_input.skill as string) || '';\n  const skillArgs = (input.tool_input.args as string) || '';\n  const projectDir = input.project_dir || getProjectDir();\n\n  if (!skillName) {\n    return outputSilentSuccess();\n  }\n\n  logHook('skill-tracker', `Skill invocation: ${skillName}${skillArgs ? ` (args: ${skillArgs})` : ''}`);\n\n  // Log to temporary usage log for quick access\n  const usageLog = join(projectDir, '.claude', 'logs', 'skill-usage.log');\n  const timestamp = new Date().toISOString();\n  appendSafe(usageLog, `${timestamp} | ${skillName} | ${skillArgs || 'no args'}\\n`);\n\n  // Log to JSONL for detailed analytics\n  const analyticsLog = join(projectDir, '.claude', 'logs', 'skill-analytics.jsonl');\n  const analyticsEntry = JSON.stringify({\n    skill: skillName,\n    args: skillArgs || '',\n    timestamp,\n    project: basename(projectDir),\n    phase: 'start',\n  });\n  appendSafe(analyticsLog, analyticsEntry + '\\n');\n\n  logHook('skill-tracker', `Skill usage logged for ${skillName}`);\n\n  // CC 2.1.6 Compliant: JSON output without ANSI colors\n  return outputSilentSuccess();\n}\n", "/**\n * PreTool Hooks Entry Point\n *\n * Hooks that run before tool execution (PreToolUse validation/modification)\n * Bundle: pretool.mjs (~70 KB estimated - largest bundle)\n */\n\n// Re-export types and utilities\nexport * from '../types.js';\nexport * from '../lib/common.js';\nexport * from '../lib/git.js';\nexport * from '../lib/guards.js';\n\n// PreTool/Bash hooks (20)\nimport { dangerousCommandBlocker } from '../pretool/bash/dangerous-command-blocker.js';\nimport { gitBranchProtection } from '../pretool/bash/git-branch-protection.js';\nimport { gitCommitMessageValidator } from '../pretool/bash/git-commit-message-validator.js';\nimport { gitBranchNamingValidator } from '../pretool/bash/git-branch-naming-validator.js';\nimport { gitAtomicCommitChecker } from '../pretool/bash/git-atomic-commit-checker.js';\nimport { compoundCommandValidator } from '../pretool/bash/compound-command-validator.js';\nimport { defaultTimeoutSetter } from '../pretool/bash/default-timeout-setter.js';\nimport { errorPatternWarner } from '../pretool/bash/error-pattern-warner.js';\nimport { conflictPredictor } from '../pretool/bash/conflict-predictor.js';\nimport { affectedTestsFinder } from '../pretool/bash/affected-tests-finder.js';\nimport { ciSimulation } from '../pretool/bash/ci-simulation.js';\nimport { preCommitSimulation } from '../pretool/bash/pre-commit-simulation.js';\nimport { prMergeGate } from '../pretool/bash/pr-merge-gate.js';\nimport { changelogGenerator } from '../pretool/bash/changelog-generator.js';\nimport { versionSync } from '../pretool/bash/version-sync.js';\nimport { licenseCompliance } from '../pretool/bash/license-compliance.js';\nimport { ghIssueCreationGuide } from '../pretool/bash/gh-issue-creation-guide.js';\nimport { issueDocsRequirement } from '../pretool/bash/issue-docs-requirement.js';\nimport { multiInstanceQualityGate } from '../pretool/bash/multi-instance-quality-gate.js';\nimport { agentBrowserSafety } from '../pretool/bash/agent-browser-safety.js';\n\n// PreTool/Write-Edit hooks (3)\nimport { fileGuard } from '../pretool/write-edit/file-guard.js';\nimport { fileLockCheck } from '../pretool/write-edit/file-lock-check.js';\nimport { multiInstanceLock } from '../pretool/write-edit/multi-instance-lock.js';\n\n// PreTool/Write hooks (4)\nimport { architectureChangeDetector } from '../pretool/Write/architecture-change-detector.js';\nimport { codeQualityGate } from '../pretool/Write/code-quality-gate.js';\nimport { docstringEnforcer } from '../pretool/Write/docstring-enforcer.js';\nimport { securityPatternValidator } from '../pretool/Write/security-pattern-validator.js';\n\n// PreTool/MCP hooks (4)\nimport { context7Tracker } from '../pretool/mcp/context7-tracker.js';\nimport { memoryFabricInit } from '../pretool/mcp/memory-fabric-init.js';\nimport { memoryValidator } from '../pretool/mcp/memory-validator.js';\nimport { sequentialThinkingAuto } from '../pretool/mcp/sequential-thinking-auto.js';\n\n// PreTool/InputMod hooks (1)\nimport { writeHeaders } from '../pretool/input-mod/write-headers.js';\n\n// PreTool/Skill hooks (1)\nimport { skillTracker } from '../pretool/skill/skill-tracker.js';\n\nimport type { HookFn } from '../types.js';\n\n/**\n * PreTool hooks registry\n */\nexport const hooks: Record<string, HookFn> = {\n  // PreTool/Bash hooks (20)\n  'pretool/bash/dangerous-command-blocker': dangerousCommandBlocker,\n  'pretool/bash/git-branch-protection': gitBranchProtection,\n  'pretool/bash/git-commit-message-validator': gitCommitMessageValidator,\n  'pretool/bash/git-branch-naming-validator': gitBranchNamingValidator,\n  'pretool/bash/git-atomic-commit-checker': gitAtomicCommitChecker,\n  'pretool/bash/compound-command-validator': compoundCommandValidator,\n  'pretool/bash/default-timeout-setter': defaultTimeoutSetter,\n  'pretool/bash/error-pattern-warner': errorPatternWarner,\n  'pretool/bash/conflict-predictor': conflictPredictor,\n  'pretool/bash/affected-tests-finder': affectedTestsFinder,\n  'pretool/bash/ci-simulation': ciSimulation,\n  'pretool/bash/pre-commit-simulation': preCommitSimulation,\n  'pretool/bash/pr-merge-gate': prMergeGate,\n  'pretool/bash/changelog-generator': changelogGenerator,\n  'pretool/bash/version-sync': versionSync,\n  'pretool/bash/license-compliance': licenseCompliance,\n  'pretool/bash/gh-issue-creation-guide': ghIssueCreationGuide,\n  'pretool/bash/issue-docs-requirement': issueDocsRequirement,\n  'pretool/bash/multi-instance-quality-gate': multiInstanceQualityGate,\n  'pretool/bash/agent-browser-safety': agentBrowserSafety,\n\n  // PreTool/Write-Edit hooks (3)\n  'pretool/write-edit/file-guard': fileGuard,\n  'pretool/write-edit/file-lock-check': fileLockCheck,\n  'pretool/write-edit/multi-instance-lock': multiInstanceLock,\n\n  // PreTool/Write hooks (4)\n  'pretool/Write/architecture-change-detector': architectureChangeDetector,\n  'pretool/Write/code-quality-gate': codeQualityGate,\n  'pretool/Write/docstring-enforcer': docstringEnforcer,\n  'pretool/Write/security-pattern-validator': securityPatternValidator,\n\n  // PreTool/MCP hooks (4)\n  'pretool/mcp/context7-tracker': context7Tracker,\n  'pretool/mcp/memory-fabric-init': memoryFabricInit,\n  'pretool/mcp/memory-validator': memoryValidator,\n  'pretool/mcp/sequential-thinking-auto': sequentialThinkingAuto,\n\n  // PreTool/InputMod hooks (1)\n  'pretool/input-mod/write-headers': writeHeaders,\n\n  // PreTool/Skill hooks (1)\n  'pretool/skill/skill-tracker': skillTracker,\n};\n\nexport function getHook(name: string): HookFn | undefined {\n  return hooks[name];\n}\n\nexport function listHooks(): string[] {\n  return Object.keys(hooks);\n}\n"],
  "mappings": "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",
  "names": ["isBashInput", "input", "isWriteInput", "isEditInput", "isReadInput", "appendFileSync", "existsSync", "statSync", "renameSync", "mkdirSync", "getLogDir", "getProjectDir", "getPluginRoot", "getSessionId", "outputSilentSuccess", "outputSilentAllow", "outputBlock", "reason", "outputWithContext", "ctx", "outputPromptContext", "outputAllowWithContext", "systemMessage", "result", "outputError", "message", "outputWarning", "outputDeny", "LOG_ROTATION_MAX_SIZE", "PERMISSION_LOG_MAX_SIZE", "rotateLogFile", "logFile", "maxSize", "rotated", "ensureDir", "dir", "logHook", "hookName", "logDir", "timestamp", "logPermissionFeedback", "decision", "input", "toolName", "sessionId", "readHookInput", "chunks", "buf", "bytesRead", "fd", "readSync", "getField", "path", "parts", "value", "part", "normalizeCommand", "command", "escapeRegex", "str", "execSync", "getCurrentBranch", "projectDir", "dir", "getProjectDir", "execSync", "isProtectedBranch", "branch", "currentBranch", "getRepoRoot", "isGitRepo", "getGitStatus", "hasUncommittedChanges", "getDefaultBranch", "extractIssueNumber", "patterns", "pattern", "match", "validateBranchName", "validPrefixes", "prefix", "createGuard", "predicate", "input", "outputSilentSuccess", "guardFileExtension", "extensions", "filePath", "ext", "e", "guardCodeFiles", "guardPythonFiles", "guardTypescriptFiles", "guardTestFiles", "p", "guardSkipInternal", "guardPathPattern", "patterns", "pattern", "guardTool", "tools", "toolName", "guardWriteEdit", "guardBash", "guardNontrivialBash", "command", "guardGitCommand", "guardMultiInstance", "dbPath", "existsSync", "runGuards", "guards", "guard", "result", "DANGEROUS_PATTERNS", "dangerousCommandBlocker", "input", "command", "outputSilentSuccess", "normalizedCommand", "normalizeCommand", "pattern", "logHook", "logPermissionFeedback", "outputDeny", "gitBranchProtection", "input", "command", "outputSilentSuccess", "currentBranch", "getCurrentBranch", "isProtectedBranch", "errorMsg", "logPermissionFeedback", "logHook", "outputDeny", "branchContext", "outputWithContext", "VALID_TYPES", "extractCommitMessage", "command", "quotedMatch", "unquotedMatch", "gitCommitMessageValidator", "input", "outputSilentSuccess", "context", "logPermissionFeedback", "outputAllowWithContext", "commitMsg", "typesPattern", "conventionalPattern", "simplePattern", "titleLine", "titleLen", "logHook", "errorMsg", "outputDeny", "gitBranchNamingValidator", "input", "command", "outputSilentSuccess", "branchName", "checkoutMatch", "branchMatch", "validationError", "validateBranchName", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "STAGED_FILE_WARNING_THRESHOLD", "gitAtomicCommitChecker", "input", "command", "outputSilentSuccess", "stagedCount", "getGitStatus", "line", "STAGED_FILE_WARNING_THRESHOLD", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "DANGEROUS_SEGMENTS", "validateSegment", "segment", "trimmed", "pattern", "validateCompoundCommand", "command", "segments", "compoundCommandValidator", "input", "outputSilentSuccess", "normalizedCommand", "normalizeCommand", "blockReason", "errorMsg", "logPermissionFeedback", "logHook", "outputDeny", "DEFAULT_TIMEOUT", "defaultTimeoutSetter", "input", "command", "timeout", "description", "updatedInput", "logHook", "existsSync", "readFileSync", "join", "loadErrorRules", "projectDir", "rulesFile", "countCommonWords", "str1", "str2", "words1", "words2", "count", "word", "errorPatternWarner", "input", "getProjectDir", "command", "outputSilentSuccess", "rules", "hints", "r", "rule", "sampleCommand", "logHook", "contextMsg", "outputWithContext", "execSync", "getPotentialConflicts", "projectDir", "targetBranch", "changedFiles", "conflicts", "file", "conflictPredictor", "input", "command", "getProjectDir", "outputSilentSuccess", "branchMatch", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "execSync", "existsSync", "join", "basename", "dirname", "findRelatedTests", "projectDir", "sourceFile", "tests", "baseName", "dirName", "testPatterns", "pattern", "fullPath", "getChangedFiles", "line", "file", "affectedTestsFinder", "input", "command", "getProjectDir", "outputSilentSuccess", "changedFiles", "relatedTests", "uniqueTests", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "join", "detectCIChecks", "projectDir", "checks", "ciSimulation", "input", "command", "getProjectDir", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "join", "hasPreCommitConfig", "projectDir", "hasHuskyConfig", "preCommitSimulation", "input", "command", "getProjectDir", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "execSync", "getPRStatus", "projectDir", "prNumber", "prArg", "result", "prMergeGate", "input", "command", "getProjectDir", "outputSilentSuccess", "prMatch", "status", "context", "logPermissionFeedback", "outputAllowWithContext", "issues", "logHook", "execSync", "getRecentCommits", "projectDir", "since", "sinceArg", "groupCommitsByType", "commits", "groups", "commit", "match", "type", "changelogGenerator", "input", "command", "getProjectDir", "outputSilentSuccess", "sections", "c", "combined", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "getPackageJsonVersion", "projectDir", "filePath", "getPyprojectVersion", "match", "getVersionSources", "sources", "pkgVersion", "pyVersion", "versionSync", "input", "command", "getProjectDir", "outputSilentSuccess", "versions", "s", "uniqueVersions", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "PROBLEMATIC_LICENSES", "checkNpmLicenses", "projectDir", "issues", "lockFile", "content", "license", "licenseCompliance", "input", "command", "getProjectDir", "outputSilentSuccess", "pkgMatch", "pkgName", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "ISSUE_TEMPLATES", "detectIssueType", "command", "ghIssueCreationGuide", "input", "outputSilentSuccess", "issueType", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "DOCS_CHECKLIST", "issueDocsRequirement", "input", "command", "outputSilentSuccess", "context", "logPermissionFeedback", "logHook", "outputAllowWithContext", "existsSync", "readFileSync", "join", "isMultiInstanceEnabled", "projectDir", "dbPath", "getQualityGateStatus", "registryPath", "multiInstanceQualityGate", "input", "command", "getProjectDir", "outputSilentSuccess", "gates", "failedGates", "gate", "context", "g", "logPermissionFeedback", "logHook", "outputAllowWithContext", "BLOCKED_URL_PATTERNS", "SENSITIVE_ACTIONS", "extractUrl", "command", "urlMatch", "isBlockedUrl", "url", "pattern", "isSensitiveAction", "agentBrowserSafety", "input", "outputSilentSuccess", "logPermissionFeedback", "logHook", "outputDeny", "context", "outputAllowWithContext", "realpathSync", "existsSync", "resolve", "isAbsolute", "PROTECTED_PATTERNS", "CONFIG_PATTERNS", "resolveRealPath", "filePath", "projectDir", "absolutePath", "isProtected", "realPath", "pattern", "isConfigFile", "fileGuard", "input", "getProjectDir", "outputSilentSuccess", "logHook", "matchedPattern", "logPermissionFeedback", "outputDeny", "existsSync", "readFileSync", "join", "getCoordinationDbPath", "projectDir", "isCoordinationEnabled", "getInstanceId", "isLockedByOther", "filePath", "dbPath", "instanceId", "locks", "now", "l", "fileLockCheck", "input", "getProjectDir", "toolName", "outputSilentSuccess", "normalizedPath", "existingLock", "logPermissionFeedback", "logHook", "outputDeny", "existsSync", "readFileSync", "writeFileSync", "mkdirSync", "join", "dirname", "getLocksFilePath", "projectDir", "join", "generateLockId", "getInstanceId", "calculateExpiry", "loadLocks", "locksPath", "existsSync", "readFileSync", "saveLocks", "data", "dir", "dirname", "mkdirSync", "writeFileSync", "checkExistingLock", "locks", "filePath", "instanceId", "now", "l", "checkDirectoryLock", "acquireLock", "reason", "multiInstanceLock", "input", "guardResult", "guardWriteEdit", "getProjectDir", "toolName", "outputSilentSuccess", "instanceDir", "logHook", "normalizedPath", "dirLock", "logPermissionFeedback", "outputDeny", "fileLock", "existsSync", "readFileSync", "join", "LAYER_PATTERNS", "detectArchLayer", "filePath", "layer", "patterns", "p", "loadPatternHints", "projectDir", "patternsDir", "layerPatternFile", "content", "count", "architectureChangeDetector", "input", "getProjectDir", "outputSilentSuccess", "guardResult", "guardPathPattern", "archLayer", "patternHints", "isNewFile", "archContext", "logPermissionFeedback", "logHook", "outputWithContext", "existsSync", "readFileSync", "join", "extname", "MAX_FUNCTION_LINES", "MAX_NESTING_DEPTH", "MAX_CONDITIONALS_PER_FUNCTION", "getFileExt", "filePath", "checkFunctionLength", "content", "ext", "warnings", "lines", "inFunction", "functionName", "functionLines", "line", "defMatch", "classMatch", "braceCount", "funcMatch", "constFuncMatch", "openBraces", "closeBraces", "checkNestingDepth", "maxDepth", "match", "indent", "depth", "braceDepth", "checkConditionals", "ifCount", "switchCount", "ternaryCount", "totalConditionals", "functionCount", "avgConditionals", "getCachedTypeErrors", "projectDir", "cacheFile", "cache", "basename", "codeQualityGate", "input", "getProjectDir", "guardResult", "runGuards", "guardCodeFiles", "guardSkipInternal", "outputSilentSuccess", "allWarnings", "typeErrors", "logHook", "qualityMsg", "outputWithContext", "extname", "getFileExt", "filePath", "isTestFile", "p", "findMissingPythonDocstrings", "content", "missing", "lines", "i", "funcMatch", "funcName", "hasDocstring", "j", "nextLine", "findMissingJSDoc", "hasJSDoc", "line", "exportMatch", "docstringEnforcer", "input", "guardResult", "runGuards", "guardCodeFiles", "guardSkipInternal", "outputSilentSuccess", "ext", "missingDocstrings", "funcList", "contextMsg", "logHook", "outputWithContext", "basename", "SECURITY_PATTERNS", "detectSecurityIssues", "content", "issues", "name", "pattern", "securityPatternValidator", "input", "filePath", "guardResult", "runGuards", "guardCodeFiles", "outputSilentSuccess", "securityIssues", "logHook", "warningMsg", "logPermissionFeedback", "outputWithContext", "existsSync", "readFileSync", "appendFileSync", "statSync", "renameSync", "mkdirSync", "join", "MAX_LOG_SIZE", "getTelemetryLog", "logDir", "getLogDir", "rotateLogIfNeeded", "logFile", "calculateCacheContext", "lines", "totalQueries", "librarySet", "line", "match", "recentLibraries", "i", "recentStr", "context7Tracker", "input", "toolName", "outputSilentSuccess", "libraryId", "query", "telemetryLog", "logEntry", "cacheContext", "logPermissionFeedback", "logHook", "outputWithContext", "existsSync", "mkdirSync", "readFileSync", "writeFileSync", "readdirSync", "join", "checkOrphanedSessions", "projectDir", "currentSessionId", "logsDir", "orphanedCount", "files", "file", "sessionId", "initDirectories", "dirs", "dir", "validateMcpHealth", "registerSession", "orphanCheckFile", "now", "sessions", "content", "memoryFabricInit", "input", "getProjectDir", "getSessionId", "logHook", "health", "msg", "outputWithContext", "outputSilentSuccess", "memoryValidator", "input", "toolName", "outputSilentSuccess", "entityNames", "entityCount", "logPermissionFeedback", "logHook", "outputWarning", "relations", "relationCount", "entities", "invalidCount", "e", "existsSync", "appendFileSync", "statSync", "renameSync", "mkdirSync", "join", "MAX_LOG_SIZE", "getThinkingLog", "logDir", "getLogDir", "rotateLogIfNeeded", "logFile", "sequentialThinkingAuto", "input", "outputSilentSuccess", "thought", "thoughtNumber", "totalThoughts", "nextNeeded", "isRevision", "thinkingLog", "logEntry", "logPermissionFeedback", "logHook", "existsSync", "extname", "getCurrentDate", "addHeader", "ext", "content", "date", "firstNewline", "shebang", "rest", "writeHeaders", "input", "toolName", "filePath", "content", "outputSilentSuccess", "existsSync", "ext", "extname", "logHook", "addHeader", "existsSync", "appendFileSync", "mkdirSync", "join", "dirname", "basename", "ensureDir", "dir", "appendSafe", "file", "content", "skillTracker", "input", "skillName", "skillArgs", "projectDir", "getProjectDir", "outputSilentSuccess", "logHook", "usageLog", "timestamp", "analyticsLog", "analyticsEntry", "hooks", "dangerousCommandBlocker", "gitBranchProtection", "gitCommitMessageValidator", "gitBranchNamingValidator", "gitAtomicCommitChecker", "compoundCommandValidator", "defaultTimeoutSetter", "errorPatternWarner", "conflictPredictor", "affectedTestsFinder", "ciSimulation", "preCommitSimulation", "prMergeGate", "changelogGenerator", "versionSync", "licenseCompliance", "ghIssueCreationGuide", "issueDocsRequirement", "multiInstanceQualityGate", "agentBrowserSafety", "fileGuard", "fileLockCheck", "multiInstanceLock", "architectureChangeDetector", "codeQualityGate", "docstringEnforcer", "securityPatternValidator", "context7Tracker", "memoryFabricInit", "memoryValidator", "sequentialThinkingAuto", "writeHeaders", "skillTracker", "getHook", "name", "listHooks"]
}
