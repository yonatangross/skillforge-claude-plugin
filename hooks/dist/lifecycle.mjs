// OrchestKit Hooks - lifecycle bundle
// Generated: 2026-01-23T16:38:20.875Z

var bt=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function hn(t){return typeof t.command=="string"}function Sn(t){return typeof t.file_path=="string"&&typeof t.content=="string"}function kn(t){return typeof t.file_path=="string"&&typeof t.old_string=="string"&&typeof t.new_string=="string"}function bn(t){return typeof t.file_path=="string"&&t.content===void 0}import{appendFileSync as T,existsSync as F,statSync as vt,renameSync as _t,mkdirSync as It}from"node:fs";var $t=process.env.CLAUDE_PLUGIN_ROOT||process.env.CLAUDE_PROJECT_DIR||".",N=process.env.CLAUDE_PROJECT_DIR||".";function A(){return process.env.CLAUDE_PLUGIN_ROOT?`${process.env.HOME}/.claude/logs/ork`:`${N}/.claude/logs`}function l(){return N}function L(){return $t}function y(){return process.env.CLAUDE_SESSION_ID}function a(){return{continue:!0,suppressOutput:!0}}function In(){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{permissionDecision:"allow"}}}function $n(t){return{continue:!1,stopReason:t,hookSpecificOutput:{permissionDecision:"deny",permissionDecisionReason:t}}}function I(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"PostToolUse",additionalContext:t}}}function xn(t){return{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:t}}}function Hn(t,e){let n={continue:!0,hookSpecificOutput:{hookEventName:"PreToolUse",additionalContext:t,permissionDecision:"allow"}};return e?n.systemMessage=e:n.suppressOutput=!0,n}function On(t){return{continue:!0,systemMessage:t}}function wn(t){return{continue:!0,systemMessage:`\u26A0 ${t}`}}function Cn(t){return{continue:!1,stopReason:t,hookSpecificOutput:{hookEventName:"PreToolUse",permissionDecision:"deny",permissionDecisionReason:t}}}var xt=200*1024,Ht=100*1024;function M(t,e){if(F(t))try{if(vt(t).size>e){let o=`${t}.old.${Date.now()}`;_t(t,o)}}catch{}}function U(t){F(t)||It(t,{recursive:!0})}function r(t,e){let n=A(),o=`${n}/hooks.log`;try{U(n),M(o,xt);let i=new Date().toISOString().replace("T"," ").slice(0,19);T(o,`[${i}] [${t}] ${e}
`)}catch{}}function jn(t,e,n){let o=A(),i=`${o}/permission-feedback.log`;try{U(o),M(i,Ht);let s=new Date().toISOString(),c=n?.tool_name||process.env.HOOK_TOOL_NAME||"unknown",p=n?.session_id||y();T(i,`${s} | ${t} | ${e} | tool=${c} | session=${p}
`)}catch{}}function Rn(){try{let t=[],n=Buffer.allocUnsafe(256),o,i=0,{readSync:s}=bt("node:fs");for(;;)try{if(o=s(i,n,0,256,null),o===0)break;t.push(Buffer.from(n.subarray(0,o)))}catch{break}let c=Buffer.concat(t).toString("utf8").trim();return c?JSON.parse(c):{tool_name:"",session_id:y(),tool_input:{}}}catch{return{tool_name:"",session_id:y(),tool_input:{}}}}function En(t,e){let n=e.replace(/^\./,"").split("."),o=t;for(let i of n){if(o==null)return;o=o[i]}return o}function Pn(t){return t.replace(/\\\s*[\r\n]+/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim()}function Dn(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}import{execSync as S}from"node:child_process";function Ot(t){let e=t||l();try{return S("git branch --show-current",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function wt(t){let e=t||Ot();return["dev","main","master"].includes(e)}function An(t){let e=t||l();try{return S("git rev-parse --show-toplevel",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}).trim()}catch{return e}}function Ln(t){let e=t||l();try{return S("git rev-parse --git-dir",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),!0}catch{return!1}}function Ct(t){let e=t||l();try{return S("git status --short",{cwd:e,encoding:"utf8",timeout:1e4,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function Mn(t){return Ct(t).length>0}function Un(t){let e=t||l();try{return S("git rev-parse --verify main",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"main"}catch{try{return S("git rev-parse --verify master",{cwd:e,encoding:"utf8",timeout:5e3,stdio:["pipe","pipe","pipe"]}),"master"}catch{return"main"}}}function jt(t){let e=[/issue\/(\d+)/i,/feature\/(\d+)/i,/fix\/(\d+)/i,/bug\/(\d+)/i,/feat\/(\d+)/i,/^(\d+)-/,/-(\d+)$/,/#(\d+)/];for(let n of e){let o=t.match(n);if(o)return parseInt(o[1],10)}return null}function Kn(t){if(wt(t))return null;let e=["issue/","feature/","fix/","bug/","feat/","chore/","docs/","refactor/","test/","ci/","perf/","style/","release/","hotfix/"];return e.some(o=>t.startsWith(o))?t.startsWith("issue/")&&!jt(t)?"issue/ branches should include an issue number (e.g., issue/123-description)":null:`Branch name should start with a valid prefix: ${e.join(", ")}`}import{existsSync as K,readFileSync as W}from"node:fs";function Rt(t){let e=`${t}/.claude/feedback/consent-status.json`;if(!K(e))return{consented:!1,asked:!1};try{let n=JSON.parse(W(e,"utf-8"));return{consented:n.consented===!0,asked:n.asked===!0}}catch{return{consented:!1,asked:!1}}}function Et(t){let e=`${t}/.claude/feedback/consent-log.json`;if(!K(e))return null;try{let n=JSON.parse(W(e,"utf-8"));if(n.events&&n.events.length>0)return n.events[n.events.length-1]}catch{}return null}function Pt(t){try{let e=new Date(t);return Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60*24))>=30}catch{return!1}}function J(t){let e=t.project_dir||l(),n=Rt(e);if(n.consented)return r("analytics-consent-check","User has consented to analytics"),a();if(n.asked){let o=Et(e);return o&&(o.action==="declined"||o.action==="revoked")&&Pt(o.timestamp)?(r("analytics-consent-check","Showing 30-day reminder"),{continue:!0,systemMessage:"Reminder: Anonymous analytics help improve OrchestKit. Enable with /ork:feedback opt-in"}):(r("analytics-consent-check","User recently declined, not prompting"),a())}return r("analytics-consent-check","First time user, showing brief notice"),{continue:!0,systemMessage:"OrchestKit collects local usage metrics. Share anonymously with /ork:feedback opt-in"}}import{existsSync as k,readFileSync as V,writeFileSync as Dt,unlinkSync as Tt}from"node:fs";function Ft(t){let e=`${t}/.claude/.instance_env`;if(!k(e))return null;try{let o=V(e,"utf-8").match(/CLAUDE_INSTANCE_ID=([^\n]+)/);if(o)return o[1].trim()}catch{}return null}function Nt(t,e){let o=`${`${t}/.claude/coordination/heartbeats`}/${e}.json`;if(k(o))try{let i=JSON.parse(V(o,"utf-8"));i.status="stopping",Dt(o,JSON.stringify(i,null,2)),r("coordination-cleanup",`Updated heartbeat status to 'stopping' for ${e}`)}catch(i){r("coordination-cleanup",`Failed to update heartbeat: ${i}`)}}function At(t,e){let n=`${t}/.claude/coordination/.claude.db`;if(!k(n)){r("coordination-cleanup","No coordination database found");return}r("coordination-cleanup",`Would unregister instance: ${e}`)}function Lt(t){let e=`${t}/.claude/.instance_env`;try{k(e)&&(Tt(e),r("coordination-cleanup","Removed instance environment file"))}catch(n){r("coordination-cleanup",`Failed to remove instance env: ${n}`)}}function B(t){r("coordination-cleanup","Starting coordination cleanup");let e=t.project_dir||l(),n=Ft(e);return n&&(Nt(e,n),At(e,n)),Lt(e),r("coordination-cleanup","Coordination cleanup complete"),a()}import{existsSync as Mt,readFileSync as Ut,writeFileSync as Kt,mkdirSync as G,appendFileSync as Wt}from"node:fs";function Jt(){return process.env.CLAUDE_MULTI_INSTANCE==="1"}function Vt(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function Bt(t){let e=`${t}/.claude/context/session/state.json`;if(!Mt(e))return"General development";try{return JSON.parse(Ut(e,"utf-8")).current_task?.description||"General development"}catch{return"General development"}}function Gt(){return process.env.CLAUDE_SUBAGENT_ROLE||"main"}function zt(){let t=y(),e=new Date().toISOString().replace(/[-:T.Z]/g,"").slice(0,14),n=Math.random().toString(36).substring(2,8);return`${t.slice(0,8)}-${e}-${n}`}function qt(t,e){let n=`${t}/.claude/.instance_env`;try{G(`${t}/.claude`,{recursive:!0}),Wt(n,`CLAUDE_INSTANCE_ID=${e}
`),r("coordination-init",`Saved instance ID: ${e}`)}catch(o){r("coordination-init",`Failed to save instance ID: ${o}`)}}function Yt(t,e,n,o){let i=`${t}/.claude/coordination/heartbeats`;try{G(i,{recursive:!0});let s={instance_id:e,task:n,role:o,status:"active",started_at:new Date().toISOString(),last_heartbeat:new Date().toISOString()};Kt(`${i}/${e}.json`,JSON.stringify(s,null,2)),r("coordination-init",`Initialized heartbeat for ${e}`)}catch(s){r("coordination-init",`Failed to initialize heartbeat: ${s}`)}}function z(t){if(!Jt())return r("coordination-init","Multi-instance not enabled, skipping"),a();if(Vt())return r("coordination-init","Skipping coordination init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),a();r("coordination-init","Starting coordination initialization");let e=t.project_dir||l(),n=Bt(e),o=Gt(),i=zt();return process.env.CLAUDE_INSTANCE_ID=i,qt(e,i),Yt(e,i,n,o),r("coordination-init",`Coordination initialized: ${i}`),a()}function Zt(t){let e=t.split("/");return(e[e.length-1]||"unknown").toLowerCase().replace(/\s+/g,"-")}function q(t){let e=t.project_dir||l(),n=Zt(e),o=`${n}-decisions`;return r("decision-sync-pull",`Session starting - decision recall available with user_id: ${o}`),r("decision-sync-pull",`Decision memory available: user_id='${o}' for ${n}`),a()}import{existsSync as Y}from"node:fs";import{execSync as Xt}from"node:child_process";function Qt(t,e){let n=`${t}/.claude/scripts/decision-sync.sh`,o=`${e}/.claude/scripts/decision-sync.sh`,i=Y(n)?n:Y(o)?o:null;if(!i)return 0;try{let c=Xt(`"${i}" pending 2>/dev/null || echo "0"`,{encoding:"utf-8",timeout:2e3}).match(/Pending Decisions \((\d+)\)/);if(c)return parseInt(c[1],10)}catch{}return 0}function Z(t){let e=t.project_dir||l(),n=L(),o=Qt(e,n);return o===0?(r("decision-sync-push","No pending decisions to sync"),a()):(r("decision-sync-push",`Found ${o} pending decisions to sync`),{continue:!0,systemMessage:`Session ending with ${o} pending decisions. To sync to mem0, run: decision-sync.sh sync`})}import{existsSync as $,readFileSync as x,writeFileSync as X,readdirSync as te,unlinkSync as ee,mkdirSync as ne}from"node:fs";function oe(){return process.env.CLAUDE_MULTI_INSTANCE==="1"}function re(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function ie(){return process.env.CLAUDE_INSTANCE_ID||y()}function se(t){let e=`${t}/.claude/.instance_env`;if(!$(e))return null;try{let o=x(e,"utf-8").match(/CLAUDE_INSTANCE_ID=([^\n]+)/);if(o)return o[1].trim()}catch{}return null}function ce(t,e){let n=`${t}/.claude/coordination/heartbeats`,o=`${n}/${e}.json`;if(!$(o)){ne(n,{recursive:!0});let i={instance_id:e,status:"active",last_heartbeat:new Date().toISOString()};X(o,JSON.stringify(i,null,2)),r("instance-heartbeat",`Created heartbeat for ${e}`);return}try{let i=JSON.parse(x(o,"utf-8"));i.last_heartbeat=new Date().toISOString(),i.status="active",X(o,JSON.stringify(i,null,2)),r("instance-heartbeat",`Updated heartbeat for ${e}`)}catch(i){r("instance-heartbeat",`Failed to update heartbeat: ${i}`)}}function ae(t,e){let n=`${t}/.claude/coordination/heartbeats`;if(!$(n))return 0;let o=5*60*1e3,i=Date.now(),s=0;try{let c=te(n).filter(p=>p.endsWith(".json"));for(let p of c){let u=`${n}/${p}`;try{let f=JSON.parse(x(u,"utf-8"));if(f.instance_id===e)continue;let g=new Date(f.last_heartbeat).getTime();i-g>o&&(ee(u),s++,r("instance-heartbeat",`Cleaned up stale instance: ${f.instance_id}`))}catch{}}}catch(c){r("instance-heartbeat",`Failed to scan heartbeats: ${c}`)}return s}function Q(t){if(!oe())return a();if(re())return r("instance-heartbeat","Skipping instance heartbeat (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),a();let e=t.project_dir||l(),n=ie();if((!n||n==="unknown")&&(n=se(e)||n),!n)return r("instance-heartbeat","No instance ID available"),a();ce(e,n);let o=ae(e,n);return o>0&&r("instance-heartbeat",`Cleaned up ${o} stale instance(s)`),a()}import{mkdirSync as ue,appendFileSync as le}from"node:fs";function pe(){return!!process.env.MEM0_API_KEY}function tt(t){if(r("mem0-analytics-tracker","Mem0 analytics tracker starting"),!pe())return r("mem0-analytics-tracker","Mem0 not available, skipping analytics"),a();let e=t.project_dir||l(),n=`${e}/.claude/logs/mem0-analytics.jsonl`,o=t.session_id||y(),i=new Date().toISOString(),s=JSON.stringify({session_id:o,timestamp:i,event:"session_start"});try{ue(`${e}/.claude/logs`,{recursive:!0}),le(n,s+`
`),r("mem0-analytics-tracker","Mem0 analytics tracked")}catch(c){r("mem0-analytics-tracker",`Failed to write analytics: ${c}`)}return a()}import{existsSync as de,readFileSync as nt,mkdirSync as ge,renameSync as fe}from"node:fs";function me(t){let e=t.split("/");return(e[e.length-1]||"unknown").toLowerCase().replace(/\s+/g,"-")}function ye(){return!!process.env.MEM0_API_KEY}function et(t){if(!de(t))return!1;try{let e=nt(t,"utf-8"),n=JSON.parse(e);return!(!n||Object.keys(n).length===0)}catch{return!1}}function he(t,e){let n=`${e}/.claude/logs/mem0-processed`,o=new Date().toISOString().replace(/[:.]/g,"-");try{ge(n,{recursive:!0});let s=(t.split("/").pop()||"pending-sync").replace(".json",`.processed-${o}.json`),c=`${n}/${s}`;fe(t,c),r("mem0-context-retrieval",`Archived pending sync to ${c}`)}catch(i){r("mem0-context-retrieval",`Warning: Could not archive ${t}: ${i}`)}}function ot(t){r("mem0-context-retrieval","Mem0 context retrieval starting");let e=t.project_dir||l(),n=me(e),o=`${e}/.mem0-pending-sync.json`,i=`${process.env.HOME}/.claude/.mem0-pending-sync.json`,s=null;if(et(o))s=o,r("mem0-context-retrieval",`Found pending sync in project: ${o}`);else if(et(i))try{let c=JSON.parse(nt(i,"utf-8"));c.project_id===n?(s=i,r("mem0-context-retrieval","Found pending sync in global location for this project")):r("mem0-context-retrieval",`Global pending sync exists but for different project: ${c.project_id}`)}catch{}return s&&(r("mem0-context-retrieval","Found pending sync, archiving for processing"),he(s,e),r("mem0-context-retrieval","Pending sync archived - will be processed on next memory operation")),ye()?r("mem0-context-retrieval","Graph + mem0 available for this session"):r("mem0-context-retrieval","Graph available (mem0 not configured) for this session"),a()}import{writeFileSync as Se,mkdirSync as ke}from"node:fs";function be(){return!!process.env.MEM0_API_KEY}function ve(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function rt(t){if(ve())return r("mem0-webhook-setup","Skipping mem0 webhook setup (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),a();if(r("mem0-webhook-setup","Mem0 webhook setup starting"),!be())return r("mem0-webhook-setup","Mem0 not available, skipping webhook setup"),a();let e=t.project_dir||l(),n=`${e}/.claude/mem0-webhooks.json`,o="orchestkit-auto-sync",i=["memory.created","memory.updated","memory.deleted"],s=process.env.MEM0_WEBHOOK_URL||"https://example.com/webhook/mem0";r("mem0-webhook-setup","Checking for existing webhooks"),process.env.MEM0_WEBHOOK_URL||r("mem0-webhook-setup","Webhook URL not configured (set MEM0_WEBHOOK_URL), skipping creation");try{ke(`${e}/.claude`,{recursive:!0}),Se(n,JSON.stringify({webhook_name:o,events:i,url:s},null,2)),r("mem0-webhook-setup","Webhook config saved")}catch(c){r("mem0-webhook-setup",`Failed to save webhook config: ${c}`)}return r("mem0-webhook-setup","Webhook setup complete"),a()}import{existsSync as m,readFileSync as _e,writeFileSync as it,mkdirSync as b}from"node:fs";import{execSync as H}from"node:child_process";function Ie(){return process.env.CLAUDE_MULTI_INSTANCE==="1"}function $e(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function xe(){try{return H("which sqlite3",{encoding:"utf-8",stdio:"pipe"}),!0}catch{return!1}}function He(t){let e=t.split("/").pop()||"unknown",n=new Date().toISOString().replace(/[-:T.Z]/g,"").slice(0,14),o=Math.random().toString(16).substring(2,10);return`${e}-${n}-${o}`}function Oe(t){try{return H("git branch --show-current",{cwd:t,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()}catch{return"unknown"}}function we(t){let e=[];return(m(`${t}/backend`)||m(`${t}/src/backend`))&&e.push("backend"),(m(`${t}/frontend`)||m(`${t}/src/frontend`)||m(`${t}/package.json`))&&e.push("frontend"),(m(`${t}/tests`)||m(`${t}/__tests__`))&&e.push("testing"),(m(`${t}/infrastructure`)||m(`${t}/docker-compose.yml`)||m(`${t}/Dockerfile`))&&e.push("devops"),e}function Ce(t,e){let n=Oe(t),o=we(t),i=new Date().toISOString(),s={instance_id:e,worktree_name:t.split("/").pop()||"unknown",worktree_path:t,branch:n,capabilities:o,agent_type:null,model:"claude-opus-4-5-20251101",priority:1,created_at:i,status:"active",heartbeat_interval_ms:5e3,last_heartbeat:i},c=`${t}/.instance`;return b(c,{recursive:!0}),it(`${c}/id.json`,JSON.stringify(s,null,2)),r("multi-instance-init",`Instance identity created: ${e}`),s}function je(t){let e=`${t}/.claude/coordination`,n=`${e}/.claude.db`,o=`${e}/schema.sql`;if(m(n))return!0;if(!m(o))return r("multi-instance-init",`WARNING: Schema file not found at ${o}`),!1;try{return b(e,{recursive:!0}),H(`sqlite3 "${n}" < "${o}"`,{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}),r("multi-instance-init","Database initialized from schema"),!0}catch(i){return r("multi-instance-init",`Failed to initialize database: ${i}`),!1}}function Re(t,e){let n=`${t}/.instance`;it(`${n}/heartbeat.pid`,String(process.pid)),r("multi-instance-init",`Heartbeat marker created for ${e}`)}function st(t){if(!Ie())return a();if(!xe())return r("multi-instance-init","sqlite3 not available, skipping"),a();if($e())return r("multi-instance-init","Skipping multi-instance init (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),a();r("multi-instance-init","Starting multi-instance coordination initialization...");let e=t.project_dir||l(),n=`${e}/.instance`,o=`${e}/.claude/coordination`;if(b(`${o}/locks`,{recursive:!0}),b(n,{recursive:!0}),!je(e))return r("multi-instance-init","ERROR: Failed to initialize database"),a();let i=`${n}/id.json`,s=`${n}/heartbeat.pid`;if(m(i)&&m(s))try{let p=JSON.parse(_e(i,"utf-8"));return r("multi-instance-init",`Reusing existing instance: ${p.instance_id}`),a()}catch{}let c=He(e);return Ce(e,c),Re(e,c),r("multi-instance-init","Multi-instance coordination initialized successfully"),a()}import{existsSync as v,readFileSync as O,writeFileSync as Ee,statSync as Pe,mkdirSync as De}from"node:fs";var Te=1*1024*1024;function Fe(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function Ne(t){let e=`${t}/.claude/feedback/sync-config.json`;if(!v(e))return!0;try{return JSON.parse(O(e,"utf-8")).sync_enabled!==!1}catch{return!0}}function ct(t){if(!v(t))return!0;try{let e=Pe(t);return e.size>Te?(r("pattern-sync-pull",`WARN: Skipping - file too large: ${t} (${e.size} bytes)`),!1):!0}catch{return!0}}function Ae(t){let e=`${process.env.HOME}/.claude/global-patterns.json`,n=`${t}/.claude/feedback/learned-patterns.json`;if(!v(e)){r("pattern-sync-pull","No global patterns file found");return}try{let i=JSON.parse(O(e,"utf-8")).patterns||[];if(i.length===0){r("pattern-sync-pull","No global patterns to pull");return}let s={version:"1.0",patterns:[]};if(v(n))try{s=JSON.parse(O(n,"utf-8"))}catch{}let c=s.patterns||[],p=new Set(c.map(g=>g.text)),u=i.filter(g=>!p.has(g.text));if(u.length===0){r("pattern-sync-pull","All global patterns already in project");return}let f=[...c,...u];s.patterns=f,De(`${t}/.claude/feedback`,{recursive:!0}),Ee(n,JSON.stringify(s,null,2)),r("pattern-sync-pull",`Pulled ${u.length} new patterns from global`)}catch(o){r("pattern-sync-pull",`Failed to pull global patterns: ${o}`)}}function at(t){if(Fe())return r("pattern-sync-pull","Skipping pattern sync (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),a();let e=t.project_dir||l();if(!Ne(e))return r("pattern-sync-pull","Global sync disabled, skipping pull"),a();let n=`${process.env.HOME}/.claude/global-patterns.json`,o=`${e}/.claude/feedback/learned-patterns.json`;return!ct(n)||!ct(o)?(r("pattern-sync-pull","Skipping pattern sync due to large files"),a()):(r("pattern-sync-pull","Pulling global patterns..."),Ae(e),r("pattern-sync-pull","Global patterns pulled successfully"),a())}import{existsSync as w,readFileSync as C,writeFileSync as Le,mkdirSync as Me}from"node:fs";function Ue(t){let e=`${t}/.claude/feedback/sync-config.json`;if(!w(e))return!0;try{return JSON.parse(C(e,"utf-8")).sync_enabled!==!1}catch{return!0}}function Ke(t){let e=`${t}/.claude/feedback/learned-patterns.json`,n=`${process.env.HOME}/.claude/global-patterns.json`;if(!w(e)){r("pattern-sync-push","No project patterns file found");return}try{let i=JSON.parse(C(e,"utf-8")).patterns||[];if(i.length===0){r("pattern-sync-push","No project patterns to push");return}let s={version:"1.0",patterns:[],updated:""};if(w(n))try{s=JSON.parse(C(n,"utf-8"))}catch{}let c=s.patterns||[],p=new Set(c.map(g=>g.text)),u=i.filter(g=>!p.has(g.text));if(u.length===0){r("pattern-sync-push","All project patterns already in global");return}let f=[...c,...u];s.patterns=f,s.updated=new Date().toISOString(),Me(`${process.env.HOME}/.claude`,{recursive:!0}),Le(n,JSON.stringify(s,null,2)),r("pattern-sync-push",`Pushed ${u.length} new patterns to global`)}catch(o){r("pattern-sync-push",`Failed to push project patterns: ${o}`)}}function ut(t){let e=t.project_dir||l();return Ue(e)?(r("pattern-sync-push","Pushing project patterns to global..."),Ke(e),a()):(r("pattern-sync-push","Global sync disabled, skipping push"),a())}import{existsSync as _,readFileSync as We,mkdirSync as Je,readdirSync as lt,unlinkSync as pt,copyFileSync as Ve}from"node:fs";function Be(t){if(!_(t))return 0;try{let n=JSON.parse(We(t,"utf-8")).tools||{};return Object.values(n).reduce((o,i)=>o+i,0)}catch{return 0}}function Ge(t,e){if(!_(t))return;let n=Be(t);if(n<=5){r("session-cleanup",`Session had only ${n} tool calls, not archiving`);return}try{Je(e,{recursive:!0});let i=`session-${new Date().toISOString().replace(/[:.]/g,"-")}.json`,s=`${e}/${i}`;Ve(t,s),r("session-cleanup",`Archived session metrics to ${i}`)}catch(o){r("session-cleanup",`Failed to archive metrics: ${o}`)}}function ze(t,e=20){if(_(t))try{let n=lt(t).filter(i=>i.startsWith("session-")&&i.endsWith(".json")).sort().reverse();if(n.length<=e)return;let o=n.slice(e);for(let i of o)try{pt(`${t}/${i}`),r("session-cleanup",`Deleted old archive: ${i}`)}catch{}}catch(n){r("session-cleanup",`Failed to cleanup old archives: ${n}`)}}function qe(t){if(!_(t))return;let e=["hooks.log.old*","audit.log.old*"];for(let n of e)try{let o=n.replace("*",""),i=lt(t).filter(c=>c.startsWith(o)).sort().reverse();if(i.length<=5)continue;let s=i.slice(5);for(let c of s)try{pt(`${t}/${c}`)}catch{}}catch{}}function dt(t){r("session-cleanup","Session cleanup starting");let e=t.project_dir||l(),n="/tmp/claude-session-metrics.json",o=`${e}/.claude/logs/sessions`,i=`${e}/.claude/logs`;return Ge(n,o),ze(o,20),qe(i),r("session-cleanup","Session cleanup complete"),a()}import{existsSync as R,readFileSync as Ye}from"node:fs";function j(t){if(!R(t))return!1;try{return JSON.parse(Ye(t,"utf-8")),!0}catch{return!1}}function gt(t){r("session-context-loader","Session starting - loading context (Protocol 2.0)");let e=t.project_dir||l(),n=0,o=process.env.AGENT_TYPE||"",i=`${e}/.claude/context/session/state.json`,s=`${e}/.claude/context/identity.json`,c=`${e}/.claude/context/knowledge/index.json`;j(i)&&(r("session-context-loader","Session state loaded"),n++),j(s)&&(r("session-context-loader","Identity loaded"),n++),j(c)&&(r("session-context-loader","Knowledge index available"),n++);let p=`${e}/docs/CURRENT_STATUS.md`;if(R(p)&&r("session-context-loader","Current status document exists"),o){r("session-context-loader",`Agent-type aware initialization: ${o}`);let u=`${e}/.claude/agents/${o}.md`;R(u)&&(r("session-context-loader",`Agent configuration found: ${u}`),n++)}return n>0&&(o?r("session-context-loader",`Session context loaded (Protocol 2.0) - Agent: ${o}`):r("session-context-loader","Session context loaded (Protocol 2.0)")),a()}import{existsSync as Ze,readFileSync as Xe,writeFileSync as ft,mkdirSync as Qe}from"node:fs";import{execSync as tn}from"node:child_process";function en(t){try{return tn("git branch --show-current",{cwd:t,encoding:"utf-8",timeout:500,stdio:["pipe","pipe","pipe"]}).trim()}catch{return""}}function mt(t){r("session-env-setup","Setting up session environment");let e=t.project_dir||l(),n=t.session_id||y(),o="/tmp/claude-session-metrics.json";try{Qe(`${e}/.claude/logs`,{recursive:!0})}catch{}let i=process.env.AGENT_TYPE||"";!i&&t.agent_type&&(i=t.agent_type);let s={session_id:n,started_at:new Date().toISOString(),agent_type:i,tools:{},errors:0,warnings:0};try{ft(o,JSON.stringify(s,null,2)),r("session-env-setup","Initialized session metrics")}catch(u){r("session-env-setup",`Failed to initialize metrics: ${u}`)}let c=`${e}/.claude/context/session/state.json`;if(Ze(c)&&i)try{let u=JSON.parse(Xe(c,"utf-8"));u.agent_type=i,u.session_id=n,u.last_activity=new Date().toISOString(),ft(c,JSON.stringify(u,null,2)),r("session-env-setup",`Updated session state with agent_type: ${i}`)}catch(u){r("session-env-setup",`Failed to update session state: ${u}`)}let p=en(e);return p&&r("session-env-setup",`Git branch: ${p}`),i&&r("session-env-setup",`Agent type: ${i}`),a()}import{existsSync as nn,readFileSync as on}from"node:fs";function yt(t){r("session-metrics-summary","Session ending - generating summary");let e="/tmp/claude-session-metrics.json";if(!nn(e))return r("session-metrics-summary","No metrics file found"),a();try{let n=JSON.parse(on(e,"utf-8")),o=n.tools||{},i=n.errors||0,s=Object.values(o).reduce((p,u)=>p+u,0),c=Object.entries(o).sort(([,p],[,u])=>u-p).slice(0,3).map(([p,u])=>`${p}: ${u}`).join(", ");r("session-metrics-summary",`Session stats: ${s} tool calls, ${i} errors`),s>0&&r("session-metrics-summary",`Top tools: ${c}`)}catch(n){r("session-metrics-summary",`Failed to read metrics: ${n}`)}return a()}import{existsSync as h,readFileSync as P,writeFileSync as rn,mkdirSync as sn}from"node:fs";var cn=[{package:"lodash",pattern:"<4.17.21",severity:"high",cve:"CVE-2021-23337",description:"Prototype pollution"},{package:"minimist",pattern:"<1.2.6",severity:"critical",cve:"CVE-2021-44906",description:"Prototype pollution"},{package:"node-fetch",pattern:"<2.6.7",severity:"high",cve:"CVE-2022-0235",description:"Information exposure"},{package:"axios",pattern:"<0.21.2",severity:"high",cve:"CVE-2021-3749",description:"ReDoS vulnerability"},{package:"jsonwebtoken",pattern:"<9.0.0",severity:"critical",cve:"CVE-2022-23529",description:"Insecure token verification"},{package:"express",pattern:"<4.17.3",severity:"medium",cve:"CVE-2022-24999",description:"Open redirect"},{package:"tar",pattern:"<6.1.11",severity:"critical",cve:"CVE-2021-37701",description:"Arbitrary file overwrite"},{package:"path-parse",pattern:"<1.0.7",severity:"medium",cve:"CVE-2021-23343",description:"ReDoS vulnerability"},{package:"django",pattern:"<3.2.14",severity:"high",cve:"CVE-2022-34265",description:"SQL injection"},{package:"flask",pattern:"<2.0.2",severity:"medium",cve:"CVE-2021-28091",description:"Path traversal"},{package:"requests",pattern:"<2.28.0",severity:"medium",cve:"CVE-2023-32681",description:"Information disclosure"},{package:"urllib3",pattern:"<1.26.5",severity:"high",cve:"CVE-2021-33503",description:"ReDoS vulnerability"},{package:"pillow",pattern:"<9.0.0",severity:"high",cve:"CVE-2022-22817",description:"Buffer overflow"},{package:"pyyaml",pattern:"<5.4",severity:"critical",cve:"CVE-2020-14343",description:"Arbitrary code execution"},{package:"jinja2",pattern:"<3.0.3",severity:"medium",cve:"CVE-2020-28493",description:"XSS vulnerability"},{package:"sqlalchemy",pattern:"<1.4.46",severity:"medium",cve:"CVE-2023-30533",description:"SQL injection"}],an=24;function un(){return process.env.ORCHESTKIT_SKIP_SLOW_HOOKS==="1"}function ln(t,e){let n=t.split(".").map(i=>parseInt(i,10)||0),o=e.split(".").map(i=>parseInt(i,10)||0);for(let i=0;i<Math.max(n.length,o.length);i++){let s=n[i]||0,c=o[i]||0;if(s<c)return!0;if(s>c)return!1}return!1}function pn(t,e){let n=e.charAt(0),o=e.substring(1);return n==="<"?ln(t,o):n==="="?t===o:!1}function dn(t){return t.replace(/^[^~>=<]/,"").replace(/,.*$/,"").trim()}function ht(t,e){let n=dn(e),o=t.toLowerCase();for(let i of cn)if(o===i.package&&pn(n,i.pattern))return i;return null}function gn(t){if(!h(t))return null;try{let e=JSON.parse(P(t,"utf-8"));if((Date.now()-e.timestamp)/(1e3*60*60)<an)return e.warnings}catch{}return null}function E(t,e){try{sn(t.replace(/\/[^/]+$/,""),{recursive:!0});let n={warnings:e,timestamp:Date.now()};rn(t,JSON.stringify(n,null,2))}catch{}}function fn(t){let e=0,n=0,o="";if(!h(t))return{criticalCount:e,highCount:n,warnings:o};try{let i=JSON.parse(P(t,"utf-8")),s={...i.dependencies,...i.devDependencies};for(let[c,p]of Object.entries(s)){let u=ht(c,p);u&&(u.severity==="critical"&&e++,u.severity==="high"&&n++,o+=`
- ${c}@${p}: ${u.description} (${u.cve}, ${u.severity}) - upgrade to ${u.pattern}`)}}catch{}return{criticalCount:e,highCount:n,warnings:o}}function mn(t){let e=0,n=0,o="";if(!h(t))return{criticalCount:e,highCount:n,warnings:o};try{let s=P(t,"utf-8").split(`
`);for(let c of s){let p=c.trim();if(!p||p.startsWith("#"))continue;let u=p.match(/^([a-zA-Z0-9_-]+)(?:==|>=|~=|!=|<|>)\s*([0-9.]+)/);if(!u)continue;let[,f,g]=u,d=ht(f,g);d&&(d.severity==="critical"&&e++,d.severity==="high"&&n++,o+=`
- ${f}==${g}: ${d.description} (${d.cve}, ${d.severity}) - upgrade to ${d.pattern}`)}}catch{}return{criticalCount:e,highCount:n,warnings:o}}function St(t){if(un())return r("dependency-version-check","Skipping dependency check (ORCHESTKIT_SKIP_SLOW_HOOKS=1)"),a();r("dependency-version-check","Starting dependency version check");let e=t.project_dir||l(),n=`${e}/.claude/feedback/dependency-check-cache.json`,o=h(`${e}/package.json`),i=h(`${e}/requirements.txt`),s=h(`${e}/pyproject.toml`),c=h(`${e}/go.mod`);if(!o&&!i&&!s&&!c)return r("dependency-version-check","No package files found, skipping check"),E(n,"none"),a();let p=gn(n);if(p!==null)return r("dependency-version-check","Using cached dependency warnings"),p!=="none"?I(`DEPENDENCY SECURITY CHECK (cached): ${p}`):a();let u=0,f=0,g="";if(o){let d=fn(`${e}/package.json`);u+=d.criticalCount,f+=d.highCount,d.warnings&&(g+=`

Node.js (package.json):${d.warnings}`)}if(i){let d=mn(`${e}/requirements.txt`);u+=d.criticalCount,f+=d.highCount,d.warnings&&(g+=`

Python (requirements.txt):${d.warnings}`)}if(g){let d=`Found ${u} critical and ${f} high severity vulnerabilities`,D=`DEPENDENCY SECURITY CHECK: ${d}${g}

Run 'npm audit' or 'pip-audit' for full details.`;if(E(n,D),r("dependency-version-check",d),u>0||f>0)return I(D)}else E(n,"none"),r("dependency-version-check","No known vulnerabilities found");return a()}var kt={"lifecycle/analytics-consent-check":J,"lifecycle/coordination-cleanup":B,"lifecycle/coordination-init":z,"lifecycle/decision-sync-pull":q,"lifecycle/decision-sync-push":Z,"lifecycle/instance-heartbeat":Q,"lifecycle/mem0-analytics-tracker":tt,"lifecycle/mem0-context-retrieval":ot,"lifecycle/mem0-webhook-setup":rt,"lifecycle/multi-instance-init":st,"lifecycle/pattern-sync-pull":at,"lifecycle/pattern-sync-push":ut,"lifecycle/session-cleanup":dt,"lifecycle/session-context-loader":gt,"lifecycle/session-env-setup":mt,"lifecycle/session-metrics-summary":yt,"lifecycle/dependency-version-check":St};function dr(t){return kt[t]}function gr(){return Object.keys(kt)}export{Dn as escapeRegex,jt as extractIssueNumber,Ot as getCurrentBranch,Un as getDefaultBranch,En as getField,Ct as getGitStatus,dr as getHook,A as getLogDir,L as getPluginRoot,l as getProjectDir,An as getRepoRoot,y as getSessionId,Mn as hasUncommittedChanges,kt as hooks,hn as isBashInput,kn as isEditInput,Ln as isGitRepo,wt as isProtectedBranch,bn as isReadInput,Sn as isWriteInput,gr as listHooks,r as logHook,jn as logPermissionFeedback,Pn as normalizeCommand,Hn as outputAllowWithContext,$n as outputBlock,Cn as outputDeny,On as outputError,xn as outputPromptContext,In as outputSilentAllow,a as outputSilentSuccess,wn as outputWarning,I as outputWithContext,Rn as readHookInput,Kn as validateBranchName};
//# sourceMappingURL=lifecycle.mjs.map
